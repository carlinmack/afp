<div id="Basics">
<div class="head">
<h1>Theory Basics</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Basic Results›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Basics
<span class="keyword2"><span class="keyword">imports</span></span>
  <a href="https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL/Set_Interval.html">HOL.Set_Interval</a>
  <a href="https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL/Semiring_Normalization.html">HOL.Semiring_Normalization</a>
  <a href="https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL/Real_Vector_Spaces.html">HOL.Real_Vector_Spaces</a>
  <a href="https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL/Power.html">HOL.Power</a>
  <a href="https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL/Complex.html">HOL.Complex</a>
  <a href="../../jordan_normal_form/theories/#Jordan_Normal_Form">Jordan_Normal_Form.Jordan_Normal_Form</a>
<span class="keyword2"><span class="keyword">begin</span></span>



<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Basic Set-Theoretic Results›</span></span>

<span class="keyword1" id="Basics-set_2_atLeast0"><span class="command">lemma</span></span> set_2_atLeast0 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Basics-set_2"><span class="command">lemma</span></span> set_2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{..&lt;</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Basics-set_4_atLeast0"><span class="command">lemma</span></span> set_4_atLeast0 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="numeral">4</span><span class="main">::</span>nat<span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Basics-set_4"><span class="command">lemma</span></span> set_4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{..&lt;</span><span class="numeral">4</span><span class="main">::</span>nat<span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Basics-set_4_disj"><span class="command">lemma</span></span> set_4_disj <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">i</span><span class="main">::</span> <span class="quoted">nat</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="numeral">4</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="free">i</span> <span class="main">=</span> <span class="main">1</span> <span class="main">∨</span> <span class="free">i</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">∨</span> <span class="free">i</span> <span class="main">=</span> <span class="numeral">3</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Basics-set_8_atLeast0"><span class="command">lemma</span></span> set_8_atLeast0 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="numeral">8</span><span class="main">::</span>nat<span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="numeral">5</span><span class="main">,</span><span class="numeral">6</span><span class="main">,</span><span class="numeral">7</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Basics-index_is_2"><span class="command">lemma</span></span> index_is_2 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">::</span>nat<span class="main">.</span> <span class="bound">i</span> <span class="main">≠</span> Suc <span class="main">0</span> <span class="main">⟶</span> <span class="bound">i</span> <span class="main">≠</span> <span class="numeral">3</span> <span class="main">⟶</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">i</span> <span class="main">⟶</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="numeral">4</span> <span class="main">⟶</span> <span class="bound">i</span> <span class="main">=</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Basics-index_sl_four"><span class="command">lemma</span></span> index_sl_four <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">::</span>nat<span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="numeral">4</span> <span class="main">⟶</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">1</span> <span class="main">∨</span> <span class="bound">i</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">∨</span> <span class="bound">i</span> <span class="main">=</span> <span class="numeral">3</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Basic Arithmetic Results›</span></span>

<span class="keyword1" id="Basics-index_div_eq"><span class="command">lemma</span></span> index_div_eq <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">i</span><span class="main">::</span><span class="quoted">nat</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span><span class="main">∈</span><span class="main">{</span><span class="free">a</span><span class="main">*</span><span class="free">b</span><span class="main">..&lt;</span><span class="main">(</span><span class="free">a</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">*</span><span class="free">b</span><span class="main">}</span> <span class="main">⟹</span> <span class="free">i</span> <span class="keyword1">div</span> <span class="free">b</span> <span class="main">=</span> <span class="free">a</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span><span class="main">::</span><span class="quoted">nat</span> 
  <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">i</span><span class="main">∈</span><span class="main">{</span><span class="free">a</span><span class="main">*</span><span class="free">b</span><span class="main">..&lt;</span><span class="main">(</span><span class="free">a</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">*</span><span class="free">b</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="keyword1">div</span> <span class="free">b</span> <span class="main">≥</span> <span class="free">a</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc_eq_plus1 atLeastLessThan_iff le_refl semiring_normalization_rules<span class="main"><span class="main">(</span></span>7<span class="main"><span class="main">)</span></span> split_div'<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="keyword1">div</span> <span class="free">b</span> <span class="main">&lt;</span> <span class="free">a</span><span class="main">+</span><span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> a <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_mult_imp_div_less<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="keyword1">div</span> <span class="free">b</span> <span class="main">=</span> <span class="free">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Basics-index_mod_eq"><span class="command">lemma</span></span> index_mod_eq <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">i</span><span class="main">::</span><span class="quoted">nat</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span><span class="main">∈</span><span class="main">{</span><span class="free">a</span><span class="main">*</span><span class="free">b</span><span class="main">..&lt;</span><span class="main">(</span><span class="free">a</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">*</span><span class="free">b</span><span class="main">}</span> <span class="main">⟹</span> <span class="free">i</span> <span class="keyword1">mod</span> <span class="free">b</span> <span class="main">=</span> <span class="free">i</span><span class="main">-</span><span class="free">a</span><span class="main">*</span><span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> modulo_nat_def<span class="main">)</span>

<span class="keyword1" id="Basics-sqr_of_cmod_of_prod"><span class="command">lemma</span></span> sqr_of_cmod_of_prod<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>cmod <span class="main">(</span><span class="free">z1</span> <span class="main">*</span> <span class="free">z2</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">=</span> <span class="main">(</span>cmod <span class="free">z1</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">*</span> <span class="main">(</span>cmod <span class="free">z2</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> norm_mult power_mult_distrib<span class="main">)</span>

<span class="keyword1" id="Basics-less_power_add_imp_div_less"><span class="command">lemma</span></span> less_power_add_imp_div_less <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">i</span> <span class="free">m</span> <span class="free">n</span><span class="main">::</span> <span class="quoted">nat</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">m</span><span class="main">+</span><span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span> <span class="main">&lt;</span> <span class="numeral">2</span><span class="main">^</span><span class="free">m</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_mult_imp_div_less power_add<span class="main">)</span>

<span class="keyword1" id="Basics-div_mult_mod_eq_minus"><span class="command">lemma</span></span> div_mult_mod_eq_minus<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">i</span> <span class="free">j</span><span class="main">::</span> <span class="quoted">nat</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">i</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">)</span> <span class="main">*</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span> <span class="main">+</span> <span class="free">i</span> <span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span> <span class="main">-</span> <span class="main">(</span><span class="free">j</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">)</span> <span class="main">*</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span> <span class="main">-</span> <span class="free">j</span> <span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span> <span class="main">=</span> <span class="free">i</span> <span class="main">-</span> <span class="free">j</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> div_mult_mod_eq <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>

<span class="keyword1" id="Basics-neq_imp_neq_div_or_mod"><span class="command">lemma</span></span> neq_imp_neq_div_or_mod<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">i</span> <span class="free">j</span><span class="main">::</span> <span class="quoted">nat</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≠</span> <span class="free">j</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span> <span class="main">≠</span> <span class="free">j</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span> <span class="main">∨</span> <span class="free">i</span> <span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span> <span class="main">≠</span> <span class="free">j</span> <span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms div_mult_mod_eq_minus
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add.right_neutral cancel_div_mod_rules<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
  
<span class="keyword1" id="Basics-index_one_mat_div_mod"><span class="command">lemma</span></span> index_one_mat_div_mod<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">m</span><span class="main">+</span><span class="free">n</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">&lt;</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">m</span><span class="main">+</span><span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="keyword1">1<span class="hidden">⇩</span><sub>m</sub></span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="free">m</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">,</span> <span class="free">j</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">)</span><span class="main">)</span><span class="main">::</span>complex<span class="main">)</span> <span class="main">*</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>m</sub></span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span> <span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">,</span> <span class="free">j</span> <span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>m</sub></span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">m</span><span class="main">+</span><span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span> <span class="free">j</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">=</span> <span class="free">j</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> c1<span class="main">:</span>False
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span> <span class="main">≠</span> <span class="free">j</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span> <span class="main">∨</span> <span class="free">i</span> <span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span> <span class="main">≠</span> <span class="free">j</span> <span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> c1 neq_imp_neq_div_or_mod <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">1<span class="hidden">⇩</span><sub>m</sub></span> <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="free">m</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">,</span> <span class="free">j</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>m</sub></span> <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span> <span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">,</span> <span class="free">j</span> <span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> c1<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Basics-sqr_of_sqrt_2"><span class="command">lemma</span></span> sqr_of_sqrt_2 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">z</span><span class="main">::</span> <span class="quoted"><span class="quoted">"complex"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">/</span> <span class="main">(</span>complex_of_real <span class="main">(</span>sqrt <span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> complex_of_real <span class="main">(</span>sqrt <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">metis</span> nonzero_mult_div_cancel_right norm_numeral of_real_numeral of_real_power power2_eq_square 
real_norm_def real_sqrt_abs real_sqrt_power zero_neq_numeral<span class="main">)</span>

<span class="keyword1" id="Basics-two_div_sqrt_two"><span class="command">lemma</span></span> two_div_sqrt_two <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">*</span> complex_of_real <span class="main">(</span>sqrt <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> complex_of_real <span class="main">(</span>sqrt <span class="numeral">2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> real_sqrt_divide <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> divide_eq_0_iff nonzero_mult_div_cancel_left sqr_of_sqrt_2<span class="main">)</span>

<span class="keyword1" id="Basics-two_div_sqr_of_cmd_sqrt_two"><span class="command">lemma</span></span> two_div_sqr_of_cmd_sqrt_two <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span>cmod <span class="main">(</span><span class="main">1</span> <span class="main">/</span> complex_of_real <span class="main">(</span>sqrt <span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">=</span> <span class="main">1</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> cmod_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power_divide<span class="main">)</span>

<span class="keyword1" id="Basics-two_div_two"><span class="command">lemma</span></span> two_div_two <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="keyword1">div</span> Suc <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Basics-two_mod_two"><span class="command">lemma</span></span> two_mod_two <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="keyword1">mod</span> Suc <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> numeral_2_eq_2<span class="main">)</span>

<span class="keyword1" id="Basics-three_div_two"><span class="command">lemma</span></span> three_div_two <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">3</span> <span class="keyword1">div</span> Suc <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> numeral_3_eq_3<span class="main">)</span>

<span class="keyword1" id="Basics-three_mod_two"><span class="command">lemma</span></span> three_mod_two <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">3</span> <span class="keyword1">mod</span> Suc <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mod_Suc numeral_3_eq_3<span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Basic Results on Matrices›</span></span>

<span class="keyword1" id="Basics-index_matrix_prod"><span class="command">lemma</span></span> index_matrix_prod <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> dim_row <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">&lt;</span> dim_col <span class="free">B</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"dim_col <span class="free">A</span> <span class="main">=</span> dim_row <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">A</span> <span class="main">*</span> <span class="free">B</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="free">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">&lt;</span>dim_row <span class="free">B</span><span class="main">.</span> <span class="main">(</span><span class="free">A</span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">B</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="free">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> scalar_prod_def atLeast0LessThan<span class="main">)</span><span class="keyword1"><span class="command">.</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Basic Results on Sums›</span></span>

<span class="keyword1" id="Basics-sum_insert"><span class="command">lemma</span></span> sum_insert <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∉</span> <span class="free">F</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">F</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">y</span><span class="main">∈</span>insert <span class="free">x</span> <span class="free">F</span><span class="main">.</span> <span class="free">P</span> <span class="bound">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">y</span><span class="main">∈</span><span class="free">F</span><span class="main">.</span> <span class="free">P</span> <span class="bound">y</span><span class="main">)</span> <span class="main">+</span> <span class="free">P</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms insert_def <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add.commute<span class="main">)</span>

<span class="keyword1" id="Basics-sum_of_index_diff"><span class="command">lemma</span></span> sum_of_index_diff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span><span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">::</span>comm_monoid_add"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="main">{</span><span class="free">a</span><span class="main">..&lt;</span><span class="free">a</span><span class="main">+</span><span class="free">b</span><span class="main">}</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="bound">i</span><span class="main">-</span><span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="main">{..&lt;</span><span class="free">b</span><span class="main">}</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">b</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">b</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Basic Results Involving the Exponential Function.›</span></span>

<span class="keyword1" id="Basics-exp_of_real_cnj"><span class="command">lemma</span></span> exp_of_real_cnj<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="main">::</span><span class="quoted">real</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"cnj <span class="main">(</span>exp <span class="main">(</span><span class="keyword1">𝗂</span> <span class="main">*</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> exp <span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="keyword1">𝗂</span> <span class="main">*</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Re <span class="main">(</span>cnj <span class="main">(</span>exp <span class="main">(</span><span class="keyword1">𝗂</span> <span class="main">*</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Re <span class="main">(</span>exp <span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="keyword1">𝗂</span> <span class="main">*</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Re_exp <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Im <span class="main">(</span>cnj <span class="main">(</span>exp <span class="main">(</span><span class="keyword1">𝗂</span> <span class="main">*</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Im <span class="main">(</span>exp <span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="keyword1">𝗂</span> <span class="main">*</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Im_exp <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Basics-exp_of_real_cnj2"><span class="command">lemma</span></span> exp_of_real_cnj2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="main">::</span><span class="quoted">real</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"cnj <span class="main">(</span>exp <span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="keyword1">𝗂</span> <span class="main">*</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> exp <span class="main">(</span><span class="keyword1">𝗂</span> <span class="main">*</span> <span class="free">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Re <span class="main">(</span>cnj <span class="main">(</span>exp <span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="keyword1">𝗂</span> <span class="main">*</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Re <span class="main">(</span>exp <span class="main">(</span><span class="keyword1">𝗂</span> <span class="main">*</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Re_exp <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Im <span class="main">(</span>cnj <span class="main">(</span>exp <span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="keyword1">𝗂</span> <span class="main">*</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Im <span class="main">(</span>exp <span class="main">(</span><span class="keyword1">𝗂</span> <span class="main">*</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Im_exp <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Basics-exp_of_half_pi"><span class="command">lemma</span></span> exp_of_half_pi<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span><span class="main">::</span> <span class="quoted">real</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> pi<span class="main">/</span><span class="numeral">2</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"exp <span class="main">(</span><span class="keyword1">𝗂</span> <span class="main">*</span> complex_of_real <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">𝗂</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms cis_conv_exp cis_pi_half <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="Basics-exp_of_minus_half_pi"><span class="command">lemma</span></span> exp_of_minus_half_pi<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span><span class="main">::</span> <span class="quoted">real</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> pi<span class="main">/</span><span class="numeral">2</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"exp <span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="keyword1">𝗂</span> <span class="main">*</span> complex_of_real <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span><span class="keyword1">𝗂</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms cis_conv_exp cis_minus_pi_half <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="Basics-exp_of_real"><span class="command">lemma</span></span> exp_of_real<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span><span class="main">::</span> <span class="quoted">real</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"exp <span class="main">(</span><span class="keyword1">𝗂</span> <span class="main">*</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> cos <span class="free">x</span> <span class="main">+</span> <span class="keyword1">𝗂</span> <span class="main">*</span> <span class="main">(</span>sin <span class="free">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Re <span class="main">(</span>exp <span class="main">(</span><span class="keyword1">𝗂</span> <span class="main">*</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Re <span class="main">(</span><span class="main">(</span>cos <span class="free">x</span><span class="main">)</span> <span class="main">+</span> <span class="keyword1">𝗂</span> <span class="main">*</span> <span class="main">(</span>sin <span class="free">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Re_exp <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Im <span class="main">(</span>exp <span class="main">(</span><span class="keyword1">𝗂</span> <span class="main">*</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Im <span class="main">(</span><span class="main">(</span>cos <span class="free">x</span><span class="main">)</span> <span class="main">+</span> <span class="keyword1">𝗂</span> <span class="main">*</span> <span class="main">(</span>sin <span class="free">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Im_exp <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Basics-exp_of_real_inv"><span class="command">lemma</span></span> exp_of_real_inv<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span><span class="main">::</span> <span class="quoted">real</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"exp <span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="keyword1">𝗂</span> <span class="main">*</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> cos <span class="free">x</span> <span class="main">-</span> <span class="keyword1">𝗂</span> <span class="main">*</span> <span class="main">(</span>sin <span class="free">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Re <span class="main">(</span>exp <span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="keyword1">𝗂</span> <span class="main">*</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Re <span class="main">(</span><span class="main">(</span>cos <span class="free">x</span><span class="main">)</span> <span class="main">-</span> <span class="keyword1">𝗂</span> <span class="main">*</span> <span class="main">(</span>sin <span class="free">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Re_exp <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Im <span class="main">(</span>exp <span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="keyword1">𝗂</span> <span class="main">*</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Im <span class="main">(</span><span class="main">(</span>cos <span class="free">x</span><span class="main">)</span> <span class="main">-</span> <span class="keyword1">𝗂</span> <span class="main">*</span> <span class="main">(</span>sin <span class="free">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Im_exp <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Basic Results with Trigonometric Functions.›</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Basic Inequalities›</span></span>

<span class="keyword1" id="Basics-sin_squared_le_one"><span class="command">lemma</span></span> sin_squared_le_one<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span><span class="main">::</span> <span class="quoted">real</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>sin <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> abs_sin_le_one abs_square_le_1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Basics-cos_squared_le_one"><span class="command">lemma</span></span> cos_squared_le_one<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span><span class="main">::</span> <span class="quoted">real</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>cos <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> abs_cos_le_one abs_square_le_1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Basic Equalities›</span></span>

<span class="keyword1" id="Basics-sin_of_quarter_pi"><span class="command">lemma</span></span> sin_of_quarter_pi<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span><span class="main">::</span> <span class="quoted">real</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> pi<span class="main">/</span><span class="numeral">2</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"sin <span class="main">(</span><span class="free">x</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>sqrt <span class="numeral">2</span><span class="main">)</span><span class="main">/</span><span class="numeral">2</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms sin_45<span class="main">)</span>

<span class="keyword1" id="Basics-cos_of_quarter_pi"><span class="command">lemma</span></span> cos_of_quarter_pi<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span><span class="main">::</span> <span class="quoted">real</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> pi<span class="main">/</span><span class="numeral">2</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"cos <span class="main">(</span><span class="free">x</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>sqrt <span class="numeral">2</span><span class="main">)</span><span class="main">/</span><span class="numeral">2</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms cos_45<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="Binary_Nat">
<div class="head">
<h1>Theory Binary_Nat</h1>
</div>
<pre class="source"><span class="comment1">(* 
Authors: 
  Anthony Bordg, University of Cambridge, apdb3@cam.ac.uk 
  Hanna Lachnitt, TU Wien, lachnitt@student.tuwien.ac.at
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Binary Representation of Natural Numbers›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Binary_Nat
<span class="keyword2"><span class="keyword">imports</span></span>
  <a href="https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL/Nat.html">HOL.Nat</a>
  <a href="https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL/List.html">HOL.List</a>
  <a href="#Basics">Basics</a>
<span class="keyword2"><span class="keyword">begin</span></span> 


<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">bin_rep_aux</span><span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> nat <span class="main">⇒</span> nat list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">bin_rep_aux</span> <span class="main">0</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">=</span> <span class="main">[</span><span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">]</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">bin_rep_aux</span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">^</span><span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">#</span> <span class="free">bin_rep_aux</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">^</span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Binary_Nat-length_of_bin_rep_aux"><span class="command">lemma</span></span> length_of_bin_rep_aux<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">n</span> <span class="free">m</span><span class="main">::</span> <span class="quoted">nat</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">&lt;</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>bin_rep_aux <span class="free">n</span> <span class="free">m</span><span class="main">)</span> <span class="main">=</span> <span class="free">n</span><span class="main">+</span><span class="main">1</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">m</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>bin_rep_aux <span class="main">0</span> <span class="skolem">m</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span> <span class="main">+</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> a0<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">m</span><span class="main">.</span> <span class="bound">m</span> <span class="main">&lt;</span> <span class="numeral">2</span><span class="main">^</span><span class="skolem">n</span> <span class="main">⟹</span> length <span class="main">(</span>bin_rep_aux <span class="skolem">n</span> <span class="bound">m</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">&lt;</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>bin_rep_aux <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="skolem">m</span><span class="main">)</span> <span class="main">=</span> Suc <span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> a0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Binary_Nat-bin_rep_aux_neq_nil"><span class="command">lemma</span></span> bin_rep_aux_neq_nil<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">n</span> <span class="free">m</span><span class="main">::</span> <span class="quoted">nat</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"bin_rep_aux <span class="free">n</span> <span class="free">m</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> bin_rep_aux.simps <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> list.distinct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> old.nat.exhaust<span class="main">)</span>

<span class="keyword1" id="Binary_Nat-last_of_bin_rep_aux"><span class="command">lemma</span></span> last_of_bin_rep_aux<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">n</span> <span class="free">m</span><span class="main">::</span> <span class="quoted">nat</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">&lt;</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"last <span class="main">(</span>bin_rep_aux <span class="free">n</span> <span class="free">m</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">m</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">&lt;</span> <span class="numeral">2</span><span class="main">^</span><span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"last <span class="main">(</span>bin_rep_aux <span class="main">0</span> <span class="skolem">m</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> a0<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">m</span><span class="main">.</span> <span class="bound">m</span> <span class="main">&lt;</span> <span class="numeral">2</span><span class="main">^</span><span class="skolem">n</span> <span class="main">⟹</span> <span class="bound">m</span> <span class="main">≥</span> <span class="main">0</span> <span class="main">⟹</span> last <span class="main">(</span>bin_rep_aux <span class="skolem">n</span> <span class="bound">m</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">&lt;</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"last <span class="main">(</span>bin_rep_aux <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="skolem">m</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> bin_rep_aux_neq_nil <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Binary_Nat-mod_mod_power_cancel"><span class="command">lemma</span></span> mod_mod_power_cancel<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">m</span> <span class="free">n</span> <span class="free">p</span><span class="main">::</span> <span class="quoted">nat</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">≤</span> <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span> <span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">^</span><span class="free">m</span> <span class="main">=</span> <span class="free">p</span> <span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">^</span><span class="free">m</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dvd_power_le mod_mod_cancel<span class="main">)</span>
    
<span class="keyword1" id="Binary_Nat-bin_rep_aux_index"><span class="command">lemma</span></span> bin_rep_aux_index<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">n</span> <span class="free">m</span> <span class="free">i</span><span class="main">::</span> <span class="quoted">nat</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≥</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">&lt;</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≤</span> <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"bin_rep_aux <span class="free">n</span> <span class="free">m</span> <span class="main">!</span> <span class="free">i</span> <span class="main">=</span> <span class="main">(</span><span class="free">m</span> <span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="free">i</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="main">1</span><span class="main">-</span><span class="free">i</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">m</span></span> <span class="quoted"><span class="free">i</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> nat_induct_at_least<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> base
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">&lt;</span> <span class="numeral">2</span><span class="main">^</span><span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"bin_rep_aux <span class="main">1</span> <span class="skolem">m</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">=</span> <span class="skolem">m</span> <span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="skolem">i</span><span class="main">)</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="main">1</span><span class="main">-</span><span class="skolem">i</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> bin_rep_aux.simps
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> One_nat_def base.prems<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> diff_is_0_eq' diff_zero div_by_1 le_Suc_eq le_numeral_extra<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> 
nth_Cons' power_0 unique_euclidean_semiring_numeral_class.mod_less<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> a0<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">m</span> <span class="bound">i</span><span class="main">.</span> <span class="bound">m</span> <span class="main">&lt;</span> <span class="numeral">2</span><span class="main">^</span><span class="skolem">n</span> <span class="main">⟹</span> <span class="bound">m</span> <span class="main">≥</span> <span class="main">0</span> <span class="main">⟹</span> <span class="bound">i</span> <span class="main">≤</span> <span class="skolem">n</span> <span class="main">⟹</span> bin_rep_aux <span class="skolem">n</span> <span class="bound">m</span> <span class="main">!</span> <span class="bound">i</span> <span class="main">=</span> <span class="bound">m</span> <span class="keyword1">mod</span> <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span><span class="skolem">n</span><span class="main">-</span><span class="bound">i</span><span class="main">)</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="skolem">n</span><span class="main">-</span><span class="main">1</span><span class="main">-</span><span class="bound">i</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">&lt;</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≤</span> Suc <span class="skolem">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"bin_rep_aux <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="skolem">m</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">=</span> <span class="skolem">m</span> <span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span>Suc <span class="skolem">n</span> <span class="main">-</span> <span class="skolem">i</span><span class="main">)</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span>Suc <span class="skolem">n</span> <span class="main">-</span> <span class="main">1</span> <span class="main">-</span> <span class="skolem">i</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bin_rep_aux <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="skolem">m</span> <span class="main">=</span> <span class="skolem">m</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">^</span><span class="skolem">n</span> <span class="main">#</span> bin_rep_aux <span class="skolem">n</span> <span class="main">(</span><span class="skolem">m</span> <span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">^</span><span class="skolem">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> f0<span class="main">:</span><span class="quoted"><span class="quoted">"bin_rep_aux <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="skolem">m</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">m</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">^</span><span class="skolem">n</span> <span class="main">#</span> bin_rep_aux <span class="skolem">n</span> <span class="main">(</span><span class="skolem">m</span> <span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">^</span><span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">!</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bin_rep_aux <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="skolem">m</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">=</span> <span class="skolem">m</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">^</span><span class="skolem">n</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> f1<span class="main">:</span><span class="quoted"><span class="quoted">"bin_rep_aux <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="skolem">m</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">=</span> <span class="skolem">m</span> <span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span>Suc <span class="skolem">n</span> <span class="main">-</span> <span class="skolem">i</span><span class="main">)</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span>Suc <span class="skolem">n</span> <span class="main">-</span> <span class="main">1</span> <span class="main">-</span> <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span>Suc <span class="skolem">n</span> <span class="main">-</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">m</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> that a1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Suc.prems<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span>Suc <span class="skolem">n</span> <span class="main">-</span> <span class="skolem">i</span><span class="main">)</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span>Suc <span class="skolem">n</span> <span class="main">-</span> <span class="main">1</span> <span class="main">-</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">m</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">^</span><span class="skolem">n</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> that<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bin_rep_aux <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="skolem">m</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">=</span> bin_rep_aux <span class="skolem">n</span> <span class="main">(</span><span class="skolem">m</span> <span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">^</span><span class="skolem">n</span><span class="main">)</span> <span class="main">!</span> <span class="main">(</span><span class="skolem">i</span><span class="main">-</span><span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≥</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> that f0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> f2<span class="main">:</span><span class="quoted"><span class="quoted">"bin_rep_aux <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="skolem">m</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="skolem">m</span> <span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">^</span><span class="skolem">n</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="skolem">n</span> <span class="main">-</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="skolem">n</span> <span class="main">-</span> <span class="main">1</span> <span class="main">-</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≥</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> that a0 a1 a2 a3 Suc.prems<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> f3<span class="main">:</span><span class="quoted"><span class="quoted">"bin_rep_aux <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="skolem">m</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="skolem">m</span> <span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">^</span><span class="skolem">n</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span>Suc <span class="skolem">n</span> <span class="main">-</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span>Suc <span class="skolem">n</span> <span class="main">-</span> <span class="main">1</span> <span class="main">-</span> <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≥</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bin_rep_aux <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="skolem">m</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">=</span> <span class="skolem">m</span> <span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span>Suc <span class="skolem">n</span> <span class="main">-</span> <span class="skolem">i</span><span class="main">)</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span>Suc <span class="skolem">n</span> <span class="main">-</span> <span class="main">1</span> <span class="main">-</span> <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≥</span> <span class="main">1</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">n</span> <span class="main">-</span> <span class="skolem">i</span> <span class="main">≤</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">^</span><span class="skolem">n</span> <span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span>Suc <span class="skolem">n</span> <span class="main">-</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">m</span> <span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span>Suc <span class="skolem">n</span> <span class="main">-</span> <span class="skolem">i</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> mod_mod_power_cancel<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">n</span> <span class="main">-</span> <span class="skolem">i</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
        <span class="keyword1"><span class="command">using</span></span> that f3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> f1 f2
      <span class="keyword1"><span class="command">using</span></span> linorder_not_less <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Binary_Nat-bin_rep_aux_coeff"><span class="command">lemma</span></span> bin_rep_aux_coeff<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">n</span> <span class="free">m</span> <span class="free">i</span><span class="main">::</span> <span class="quoted">nat</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">&lt;</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≤</span> <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"bin_rep_aux <span class="free">n</span> <span class="free">m</span> <span class="main">!</span> <span class="free">i</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> bin_rep_aux <span class="free">n</span> <span class="free">m</span> <span class="main">!</span> <span class="free">i</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">m</span></span> <span class="quoted"><span class="free">i</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">&lt;</span> <span class="numeral">2</span><span class="main">^</span><span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≤</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"bin_rep_aux <span class="main">0</span> <span class="skolem">m</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> bin_rep_aux <span class="main">0</span> <span class="skolem">m</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> a0<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">m</span> <span class="bound">i</span><span class="main">.</span> <span class="bound">m</span> <span class="main">&lt;</span> <span class="numeral">2</span> <span class="main">^</span> <span class="skolem">n</span> <span class="main">⟹</span> <span class="bound">i</span> <span class="main">≤</span> <span class="skolem">n</span> <span class="main">⟹</span> <span class="bound">m</span> <span class="main">≥</span> <span class="main">0</span> <span class="main">⟹</span> bin_rep_aux <span class="skolem">n</span> <span class="bound">m</span> <span class="main">!</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> bin_rep_aux <span class="skolem">n</span> <span class="bound">m</span> <span class="main">!</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">1</span>"</span></span> 
<span class="keyword2"><span class="keyword">and</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">&lt;</span> <span class="numeral">2</span><span class="main">^</span>Suc <span class="skolem">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≤</span> Suc <span class="skolem">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"bin_rep_aux <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="skolem">m</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> bin_rep_aux <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="skolem">m</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bin_rep_aux <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="skolem">m</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">m</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">^</span><span class="skolem">n</span> <span class="main">#</span> bin_rep_aux <span class="skolem">n</span> <span class="main">(</span><span class="skolem">m</span> <span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">^</span><span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">!</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> bin_rep_aux <span class="skolem">n</span> <span class="main">(</span><span class="skolem">m</span> <span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">^</span><span class="skolem">n</span><span class="main">)</span> <span class="main">!</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≥</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">^</span><span class="skolem">n</span> <span class="main">&lt;</span> <span class="numeral">2</span><span class="main">^</span><span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bin_rep_aux <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="skolem">m</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> bin_rep_aux <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="skolem">m</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span><span class="main">≥</span><span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> that a0<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">^</span><span class="skolem">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span><span class="main">-</span><span class="main">1</span>"</span></span><span class="main">]</span> a2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">^</span><span class="skolem">n</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="skolem">m</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">^</span><span class="skolem">n</span> <span class="main">=</span> <span class="main">1</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> a1 a3 less_mult_imp_div_less <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_2_cases<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nth_Cons'<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">bin_rep</span><span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> nat <span class="main">⇒</span> nat list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">bin_rep</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">=</span> butlast <span class="main">(</span>bin_rep_aux <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Binary_Nat-length_of_bin_rep"><span class="command">lemma</span></span> length_of_bin_rep<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">n</span> <span class="free">m</span><span class="main">::</span> <span class="quoted">nat</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">&lt;</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>bin_rep <span class="free">n</span> <span class="free">m</span><span class="main">)</span> <span class="main">=</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms length_of_bin_rep_aux bin_rep_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Binary_Nat-bin_rep_coeff"><span class="command">lemma</span></span> bin_rep_coeff<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">n</span> <span class="free">m</span> <span class="free">i</span><span class="main">::</span> <span class="quoted">nat</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">&lt;</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"bin_rep <span class="free">n</span> <span class="free">m</span> <span class="main">!</span> <span class="free">i</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> bin_rep <span class="free">n</span> <span class="free">m</span> <span class="main">!</span> <span class="free">i</span> <span class="main">=</span> <span class="main">1</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> assms bin_rep_def bin_rep_aux_coeff length_of_bin_rep <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nth_butlast<span class="main">)</span>

<span class="keyword1" id="Binary_Nat-bin_rep_index"><span class="command">lemma</span></span> bin_rep_index<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">n</span> <span class="free">m</span> <span class="free">i</span><span class="main">::</span> <span class="quoted">nat</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≥</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">&lt;</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"bin_rep <span class="free">n</span> <span class="free">m</span> <span class="main">!</span> <span class="free">i</span> <span class="main">=</span> <span class="main">(</span><span class="free">m</span> <span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="free">i</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="main">1</span><span class="main">-</span><span class="free">i</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bin_rep <span class="free">n</span> <span class="free">m</span> <span class="main">!</span> <span class="free">i</span> <span class="main">=</span> bin_rep_aux <span class="free">n</span> <span class="free">m</span> <span class="main">!</span> <span class="free">i</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> bin_rep_def length_of_bin_rep nth_butlast assms<span class="main">(</span>3<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nth_butlast assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms bin_rep_aux_index <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Binary_Nat-bin_rep_eq"><span class="command">lemma</span></span> bin_rep_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">n</span> <span class="free">m</span><span class="main">::</span> <span class="quoted">nat</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≥</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">&lt;</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> bin_rep <span class="free">n</span> <span class="free">m</span> <span class="main">!</span> <span class="bound">i</span> <span class="main">*</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="main">1</span><span class="main">-</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span><span class="main">::</span> <span class="quoted">nat</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bin_rep <span class="free">n</span> <span class="free">m</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">*</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="main">1</span><span class="main">-</span><span class="skolem">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">m</span> <span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="main">1</span><span class="main">-</span><span class="skolem">i</span><span class="main">)</span> <span class="main">*</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="main">1</span><span class="main">-</span><span class="skolem">i</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms bin_rep_index <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">m</span> <span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="skolem">i</span><span class="main">)</span> <span class="main">-</span> <span class="free">m</span> <span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="skolem">i</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="main">1</span><span class="main">-</span><span class="skolem">i</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> minus_mod_eq_div_mult<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> int<span class="main">(</span><span class="free">m</span> <span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="free">m</span> <span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="skolem">i</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="main">1</span><span class="main">-</span><span class="skolem">i</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> mod_less_eq_dividend of_nat_diff <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> int<span class="main">(</span><span class="free">m</span> <span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="free">m</span> <span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="main">1</span><span class="main">-</span><span class="skolem">i</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> mod_mod_power_cancel<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">n</span><span class="main">-</span><span class="main">1</span><span class="main">-</span><span class="skolem">i</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span><span class="main">-</span><span class="skolem">i</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dvd_power_le mod_mod_cancel<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bin_rep <span class="free">n</span> <span class="free">m</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">*</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="main">1</span><span class="main">-</span><span class="skolem">i</span><span class="main">)</span> <span class="main">=</span> int <span class="main">(</span><span class="free">m</span> <span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="free">m</span> <span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="main">1</span><span class="main">-</span><span class="skolem">i</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> f0<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> bin_rep <span class="free">n</span> <span class="free">m</span> <span class="main">!</span> <span class="bound">i</span> <span class="main">*</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="main">1</span><span class="main">-</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> int <span class="main">(</span><span class="free">m</span> <span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="free">m</span> <span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="main">1</span><span class="main">-</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
     <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> int <span class="main">(</span><span class="main">(</span><span class="free">m</span><span class="main">::</span>nat<span class="main">)</span> <span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="free">m</span> <span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="main">1</span> <span class="main">-</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
          <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> <span class="main">(</span> <span class="free">m</span> <span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span>  <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> int <span class="main">(</span><span class="free">m</span> <span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="main">1</span> <span class="main">-</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> sum_subtractf<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="free">m</span> <span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">::</span>nat<span class="main">⇒</span>nat"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="free">m</span> <span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="main">1</span><span class="main">-</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">::</span>nat<span class="main">⇒</span>nat"</span></span> <span class="quoted"><span class="quoted">"<span class="main">{..&lt;</span><span class="main">(</span><span class="free">n</span><span class="main">::</span>nat<span class="main">)</span><span class="main">}</span>"</span></span><span class="main">]</span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">m</span> <span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="main">{</span><span class="main">1</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="free">m</span> <span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="free">n</span><span class="main">-</span><span class="main">1</span><span class="main">.</span> int <span class="main">(</span><span class="free">m</span> <span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="main">1</span><span class="main">-</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">-</span> <span class="free">m</span> <span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">^</span><span class="main">0</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> sum.atLeast_Suc_atMost sum.lessThan_Suc assms<span class="main">(</span>1<span class="main">)</span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> One_nat_def Suc_le_eq diff_self_eq_0 le_add_diff_inverse lessThan_atLeast0 minus_nat.diff_0 
          plus_1_eq_Suc sum.atLeast_Suc_lessThan<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">m</span> <span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="free">n</span><span class="main">-</span><span class="main">1</span><span class="main">.</span> <span class="free">m</span> <span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="bound">i</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="free">n</span><span class="main">-</span><span class="main">1</span><span class="main">.</span> int <span class="main">(</span> <span class="free">m</span> <span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="main">1</span><span class="main">-</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="free">m</span> <span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">^</span><span class="main">0</span>"</span></span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_of_index_diff<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="free">m</span> <span class="keyword1">mod</span> <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="main">1</span> <span class="main">-</span> <span class="bound">i</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span><span class="main">-</span><span class="main">1</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> One_nat_def assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> le_add_diff_inverse lessThan_atLeast0 plus_1_eq_Suc sum.cong sum.shift_bounds_Suc_ivl<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">m</span> <span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span> <span class="main">-</span> <span class="free">m</span> <span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">^</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">m</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> bin_rep <span class="free">n</span> <span class="free">m</span> <span class="main">!</span> <span class="bound">i</span> <span class="main">*</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="main">1</span><span class="main">-</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms f0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Binary_Nat-bin_rep_index_0"><span class="command">lemma</span></span> bin_rep_index_0<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">n</span> <span class="free">m</span><span class="main">::</span> <span class="quoted">nat</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">&lt;</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">&gt;</span> <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>bin_rep <span class="free">k</span> <span class="free">m</span><span class="main">)</span> <span class="main">!</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">&lt;</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">k</span><span class="main">-</span><span class="main">1</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">smt</span> Suc_diff_1 Suc_leI gr0I le_trans less_or_eq_imp_le linorder_neqE_nat not_less 
one_less_numeral_iff power_strict_increasing semiring_norm<span class="main"><span class="main">(</span></span>76<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> f<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">k</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">≥</span> <span class="main">1</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bin_rep_aux <span class="free">k</span> <span class="free">m</span> <span class="main">=</span> <span class="main">(</span><span class="free">m</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">k</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">#</span> <span class="main">(</span>bin_rep_aux <span class="main">(</span><span class="free">k</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">(</span><span class="free">m</span> <span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">k</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> bin_rep_aux.simps<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">metis</span> Suc_diff_1 assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> diff_0_eq_0 neq0_conv zero_less_diff<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bin_rep <span class="free">k</span> <span class="free">m</span> <span class="main">=</span> butlast <span class="main">(</span><span class="main">(</span><span class="free">m</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">k</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">#</span> <span class="main">(</span>bin_rep_aux <span class="main">(</span><span class="free">k</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">(</span><span class="free">m</span> <span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">k</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> bin_rep_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> calculation<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> butlast <span class="main">(</span><span class="main">0</span> <span class="main">#</span> <span class="main">(</span>bin_rep_aux <span class="main">(</span><span class="free">k</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">(</span><span class="free">m</span> <span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">k</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> f <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">0</span> <span class="main">#</span> butlast <span class="main">(</span>bin_rep_aux <span class="main">(</span><span class="free">k</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">(</span><span class="free">m</span> <span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">k</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bin_rep_aux_neq_nil<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Binary_Nat-bin_rep_index_0_geq"><span class="command">lemma</span></span> bin_rep_index_0_geq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">n</span> <span class="free">m</span><span class="main">::</span> <span class="quoted">nat</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">≥</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">&lt;</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"bin_rep <span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="free">m</span> <span class="main">!</span> <span class="main">0</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bin_rep <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="free">m</span> <span class="main">=</span>  butlast <span class="main">(</span>bin_rep_aux <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="free">m</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> bin_rep_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> butlast <span class="main">(</span><span class="main">1</span> <span class="main">#</span> <span class="main">(</span>bin_rep_aux <span class="free">n</span> <span class="main">(</span><span class="free">m</span> <span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms bin_rep_aux_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">1</span> <span class="main">#</span> butlast <span class="main">(</span>bin_rep_aux <span class="free">n</span> <span class="main">(</span><span class="free">m</span> <span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bin_rep_aux_neq_nil<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bin_rep_aux_neq_nil<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="Quantum">
<div class="head">
<h1>Theory Quantum</h1>
</div>
<pre class="source"><span class="comment1">(*
Authors: 

  Anthony Bordg, University of Cambridge, apdb3@cam.ac.uk
  Yijun He, University of Cambridge, yh403@cam.ac.uk
  with contributions by Hanna Lachnitt
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Qubits and Quantum Gates›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Quantum
<span class="keyword2"><span class="keyword">imports</span></span>
  <a href="../../jordan_normal_form/theories/#Matrix">Jordan_Normal_Form.Matrix</a>
  <span class="quoted">"<a href="https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL-Library/Nonpos_Ints.html">HOL-Library.Nonpos_Ints</a>"</span>
  <a href="#Basics">Basics</a>
  <a href="#Binary_Nat">Binary_Nat</a>
<span class="keyword2"><span class="keyword">begin</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Qubits›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹In this theory <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">cpx</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> stands for <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">complex</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">cpx_vec_length</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"complex vec <span class="main">⇒</span> real"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">∥</span>_<span class="keyword1">∥</span>"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">cpx_vec_length</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">≡</span> sqrt<span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span>dim_vec <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">.</span> <span class="main">(</span>cmod <span class="main">(</span><span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">$</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Quantum-cpx_length_of_vec_of_list"><span class="command">lemma</span></span> cpx_length_of_vec_of_list <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">∥</span>vec_of_list <span class="free">l</span><span class="main">∥</span> <span class="main">=</span> sqrt<span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span>length <span class="free">l</span><span class="main">.</span> <span class="main">(</span>cmod <span class="main">(</span><span class="free">l</span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> cpx_vec_length_def vec_of_list_def vec_of_list_index<span class="main">)</span>
    <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> dim_vec_of_list sum.cong vec_of_list.abs_eq vec_of_list_index<span class="main">)</span>

<span class="keyword1" id="Quantum-norm_vec_index_unit_vec_is_0"><span class="command">lemma</span></span> norm_vec_index_unit_vec_is_0 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">≠</span> <span class="free">i</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"cmod <span class="main">(</span><span class="main">(</span>unit_vec <span class="free">n</span> <span class="free">i</span><span class="main">)</span> <span class="main">$</span> <span class="free">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> unit_vec_def<span class="main">)</span>

<span class="keyword1" id="Quantum-norm_vec_index_unit_vec_is_1"><span class="command">lemma</span></span> norm_vec_index_unit_vec_is_1 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">=</span> <span class="free">i</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"cmod <span class="main">(</span><span class="main">(</span>unit_vec <span class="free">n</span> <span class="free">i</span><span class="main">)</span> <span class="main">$</span> <span class="free">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> f<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>unit_vec <span class="free">n</span> <span class="free">i</span><span class="main">)</span> <span class="main">$</span> <span class="free">j</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f cmod_def<span class="main">)</span> 
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Quantum-unit_cpx_vec_length"><span class="command">lemma</span></span> unit_cpx_vec_length <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∥</span>unit_vec <span class="free">n</span> <span class="free">i</span><span class="main">∥</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> <span class="main">(</span>cmod<span class="main">(</span><span class="main">(</span>unit_vec <span class="free">n</span> <span class="free">i</span><span class="main">)</span> <span class="main">$</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">j</span> <span class="main">=</span> <span class="free">i</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> norm_vec_index_unit_vec_is_0 norm_vec_index_unit_vec_is_1
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> lessThan_iff one_power2 sum.cong zero_power2<span class="main">)</span> 
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sqrt <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> <span class="main">(</span>cmod<span class="main">(</span><span class="main">(</span>unit_vec <span class="free">n</span> <span class="free">i</span><span class="main">)</span> <span class="main">$</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> cpx_vec_length_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Quantum-smult_vec_length"><span class="command">lemma</span></span> smult_vec_length <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∥</span>complex_of_real<span class="main">(</span><span class="free">x</span><span class="main">)</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">v</span><span class="main">∥</span> <span class="main">=</span> <span class="free">x</span> <span class="main">*</span> <span class="main">∥</span><span class="free">v</span><span class="main">∥</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">::</span>nat<span class="main">.</span><span class="main">(</span>cmod <span class="main">(</span>complex_of_real <span class="free">x</span> <span class="main">*</span> <span class="free">v</span> <span class="main">$</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">::</span>nat<span class="main">.</span> <span class="main">(</span>cmod <span class="main">(</span><span class="free">v</span> <span class="main">$</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> norm_mult power_mult_distrib<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span>dim_vec <span class="free">v</span><span class="main">.</span> <span class="main">(</span>cmod <span class="main">(</span>complex_of_real <span class="free">x</span> <span class="main">*</span> <span class="free">v</span> <span class="main">$</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">=</span> 
             <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span>dim_vec <span class="free">v</span><span class="main">.</span> <span class="main">(</span>cmod <span class="main">(</span><span class="free">v</span> <span class="main">$</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">meson</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span>dim_vec <span class="free">v</span><span class="main">.</span> <span class="main">(</span>cmod <span class="main">(</span><span class="free">v</span> <span class="main">$</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">*</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span>dim_vec <span class="free">v</span><span class="main">.</span> <span class="main">(</span>cmod <span class="main">(</span><span class="free">v</span> <span class="main">$</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> mult.commute sum_distrib_right<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sqrt<span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">*</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span>dim_vec <span class="free">v</span><span class="main">.</span> <span class="main">(</span>cmod <span class="main">(</span><span class="free">v</span> <span class="main">$</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
                 sqrt<span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">*</span> sqrt <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span>dim_vec <span class="free">v</span><span class="main">.</span> <span class="main">(</span>cmod <span class="main">(</span><span class="free">v</span> <span class="main">$</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> real_sqrt_mult <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cpx_vec_length_def assms<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">locale</span></span> state <span class="main">=</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">n</span><span class="main">::</span> <span class="quoted">nat</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">v</span><span class="main">::</span> <span class="quoted"><span class="quoted">"complex mat"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> is_column <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"dim_col <span class="free">v</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> dim_row <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"dim_row <span class="free">v</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> is_normal <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∥</span>col <span class="free">v</span> <span class="main">0</span><span class="main">∥</span> <span class="main">=</span> <span class="main">1</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹ 
Below the natural number n codes for the dimension of the complex vector space whose elements of norm
1 we call states. 
›</span></span>

<span class="keyword1" id="Quantum-unit_vec_of_right_length_is_state"><span class="command">lemma</span></span> unit_vec_of_right_length_is_state <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"unit_vec <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">)</span> <span class="free">i</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">v</span><span class="main">|</span> <span class="bound">n</span> <span class="bound">v</span><span class="main">::</span>complex vec<span class="main">.</span> dim_vec <span class="bound">v</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">^</span><span class="bound">n</span> <span class="main">∧</span> <span class="main">∥</span><span class="bound">v</span><span class="main">∥</span> <span class="main">=</span> <span class="main">1</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"dim_vec <span class="main">(</span>unit_vec <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">)</span> <span class="free">i</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∥</span>unit_vec <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">)</span> <span class="free">i</span><span class="main">∥</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">state_qbit</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> complex vec set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">state_qbit</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">≡</span> <span class="main">{</span><span class="bound">v</span><span class="main">|</span> <span class="bound">v</span><span class="main">::</span> complex vec<span class="main">.</span> dim_vec <span class="bound">v</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">^</span><span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">∧</span> <span class="main">∥</span><span class="bound">v</span><span class="main">∥</span> <span class="main">=</span> <span class="main">1</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> state<span class="main">)</span> state_to_state_qbit <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"col <span class="free">v</span> <span class="main">0</span> <span class="main">∈</span> state_qbit <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> state_def state_qbit_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"The Hermitian Conjugation"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The Hermitian conjugate of a complex matrix is the complex conjugate of its transpose. ›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">dagger</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"complex mat <span class="main">⇒</span> complex mat"</span></span> <span class="main">(</span><span class="quoted">"_<span class="keyword1"><span class="hidden">⇧</span><sup>†</sup></span>"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">M</span></span></span><span class="main"><span class="free"><span class="hidden">⇧</span><sup>†</sup></span></span> <span class="main">≡</span> mat <span class="main">(</span>dim_col <span class="free"><span class="bound"><span class="entity">M</span></span></span><span class="main">)</span> <span class="main">(</span>dim_row <span class="free"><span class="bound"><span class="entity">M</span></span></span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span><span class="main">.</span> cnj<span class="main">(</span><span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="main">$$</span> <span class="main">(</span><span class="bound">j</span><span class="main">,</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We introduce the type of complex square matrices.›</span></span>

<span class="keyword1"><span class="command">typedef</span></span> cpx_sqr_mat <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">M</span> <span class="main">|</span> <span class="bound">M</span><span class="main">::</span>complex mat<span class="main">.</span> square_mat <span class="bound">M</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"square_mat <span class="main">(</span><span class="keyword1">1<span class="hidden">⇩</span><sub>m</sub></span> <span class="skolem">n</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
    <span class="keyword1"><span class="command">using</span></span> one_mat_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">cpx_sqr_mat_to_cpx_mat</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"cpx_sqr_mat <span class="main">=&gt;</span> complex mat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">cpx_sqr_mat_to_cpx_mat</span> <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="main">≡</span> Rep_cpx_sqr_mat <span class="free"><span class="bound"><span class="entity">M</span></span></span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
We introduce a coercion from the type of complex square matrices to the type of complex 
matrices.
›</span></span>

<span class="keyword1"><span class="command">declare</span></span> <span class="main">[</span><span class="main">[</span><span class="operator">coercion</span> <span class="quoted">cpx_sqr_mat_to_cpx_mat</span><span class="main">]</span><span class="main">]</span>

<span class="keyword1" id="Quantum-dim_row_of_dagger"><span class="command">lemma</span></span> dim_row_of_dagger <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"dim_row <span class="main">(</span><span class="free">M</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span><span class="main">)</span> <span class="main">=</span> dim_col <span class="free">M</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> dagger_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Quantum-dim_col_of_dagger"><span class="command">lemma</span></span> dim_col_of_dagger <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"dim_col <span class="main">(</span><span class="free">M</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span><span class="main">)</span> <span class="main">=</span> dim_row <span class="free">M</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> dagger_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Quantum-col_of_dagger"><span class="command">lemma</span></span> col_of_dagger <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">&lt;</span> dim_row <span class="free">M</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"col <span class="main">(</span><span class="free">M</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span><span class="main">)</span> <span class="free">j</span> <span class="main">=</span> vec <span class="main">(</span>dim_col <span class="free">M</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> cnj <span class="main">(</span><span class="free">M</span> <span class="main">$$</span> <span class="main">(</span><span class="free">j</span><span class="main">,</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms col_def dagger_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Quantum-row_of_dagger"><span class="command">lemma</span></span> row_of_dagger <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> dim_col <span class="free">M</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"row <span class="main">(</span><span class="free">M</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span><span class="main">)</span> <span class="free">i</span> <span class="main">=</span> vec <span class="main">(</span>dim_row <span class="free">M</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">j</span><span class="main">.</span> cnj <span class="main">(</span><span class="free">M</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">j</span><span class="main">,</span><span class="free">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms row_def dagger_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Quantum-dagger_of_dagger_is_id"><span class="command">lemma</span></span> dagger_of_dagger_is_id<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">M</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"complex Matrix.mat"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">M</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span> <span class="main">=</span> <span class="free">M</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_row <span class="main">(</span><span class="main">(</span><span class="free">M</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span><span class="main">)</span> <span class="main">=</span> dim_row <span class="free">M</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_col <span class="main">(</span><span class="main">(</span><span class="free">M</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span><span class="main">)</span> <span class="main">=</span> dim_col <span class="free">M</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span> <span class="keyword3"><span class="command">assume</span></span> a0<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> dim_row <span class="free">M</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> dim_col <span class="free">M</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">M</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="free">M</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> dagger_def a0 a1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Quantum-dagger_of_sqr_is_sqr"><span class="command">lemma</span></span> dagger_of_sqr_is_sqr <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"square_mat <span class="main">(</span><span class="main">(</span><span class="free">M</span><span class="main">::</span>cpx_sqr_mat<span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"square_mat <span class="free">M</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> cpx_sqr_mat_to_cpx_mat_def Rep_cpx_sqr_mat <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"dim_row <span class="free">M</span> <span class="main">=</span> dim_col <span class="free">M</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"dim_col <span class="main">(</span><span class="free">M</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span><span class="main">)</span> <span class="main">=</span> dim_row <span class="main">(</span><span class="free">M</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"square_mat <span class="main">(</span><span class="free">M</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Quantum-dagger_of_id_is_id"><span class="command">lemma</span></span> dagger_of_id_is_id <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">1<span class="hidden">⇩</span><sub>m</sub></span> <span class="free">n</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span> <span class="main">=</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>m</sub></span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> dagger_def one_mat_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Unitary Matrices and Quantum Gates"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">unitary</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"complex mat <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">unitary</span> <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">M</span></span></span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span><span class="main">)</span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="main">=</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>m</sub></span> <span class="main">(</span>dim_col <span class="free"><span class="bound"><span class="entity">M</span></span></span><span class="main">)</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="main">*</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">M</span></span></span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>m</sub></span> <span class="main">(</span>dim_row <span class="free"><span class="bound"><span class="entity">M</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Quantum-id_is_unitary"><span class="command">lemma</span></span> id_is_unitary <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"unitary <span class="main">(</span><span class="keyword1">1<span class="hidden">⇩</span><sub>m</sub></span> <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> unitary_def<span class="main">)</span>

<span class="keyword1"><span class="command">locale</span></span> gate <span class="main">=</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">n</span><span class="main">::</span> <span class="quoted">nat</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">A</span><span class="main">::</span> <span class="quoted"><span class="quoted">"complex mat"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> dim_row <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"dim_row <span class="free">A</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> square_mat <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"square_mat <span class="free">A</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> unitary <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"unitary <span class="free">A</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
We prove that a quantum gate is invertible and its inverse is given by its Hermitian conjugate.
›</span></span>

<span class="keyword1" id="Quantum-mat_unitary_mat"><span class="command">lemma</span></span> mat_unitary_mat <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"unitary <span class="free">M</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"inverts_mat <span class="free">M</span> <span class="main">(</span><span class="free">M</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> unitary_def inverts_mat_def<span class="main">)</span>

<span class="keyword1" id="Quantum-unitary_mat_mat"><span class="command">lemma</span></span> unitary_mat_mat <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"unitary <span class="free">M</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"inverts_mat <span class="main">(</span><span class="free">M</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span><span class="main">)</span> <span class="free">M</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> unitary_def inverts_mat_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> gate<span class="main">)</span> gate_is_inv<span class="main">:</span>
  <span class="quoted"><span class="quoted">"invertible_mat <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> square_mat unitary invertible_mat_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Relations Between Complex Conjugation, Hermitian Conjugation, Transposition and Unitarity"</span></span>

<span class="keyword1"><span class="command">notation</span></span> transpose_mat <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span>_<span class="keyword1"><span class="hidden">⇧</span><sup>t</sup></span><span class="keyword3">)</span>"</span><span class="main">)</span>

<span class="keyword1" id="Quantum-col_tranpose"><span class="command">lemma</span></span> col_tranpose <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"dim_row <span class="free">M</span> <span class="main">=</span> <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"col <span class="main">(</span><span class="free">M</span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup></span><span class="main">)</span> <span class="free">i</span> <span class="main">=</span> row <span class="free">M</span> <span class="free">i</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_vec <span class="main">(</span>col <span class="main">(</span><span class="free">M</span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup></span><span class="main">)</span> <span class="free">i</span><span class="main">)</span> <span class="main">=</span> dim_vec <span class="main">(</span>row <span class="free">M</span> <span class="free">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> row_def col_def transpose_mat_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">j</span><span class="main">.</span> <span class="bound">j</span> <span class="main">&lt;</span> dim_vec <span class="main">(</span>row <span class="free">M</span> <span class="free">i</span><span class="main">)</span> <span class="main">⟹</span> col <span class="free">M</span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup></span> <span class="free">i</span> <span class="main">$</span> <span class="bound">j</span> <span class="main">=</span> row <span class="free">M</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">j</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> transpose_mat_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Quantum-row_transpose"><span class="command">lemma</span></span> row_transpose <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"dim_col <span class="free">M</span> <span class="main">=</span> <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"row <span class="main">(</span><span class="free">M</span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup></span><span class="main">)</span> <span class="free">i</span> <span class="main">=</span> col <span class="free">M</span> <span class="free">i</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">cpx_mat_cnj</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"complex mat <span class="main">⇒</span> complex mat"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span>_<span class="keyword1"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="keyword3">)</span>"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">cpx_mat_cnj</span> <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="main">≡</span> mat <span class="main">(</span>dim_row <span class="free"><span class="bound"><span class="entity">M</span></span></span><span class="main">)</span> <span class="main">(</span>dim_col <span class="free"><span class="bound"><span class="entity">M</span></span></span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span><span class="main">.</span> cnj <span class="main">(</span><span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="main">$$</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Quantum-cpx_mat_cnj_id"><span class="command">lemma</span></span> cpx_mat_cnj_id <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">1<span class="hidden">⇩</span><sub>m</sub></span> <span class="free">n</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>m</sub></span> <span class="free">n</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> cpx_mat_cnj_def<span class="main">)</span>

<span class="keyword1" id="Quantum-cpx_mat_cnj_cnj"><span class="command">lemma</span></span> cpx_mat_cnj_cnj <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">M</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="free">M</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> cpx_mat_cnj_def<span class="main">)</span>

<span class="keyword1" id="Quantum-dim_row_of_cjn_prod"><span class="command">lemma</span></span> dim_row_of_cjn_prod <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"dim_row <span class="main">(</span><span class="main">(</span><span class="free">M</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">N</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> dim_row <span class="free">M</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cpx_mat_cnj_def<span class="main">)</span>

<span class="keyword1" id="Quantum-dim_col_of_cjn_prod"><span class="command">lemma</span></span> dim_col_of_cjn_prod <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"dim_col <span class="main">(</span><span class="main">(</span><span class="free">M</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">N</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> dim_col <span class="free">N</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cpx_mat_cnj_def<span class="main">)</span>

<span class="keyword1" id="Quantum-cpx_mat_cnj_prod"><span class="command">lemma</span></span> cpx_mat_cnj_prod<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"dim_col <span class="free">M</span> <span class="main">=</span> dim_row <span class="free">N</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">M</span> <span class="main">*</span> <span class="free">N</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="main">(</span><span class="free">M</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">N</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_row <span class="main">(</span><span class="free">M</span> <span class="main">*</span> <span class="free">N</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> dim_row <span class="main">(</span><span class="main">(</span><span class="free">M</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">N</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cpx_mat_cnj_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_col <span class="main">(</span><span class="main">(</span><span class="free">M</span> <span class="main">*</span> <span class="free">N</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span> <span class="main">=</span> dim_col <span class="main">(</span><span class="main">(</span><span class="free">M</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">N</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cpx_mat_cnj_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span> 
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span><span class="main">::</span><span class="quoted">nat</span>
  <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> dim_row <span class="main">(</span><span class="main">(</span><span class="free">M</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">N</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> dim_col <span class="main">(</span><span class="main">(</span><span class="free">M</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">N</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">M</span> <span class="main">*</span> <span class="free">N</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> cnj <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">&lt;</span><span class="main">(</span>dim_row <span class="free">N</span><span class="main">)</span><span class="main">.</span> <span class="free">M</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span> <span class="main">*</span> <span class="free">N</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms cpx_mat_cnj_def index_mat times_mat_def scalar_prod_def row_def col_def 
dim_row_of_cjn_prod dim_col_of_cjn_prod
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> case_prod_conv dim_col index_mult_mat<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> index_mult_mat<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> index_vec lessThan_atLeast0 
        lessThan_iff sum.cong<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">&lt;</span><span class="main">(</span>dim_row <span class="free">N</span><span class="main">)</span><span class="main">.</span> cnj<span class="main">(</span><span class="free">M</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> cnj<span class="main">(</span><span class="free">N</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">M</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">N</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> 
    <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">&lt;</span><span class="main">(</span>dim_row <span class="free">N</span><span class="main">)</span><span class="main">.</span> cnj<span class="main">(</span><span class="free">M</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> cnj<span class="main">(</span><span class="free">N</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms a1 a2 cpx_mat_cnj_def index_mat times_mat_def scalar_prod_def row_def col_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> case_prod_conv dim_col dim_col_mat<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> dim_row_mat<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> index_vec lessThan_atLeast0 
        lessThan_iff sum.cong<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">M</span> <span class="main">*</span> <span class="free">N</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">M</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">N</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Quantum-transpose_of_prod"><span class="command">lemma</span></span> transpose_of_prod<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">M</span> <span class="free">N</span><span class="main">::</span><span class="quoted"><span class="quoted">"complex Matrix.mat"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"dim_col <span class="free">M</span> <span class="main">=</span> dim_row <span class="free">N</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">M</span> <span class="main">*</span> <span class="free">N</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup></span> <span class="main">=</span> <span class="free">N</span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">M</span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span><span class="main">::</span><span class="quoted">nat</span>
  <span class="keyword3"><span class="command">assume</span></span> a0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> dim_row <span class="main">(</span><span class="free">N</span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">M</span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup></span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> dim_col <span class="main">(</span><span class="free">N</span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">M</span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup></span><span class="main">)</span><span class="main">)</span>"</span></span>  
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">M</span> <span class="main">*</span> <span class="free">N</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup></span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">M</span> <span class="main">*</span> <span class="free">N</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">j</span><span class="main">,</span><span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">&lt;</span>dim_row <span class="free">M</span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup></span><span class="main">.</span>  <span class="free">M</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">j</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span> <span class="main">*</span> <span class="free">N</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="skolem">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms a0 a1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">&lt;</span>dim_row <span class="free">M</span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup></span><span class="main">.</span> <span class="free">N</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="skolem">i</span><span class="main">)</span> <span class="main">*</span> <span class="free">M</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">j</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> semiring_normalization_rules<span class="main"><span class="main">(</span></span>7<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">&lt;</span>dim_row <span class="free">M</span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup></span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="free">N</span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup></span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">M</span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup></span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms a0 a1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">M</span> <span class="main">*</span> <span class="free">N</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup></span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">N</span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">M</span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup></span><span class="main">)</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms a0 a1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_row <span class="main">(</span><span class="main">(</span><span class="free">M</span> <span class="main">*</span> <span class="free">N</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup></span><span class="main">)</span> <span class="main">=</span> dim_row <span class="main">(</span><span class="free">N</span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">M</span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup></span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_col <span class="main">(</span><span class="main">(</span><span class="free">M</span> <span class="main">*</span> <span class="free">N</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup></span><span class="main">)</span> <span class="main">=</span> dim_col <span class="main">(</span><span class="free">N</span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">M</span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup></span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Quantum-transpose_cnj_is_dagger"><span class="command">lemma</span></span> transpose_cnj_is_dagger <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">M</span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="main">(</span><span class="free">M</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> f1<span class="main">:</span><span class="quoted"><span class="quoted">"dim_row <span class="main">(</span><span class="main">(</span><span class="free">M</span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span> <span class="main">=</span> dim_row <span class="main">(</span><span class="free">M</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cpx_mat_cnj_def transpose_mat_def dagger_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> f2<span class="main">:</span><span class="quoted"><span class="quoted">"dim_col <span class="main">(</span><span class="main">(</span><span class="free">M</span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span> <span class="main">=</span> dim_col <span class="main">(</span><span class="free">M</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cpx_mat_cnj_def transpose_mat_def dagger_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span><span class="main">::</span><span class="quoted">nat</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> dim_row <span class="free">M</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> dim_col <span class="free">M</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">M</span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="free">M</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cpx_mat_cnj_def transpose_mat_def dagger_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Quantum-cnj_transpose_is_dagger"><span class="command">lemma</span></span> cnj_transpose_is_dagger <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">M</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup></span> <span class="main">=</span> <span class="main">(</span><span class="free">M</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_row <span class="main">(</span><span class="main">(</span><span class="free">M</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup></span><span class="main">)</span> <span class="main">=</span> dim_row <span class="main">(</span><span class="free">M</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> transpose_mat_def cpx_mat_cnj_def dagger_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_col <span class="main">(</span><span class="main">(</span><span class="free">M</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup></span><span class="main">)</span> <span class="main">=</span> dim_col <span class="main">(</span><span class="free">M</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> transpose_mat_def cpx_mat_cnj_def dagger_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span><span class="main">::</span><span class="quoted">nat</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> dim_row <span class="free">M</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> dim_col <span class="free">M</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">M</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup></span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="free">M</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> transpose_mat_def cpx_mat_cnj_def dagger_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Quantum-dagger_of_transpose_is_cnj"><span class="command">lemma</span></span> dagger_of_transpose_is_cnj <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">M</span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span> <span class="main">=</span> <span class="main">(</span><span class="free">M</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> transpose_transpose transpose_cnj_is_dagger<span class="main">)</span>

<span class="keyword1" id="Quantum-dagger_of_prod"><span class="command">lemma</span></span> dagger_of_prod<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">M</span> <span class="free">N</span><span class="main">::</span><span class="quoted"><span class="quoted">"complex Matrix.mat"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"dim_col <span class="free">M</span> <span class="main">=</span> dim_row <span class="free">N</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">M</span> <span class="main">*</span> <span class="free">N</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span> <span class="main">=</span> <span class="free">N</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">M</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">M</span> <span class="main">*</span> <span class="free">N</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">M</span> <span class="main">*</span> <span class="free">N</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">M</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">N</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms cpx_mat_cnj_prod <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">N</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup></span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="free">M</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup></span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms transpose_of_prod 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> cnj_transpose_is_dagger dim_col_of_dagger dim_row_of_dagger index_transpose_mat<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> index_transpose_mat<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">M</span> <span class="main">*</span> <span class="free">N</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span> <span class="main">=</span> <span class="free">N</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">M</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The product of two quantum gates is a quantum gate.›</span></span>

<span class="keyword1" id="Quantum-prod_of_gate_is_gate"><span class="command">lemma</span></span> prod_of_gate_is_gate<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"gate <span class="free">n</span> <span class="free">G1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"gate <span class="free">n</span> <span class="free">G2</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"gate <span class="free">n</span> <span class="main">(</span><span class="free">G1</span> <span class="main">*</span> <span class="free">G2</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_row <span class="main">(</span><span class="free">G1</span> <span class="main">*</span> <span class="free">G2</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> gate_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"square_mat <span class="main">(</span><span class="free">G1</span> <span class="main">*</span> <span class="free">G2</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms gate.dim_row gate.square_mat <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"unitary <span class="main">(</span><span class="free">G1</span> <span class="main">*</span> <span class="free">G2</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">G1</span> <span class="main">*</span> <span class="free">G2</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">G1</span> <span class="main">*</span> <span class="free">G2</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>m</sub></span> <span class="main">(</span>dim_col <span class="main">(</span><span class="free">G1</span> <span class="main">*</span> <span class="free">G2</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> f0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">G1</span> <span class="main">∈</span> carrier_mat <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">)</span> <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">)</span> <span class="main">∧</span> <span class="free">G2</span> <span class="main">∈</span> carrier_mat <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">)</span> <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">)</span>
              <span class="main">∧</span> <span class="free">G1</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span> <span class="main">∈</span> carrier_mat <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">)</span> <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">)</span> <span class="main">∧</span> <span class="free">G2</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span> <span class="main">∈</span> carrier_mat <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">)</span> <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">)</span>
              <span class="main">∧</span> <span class="free">G1</span> <span class="main">*</span> <span class="free">G2</span> <span class="main">∈</span> carrier_mat <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">)</span> <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> assms gate.dim_row gate.square_mat <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">G1</span> <span class="main">*</span> <span class="free">G2</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">G1</span> <span class="main">*</span> <span class="free">G2</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">G2</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">G1</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">G1</span> <span class="main">*</span> <span class="free">G2</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> assms dagger_of_prod gate.dim_row gate.square_mat <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">G2</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="free">G1</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">G1</span> <span class="main">*</span> <span class="free">G2</span><span class="main">)</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> assms f0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">G2</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free">G1</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span><span class="main">)</span> <span class="main">*</span> <span class="free">G1</span><span class="main">)</span> <span class="main">*</span> <span class="free">G2</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> assms f0 f0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">G2</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">1<span class="hidden">⇩</span><sub>m</sub></span> <span class="main">(</span>dim_col <span class="free">G1</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="free">G2</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> gate.unitary<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">n</span></span> <span class="quoted"><span class="free">G1</span></span><span class="main">]</span> assms unitary_def<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">G1</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">G2</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">1<span class="hidden">⇩</span><sub>m</sub></span> <span class="main">(</span>dim_col <span class="free">G2</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="free">G2</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> assms f0 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> carrier_matD<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">G2</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span><span class="main">)</span> <span class="main">*</span> <span class="free">G2</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> f0 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> carrier_matD<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> left_mult_one_mat<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">G1</span> <span class="main">*</span> <span class="free">G2</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">G1</span> <span class="main">*</span> <span class="free">G2</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>m</sub></span> <span class="main">(</span>dim_col <span class="main">(</span><span class="free">G1</span> <span class="main">*</span> <span class="free">G2</span><span class="main">)</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> assms gate.unitary unitary_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G1</span> <span class="main">*</span> <span class="free">G2</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="free">G1</span> <span class="main">*</span> <span class="free">G2</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>m</sub></span> <span class="main">(</span>dim_row <span class="main">(</span><span class="free">G1</span> <span class="main">*</span> <span class="free">G2</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms calculation
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> carrier_matI dim_col_of_dagger dim_row_of_dagger gate.dim_row gate.square_mat index_mult_mat<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> index_mult_mat<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> 
          mat_mult_left_right_inverse square_mat.elims<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> unitary_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Quantum-left_inv_of_unitary_transpose"><span class="command">lemma</span></span> left_inv_of_unitary_transpose <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"unitary <span class="free">U</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">U</span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">U</span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup></span><span class="main">)</span> <span class="main">=</span>  <span class="keyword1">1<span class="hidden">⇩</span><sub>m</sub></span><span class="main">(</span>dim_row <span class="free">U</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"dim_col <span class="free">U</span> <span class="main">=</span> dim_row <span class="main">(</span><span class="main">(</span><span class="free">U</span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">U</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="free">U</span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="main">(</span><span class="free">U</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">U</span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> cpx_mat_cnj_prod cpx_mat_cnj_cnj <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="free">U</span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">U</span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup></span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> transpose_cnj_is_dagger cpx_mat_cnj_id unitary_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Quantum-right_inv_of_unitary_transpose"><span class="command">lemma</span></span> right_inv_of_unitary_transpose <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"unitary <span class="free">U</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">U</span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup></span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="free">U</span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>m</sub></span><span class="main">(</span>dim_col <span class="free">U</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"dim_col <span class="main">(</span><span class="main">(</span><span class="free">U</span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span> <span class="main">=</span> dim_row <span class="free">U</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">U</span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup></span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="free">U</span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free">U</span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">U</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> cpx_mat_cnj_cnj cpx_mat_cnj_prod dagger_of_transpose_is_cnj <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="free">U</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span> <span class="main">*</span> <span class="free">U</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> cpx_mat_cnj_id unitary_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Quantum-transpose_of_unitary_is_unitary"><span class="command">lemma</span></span> transpose_of_unitary_is_unitary <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"unitary <span class="free">U</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"unitary <span class="main">(</span><span class="free">U</span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup></span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> unitary_def assms left_inv_of_unitary_transpose right_inv_of_unitary_transpose <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"The Inner Product"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We introduce a coercion between complex vectors and (column) complex matrices.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">ket_vec</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"complex vec <span class="main">⇒</span> complex mat"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">|</span>_<span class="keyword1">⟩</span>"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="main"><span class="free">|</span></span><span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main"><span class="free">⟩</span></span> <span class="main">≡</span> mat <span class="main">(</span>dim_vec <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span> <span class="main">1</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">$</span> <span class="bound">i</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Quantum-ket_vec_index"><span class="command">lemma</span></span> ket_vec_index <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> dim_vec <span class="free">v</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="free">v</span><span class="main">⟩</span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="free">v</span> <span class="main">$</span> <span class="free">i</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms ket_vec_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Quantum-ket_vec_col"><span class="command">lemma</span></span> ket_vec_col <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"col <span class="main">|</span><span class="free">v</span><span class="main">⟩</span> <span class="main">0</span> <span class="main">=</span> <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> col_def ket_vec_def<span class="main">)</span>

<span class="keyword1" id="Quantum-smult_ket_vec"><span class="command">lemma</span></span> smult_ket_vec <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="free">x</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">v</span><span class="main">⟩</span> <span class="main">=</span> <span class="free">x</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>m</sub></span> <span class="main">|</span><span class="free">v</span><span class="main">⟩</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ket_vec_def<span class="main">)</span>

<span class="keyword1" id="Quantum-smult_vec_length_bis"><span class="command">lemma</span></span> smult_vec_length_bis <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∥</span>col <span class="main">(</span>complex_of_real<span class="main">(</span><span class="free">x</span><span class="main">)</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>m</sub></span> <span class="main">|</span><span class="free">v</span><span class="main">⟩</span><span class="main">)</span> <span class="main">0</span><span class="main">∥</span> <span class="main">=</span> <span class="free">x</span> <span class="main">*</span> <span class="main">∥</span><span class="free">v</span><span class="main">∥</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms smult_ket_vec smult_vec_length ket_vec_col <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

<span class="keyword1"><span class="command">declare</span></span> <span class="main">[</span><span class="main">[</span><span class="operator">coercion</span> <span class="quoted">ket_vec</span><span class="main">]</span><span class="main">]</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">row_vec</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"complex vec <span class="main">⇒</span> complex mat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">row_vec</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">≡</span> mat <span class="main">1</span> <span class="main">(</span>dim_vec <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">$</span> <span class="bound">j</span><span class="main">)</span>"</span></span> 

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">bra_vec</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"complex vec <span class="main">⇒</span> complex mat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">bra_vec</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">≡</span> <span class="main">(</span>row_vec <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>

<span class="keyword1" id="Quantum-row_bra_vec"><span class="command">lemma</span></span> row_bra_vec <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"row <span class="main">(</span>bra_vec <span class="free">v</span><span class="main">)</span> <span class="main">0</span> <span class="main">=</span> vec <span class="main">(</span>dim_vec <span class="free">v</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> cnj<span class="main">(</span><span class="free">v</span> <span class="main">$</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> row_def bra_vec_def cpx_mat_cnj_def row_vec_def<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We introduce a definition called <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">bra</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> to see a vector as a column matrix.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">bra</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"complex mat <span class="main">⇒</span> complex mat"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">⟨</span>_<span class="keyword1">|</span>"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="main"><span class="free">⟨</span></span><span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main"><span class="free">|</span></span> <span class="main">≡</span> mat <span class="main">1</span> <span class="main">(</span>dim_row <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span><span class="main">.</span> cnj<span class="main">(</span><span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">$$</span> <span class="main">(</span><span class="bound">j</span><span class="main">,</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The relation between <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"bra"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"bra_vec"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"ket_vec"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is given as follows.›</span></span>

<span class="keyword1" id="Quantum-bra_bra_vec"><span class="command">lemma</span></span> bra_bra_vec <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"bra <span class="main">(</span>ket_vec <span class="free">v</span><span class="main">)</span> <span class="main">=</span> bra_vec <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> bra_def ket_vec_def bra_vec_def cpx_mat_cnj_def row_vec_def<span class="main">)</span>

<span class="keyword1" id="Quantum-row_bra"><span class="command">lemma</span></span> row_bra <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">v</span><span class="main">::</span><span class="quoted"><span class="quoted">"complex vec"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"row <span class="main">⟨</span><span class="free">v</span><span class="main">|</span> <span class="main">0</span> <span class="main">=</span> vec <span class="main">(</span>dim_vec <span class="free">v</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> cnj <span class="main">(</span><span class="free">v</span> <span class="main">$</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We introduce the inner product of two complex vectors in <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">"ℂ<span class="hidden">⇧</span><sup>n</sup>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">inner_prod</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"complex vec <span class="main">⇒</span> complex vec <span class="main">⇒</span> complex"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">⟨</span>_<span class="keyword1">|</span>_<span class="keyword1">⟩</span>"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">inner_prod</span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">≡</span> <span class="main">∑</span> <span class="bound">i</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span> dim_vec <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">}</span><span class="main">.</span> cnj<span class="main">(</span><span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main">$</span> <span class="bound">i</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">$</span> <span class="bound">i</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Quantum-inner_prod_with_row_bra_vec"><span class="command">lemma</span></span> inner_prod_with_row_bra_vec <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"dim_vec <span class="free">u</span> <span class="main">=</span> dim_vec <span class="free">v</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">u</span><span class="main">|</span><span class="free">v</span><span class="main">⟩</span> <span class="main">=</span> row <span class="main">(</span>bra_vec <span class="free">u</span><span class="main">)</span> <span class="main">0</span> <span class="main">∙</span> <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms inner_prod_def scalar_prod_def row_bra_vec index_vec
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> lessThan_atLeast0 lessThan_iff sum.cong<span class="main">)</span>

<span class="keyword1" id="Quantum-inner_prod_with_row_bra_vec_col_ket_vec"><span class="command">lemma</span></span> inner_prod_with_row_bra_vec_col_ket_vec <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"dim_vec <span class="free">u</span> <span class="main">=</span> dim_vec <span class="free">v</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">u</span><span class="main">|</span><span class="free">v</span><span class="main">⟩</span> <span class="main">=</span> <span class="main">(</span>row <span class="main">⟨</span><span class="free">u</span><span class="main">|</span> <span class="main">0</span><span class="main">)</span> <span class="main">∙</span> <span class="main">(</span>col <span class="main">|</span><span class="free">v</span><span class="main">⟩</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inner_prod_def scalar_prod_def<span class="main">)</span>

<span class="keyword1" id="Quantum-inner_prod_with_times_mat"><span class="command">lemma</span></span> inner_prod_with_times_mat <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"dim_vec <span class="free">u</span> <span class="main">=</span> dim_vec <span class="free">v</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">u</span><span class="main">|</span><span class="free">v</span><span class="main">⟩</span> <span class="main">=</span> <span class="main">(</span><span class="main">⟨</span><span class="free">u</span><span class="main">|</span> <span class="main">*</span> <span class="main">|</span><span class="free">v</span><span class="main">⟩</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms inner_prod_with_row_bra_vec_col_ket_vec 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inner_prod_def times_mat_def ket_vec_def bra_def<span class="main">)</span>

<span class="keyword1" id="Quantum-orthogonal_unit_vec"><span class="command">lemma</span></span> orthogonal_unit_vec <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≠</span> <span class="free">j</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span>unit_vec <span class="free">n</span> <span class="free">i</span><span class="main">|</span>unit_vec <span class="free">n</span> <span class="free">j</span><span class="main">⟩</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span>unit_vec <span class="free">n</span> <span class="free">i</span><span class="main">|</span>unit_vec <span class="free">n</span> <span class="free">j</span><span class="main">⟩</span> <span class="main">=</span> unit_vec <span class="free">n</span> <span class="free">i</span> <span class="main">∙</span> unit_vec <span class="free">n</span> <span class="free">j</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms unit_vec_def inner_prod_def scalar_prod_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> complex_cnj_zero index_unit_vec<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> index_vec inner_prod_with_row_bra_vec row_bra_vec 
        scalar_prod_right_unit<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms scalar_prod_def unit_vec_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We prove that our inner product is linear in its second argument.›</span></span>

<span class="keyword1" id="Quantum-vec_index_is_linear"><span class="command">lemma</span></span> vec_index_is_linear <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"dim_vec <span class="free">u</span> <span class="main">=</span> dim_vec <span class="free">v</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">&lt;</span> dim_vec <span class="free">u</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">k</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">u</span> <span class="main">+</span> <span class="free">l</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">v</span><span class="main">)</span> <span class="main">$</span> <span class="free">j</span> <span class="main">=</span> <span class="free">k</span> <span class="main">*</span> <span class="main">(</span><span class="free">u</span> <span class="main">$</span> <span class="free">j</span><span class="main">)</span> <span class="main">+</span> <span class="free">l</span> <span class="main">*</span> <span class="main">(</span><span class="free">v</span> <span class="main">$</span> <span class="free">j</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms vec_index_def smult_vec_def plus_vec_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Quantum-inner_prod_is_linear"><span class="command">lemma</span></span> inner_prod_is_linear <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">u</span><span class="main">::</span><span class="quoted"><span class="quoted">"complex vec"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">v</span><span class="main">::</span><span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> complex vec"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">l</span><span class="main">::</span><span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> complex"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">,</span> <span class="main">1</span><span class="main">}</span><span class="main">.</span> dim_vec <span class="free">u</span> <span class="main">=</span> dim_vec <span class="main">(</span><span class="free">v</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">u</span><span class="main">|</span><span class="free">l</span> <span class="main">0</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">v</span> <span class="main">0</span> <span class="main">+</span> <span class="free">l</span> <span class="main">1</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">v</span> <span class="main">1</span><span class="main">⟩</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">≤</span><span class="main">1</span><span class="main">.</span> <span class="free">l</span> <span class="bound">i</span> <span class="main">*</span> <span class="main">⟨</span><span class="free">u</span><span class="main">|</span><span class="free">v</span> <span class="bound">i</span><span class="main">⟩</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> f1<span class="main">:</span><span class="quoted"><span class="quoted">"dim_vec <span class="main">(</span><span class="free">l</span> <span class="main">0</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">v</span> <span class="main">0</span> <span class="main">+</span> <span class="free">l</span> <span class="main">1</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">v</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> dim_vec <span class="free">u</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">u</span><span class="main">|</span><span class="free">l</span> <span class="main">0</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">v</span> <span class="main">0</span> <span class="main">+</span> <span class="free">l</span> <span class="main">1</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">v</span> <span class="main">1</span><span class="main">⟩</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span> <span class="main">..&lt;</span> dim_vec <span class="free">u</span><span class="main">}</span><span class="main">.</span> cnj <span class="main">(</span><span class="free">u</span> <span class="main">$</span> <span class="bound">i</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="free">l</span> <span class="main">0</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">v</span> <span class="main">0</span> <span class="main">+</span> <span class="free">l</span> <span class="main">1</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">v</span> <span class="main">1</span><span class="main">)</span> <span class="main">$</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inner_prod_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span> <span class="main">..&lt;</span> dim_vec <span class="free">u</span><span class="main">}</span><span class="main">.</span> cnj <span class="main">(</span><span class="free">u</span> <span class="main">$</span> <span class="bound">i</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">l</span> <span class="main">0</span> <span class="main">*</span> <span class="free">v</span> <span class="main">0</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">+</span> <span class="free">l</span> <span class="main">1</span> <span class="main">*</span> <span class="free">v</span> <span class="main">1</span> <span class="main">$</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">l</span> <span class="main">0</span> <span class="main">*</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span> <span class="main">..&lt;</span> dim_vec <span class="free">u</span><span class="main">}</span><span class="main">.</span> cnj<span class="main">(</span><span class="free">u</span> <span class="main">$</span> <span class="bound">i</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">v</span> <span class="main">0</span> <span class="main">$</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="free">l</span> <span class="main">1</span> <span class="main">*</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span> <span class="main">..&lt;</span> dim_vec <span class="free">u</span><span class="main">}</span><span class="main">.</span> cnj<span class="main">(</span><span class="free">u</span> <span class="main">$</span> <span class="bound">i</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">v</span> <span class="main">1</span> <span class="main">$</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
      <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum.distrib sum_distrib_left<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">l</span> <span class="main">0</span> <span class="main">*</span> <span class="main">⟨</span><span class="free">u</span><span class="main">|</span><span class="free">v</span> <span class="main">0</span><span class="main">⟩</span> <span class="main">+</span> <span class="free">l</span> <span class="main">1</span> <span class="main">*</span> <span class="main">⟨</span><span class="free">u</span><span class="main">|</span><span class="free">v</span> <span class="main">1</span><span class="main">⟩</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms inner_prod_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Quantum-inner_prod_cnj"><span class="command">lemma</span></span> inner_prod_cnj<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"dim_vec <span class="free">u</span> <span class="main">=</span> dim_vec <span class="free">v</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">v</span><span class="main">|</span><span class="free">u</span><span class="main">⟩</span> <span class="main">=</span> cnj <span class="main">(</span><span class="main">⟨</span><span class="free">u</span><span class="main">|</span><span class="free">v</span><span class="main">⟩</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms inner_prod_def <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>

<span class="keyword1" id="Quantum-inner_prod_with_itself_Im"><span class="command">lemma</span></span> inner_prod_with_itself_Im <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"Im <span class="main">(</span><span class="main">⟨</span><span class="free">u</span><span class="main">|</span><span class="free">u</span><span class="main">⟩</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> inner_prod_cnj <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Reals_cnj_iff complex_is_Real_iff<span class="main">)</span>

<span class="keyword1" id="Quantum-inner_prod_with_itself_real"><span class="command">lemma</span></span> inner_prod_with_itself_real <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">u</span><span class="main">|</span><span class="free">u</span><span class="main">⟩</span> <span class="main">∈</span> <span class="main">ℝ</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> inner_prod_with_itself_Im <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> complex_is_Real_iff<span class="main">)</span>

<span class="keyword1" id="Quantum-inner_prod_with_itself_eq0"><span class="command">lemma</span></span> inner_prod_with_itself_eq0 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">=</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">(</span>dim_vec <span class="free">u</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">u</span><span class="main">|</span><span class="free">u</span><span class="main">⟩</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms inner_prod_def zero_vec_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> atLeastLessThan_iff complex_cnj_zero index_zero_vec<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> mult_zero_left sum.neutral<span class="main">)</span>

<span class="keyword1" id="Quantum-inner_prod_with_itself_Re"><span class="command">lemma</span></span> inner_prod_with_itself_Re<span class="main">:</span>
  <span class="quoted"><span class="quoted">"Re <span class="main">(</span><span class="main">⟨</span><span class="free">u</span><span class="main">|</span><span class="free">u</span><span class="main">⟩</span><span class="main">)</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Re <span class="main">(</span><span class="main">⟨</span><span class="free">u</span><span class="main">|</span><span class="free">u</span><span class="main">⟩</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span>dim_vec <span class="free">u</span><span class="main">.</span> Re <span class="main">(</span>cnj<span class="main">(</span><span class="free">u</span> <span class="main">$</span> <span class="bound">i</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">u</span> <span class="main">$</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inner_prod_def lessThan_atLeast0<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span>dim_vec <span class="free">u</span><span class="main">.</span> <span class="main">(</span>Re <span class="main">(</span><span class="free">u</span> <span class="main">$</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="main">(</span>Im <span class="main">(</span><span class="free">u</span> <span class="main">$</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> complex_mult_cnj
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Re_complex_of_real semiring_normalization_rules<span class="main"><span class="main">(</span></span>7<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Re <span class="main">(</span><span class="main">⟨</span><span class="free">u</span><span class="main">|</span><span class="free">u</span><span class="main">⟩</span><span class="main">)</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_nonneg<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Quantum-inner_prod_with_itself_nonneg_reals"><span class="command">lemma</span></span> inner_prod_with_itself_nonneg_reals<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">u</span><span class="main">::</span><span class="quoted"><span class="quoted">"complex vec"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">u</span><span class="main">|</span><span class="free">u</span><span class="main">⟩</span> <span class="main">∈</span> nonneg_Reals"</span></span>
  <span class="keyword1"><span class="command">using</span></span> inner_prod_with_itself_real inner_prod_with_itself_Re complex_nonneg_Reals_iff 
inner_prod_with_itself_Im <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Quantum-inner_prod_with_itself_Re_non0"><span class="command">lemma</span></span> inner_prod_with_itself_Re_non0<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">≠</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">(</span>dim_vec <span class="free">u</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Re <span class="main">(</span><span class="main">⟨</span><span class="free">u</span><span class="main">|</span><span class="free">u</span><span class="main">⟩</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> dim_vec <span class="free">u</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms zero_vec_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> dim_vec eq_vecI index_zero_vec<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> f1<span class="main">:</span><span class="quoted"><span class="quoted">"Re <span class="main">(</span>cnj <span class="main">(</span><span class="free">u</span> <span class="main">$</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">u</span> <span class="main">$</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Re_complex_of_real complex_mult_cnj complex_neq_0 mult.commute<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> f2<span class="main">:</span><span class="quoted"><span class="quoted">"Re <span class="main">(</span><span class="main">⟨</span><span class="free">u</span><span class="main">|</span><span class="free">u</span><span class="main">⟩</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span>dim_vec <span class="free">u</span><span class="main">.</span> Re <span class="main">(</span>cnj<span class="main">(</span><span class="free">u</span> <span class="main">$</span> <span class="bound">i</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">u</span> <span class="main">$</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> inner_prod_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lessThan_atLeast0<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> f3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span>dim_vec <span class="free">u</span><span class="main">.</span> Re <span class="main">(</span>cnj<span class="main">(</span><span class="free">u</span> <span class="main">$</span> <span class="bound">i</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">u</span> <span class="main">$</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> complex_mult_cnj <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> a1 inner_prod_def lessThan_iff
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> finite_lessThan sum_pos2<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Quantum-inner_prod_with_itself_nonneg_reals_non0"><span class="command">lemma</span></span> inner_prod_with_itself_nonneg_reals_non0<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">≠</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">(</span>dim_vec <span class="free">u</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">u</span><span class="main">|</span><span class="free">u</span><span class="main">⟩</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms inner_prod_with_itself_Re_non0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="Quantum-cpx_vec_length_inner_prod"><span class="command">lemma</span></span> cpx_vec_length_inner_prod <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">∥</span><span class="free">v</span><span class="main">∥</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">=</span> <span class="main">⟨</span><span class="free">v</span><span class="main">|</span><span class="free">v</span><span class="main">⟩</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∥</span><span class="free">v</span><span class="main">∥</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span>dim_vec <span class="free">v</span><span class="main">.</span> <span class="main">(</span>cmod <span class="main">(</span><span class="free">v</span> <span class="main">$</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> cpx_vec_length_def complex_of_real_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> real_sqrt_power real_sqrt_unique sum_nonneg zero_le_power2<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span>dim_vec <span class="free">v</span><span class="main">.</span> cnj <span class="main">(</span><span class="free">v</span> <span class="main">$</span> <span class="bound">i</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">v</span> <span class="main">$</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> complex_norm_square mult.commute <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> of_real_sum sum.cong<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> inner_prod_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lessThan_atLeast0<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Quantum-inner_prod_csqrt"><span class="command">lemma</span></span> inner_prod_csqrt <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"csqrt <span class="main">⟨</span><span class="free">v</span><span class="main">|</span><span class="free">v</span><span class="main">⟩</span> <span class="main">=</span> <span class="main">∥</span><span class="free">v</span><span class="main">∥</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> inner_prod_with_itself_Re inner_prod_with_itself_Im csqrt_of_real_nonneg cpx_vec_length_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Re_complex_of_real cpx_vec_length_inner_prod real_sqrt_ge_0_iff 
      real_sqrt_unique sum_nonneg zero_le_power2<span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Unitary Matrices and Length-Preservation"</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">"Unitary Matrices are Length-Preserving"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The bra-vector <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">"⟨A * v|"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is given by <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">"⟨v| * A<span class="hidden">⇧</span><sup>†</sup>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>›</span></span>

<span class="keyword1" id="Quantum-dagger_of_ket_is_bra"><span class="command">lemma</span></span> dagger_of_ket_is_bra<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">v</span><span class="main">::</span> <span class="quoted"><span class="quoted">"complex vec"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span> <span class="main">|</span><span class="free">v</span><span class="main">⟩</span> <span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span> <span class="main">=</span> <span class="main">⟨</span><span class="free">v</span><span class="main">|</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bra_def dagger_def ket_vec_def<span class="main">)</span>

<span class="keyword1" id="Quantum-bra_mat_on_vec"><span class="command">lemma</span></span> bra_mat_on_vec<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">v</span><span class="main">::</span><span class="quoted"><span class="quoted">"complex vec"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"complex mat"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"dim_col <span class="free">A</span> <span class="main">=</span> dim_vec <span class="free">v</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">A</span> <span class="main">*</span> <span class="free">v</span><span class="main">|</span> <span class="main">=</span> <span class="main">⟨</span><span class="free">v</span><span class="main">|</span> <span class="main">*</span> <span class="main">(</span><span class="free">A</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_row <span class="main">⟨</span><span class="free">A</span> <span class="main">*</span> <span class="free">v</span><span class="main">|</span> <span class="main">=</span> dim_row <span class="main">(</span><span class="main">⟨</span><span class="free">v</span><span class="main">|</span> <span class="main">*</span> <span class="main">(</span><span class="free">A</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bra_def times_mat_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_col <span class="main">⟨</span><span class="free">A</span> <span class="main">*</span> <span class="free">v</span><span class="main">|</span> <span class="main">=</span> dim_col <span class="main">(</span><span class="main">⟨</span><span class="free">v</span><span class="main">|</span> <span class="main">*</span> <span class="main">(</span><span class="free">A</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bra_def times_mat_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span><span class="main">::</span><span class="quoted">nat</span>
  <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> dim_row <span class="main">(</span><span class="main">⟨</span><span class="free">v</span><span class="main">|</span> <span class="main">*</span> <span class="main">(</span><span class="free">A</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> dim_col <span class="main">(</span><span class="main">⟨</span><span class="free">v</span><span class="main">|</span> <span class="main">*</span> <span class="main">(</span><span class="free">A</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span><span class="main">)</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cnj<span class="main">(</span><span class="main">(</span><span class="free">A</span> <span class="main">*</span> <span class="free">v</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">j</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> cnj <span class="main">(</span>row <span class="free">A</span> <span class="skolem">j</span> <span class="main">∙</span> <span class="free">v</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> bra_def times_mat_def ket_vec_col ket_vec_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> f7<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">…</span><span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span> <span class="main">..&lt;</span> dim_vec <span class="free">v</span><span class="main">}</span><span class="main">.</span> cnj<span class="main">(</span><span class="free">v</span> <span class="main">$</span> <span class="bound">i</span><span class="main">)</span> <span class="main">*</span> cnj<span class="main">(</span><span class="free">A</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">j</span><span class="main">,</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> row_def scalar_prod_def cnj_sum complex_cnj_mult mult.commute
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> assms index_vec lessThan_atLeast0 lessThan_iff sum.cong<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> f8<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>row <span class="main">⟨</span><span class="free">v</span><span class="main">|</span> <span class="main">0</span><span class="main">)</span> <span class="main">∙</span> <span class="main">(</span>col <span class="main">(</span><span class="free">A</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span><span class="main">)</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> 
    vec <span class="main">(</span>dim_vec <span class="free">v</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> cnj <span class="main">(</span><span class="free">v</span> <span class="main">$</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">∙</span> vec <span class="main">(</span>dim_col <span class="free">A</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> cnj <span class="main">(</span><span class="free">A</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">j</span><span class="main">,</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> a2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cnj<span class="main">(</span><span class="main">(</span><span class="free">A</span> <span class="main">*</span> <span class="free">v</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">j</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>row <span class="main">⟨</span><span class="free">v</span><span class="main">|</span> <span class="main">0</span><span class="main">)</span> <span class="main">∙</span> <span class="main">(</span>col <span class="main">(</span><span class="free">A</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span><span class="main">)</span> <span class="skolem">j</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms scalar_prod_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> dim_vec index_vec lessThan_atLeast0 lessThan_iff sum.cong<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">A</span> <span class="main">*</span> <span class="free">v</span><span class="main">|</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⟨</span><span class="free">v</span><span class="main">|</span> <span class="main">*</span> <span class="main">(</span><span class="free">A</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span><span class="main">)</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> bra_def times_mat_def a2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">A</span> <span class="main">*</span> <span class="main">|</span><span class="free">v</span><span class="main">⟩</span><span class="main">|</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⟨</span><span class="free">v</span><span class="main">|</span> <span class="main">*</span> <span class="main">(</span><span class="free">A</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span><span class="main">)</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> a1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> times_mat_def bra_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Quantum-mat_on_ket"><span class="command">lemma</span></span> mat_on_ket<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">v</span><span class="main">::</span> <span class="quoted"><span class="quoted">"complex vec"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">A</span><span class="main">::</span> <span class="quoted"><span class="quoted">"complex mat"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"dim_col <span class="free">A</span> <span class="main">=</span> dim_vec <span class="free">v</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">*</span> <span class="main">|</span><span class="free">v</span><span class="main">⟩</span> <span class="main">=</span> <span class="main">|</span>col <span class="main">(</span><span class="free">A</span> <span class="main">*</span> <span class="free">v</span><span class="main">)</span> <span class="main">0</span><span class="main">⟩</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms ket_vec_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Quantum-dagger_of_mat_on_ket"><span class="command">lemma</span></span> dagger_of_mat_on_ket<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">v</span><span class="main">::</span> <span class="quoted"><span class="quoted">"complex vec"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">A</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"complex mat"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"dim_col <span class="free">A</span> <span class="main">=</span> dim_vec <span class="free">v</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">A</span> <span class="main">*</span> <span class="main">|</span><span class="free">v</span><span class="main">⟩</span> <span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span> <span class="main">=</span> <span class="main">⟨</span><span class="free">v</span><span class="main">|</span> <span class="main">*</span> <span class="main">(</span><span class="free">A</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> bra_mat_on_vec dagger_of_ket_is_bra mat_on_ket<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">col_fst</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> mat <span class="main">⇒</span> <span class="tfree">'a</span> vec"</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free">col_fst</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">=</span> vec <span class="main">(</span>dim_row <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">i</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">$$</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Quantum-col_fst_is_col"><span class="command">lemma</span></span> col_fst_is_col <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"col_fst <span class="free">M</span> <span class="main">=</span> col <span class="free">M</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> col_def col_fst_def<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
We need to declare <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"col_fst"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> as a coercion from matrices to vectors in order to see a column 
matrix as a vector. 
›</span></span>

<span class="keyword1"><span class="command">declare</span></span> 
  <span class="main">[</span><span class="main">[</span><span class="operator">coercion_delete</span> <span class="quoted">ket_vec</span><span class="main">]</span><span class="main">]</span>
  <span class="main">[</span><span class="main">[</span><span class="operator">coercion</span> <span class="quoted">col_fst</span><span class="main">]</span><span class="main">]</span>

<span class="keyword1" id="Quantum-unit_vec_to_col"><span class="command">lemma</span></span> unit_vec_to_col<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"dim_col <span class="free">A</span> <span class="main">=</span> <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"col <span class="free">A</span> <span class="free">i</span> <span class="main">=</span> <span class="free">A</span> <span class="main">*</span> <span class="main">|</span>unit_vec <span class="free">n</span> <span class="free">i</span><span class="main">⟩</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_vec <span class="main">(</span>col <span class="free">A</span> <span class="free">i</span><span class="main">)</span> <span class="main">=</span> dim_vec <span class="main">(</span><span class="free">A</span> <span class="main">*</span> <span class="main">|</span>unit_vec <span class="free">n</span> <span class="free">i</span><span class="main">⟩</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> col_def times_mat_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">j</span><span class="main">::</span><span class="quoted">nat</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> dim_vec <span class="main">(</span>col_fst <span class="main">(</span><span class="free">A</span> <span class="main">*</span> <span class="main">|</span>unit_vec <span class="free">n</span> <span class="free">i</span><span class="main">⟩</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"col <span class="free">A</span> <span class="free">i</span> <span class="main">$</span> <span class="skolem">j</span> <span class="main">=</span> <span class="main">(</span><span class="free">A</span> <span class="main">*</span> <span class="main">|</span>unit_vec <span class="free">n</span> <span class="free">i</span><span class="main">⟩</span><span class="main">)</span> <span class="main">$</span> <span class="skolem">j</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms times_mat_def ket_vec_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> col_fst_is_col dim_col dim_col_mat<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> index_col index_mult_mat<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> index_mult_mat<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> 
index_row<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> ket_vec_col less_numeral_extra<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> scalar_prod_right_unit<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Quantum-mult_ket_vec_is_ket_vec_of_mult"><span class="command">lemma</span></span> mult_ket_vec_is_ket_vec_of_mult<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"complex mat"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">v</span><span class="main">::</span><span class="quoted"><span class="quoted">"complex vec"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"dim_col <span class="free">A</span> <span class="main">=</span> dim_vec <span class="free">v</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="free">A</span> <span class="main">*</span> <span class="main">|</span><span class="free">v</span><span class="main">⟩</span> <span class="main">⟩</span> <span class="main">=</span> <span class="free">A</span> <span class="main">*</span> <span class="main">|</span><span class="free">v</span><span class="main">⟩</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms ket_vec_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> One_nat_def col_fst_is_col dim_col dim_col_mat<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> index_mult_mat<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> ket_vec_col less_Suc0 
mat_col_eqI<span class="main">)</span>

<span class="keyword1" id="Quantum-unitary_is_sq_length_preserving"><span class="command">lemma</span></span> unitary_is_sq_length_preserving <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"unitary <span class="free">U</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"dim_vec <span class="free">v</span> <span class="main">=</span> dim_col <span class="free">U</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∥</span><span class="free">U</span> <span class="main">*</span> <span class="main">|</span><span class="free">v</span><span class="main">⟩</span><span class="main">∥</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">=</span> <span class="main">∥</span><span class="free">v</span><span class="main">∥</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">U</span> <span class="main">*</span> <span class="main">|</span><span class="free">v</span><span class="main">⟩</span><span class="main">|</span><span class="free">U</span> <span class="main">*</span> <span class="main">|</span><span class="free">v</span><span class="main">⟩</span> <span class="main">⟩</span> <span class="main">=</span> <span class="main">(</span><span class="main">⟨</span><span class="main">|</span><span class="free">v</span><span class="main">⟩</span><span class="main">|</span> <span class="main">*</span> <span class="main">(</span><span class="free">U</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span><span class="main">)</span> <span class="main">*</span> <span class="main">|</span><span class="free">U</span> <span class="main">*</span> <span class="main">|</span><span class="free">v</span><span class="main">⟩</span><span class="main">⟩</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> bra_mat_on_vec
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inner_prod_with_times_mat mult_ket_vec_is_ket_vec_of_mult<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">U</span> <span class="main">*</span> <span class="main">|</span><span class="free">v</span><span class="main">⟩</span><span class="main">|</span><span class="free">U</span> <span class="main">*</span> <span class="main">|</span><span class="free">v</span><span class="main">⟩</span> <span class="main">⟩</span> <span class="main">=</span> <span class="main">(</span><span class="main">⟨</span><span class="main">|</span><span class="free">v</span><span class="main">⟩</span><span class="main">|</span> <span class="main">*</span> <span class="main">(</span><span class="free">U</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">U</span> <span class="main">*</span> <span class="main">|</span><span class="free">v</span><span class="main">⟩</span><span class="main">)</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> mult_ket_vec_is_ket_vec_of_mult <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> f1<span class="main">:</span><span class="quoted"><span class="quoted">"dim_col <span class="main">⟨</span><span class="main">|</span><span class="free">v</span><span class="main">⟩</span><span class="main">|</span> <span class="main">=</span> dim_vec <span class="free">v</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ket_vec_def bra_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"dim_row <span class="main">(</span><span class="free">U</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span><span class="main">)</span> <span class="main">=</span> dim_vec <span class="free">v</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">U</span> <span class="main">*</span> <span class="main">|</span><span class="free">v</span><span class="main">⟩</span><span class="main">|</span><span class="free">U</span> <span class="main">*</span> <span class="main">|</span><span class="free">v</span><span class="main">⟩</span> <span class="main">⟩</span> <span class="main">=</span> <span class="main">(</span><span class="main">⟨</span><span class="main">|</span><span class="free">v</span><span class="main">⟩</span><span class="main">|</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="free">U</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span><span class="main">)</span> <span class="main">*</span> <span class="free">U</span><span class="main">)</span> <span class="main">*</span> <span class="main">|</span><span class="free">v</span><span class="main">⟩</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assoc_mult_mat
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">smt</span> carrier_mat_triv dim_row_mat<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> dagger_def ket_vec_def mat_carrier times_mat_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">U</span> <span class="main">*</span> <span class="main">|</span><span class="free">v</span><span class="main">⟩</span><span class="main">|</span><span class="free">U</span> <span class="main">*</span> <span class="main">|</span><span class="free">v</span><span class="main">⟩</span> <span class="main">⟩</span> <span class="main">=</span> <span class="main">(</span><span class="main">⟨</span><span class="main">|</span><span class="free">v</span><span class="main">⟩</span><span class="main">|</span> <span class="main">*</span> <span class="main">|</span><span class="free">v</span><span class="main">⟩</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms f1 unitary_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> cpx_vec_length_inner_prod <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">metis</span> Re_complex_of_real inner_prod_with_times_mat<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Quantum-col_ket_vec"><span class="command">lemma</span></span> col_ket_vec <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"dim_col <span class="free">M</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">|</span>col <span class="free">M</span> <span class="main">0</span><span class="main">⟩</span> <span class="main">=</span> <span class="free">M</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> eq_matI assms ket_vec_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Quantum-state_col_ket_vec"><span class="command">lemma</span></span> state_col_ket_vec<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"state <span class="main">1</span> <span class="free">v</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"state <span class="main">1</span> <span class="main">|</span>col <span class="free">v</span> <span class="main">0</span><span class="main">⟩</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> state_def<span class="main">)</span>

<span class="keyword1" id="Quantum-col_ket_vec_index"><span class="command">lemma</span></span> col_ket_vec_index <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> dim_row <span class="free">v</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">|</span>col <span class="free">v</span> <span class="main">0</span><span class="main">⟩</span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="free">v</span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms ket_vec_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> col_def<span class="main">)</span>

<span class="keyword1" id="Quantum-col_index_of_mat_col"><span class="command">lemma</span></span> col_index_of_mat_col <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"dim_col <span class="free">v</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> dim_row <span class="free">v</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"col <span class="free">v</span> <span class="main">0</span> <span class="main">$</span> <span class="free">i</span> <span class="main">=</span> <span class="free">v</span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Quantum-unitary_is_sq_length_preserving_bis"><span class="command">lemma</span></span> unitary_is_sq_length_preserving_bis <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"unitary <span class="free">U</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"dim_row <span class="free">v</span> <span class="main">=</span> dim_col <span class="free">U</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"dim_col <span class="free">v</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∥</span>col <span class="main">(</span><span class="free">U</span> <span class="main">*</span> <span class="free">v</span><span class="main">)</span> <span class="main">0</span><span class="main">∥</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">=</span> <span class="main">∥</span>col <span class="free">v</span> <span class="main">0</span><span class="main">∥</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"dim_vec <span class="main">(</span>col <span class="free">v</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> dim_col <span class="free">U</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∥</span>col_fst <span class="main">(</span><span class="free">U</span> <span class="main">*</span> <span class="main">|</span>col <span class="free">v</span> <span class="main">0</span><span class="main">⟩</span><span class="main">)</span><span class="main">∥</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">=</span> <span class="main">∥</span>col <span class="free">v</span> <span class="main">0</span><span class="main">∥</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> unitary_is_sq_length_preserving<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">U</span>"</span></span> <span class="quoted"><span class="quoted">"col <span class="free">v</span> <span class="main">0</span>"</span></span><span class="main">]</span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ 
A unitary matrix is length-preserving, i.e. it acts on a vector to produce another vector of the 
same length. 
›</span></span>

<span class="keyword1" id="Quantum-unitary_is_length_preserving_bis"><span class="command">lemma</span></span> unitary_is_length_preserving_bis <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">U</span><span class="main">::</span><span class="quoted"><span class="quoted">"complex mat"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">v</span><span class="main">::</span><span class="quoted"><span class="quoted">"complex mat"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"unitary <span class="free">U</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"dim_row <span class="free">v</span> <span class="main">=</span> dim_col <span class="free">U</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"dim_col <span class="free">v</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∥</span>col <span class="main">(</span><span class="free">U</span> <span class="main">*</span> <span class="free">v</span><span class="main">)</span> <span class="main">0</span><span class="main">∥</span> <span class="main">=</span> <span class="main">∥</span>col <span class="free">v</span> <span class="main">0</span><span class="main">∥</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms unitary_is_sq_length_preserving_bis
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> cpx_vec_length_inner_prod inner_prod_csqrt of_real_hom.injectivity<span class="main">)</span>

<span class="keyword1" id="Quantum-unitary_is_length_preserving"><span class="command">lemma</span></span> unitary_is_length_preserving <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">U</span><span class="main">::</span> <span class="quoted"><span class="quoted">"complex mat"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">v</span><span class="main">::</span> <span class="quoted"><span class="quoted">"complex vec"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"unitary <span class="free">U</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"dim_vec <span class="free">v</span> <span class="main">=</span> dim_col <span class="free">U</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∥</span><span class="free">U</span> <span class="main">*</span> <span class="main">|</span><span class="free">v</span><span class="main">⟩</span><span class="main">∥</span> <span class="main">=</span> <span class="main">∥</span><span class="free">v</span><span class="main">∥</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms unitary_is_sq_length_preserving
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> cpx_vec_length_inner_prod inner_prod_csqrt of_real_hom.injectivity<span class="main">)</span>


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">"Length-Preserving Matrices are Unitary"</span></span>

<span class="keyword1" id="Quantum-inverts_mat_sym"><span class="command">lemma</span></span> inverts_mat_sym<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span> <span class="free">B</span><span class="main">::</span> <span class="quoted"><span class="quoted">"complex mat"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"inverts_mat <span class="free">A</span> <span class="free">B</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"dim_row <span class="free">B</span> <span class="main">=</span> dim_col <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"square_mat <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"inverts_mat <span class="free">B</span> <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> d0<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> dim_row <span class="free">B</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">*</span> <span class="free">B</span> <span class="main">=</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>m</sub></span> <span class="main">(</span>dim_row <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> inverts_mat_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"dim_col <span class="free">B</span> <span class="main">=</span> dim_col <span class="main">(</span><span class="free">A</span> <span class="main">*</span> <span class="free">B</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> times_mat_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"dim_col <span class="free">B</span> <span class="main">=</span> dim_row <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> c0<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">∈</span> carrier_mat <span class="skolem">n</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span> d0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> c1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">∈</span> carrier_mat <span class="skolem">n</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span> d0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> f0<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">*</span> <span class="free">B</span> <span class="main">=</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>m</sub></span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> inverts_mat_def c0 c1 assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> f1<span class="main">:</span><span class="quoted"><span class="quoted">"det <span class="free">B</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"det <span class="free">B</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">v</span><span class="main">.</span> <span class="bound">v</span> <span class="main">∈</span> carrier_vec <span class="skolem">n</span> <span class="main">∧</span> <span class="bound">v</span> <span class="main">≠</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">n</span> <span class="main">∧</span> <span class="free">B</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="bound">v</span> <span class="main">=</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">n</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> det_0_iff_vec_prod_zero assms<span class="main">(</span>3<span class="main">)</span> c1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span> d1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> carrier_vec <span class="skolem">n</span> <span class="main">∧</span> <span class="skolem">v</span> <span class="main">≠</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">n</span> <span class="main">∧</span> <span class="free">B</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">v</span> <span class="main">=</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> d2<span class="main">:</span><span class="quoted"><span class="quoted">"dim_vec <span class="skolem">v</span> <span class="main">=</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">*</span> <span class="main">|</span><span class="skolem">v</span><span class="main">⟩</span> <span class="main">=</span> <span class="main">|</span><span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">n</span><span class="main">⟩</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_row <span class="main">(</span><span class="free">B</span> <span class="main">*</span> <span class="main">|</span><span class="skolem">v</span><span class="main">⟩</span><span class="main">)</span> <span class="main">=</span> dim_row <span class="main">|</span><span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">n</span><span class="main">⟩</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ket_vec_def d0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_col <span class="main">(</span><span class="free">B</span> <span class="main">*</span> <span class="main">|</span><span class="skolem">v</span><span class="main">⟩</span><span class="main">)</span> <span class="main">=</span> dim_col <span class="main">|</span><span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">n</span><span class="main">⟩</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ket_vec_def d0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> dim_row <span class="main">|</span><span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">n</span><span class="main">⟩</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> dim_col <span class="main">|</span><span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">n</span><span class="main">⟩</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> f2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="skolem">n</span> <span class="main">∧</span> <span class="skolem">j</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ket_vec_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vec <span class="main">(</span>dim_row <span class="free">B</span><span class="main">)</span> <span class="main">(</span><span class="main">($)</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> d0 d1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">B</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">v</span><span class="main">)</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">ia</span> <span class="main">=</span> <span class="main">0</span><span class="main">..&lt;</span>dim_row <span class="free">B</span><span class="main">.</span> row <span class="free">B</span> <span class="skolem">i</span> <span class="main">$</span> <span class="bound">ia</span> <span class="main">*</span> <span class="skolem">v</span> <span class="main">$</span> <span class="bound">ia</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> d0 d2 f2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> scalar_prod_def<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">B</span> <span class="main">*</span> <span class="main">|</span><span class="skolem">v</span><span class="main">⟩</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">|</span><span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">n</span><span class="main">⟩</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> ket_vec_def d0 d1 times_mat_def mult_mat_vec_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> scalar_prod_def<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="skolem">v</span><span class="main">⟩</span> <span class="main">∈</span> carrier_mat <span class="skolem">n</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> d2 ket_vec_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">A</span> <span class="main">*</span> <span class="free">B</span><span class="main">)</span> <span class="main">*</span> <span class="main">|</span><span class="skolem">v</span><span class="main">⟩</span> <span class="main">=</span> <span class="free">A</span> <span class="main">*</span> <span class="main">|</span><span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">n</span><span class="main">⟩</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> c0 c1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> f3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">|</span><span class="skolem">v</span><span class="main">⟩</span> <span class="main">=</span> <span class="free">A</span> <span class="main">*</span> <span class="main">|</span><span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">n</span><span class="main">⟩</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> d2 f0 ket_vec_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">=</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">n</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_vec <span class="skolem">v</span> <span class="main">=</span> dim_vec <span class="main">(</span><span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> d2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="keyword3"><span class="command">assume</span></span> f4<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> dim_vec <span class="main">(</span><span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">n</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="skolem">v</span><span class="main">⟩</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">v</span> <span class="main">$</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> d2 ket_vec_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">A</span> <span class="main">*</span> <span class="main">|</span><span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">n</span><span class="main">⟩</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> ket_vec_def times_mat_def scalar_prod_def f4 c0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">=</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">n</span> <span class="main">$</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> f3 f4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> d1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> f5<span class="main">:</span><span class="quoted"><span class="quoted">"adj_mat <span class="free">B</span> <span class="main">∈</span> carrier_mat <span class="skolem">n</span> <span class="skolem">n</span> <span class="main">∧</span> <span class="free">B</span> <span class="main">*</span> adj_mat <span class="free">B</span> <span class="main">=</span> det <span class="free">B</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>m</sub></span> <span class="keyword1">1<span class="hidden">⇩</span><sub>m</sub></span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> c1 adj_mat <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> c2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">1</span><span class="main">/</span>det <span class="free">B</span><span class="main">)</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>m</sub></span> adj_mat <span class="free">B</span><span class="main">)</span> <span class="main">∈</span> carrier_mat <span class="skolem">n</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> f6<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="main">1</span><span class="main">/</span>det <span class="free">B</span><span class="main">)</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>m</sub></span> adj_mat <span class="free">B</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>m</sub></span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> c1 f1 f5 mult_smult_distrib<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">B</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">=</span> <span class="main">(</span><span class="free">A</span> <span class="main">*</span> <span class="free">B</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="main">1</span><span class="main">/</span>det <span class="free">B</span><span class="main">)</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>m</sub></span> adj_mat <span class="free">B</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> c0 c1 c2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span>det <span class="free">B</span><span class="main">)</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>m</sub></span> adj_mat <span class="free">B</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> f0 c2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> c0 c1 f6 inverts_mat_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Quantum-sum_of_unit_vec_length"><span class="command">lemma</span></span> sum_of_unit_vec_length<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">i</span> <span class="free">j</span> <span class="free">n</span><span class="main">::</span> <span class="quoted">nat</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">c</span><span class="main">::</span> <span class="quoted">complex</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≠</span> <span class="free">j</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∥</span>unit_vec <span class="free">n</span> <span class="free">i</span> <span class="main">+</span> <span class="free">c</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> unit_vec <span class="free">n</span> <span class="free">j</span><span class="main">∥</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">=</span> <span class="main">1</span> <span class="main">+</span> cnj<span class="main">(</span><span class="free">c</span><span class="main">)</span> <span class="main">*</span> <span class="free">c</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span> d0<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">=</span> unit_vec <span class="free">n</span> <span class="free">i</span> <span class="main">+</span> <span class="free">c</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> unit_vec <span class="free">n</span> <span class="free">j</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">k</span></span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> <span class="skolem">v</span> <span class="main">$</span> <span class="bound">k</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="free">i</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="free">j</span> <span class="keyword1">then</span> <span class="free">c</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> d0 assms<span class="main">(</span>1<span class="main">,</span>2<span class="main">,</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">k</span></span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> cnj <span class="main">(</span><span class="skolem">v</span> <span class="main">$</span> <span class="bound">k</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">v</span> <span class="main">$</span> <span class="bound">k</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="free">i</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="free">j</span> <span class="keyword1">then</span> cnj<span class="main">(</span><span class="free">c</span><span class="main">)</span> <span class="main">*</span> <span class="free">c</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∥</span><span class="skolem">v</span><span class="main">∥</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span> <span class="main">=</span> <span class="main">0</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">.</span> cnj <span class="main">(</span><span class="skolem">v</span> <span class="main">$</span> <span class="bound">k</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">v</span> <span class="main">$</span> <span class="bound">k</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> d0 assms cpx_vec_length_inner_prod inner_prod_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> d0 assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum.distrib<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Quantum-sum_of_unit_vec_to_col"><span class="command">lemma</span></span> sum_of_unit_vec_to_col<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"dim_col <span class="free">A</span> <span class="main">=</span> <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"col <span class="free">A</span> <span class="free">i</span> <span class="main">+</span> <span class="free">c</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> col <span class="free">A</span> <span class="free">j</span> <span class="main">=</span> <span class="free">A</span> <span class="main">*</span> <span class="main">|</span>unit_vec <span class="free">n</span> <span class="free">i</span> <span class="main">+</span> <span class="free">c</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> unit_vec <span class="free">n</span> <span class="free">j</span><span class="main">⟩</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_vec <span class="main">(</span>col <span class="free">A</span> <span class="free">i</span> <span class="main">+</span> <span class="free">c</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> col <span class="free">A</span> <span class="free">j</span><span class="main">)</span> <span class="main">=</span> dim_vec <span class="main">(</span>col_fst <span class="main">(</span><span class="free">A</span> <span class="main">*</span> <span class="main">|</span>unit_vec <span class="free">n</span> <span class="free">i</span> <span class="main">+</span> <span class="free">c</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> unit_vec <span class="free">n</span> <span class="free">j</span><span class="main">⟩</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">k</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">&lt;</span> dim_vec <span class="main">(</span>col_fst <span class="main">(</span><span class="free">A</span> <span class="main">*</span> <span class="main">|</span>unit_vec <span class="free">n</span> <span class="free">i</span> <span class="main">+</span> <span class="free">c</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> unit_vec <span class="free">n</span> <span class="free">j</span><span class="main">⟩</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> f0<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">&lt;</span> dim_row <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>col <span class="free">A</span> <span class="free">i</span> <span class="main">+</span> <span class="free">c</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> col <span class="free">A</span> <span class="free">j</span><span class="main">)</span> <span class="main">$</span> <span class="skolem">k</span> <span class="main">=</span> <span class="free">A</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">k</span><span class="main">,</span> <span class="free">i</span><span class="main">)</span> <span class="main">+</span> <span class="free">c</span> <span class="main">*</span> <span class="free">A</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">k</span><span class="main">,</span> <span class="free">j</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> f0 assms<span class="main">(</span>1-3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">k</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">if</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">i</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span> <span class="main">+</span> <span class="free">c</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">j</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
                 <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">k</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">i</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> 
                 <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">k</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="free">c</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">j</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum.distrib <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">x</span></span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">k</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">i</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">i</span> <span class="keyword1">then</span> <span class="free">A</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">k</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">x</span></span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">k</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="free">c</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">j</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">j</span> <span class="keyword1">then</span> <span class="free">A</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">k</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="free">c</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>col <span class="free">A</span> <span class="free">i</span> <span class="main">+</span> <span class="free">c</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> col <span class="free">A</span> <span class="free">j</span><span class="main">)</span> <span class="main">$</span> <span class="skolem">k</span> <span class="main">=</span> col_fst <span class="main">(</span><span class="free">A</span> <span class="main">*</span> <span class="main">|</span>unit_vec <span class="free">n</span> <span class="free">i</span> <span class="main">+</span> <span class="free">c</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> unit_vec <span class="free">n</span> <span class="free">j</span><span class="main">⟩</span><span class="main">)</span> <span class="main">$</span> <span class="skolem">k</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> f0 assms<span class="main">(</span>1-3<span class="main">)</span> times_mat_def scalar_prod_def ket_vec_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Quantum-inner_prod_is_sesquilinear"><span class="command">lemma</span></span> inner_prod_is_sesquilinear<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">u1</span> <span class="free">u2</span> <span class="free">v1</span> <span class="free">v2</span><span class="main">::</span> <span class="quoted"><span class="quoted">"complex vec"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">c1</span> <span class="free">c2</span> <span class="free">c3</span> <span class="free">c4</span><span class="main">::</span> <span class="quoted">complex</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">n</span><span class="main">::</span> <span class="quoted">nat</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"dim_vec <span class="free">u1</span> <span class="main">=</span> <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"dim_vec <span class="free">u2</span> <span class="main">=</span> <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"dim_vec <span class="free">v1</span> <span class="main">=</span> <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"dim_vec <span class="free">v2</span> <span class="main">=</span> <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">c1</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">u1</span> <span class="main">+</span> <span class="free">c2</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">u2</span><span class="main">|</span><span class="free">c3</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">v1</span> <span class="main">+</span> <span class="free">c4</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">v2</span><span class="main">⟩</span> <span class="main">=</span> cnj <span class="main">(</span><span class="free">c1</span><span class="main">)</span> <span class="main">*</span> <span class="free">c3</span> <span class="main">*</span> <span class="main">⟨</span><span class="free">u1</span><span class="main">|</span><span class="free">v1</span><span class="main">⟩</span> <span class="main">+</span> cnj <span class="main">(</span><span class="free">c2</span><span class="main">)</span> <span class="main">*</span> <span class="free">c3</span> <span class="main">*</span> <span class="main">⟨</span><span class="free">u2</span><span class="main">|</span><span class="free">v1</span><span class="main">⟩</span> <span class="main">+</span> 
                                                 cnj <span class="main">(</span><span class="free">c1</span><span class="main">)</span> <span class="main">*</span> <span class="free">c4</span> <span class="main">*</span> <span class="main">⟨</span><span class="free">u1</span><span class="main">|</span><span class="free">v2</span><span class="main">⟩</span> <span class="main">+</span> cnj <span class="main">(</span><span class="free">c2</span><span class="main">)</span> <span class="main">*</span> <span class="free">c4</span> <span class="main">*</span> <span class="main">⟨</span><span class="free">u2</span><span class="main">|</span><span class="free">v2</span><span class="main">⟩</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">c1</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">u1</span> <span class="main">+</span> <span class="free">c2</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">u2</span><span class="main">|</span><span class="free">c3</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">v1</span> <span class="main">+</span> <span class="free">c4</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">v2</span><span class="main">⟩</span> <span class="main">=</span> <span class="free">c3</span> <span class="main">*</span> <span class="main">⟨</span><span class="free">c1</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">u1</span> <span class="main">+</span> <span class="free">c2</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">u2</span><span class="main">|</span><span class="free">v1</span><span class="main">⟩</span> <span class="main">+</span> <span class="free">c4</span> <span class="main">*</span> <span class="main">⟨</span><span class="free">c1</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">u1</span> <span class="main">+</span> <span class="free">c2</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">u2</span><span class="main">|</span><span class="free">v2</span><span class="main">⟩</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> inner_prod_is_linear<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">c1</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">u1</span> <span class="main">+</span> <span class="free">c2</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">u2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="free">v1</span> <span class="keyword1">else</span> <span class="free">v2</span>"</span></span> 
                                  <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="free">c3</span> <span class="keyword1">else</span> <span class="free">c4</span>"</span></span><span class="main">]</span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">c3</span> <span class="main">*</span> cnj<span class="main">(</span><span class="main">⟨</span><span class="free">v1</span><span class="main">|</span><span class="free">c1</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">u1</span> <span class="main">+</span> <span class="free">c2</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">u2</span><span class="main">⟩</span><span class="main">)</span> <span class="main">+</span> <span class="free">c4</span> <span class="main">*</span> cnj<span class="main">(</span><span class="main">⟨</span><span class="free">v2</span><span class="main">|</span><span class="free">c1</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">u1</span> <span class="main">+</span> <span class="free">c2</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">u2</span><span class="main">⟩</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms inner_prod_cnj<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">v1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">c1</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">u1</span> <span class="main">+</span> <span class="free">c2</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">u2</span>"</span></span><span class="main">]</span> inner_prod_cnj<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">v2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">c1</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">u1</span> <span class="main">+</span> <span class="free">c2</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">u2</span>"</span></span><span class="main">]</span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">c3</span> <span class="main">*</span> cnj<span class="main">(</span><span class="free">c1</span> <span class="main">*</span> <span class="main">⟨</span><span class="free">v1</span><span class="main">|</span><span class="free">u1</span><span class="main">⟩</span> <span class="main">+</span> <span class="free">c2</span> <span class="main">*</span> <span class="main">⟨</span><span class="free">v1</span><span class="main">|</span><span class="free">u2</span><span class="main">⟩</span><span class="main">)</span> <span class="main">+</span> <span class="free">c4</span> <span class="main">*</span> cnj<span class="main">(</span><span class="free">c1</span> <span class="main">*</span> <span class="main">⟨</span><span class="free">v2</span><span class="main">|</span><span class="free">u1</span><span class="main">⟩</span> <span class="main">+</span> <span class="free">c2</span> <span class="main">*</span> <span class="main">⟨</span><span class="free">v2</span><span class="main">|</span><span class="free">u2</span><span class="main">⟩</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> inner_prod_is_linear<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">v1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="free">u1</span> <span class="keyword1">else</span> <span class="free">u2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="free">c1</span> <span class="keyword1">else</span> <span class="free">c2</span>"</span></span><span class="main">]</span> 
          inner_prod_is_linear<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">v2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="free">u1</span> <span class="keyword1">else</span> <span class="free">u2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="free">c1</span> <span class="keyword1">else</span> <span class="free">c2</span>"</span></span><span class="main">]</span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">c3</span> <span class="main">*</span> <span class="main">(</span>cnj<span class="main">(</span><span class="free">c1</span><span class="main">)</span> <span class="main">*</span> <span class="main">⟨</span><span class="free">u1</span><span class="main">|</span><span class="free">v1</span><span class="main">⟩</span> <span class="main">+</span> cnj<span class="main">(</span><span class="free">c2</span><span class="main">)</span> <span class="main">*</span> <span class="main">⟨</span><span class="free">u2</span><span class="main">|</span><span class="free">v1</span><span class="main">⟩</span><span class="main">)</span> <span class="main">+</span> 
                   <span class="free">c4</span> <span class="main">*</span> <span class="main">(</span>cnj<span class="main">(</span><span class="free">c1</span><span class="main">)</span> <span class="main">*</span> <span class="main">⟨</span><span class="free">u1</span><span class="main">|</span><span class="free">v2</span><span class="main">⟩</span> <span class="main">+</span> cnj<span class="main">(</span><span class="free">c2</span><span class="main">)</span> <span class="main">*</span> <span class="main">⟨</span><span class="free">u2</span><span class="main">|</span><span class="free">v2</span><span class="main">⟩</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> inner_prod_cnj<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">v1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">u1</span>"</span></span><span class="main">]</span> inner_prod_cnj<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">v1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">u2</span>"</span></span><span class="main">]</span> 
          inner_prod_cnj<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">v2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">u1</span>"</span></span><span class="main">]</span> inner_prod_cnj<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">v2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">u2</span>"</span></span><span class="main">]</span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
A length-preserving matrix is unitary. So, unitary matrices are exactly the length-preserving
matrices.
›</span></span>

<span class="keyword1" id="Quantum-length_preserving_is_unitary"><span class="command">lemma</span></span> length_preserving_is_unitary<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">U</span><span class="main">::</span> <span class="quoted"><span class="quoted">"complex mat"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"square_mat <span class="free">U</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">v</span><span class="main">::</span>complex vec<span class="main">.</span> dim_vec <span class="bound">v</span> <span class="main">=</span> dim_col <span class="free">U</span> <span class="main">⟶</span> <span class="main">∥</span><span class="free">U</span> <span class="main">*</span> <span class="main">|</span><span class="bound">v</span><span class="main">⟩</span><span class="main">∥</span> <span class="main">=</span> <span class="main">∥</span><span class="bound">v</span><span class="main">∥</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"unitary <span class="free">U</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> dim_col <span class="free">U</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> c0<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">U</span> <span class="main">∈</span> carrier_mat <span class="skolem">n</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> c1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">U</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span> <span class="main">∈</span> carrier_mat <span class="skolem">n</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> dagger_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> f0<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">U</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span><span class="main">)</span> <span class="main">*</span> <span class="free">U</span> <span class="main">=</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>m</sub></span> <span class="main">(</span>dim_col <span class="free">U</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_row <span class="main">(</span><span class="free">U</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span> <span class="main">*</span> <span class="free">U</span><span class="main">)</span> <span class="main">=</span> dim_row <span class="main">(</span><span class="keyword1">1<span class="hidden">⇩</span><sub>m</sub></span> <span class="main">(</span>dim_col <span class="free">U</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> c0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_col <span class="main">(</span><span class="free">U</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span> <span class="main">*</span> <span class="free">U</span><span class="main">)</span> <span class="main">=</span> dim_col <span class="main">(</span><span class="keyword1">1<span class="hidden">⇩</span><sub>m</sub></span> <span class="main">(</span>dim_col <span class="free">U</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> c0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> dim_row <span class="main">(</span><span class="keyword1">1<span class="hidden">⇩</span><sub>m</sub></span> <span class="main">(</span>dim_col <span class="free">U</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> dim_col <span class="main">(</span><span class="keyword1">1<span class="hidden">⇩</span><sub>m</sub></span> <span class="main">(</span>dim_col <span class="free">U</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> a0<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="skolem">n</span> <span class="main">∧</span> <span class="skolem">j</span> <span class="main">&lt;</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> c0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> f1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">l</span><span class="main">.</span> <span class="bound">l</span><span class="main">&lt;</span><span class="skolem">n</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">&lt;</span><span class="skolem">n</span><span class="main">.</span> cnj <span class="main">(</span><span class="free">U</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">l</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="free">U</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">l</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">l</span> <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">l</span><span class="main">&lt;</span><span class="skolem">n</span>"</span></span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">v</span></span><span class="main">::</span><span class="quoted"><span class="quoted">"complex vec"</span></span> <span class="keyword2"><span class="keyword">where</span></span> d1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">=</span> unit_vec <span class="skolem">n</span> <span class="skolem">l</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∥</span>col <span class="free">U</span> <span class="skolem">l</span><span class="main">∥</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">&lt;</span><span class="skolem">n</span><span class="main">.</span> cnj <span class="main">(</span><span class="free">U</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="skolem">l</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="free">U</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="skolem">l</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> c0 a1 cpx_vec_length_inner_prod inner_prod_def lessThan_atLeast0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∥</span>col <span class="free">U</span> <span class="skolem">l</span><span class="main">∥</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">=</span> <span class="main">∥</span><span class="skolem">v</span><span class="main">∥</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> c0 d1 a1 assms<span class="main">(</span>2<span class="main">)</span> unit_vec_to_col <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∥</span><span class="skolem">v</span><span class="main">∥</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> d1 a1 cpx_vec_length_inner_prod <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">&lt;</span><span class="skolem">n</span><span class="main">.</span> cnj <span class="main">(</span><span class="free">U</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="skolem">l</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="free">U</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="skolem">l</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≠</span> <span class="skolem">j</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">&lt;</span><span class="skolem">n</span><span class="main">.</span> cnj <span class="main">(</span><span class="free">U</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="free">U</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> a2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≠</span> <span class="skolem">j</span>"</span></span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">v1</span></span><span class="main">::</span><span class="quoted"><span class="quoted">"complex vec"</span></span> <span class="keyword2"><span class="keyword">where</span></span> d1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">v1</span> <span class="main">=</span> unit_vec <span class="skolem">n</span> <span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> unit_vec <span class="skolem">n</span> <span class="skolem">j</span>"</span></span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">v2</span></span><span class="main">::</span><span class="quoted"><span class="quoted">"complex vec"</span></span> <span class="keyword2"><span class="keyword">where</span></span> d2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">v2</span> <span class="main">=</span> unit_vec <span class="skolem">n</span> <span class="skolem">i</span> <span class="main">+</span> <span class="keyword1">𝗂</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> unit_vec <span class="skolem">n</span> <span class="skolem">j</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∥</span><span class="skolem">v1</span><span class="main">∥</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">=</span> <span class="main">1</span> <span class="main">+</span> cnj <span class="main">1</span> <span class="main">*</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> d1 a0 a2 sum_of_unit_vec_length <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∥</span><span class="skolem">v1</span><span class="main">∥</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">=</span> <span class="numeral">2</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> complex_cnj_one cpx_vec_length_inner_prod mult.left_neutral of_real_eq_iff 
            of_real_numeral one_add_one<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∥</span><span class="free">U</span> <span class="main">*</span> <span class="main">|</span><span class="skolem">v1</span><span class="main">⟩</span><span class="main">∥</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">=</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> c0 d1 assms<span class="main">(</span>2<span class="main">)</span> unit_vec_to_col <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"col <span class="free">U</span> <span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> col <span class="free">U</span> <span class="skolem">j</span> <span class="main">=</span> <span class="free">U</span> <span class="main">*</span> <span class="main">|</span><span class="skolem">v1</span><span class="main">⟩</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> c0 d1 a0 sum_of_unit_vec_to_col <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"col <span class="free">U</span> <span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> col <span class="free">U</span> <span class="skolem">j</span> <span class="main">=</span> col <span class="free">U</span> <span class="skolem">i</span> <span class="main">+</span> col <span class="free">U</span> <span class="skolem">j</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span>col <span class="free">U</span> <span class="skolem">i</span> <span class="main">+</span> col <span class="free">U</span> <span class="skolem">j</span><span class="main">|</span>col <span class="free">U</span> <span class="skolem">i</span> <span class="main">+</span> col <span class="free">U</span> <span class="skolem">j</span><span class="main">⟩</span> <span class="main">=</span> <span class="numeral">2</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> cpx_vec_length_inner_prod <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> of_real_numeral<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span>col <span class="free">U</span> <span class="skolem">i</span> <span class="main">+</span> col <span class="free">U</span> <span class="skolem">j</span><span class="main">|</span>col <span class="free">U</span> <span class="skolem">i</span> <span class="main">+</span> col <span class="free">U</span> <span class="skolem">j</span><span class="main">⟩</span> <span class="main">=</span> 
               <span class="main">⟨</span>col <span class="free">U</span> <span class="skolem">i</span><span class="main">|</span>col <span class="free">U</span> <span class="skolem">i</span><span class="main">⟩</span> <span class="main">+</span> <span class="main">⟨</span>col <span class="free">U</span> <span class="skolem">j</span><span class="main">|</span>col <span class="free">U</span> <span class="skolem">i</span><span class="main">⟩</span> <span class="main">+</span> <span class="main">⟨</span>col <span class="free">U</span> <span class="skolem">i</span><span class="main">|</span>col <span class="free">U</span> <span class="skolem">j</span><span class="main">⟩</span> <span class="main">+</span> <span class="main">⟨</span>col <span class="free">U</span> <span class="skolem">j</span><span class="main">|</span>col <span class="free">U</span> <span class="skolem">j</span><span class="main">⟩</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> inner_prod_is_sesquilinear<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"col <span class="free">U</span> <span class="skolem">i</span>"</span></span> <span class="quoted"><span class="quoted">"dim_row <span class="free">U</span>"</span></span> <span class="quoted"><span class="quoted">"col <span class="free">U</span> <span class="skolem">j</span>"</span></span> <span class="quoted"><span class="quoted">"col <span class="free">U</span> <span class="skolem">i</span>"</span></span> <span class="quoted"><span class="quoted">"col <span class="free">U</span> <span class="skolem">j</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span>"</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> f2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⟨</span>col <span class="free">U</span> <span class="skolem">j</span><span class="main">|</span>col <span class="free">U</span> <span class="skolem">i</span><span class="main">⟩</span> <span class="main">+</span> <span class="main">⟨</span>col <span class="free">U</span> <span class="skolem">i</span><span class="main">|</span>col <span class="free">U</span> <span class="skolem">j</span><span class="main">⟩</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> c0 a0 f1 inner_prod_def lessThan_atLeast0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∥</span><span class="skolem">v2</span><span class="main">∥</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">=</span> <span class="main">1</span> <span class="main">+</span> cnj <span class="keyword1">𝗂</span> <span class="main">*</span> <span class="keyword1">𝗂</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a0 a2 d2 sum_of_unit_vec_length <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∥</span><span class="skolem">v2</span><span class="main">∥</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">=</span> <span class="numeral">2</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Re_complex_of_real complex_norm_square mult.commute norm_ii numeral_Bit0 
            numeral_One numeral_eq_one_iff of_real_numeral one_power2<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∥</span><span class="free">U</span> <span class="main">*</span> <span class="main">|</span><span class="skolem">v2</span><span class="main">⟩</span><span class="main">∥</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">=</span> <span class="main">∥</span><span class="skolem">v2</span><span class="main">∥</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> c0 d2 assms<span class="main">(</span>2<span class="main">)</span> unit_vec_to_col <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span>col <span class="free">U</span> <span class="skolem">i</span> <span class="main">+</span> <span class="keyword1">𝗂</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> col <span class="free">U</span> <span class="skolem">j</span><span class="main">|</span>col <span class="free">U</span> <span class="skolem">i</span> <span class="main">+</span> <span class="keyword1">𝗂</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> col <span class="free">U</span> <span class="skolem">j</span><span class="main">⟩</span> <span class="main">=</span> <span class="main">∥</span><span class="free">U</span> <span class="main">*</span> <span class="main">|</span><span class="skolem">v2</span><span class="main">⟩</span><span class="main">∥</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> c0 a0 d2 sum_of_unit_vec_to_col cpx_vec_length_inner_prod <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span>col <span class="free">U</span> <span class="skolem">i</span> <span class="main">+</span> <span class="keyword1">𝗂</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> col <span class="free">U</span> <span class="skolem">j</span><span class="main">|</span>col <span class="free">U</span> <span class="skolem">i</span> <span class="main">+</span> <span class="keyword1">𝗂</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> col <span class="free">U</span> <span class="skolem">j</span><span class="main">⟩</span> <span class="main">=</span> 
                     <span class="main">⟨</span>col <span class="free">U</span> <span class="skolem">i</span><span class="main">|</span>col <span class="free">U</span> <span class="skolem">i</span><span class="main">⟩</span> <span class="main">+</span> <span class="main">(</span><span class="main">-</span><span class="keyword1">𝗂</span><span class="main">)</span> <span class="main">*</span> <span class="main">⟨</span>col <span class="free">U</span> <span class="skolem">j</span><span class="main">|</span>col <span class="free">U</span> <span class="skolem">i</span><span class="main">⟩</span> <span class="main">+</span> <span class="keyword1">𝗂</span> <span class="main">*</span> <span class="main">⟨</span>col <span class="free">U</span> <span class="skolem">i</span><span class="main">|</span>col <span class="free">U</span> <span class="skolem">j</span><span class="main">⟩</span> <span class="main">+</span> <span class="main">⟨</span>col <span class="free">U</span> <span class="skolem">j</span><span class="main">|</span>col <span class="free">U</span> <span class="skolem">j</span><span class="main">⟩</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> inner_prod_is_sesquilinear<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"col <span class="free">U</span> <span class="skolem">i</span>"</span></span> <span class="quoted"><span class="quoted">"dim_row <span class="free">U</span>"</span></span> <span class="quoted"><span class="quoted">"col <span class="free">U</span> <span class="skolem">j</span>"</span></span> <span class="quoted"><span class="quoted">"col <span class="free">U</span> <span class="skolem">i</span>"</span></span> <span class="quoted"><span class="quoted">"col <span class="free">U</span> <span class="skolem">j</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">𝗂</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">𝗂</span>"</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span>col <span class="free">U</span> <span class="skolem">j</span><span class="main">|</span>col <span class="free">U</span> <span class="skolem">i</span><span class="main">⟩</span> <span class="main">-</span> <span class="main">⟨</span>col <span class="free">U</span> <span class="skolem">i</span><span class="main">|</span>col <span class="free">U</span> <span class="skolem">j</span><span class="main">⟩</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> c0 a0 f1 inner_prod_def lessThan_atLeast0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">&lt;</span><span class="skolem">n</span><span class="main">.</span> cnj <span class="main">(</span><span class="free">U</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="free">U</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> c0 a0 f2 lessThan_atLeast0 inner_prod_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">U</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span> <span class="main">*</span> <span class="free">U</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>m</sub></span> <span class="main">(</span>dim_col <span class="free">U</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> c0 assms<span class="main">(</span>1<span class="main">)</span> a0 one_mat_def dagger_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">U</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span><span class="main">)</span> <span class="main">*</span> <span class="free">U</span> <span class="main">=</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>m</sub></span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> c0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inverts_mat <span class="main">(</span><span class="free">U</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span><span class="main">)</span> <span class="free">U</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> c1 inverts_mat_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inverts_mat <span class="free">U</span> <span class="main">(</span><span class="free">U</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> c0 c1 inverts_mat_sym <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">U</span> <span class="main">*</span> <span class="main">(</span><span class="free">U</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>m</sub></span> <span class="main">(</span>dim_row <span class="free">U</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> c0 inverts_mat_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> f0 unitary_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Quantum-inner_prod_with_unitary_mat"><span class="command">lemma</span></span> inner_prod_with_unitary_mat <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"unitary <span class="free">U</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"dim_vec <span class="free">u</span> <span class="main">=</span> dim_col <span class="free">U</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"dim_vec <span class="free">v</span> <span class="main">=</span> dim_col <span class="free">U</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">U</span> <span class="main">*</span> <span class="main">|</span><span class="free">u</span><span class="main">⟩</span><span class="main">|</span><span class="free">U</span> <span class="main">*</span> <span class="main">|</span><span class="free">v</span><span class="main">⟩</span><span class="main">⟩</span> <span class="main">=</span> <span class="main">⟨</span><span class="free">u</span><span class="main">|</span><span class="free">v</span><span class="main">⟩</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> f1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">U</span> <span class="main">*</span> <span class="main">|</span><span class="free">u</span><span class="main">⟩</span><span class="main">|</span><span class="free">U</span> <span class="main">*</span> <span class="main">|</span><span class="free">v</span><span class="main">⟩</span><span class="main">⟩</span> <span class="main">=</span> <span class="main">(</span><span class="main">⟨</span><span class="main">|</span><span class="free">u</span><span class="main">⟩</span><span class="main">|</span> <span class="main">*</span> <span class="main">(</span><span class="free">U</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span><span class="main">)</span> <span class="main">*</span> <span class="free">U</span> <span class="main">*</span> <span class="main">|</span><span class="free">v</span><span class="main">⟩</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2-3<span class="main">)</span> bra_mat_on_vec mult_ket_vec_is_ket_vec_of_mult
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> assoc_mult_mat carrier_mat_triv col_fst_def dim_vec dim_col_of_dagger index_mult_mat<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> 
        index_mult_mat<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> inner_prod_with_times_mat ket_vec_def mat_carrier<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> f2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="main">|</span><span class="free">u</span><span class="main">⟩</span><span class="main">|</span> <span class="main">∈</span> carrier_mat <span class="main">1</span> <span class="main">(</span>dim_vec <span class="free">v</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> bra_def ket_vec_def assms<span class="main">(</span>2-3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> f3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">U</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span> <span class="main">∈</span> carrier_mat <span class="main">(</span>dim_col <span class="free">U</span><span class="main">)</span> <span class="main">(</span>dim_row <span class="free">U</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> dagger_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">U</span> <span class="main">*</span> <span class="main">|</span><span class="free">u</span><span class="main">⟩</span><span class="main">|</span><span class="free">U</span> <span class="main">*</span> <span class="main">|</span><span class="free">v</span><span class="main">⟩</span><span class="main">⟩</span> <span class="main">=</span> <span class="main">(</span><span class="main">⟨</span><span class="main">|</span><span class="free">u</span><span class="main">⟩</span><span class="main">|</span> <span class="main">*</span> <span class="main">(</span><span class="free">U</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span> <span class="main">*</span> <span class="free">U</span><span class="main">)</span> <span class="main">*</span> <span class="main">|</span><span class="free">v</span><span class="main">⟩</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span> assoc_mult_mat <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> carrier_mat_triv<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">⟨</span><span class="main">|</span><span class="free">u</span><span class="main">⟩</span><span class="main">|</span> <span class="main">*</span> <span class="main">|</span><span class="free">v</span><span class="main">⟩</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> unitary_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> bra_def ket_vec_def<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2-3<span class="main">)</span> inner_prod_with_times_mat <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹As a consequence we prove that columns and rows of a unitary matrix are orthonormal vectors.›</span></span>

<span class="keyword1" id="Quantum-unitary_unit_col"><span class="command">lemma</span></span> unitary_unit_col <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"unitary <span class="free">U</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"dim_col <span class="free">U</span> <span class="main">=</span> <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∥</span>col <span class="free">U</span> <span class="free">i</span><span class="main">∥</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms unit_vec_to_col unitary_is_length_preserving <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Quantum-unitary_unit_row"><span class="command">lemma</span></span> unitary_unit_row <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"unitary <span class="free">U</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"dim_row <span class="free">U</span> <span class="main">=</span> <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∥</span>row <span class="free">U</span> <span class="free">i</span><span class="main">∥</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"row <span class="free">U</span> <span class="free">i</span> <span class="main">=</span> col <span class="main">(</span><span class="free">U</span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup></span><span class="main">)</span> <span class="free">i</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span>  assms<span class="main">(</span>2-3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms transpose_of_unitary_is_unitary unitary_unit_col
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> index_transpose_mat<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Quantum-orthogonal_col_of_unitary"><span class="command">lemma</span></span> orthogonal_col_of_unitary <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"unitary <span class="free">U</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"dim_col <span class="free">U</span> <span class="main">=</span> <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≠</span> <span class="free">j</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span>col <span class="free">U</span> <span class="free">i</span><span class="main">|</span>col <span class="free">U</span> <span class="free">j</span><span class="main">⟩</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span>col <span class="free">U</span> <span class="free">i</span><span class="main">|</span>col <span class="free">U</span> <span class="free">j</span><span class="main">⟩</span> <span class="main">=</span> <span class="main">⟨</span><span class="free">U</span> <span class="main">*</span> <span class="main">|</span>unit_vec <span class="free">n</span> <span class="free">i</span><span class="main">⟩</span><span class="main">|</span> <span class="free">U</span> <span class="main">*</span> <span class="main">|</span>unit_vec <span class="free">n</span> <span class="free">j</span><span class="main">⟩</span><span class="main">⟩</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2-4<span class="main">)</span> unit_vec_to_col <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">⟨</span>unit_vec <span class="free">n</span> <span class="free">i</span> <span class="main">|</span>unit_vec <span class="free">n</span> <span class="free">j</span><span class="main">⟩</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1-2<span class="main">)</span> inner_prod_with_unitary_mat index_unit_vec<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3-5<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Quantum-orthogonal_row_of_unitary"><span class="command">lemma</span></span> orthogonal_row_of_unitary <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">U</span><span class="main">::</span><span class="quoted"><span class="quoted">"complex mat"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"unitary <span class="free">U</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"dim_row <span class="free">U</span> <span class="main">=</span> <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≠</span> <span class="free">j</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span>row <span class="free">U</span> <span class="free">i</span><span class="main">|</span>row <span class="free">U</span> <span class="free">j</span><span class="main">⟩</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms orthogonal_col_of_unitary transpose_of_unitary_is_unitary col_transpose
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> index_transpose_mat<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>


<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
As a consequence, we prove that a quantum gate acting on a state of a system of n qubits give 
another state of that same system.
›</span></span>

<span class="keyword1" id="Quantum-gate_on_state_is_state"><span class="command">lemma</span></span> gate_on_state_is_state <span class="main">[</span><span class="operator">intro</span><span class="main">,</span> <span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted">"gate <span class="free">n</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a2<span class="main">:</span><span class="quoted"><span class="quoted">"state <span class="free">n</span> <span class="free">v</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"state <span class="free">n</span> <span class="main">(</span><span class="free">A</span> <span class="main">*</span> <span class="free">v</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_row <span class="main">(</span><span class="free">A</span> <span class="main">*</span> <span class="free">v</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> gate_def state_def a1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_col <span class="main">(</span><span class="free">A</span> <span class="main">*</span> <span class="free">v</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> state_def a2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"square_mat <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> a1 gate_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"dim_col <span class="free">A</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> a1 gate.dim_row <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"dim_col <span class="free">A</span> <span class="main">=</span> dim_row <span class="free">v</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> a2 state.dim_row <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∥</span>col <span class="main">(</span><span class="free">A</span> <span class="main">*</span> <span class="free">v</span><span class="main">)</span> <span class="main">0</span><span class="main">∥</span> <span class="main">=</span> <span class="main">∥</span>col <span class="free">v</span> <span class="main">0</span><span class="main">∥</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> unitary_is_length_preserving_bis assms gate_def state_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span><span class="quoted"><span class="quoted">"<span class="main">∥</span>col <span class="main">(</span><span class="free">A</span> <span class="main">*</span> <span class="free">v</span><span class="main">)</span> <span class="main">0</span><span class="main">∥</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> a2 state.is_normal <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹A Few Well-known Quantum Gates›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
Any unitary operation on n qubits can be implemented exactly by composing single qubits and
CNOT-gates (controlled-NOT gates). However, no straightforward method is known to implement these 
gates in a fashion which is resistant to errors. But, the Hadamard gate, the phase gate, the 
CNOT-gate and the <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">"π/8"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> gate are also universal for quantum computations, i.e. any quantum circuit on 
n qubits can be approximated to an arbitrary accuracy by using only these gates, and these gates can 
be implemented in a fault-tolerant way. 
›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We introduce a coercion from real matrices to complex matrices.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">real_to_cpx_mat</span><span class="main">::</span> <span class="quoted"><span class="quoted">"real mat <span class="main">⇒</span> complex mat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">real_to_cpx_mat</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">≡</span> mat <span class="main">(</span>dim_row <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span> <span class="main">(</span>dim_col <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">$$</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Our first quantum gate: the identity matrix! Arguably, not a very interesting one though!›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Id</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> complex mat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">Id</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">≡</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>m</sub></span> <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Quantum-id_is_gate"><span class="command">lemma</span></span> id_is_gate <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"gate <span class="free">n</span> <span class="main">(</span>Id <span class="free">n</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_row <span class="main">(</span>Id <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Id_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"square_mat <span class="main">(</span>Id <span class="free">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Id_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"unitary <span class="main">(</span>Id <span class="free">n</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Id_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹More interesting: the Pauli matrices.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">X</span> <span class="main">::</span><span class="quoted"><span class="quoted">"complex mat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">≡</span> mat <span class="numeral">2</span> <span class="numeral">2</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">i</span><span class="main">=</span><span class="bound">j</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="main">1</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹ 
Be aware that <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">"gate n A"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> means that the matrix A has dimension <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">"2^n * 2^n"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>. 
For instance, with this convention a 2 X 2 matrix A which is unitary satisfies <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">"gate 1 A"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>
 but not <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">"gate 2 A"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> as one might have been expected.
›</span></span>

<span class="keyword1" id="Quantum-dagger_of_X"><span class="command">lemma</span></span> dagger_of_X <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"X<span class="main"><span class="hidden">⇧</span><sup>†</sup></span> <span class="main">=</span> X"</span></span>
  <span class="keyword1"><span class="command">using</span></span> dagger_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> X_def cong_mat<span class="main">)</span>

<span class="keyword1" id="Quantum-X_inv"><span class="command">lemma</span></span> X_inv <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"X <span class="main">*</span> X <span class="main">=</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>m</sub></span> <span class="numeral">2</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> X_def times_mat_def one_mat_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> cong_mat<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> scalar_prod_def<span class="main">)</span>

<span class="keyword1" id="Quantum-X_is_gate"><span class="command">lemma</span></span> X_is_gate <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"gate <span class="main">1</span> X"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> gate_def unitary_def<span class="main">)</span>
    <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> X_def<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Y</span> <span class="main">::</span><span class="quoted"><span class="quoted">"complex mat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">Y</span> <span class="main">≡</span> mat <span class="numeral">2</span> <span class="numeral">2</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">i</span><span class="main">=</span><span class="bound">j</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">i</span><span class="main">=</span><span class="main">0</span> <span class="keyword1">then</span> <span class="main">-</span><span class="keyword1">𝗂</span> <span class="keyword1">else</span> <span class="keyword1">𝗂</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Quantum-dagger_of_Y"><span class="command">lemma</span></span> dagger_of_Y <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"Y<span class="main"><span class="hidden">⇧</span><sup>†</sup></span> <span class="main">=</span> Y"</span></span>
  <span class="keyword1"><span class="command">using</span></span> dagger_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Y_def cong_mat<span class="main">)</span>

<span class="keyword1" id="Quantum-Y_inv"><span class="command">lemma</span></span> Y_inv <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"Y <span class="main">*</span> Y <span class="main">=</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>m</sub></span> <span class="numeral">2</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Y_def times_mat_def one_mat_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> cong_mat<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> scalar_prod_def<span class="main">)</span>

<span class="keyword1" id="Quantum-Y_is_gate"><span class="command">lemma</span></span> Y_is_gate <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"gate <span class="main">1</span> Y"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> gate_def unitary_def<span class="main">)</span>
    <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Y_def<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Z</span> <span class="main">::</span><span class="quoted"><span class="quoted">"complex mat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">Z</span> <span class="main">≡</span> mat <span class="numeral">2</span> <span class="numeral">2</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">i</span><span class="main">≠</span><span class="bound">j</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">i</span><span class="main">=</span><span class="main">0</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Quantum-dagger_of_Z"><span class="command">lemma</span></span> dagger_of_Z <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"Z<span class="main"><span class="hidden">⇧</span><sup>†</sup></span> <span class="main">=</span> Z"</span></span>
  <span class="keyword1"><span class="command">using</span></span> dagger_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Z_def cong_mat<span class="main">)</span>

<span class="keyword1" id="Quantum-Z_inv"><span class="command">lemma</span></span> Z_inv <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"Z <span class="main">*</span> Z <span class="main">=</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>m</sub></span> <span class="numeral">2</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Z_def times_mat_def one_mat_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> cong_mat<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> scalar_prod_def<span class="main">)</span>

<span class="keyword1" id="Quantum-Z_is_gate"><span class="command">lemma</span></span> Z_is_gate <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"gate <span class="main">1</span> Z"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> gate_def unitary_def<span class="main">)</span>
    <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Z_def<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The Hadamard gate›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">H</span> <span class="main">::</span><span class="quoted"><span class="quoted">"complex mat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">H</span> <span class="main">≡</span> <span class="main">1</span><span class="main">/</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>m</sub></span> <span class="main">(</span>mat <span class="numeral">2</span> <span class="numeral">2</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">i</span><span class="main">≠</span><span class="bound">j</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">i</span><span class="main">=</span><span class="main">0</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Quantum-H_without_scalar_prod"><span class="command">lemma</span></span> H_without_scalar_prod<span class="main">:</span>
  <span class="quoted"><span class="quoted">"H <span class="main">=</span> mat <span class="numeral">2</span> <span class="numeral">2</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">i</span><span class="main">≠</span><span class="bound">j</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">/</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">i</span><span class="main">=</span><span class="main">0</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">/</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">/</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> cong_mat <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> H_def<span class="main">)</span>

<span class="keyword1" id="Quantum-dagger_of_H"><span class="command">lemma</span></span> dagger_of_H <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"H<span class="main"><span class="hidden">⇧</span><sup>†</sup></span> <span class="main">=</span> H"</span></span>
  <span class="keyword1"><span class="command">using</span></span> dagger_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> H_def cong_mat<span class="main">)</span>

<span class="keyword1" id="Quantum-H_inv"><span class="command">lemma</span></span> H_inv <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"H <span class="main">*</span> H <span class="main">=</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>m</sub></span> <span class="numeral">2</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> H_def times_mat_def one_mat_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> cong_mat<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> scalar_prod_def complex_eqI<span class="main">)</span>

<span class="keyword1" id="Quantum-H_is_gate"><span class="command">lemma</span></span> H_is_gate <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"gate <span class="main">1</span> H"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> gate_def unitary_def<span class="main">)</span>
    <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> H_def<span class="main">)</span>

<span class="keyword1" id="Quantum-H_values"><span class="command">lemma</span></span> H_values<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">i</span> <span class="free">j</span><span class="main">::</span> <span class="quoted">nat</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> dim_row H"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">&lt;</span> dim_col H"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≠</span> <span class="main">1</span> <span class="main">∨</span> <span class="free">j</span> <span class="main">≠</span> <span class="main">1</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"H <span class="main">$$</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="free">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span><span class="main">/</span>sqrt <span class="numeral">2</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> H_without_scalar_prod less_2_cases<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">&lt;</span> <span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> H_without_scalar_prod less_2_cases<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span> H_without_scalar_prod <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">smt</span> One_nat_def index_mat<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> less_2_cases old.prod.case<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Quantum-H_values_right_bottom"><span class="command">lemma</span></span> H_values_right_bottom<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">i</span> <span class="free">j</span><span class="main">::</span> <span class="quoted">nat</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">=</span> <span class="main">1</span> <span class="main">∧</span> <span class="free">j</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"H <span class="main">$$</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="free">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span> <span class="main">1</span><span class="main">/</span>sqrt <span class="numeral">2</span>"</span></span>     
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> H_without_scalar_prod<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The controlled-NOT gate›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">CNOT</span> <span class="main">::</span><span class="quoted"><span class="quoted">"complex mat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">CNOT</span> <span class="main">≡</span> mat <span class="numeral">4</span> <span class="numeral">4</span> 
  <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">i</span><span class="main">=</span><span class="main">0</span> <span class="main">∧</span> <span class="bound">j</span><span class="main">=</span><span class="main">0</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> 
    <span class="main">(</span><span class="keyword1">if</span> <span class="bound">i</span><span class="main">=</span><span class="main">1</span> <span class="main">∧</span> <span class="bound">j</span><span class="main">=</span><span class="main">1</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> 
      <span class="main">(</span><span class="keyword1">if</span> <span class="bound">i</span><span class="main">=</span><span class="numeral">2</span> <span class="main">∧</span> <span class="bound">j</span><span class="main">=</span><span class="numeral">3</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> 
        <span class="main">(</span><span class="keyword1">if</span> <span class="bound">i</span><span class="main">=</span><span class="numeral">3</span> <span class="main">∧</span> <span class="bound">j</span><span class="main">=</span><span class="numeral">2</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Quantum-dagger_of_CNOT"><span class="command">lemma</span></span> dagger_of_CNOT <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"CNOT<span class="main"><span class="hidden">⇧</span><sup>†</sup></span> <span class="main">=</span> CNOT"</span></span>
  <span class="keyword1"><span class="command">using</span></span> dagger_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> CNOT_def cong_mat<span class="main">)</span>

<span class="keyword1" id="Quantum-CNOT_inv"><span class="command">lemma</span></span> CNOT_inv <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"CNOT <span class="main">*</span> CNOT <span class="main">=</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>m</sub></span> <span class="numeral">4</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> CNOT_def times_mat_def one_mat_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> cong_mat<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> scalar_prod_def<span class="main">)</span>

<span class="keyword1" id="Quantum-CNOT_is_gate"><span class="command">lemma</span></span> CNOT_is_gate <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"gate <span class="numeral">2</span> CNOT"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> gate_def unitary_def<span class="main">)</span>
    <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> CNOT_def<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The phase gate, also known as the S-gate›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">S</span> <span class="main">::</span><span class="quoted"><span class="quoted">"complex mat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">≡</span> mat <span class="numeral">2</span> <span class="numeral">2</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">i</span><span class="main">=</span><span class="main">0</span> <span class="main">∧</span> <span class="bound">j</span><span class="main">=</span><span class="main">0</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">i</span><span class="main">=</span><span class="main">1</span> <span class="main">∧</span> <span class="bound">j</span><span class="main">=</span><span class="main">1</span> <span class="keyword1">then</span> <span class="keyword1">𝗂</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">"π/8"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> gate, also known as the T-gate›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">T</span> <span class="main">::</span><span class="quoted"><span class="quoted">"complex mat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">T</span> <span class="main">≡</span> mat <span class="numeral">2</span> <span class="numeral">2</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">i</span><span class="main">=</span><span class="main">0</span> <span class="main">∧</span> <span class="bound">j</span><span class="main">=</span><span class="main">0</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">i</span><span class="main">=</span><span class="main">1</span> <span class="main">∧</span> <span class="bound">j</span><span class="main">=</span><span class="main">1</span> <span class="keyword1">then</span> exp<span class="main">(</span><span class="keyword1">𝗂</span><span class="main">*</span><span class="main">(</span>pi<span class="main">/</span><span class="numeral">4</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹A few relations between the Hadamard gate and the Pauli matrices›</span></span>

<span class="keyword1" id="Quantum-HXH_is_Z"><span class="command">lemma</span></span> HXH_is_Z <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"H <span class="main">*</span> X <span class="main">*</span> H <span class="main">=</span> Z"</span></span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> X_def Z_def H_def times_mat_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> cong_mat<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> scalar_prod_def complex_eqI<span class="main">)</span>

<span class="keyword1" id="Quantum-HYH_is_minusY"><span class="command">lemma</span></span> HYH_is_minusY <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"H <span class="main">*</span> Y <span class="main">*</span> H <span class="main">=</span> <span class="main">-</span> Y"</span></span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Y_def H_def times_mat_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> eq_matI<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> scalar_prod_def complex_eqI<span class="main">)</span>

<span class="keyword1" id="Quantum-HZH_is_X"><span class="command">lemma</span></span> HZH_is_X <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"H <span class="main">*</span> Z <span class="main">*</span> H <span class="main">=</span> X"</span></span>  
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> X_def Z_def H_def times_mat_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> cong_mat<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> scalar_prod_def complex_eqI<span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹The Bell States›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
We introduce below the so-called Bell states, also known as EPR pairs (EPR stands for Einstein,
Podolsky and Rosen).
›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">bell00</span> <span class="main">::</span><span class="quoted"><span class="quoted">"complex mat"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">|β<span class="hidden">⇩</span><sub>0</sub><span class="hidden">⇩</span><sub>0</sub>⟩</span>"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">bell00</span> <span class="main">≡</span> <span class="main">1</span><span class="main">/</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>m</sub></span> <span class="main">|</span>vec <span class="numeral">4</span> <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">i</span><span class="main">=</span><span class="main">0</span> <span class="main">∨</span> <span class="bound">i</span><span class="main">=</span><span class="numeral">3</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span><span class="main">⟩</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">bell01</span> <span class="main">::</span><span class="quoted"><span class="quoted">"complex mat"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">|β<span class="hidden">⇩</span><sub>0</sub><span class="hidden">⇩</span><sub>1</sub>⟩</span>"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">bell01</span> <span class="main">≡</span> <span class="main">1</span><span class="main">/</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>m</sub></span> <span class="main">|</span>vec <span class="numeral">4</span> <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">i</span><span class="main">=</span><span class="main">1</span> <span class="main">∨</span> <span class="bound">i</span><span class="main">=</span><span class="numeral">2</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span><span class="main">⟩</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">bell10</span> <span class="main">::</span><span class="quoted"><span class="quoted">"complex mat"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">|β<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>0</sub>⟩</span>"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">bell10</span> <span class="main">≡</span> <span class="main">1</span><span class="main">/</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>m</sub></span> <span class="main">|</span>vec <span class="numeral">4</span> <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">i</span><span class="main">=</span><span class="main">0</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="bound">i</span><span class="main">=</span><span class="numeral">3</span> <span class="keyword1">then</span> <span class="main">-</span><span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span><span class="main">⟩</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">bell11</span> <span class="main">::</span><span class="quoted"><span class="quoted">"complex mat"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">|β<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>1</sub>⟩</span>"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">bell11</span> <span class="main">≡</span> <span class="main">1</span><span class="main">/</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>m</sub></span> <span class="main">|</span>vec <span class="numeral">4</span> <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">i</span><span class="main">=</span><span class="main">1</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="bound">i</span><span class="main">=</span><span class="numeral">2</span> <span class="keyword1">then</span> <span class="main">-</span><span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span><span class="main">⟩</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> bell00_is_state <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">"state <span class="numeral">2</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>0</sub><span class="hidden">⇩</span><sub>0</sub>⟩</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> bell01_is_state <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">"state <span class="numeral">2</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>0</sub><span class="hidden">⇩</span><sub>1</sub>⟩</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
    bell10_is_state <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">"state <span class="numeral">2</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>0</sub>⟩</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> bell11_is_state <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">"state <span class="numeral">2</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>1</sub>⟩</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> state_def bell00_def bell01_def bell10_def bell11_def ket_vec_def<span class="main">)</span>
    <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> cpx_vec_length_def Set_Interval.lessThan_atLeast0 cmod_def power2_eq_square<span class="main">)</span> 

<span class="keyword1" id="Quantum-bell00_index"><span class="command">lemma</span></span> bell00_index <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">|β<span class="hidden">⇩</span><sub>0</sub><span class="hidden">⇩</span><sub>0</sub>⟩</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span><span class="main">/</span>sqrt <span class="numeral">2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">|β<span class="hidden">⇩</span><sub>0</sub><span class="hidden">⇩</span><sub>0</sub>⟩</span> <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">|β<span class="hidden">⇩</span><sub>0</sub><span class="hidden">⇩</span><sub>0</sub>⟩</span> <span class="main">$$</span> <span class="main">(</span><span class="numeral">2</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
    <span class="quoted"><span class="quoted">"<span class="keyword1">|β<span class="hidden">⇩</span><sub>0</sub><span class="hidden">⇩</span><sub>0</sub>⟩</span> <span class="main">$$</span> <span class="main">(</span><span class="numeral">3</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span><span class="main">/</span>sqrt <span class="numeral">2</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> bell00_def ket_vec_def<span class="main">)</span>

<span class="keyword1" id="Quantum-bell01_index"><span class="command">lemma</span></span> bell01_index <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">|β<span class="hidden">⇩</span><sub>0</sub><span class="hidden">⇩</span><sub>1</sub>⟩</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">|β<span class="hidden">⇩</span><sub>0</sub><span class="hidden">⇩</span><sub>1</sub>⟩</span> <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span><span class="main">/</span>sqrt <span class="numeral">2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">|β<span class="hidden">⇩</span><sub>0</sub><span class="hidden">⇩</span><sub>1</sub>⟩</span> <span class="main">$$</span> <span class="main">(</span><span class="numeral">2</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span><span class="main">/</span>sqrt <span class="numeral">2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
    <span class="quoted"><span class="quoted">"<span class="keyword1">|β<span class="hidden">⇩</span><sub>0</sub><span class="hidden">⇩</span><sub>1</sub>⟩</span> <span class="main">$$</span> <span class="main">(</span><span class="numeral">3</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> bell01_def ket_vec_def<span class="main">)</span>

<span class="keyword1" id="Quantum-bell10_index"><span class="command">lemma</span></span> bell10_index <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">|β<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>0</sub>⟩</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span><span class="main">/</span>sqrt <span class="numeral">2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">|β<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>0</sub>⟩</span> <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">|β<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>0</sub>⟩</span> <span class="main">$$</span> <span class="main">(</span><span class="numeral">2</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
    <span class="quoted"><span class="quoted">"<span class="keyword1">|β<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>0</sub>⟩</span> <span class="main">$$</span> <span class="main">(</span><span class="numeral">3</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span> <span class="main">1</span><span class="main">/</span>sqrt <span class="numeral">2</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> bell10_def ket_vec_def<span class="main">)</span>

<span class="keyword1" id="Quantum-bell_11_index"><span class="command">lemma</span></span> bell_11_index <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">|β<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>1</sub>⟩</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">|β<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>1</sub>⟩</span> <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span><span class="main">/</span>sqrt <span class="numeral">2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">|β<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>1</sub>⟩</span> <span class="main">$$</span> <span class="main">(</span><span class="numeral">2</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span> <span class="main">1</span><span class="main">/</span>sqrt <span class="numeral">2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
    <span class="quoted"><span class="quoted">"<span class="keyword1">|β<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>1</sub>⟩</span> <span class="main">$$</span> <span class="main">(</span><span class="numeral">3</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> bell11_def ket_vec_def<span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹The Bitwise Inner Product›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">bitwise_inner_prod</span><span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> nat <span class="main">⇒</span> nat <span class="main">⇒</span> nat"</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
<span class="quoted"><span class="quoted">"<span class="free">bitwise_inner_prod</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">}</span><span class="main">.</span> <span class="main">(</span>bin_rep <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span> <span class="main">!</span> <span class="bound">k</span> <span class="main">*</span> <span class="main">(</span>bin_rep <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">)</span> <span class="main">!</span> <span class="bound">k</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">bip</span><span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> nat <span class="main">⇒</span> nat <span class="main">⇒</span> nat"</span></span> <span class="main">(</span><span class="quoted">"_ <span class="keyword1">⋅⇘</span>_<span class="keyword1">⇙</span>  _"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">bip</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="main">≡</span> bitwise_inner_prod <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">j</span></span></span>"</span></span>

<span class="keyword1" id="Quantum-bitwise_inner_prod_fst_el_0"><span class="command">lemma</span></span> bitwise_inner_prod_fst_el_0<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span> <span class="main">∨</span> <span class="free">j</span> <span class="main">&lt;</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">i</span> ⋅<span class="hidden">⇘</span><sub>Suc <span class="free">n</span></sub><span class="hidden">⇙</span> <span class="free">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">i</span> <span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">)</span> ⋅<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="free">j</span> <span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bip <span class="free">i</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="free">j</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span>bin_rep <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="free">i</span><span class="main">)</span> <span class="main">!</span> <span class="bound">k</span> <span class="main">*</span> <span class="main">(</span>bin_rep <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="free">j</span><span class="main">)</span> <span class="main">!</span> <span class="bound">k</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> bitwise_inner_prod_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> bin_rep <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="free">i</span> <span class="main">!</span> <span class="main">0</span> <span class="main">*</span> bin_rep <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="free">j</span> <span class="main">!</span> <span class="main">0</span> <span class="main">+</span> 
             <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="main">{</span><span class="main">1</span><span class="main">..&lt;</span><span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span><span class="main">}</span><span class="main">.</span> bin_rep <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="free">i</span> <span class="main">!</span> <span class="bound">k</span> <span class="main">*</span> bin_rep <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="free">j</span> <span class="main">!</span> <span class="bound">k</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum.atLeast_Suc_lessThan<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="main">{</span><span class="main">1</span><span class="main">..&lt;</span><span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span><span class="main">}</span><span class="main">.</span> bin_rep <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="free">i</span> <span class="main">!</span> <span class="bound">k</span> <span class="main">*</span> bin_rep <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="free">j</span> <span class="main">!</span> <span class="bound">k</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> bin_rep_index_0<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">i</span></span> <span class="quoted"><span class="free">n</span></span><span class="main">]</span> bin_rep_index_0<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">j</span></span> <span class="quoted"><span class="free">n</span></span><span class="main">]</span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">}</span><span class="main">.</span> bin_rep <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="free">i</span> <span class="main">!</span><span class="main">(</span><span class="bound">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">*</span> bin_rep <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="free">j</span> <span class="main">!</span> <span class="main">(</span><span class="bound">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span> 
     <span class="keyword1"><span class="command">using</span></span> sum.shift_bounds_Suc_ivl<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">k</span><span class="main">.</span> bin_rep <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="free">i</span> <span class="main">!</span> <span class="bound">k</span> <span class="main">*</span> bin_rep <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="free">j</span> <span class="main">!</span> <span class="bound">k</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span>"</span></span><span class="main">]</span> 
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> One_nat_def add.commute plus_1_eq_Suc sum.cong<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bip <span class="free">i</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="free">j</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">}</span><span class="main">.</span> bin_rep <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="free">i</span> <span class="main">!</span> <span class="main">(</span><span class="bound">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">*</span> bin_rep <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="free">j</span> <span class="main">!</span> <span class="main">(</span><span class="bound">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="free">n</span><span class="main">}</span> <span class="main">⟶</span> bin_rep <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="free">i</span> <span class="main">!</span> <span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">=</span> bin_rep <span class="free">n</span> <span class="main">(</span><span class="free">i</span> <span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">)</span> <span class="main">!</span> <span class="skolem">k</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span>
    <span class="keyword1"><span class="command">using</span></span> bin_rep_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bin_rep_aux_neq_nil<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="free">n</span><span class="main">}</span> <span class="main">⟶</span> bin_rep <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="free">j</span> <span class="main">!</span><span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">=</span> bin_rep <span class="free">n</span> <span class="main">(</span><span class="free">j</span> <span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">)</span> <span class="main">!</span> <span class="skolem">k</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span> 
    <span class="keyword1"><span class="command">using</span></span> bin_rep_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bin_rep_aux_neq_nil<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms bin_rep_index_0 bitwise_inner_prod_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Quantum-bitwise_inner_prod_fst_el_is_1"><span class="command">lemma</span></span> bitwise_inner_prod_fst_el_is_1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">n</span> <span class="free">i</span> <span class="free">j</span><span class="main">::</span> <span class="quoted">nat</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≥</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span> <span class="main">∧</span> <span class="free">j</span> <span class="main">≥</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">∧</span> <span class="free">j</span> <span class="main">&lt;</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">i</span> ⋅<span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span></sub><span class="hidden">⇙</span> <span class="free">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span> <span class="main">+</span> <span class="main">(</span><span class="main">(</span><span class="free">i</span> <span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">)</span> ⋅<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="free">j</span> <span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bip <span class="free">i</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="free">j</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span><span class="main">}</span><span class="main">.</span> bin_rep <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="free">i</span> <span class="main">!</span> <span class="bound">k</span> <span class="main">*</span> bin_rep <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="free">j</span> <span class="main">!</span> <span class="bound">k</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> bitwise_inner_prod_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> bin_rep <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="free">i</span> <span class="main">!</span> <span class="main">0</span> <span class="main">*</span> bin_rep <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="free">j</span> <span class="main">!</span> <span class="main">0</span> <span class="main">+</span> 
            <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="main">{</span><span class="main">1</span><span class="main">..&lt;</span><span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span><span class="main">}</span><span class="main">.</span> bin_rep <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="free">i</span> <span class="main">!</span> <span class="bound">k</span> <span class="main">*</span> bin_rep <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="free">j</span> <span class="main">!</span> <span class="bound">k</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum.atLeast_Suc_lessThan<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">1</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="main">{</span><span class="main">1</span><span class="main">..&lt;</span><span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span><span class="main">}</span><span class="main">.</span> bin_rep <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="free">i</span> <span class="main">!</span> <span class="bound">k</span> <span class="main">*</span> bin_rep <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="free">j</span> <span class="main">!</span> <span class="bound">k</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> bin_rep_index_0_geq<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">n</span></span> <span class="quoted"><span class="free">i</span></span><span class="main">]</span> bin_rep_index_0_geq<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">n</span></span> <span class="quoted"><span class="free">j</span></span><span class="main">]</span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">1</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">}</span><span class="main">.</span> bin_rep <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="free">i</span> <span class="main">!</span> <span class="main">(</span><span class="bound">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">*</span> bin_rep <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="free">j</span> <span class="main">!</span> <span class="main">(</span><span class="bound">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> sum.shift_bounds_Suc_ivl<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">k</span><span class="main">.</span> <span class="main">(</span>bin_rep <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="free">i</span><span class="main">)</span><span class="main">!</span><span class="bound">k</span> <span class="main">*</span> <span class="main">(</span>bin_rep <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="free">j</span><span class="main">)</span><span class="main">!</span><span class="bound">k</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span>"</span></span><span class="main">]</span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> One_nat_def Suc_eq_plus1 sum.cong<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> f0<span class="main">:</span><span class="quoted"><span class="quoted">"bip <span class="free">i</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="free">j</span> <span class="main">=</span> <span class="main">1</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">}</span><span class="main">.</span> bin_rep <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="free">i</span> <span class="main">!</span> <span class="main">(</span><span class="bound">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">*</span> bin_rep <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="free">j</span> <span class="main">!</span> <span class="main">(</span><span class="bound">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="free">n</span><span class="main">}</span> <span class="main">⟶</span> bin_rep <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="free">i</span> <span class="main">!</span> <span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">=</span> bin_rep <span class="free">n</span> <span class="main">(</span><span class="free">i</span> <span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">)</span> <span class="main">!</span> <span class="skolem">k</span>
<span class="main">∧</span> bin_rep <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="free">j</span> <span class="main">!</span> <span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">=</span> bin_rep <span class="free">n</span> <span class="main">(</span><span class="free">j</span> <span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">)</span> <span class="main">!</span> <span class="skolem">k</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span>
    <span class="keyword1"><span class="command">using</span></span> bin_rep_def <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">metis</span> Suc_eq_plus1 bin_rep_aux.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> bin_rep_aux_neq_nil butlast.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> nth_Cons_Suc<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> bitwise_inner_prod_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Quantum-bitwise_inner_prod_with_zero"><span class="command">lemma</span></span> bitwise_inner_prod_with_zero<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">&lt;</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">0</span> ⋅<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span>  <span class="free">m</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">0</span> ⋅<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span>  <span class="free">m</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">}</span><span class="main">.</span> bin_rep <span class="free">n</span> <span class="main">0</span> <span class="main">!</span> <span class="bound">j</span> <span class="main">*</span> bin_rep <span class="free">n</span> <span class="free">m</span> <span class="main">!</span> <span class="bound">j</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> bitwise_inner_prod_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">}</span><span class="main">.</span> bin_rep <span class="free">n</span> <span class="main">0</span> <span class="main">!</span> <span class="bound">j</span> <span class="main">*</span> bin_rep <span class="free">n</span> <span class="free">m</span> <span class="main">!</span> <span class="bound">j</span><span class="main">)</span> 
               <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">}</span><span class="main">.</span> <span class="main">0</span> <span class="main">*</span> <span class="main">(</span>bin_rep <span class="free">n</span> <span class="free">m</span><span class="main">)</span> <span class="main">!</span> <span class="bound">j</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bin_rep_index<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?thesis</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(*
Biblio:

@book{MikeandIke,
  author = {Nielsen, Michael A. and Chuang, Isaac L.},
  publisher = {Cambridge University Press},
  title = {Quantum Computation and Quantum Information},
  year = 2010
}
*)</span>
<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="Complex_Vectors">
<div class="head">
<h1>Theory Complex_Vectors</h1>
</div>
<pre class="source"><span class="comment1">(* Author: Anthony Bordg, University of Cambridge, apdb3@cam.ac.uk *)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Complex Vectors›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Complex_Vectors
<span class="keyword2"><span class="keyword">imports</span></span> 
  <a href="#Quantum">Quantum</a>
  <a href="../../vectorspace/theories/#VectorSpace">VectorSpace.VectorSpace</a>
<span class="keyword2"><span class="keyword">begin</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹The Vector Space of Complex Vectors of Dimension n›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">module_cpx_vec</span><span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="main">(</span>complex<span class="main">,</span> complex vec<span class="main">)</span> module"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">module_cpx_vec</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">≡</span> module_vec <span class="keyword1">TYPE</span><span class="main">(</span>complex<span class="main">)</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">cpx_rng</span><span class="main">::</span> <span class="quoted"><span class="quoted">"complex ring"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">cpx_rng</span> <span class="main">≡</span> <span class="main">⦇</span>carrier <span class="main">=</span> UNIV<span class="main">,</span> mult <span class="main">=</span> <span class="main">(*)</span><span class="main">,</span> one <span class="main">=</span> <span class="main">1</span><span class="main">,</span> zero <span class="main">=</span> <span class="main">0</span><span class="main">,</span> add <span class="main">=</span> <span class="main">(+)</span><span class="main">⦈</span>"</span></span>

<span class="keyword1" id="Complex_Vectors-cpx_cring_is_field"><span class="command">lemma</span></span> cpx_cring_is_field <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"field cpx_rng"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">unfold_locales</span>
                   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> right_inverse <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> cpx_rng_def Units_def <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add.right_neutral add_diff_cancel_left' add_uminus_conv_diff<span class="main">)</span>

<span class="keyword1" id="Complex_Vectors-cpx_abelian_monoid"><span class="command">lemma</span></span> cpx_abelian_monoid <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"abelian_monoid cpx_rng"</span></span>
  <span class="keyword1"><span class="command">using</span></span> cpx_cring_is_field
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> field_def abelian_group_def cring_def domain_def ring_def<span class="main">)</span>

<span class="keyword1" id="Complex_Vectors-vecspace_cpx_vec"><span class="command">lemma</span></span> vecspace_cpx_vec <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"vectorspace cpx_rng <span class="main">(</span>module_cpx_vec <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">unfold_locales</span>
                      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> cpx_rng_def module_cpx_vec_def module_vec_def Units_def <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> right_inverse add_inv_exists_vec<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add.right_neutral add_diff_cancel_left' add_uminus_conv_diff<span class="main">)</span>

<span class="keyword1" id="Complex_Vectors-module_cpx_vec"><span class="command">lemma</span></span> module_cpx_vec <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"Module.module cpx_rng <span class="main">(</span>module_cpx_vec <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> vecspace_cpx_vec <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vectorspace_def<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">state_basis</span><span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> nat <span class="main">⇒</span> complex vec"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">state_basis</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">≡</span> unit_vec <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">unit_vectors</span><span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="main">(</span>complex vec<span class="main">)</span> set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">unit_vectors</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">≡</span> <span class="main">{</span>unit_vec <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="bound">i</span> <span class="main">|</span> <span class="bound">i</span><span class="main">::</span>nat<span class="main">.</span> <span class="main">0</span> <span class="main">≤</span> <span class="bound">i</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">}</span>"</span></span>

<span class="keyword1" id="Complex_Vectors-unit_vectors_carrier_vec"><span class="command">lemma</span></span> unit_vectors_carrier_vec <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"unit_vectors <span class="free">n</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> unit_vectors_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> Module.module<span class="main">)</span> finsum_over_singleton <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">x</span> <span class="main">∈</span> carrier <span class="free">M</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"finsum <span class="free">M</span> <span class="free">f</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span> <span class="main">=</span> <span class="free">f</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Complex_Vectors-lincomb_over_singleton"><span class="command">lemma</span></span> lincomb_over_singleton <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> carrier_vec <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span> <span class="main">→</span> UNIV"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"module.lincomb <span class="main">(</span>module_cpx_vec <span class="free">n</span><span class="main">)</span> <span class="free">f</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span> <span class="main">=</span> <span class="free">f</span> <span class="free">x</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">x</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> assms module.lincomb_def module_cpx_vec module_cpx_vec_def module.finsum_over_singleton
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> module_vec_simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> module_vec_simps<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> smult_carrier_vec<span class="main">)</span>

<span class="keyword1" id="Complex_Vectors-dim_vec_lincomb"><span class="command">lemma</span></span> dim_vec_lincomb <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">F</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span><span class="main">:</span> <span class="free">F</span> <span class="main">→</span> UNIV"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"dim_vec <span class="main">(</span>module.lincomb <span class="main">(</span>module_cpx_vec <span class="free">n</span><span class="main">)</span> <span class="free">f</span> <span class="free">F</span><span class="main">)</span> <span class="main">=</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">F</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> empty
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_vec <span class="main">(</span>module.lincomb <span class="main">(</span>module_cpx_vec <span class="free">n</span><span class="main">)</span> <span class="free">f</span> <span class="main">{}</span><span class="main">)</span> <span class="main">=</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"module.lincomb <span class="main">(</span>module_cpx_vec <span class="free">n</span><span class="main">)</span> <span class="free">f</span> <span class="main">{}</span> <span class="main">=</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">n</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> module.lincomb_def abelian_monoid.finsum_empty module_cpx_vec_def vecspace_cpx_vec vectorspace_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> abelian_group_def Module.module_def module_vec_simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>insert <span class="skolem">x</span> <span class="skolem">F</span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"module.lincomb <span class="main">(</span>module_cpx_vec <span class="free">n</span><span class="main">)</span> <span class="free">f</span> <span class="main">(</span>insert <span class="skolem">x</span> <span class="skolem">F</span><span class="main">)</span> <span class="main">=</span> 
    <span class="main">(</span><span class="free">f</span> <span class="skolem">x</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">x</span><span class="main">)</span> <span class="main">⊕</span><span class="hidden">⇘</span><sub>module_cpx_vec <span class="free">n</span></sub><span class="hidden">⇙</span> module.lincomb <span class="main">(</span>module_cpx_vec <span class="free">n</span><span class="main">)</span> <span class="free">f</span> <span class="skolem">F</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> module_cpx_vec_def module_vec_def module_cpx_vec module.lincomb_insert cpx_rng_def insert_subset
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> Pi_I' UNIV_I Un_insert_right module_vec_simps<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> partial_object.select_convs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> sup_bot.comm_neutral<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"dim_vec <span class="main">(</span>module.lincomb <span class="main">(</span>module_cpx_vec <span class="free">n</span><span class="main">)</span> <span class="free">f</span> <span class="main">(</span>insert <span class="skolem">x</span> <span class="skolem">F</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
    dim_vec <span class="main">(</span>module.lincomb <span class="main">(</span>module_cpx_vec <span class="free">n</span><span class="main">)</span> <span class="free">f</span> <span class="skolem">F</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> index_add_vec <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> module_cpx_vec_def module_vec_simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"dim_vec <span class="main">(</span>module.lincomb <span class="main">(</span>module_cpx_vec <span class="free">n</span><span class="main">)</span> <span class="free">f</span> <span class="main">(</span>insert <span class="skolem">x</span> <span class="skolem">F</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">n</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> insert.hyps<span class="main">(</span>3<span class="main">)</span> insert.prems<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Complex_Vectors-lincomb_vec_index"><span class="command">lemma</span></span> lincomb_vec_index <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">F</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span><span class="main">:</span> <span class="free">F</span> <span class="main">→</span> UNIV"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"module.lincomb <span class="main">(</span>module_cpx_vec <span class="free">n</span><span class="main">)</span> <span class="free">f</span> <span class="free">F</span> <span class="main">$</span> <span class="free">i</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">v</span><span class="main">∈</span><span class="free">F</span><span class="main">.</span> <span class="free">f</span> <span class="bound">v</span> <span class="main">*</span> <span class="main">(</span><span class="bound">v</span> <span class="main">$</span> <span class="free">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">F</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> empty
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"module.lincomb <span class="main">(</span>module_cpx_vec <span class="free">n</span><span class="main">)</span> <span class="free">f</span> <span class="main">{}</span> <span class="main">$</span> <span class="free">i</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">v</span><span class="main">∈</span><span class="main">{}</span><span class="main">.</span> <span class="free">f</span> <span class="bound">v</span> <span class="main">*</span> <span class="bound">v</span> <span class="main">$</span> <span class="free">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">using</span></span> a2 module.lincomb_def abelian_monoid.finsum_empty module_cpx_vec_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">)</span></span> abelian_group_def index_zero_vec<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> module_cpx_vec Module.module_def module_vec_simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span><span class="main">(</span>insert <span class="skolem">x</span> <span class="skolem">F</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"module.lincomb <span class="main">(</span>module_cpx_vec <span class="free">n</span><span class="main">)</span> <span class="free">f</span> <span class="main">(</span>insert <span class="skolem">x</span> <span class="skolem">F</span><span class="main">)</span> <span class="main">=</span> 
      <span class="free">f</span> <span class="skolem">x</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">x</span> <span class="main">⊕</span><span class="hidden">⇘</span><sub>module_cpx_vec <span class="free">n</span></sub><span class="hidden">⇙</span> module.lincomb <span class="main">(</span>module_cpx_vec <span class="free">n</span><span class="main">)</span> <span class="free">f</span> <span class="skolem">F</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> module.lincomb_insert module_cpx_vec insert.hyps<span class="main">(</span>1<span class="main">)</span> module_cpx_vec_def module_vec_def
      insert.prems<span class="main">(</span>2<span class="main">)</span> insert.hyps<span class="main">(</span>2<span class="main">)</span> insert.prems<span class="main">(</span>3<span class="main">)</span> insert_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> Pi_I' UNIV_I Un_insert_right cpx_rng_def insert_subset module_vec_simps<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> 
        partial_object.select_convs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> sup_bot.comm_neutral<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"module.lincomb <span class="main">(</span>module_cpx_vec <span class="free">n</span><span class="main">)</span> <span class="free">f</span> <span class="main">(</span>insert <span class="skolem">x</span> <span class="skolem">F</span><span class="main">)</span> <span class="main">$</span> <span class="free">i</span> <span class="main">=</span> 
      <span class="main">(</span><span class="free">f</span> <span class="skolem">x</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">x</span><span class="main">)</span> <span class="main">$</span> <span class="free">i</span> <span class="main">+</span> module.lincomb <span class="main">(</span>module_cpx_vec <span class="free">n</span><span class="main">)</span> <span class="free">f</span> <span class="skolem">F</span> <span class="main">$</span> <span class="free">i</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> index_add_vec<span class="main">(</span>1<span class="main">)</span> a2 dim_vec_lincomb
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Pi_split_insert_domain  insert.hyps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> insert.prems<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> insert.prems<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> insert_subset 
        module_cpx_vec_def module_vec_simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"module.lincomb <span class="main">(</span>module_cpx_vec <span class="free">n</span><span class="main">)</span> <span class="free">f</span> <span class="main">(</span>insert <span class="skolem">x</span> <span class="skolem">F</span><span class="main">)</span> <span class="main">$</span> <span class="free">i</span> <span class="main">=</span> <span class="free">f</span> <span class="skolem">x</span> <span class="main">*</span> <span class="skolem">x</span> <span class="main">$</span> <span class="free">i</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">v</span><span class="main">∈</span><span class="skolem">F</span><span class="main">.</span> <span class="free">f</span> <span class="bound">v</span> <span class="main">*</span> <span class="bound">v</span> <span class="main">$</span> <span class="free">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> index_smult_vec a2 insert.prems<span class="main">(</span>2<span class="main">)</span> insert_def insert.hyps<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> insert <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"module.lincomb <span class="main">(</span>module_cpx_vec <span class="free">n</span><span class="main">)</span> <span class="free">f</span> <span class="main">(</span>insert <span class="skolem">x</span> <span class="skolem">F</span><span class="main">)</span> <span class="main">$</span> <span class="free">i</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">v</span><span class="main">∈</span>insert <span class="skolem">x</span> <span class="skolem">F</span><span class="main">.</span> <span class="free">f</span> <span class="bound">v</span> <span class="main">*</span> <span class="bound">v</span> <span class="main">$</span> <span class="free">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Complex_Vectors-unit_vectors_is_lin_indpt"><span class="command">lemma</span></span> unit_vectors_is_lin_indpt <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"module.lin_indpt cpx_rng <span class="main">(</span>module_cpx_vec <span class="free">n</span><span class="main">)</span> <span class="main">(</span>unit_vectors <span class="free">n</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"module.lin_dep cpx_rng <span class="main">(</span>module_cpx_vec <span class="free">n</span><span class="main">)</span> <span class="main">(</span>unit_vectors <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">A</span> <span class="bound">a</span> <span class="bound">v</span><span class="main">.</span> <span class="main">(</span>finite <span class="bound">A</span> <span class="main">∧</span> <span class="bound">A</span> <span class="main">⊆</span> <span class="main">(</span>unit_vectors <span class="free">n</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">a</span> <span class="main">∈</span> <span class="bound">A</span> <span class="main">→</span> UNIV<span class="main">)</span> <span class="main">∧</span> 
    <span class="main">(</span>module.lincomb <span class="main">(</span>module_cpx_vec <span class="free">n</span><span class="main">)</span> <span class="bound">a</span> <span class="bound">A</span> <span class="main">=</span> <span class="main">𝟬</span><span class="hidden">⇘</span><sub>module_cpx_vec <span class="free">n</span></sub><span class="hidden">⇙</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">v</span> <span class="main">∈</span> <span class="bound">A</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">a</span> <span class="bound">v</span> <span class="main">≠</span> <span class="main">𝟬</span><span class="hidden">⇘</span><sub>cpx_rng</sub><span class="hidden">⇙</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> module.lin_dep_def cpx_rng_def module_cpx_vec <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> Pi_UNIV UNIV_I<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">A</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span> f1<span class="main">:</span><span class="quoted"><span class="quoted">"finite <span class="skolem">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> f2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">⊆</span> <span class="main">(</span>unit_vectors <span class="free">n</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="skolem">A</span> <span class="main">→</span> UNIV"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> f4<span class="main">:</span><span class="quoted"><span class="quoted">"module.lincomb <span class="main">(</span>module_cpx_vec <span class="free">n</span><span class="main">)</span> <span class="skolem">a</span> <span class="skolem">A</span> <span class="main">=</span> <span class="main">𝟬</span><span class="hidden">⇘</span><sub>module_cpx_vec <span class="free">n</span></sub><span class="hidden">⇙</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> f5<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> <span class="skolem">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
    f6<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="skolem">v</span> <span class="main">≠</span> <span class="main">𝟬</span><span class="hidden">⇘</span><sub>cpx_rng</sub><span class="hidden">⇙</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> calculation <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span> f7<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">=</span> unit_vec <span class="free">n</span> <span class="skolem">i</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> f8<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> unit_vectors_def calculation <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> f9<span class="main">:</span><span class="quoted"><span class="quoted">"module.lincomb <span class="main">(</span>module_cpx_vec <span class="free">n</span><span class="main">)</span> <span class="skolem">a</span> <span class="skolem">A</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">u</span><span class="main">∈</span><span class="skolem">A</span><span class="main">.</span> <span class="skolem">a</span> <span class="bound">u</span> <span class="main">*</span> <span class="main">(</span><span class="bound">u</span> <span class="main">$</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> lincomb_vec_index 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> carrier_dim_vec index_unit_vec<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> mem_Collect_eq subset_iff sum.cong unit_vectors_def<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">u</span><span class="main">∈</span><span class="skolem">A</span><span class="main">.</span><span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> <span class="bound">u</span> <span class="main">=</span> unit_vec <span class="free">n</span> <span class="bound">j</span> <span class="main">⟶</span> <span class="bound">j</span> <span class="main">≠</span> <span class="skolem">i</span> <span class="main">⟶</span> <span class="skolem">a</span> <span class="bound">u</span> <span class="main">*</span> <span class="main">(</span><span class="bound">u</span> <span class="main">$</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> unit_vectors_def index_unit_vec <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f8<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">u</span><span class="main">∈</span><span class="skolem">A</span><span class="main">.</span> <span class="skolem">a</span> <span class="bound">u</span> <span class="main">*</span> <span class="main">(</span><span class="bound">u</span> <span class="main">$</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">u</span><span class="main">∈</span><span class="skolem">A</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">u</span><span class="main">=</span><span class="skolem">v</span> <span class="keyword1">then</span> <span class="skolem">a</span> <span class="skolem">v</span> <span class="main">*</span> <span class="skolem">v</span> <span class="main">$</span> <span class="skolem">i</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> f2 unit_vectors_def f7 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> mem_Collect_eq subsetCE sum.cong<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">a</span> <span class="skolem">v</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">v</span> <span class="main">$</span> <span class="skolem">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> abelian_monoid.finsum_singleton<span class="main">[</span><span class="operator">of</span> <span class="quoted">cpx_rng</span> <span class="quoted"><span class="skolem">v</span></span> <span class="quoted"><span class="skolem">A</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">u</span><span class="main">∈</span><span class="skolem">A</span><span class="main">.</span> <span class="skolem">a</span> <span class="bound">u</span> <span class="main">*</span> <span class="main">(</span><span class="bound">u</span> <span class="main">$</span> <span class="skolem">i</span><span class="main">)</span>"</span></span><span class="main">]</span> cpx_abelian_monoid
      f5 f1 cpx_rng_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">a</span> <span class="skolem">v</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> f7 index_unit_vec f8 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> f6 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cpx_rng_def<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
    <span class="keyword1"><span class="command">using</span></span> f4 module_cpx_vec_def module_vec_def index_zero_vec f8 f9 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> module_vec_simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Complex_Vectors-unit_vectors_is_genset"><span class="command">lemma</span></span> unit_vectors_is_genset <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"module.gen_set cpx_rng <span class="main">(</span>module_cpx_vec <span class="free">n</span><span class="main">)</span> <span class="main">(</span>unit_vectors <span class="free">n</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"module.span cpx_rng <span class="main">(</span>module_cpx_vec <span class="free">n</span><span class="main">)</span> <span class="main">(</span>unit_vectors <span class="free">n</span><span class="main">)</span> <span class="main">⊆</span> carrier <span class="main">(</span>module_cpx_vec <span class="free">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> module.span_def dim_vec_lincomb carrier_vec_def cpx_rng_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> Collect_mono index_unit_vec<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> module.span_is_subset2 module_cpx_vec module_cpx_vec_def 
        module_vec_simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> unit_vectors_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"carrier <span class="main">(</span>module_cpx_vec <span class="free">n</span><span class="main">)</span> <span class="main">⊆</span> module.span cpx_rng <span class="main">(</span>module_cpx_vec <span class="free">n</span><span class="main">)</span> <span class="main">(</span>unit_vectors <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">v</span>
    <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> carrier <span class="main">(</span>module_cpx_vec <span class="free">n</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">A</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="skolem"><span class="skolem">lc</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">=</span> <span class="main">{</span>unit_vec <span class="free">n</span> <span class="bound">i</span> <span class="main">::</span>complex vec<span class="main">|</span> <span class="bound">i</span><span class="main">::</span>nat<span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">∧</span> <span class="skolem">v</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">≠</span> <span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
      <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">u</span><span class="main">∈</span><span class="skolem">A</span><span class="main">.</span> <span class="bound">u</span> <span class="main">∙</span> <span class="skolem">v</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">lc</span> <span class="main">=</span> module.lincomb <span class="main">(</span>module_cpx_vec <span class="free">n</span><span class="main">)</span> <span class="skolem">a</span> <span class="skolem">A</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> f1<span class="main">:</span><span class="quoted"><span class="quoted">"finite <span class="skolem">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> f2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">⊆</span> carrier_vec <span class="free">n</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> carrier_vec_def A_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> f3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="skolem">A</span> <span class="main">→</span> UNIV"</span></span>
      <span class="keyword1"><span class="command">using</span></span> a_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> f4<span class="main">:</span><span class="quoted"><span class="quoted">"dim_vec <span class="skolem">v</span> <span class="main">=</span> dim_vec <span class="skolem">lc</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> f1 f2 f3 a1 module_cpx_vec_def dim_vec_lincomb lc_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> module_vec_simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> f5<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">⟹</span> <span class="skolem">lc</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">u</span><span class="main">∈</span><span class="skolem">A</span><span class="main">.</span> <span class="bound">u</span> <span class="main">∙</span> <span class="skolem">v</span> <span class="main">*</span> <span class="bound">u</span> <span class="main">$</span> <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span>
      <span class="keyword1"><span class="command">using</span></span> lincomb_vec_index lc_def a_def f1 f2 f3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">⟹</span> <span class="skolem">j</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">⟹</span> <span class="skolem">j</span> <span class="main">≠</span> <span class="skolem">i</span> <span class="main">⟹</span> unit_vec <span class="free">n</span> <span class="skolem">j</span> <span class="main">∙</span> <span class="skolem">v</span> <span class="main">*</span> unit_vec <span class="free">n</span> <span class="skolem">j</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span> <span class="skolem">j</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">⟹</span> <span class="skolem">lc</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">u</span><span class="main">∈</span><span class="skolem">A</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">u</span> <span class="main">=</span> unit_vec <span class="free">n</span> <span class="skolem">i</span> <span class="keyword1">then</span> <span class="skolem">v</span> <span class="main">$</span> <span class="skolem">i</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span>
      <span class="keyword1"><span class="command">using</span></span> a1 A_def f5 scalar_prod_left_unit
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> f4 carrier_vecI dim_vec_lincomb f1 f2 f3 index_unit_vec<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> lc_def 
          mem_Collect_eq mult.right_neutral sum.cong<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">⟹</span> <span class="skolem">lc</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">=</span> <span class="skolem">v</span> <span class="main">$</span> <span class="skolem">i</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span>
      <span class="keyword1"><span class="command">using</span></span> abelian_monoid.finsum_singleton<span class="main">[</span><span class="operator">of</span> <span class="quoted">cpx_rng</span> <span class="quoted"><span class="skolem">i</span></span><span class="main">]</span> A_def cpx_rng_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> f6<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">=</span> <span class="skolem">lc</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> eq_vecI f4 dim_vec_lincomb f1 f2 lc_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">⊆</span> unit_vectors <span class="free">n</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> A_def unit_vectors_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> module.span cpx_rng <span class="main">(</span>module_cpx_vec <span class="free">n</span><span class="main">)</span> <span class="main">(</span>unit_vectors <span class="free">n</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> f6 module.span_def<span class="main">[</span><span class="operator">of</span> <span class="quoted">cpx_rng</span> <span class="quoted"><span class="quoted">"module_cpx_vec <span class="free">n</span>"</span></span><span class="main">]</span> lc_def f1 f2 cpx_rng_def module_cpx_vec
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> Pi_I' UNIV_I mem_Collect_eq partial_object.select_convs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>
    
<span class="keyword1" id="Complex_Vectors-unit_vectors_is_basis"><span class="command">lemma</span></span> unit_vectors_is_basis <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"vectorspace.basis cpx_rng <span class="main">(</span>module_cpx_vec <span class="free">n</span><span class="main">)</span> <span class="main">(</span>unit_vectors <span class="free">n</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"unit_vectors <span class="skolem">n</span> <span class="main">⊆</span> carrier <span class="main">(</span>module_cpx_vec <span class="skolem">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> unit_vectors_def module_cpx_vec_def module_vec_simps<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> vectorspace.basis_def unit_vectors_is_lin_indpt unit_vectors_is_genset vecspace_cpx_vec
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">smt</span> carrier_dim_vec index_unit_vec<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> mem_Collect_eq module_cpx_vec_def module_vec_simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> 
        subsetI unit_vectors_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Complex_Vectors-state_qbit_is_lincomb"><span class="command">lemma</span></span> state_qbit_is_lincomb <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"state_qbit <span class="free">n</span> <span class="main">=</span> 
  <span class="main">{</span>module.lincomb <span class="main">(</span>module_cpx_vec <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="bound">a</span> <span class="bound">A</span><span class="main">|</span><span class="bound">a</span> <span class="bound">A</span><span class="main">.</span> 
    finite <span class="bound">A</span> <span class="main">∧</span> <span class="bound">A</span><span class="main">⊆</span><span class="main">(</span>unit_vectors <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">a</span><span class="main">∈</span> <span class="bound">A</span> <span class="main">→</span> UNIV <span class="main">∧</span> <span class="main">∥</span>module.lincomb <span class="main">(</span>module_cpx_vec <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="bound">a</span> <span class="bound">A</span><span class="main">∥</span> <span class="main">=</span> <span class="main">1</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"state_qbit <span class="free">n</span>
    <span class="main">⊆</span> <span class="main">{</span>module.lincomb <span class="main">(</span>module_cpx_vec <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="bound">a</span> <span class="bound">A</span> <span class="main">|</span><span class="bound">a</span> <span class="bound">A</span><span class="main">.</span>
        finite <span class="bound">A</span> <span class="main">∧</span> <span class="bound">A</span> <span class="main">⊆</span> unit_vectors <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">a</span> <span class="main">∈</span> <span class="bound">A</span> <span class="main">→</span> UNIV <span class="main">∧</span> <span class="main">∥</span>module.lincomb <span class="main">(</span>module_cpx_vec <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="bound">a</span> <span class="bound">A</span><span class="main">∥</span> <span class="main">=</span> <span class="main">1</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">v</span>
    <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> state_qbit <span class="free">n</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> <span class="main">{</span>module.lincomb <span class="main">(</span>module_cpx_vec <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="bound">a</span> <span class="bound">A</span> <span class="main">|</span><span class="bound">a</span> <span class="bound">A</span><span class="main">.</span>
               finite <span class="bound">A</span> <span class="main">∧</span> <span class="bound">A</span> <span class="main">⊆</span> unit_vectors <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">a</span> <span class="main">∈</span> <span class="bound">A</span> <span class="main">→</span> UNIV <span class="main">∧</span> <span class="main">∥</span>module.lincomb <span class="main">(</span>module_cpx_vec <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="bound">a</span> <span class="bound">A</span><span class="main">∥</span> <span class="main">=</span> <span class="main">1</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">A</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">∈</span> <span class="skolem">A</span> <span class="main">→</span> UNIV"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">⊆</span> unit_vectors <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
        <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">=</span> module.lincomb <span class="main">(</span>module_cpx_vec <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="skolem">a</span> <span class="skolem">A</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> a1 state_qbit_def unit_vectors_is_basis vectorspace.basis_def module.span_def 
        vecspace_cpx_vec module_cpx_vec module_cpx_vec_def module_vec_def carrier_vec_def
        <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">smt</span> Pi_UNIV UNIV_I mem_Collect_eq module_vec_simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> a1 state_qbit_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span>module.lincomb <span class="main">(</span>module_cpx_vec <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="bound">a</span> <span class="bound">A</span> <span class="main">|</span><span class="bound">a</span> <span class="bound">A</span><span class="main">.</span>
     finite <span class="bound">A</span> <span class="main">∧</span> <span class="bound">A</span> <span class="main">⊆</span> unit_vectors <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">a</span> <span class="main">∈</span> <span class="bound">A</span> <span class="main">→</span> UNIV <span class="main">∧</span> <span class="main">∥</span>module.lincomb <span class="main">(</span>module_cpx_vec <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="bound">a</span> <span class="bound">A</span><span class="main">∥</span> <span class="main">=</span> <span class="main">1</span><span class="main">}</span>
    <span class="main">⊆</span> state_qbit <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">v</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> <span class="main">{</span>module.lincomb <span class="main">(</span>module_cpx_vec <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="bound">a</span> <span class="bound">A</span> <span class="main">|</span><span class="bound">a</span> <span class="bound">A</span><span class="main">.</span>
              finite <span class="bound">A</span> <span class="main">∧</span> <span class="bound">A</span> <span class="main">⊆</span> unit_vectors <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">a</span> <span class="main">∈</span> <span class="bound">A</span> <span class="main">→</span> UNIV <span class="main">∧</span> <span class="main">∥</span>module.lincomb <span class="main">(</span>module_cpx_vec <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="bound">a</span> <span class="bound">A</span><span class="main">∥</span> <span class="main">=</span> <span class="main">1</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> state_qbit <span class="free">n</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> state_qbit_def dim_vec_lincomb unit_vectors_carrier_vec <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">smt</span> mem_Collect_eq order_trans<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="Tensor">
<div class="head">
<h1>Theory Tensor</h1>
</div>
<pre class="source"><span class="comment1">(* Author: Anthony Bordg, University of Cambridge, apdb3@cam.ac.uk *)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Tensor Products›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Tensor
<span class="keyword2"><span class="keyword">imports</span></span>  
  <a href="#Complex_Vectors">Complex_Vectors</a>
  <a href="../../matrix_tensor/theories/#Matrix_Tensor">Matrix_Tensor.Matrix_Tensor</a>
  <a href="../../jordan_normal_form/theories/#Matrix">Jordan_Normal_Form.Matrix</a>
<span class="keyword2"><span class="keyword">begin</span></span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
There is already a formalization of tensor products in the Archive of Formal Proofs, 
namely Matrix\_Tensor.thy in Tensor Product of Matrices[1] by T.V.H. Prathamesh, but it does not build 
on top of the formalization of vectors and matrices given in Matrices, Jordan Normal Forms, and 
Spectral Radius Theory[2] by René Thiemann and Akihisa Yamada. 
In the present theory our purpose consists in giving such a formalization. Of course, we will reuse 
Prathamesh's code as much as possible, and in order to achieve that we formalize some lemmas that
translate back and forth between vectors (resp. matrices) seen as lists (resp. lists of lists) and 
vectors (resp. matrices) as formalized in [2].
›</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹The Kronecker Product of Complex Vectors›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">tensor_vec</span><span class="main">::</span> <span class="quoted"><span class="quoted">"complex Matrix.vec <span class="main">⇒</span> complex Matrix.vec <span class="main">⇒</span> complex Matrix.vec"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">⊗</span>"</span> 63<span class="main">)</span> 
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">tensor_vec</span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">≡</span> vec_of_list <span class="main">(</span>mult.vec_vec_Tensor <span class="main">(*)</span> <span class="main">(</span>list_of_vec <span class="free"><span class="bound"><span class="entity">u</span></span></span><span class="main">)</span> <span class="main">(</span>list_of_vec <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹The Tensor Product of Complex Matrices›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹To see a matrix in the sense of [2] as a matrix in the sense of [1], we convert it into its list
of column vectors.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">mat_to_cols_list</span><span class="main">::</span> <span class="quoted"><span class="quoted">"complex Matrix.mat <span class="main">⇒</span> complex list list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">mat_to_cols_list</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">=</span> <span class="main">[</span><span class="main">[</span><span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">$$</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span> <span class="main">.</span> i <span class="main">&lt;-</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span> dim_row <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">]</span><span class="main">]</span> <span class="main">.</span> j <span class="main">&lt;-</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span> dim_col <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">]</span><span class="main">]</span>"</span></span>

<span class="keyword1" id="Tensor-length_mat_to_cols_list"><span class="command">lemma</span></span> length_mat_to_cols_list <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"length <span class="main">(</span>mat_to_cols_list <span class="free">A</span><span class="main">)</span> <span class="main">=</span> dim_col <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mat_to_cols_list_def<span class="main">)</span>

<span class="keyword1" id="Tensor-length_cols_mat_to_cols_list"><span class="command">lemma</span></span> length_cols_mat_to_cols_list <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">&lt;</span> dim_col <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"length <span class="main">[</span><span class="free">A</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="free">j</span><span class="main">)</span> <span class="main">.</span> i <span class="main">&lt;-</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span> dim_row <span class="free">A</span><span class="main">]</span><span class="main">]</span> <span class="main">=</span> dim_row <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Tensor-length_row_mat_to_cols_list"><span class="command">lemma</span></span> length_row_mat_to_cols_list <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> dim_row <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>row <span class="main">(</span>mat_to_cols_list <span class="free">A</span><span class="main">)</span> <span class="free">i</span><span class="main">)</span> <span class="main">=</span> dim_col <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> row_def<span class="main">)</span>

<span class="keyword1" id="Tensor-length_col_mat_to_cols_list"><span class="command">lemma</span></span> length_col_mat_to_cols_list <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">&lt;</span> dim_col <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>col <span class="main">(</span>mat_to_cols_list <span class="free">A</span><span class="main">)</span> <span class="free">j</span><span class="main">)</span> <span class="main">=</span> dim_row <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> col_def mat_to_cols_list_def<span class="main">)</span>

<span class="keyword1" id="Tensor-mat_to_cols_list_is_not_Nil"><span class="command">lemma</span></span> mat_to_cols_list_is_not_Nil <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"dim_col <span class="free">A</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"mat_to_cols_list <span class="free">A</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mat_to_cols_list_def<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Link between Matrix\_Tensor.row\_length and Matrix.dim\_row›</span></span>

<span class="keyword1" id="Tensor-row_length_mat_to_cols_list"><span class="command">lemma</span></span> row_length_mat_to_cols_list <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"dim_col <span class="free">A</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"mult.row_length <span class="main">(</span>mat_to_cols_list <span class="free">A</span><span class="main">)</span> <span class="main">=</span> dim_row <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"mat_to_cols_list <span class="free">A</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"mult.row_length <span class="main">(</span>mat_to_cols_list <span class="free">A</span><span class="main">)</span> <span class="main">=</span> length <span class="main">(</span>hd <span class="main">(</span>mat_to_cols_list <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> mult.row_length_def<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(*)</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⋀</span><span class="bound">xs</span><span class="main">.</span> Matrix_Tensor.mult <span class="main">1</span> <span class="main">(*)</span> <span class="main">⟹</span> mult.row_length <span class="bound">xs</span> <span class="main">≡</span> <span class="keyword1">if</span> <span class="bound">xs</span> <span class="main">=</span> <span class="main">[]</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> length <span class="main">(</span>hd <span class="bound">xs</span><span class="main">)</span>›</span></span> mult.intro<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms mat_to_cols_list_def upt_conv_Cons<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">mat_to_cols_list</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is a matrix in the sense of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">theory</span></span> <a href="../Matrix/Matrix_Legacy.html"></a><a href="../Matrix/Matrix_Legacy.html">Matrix.Matrix_Legacy</a><span class="antiquote"><span class="antiquote">}</span></span></span></span>.›</span></span>

<span class="keyword1" id="Tensor-mat_to_cols_list_is_mat"><span class="command">lemma</span></span> mat_to_cols_list_is_mat <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"dim_col <span class="free">A</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"mat <span class="main">(</span>mult.row_length <span class="main">(</span>mat_to_cols_list <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>length <span class="main">(</span>mat_to_cols_list <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>mat_to_cols_list <span class="free">A</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Ball <span class="main">(</span>set <span class="main">(</span>mat_to_cols_list <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Matrix_Legacy.vec <span class="main">(</span>mult.row_length <span class="main">(</span>mat_to_cols_list <span class="free">A</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms row_length_mat_to_cols_list mat_to_cols_list_def Ball_def set_def vec_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mat_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">mat_of_cols_list</span><span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> complex list list <span class="main">⇒</span> complex Matrix.mat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">mat_of_cols_list</span> <span class="free"><span class="bound"><span class="entity">nr</span></span></span> <span class="free"><span class="bound"><span class="entity">cs</span></span></span> <span class="main">=</span> Matrix.mat <span class="free"><span class="bound"><span class="entity">nr</span></span></span> <span class="main">(</span>length <span class="free"><span class="bound"><span class="entity">cs</span></span></span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">cs</span></span></span> <span class="main">!</span> <span class="bound">j</span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Tensor-index_mat_of_cols_list"><span class="command">lemma</span></span> index_mat_of_cols_list <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="free">nr</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">&lt;</span> length <span class="free">cs</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"mat_of_cols_list <span class="free">nr</span> <span class="free">cs</span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="free">j</span><span class="main">)</span> <span class="main">=</span> <span class="free">cs</span> <span class="main">!</span> <span class="free">j</span> <span class="main">!</span> <span class="free">i</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms mat_of_cols_list_def<span class="main">)</span> 

<span class="keyword1" id="Tensor-mat_to_cols_list_to_mat"><span class="command">lemma</span></span> mat_to_cols_list_to_mat <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"mat_of_cols_list <span class="main">(</span>dim_row <span class="free">A</span><span class="main">)</span> <span class="main">(</span>mat_to_cols_list <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> f1<span class="main">:</span><span class="quoted"><span class="quoted">"dim_row <span class="main">(</span>mat_of_cols_list <span class="main">(</span>dim_row <span class="free">A</span><span class="main">)</span> <span class="main">(</span>mat_to_cols_list <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> dim_row <span class="free">A</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mat_of_cols_list_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> f2<span class="main">:</span><span class="quoted"><span class="quoted">"dim_col <span class="main">(</span>mat_of_cols_list <span class="main">(</span>dim_row <span class="free">A</span><span class="main">)</span> <span class="main">(</span>mat_to_cols_list <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> dim_col <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Tensor.mat_of_cols_list_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span> <span class="bound">j</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> dim_row <span class="free">A</span> <span class="main">⟹</span> <span class="bound">j</span> <span class="main">&lt;</span> dim_col <span class="free">A</span> <span class="main">⟹</span> 
    <span class="main">(</span>mat_of_cols_list <span class="main">(</span>dim_row <span class="free">A</span><span class="main">)</span> <span class="main">(</span>mat_to_cols_list <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span> <span class="main">=</span> <span class="free">A</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mat_of_cols_list_def mat_to_cols_list_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Tensor-plus_mult_cpx"><span class="command">lemma</span></span> plus_mult_cpx <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"plus_mult <span class="main">1</span> <span class="main">(*)</span> <span class="main">0</span> <span class="main">(+)</span> <span class="main">(</span>a_inv cpx_rng<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">unfold_locales</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> cpx_cring_is_field <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">+</span> <span class="main">⊖</span><span class="hidden">⇘</span><sub>cpx_rng</sub><span class="hidden">⇙</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> group.r_inv<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"cpx_rng"</span></span><span class="main">]</span> cpx_cring_is_field field_def domain_def cpx_rng_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> UNIV_I cring.cring_simprules<span class="main"><span class="main">(</span></span>17<span class="main"><span class="main">)</span></span> ordered_semiring_record_simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> 
        ordered_semiring_record_simps<span class="main"><span class="main">(</span></span>11<span class="main"><span class="main">)</span></span> ordered_semiring_record_simps<span class="main"><span class="main">(</span></span>12<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">+</span> <span class="main">⊖</span><span class="hidden">⇘</span><sub>cpx_rng</sub><span class="hidden">⇙</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> group.r_inv<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"cpx_rng"</span></span><span class="main">]</span> cpx_cring_is_field field_def domain_def cpx_rng_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> UNIV_I cring.cring_simprules<span class="main"><span class="main">(</span></span>17<span class="main"><span class="main">)</span></span> ordered_semiring_record_simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> 
        ordered_semiring_record_simps<span class="main"><span class="main">(</span></span>11<span class="main"><span class="main">)</span></span> ordered_semiring_record_simps<span class="main"><span class="main">(</span></span>12<span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Tensor-list_to_mat_to_cols_list"><span class="command">lemma</span></span> list_to_mat_to_cols_list <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">l</span><span class="main">::</span><span class="quoted"><span class="quoted">"complex list list"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"mat <span class="free">nr</span> <span class="free">nc</span> <span class="free">l</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"mat_to_cols_list <span class="main">(</span>mat_of_cols_list <span class="free">nr</span> <span class="free">l</span><span class="main">)</span> <span class="main">=</span> <span class="free">l</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>mat_to_cols_list <span class="main">(</span>mat_of_cols_list <span class="free">nr</span> <span class="free">l</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> length <span class="free">l</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mat_of_cols_list_def<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> f1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">&lt;</span>length <span class="free">l</span><span class="main">.</span> length<span class="main">(</span><span class="free">l</span> <span class="main">!</span> <span class="bound">j</span><span class="main">)</span> <span class="main">=</span> mult.row_length <span class="free">l</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms plus_mult.row_length_constant plus_mult_cpx <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">j</span><span class="main">.</span> <span class="bound">j</span><span class="main">&lt;</span>length <span class="free">l</span> <span class="main">⟶</span> mat_to_cols_list <span class="main">(</span>mat_of_cols_list <span class="free">nr</span> <span class="free">l</span><span class="main">)</span> <span class="main">!</span> <span class="bound">j</span> <span class="main">=</span> <span class="free">l</span> <span class="main">!</span> <span class="bound">j</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">j</span>
    <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> length <span class="free">l</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> f2<span class="main">:</span><span class="quoted"><span class="quoted">"length <span class="main">(</span>mat_to_cols_list <span class="main">(</span>mat_of_cols_list <span class="free">nr</span> <span class="free">l</span><span class="main">)</span> <span class="main">!</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> length <span class="main">(</span><span class="free">l</span> <span class="main">!</span> <span class="skolem">j</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> col_def mat_def vec_def mat_of_cols_list_def assms dim_col_mat<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> dim_row_mat<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> 
length_col_mat_to_cols_list nth_mem<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span>mult.row_length <span class="free">l</span><span class="main">.</span> mat_to_cols_list <span class="main">(</span>mat_of_cols_list <span class="free">nr</span> <span class="free">l</span><span class="main">)</span> <span class="main">!</span> <span class="skolem">j</span> <span class="main">!</span> <span class="bound">i</span> <span class="main">=</span> <span class="free">l</span> <span class="main">!</span> <span class="skolem">j</span> <span class="main">!</span> <span class="bound">i</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> a mat_to_cols_list_def mat_of_cols_list_def f1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"mat_to_cols_list <span class="main">(</span>Tensor.mat_of_cols_list <span class="free">nr</span> <span class="free">l</span><span class="main">)</span> <span class="main">!</span> <span class="skolem">j</span> <span class="main">=</span> <span class="free">l</span> <span class="main">!</span> <span class="skolem">j</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> f2 <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nth_equalityI a f1<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> nth_equalityI <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Tensor-col_mat_of_cols_list"><span class="command">lemma</span></span> col_mat_of_cols_list <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">&lt;</span> length <span class="free">l</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Matrix.col <span class="main">(</span>mat_of_cols_list <span class="main">(</span>length <span class="main">(</span><span class="free">l</span> <span class="main">!</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="free">l</span><span class="main">)</span> <span class="free">j</span> <span class="main">=</span> vec_of_list <span class="main">(</span><span class="free">l</span> <span class="main">!</span> <span class="free">j</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">=</span> Matrix.col <span class="main">(</span>mat_of_cols_list <span class="main">(</span>length <span class="main">(</span><span class="free">l</span> <span class="main">!</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="free">l</span><span class="main">)</span> <span class="free">j</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"dim_vec <span class="skolem">u</span> <span class="main">=</span> dim_vec <span class="main">(</span>vec_of_list <span class="main">(</span><span class="free">l</span> <span class="main">!</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> u_def mat_of_cols_list_def Matrix.col_def vec_of_list_def<span class="main">)</span>
      <span class="main">(</span><span class="operator">metis</span> dim_vec_of_list vec_of_list.abs_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span>length<span class="main">(</span><span class="free">l</span> <span class="main">!</span> <span class="free">j</span><span class="main">)</span><span class="main">.</span> <span class="skolem">u</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">=</span> vec_of_list <span class="main">(</span><span class="free">l</span> <span class="main">!</span> <span class="free">j</span><span class="main">)</span> <span class="main">$</span> <span class="bound">i</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> u_def vec_of_list_index mat_of_cols_list_def assms<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vec_eq_iff u_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">tensor_mat</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>complex Matrix.mat<span class="main">,</span> complex Matrix.mat<span class="main">]</span> <span class="main">⇒</span> complex Matrix.mat"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">⨂</span>"</span> 63<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span> 
<span class="quoted"><span class="quoted">"<span class="free">tensor_mat</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="main">≡</span> 
  mat_of_cols_list <span class="main">(</span>dim_row <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">*</span> dim_row <span class="free"><span class="bound"><span class="entity">B</span></span></span><span class="main">)</span> <span class="main">(</span>mult.Tensor <span class="main">(*)</span> <span class="main">(</span>mat_to_cols_list <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span> <span class="main">(</span>mat_to_cols_list <span class="free"><span class="bound"><span class="entity">B</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
  
<span class="keyword1" id="Tensor-dim_row_tensor_mat"><span class="command">lemma</span></span> dim_row_tensor_mat <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"dim_row <span class="main">(</span><span class="free">A</span> <span class="main">⨂</span> <span class="free">B</span><span class="main">)</span> <span class="main">=</span> dim_row <span class="free">A</span> <span class="main">*</span> dim_row <span class="free">B</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mat_of_cols_list_def tensor_mat_def<span class="main">)</span>

<span class="keyword1" id="Tensor-dim_col_tensor_mat"><span class="command">lemma</span></span> dim_col_tensor_mat <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"dim_col <span class="main">(</span><span class="free">A</span> <span class="main">⨂</span> <span class="free">B</span><span class="main">)</span> <span class="main">=</span> dim_col <span class="free">A</span> <span class="main">*</span> dim_col <span class="free">B</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> tensor_mat_def mat_of_cols_list_def mult.length_Tensor<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(*)</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⋀</span><span class="bound">M2</span> <span class="bound">M1</span><span class="main">.</span> Matrix_Tensor.mult <span class="main">1</span> <span class="main">(*)</span> <span class="main">⟹</span> length <span class="main">(</span>mult.Tensor <span class="main">(*)</span> <span class="bound">M1</span> <span class="bound">M2</span><span class="main">)</span> <span class="main">=</span> length <span class="bound">M1</span> <span class="main">*</span> length <span class="bound">M2</span>›</span></span> mult.intro<span class="main">)</span>

<span class="keyword1" id="Tensor-index_tensor_mat"><span class="command">lemma</span></span> index_tensor_mat <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted">"dim_row <span class="free">A</span> <span class="main">=</span> <span class="free">rA</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a2<span class="main">:</span><span class="quoted"><span class="quoted">"dim_col <span class="free">A</span> <span class="main">=</span> <span class="free">cA</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a3<span class="main">:</span><span class="quoted"><span class="quoted">"dim_row <span class="free">B</span> <span class="main">=</span> <span class="free">rB</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a4<span class="main">:</span><span class="quoted"><span class="quoted">"dim_col <span class="free">B</span> <span class="main">=</span> <span class="free">cB</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> a5<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="free">rA</span> <span class="main">*</span> <span class="free">rB</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a6<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">&lt;</span> <span class="free">cA</span> <span class="main">*</span> <span class="free">cB</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a7<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">cA</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a8<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">cB</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">A</span> <span class="main">⨂</span> <span class="free">B</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="free">j</span><span class="main">)</span> <span class="main">=</span> <span class="free">A</span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span> <span class="keyword1">div</span> <span class="free">rB</span><span class="main">,</span> <span class="free">j</span> <span class="keyword1">div</span> <span class="free">cB</span><span class="main">)</span> <span class="main">*</span> <span class="free">B</span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span> <span class="keyword1">mod</span> <span class="free">rB</span><span class="main">,</span> <span class="free">j</span> <span class="keyword1">mod</span> <span class="free">cB</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">A</span> <span class="main">⨂</span> <span class="free">B</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="free">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>mult.Tensor <span class="main">(*)</span> <span class="main">(</span>mat_to_cols_list <span class="free">A</span><span class="main">)</span> <span class="main">(</span>mat_to_cols_list <span class="free">B</span><span class="main">)</span><span class="main">)</span> <span class="main">!</span> <span class="free">j</span> <span class="main">!</span> <span class="free">i</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms tensor_mat_def mat_of_cols_list_def dim_col_tensor_mat <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> f<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> mult.row_length <span class="main">(</span>mat_to_cols_list <span class="free">A</span><span class="main">)</span> <span class="main">*</span> mult.row_length <span class="main">(</span>mat_to_cols_list <span class="free">B</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a1 a2 a3 a4 a5 a7 a8<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">&lt;</span> length <span class="main">(</span>mat_to_cols_list <span class="free">A</span><span class="main">)</span> <span class="main">*</span> length <span class="main">(</span>mat_to_cols_list <span class="free">B</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a2 a4 a6<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"mat <span class="main">(</span>mult.row_length <span class="main">(</span>mat_to_cols_list <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>length <span class="main">(</span>mat_to_cols_list <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>mat_to_cols_list <span class="free">A</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> a2 a7 mat_to_cols_list_is_mat <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"mat <span class="main">(</span>mult.row_length <span class="main">(</span>mat_to_cols_list <span class="free">B</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>length <span class="main">(</span>mat_to_cols_list <span class="free">B</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>mat_to_cols_list <span class="free">B</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> a4 a8 mat_to_cols_list_is_mat <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">A</span> <span class="main">⨂</span> <span class="free">B</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="free">j</span><span class="main">)</span> <span class="main">=</span> 
    <span class="main">(</span>mat_to_cols_list <span class="free">A</span><span class="main">)</span> <span class="main">!</span> <span class="main">(</span><span class="free">j</span> <span class="keyword1">div</span> length <span class="main">(</span>mat_to_cols_list <span class="free">B</span><span class="main">)</span><span class="main">)</span> <span class="main">!</span> <span class="main">(</span><span class="free">i</span> <span class="keyword1">div</span> mult.row_length <span class="main">(</span>mat_to_cols_list <span class="free">B</span><span class="main">)</span><span class="main">)</span> 
    <span class="main">*</span> <span class="main">(</span>mat_to_cols_list <span class="free">B</span><span class="main">)</span> <span class="main">!</span> <span class="main">(</span><span class="free">j</span> <span class="keyword1">mod</span> length <span class="main">(</span>mat_to_cols_list <span class="free">B</span><span class="main">)</span><span class="main">)</span> <span class="main">!</span> <span class="main">(</span><span class="free">i</span> <span class="keyword1">mod</span> mult.row_length <span class="main">(</span>mat_to_cols_list <span class="free">B</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> mult.matrix_Tensor_elements<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(*)</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⋀</span><span class="bound">M2</span> <span class="bound">M1</span><span class="main">.</span> mult <span class="main">1</span> <span class="main">(*)</span> <span class="main">⟹</span> <span class="main">∀</span><span class="bound">i</span> <span class="bound">j</span><span class="main">.</span> <span class="main">(</span><span class="bound">i</span><span class="main">&lt;</span>mult.row_length <span class="bound">M1</span> <span class="main">*</span> mult.row_length <span class="bound">M2</span> 
    <span class="main">∧</span> <span class="bound">j</span><span class="main">&lt;</span>length <span class="bound">M1</span> <span class="main">*</span> length <span class="bound">M2</span><span class="main">)</span> <span class="main">∧</span> mat <span class="main">(</span>mult.row_length <span class="bound">M1</span><span class="main">)</span> <span class="main">(</span>length <span class="bound">M1</span><span class="main">)</span> <span class="bound">M1</span> <span class="main">∧</span> mat <span class="main">(</span>mult.row_length <span class="bound">M2</span><span class="main">)</span> <span class="main">(</span>length <span class="bound">M2</span><span class="main">)</span> <span class="bound">M2</span> <span class="main">⟶</span> 
    mult.Tensor <span class="main">(*)</span> <span class="bound">M1</span> <span class="bound">M2</span> <span class="main">!</span> <span class="bound">j</span> <span class="main">!</span> <span class="bound">i</span> <span class="main">=</span> <span class="bound">M1</span> <span class="main">!</span> <span class="main">(</span><span class="bound">j</span> <span class="keyword1">div</span> length <span class="bound">M2</span><span class="main">)</span> <span class="main">!</span> <span class="main">(</span><span class="bound">i</span> <span class="keyword1">div</span> mult.row_length <span class="bound">M2</span><span class="main">)</span> <span class="main">*</span> <span class="bound">M2</span> <span class="main">!</span> <span class="main">(</span><span class="bound">j</span> <span class="keyword1">mod</span> length <span class="bound">M2</span><span class="main">)</span> <span class="main">!</span> <span class="main">(</span><span class="bound">i</span> <span class="keyword1">mod</span> mult.row_length <span class="bound">M2</span><span class="main">)</span>›</span></span>  mult.intro<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> mat_to_cols_list_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> a2 a3 a4 a6 f index_mat_of_cols_list length_mat_to_cols_list less_mult_imp_div_less 
less_nat_zero_code mat_to_cols_list_to_mat mult_0_right neq0_conv row_length_mat_to_cols_list 
unique_euclidean_semiring_numeral_class.pos_mod_bound<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹To go from <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">Matrix.row</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> to <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">Matrix_Legacy.row</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>›</span></span>

<span class="keyword1" id="Tensor-Matrix_row_is_Legacy_row"><span class="command">lemma</span></span> Matrix_row_is_Legacy_row<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> dim_row <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Matrix.row <span class="free">A</span> <span class="free">i</span> <span class="main">=</span> vec_of_list <span class="main">(</span>row <span class="main">(</span>mat_to_cols_list <span class="free">A</span><span class="main">)</span> <span class="free">i</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_vec <span class="main">(</span>Matrix.row <span class="free">A</span> <span class="free">i</span><span class="main">)</span> <span class="main">=</span> dim_vec <span class="main">(</span>vec_of_list <span class="main">(</span>row <span class="main">(</span>mat_to_cols_list <span class="free">A</span><span class="main">)</span> <span class="free">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> length_mat_to_cols_list Matrix.dim_vec_of_list <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> row_def index_row<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> length_map<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">j</span><span class="main">.</span> <span class="bound">j</span><span class="main">&lt;</span>dim_vec <span class="main">(</span>vec_of_list <span class="main">(</span>row <span class="main">(</span>mat_to_cols_list <span class="free">A</span><span class="main">)</span> <span class="free">i</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> 
              Matrix.row <span class="free">A</span> <span class="free">i</span> <span class="main">$</span> <span class="bound">j</span> <span class="main">=</span> vec_of_list <span class="main">(</span>row <span class="main">(</span>mat_to_cols_list <span class="free">A</span><span class="main">)</span> <span class="free">i</span><span class="main">)</span> <span class="main">$</span> <span class="bound">j</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Matrix.row_def vec_of_list_def mat_to_cols_list_def
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">smt</span> row_def assms dim_vec_of_list index_mat_of_cols_list index_row<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> 
length_mat_to_cols_list length_row_mat_to_cols_list mat_to_cols_list_to_mat nth_map vec_of_list_index<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹To go from <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">Matrix_Legacy.row</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> to <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">Matrix.row</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>›</span></span>

<span class="keyword1" id="Tensor-Legacy_row_is_Matrix_row"><span class="command">lemma</span></span> Legacy_row_is_Matrix_row<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> mult.row_length <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"row <span class="free">A</span> <span class="free">i</span> <span class="main">=</span> list_of_vec <span class="main">(</span>Matrix.row <span class="main">(</span>mat_of_cols_list <span class="main">(</span>mult.row_length <span class="free">A</span><span class="main">)</span> <span class="free">A</span><span class="main">)</span> <span class="free">i</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> nth_equalityI<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>row <span class="free">A</span> <span class="free">i</span><span class="main">)</span> <span class="main">=</span> length <span class="main">(</span>list_of_vec <span class="main">(</span>Matrix.row <span class="main">(</span>mat_of_cols_list <span class="main">(</span>mult.row_length <span class="free">A</span><span class="main">)</span> <span class="free">A</span><span class="main">)</span> <span class="free">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> row_def length_list_of_vec <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">metis</span> mat_of_cols_list_def dim_col_mat<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> index_row<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> length_map<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">j</span><span class="main">::</span> <span class="quoted">nat</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> length <span class="main">(</span>row <span class="free">A</span> <span class="free">i</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"row <span class="free">A</span> <span class="free">i</span> <span class="main">!</span> <span class="skolem">j</span> <span class="main">=</span> list_of_vec <span class="main">(</span>Matrix.row <span class="main">(</span>mat_of_cols_list <span class="main">(</span>mult.row_length <span class="free">A</span><span class="main">)</span> <span class="free">A</span><span class="main">)</span> <span class="free">i</span><span class="main">)</span> <span class="main">!</span> <span class="skolem">j</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms index_mat_of_cols_list
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">metis</span> row_def mat_of_cols_list_def dim_col_mat<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> dim_row_mat<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> index_row<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> length_map list_of_vec_index nth_map<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹To go from <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">Matrix.col</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> to <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">Matrix_Legacy.col</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>›</span></span>

<span class="keyword1" id="Tensor-Matrix_col_is_Legacy_col"><span class="command">lemma</span></span> Matrix_col_is_Legacy_col<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">&lt;</span> dim_col <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Matrix.col <span class="free">A</span> <span class="free">j</span> <span class="main">=</span> vec_of_list <span class="main">(</span>col <span class="main">(</span>mat_to_cols_list <span class="free">A</span><span class="main">)</span> <span class="free">j</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_vec <span class="main">(</span>Matrix.col <span class="free">A</span> <span class="free">j</span><span class="main">)</span> <span class="main">=</span> dim_vec <span class="main">(</span>vec_of_list <span class="main">(</span>col <span class="main">(</span>mat_to_cols_list <span class="free">A</span><span class="main">)</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> col_def assms mat_to_cols_list_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> dim_vec <span class="main">(</span>vec_of_list <span class="main">(</span>col <span class="main">(</span>mat_to_cols_list <span class="free">A</span><span class="main">)</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span>
         Matrix.col <span class="free">A</span> <span class="free">j</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">=</span> vec_of_list <span class="main">(</span>col <span class="main">(</span>mat_to_cols_list <span class="free">A</span><span class="main">)</span> <span class="free">j</span><span class="main">)</span> <span class="main">$</span> <span class="bound">i</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> mat_to_cols_list_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> col_def assms col_mat_of_cols_list length_col_mat_to_cols_list length_mat_to_cols_list 
mat_to_cols_list_to_mat<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹To go from <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">Matrix_Legacy.col</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> to <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">Matrix.col</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>›</span></span>

<span class="keyword1" id="Tensor-Legacy_col_is_Matrix_col"><span class="command">lemma</span></span> Legacy_col_is_Matrix_col<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">&lt;</span> length <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a2<span class="main">:</span><span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="free">A</span> <span class="main">!</span> <span class="free">j</span><span class="main">)</span> <span class="main">=</span> mult.row_length <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"col <span class="free">A</span> <span class="free">j</span> <span class="main">=</span> list_of_vec <span class="main">(</span>Matrix.col <span class="main">(</span>mat_of_cols_list <span class="main">(</span>mult.row_length <span class="free">A</span><span class="main">)</span> <span class="free">A</span><span class="main">)</span> <span class="free">j</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> nth_equalityI<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>list_of_vec <span class="main">(</span>Matrix.col <span class="main">(</span>mat_of_cols_list <span class="main">(</span>mult.row_length <span class="free">A</span><span class="main">)</span> <span class="free">A</span><span class="main">)</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
dim_vec <span class="main">(</span>Matrix.col <span class="main">(</span>mat_of_cols_list <span class="main">(</span>mult.row_length <span class="free">A</span><span class="main">)</span> <span class="free">A</span><span class="main">)</span> <span class="free">j</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> length_list_of_vec <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> dim_row <span class="main">(</span>mat_of_cols_list <span class="main">(</span>mult.row_length <span class="free">A</span><span class="main">)</span> <span class="free">A</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Matrix.col_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> f1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> mult.row_length <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mat_of_cols_list_def<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> f2<span class="main">:</span><span class="quoted"><span class="quoted">"length <span class="main">(</span>col <span class="free">A</span> <span class="free">j</span><span class="main">)</span> <span class="main">=</span> length <span class="main">(</span>list_of_vec <span class="main">(</span>Matrix.col <span class="main">(</span>mat_of_cols_list <span class="main">(</span>mult.row_length <span class="free">A</span><span class="main">)</span> <span class="free">A</span><span class="main">)</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> a2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> col_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span><span class="main">::</span> <span class="quoted">nat</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span><span class="main">&lt;</span>length <span class="main">(</span>col <span class="free">A</span> <span class="free">j</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>col <span class="free">A</span> <span class="free">j</span><span class="main">)</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">=</span> <span class="main">(</span>list_of_vec <span class="main">(</span>Matrix.col <span class="main">(</span>mat_of_cols_list <span class="main">(</span>mult.row_length <span class="free">A</span><span class="main">)</span> <span class="free">A</span><span class="main">)</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="main">!</span> <span class="skolem">i</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> col_def a1 a2 col_mat_of_cols_list list_vec<span class="main">)</span> 
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Link between <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">plus_mult.scalar_product</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">Matrix.scalar_prod</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>›</span></span>

<span class="keyword1" id="Tensor-scalar_prod_is_Matrix_scalar_prod"><span class="command">lemma</span></span> scalar_prod_is_Matrix_scalar_prod <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">u</span><span class="main">::</span><span class="quoted"><span class="quoted">"complex list"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">v</span><span class="main">::</span><span class="quoted"><span class="quoted">"complex list"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"length <span class="free">u</span> <span class="main">=</span> length <span class="free">v</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"plus_mult.scalar_product <span class="main">(*)</span> <span class="main">0</span> <span class="main">(+)</span> <span class="free">u</span> <span class="free">v</span> <span class="main">=</span> <span class="main">(</span>vec_of_list <span class="free">u</span><span class="main">)</span> <span class="main">∙</span> <span class="main">(</span>vec_of_list <span class="free">v</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> f<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>vec_of_list <span class="free">u</span><span class="main">)</span> <span class="main">∙</span> <span class="main">(</span>vec_of_list <span class="free">v</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">=</span><span class="main">0</span><span class="main">..&lt;</span>length <span class="free">v</span><span class="main">.</span> <span class="free">u</span> <span class="main">!</span> <span class="bound">i</span> <span class="main">*</span> <span class="free">v</span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms scalar_prod_def<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"vec_of_list <span class="free">u</span>"</span></span> <span class="quoted"><span class="quoted">"vec_of_list <span class="free">v</span>"</span></span><span class="main">]</span> Matrix.dim_vec_of_list<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">v</span></span><span class="main">]</span> index_vec_of_list
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> atLeastLessThan_iff sum.cong<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"plus_mult.scalar_product <span class="main">(*)</span> <span class="main">0</span> <span class="main">(+)</span> <span class="free">u</span> <span class="free">v</span> <span class="main">=</span> semiring_0_class.scalar_prod <span class="free">u</span> <span class="free">v</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span>  plus_mult.scalar_product_def<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="quoted">"<span class="main">(*)</span>"</span></span> <span class="quoted"><span class="main">0</span></span> <span class="quoted"><span class="quoted">"<span class="main">(+)</span>"</span></span> <span class="quoted"><span class="quoted">"a_inv cpx_rng"</span></span> <span class="quoted"><span class="free">u</span></span> <span class="quoted"><span class="free">v</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> sum_list <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">*</span> <span class="bound">y</span><span class="main">)</span> <span class="main">(</span>zip <span class="free">u</span> <span class="free">v</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> scalar_prod<span class="main">)</span> 
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span>length <span class="free">v</span><span class="main">.</span> <span class="main">(</span>zip <span class="free">u</span> <span class="free">v</span><span class="main">)</span> <span class="main">!</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">(</span><span class="free">u</span> <span class="main">!</span> <span class="bound">i</span><span class="main">,</span> <span class="free">v</span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms zip_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span>length <span class="free">v</span><span class="main">.</span> <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">*</span> <span class="bound">y</span><span class="main">)</span> <span class="main">(</span>zip <span class="free">u</span> <span class="free">v</span><span class="main">)</span><span class="main">)</span> <span class="main">!</span> <span class="bound">i</span> <span class="main">=</span> <span class="free">u</span> <span class="main">!</span> <span class="bound">i</span> <span class="main">*</span> <span class="free">v</span> <span class="main">!</span> <span class="bound">i</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"plus_mult.scalar_product <span class="main">(*)</span> <span class="main">0</span> <span class="main">(+)</span> <span class="free">u</span> <span class="free">v</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">=</span><span class="main">0</span><span class="main">..&lt;</span>length <span class="free">v</span><span class="main">.</span> <span class="free">u</span> <span class="main">!</span> <span class="bound">i</span> <span class="main">*</span> <span class="free">v</span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> assms atLeastLessThan_iff length_map map_fst_zip sum.cong sum_list_sum_nth<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Link between <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">times</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">plus_mult.matrix_mult</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>›</span></span>

<span class="keyword1" id="Tensor-matrix_mult_to_times_mat"><span class="command">lemma</span></span> matrix_mult_to_times_mat<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"dim_col <span class="free">A</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"dim_col <span class="free">B</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"dim_col <span class="main">(</span><span class="free">A</span><span class="main">::</span>complex Matrix.mat<span class="main">)</span> <span class="main">=</span> dim_row <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">*</span> <span class="free">B</span> <span class="main">=</span> mat_of_cols_list <span class="main">(</span>dim_row <span class="free">A</span><span class="main">)</span> <span class="main">(</span>plus_mult.matrix_mult <span class="main">(*)</span> <span class="main">0</span> <span class="main">(+)</span> <span class="main">(</span>mat_to_cols_list <span class="free">A</span><span class="main">)</span> <span class="main">(</span>mat_to_cols_list <span class="free">B</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">M</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">M</span> <span class="main">=</span> mat_of_cols_list <span class="main">(</span>dim_row <span class="free">A</span><span class="main">)</span> <span class="main">(</span>plus_mult.matrix_mult <span class="main">(*)</span> <span class="main">0</span> <span class="main">(+)</span> <span class="main">(</span>mat_to_cols_list <span class="free">A</span><span class="main">)</span> <span class="main">(</span>mat_to_cols_list <span class="free">B</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> f1<span class="main">:</span><span class="quoted"><span class="quoted">"dim_row <span class="main">(</span><span class="free">A</span> <span class="main">*</span> <span class="free">B</span><span class="main">)</span> <span class="main">=</span> dim_row <span class="skolem">M</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mat_of_cols_list_def times_mat_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>plus_mult.matrix_mult <span class="main">(*)</span> <span class="main">0</span> <span class="main">(+)</span> <span class="main">(</span>mat_to_cols_list <span class="free">A</span><span class="main">)</span> <span class="main">(</span>mat_to_cols_list <span class="free">B</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> dim_col <span class="free">B</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mat_multI_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> f2<span class="main">:</span><span class="quoted"><span class="quoted">"dim_col <span class="main">(</span><span class="free">A</span> <span class="main">*</span> <span class="free">B</span><span class="main">)</span> <span class="main">=</span> dim_col <span class="skolem">M</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> M_def times_mat_def mat_of_cols_list_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span> <span class="bound">j</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> dim_row <span class="skolem">M</span> <span class="main">⟹</span> <span class="bound">j</span> <span class="main">&lt;</span> dim_col <span class="skolem">M</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">A</span> <span class="main">*</span> <span class="free">B</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">M</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span>
    <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> dim_row <span class="skolem">M</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> dim_col <span class="skolem">M</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">A</span> <span class="main">*</span> <span class="free">B</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> Matrix.row <span class="free">A</span> <span class="skolem">i</span> <span class="main">∙</span> Matrix.col <span class="free">B</span> <span class="skolem">j</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> f1 f2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> vec_of_list <span class="main">(</span>row <span class="main">(</span>mat_to_cols_list <span class="free">A</span><span class="main">)</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">∙</span> vec_of_list <span class="main">(</span>col <span class="main">(</span>mat_to_cols_list <span class="free">B</span><span class="main">)</span> <span class="skolem">j</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> f1 f2 a1 a2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Matrix_row_is_Legacy_row Matrix_col_is_Legacy_col<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> plus_mult.scalar_product <span class="main">(*)</span> <span class="main">0</span> <span class="main">(+)</span> <span class="main">(</span>row <span class="main">(</span>mat_to_cols_list <span class="free">A</span><span class="main">)</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span>col <span class="main">(</span>mat_to_cols_list <span class="free">B</span><span class="main">)</span> <span class="skolem">j</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> a1 a2 assms<span class="main">(</span>3<span class="main">)</span> f1 f2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">M</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span>  plus_mult.scalar_product <span class="main">(*)</span> <span class="main">0</span> <span class="main">(+)</span> <span class="main">(</span>row <span class="main">(</span>mat_to_cols_list <span class="free">A</span><span class="main">)</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span>col <span class="main">(</span>mat_to_cols_list <span class="free">B</span><span class="main">)</span> <span class="skolem">j</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">M</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>plus_mult.matrix_mult <span class="main">(*)</span> <span class="main">0</span> <span class="main">(+)</span> <span class="main">(</span>mat_to_cols_list <span class="free">A</span><span class="main">)</span> <span class="main">(</span>mat_to_cols_list <span class="free">B</span><span class="main">)</span><span class="main">)</span> <span class="main">!</span> <span class="skolem">j</span> <span class="main">!</span> <span class="skolem">i</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> M_def f1 f2 
<span class="quoted"><span class="quoted">‹length <span class="main">(</span>mat_mult <span class="main">(</span>mult.row_length <span class="main">(</span>mat_to_cols_list <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>mat_to_cols_list <span class="free">A</span><span class="main">)</span> <span class="main">(</span>mat_to_cols_list <span class="free">B</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> dim_col <span class="free">B</span>›</span></span> a1 a2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"mat <span class="main">(</span>mult.row_length <span class="main">(</span>mat_to_cols_list <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>dim_col <span class="free">A</span><span class="main">)</span> <span class="main">(</span>mat_to_cols_list <span class="free">A</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> mat_to_cols_list_is_mat assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"mat <span class="main">(</span>dim_col <span class="free">A</span><span class="main">)</span> <span class="main">(</span>dim_col <span class="free">B</span><span class="main">)</span> <span class="main">(</span>mat_to_cols_list <span class="free">B</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> assms<span class="main">(</span>3<span class="main">)</span> mat_to_cols_list_is_mat <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> a1 a2 row_length_mat_to_cols_list plus_mult.matrix_index<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="quoted">"<span class="main">(*)</span>"</span></span> <span class="quoted"><span class="main">0</span></span> <span class="quoted"><span class="quoted">"<span class="main">(+)</span>"</span></span><span class="main">]</span> plus_mult_cpx
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> f1 f2 index_mult_mat<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> index_mult_mat<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">A</span> <span class="main">*</span> <span class="free">B</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">M</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Tensor-mat_to_cols_list_times_mat"><span class="command">lemma</span></span> mat_to_cols_list_times_mat <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"dim_col <span class="free">A</span> <span class="main">=</span> dim_row <span class="free">B</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"dim_col <span class="free">A</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"mat_to_cols_list <span class="main">(</span><span class="free">A</span> <span class="main">*</span> <span class="free">B</span><span class="main">)</span> <span class="main">=</span> plus_mult.matrix_mult <span class="main">(*)</span> <span class="main">0</span> <span class="main">(+)</span> <span class="main">(</span>mat_to_cols_list <span class="free">A</span><span class="main">)</span> <span class="main">(</span>mat_to_cols_list <span class="free">B</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> nth_equalityI<span class="main">)</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">M</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">M</span> <span class="main">=</span> plus_mult.matrix_mult <span class="main">(*)</span> <span class="main">0</span> <span class="main">(+)</span> <span class="main">(</span>mat_to_cols_list <span class="free">A</span><span class="main">)</span> <span class="main">(</span>mat_to_cols_list <span class="free">B</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> f0<span class="main">:</span><span class="quoted"><span class="quoted">"length <span class="main">(</span>mat_to_cols_list <span class="main">(</span><span class="free">A</span> <span class="main">*</span> <span class="free">B</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> length <span class="skolem">M</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mat_multI_def<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> f1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">j</span><span class="main">.</span> <span class="bound">j</span><span class="main">&lt;</span>length <span class="main">(</span>mat_to_cols_list <span class="main">(</span><span class="free">A</span> <span class="main">*</span> <span class="free">B</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> mat_to_cols_list <span class="main">(</span><span class="free">A</span> <span class="main">*</span> <span class="free">B</span><span class="main">)</span> <span class="main">!</span> <span class="bound">j</span> <span class="main">=</span> <span class="skolem">M</span> <span class="main">!</span> <span class="bound">j</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">j</span><span class="main">::</span> <span class="quoted">nat</span>
    <span class="keyword3"><span class="command">assume</span></span> a0<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> length <span class="main">(</span>mat_to_cols_list <span class="main">(</span><span class="free">A</span> <span class="main">*</span> <span class="free">B</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>mat_to_cols_list <span class="main">(</span><span class="free">A</span> <span class="main">*</span> <span class="free">B</span><span class="main">)</span> <span class="main">!</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> dim_row <span class="free">A</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mat_to_cols_list_def<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command"><span class="improper">also</span></span></span> <span class="keyword1"><span class="command"><span class="improper">have</span></span></span> f2<span class="main">:</span><span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="skolem">M</span> <span class="main">!</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> dim_row <span class="free">A</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> a0 M_def mat_multI_def<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">0</span></span> <span class="quoted"><span class="quoted">"<span class="main">(+)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(*)</span>"</span></span> <span class="quoted"><span class="quoted">"dim_row <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"mat_to_cols_list <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"mat_to_cols_list <span class="free">B</span>"</span></span><span class="main">]</span> 
        row_length_mat_to_cols_list assms<span class="main">(</span>2<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> f0 length_greater_0_conv length_map length_mat_to_cols_list 
list_to_mat_to_cols_list mat_mult mat_to_cols_list_is_mat matrix_mult_to_times_mat<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>mat_to_cols_list <span class="main">(</span><span class="free">A</span> <span class="main">*</span> <span class="free">B</span><span class="main">)</span> <span class="main">!</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> length <span class="main">(</span><span class="skolem">M</span> <span class="main">!</span> <span class="skolem">j</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span><span class="main">&lt;</span>dim_row <span class="free">A</span> <span class="main">⟶</span> mat_to_cols_list <span class="main">(</span><span class="free">A</span> <span class="main">*</span> <span class="free">B</span><span class="main">)</span> <span class="main">!</span> <span class="skolem">j</span> <span class="main">!</span> <span class="bound">i</span> <span class="main">=</span> <span class="skolem">M</span> <span class="main">!</span> <span class="skolem">j</span> <span class="main">!</span> <span class="bound">i</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
      <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> dim_row <span class="free">A</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"mat <span class="main">(</span>mult.row_length <span class="main">(</span>mat_to_cols_list <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>dim_col <span class="free">A</span><span class="main">)</span> <span class="main">(</span>mat_to_cols_list <span class="free">A</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> mat_to_cols_list_is_mat assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"mat <span class="main">(</span>dim_col <span class="free">A</span><span class="main">)</span> <span class="main">(</span>dim_col <span class="free">B</span><span class="main">)</span> <span class="main">(</span>mat_to_cols_list <span class="free">B</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> mat_to_cols_list_is_mat assms<span class="main">(</span>1<span class="main">)</span> a0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">M</span> <span class="main">!</span> <span class="skolem">j</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">=</span> plus_mult.scalar_product <span class="main">(*)</span> <span class="main">0</span> <span class="main">(+)</span> <span class="main">(</span>row <span class="main">(</span>mat_to_cols_list <span class="free">A</span><span class="main">)</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span>col <span class="main">(</span>mat_to_cols_list <span class="free">B</span><span class="main">)</span> <span class="skolem">j</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> plus_mult.matrix_index a0 a1 row_length_mat_to_cols_list assms<span class="main">(</span>2<span class="main">)</span> plus_mult_cpx M_def
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> index_mult_mat<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> length_mat_to_cols_list<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> vec_of_list <span class="main">(</span>row <span class="main">(</span>mat_to_cols_list <span class="free">A</span><span class="main">)</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">∙</span> vec_of_list <span class="main">(</span>col <span class="main">(</span>mat_to_cols_list <span class="free">B</span><span class="main">)</span> <span class="skolem">j</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> a0 a1 assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"mat_to_cols_list <span class="main">(</span><span class="free">A</span> <span class="main">*</span> <span class="free">B</span><span class="main">)</span> <span class="main">!</span> <span class="skolem">j</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">=</span> <span class="skolem">M</span> <span class="main">!</span> <span class="skolem">j</span> <span class="main">!</span> <span class="skolem">i</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> mat_to_cols_list_def index_mult_mat<span class="main">(</span>1<span class="main">)</span> a0 a1 
        <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Matrix_row_is_Legacy_row Matrix_col_is_Legacy_col<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"mat_to_cols_list <span class="main">(</span><span class="free">A</span> <span class="main">*</span> <span class="free">B</span><span class="main">)</span> <span class="main">!</span> <span class="skolem">j</span> <span class="main">=</span> <span class="skolem">M</span> <span class="main">!</span> <span class="skolem">j</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nth_equalityI f2<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span><span class="main">::</span> <span class="quoted">nat</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="main">(</span>mat_to_cols_list <span class="main">(</span><span class="free">A</span> <span class="main">*</span> <span class="free">B</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"mat_to_cols_list <span class="main">(</span><span class="free">A</span> <span class="main">*</span> <span class="free">B</span><span class="main">)</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">=</span> <span class="skolem">M</span> <span class="main">!</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f1<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ 
Finally, we prove that the tensor product of complex matrices is distributive over the 
multiplication of complex matrices. 
›</span></span>

<span class="keyword1" id="Tensor-mult_distr_tensor"><span class="command">lemma</span></span> mult_distr_tensor<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted">"dim_col <span class="free">A</span> <span class="main">=</span> dim_row <span class="free">B</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a2<span class="main">:</span><span class="quoted"><span class="quoted">"dim_col <span class="free">C</span> <span class="main">=</span> dim_row <span class="free">D</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a3<span class="main">:</span><span class="quoted"><span class="quoted">"dim_col <span class="free">A</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
    a4<span class="main">:</span><span class="quoted"><span class="quoted">"dim_col <span class="free">B</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a5<span class="main">:</span><span class="quoted"><span class="quoted">"dim_col <span class="free">C</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a6<span class="main">:</span><span class="quoted"><span class="quoted">"dim_col <span class="free">D</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">A</span> <span class="main">*</span> <span class="free">B</span><span class="main">)</span> <span class="main">⨂</span> <span class="main">(</span><span class="free">C</span> <span class="main">*</span> <span class="free">D</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">A</span> <span class="main">⨂</span> <span class="free">C</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">B</span> <span class="main">⨂</span> <span class="free">D</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">A'</span></span> <span class="skolem"><span class="skolem">B'</span></span> <span class="skolem"><span class="skolem">C'</span></span> <span class="skolem"><span class="skolem">D'</span></span> <span class="skolem"><span class="skolem">M</span></span> <span class="skolem"><span class="skolem">N</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A'</span> <span class="main">=</span> mat_to_cols_list <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">B'</span> <span class="main">=</span> mat_to_cols_list <span class="free">B</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
    <span class="quoted"><span class="quoted">"<span class="skolem">C'</span> <span class="main">=</span> mat_to_cols_list <span class="free">C</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">D'</span> <span class="main">=</span> mat_to_cols_list <span class="free">D</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="quoted"><span class="quoted">"<span class="skolem">M</span> <span class="main">=</span> mat_of_cols_list <span class="main">(</span>dim_row <span class="free">A</span> <span class="main">*</span> dim_row <span class="free">C</span><span class="main">)</span> <span class="main">(</span>mult.Tensor <span class="main">(*)</span> <span class="main">(</span>mat_to_cols_list <span class="free">A</span><span class="main">)</span> <span class="main">(</span>mat_to_cols_list <span class="free">C</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="quoted"><span class="quoted">"<span class="skolem">N</span> <span class="main">=</span> mat_of_cols_list <span class="main">(</span>dim_row <span class="free">B</span> <span class="main">*</span> dim_row <span class="free">D</span><span class="main">)</span> <span class="main">(</span>mult.Tensor <span class="main">(*)</span> <span class="main">(</span>mat_to_cols_list <span class="free">B</span><span class="main">)</span> <span class="main">(</span>mat_to_cols_list <span class="free">D</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">A</span> <span class="main">⨂</span> <span class="free">C</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">B</span> <span class="main">⨂</span> <span class="free">D</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">M</span> <span class="main">*</span> <span class="skolem">N</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tensor_mat_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> mat_of_cols_list <span class="main">(</span>dim_row <span class="free">A</span> <span class="main">*</span> dim_row <span class="free">C</span><span class="main">)</span> <span class="main">(</span>plus_mult.matrix_mult <span class="main">(*)</span> <span class="main">0</span> <span class="main">(+)</span> 
  <span class="main">(</span>mat_to_cols_list <span class="skolem">M</span><span class="main">)</span> <span class="main">(</span>mat_to_cols_list <span class="skolem">N</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms M_def N_def dim_col_tensor_mat dim_row_tensor_mat tensor_mat_def 
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> matrix_mult_to_times_mat<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> f1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> mat_of_cols_list <span class="main">(</span>dim_row <span class="free">A</span> <span class="main">*</span> dim_row <span class="free">C</span><span class="main">)</span> <span class="main">(</span>plus_mult.matrix_mult <span class="main">(*)</span> <span class="main">0</span> <span class="main">(+)</span> 
  <span class="main">(</span>mult.Tensor <span class="main">(*)</span> <span class="skolem">A'</span> <span class="skolem">C'</span><span class="main">)</span> <span class="main">(</span>mult.Tensor <span class="main">(*)</span> <span class="skolem">B'</span> <span class="skolem">D'</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">M'</span></span> <span class="skolem"><span class="skolem">N'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">M'</span> <span class="main">=</span> mult.Tensor <span class="main">(*)</span> <span class="main">(</span>mat_to_cols_list <span class="free">A</span><span class="main">)</span> <span class="main">(</span>mat_to_cols_list <span class="free">C</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      <span class="quoted"><span class="quoted">"<span class="skolem">N'</span> <span class="main">=</span> mult.Tensor <span class="main">(*)</span> <span class="main">(</span>mat_to_cols_list <span class="free">B</span><span class="main">)</span> <span class="main">(</span>mat_to_cols_list <span class="free">D</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"mat <span class="main">(</span>mult.row_length <span class="skolem">M'</span><span class="main">)</span> <span class="main">(</span>length <span class="skolem">M'</span><span class="main">)</span> <span class="skolem">M'</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> M'_def mult.effective_well_defined_Tensor<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="quoted">"<span class="main">(*)</span>"</span></span><span class="main">]</span> mat_to_cols_list_is_mat a3 a5
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> mult.length_Tensor mult.row_length_mat plus_mult_cpx plus_mult_def<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"mat <span class="main">(</span>mult.row_length <span class="skolem">N'</span><span class="main">)</span> <span class="main">(</span>length <span class="skolem">N'</span><span class="main">)</span> <span class="skolem">N'</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> N'_def mult.effective_well_defined_Tensor<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="quoted">"<span class="main">(*)</span>"</span></span><span class="main">]</span> mat_to_cols_list_is_mat a4 a6
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> mult.length_Tensor mult.row_length_mat plus_mult_cpx plus_mult_def<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> list_to_mat_to_cols_list M_def N_def mult.row_length_mat row_length_mat_to_cols_list 
      assms<span class="main">(</span>3<span class="main">)</span> a4 a5 a6 A'_def B'_def C'_def D'_def <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">metis</span> M'_def N'_def plus_mult_cpx plus_mult_def<span class="main">)</span>
   <span class="keyword1"><span class="command">qed</span></span>
   <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> mat_of_cols_list <span class="main">(</span>dim_row <span class="free">A</span> <span class="main">*</span> dim_row <span class="free">C</span><span class="main">)</span> <span class="main">(</span>mult.Tensor <span class="main">(*)</span>
    <span class="main">(</span>plus_mult.matrix_mult <span class="main">(*)</span> <span class="main">0</span> <span class="main">(+)</span> <span class="skolem">A'</span> <span class="skolem">B'</span><span class="main">)</span>
    <span class="main">(</span>plus_mult.matrix_mult <span class="main">(*)</span> <span class="main">0</span> <span class="main">(+)</span> <span class="skolem">C'</span> <span class="skolem">D'</span><span class="main">)</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
     <span class="keyword1"><span class="command">have</span></span> f2<span class="main">:</span><span class="quoted"><span class="quoted">"mat <span class="main">(</span>mult.row_length <span class="skolem">A'</span><span class="main">)</span> <span class="main">(</span>length <span class="skolem">A'</span><span class="main">)</span> <span class="skolem">A'</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> A'_def a3 mat_to_cols_list_is_mat <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
     <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"mat <span class="main">(</span>mult.row_length <span class="skolem">B'</span><span class="main">)</span> <span class="main">(</span>length <span class="skolem">B'</span><span class="main">)</span> <span class="skolem">B'</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> B'_def a4 mat_to_cols_list_is_mat <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
     <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"mat <span class="main">(</span>mult.row_length <span class="skolem">C'</span><span class="main">)</span> <span class="main">(</span>length <span class="skolem">C'</span><span class="main">)</span> <span class="skolem">C'</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> C'_def a5 mat_to_cols_list_is_mat <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
     <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"mat <span class="main">(</span>mult.row_length <span class="skolem">D'</span><span class="main">)</span> <span class="main">(</span>length <span class="skolem">D'</span><span class="main">)</span> <span class="skolem">D'</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> D'_def a6 mat_to_cols_list_is_mat <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
     <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">A'</span> <span class="main">=</span> mult.row_length <span class="skolem">B'</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> A'_def B'_def a1 a4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
     <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">C'</span> <span class="main">=</span> mult.row_length <span class="skolem">D'</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> C'_def D'_def a2 a6 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
     <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A'</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">∧</span> <span class="skolem">B'</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">∧</span> <span class="skolem">C'</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">∧</span> <span class="skolem">D'</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> A'_def B'_def C'_def D'_def a3 a4 a5 a6 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
     <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"plus_mult.matrix_match <span class="skolem">A'</span> <span class="skolem">B'</span> <span class="skolem">C'</span> <span class="skolem">D'</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> plus_mult.matrix_match_def<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="quoted">"<span class="main">(*)</span>"</span></span> <span class="quoted"><span class="main">0</span></span> <span class="quoted"><span class="quoted">"<span class="main">(+)</span>"</span></span> <span class="quoted"><span class="quoted">"a_inv cpx_rng"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
     <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
       <span class="keyword1"><span class="command">using</span></span> f1 plus_mult.distributivity plus_mult_cpx <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
   <span class="keyword1"><span class="command">qed</span></span>
   <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> mat_of_cols_list <span class="main">(</span>dim_row <span class="free">A</span> <span class="main">*</span> dim_row <span class="free">C</span><span class="main">)</span> <span class="main">(</span>mult.Tensor <span class="main">(*)</span> 
   <span class="main">(</span>mat_to_cols_list <span class="main">(</span><span class="free">A</span> <span class="main">*</span> <span class="free">B</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>mat_to_cols_list <span class="main">(</span><span class="free">C</span> <span class="main">*</span> <span class="free">D</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> A'_def B'_def C'_def D'_def a1 a2 a3 a5 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
   <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tensor_mat_def<span class="main">)</span>
 <span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Tensor-tensor_mat_is_assoc"><span class="command">lemma</span></span> tensor_mat_is_assoc<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span> <span class="free">B</span> <span class="free">C</span><span class="main">::</span> <span class="quoted"><span class="quoted">"complex Matrix.mat"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">⨂</span> <span class="main">(</span><span class="free">B</span> <span class="main">⨂</span> <span class="free">C</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">A</span> <span class="main">⨂</span> <span class="free">B</span><span class="main">)</span> <span class="main">⨂</span> <span class="free">C</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">M</span></span> <span class="keyword2"><span class="keyword">where</span></span> d<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">M</span> <span class="main">=</span> mat_of_cols_list <span class="main">(</span>dim_row <span class="free">B</span> <span class="main">*</span> dim_row <span class="free">C</span><span class="main">)</span> <span class="main">(</span>mult.Tensor <span class="main">(*)</span> <span class="main">(</span>mat_to_cols_list <span class="free">B</span><span class="main">)</span> <span class="main">(</span>mat_to_cols_list <span class="free">C</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">⨂</span> <span class="free">C</span> <span class="main">=</span> <span class="skolem">M</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> tensor_mat_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">⨂</span> <span class="main">(</span><span class="free">B</span> <span class="main">⨂</span> <span class="free">C</span><span class="main">)</span> <span class="main">=</span> mat_of_cols_list <span class="main">(</span>dim_row <span class="free">A</span> <span class="main">*</span> <span class="main">(</span>dim_row <span class="free">B</span> <span class="main">*</span> dim_row <span class="free">C</span><span class="main">)</span><span class="main">)</span>
<span class="main">(</span>mult.Tensor <span class="main">(*)</span> <span class="main">(</span>mat_to_cols_list <span class="free">A</span><span class="main">)</span> <span class="main">(</span>mat_to_cols_list <span class="skolem">M</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> tensor_mat_def d dim_row_tensor_mat <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"mat_to_cols_list <span class="skolem">M</span> <span class="main">=</span> mult.Tensor <span class="main">(*)</span> <span class="main">(</span>mat_to_cols_list <span class="free">B</span><span class="main">)</span> <span class="main">(</span>mat_to_cols_list <span class="free">C</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> d list_to_mat_to_cols_list
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> calculation<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> dim_col_tensor_mat length_greater_0_conv length_mat_to_cols_list mat_to_cols_list_is_mat 
mult.Tensor.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> mult.Tensor_null mult.well_defined_Tensor nat_0_less_mult_iff plus_mult_cpx plus_mult_def row_length_mat_to_cols_list<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">⨂</span> <span class="main">(</span><span class="free">B</span> <span class="main">⨂</span> <span class="free">C</span><span class="main">)</span> <span class="main">=</span> mat_of_cols_list <span class="main">(</span>dim_row <span class="free">A</span> <span class="main">*</span> <span class="main">(</span>dim_row <span class="free">B</span> <span class="main">*</span> dim_row <span class="free">C</span><span class="main">)</span><span class="main">)</span>
<span class="main">(</span>mult.Tensor <span class="main">(*)</span> <span class="main">(</span>mat_to_cols_list <span class="free">A</span><span class="main">)</span> <span class="main">(</span>mult.Tensor <span class="main">(*)</span> <span class="main">(</span>mat_to_cols_list <span class="free">B</span><span class="main">)</span> <span class="main">(</span>mat_to_cols_list <span class="free">C</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> mat_of_cols_list <span class="main">(</span><span class="main">(</span>dim_row <span class="free">A</span> <span class="main">*</span> dim_row <span class="free">B</span><span class="main">)</span> <span class="main">*</span> dim_row <span class="free">C</span><span class="main">)</span> 
<span class="main">(</span>mult.Tensor <span class="main">(*)</span> <span class="main">(</span>mult.Tensor <span class="main">(*)</span> <span class="main">(</span>mat_to_cols_list <span class="free">A</span><span class="main">)</span> <span class="main">(</span>mat_to_cols_list <span class="free">B</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>mat_to_cols_list <span class="free">C</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Matrix_Tensor.mult.associativity
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> ab_semigroup_mult_class.mult_ac<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> length_greater_0_conv length_mat_to_cols_list
mat_to_cols_list_is_mat mult.Tensor.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> mult.Tensor_null plus_mult_cpx plus_mult_def<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> tensor_mat_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> Tensor.mat_of_cols_list_def dim_col_mat<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> dim_col_tensor_mat dim_row_tensor_mat length_0_conv 
list_to_mat_to_cols_list mat_to_cols_list_is_mat mult.well_defined_Tensor mult_is_0 neq0_conv 
plus_mult_cpx plus_mult_def row_length_mat_to_cols_list<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="More_Tensor">
<div class="head">
<h1>Theory More_Tensor</h1>
</div>
<pre class="source"><span class="comment1">(* 
Authors: 

  Anthony Bordg, University of Cambridge, apdb3@cam.ac.uk;
  Yijun He, University of Cambridge, yh403@cam.ac.uk 
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Further Results on Tensor Products›</span></span>

<span class="keyword1"><span class="command">theory</span></span> More_Tensor
<span class="keyword2"><span class="keyword">imports</span></span>
  <a href="#Quantum">Quantum</a>
  <a href="#Tensor">Tensor</a>
  <a href="../../jordan_normal_form/theories/#Matrix">Jordan_Normal_Form.Matrix</a>
  <a href="#Basics">Basics</a>
<span class="keyword2"><span class="keyword">begin</span></span>


<span class="keyword1" id="More_Tensor-tensor_prod_2"><span class="command">lemma</span></span> tensor_prod_2 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> 
<span class="quoted"><span class="quoted">"mult.vec_vec_Tensor <span class="main">(*)</span> <span class="main">[</span><span class="free">x1</span><span class="main">::</span>complex<span class="main">,</span><span class="free">x2</span><span class="main">]</span> <span class="main">[</span><span class="free">x3</span><span class="main">,</span> <span class="free">x4</span><span class="main">]</span> <span class="main">=</span> <span class="main">[</span><span class="free">x1</span> <span class="main">*</span> <span class="free">x3</span><span class="main">,</span> <span class="free">x1</span> <span class="main">*</span> <span class="free">x4</span><span class="main">,</span> <span class="free">x2</span> <span class="main">*</span> <span class="free">x3</span><span class="main">,</span> <span class="free">x2</span> <span class="main">*</span> <span class="free">x4</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Matrix_Tensor.mult <span class="main">(</span><span class="main">1</span><span class="main">::</span>complex<span class="main">)</span> <span class="main">(*)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Matrix_Tensor.mult_def<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"mult.vec_vec_Tensor <span class="main">(*)</span> <span class="main">[</span><span class="free">x1</span><span class="main">::</span>complex<span class="main">,</span><span class="free">x2</span><span class="main">]</span> <span class="main">[</span><span class="free">x3</span><span class="main">,</span><span class="free">x4</span><span class="main">]</span> <span class="main">=</span> <span class="main">[</span><span class="free">x1</span><span class="main">*</span><span class="free">x3</span><span class="main">,</span><span class="free">x1</span><span class="main">*</span><span class="free">x4</span><span class="main">,</span><span class="free">x2</span><span class="main">*</span><span class="free">x3</span><span class="main">,</span><span class="free">x2</span><span class="main">*</span><span class="free">x4</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> mult.vec_vec_Tensor_def<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span><span class="main">::</span>complex<span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(*)</span>"</span></span><span class="main">]</span> mult.times_def<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span><span class="main">::</span>complex<span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(*)</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="More_Tensor-list_vec"><span class="command">lemma</span></span> list_vec <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> state_qbit <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"list_of_vec <span class="free">v</span> <span class="main">=</span> <span class="main">[</span><span class="free">v</span> <span class="main">$</span> <span class="main">0</span><span class="main">,</span> <span class="free">v</span> <span class="main">$</span> <span class="main">1</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Rep_vec <span class="free">v</span> <span class="main">=</span> <span class="main">(</span>fst<span class="main">(</span>Rep_vec <span class="free">v</span><span class="main">)</span><span class="main">,</span> snd<span class="main">(</span>Rep_vec <span class="free">v</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="numeral">2</span><span class="main">,</span> vec_index <span class="free">v</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> assms dim_vec.rep_eq mem_Collect_eq power_one_right state_qbit_def vec_index.rep_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">]</span> <span class="main">=</span> <span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> upt_rec<span class="main">)</span> 
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> list_of_vec_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="More_Tensor-vec_tensor_prod_2"><span class="command">lemma</span></span> vec_tensor_prod_2 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> state_qbit <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">∈</span> state_qbit <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">⊗</span> <span class="free">w</span> <span class="main">=</span> vec_of_list <span class="main">[</span><span class="free">v</span> <span class="main">$</span> <span class="main">0</span> <span class="main">*</span> <span class="free">w</span> <span class="main">$</span> <span class="main">0</span><span class="main">,</span> <span class="free">v</span> <span class="main">$</span> <span class="main">0</span> <span class="main">*</span> <span class="free">w</span> <span class="main">$</span> <span class="main">1</span><span class="main">,</span> <span class="free">v</span> <span class="main">$</span> <span class="main">1</span> <span class="main">*</span> <span class="free">w</span> <span class="main">$</span> <span class="main">0</span><span class="main">,</span> <span class="free">v</span> <span class="main">$</span> <span class="main">1</span> <span class="main">*</span> <span class="free">w</span> <span class="main">$</span> <span class="main">1</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"list_of_vec <span class="free">v</span> <span class="main">=</span> <span class="main">[</span><span class="free">v</span> <span class="main">$</span> <span class="main">0</span><span class="main">,</span> <span class="free">v</span> <span class="main">$</span> <span class="main">1</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"list_of_vec <span class="free">w</span> <span class="main">=</span> <span class="main">[</span><span class="free">w</span> <span class="main">$</span> <span class="main">0</span><span class="main">,</span> <span class="free">w</span> <span class="main">$</span> <span class="main">1</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">⊗</span> <span class="free">w</span> <span class="main">=</span> vec_of_list <span class="main">[</span><span class="free">v</span> <span class="main">$</span> <span class="main">0</span> <span class="main">*</span> <span class="free">w</span> <span class="main">$</span> <span class="main">0</span><span class="main">,</span> <span class="free">v</span> <span class="main">$</span> <span class="main">0</span> <span class="main">*</span> <span class="free">w</span> <span class="main">$</span> <span class="main">1</span><span class="main">,</span> <span class="free">v</span> <span class="main">$</span> <span class="main">1</span> <span class="main">*</span> <span class="free">w</span> <span class="main">$</span> <span class="main">0</span><span class="main">,</span> <span class="free">v</span> <span class="main">$</span> <span class="main">1</span> <span class="main">*</span> <span class="free">w</span> <span class="main">$</span> <span class="main">1</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tensor_vec_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="More_Tensor-vec_dim_of_vec_of_list"><span class="command">lemma</span></span> vec_dim_of_vec_of_list <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"length <span class="free">l</span> <span class="main">=</span> <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"dim_vec <span class="main">(</span>vec_of_list <span class="free">l</span><span class="main">)</span> <span class="main">=</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms vec_of_list_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="More_Tensor-vec_tensor_prod_2_bis"><span class="command">lemma</span></span> vec_tensor_prod_2_bis <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> state_qbit <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">∈</span> state_qbit <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">⊗</span> <span class="free">w</span> <span class="main">=</span> Matrix.vec <span class="numeral">4</span> <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="free">v</span> <span class="main">$</span> <span class="main">0</span> <span class="main">*</span> <span class="free">w</span> <span class="main">$</span> <span class="main">0</span> <span class="keyword1">else</span> 
                                      <span class="keyword1">if</span> <span class="bound">i</span> <span class="main">=</span> <span class="numeral">3</span> <span class="keyword1">then</span> <span class="free">v</span> <span class="main">$</span> <span class="main">1</span> <span class="main">*</span> <span class="free">w</span> <span class="main">$</span> <span class="main">1</span> <span class="keyword1">else</span>
                                          <span class="keyword1">if</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">1</span> <span class="keyword1">then</span> <span class="free">v</span> <span class="main">$</span> <span class="main">0</span> <span class="main">*</span> <span class="free">w</span> <span class="main">$</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="free">v</span> <span class="main">$</span> <span class="main">1</span> <span class="main">*</span> <span class="free">w</span> <span class="main">$</span> <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">=</span> Matrix.vec <span class="numeral">4</span> <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="free">v</span> <span class="main">$</span> <span class="main">0</span> <span class="main">*</span> <span class="free">w</span> <span class="main">$</span> <span class="main">0</span> <span class="keyword1">else</span> 
                                          <span class="keyword1">if</span> <span class="bound">i</span> <span class="main">=</span> <span class="numeral">3</span> <span class="keyword1">then</span> <span class="free">v</span> <span class="main">$</span> <span class="main">1</span> <span class="main">*</span> <span class="free">w</span> <span class="main">$</span> <span class="main">1</span> <span class="keyword1">else</span>
                                            <span class="keyword1">if</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">1</span> <span class="keyword1">then</span> <span class="free">v</span> <span class="main">$</span> <span class="main">0</span> <span class="main">*</span> <span class="free">w</span> <span class="main">$</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="free">v</span> <span class="main">$</span> <span class="main">1</span> <span class="main">*</span> <span class="free">w</span> <span class="main">$</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> f2<span class="main">:</span><span class="quoted"><span class="quoted">"dim_vec <span class="main">(</span><span class="free">v</span> <span class="main">⊗</span> <span class="free">w</span><span class="main">)</span> <span class="main">=</span> dim_vec <span class="skolem">u</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> dim_vec <span class="skolem">u</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">v</span> <span class="main">⊗</span> <span class="free">w</span><span class="main">)</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">=</span> <span class="skolem">u</span> <span class="main">$</span> <span class="bound">i</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> u_def<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">[</span></span>3<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> numeral_3_eq_3<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> u_def vec_of_list_index vec_tensor_prod_2 index_is_2 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> One_nat_def assms nth_Cons_0 nth_Cons_Suc numeral_2_eq_2<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="More_Tensor-index_col_mat_of_cols_list"><span class="command">lemma</span></span> index_col_mat_of_cols_list <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">&lt;</span> length <span class="free">l</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Matrix.col <span class="main">(</span>mat_of_cols_list <span class="free">n</span> <span class="free">l</span><span class="main">)</span> <span class="free">j</span> <span class="main">$</span> <span class="free">i</span> <span class="main">=</span> <span class="free">l</span> <span class="main">!</span> <span class="free">j</span> <span class="main">!</span> <span class="free">i</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Matrix.col_def mat_of_cols_list_def<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> assms less_le_trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="More_Tensor-multTensor2"><span class="command">lemma</span></span> multTensor2 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">=</span> Matrix.mat <span class="numeral">2</span> <span class="main">1</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="free">a0</span> <span class="keyword1">else</span> <span class="free">a1</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
          a2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">=</span> Matrix.mat <span class="numeral">2</span> <span class="main">1</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="free">b0</span> <span class="keyword1">else</span> <span class="free">b1</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"mult.Tensor <span class="main">(*)</span> <span class="main">(</span>mat_to_cols_list <span class="free">A</span><span class="main">)</span> <span class="main">(</span>mat_to_cols_list <span class="free">B</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span><span class="main">[</span><span class="free">a0</span><span class="main">*</span><span class="free">b0</span><span class="main">,</span> <span class="free">a0</span><span class="main">*</span><span class="free">b1</span><span class="main">,</span> <span class="free">a1</span><span class="main">*</span><span class="free">b0</span><span class="main">,</span> <span class="free">a1</span><span class="main">*</span><span class="free">b1</span><span class="main">]</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"mat_to_cols_list <span class="free">A</span> <span class="main">=</span> <span class="main">[</span><span class="main">[</span><span class="free">a0</span><span class="main">,</span> <span class="free">a1</span><span class="main">]</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> a1 mat_to_cols_list_def<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> numeral_2_eq_2<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> f2<span class="main">:</span><span class="quoted"><span class="quoted">"mat_to_cols_list <span class="free">B</span> <span class="main">=</span> <span class="main">[</span><span class="main">[</span><span class="free">b0</span><span class="main">,</span> <span class="free">b1</span><span class="main">]</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> a2 mat_to_cols_list_def<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> numeral_2_eq_2<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"mult.Tensor <span class="main">(*)</span> <span class="main">(</span>mat_to_cols_list <span class="free">A</span><span class="main">)</span> <span class="main">(</span>mat_to_cols_list <span class="free">B</span><span class="main">)</span> <span class="main">=</span> 
                   mult.Tensor <span class="main">(*)</span> <span class="main">[</span><span class="main">[</span><span class="free">a0</span><span class="main">,</span><span class="free">a1</span><span class="main">]</span><span class="main">]</span> <span class="main">[</span><span class="main">[</span><span class="free">b0</span><span class="main">,</span><span class="free">b1</span><span class="main">]</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> mult.Tensor_def<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span><span class="main">::</span>complex<span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(*)</span>"</span></span><span class="main">]</span> mult.times_def<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span><span class="main">::</span>complex<span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(*)</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> append_self_conv list.simps<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> mult.Tensor.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> mult.vec_mat_Tensor.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> 
mult.vec_mat_Tensor.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> plus_mult_cpx plus_mult_def tensor_prod_2<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="More_Tensor-multTensor2_bis"><span class="command">lemma</span></span> multTensor2_bis <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted">"dim_row <span class="free">A</span> <span class="main">=</span> <span class="numeral">2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a2<span class="main">:</span><span class="quoted"><span class="quoted">"dim_col <span class="free">A</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a3<span class="main">:</span><span class="quoted"><span class="quoted">"dim_row <span class="free">B</span> <span class="main">=</span> <span class="numeral">2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a4<span class="main">:</span><span class="quoted"><span class="quoted">"dim_col <span class="free">B</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"mult.Tensor <span class="main">(*)</span> <span class="main">(</span>mat_to_cols_list <span class="free">A</span><span class="main">)</span> <span class="main">(</span>mat_to_cols_list <span class="free">B</span><span class="main">)</span> <span class="main">=</span>  
<span class="main">[</span><span class="main">[</span><span class="free">A</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">*</span> <span class="free">B</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">*</span>  <span class="free">B</span> <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span> <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">*</span> <span class="free">B</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span> <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">*</span> <span class="free">B</span> <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">]</span><span class="main">]</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"mat_to_cols_list <span class="free">A</span> <span class="main">=</span> <span class="main">[</span><span class="main">[</span><span class="free">A</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span> <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">]</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> a1 a2 mat_to_cols_list_def<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> numeral_2_eq_2<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> f2<span class="main">:</span><span class="quoted"><span class="quoted">"mat_to_cols_list <span class="free">B</span> <span class="main">=</span> <span class="main">[</span><span class="main">[</span><span class="free">B</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">,</span> <span class="free">B</span> <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">]</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> a3 a4 mat_to_cols_list_def<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> numeral_2_eq_2<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"mult.Tensor <span class="main">(*)</span> <span class="main">(</span>mat_to_cols_list <span class="free">A</span><span class="main">)</span> <span class="main">(</span>mat_to_cols_list <span class="free">B</span><span class="main">)</span> <span class="main">=</span>
                   mult.Tensor <span class="main">(*)</span> <span class="main">[</span><span class="main">[</span><span class="free">A</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span> <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">]</span><span class="main">]</span> <span class="main">[</span><span class="main">[</span><span class="free">B</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">,</span> <span class="free">B</span> <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">]</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> mult.Tensor_def<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span><span class="main">::</span>complex<span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(*)</span>"</span></span><span class="main">]</span> mult.times_def<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span><span class="main">::</span>complex<span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(*)</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> append_self_conv list.simps<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> mult.Tensor.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> mult.vec_mat_Tensor.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> 
mult.vec_mat_Tensor.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> plus_mult_cpx plus_mult_def tensor_prod_2<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="More_Tensor-mat_tensor_prod_2_prelim"><span class="command">lemma</span></span> mat_tensor_prod_2_prelim <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"state <span class="main">1</span> <span class="free">v</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"state <span class="main">1</span> <span class="free">w</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">⨂</span> <span class="free">w</span> <span class="main">=</span> mat_of_cols_list <span class="numeral">4</span> 
<span class="main">[</span><span class="main">[</span><span class="free">v</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">*</span> <span class="free">w</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">,</span> <span class="free">v</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">*</span> <span class="free">w</span> <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">,</span> <span class="free">v</span> <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">*</span> <span class="free">w</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">,</span> <span class="free">v</span> <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">*</span> <span class="free">w</span> <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">]</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">=</span> mat_of_cols_list <span class="numeral">4</span> 
<span class="main">[</span><span class="main">[</span><span class="free">v</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">*</span> <span class="free">w</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">,</span> <span class="free">v</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">*</span> <span class="free">w</span> <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">,</span> <span class="free">v</span> <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">*</span> <span class="free">w</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">,</span> <span class="free">v</span> <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">*</span> <span class="free">w</span> <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">]</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> f1<span class="main">:</span><span class="quoted"><span class="quoted">"dim_row <span class="main">(</span><span class="free">v</span> <span class="main">⨂</span> <span class="free">w</span><span class="main">)</span> <span class="main">=</span> dim_row <span class="skolem">u</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms state_def mat_of_cols_list_def tensor_mat_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> f2<span class="main">:</span><span class="quoted"><span class="quoted">"dim_col <span class="main">(</span><span class="free">v</span> <span class="main">⨂</span> <span class="free">w</span><span class="main">)</span> <span class="main">=</span> dim_col <span class="skolem">u</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms state_def mat_of_cols_list_def tensor_mat_def u_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span> <span class="bound">j</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> dim_row <span class="skolem">u</span> <span class="main">⟹</span> <span class="bound">j</span> <span class="main">&lt;</span> dim_col <span class="skolem">u</span> <span class="main">⟹</span>  <span class="main">(</span><span class="free">v</span> <span class="main">⨂</span> <span class="free">w</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">u</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> u_def tensor_mat_def assms state_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="More_Tensor-mat_tensor_prod_2_col"><span class="command">lemma</span></span> mat_tensor_prod_2_col <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"state <span class="main">1</span> <span class="free">v</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"state <span class="main">1</span> <span class="free">w</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Matrix.col <span class="main">(</span><span class="free">v</span> <span class="main">⨂</span> <span class="free">w</span><span class="main">)</span> <span class="main">0</span> <span class="main">=</span> Matrix.col <span class="free">v</span> <span class="main">0</span> <span class="main">⊗</span> Matrix.col <span class="free">w</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> f1<span class="main">:</span><span class="quoted"><span class="quoted">"dim_vec <span class="main">(</span>Matrix.col <span class="main">(</span><span class="free">v</span> <span class="main">⨂</span> <span class="free">w</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> dim_vec <span class="main">(</span>Matrix.col <span class="free">v</span> <span class="main">0</span> <span class="main">⊗</span> Matrix.col <span class="free">w</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms vec_tensor_prod_2_bis
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> Tensor.mat_of_cols_list_def dim_col dim_row_mat<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> dim_vec mat_tensor_prod_2_prelim state.state_to_state_qbit<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span><span class="main">&lt;</span>dim_vec <span class="main">(</span>Matrix.col <span class="free">v</span> <span class="main">0</span> <span class="main">⊗</span> Matrix.col <span class="free">w</span> <span class="main">0</span><span class="main">)</span> <span class="main">⟹</span> Matrix.col <span class="main">(</span><span class="free">v</span> <span class="main">⨂</span> <span class="free">w</span><span class="main">)</span> <span class="main">0</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">(</span>Matrix.col <span class="free">v</span> <span class="main">0</span> <span class="main">⊗</span> Matrix.col <span class="free">w</span> <span class="main">0</span><span class="main">)</span> <span class="main">$</span> <span class="bound">i</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"dim_vec <span class="main">(</span>Matrix.col <span class="free">v</span> <span class="main">0</span> <span class="main">⊗</span> Matrix.col <span class="free">w</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">4</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> dim_vec state.state_to_state_qbit vec_tensor_prod_2_bis<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Matrix.col <span class="free">v</span> <span class="main">0</span> <span class="main">⊗</span> Matrix.col <span class="free">w</span> <span class="main">0</span><span class="main">)</span> <span class="main">$</span> <span class="main">0</span> <span class="main">=</span> <span class="free">v</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">*</span> <span class="free">w</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms vec_tensor_prod_2 state.state_to_state_qbit col_index_of_mat_col
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> nth_Cons_0 power_one_right state_def vec_of_list_index zero_less_numeral<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> Matrix.col <span class="main">(</span><span class="free">v</span> <span class="main">⨂</span> <span class="free">w</span><span class="main">)</span> <span class="main">0</span> <span class="main">$</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Matrix.col <span class="free">v</span> <span class="main">0</span> <span class="main">⊗</span> Matrix.col <span class="free">w</span> <span class="main">0</span><span class="main">)</span> <span class="main">$</span> <span class="main">1</span> <span class="main">=</span> <span class="free">v</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">*</span> <span class="free">w</span> <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms vec_tensor_prod_2 state.state_to_state_qbit col_index_of_mat_col 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> One_nat_def Suc_1 lessI nth_Cons_0 power_one_right state_def vec_index_vCons_Suc 
vec_of_list_Cons vec_of_list_index zero_less_numeral<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> Matrix.col <span class="main">(</span><span class="free">v</span> <span class="main">⨂</span> <span class="free">w</span><span class="main">)</span> <span class="main">0</span> <span class="main">$</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Matrix.col <span class="free">v</span> <span class="main">0</span> <span class="main">⊗</span> Matrix.col <span class="free">w</span> <span class="main">0</span><span class="main">)</span> <span class="main">$</span> <span class="numeral">2</span> <span class="main">=</span> <span class="free">v</span> <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">*</span> <span class="free">w</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms vec_tensor_prod_2 state.state_to_state_qbit col_index_of_mat_col
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> One_nat_def Suc_1 lessI nth_Cons_0 power_one_right state_def vec_index_vCons_Suc 
vec_of_list_Cons vec_of_list_index zero_less_numeral<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> Matrix.col <span class="main">(</span><span class="free">v</span> <span class="main">⨂</span> <span class="free">w</span><span class="main">)</span> <span class="main">0</span> <span class="main">$</span> <span class="numeral">2</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Matrix.col <span class="free">v</span> <span class="main">0</span> <span class="main">⊗</span> Matrix.col <span class="free">w</span> <span class="main">0</span><span class="main">)</span> <span class="main">$</span> <span class="numeral">3</span> <span class="main">=</span> <span class="free">v</span> <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">*</span> <span class="free">w</span> <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms vec_tensor_prod_2 state.state_to_state_qbit col_index_of_mat_col numeral_3_eq_3
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> One_nat_def Suc_1 lessI nth_Cons_0 power_one_right state_def vec_index_vCons_Suc 
vec_of_list_Cons vec_of_list_index zero_less_numeral<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> Matrix.col <span class="main">(</span><span class="free">v</span> <span class="main">⨂</span> <span class="free">w</span><span class="main">)</span> <span class="main">0</span> <span class="main">$</span> <span class="numeral">3</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span><span class="main">&lt;</span>dim_vec <span class="main">(</span>Matrix.col <span class="free">v</span> <span class="main">0</span> <span class="main">⊗</span> Matrix.col <span class="free">w</span> <span class="main">0</span><span class="main">)</span> <span class="main">⟹</span> Matrix.col <span class="main">(</span><span class="free">v</span> <span class="main">⨂</span> <span class="free">w</span><span class="main">)</span> <span class="main">0</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">(</span>Matrix.col <span class="free">v</span> <span class="main">0</span> <span class="main">⊗</span> Matrix.col <span class="free">w</span> <span class="main">0</span><span class="main">)</span> <span class="main">$</span> <span class="bound">i</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> index_sl_four <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="More_Tensor-mat_tensor_prod_2"><span class="command">lemma</span></span> mat_tensor_prod_2 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"state <span class="main">1</span> <span class="free">v</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"state <span class="main">1</span> <span class="free">w</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">⨂</span> <span class="free">w</span> <span class="main">=</span> Matrix.mat <span class="numeral">4</span> <span class="main">1</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="free">v</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">*</span> <span class="free">w</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="keyword1">else</span> 
                                            <span class="keyword1">if</span> <span class="bound">i</span> <span class="main">=</span> <span class="numeral">3</span> <span class="keyword1">then</span> <span class="free">v</span> <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">*</span> <span class="free">w</span> <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="keyword1">else</span>
                                              <span class="keyword1">if</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">1</span> <span class="keyword1">then</span> <span class="free">v</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">*</span> <span class="free">w</span> <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="keyword1">else</span> 
                                                <span class="free">v</span> <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">*</span> <span class="free">w</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">=</span> Matrix.mat <span class="numeral">4</span> <span class="main">1</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="free">v</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">*</span> <span class="free">w</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="keyword1">else</span> 
                                            <span class="keyword1">if</span> <span class="bound">i</span> <span class="main">=</span> <span class="numeral">3</span> <span class="keyword1">then</span> <span class="free">v</span> <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">*</span> <span class="free">w</span> <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="keyword1">else</span>
                                              <span class="keyword1">if</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">1</span> <span class="keyword1">then</span> <span class="free">v</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">*</span> <span class="free">w</span> <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="keyword1">else</span> 
                                                <span class="free">v</span> <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">*</span> <span class="free">w</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_row <span class="main">(</span><span class="free">v</span> <span class="main">⨂</span> <span class="free">w</span><span class="main">)</span> <span class="main">=</span> dim_row <span class="skolem">u</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms tensor_mat_def state_def <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Tensor.mat_of_cols_list_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="numeral">4</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> u_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_col <span class="main">(</span><span class="free">v</span> <span class="main">⨂</span> <span class="free">w</span><span class="main">)</span> <span class="main">=</span> dim_col <span class="skolem">u</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> u_def assms tensor_mat_def state_def Tensor.mat_of_cols_list_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> u_def<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span> <span class="bound">j</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> dim_row <span class="skolem">u</span> <span class="main">⟹</span> <span class="bound">j</span> <span class="main">&lt;</span> dim_col <span class="skolem">u</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">v</span> <span class="main">⨂</span> <span class="free">w</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">u</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span><span class="main">::</span><span class="quoted">nat</span>
    <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> dim_row <span class="skolem">u</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> dim_col <span class="skolem">u</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">v</span> <span class="main">⨂</span> <span class="free">w</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> Matrix.col <span class="main">(</span><span class="free">v</span> <span class="main">⨂</span> <span class="free">w</span><span class="main">)</span> <span class="main">0</span> <span class="main">$</span> <span class="skolem">i</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Matrix.col_def u_def assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> f1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">v</span> <span class="main">⨂</span> <span class="free">w</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Matrix.col <span class="free">v</span> <span class="main">0</span> <span class="main">⊗</span> Matrix.col <span class="free">w</span> <span class="main">0</span><span class="main">)</span> <span class="main">$</span> <span class="skolem">i</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms mat_tensor_prod_2_col <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Matrix.col <span class="free">v</span> <span class="main">0</span> <span class="main">⊗</span> Matrix.col <span class="free">w</span> <span class="main">0</span><span class="main">)</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">=</span> 
 Matrix.vec <span class="numeral">4</span> <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> Matrix.col <span class="free">v</span> <span class="main">0</span> <span class="main">$</span> <span class="main">0</span> <span class="main">*</span> Matrix.col <span class="free">w</span> <span class="main">0</span> <span class="main">$</span> <span class="main">0</span> <span class="keyword1">else</span> 
                                      <span class="keyword1">if</span> <span class="bound">i</span> <span class="main">=</span> <span class="numeral">3</span> <span class="keyword1">then</span> Matrix.col <span class="free">v</span> <span class="main">0</span> <span class="main">$</span> <span class="main">1</span> <span class="main">*</span> Matrix.col <span class="free">w</span> <span class="main">0</span> <span class="main">$</span> <span class="main">1</span> <span class="keyword1">else</span>
                                          <span class="keyword1">if</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">1</span> <span class="keyword1">then</span> Matrix.col <span class="free">v</span> <span class="main">0</span> <span class="main">$</span> <span class="main">0</span> <span class="main">*</span> Matrix.col <span class="free">w</span> <span class="main">0</span> <span class="main">$</span> <span class="main">1</span> <span class="keyword1">else</span> 
                                            Matrix.col <span class="free">v</span> <span class="main">0</span> <span class="main">$</span> <span class="main">1</span> <span class="main">*</span> Matrix.col <span class="free">w</span> <span class="main">0</span> <span class="main">$</span> <span class="main">0</span><span class="main">)</span> <span class="main">$</span> <span class="skolem">i</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> vec_tensor_prod_2_bis assms state.state_to_state_qbit <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span> 
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">v</span> <span class="main">⨂</span> <span class="free">w</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">u</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> u_def a1 a2 assms state_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>
                         

<span class="keyword1" id="More_Tensor-mat_tensor_prod_2_bis"><span class="command">lemma</span></span> mat_tensor_prod_2_bis<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"state <span class="main">1</span> <span class="free">v</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"state <span class="main">1</span> <span class="free">w</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">⨂</span> <span class="free">w</span> <span class="main">=</span> <span class="main">|</span>Matrix.vec <span class="numeral">4</span> <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="free">v</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">*</span> <span class="free">w</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="keyword1">else</span> 
                                          <span class="keyword1">if</span> <span class="bound">i</span> <span class="main">=</span> <span class="numeral">3</span> <span class="keyword1">then</span> <span class="free">v</span> <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">*</span> <span class="free">w</span> <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="keyword1">else</span>
                                            <span class="keyword1">if</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">1</span> <span class="keyword1">then</span> <span class="free">v</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">*</span> <span class="free">w</span> <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="keyword1">else</span> 
                                              <span class="free">v</span> <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">*</span> <span class="free">w</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">⟩</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms ket_vec_def mat_tensor_prod_2 <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mat_eq_iff<span class="main">)</span>

<span class="keyword1" id="More_Tensor-eq_ket_vec"><span class="command">lemma</span></span> eq_ket_vec<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">u</span> <span class="free">v</span><span class="main">::</span> <span class="quoted"><span class="quoted">"complex Matrix.vec"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">=</span> <span class="free">v</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="free">u</span><span class="main">⟩</span> <span class="main">=</span> <span class="main">|</span><span class="free">v</span><span class="main">⟩</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="More_Tensor-mat_tensor_ket_vec"><span class="command">lemma</span></span> mat_tensor_ket_vec<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"state <span class="main">1</span> <span class="free">v</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"state <span class="main">1</span> <span class="free">w</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">⨂</span> <span class="free">w</span> <span class="main">=</span> <span class="main">|</span><span class="main">(</span>Matrix.col <span class="free">v</span> <span class="main">0</span><span class="main">)</span> <span class="main">⊗</span> <span class="main">(</span>Matrix.col <span class="free">w</span> <span class="main">0</span><span class="main">)</span><span class="main">⟩</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">⨂</span> <span class="free">w</span> <span class="main">=</span> <span class="main">|</span>Matrix.col <span class="free">v</span> <span class="main">0</span><span class="main">⟩</span> <span class="main">⨂</span> <span class="main">|</span>Matrix.col <span class="free">w</span> <span class="main">0</span><span class="main">⟩</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms state_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> 
<span class="main">|</span>Matrix.vec <span class="numeral">4</span> <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">|</span>Matrix.col <span class="free">v</span> <span class="main">0</span><span class="main">⟩</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">*</span> <span class="main">|</span>Matrix.col <span class="free">w</span> <span class="main">0</span><span class="main">⟩</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="keyword1">else</span> 
                                          <span class="keyword1">if</span> <span class="bound">i</span> <span class="main">=</span> <span class="numeral">3</span> <span class="keyword1">then</span> <span class="main">|</span>Matrix.col <span class="free">v</span> <span class="main">0</span><span class="main">⟩</span> <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">*</span> <span class="main">|</span>Matrix.col <span class="free">w</span> <span class="main">0</span><span class="main">⟩</span> <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="keyword1">else</span>
                                            <span class="keyword1">if</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">1</span> <span class="keyword1">then</span> <span class="main">|</span>Matrix.col <span class="free">v</span> <span class="main">0</span><span class="main">⟩</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">*</span> <span class="main">|</span>Matrix.col <span class="free">w</span> <span class="main">0</span><span class="main">⟩</span> <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="keyword1">else</span> 
                                              <span class="main">|</span>Matrix.col <span class="free">v</span> <span class="main">0</span><span class="main">⟩</span> <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">*</span> <span class="main">|</span>Matrix.col <span class="free">w</span> <span class="main">0</span><span class="main">⟩</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">⟩</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms mat_tensor_prod_2_bis state_col_ket_vec <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> 
<span class="main">|</span>Matrix.vec <span class="numeral">4</span> <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="free">v</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">*</span> <span class="free">w</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="keyword1">else</span> 
                                          <span class="keyword1">if</span> <span class="bound">i</span> <span class="main">=</span> <span class="numeral">3</span> <span class="keyword1">then</span> <span class="free">v</span> <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">*</span> <span class="free">w</span> <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="keyword1">else</span>
                                            <span class="keyword1">if</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">1</span> <span class="keyword1">then</span> <span class="free">v</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">*</span> <span class="free">w</span> <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="keyword1">else</span> 
                                              <span class="free">v</span> <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">*</span> <span class="free">w</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">⟩</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms mat_tensor_prod_2_bis calculation <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> 
<span class="main">|</span>Matrix.vec <span class="numeral">4</span> <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> Matrix.col <span class="free">v</span> <span class="main">0</span> <span class="main">$</span> <span class="main">0</span> <span class="main">*</span> Matrix.col <span class="free">w</span> <span class="main">0</span> <span class="main">$</span> <span class="main">0</span> <span class="keyword1">else</span> 
                                      <span class="keyword1">if</span> <span class="bound">i</span> <span class="main">=</span> <span class="numeral">3</span> <span class="keyword1">then</span> Matrix.col <span class="free">v</span> <span class="main">0</span> <span class="main">$</span> <span class="main">1</span> <span class="main">*</span> Matrix.col <span class="free">w</span> <span class="main">0</span> <span class="main">$</span> <span class="main">1</span> <span class="keyword1">else</span>
                                          <span class="keyword1">if</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">1</span> <span class="keyword1">then</span> Matrix.col <span class="free">v</span> <span class="main">0</span> <span class="main">$</span> <span class="main">0</span> <span class="main">*</span> Matrix.col <span class="free">w</span> <span class="main">0</span> <span class="main">$</span> <span class="main">1</span> <span class="keyword1">else</span> 
                                            Matrix.col <span class="free">v</span> <span class="main">0</span> <span class="main">$</span> <span class="main">1</span> <span class="main">*</span> Matrix.col <span class="free">w</span> <span class="main">0</span> <span class="main">$</span> <span class="main">0</span><span class="main">)</span><span class="main">⟩</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> eq_ket_vec<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> eq_vecI<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> col_index_of_mat_col assms state_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> vec_tensor_prod_2_bis assms state.state_to_state_qbit <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The property of being a state (resp. a gate) is preserved by tensor product.›</span></span>

<span class="keyword1" id="More_Tensor-tensor_state2"><span class="command">lemma</span></span> tensor_state2 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"state <span class="main">1</span> <span class="free">u</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"state <span class="main">1</span> <span class="free">v</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"state <span class="numeral">2</span> <span class="main">(</span><span class="free">u</span> <span class="main">⨂</span> <span class="free">v</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_col <span class="main">(</span><span class="free">u</span> <span class="main">⨂</span> <span class="free">v</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms dim_col_tensor_mat state.is_column <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_row <span class="main">(</span><span class="free">u</span> <span class="main">⨂</span> <span class="free">v</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">2</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms dim_row_tensor_mat state.dim_row
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> power2_eq_square power_one_right<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∥</span>Matrix.col <span class="main">(</span><span class="free">u</span> <span class="main">⨂</span> <span class="free">v</span><span class="main">)</span> <span class="main">0</span><span class="main">∥</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">l</span></span> <span class="keyword2"><span class="keyword">where</span></span> d0<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">=</span> <span class="main">[</span><span class="free">u</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">*</span> <span class="free">v</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">,</span> <span class="free">u</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">*</span> <span class="free">v</span> <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">,</span> <span class="free">u</span> <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">*</span> <span class="free">v</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">,</span> <span class="free">u</span> <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">*</span> <span class="free">v</span> <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> f4<span class="main">:</span><span class="quoted"><span class="quoted">"length <span class="skolem">l</span> <span class="main">=</span> <span class="numeral">4</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">⨂</span> <span class="free">v</span> <span class="main">=</span> mat_of_cols_list <span class="numeral">4</span> 
<span class="main">[</span><span class="main">[</span><span class="free">u</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">*</span> <span class="free">v</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">,</span> <span class="free">u</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">*</span> <span class="free">v</span> <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">,</span> <span class="free">u</span> <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">*</span> <span class="free">v</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">,</span> <span class="free">u</span> <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">*</span> <span class="free">v</span> <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">]</span><span class="main">]</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Matrix.col <span class="main">(</span><span class="free">u</span> <span class="main">⨂</span> <span class="free">v</span><span class="main">)</span> <span class="main">0</span> <span class="main">=</span> vec_of_list <span class="main">[</span><span class="free">u</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">*</span> <span class="free">v</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">,</span> <span class="free">u</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">*</span> <span class="free">v</span> <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">,</span> 
<span class="free">u</span> <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">*</span> <span class="free">v</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">,</span> <span class="free">u</span> <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">*</span> <span class="free">v</span> <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">]</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> One_nat_def Suc_eq_plus1 add_Suc col_mat_of_cols_list list.size<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> list.size<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> 
nth_Cons_0 numeral_2_eq_2 numeral_Bit0 plus_1_eq_Suc vec_of_list_Cons zero_less_one_class.zero_less_one<span class="main">)</span>    
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> f5<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∥</span>Matrix.col <span class="main">(</span><span class="free">u</span> <span class="main">⨂</span> <span class="free">v</span><span class="main">)</span> <span class="main">0</span><span class="main">∥</span> <span class="main">=</span> sqrt<span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="numeral">4</span><span class="main">.</span> <span class="main">(</span>cmod <span class="main">(</span><span class="skolem">l</span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> d0 f4 One_nat_def cpx_length_of_vec_of_list d0 vec_of_list_Cons<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> sqrt <span class="main">(</span><span class="main">(</span>cmod <span class="main">(</span><span class="free">u</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">*</span> <span class="free">v</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="main">(</span>cmod<span class="main">(</span><span class="free">u</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">*</span> <span class="free">v</span> <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> 
<span class="main">(</span>cmod<span class="main">(</span><span class="free">u</span> <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">*</span> <span class="free">v</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="main">(</span>cmod<span class="main">(</span><span class="free">u</span> <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">*</span> <span class="free">v</span> <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="numeral">4</span><span class="main">.</span> <span class="main">(</span>cmod <span class="main">(</span><span class="skolem">l</span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>cmod <span class="main">(</span><span class="skolem">l</span> <span class="main">!</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="main">(</span>cmod <span class="main">(</span><span class="skolem">l</span> <span class="main">!</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="main">(</span>cmod <span class="main">(</span><span class="skolem">l</span> <span class="main">!</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> 
<span class="main">(</span>cmod <span class="main">(</span><span class="skolem">l</span> <span class="main">!</span> <span class="numeral">3</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> sum_insert
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> One_nat_def empty_iff finite.emptyI finite.insertI insertE lessThan_0 lessThan_Suc 
numeral_2_eq_2 numeral_3_eq_3 numeral_plus_one one_plus_numeral_commute plus_1_eq_Suc semiring_norm<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> 
semiring_norm<span class="main"><span class="main">(</span></span>8<span class="main"><span class="main">)</span></span> sum.empty<span class="main">)</span> 
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span>cmod <span class="main">(</span><span class="free">u</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">*</span> <span class="free">v</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="main">(</span>cmod<span class="main">(</span><span class="free">u</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">*</span> <span class="free">v</span> <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> 
<span class="main">(</span>cmod<span class="main">(</span><span class="free">u</span> <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">*</span> <span class="free">v</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="main">(</span>cmod<span class="main">(</span><span class="free">u</span> <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">*</span> <span class="free">v</span> <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> d0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f5<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> 
sqrt <span class="main">(</span><span class="main">(</span>cmod <span class="main">(</span><span class="free">u</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">*</span> <span class="main">(</span>cmod <span class="main">(</span><span class="free">v</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="main">(</span>cmod<span class="main">(</span><span class="free">u</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">*</span> <span class="main">(</span>cmod <span class="main">(</span><span class="free">v</span> <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> 
<span class="main">(</span>cmod<span class="main">(</span><span class="free">u</span> <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">*</span> <span class="main">(</span>cmod <span class="main">(</span><span class="free">v</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="main">(</span>cmod<span class="main">(</span><span class="free">u</span> <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">*</span> <span class="main">(</span>cmod<span class="main">(</span><span class="free">v</span> <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> norm_mult power_mult_distrib<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> sqrt <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="main">(</span>cmod<span class="main">(</span><span class="free">u</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="main">(</span>cmod<span class="main">(</span><span class="free">u</span> <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> 
<span class="main">(</span><span class="main">(</span><span class="main">(</span>cmod<span class="main">(</span><span class="free">v</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="main">(</span>cmod<span class="main">(</span><span class="free">v</span> <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> distrib_left mult.commute<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> f6<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∥</span>Matrix.col <span class="main">(</span><span class="free">u</span> <span class="main">⨂</span> <span class="free">v</span><span class="main">)</span> <span class="main">0</span><span class="main">∥</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span>cmod<span class="main">(</span><span class="free">u</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="main">(</span>cmod<span class="main">(</span><span class="free">u</span> <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> 
<span class="main">(</span><span class="main">(</span><span class="main">(</span>cmod<span class="main">(</span><span class="free">v</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="main">(</span>cmod<span class="main">(</span><span class="free">v</span> <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f4<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> f7<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span> <span class="numeral">2</span><span class="main">.</span> <span class="main">(</span>cmod <span class="main">(</span><span class="free">u</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="numeral">2</span><span class="main">.</span> <span class="main">(</span>cmod <span class="main">(</span><span class="free">v</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> numeral_2_eq_2<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> f8<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span> <span class="numeral">2</span><span class="main">.</span><span class="main">(</span>cmod <span class="main">(</span>Matrix.col <span class="free">u</span> <span class="main">0</span> <span class="main">$</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="numeral">2</span><span class="main">.</span><span class="main">(</span>cmod <span class="main">(</span>Matrix.col <span class="free">v</span> <span class="main">0</span> <span class="main">$</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms index_col state_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> f1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span> <span class="numeral">2</span><span class="main">.</span><span class="main">(</span>cmod <span class="main">(</span>Matrix.col <span class="free">u</span> <span class="main">0</span> <span class="main">$</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> state_def cpx_vec_length_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> f2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span> <span class="numeral">2</span><span class="main">.</span><span class="main">(</span>cmod <span class="main">(</span>Matrix.col <span class="free">v</span> <span class="main">0</span> <span class="main">$</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> state_def cpx_vec_length_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> f1 f8 f5 f6 f7
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹sqrt <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="numeral">4</span><span class="main">.</span> <span class="main">(</span>cmod <span class="main">(</span><span class="skolem">l</span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">=</span> sqrt <span class="main">(</span><span class="main">(</span>cmod <span class="main">(</span><span class="free">u</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span> <span class="main">*</span> <span class="free">v</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> 
<span class="main">(</span>cmod <span class="main">(</span><span class="free">u</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span> <span class="main">*</span> <span class="free">v</span> <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="main">(</span>cmod <span class="main">(</span><span class="free">u</span> <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span> <span class="main">*</span> <span class="free">v</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="main">(</span>cmod <span class="main">(</span><span class="free">u</span> <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span> <span class="main">*</span> <span class="free">v</span> <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span>›</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="More_Tensor-sum_prod"><span class="command">lemma</span></span> sum_prod<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span><span class="main">::</span><span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> complex"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">g</span><span class="main">::</span><span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> complex"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="free">a</span><span class="main">*</span><span class="free">b</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="bound">i</span> <span class="keyword1">div</span> <span class="free">b</span><span class="main">)</span> <span class="main">*</span> <span class="free">g</span><span class="main">(</span><span class="bound">i</span> <span class="keyword1">mod</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="free">a</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">&lt;</span><span class="free">b</span><span class="main">.</span> <span class="free">g</span><span class="main">(</span><span class="bound">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">a</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">a</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="main">(</span><span class="skolem">a</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">*</span><span class="free">b</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="bound">i</span> <span class="keyword1">div</span> <span class="free">b</span><span class="main">)</span> <span class="main">*</span> <span class="free">g</span> <span class="main">(</span><span class="bound">i</span> <span class="keyword1">mod</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="skolem">a</span><span class="main">*</span><span class="free">b</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="bound">i</span> <span class="keyword1">div</span> <span class="free">b</span><span class="main">)</span> <span class="main">*</span> <span class="free">g</span> <span class="main">(</span><span class="bound">i</span> <span class="keyword1">mod</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> 
<span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="main">{</span><span class="skolem">a</span><span class="main">*</span><span class="free">b</span><span class="main">..&lt;</span><span class="main">(</span><span class="skolem">a</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">*</span><span class="free">b</span><span class="main">}</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="bound">i</span> <span class="keyword1">div</span> <span class="free">b</span><span class="main">)</span> <span class="main">*</span> <span class="free">g</span> <span class="main">(</span><span class="bound">i</span> <span class="keyword1">mod</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> add.commute mult_Suc sum.lessThan_Suc sum.nat_group<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="skolem">a</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">&lt;</span><span class="free">b</span><span class="main">.</span> <span class="free">g</span><span class="main">(</span><span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="main">{</span><span class="skolem">a</span><span class="main">*</span><span class="free">b</span><span class="main">..&lt;</span><span class="main">(</span><span class="skolem">a</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">*</span><span class="free">b</span><span class="main">}</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="bound">i</span> <span class="keyword1">div</span> <span class="free">b</span><span class="main">)</span> <span class="main">*</span> <span class="free">g</span> <span class="main">(</span><span class="bound">i</span> <span class="keyword1">mod</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Suc.IH<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="skolem">a</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">&lt;</span><span class="free">b</span><span class="main">.</span> <span class="free">g</span><span class="main">(</span><span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="main">{</span><span class="skolem">a</span><span class="main">*</span><span class="free">b</span><span class="main">..&lt;</span><span class="main">(</span><span class="skolem">a</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">*</span><span class="free">b</span><span class="main">}</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="skolem">a</span><span class="main">)</span> <span class="main">*</span> <span class="free">g</span><span class="main">(</span><span class="bound">i</span><span class="main">-</span><span class="skolem">a</span><span class="main">*</span><span class="free">b</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="skolem">a</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">&lt;</span><span class="free">b</span><span class="main">.</span> <span class="free">g</span><span class="main">(</span><span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="free">f</span><span class="main">(</span><span class="skolem">a</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="main">{</span><span class="skolem">a</span><span class="main">*</span><span class="free">b</span><span class="main">..&lt;</span><span class="main">(</span><span class="skolem">a</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">*</span><span class="free">b</span><span class="main">}</span><span class="main">.</span> <span class="free">g</span><span class="main">(</span><span class="bound">i</span><span class="main">-</span><span class="skolem">a</span><span class="main">*</span><span class="free">b</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_distrib_left<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="skolem">a</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">&lt;</span><span class="free">b</span><span class="main">.</span> <span class="free">g</span><span class="main">(</span><span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="free">f</span><span class="main">(</span><span class="skolem">a</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="main">{..&lt;</span><span class="free">b</span><span class="main">}</span><span class="main">.</span> <span class="free">g</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> sum_of_index_diff<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">g</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a</span><span class="main">*</span><span class="free">b</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> semiring_normalization_rules<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="More_Tensor-tensor_state"><span class="command">lemma</span></span> tensor_state <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"state <span class="free">m</span> <span class="free">u</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"state <span class="free">n</span> <span class="free">v</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"state <span class="main">(</span><span class="free">m</span> <span class="main">+</span> <span class="free">n</span><span class="main">)</span> <span class="main">(</span><span class="free">u</span> <span class="main">⨂</span> <span class="free">v</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> c1<span class="main">:</span><span class="quoted"><span class="quoted">"dim_col <span class="main">(</span><span class="free">u</span> <span class="main">⨂</span> <span class="free">v</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms dim_col_tensor_mat state.is_column <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword3"><span class="command">show</span></span> c2<span class="main">:</span><span class="quoted"><span class="quoted">"dim_row <span class="main">(</span><span class="free">u</span> <span class="main">⨂</span> <span class="free">v</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">m</span> <span class="main">+</span> <span class="free">n</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms dim_row_tensor_mat state.dim_row <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> power_add<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">m</span> <span class="main">+</span> <span class="free">n</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span>cmod <span class="main">(</span><span class="free">u</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">i</span> <span class="keyword1">div</span> <span class="numeral">2</span> <span class="main">^</span> <span class="free">n</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span> <span class="main">*</span> <span class="free">v</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">i</span> <span class="keyword1">mod</span> <span class="numeral">2</span> <span class="main">^</span> <span class="free">n</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">=</span> 
<span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">m</span> <span class="main">+</span> <span class="free">n</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span>cmod <span class="main">(</span><span class="free">u</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">i</span> <span class="keyword1">div</span> <span class="numeral">2</span> <span class="main">^</span> <span class="free">n</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">*</span> <span class="main">(</span>cmod <span class="main">(</span><span class="free">v</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">i</span> <span class="keyword1">mod</span> <span class="numeral">2</span> <span class="main">^</span> <span class="free">n</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sqr_of_cmod_of_prod<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="free">m</span><span class="main">.</span> <span class="main">(</span>cmod <span class="main">(</span><span class="free">u</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">.</span> <span class="main">(</span>cmod <span class="main">(</span><span class="free">v</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">m</span> <span class="main">+</span> <span class="free">n</span><span class="main">)</span><span class="main">.</span>complex_of_real<span class="main">(</span><span class="main">(</span>cmod <span class="main">(</span><span class="free">u</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">i</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">*</span> complex_of_real<span class="main">(</span><span class="main">(</span>cmod <span class="main">(</span><span class="free">v</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">i</span> <span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="free">m</span><span class="main">.</span> <span class="main">(</span>cmod <span class="main">(</span><span class="free">u</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="free">m</span><span class="main">.</span> complex_of_real <span class="main">(</span><span class="main">(</span>cmod <span class="main">(</span><span class="free">u</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">.</span> <span class="main">(</span>cmod <span class="main">(</span><span class="free">v</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">.</span> complex_of_real <span class="main">(</span><span class="main">(</span>cmod <span class="main">(</span><span class="free">v</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> sum_prod<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="main">(</span>cmod <span class="main">(</span><span class="free">u</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">i</span> <span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span><span class="main">^</span><span class="free">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="main">(</span>cmod <span class="main">(</span><span class="free">v</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">i</span> <span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span><span class="main">^</span><span class="free">m</span>"</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> of_real_eq_iff of_real_mult power_add<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="free">m</span><span class="main">.</span> <span class="main">(</span>cmod <span class="main">(</span><span class="free">u</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> state_def cpx_vec_length_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">.</span> <span class="main">(</span>cmod <span class="main">(</span><span class="free">v</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> state_def cpx_vec_length_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∥</span>Matrix.col <span class="main">(</span><span class="free">u</span> <span class="main">⨂</span> <span class="free">v</span><span class="main">)</span> <span class="main">0</span><span class="main">∥</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> c1 c2 assms state_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cpx_vec_length_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="More_Tensor-dim_row_of_tensor_gate"><span class="command">lemma</span></span> dim_row_of_tensor_gate<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"gate <span class="free">m</span> <span class="free">G1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"gate <span class="free">n</span> <span class="free">G2</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"dim_row <span class="main">(</span><span class="free">G1</span> <span class="main">⨂</span> <span class="free">G2</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">m</span><span class="main">+</span><span class="free">n</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> assms dim_row_tensor_mat gate.dim_row <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power_add<span class="main">)</span>

<span class="keyword1" id="More_Tensor-tensor_gate_sqr_mat"><span class="command">lemma</span></span> tensor_gate_sqr_mat<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"gate <span class="free">m</span> <span class="free">G1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"gate <span class="free">n</span> <span class="free">G2</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"square_mat <span class="main">(</span><span class="free">G1</span> <span class="main">⨂</span> <span class="free">G2</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> assms gate.square_mat <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="More_Tensor-dim_row_of_one_mat_less_pow"><span class="command">lemma</span></span> dim_row_of_one_mat_less_pow<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"gate <span class="free">m</span> <span class="free">G1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"gate <span class="free">n</span> <span class="free">G2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> dim_row <span class="main">(</span><span class="keyword1">1<span class="hidden">⇩</span><sub>m</sub></span><span class="main">(</span>dim_col <span class="free">G1</span> <span class="main">*</span> dim_col <span class="free">G2</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">m</span><span class="main">+</span><span class="free">n</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> assms gate_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power_add<span class="main">)</span>

<span class="keyword1" id="More_Tensor-dim_col_of_one_mat_less_pow"><span class="command">lemma</span></span> dim_col_of_one_mat_less_pow<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"gate <span class="free">m</span> <span class="free">G1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"gate <span class="free">n</span> <span class="free">G2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">&lt;</span> dim_col <span class="main">(</span><span class="keyword1">1<span class="hidden">⇩</span><sub>m</sub></span><span class="main">(</span>dim_col <span class="free">G1</span> <span class="main">*</span> dim_col <span class="free">G2</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">&lt;</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">m</span><span class="main">+</span><span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms gate_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power_add<span class="main">)</span>

<span class="keyword1" id="More_Tensor-index_tensor_gate_unitary1"><span class="command">lemma</span></span> index_tensor_gate_unitary1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"gate <span class="free">m</span> <span class="free">G1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"gate <span class="free">n</span> <span class="free">G2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> dim_row <span class="main">(</span><span class="keyword1">1<span class="hidden">⇩</span><sub>m</sub></span><span class="main">(</span>dim_col <span class="free">G1</span> <span class="main">*</span> dim_col <span class="free">G2</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
<span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">&lt;</span> dim_col <span class="main">(</span><span class="keyword1">1<span class="hidden">⇩</span><sub>m</sub></span><span class="main">(</span>dim_col <span class="free">G1</span> <span class="main">*</span> dim_col <span class="free">G2</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">G1</span> <span class="main">⨂</span> <span class="free">G2</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">G1</span> <span class="main">⨂</span> <span class="free">G2</span><span class="main">)</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span> <span class="free">j</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>m</sub></span><span class="main">(</span>dim_col <span class="free">G1</span> <span class="main">*</span> dim_col <span class="free">G2</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span> <span class="free">j</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">k</span><span class="main">.</span> <span class="bound">k</span><span class="main">&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">m</span><span class="main">+</span><span class="free">n</span><span class="main">)</span> <span class="main">⟹</span> cnj<span class="main">(</span><span class="main">(</span><span class="free">G1</span> <span class="main">⨂</span> <span class="free">G2</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="free">i</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
cnj<span class="main">(</span><span class="free">G1</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">k</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">,</span> <span class="free">i</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> cnj<span class="main">(</span><span class="free">G2</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">k</span> <span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">,</span> <span class="free">i</span> <span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1-3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> gate_def power_add<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">k</span><span class="main">.</span> <span class="bound">k</span><span class="main">&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">m</span><span class="main">+</span><span class="free">n</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">G1</span> <span class="main">⨂</span> <span class="free">G2</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="free">j</span><span class="main">)</span> <span class="main">=</span> 
                                   <span class="free">G1</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">k</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">,</span> <span class="free">j</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">)</span> <span class="main">*</span> <span class="free">G2</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">k</span> <span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">,</span> <span class="free">j</span> <span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">,</span>2<span class="main">,</span>4<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> gate_def power_add<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">k</span><span class="main">.</span> <span class="bound">k</span><span class="main">&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">m</span><span class="main">+</span><span class="free">n</span><span class="main">)</span> <span class="main">⟹</span> cnj<span class="main">(</span><span class="main">(</span><span class="free">G1</span> <span class="main">⨂</span> <span class="free">G2</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="free">i</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="free">G1</span> <span class="main">⨂</span> <span class="free">G2</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
      cnj<span class="main">(</span><span class="free">G1</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">k</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">,</span> <span class="free">i</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="free">G1</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">k</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">,</span> <span class="free">j</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">)</span> <span class="main">*</span> 
      cnj<span class="main">(</span><span class="free">G2</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">k</span> <span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">,</span> <span class="free">i</span> <span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="free">G2</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">k</span> <span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">,</span> <span class="free">j</span> <span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">m</span><span class="main">+</span><span class="free">n</span><span class="main">)</span><span class="main">.</span> cnj<span class="main">(</span><span class="main">(</span><span class="free">G1</span> <span class="main">⨂</span> <span class="free">G2</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="free">i</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="free">G1</span> <span class="main">⨂</span> <span class="free">G2</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="free">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
      <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">m</span><span class="main">+</span><span class="free">n</span><span class="main">)</span><span class="main">.</span> cnj<span class="main">(</span><span class="free">G1</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">k</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">,</span> <span class="free">i</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="free">G1</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">k</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">,</span> <span class="free">j</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">)</span> <span class="main">*</span> 
                    cnj<span class="main">(</span><span class="free">G2</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">k</span> <span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">,</span> <span class="free">i</span> <span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="free">G2</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">k</span> <span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">,</span> <span class="free">j</span> <span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> 
             <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="free">m</span><span class="main">.</span> cnj<span class="main">(</span><span class="free">G1</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="free">i</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="free">G1</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="free">j</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> 
             <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">.</span> cnj<span class="main">(</span><span class="free">G2</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="free">i</span> <span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="free">G2</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="free">j</span> <span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> sum_prod<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> cnj<span class="main">(</span><span class="free">G1</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="free">i</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="free">G1</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="free">j</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span><span class="main">^</span><span class="free">n</span>"</span></span> 
<span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> cnj<span class="main">(</span><span class="free">G2</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="free">i</span> <span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="free">G2</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="free">j</span> <span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span><span class="main">^</span><span class="free">m</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> power_add semigroup_mult_class.mult.assoc sum.cong<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">G1</span> <span class="main">⨂</span> <span class="free">G2</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">G1</span> <span class="main">⨂</span> <span class="free">G2</span><span class="main">)</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span> <span class="free">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">m</span><span class="main">+</span><span class="free">n</span><span class="main">)</span><span class="main">.</span>cnj<span class="main">(</span><span class="main">(</span><span class="free">G1</span> <span class="main">⨂</span> <span class="free">G2</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="free">i</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="free">G1</span> <span class="main">⨂</span> <span class="free">G2</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="free">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms index_matrix_prod<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">i</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G1</span> <span class="main">⨂</span> <span class="free">G2</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G1</span> <span class="main">⨂</span> <span class="free">G2</span><span class="main">)</span>"</span></span><span class="main">]</span> dagger_def 
dim_row_of_tensor_gate tensor_gate_sqr_mat <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">G1</span> <span class="main">⨂</span> <span class="free">G2</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">G1</span> <span class="main">⨂</span> <span class="free">G2</span><span class="main">)</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="free">j</span><span class="main">)</span> <span class="main">=</span> 
              <span class="main">(</span><span class="main">∑</span><span class="bound">k1</span><span class="main">&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="free">m</span><span class="main">.</span> cnj<span class="main">(</span><span class="free">G1</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">k1</span><span class="main">,</span> <span class="free">i</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="free">G1</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">k1</span><span class="main">,</span> <span class="free">j</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> 
              <span class="main">(</span><span class="main">∑</span><span class="bound">k2</span><span class="main">&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">.</span> cnj<span class="main">(</span><span class="free">G2</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">k2</span><span class="main">,</span> <span class="free">i</span> <span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="free">G2</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">k2</span><span class="main">,</span> <span class="free">j</span> <span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="free">m</span><span class="main">.</span> cnj<span class="main">(</span><span class="free">G1</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="free">i</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">)</span><span class="main">)</span><span class="main">*</span> <span class="free">G1</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="free">j</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">G1</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span> <span class="main">*</span> <span class="free">G1</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">,</span> <span class="free">j</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms gate_def dagger_def index_matrix_prod<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">G1</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">G1</span>"</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_mult_imp_div_less power_add<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>m</sub></span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="free">m</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">,</span> <span class="free">j</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> gate_def unitary_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">.</span> cnj<span class="main">(</span><span class="free">G2</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="free">i</span> <span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">)</span><span class="main">)</span><span class="main">*</span> <span class="free">G2</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="free">j</span> <span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">G2</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span> <span class="main">*</span> <span class="free">G2</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span> <span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">,</span> <span class="free">j</span> <span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> gate_def dagger_def index_matrix_prod<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">G2</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">G2</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>m</sub></span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span> <span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">,</span> <span class="free">j</span> <span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> gate_def unitary_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">G1</span> <span class="main">⨂</span> <span class="free">G2</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">G1</span> <span class="main">⨂</span> <span class="free">G2</span><span class="main">)</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="free">j</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>m</sub></span> <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="free">m</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">,</span> <span class="free">j</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">)</span> <span class="main">*</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>m</sub></span> <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span> <span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">,</span> <span class="free">j</span> <span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms assms<span class="main">(</span>3<span class="main">,</span>4<span class="main">)</span> gate_def index_one_mat_div_mod<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">i</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power_add<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="More_Tensor-tensor_gate_unitary1"><span class="command">lemma</span></span> tensor_gate_unitary1 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"gate <span class="free">m</span> <span class="free">G1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"gate <span class="free">n</span> <span class="free">G2</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G1</span> <span class="main">⨂</span> <span class="free">G2</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">G1</span> <span class="main">⨂</span> <span class="free">G2</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>m</sub></span><span class="main">(</span>dim_col <span class="free">G1</span> <span class="main">*</span> dim_col <span class="free">G2</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_row <span class="main">(</span><span class="main">(</span><span class="free">G1</span> <span class="main">⨂</span> <span class="free">G2</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">G1</span> <span class="main">⨂</span> <span class="free">G2</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> dim_row <span class="main">(</span><span class="keyword1">1<span class="hidden">⇩</span><sub>m</sub></span><span class="main">(</span>dim_col <span class="free">G1</span> <span class="main">*</span> dim_col <span class="free">G2</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_col <span class="main">(</span><span class="main">(</span><span class="free">G1</span> <span class="main">⨂</span> <span class="free">G2</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">G1</span> <span class="main">⨂</span> <span class="free">G2</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> dim_col <span class="main">(</span><span class="keyword1">1<span class="hidden">⇩</span><sub>m</sub></span><span class="main">(</span>dim_col <span class="free">G1</span> <span class="main">*</span> dim_col <span class="free">G2</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> dim_row <span class="main">(</span><span class="keyword1">1<span class="hidden">⇩</span><sub>m</sub></span><span class="main">(</span>dim_col <span class="free">G1</span> <span class="main">*</span> dim_col <span class="free">G2</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> dim_col <span class="main">(</span><span class="keyword1">1<span class="hidden">⇩</span><sub>m</sub></span><span class="main">(</span>dim_col <span class="free">G1</span> <span class="main">*</span> dim_col <span class="free">G2</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">G1</span> <span class="main">⨂</span> <span class="free">G2</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">G1</span> <span class="main">⨂</span> <span class="free">G2</span><span class="main">)</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>m</sub></span><span class="main">(</span>dim_col <span class="free">G1</span> <span class="main">*</span> dim_col <span class="free">G2</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms index_tensor_gate_unitary1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="More_Tensor-index_tensor_gate_unitary2"><span class="command">lemma</span></span> index_tensor_gate_unitary2 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"gate <span class="free">m</span> <span class="free">G1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"gate <span class="free">n</span> <span class="free">G2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> dim_row <span class="main">(</span><span class="keyword1">1<span class="hidden">⇩</span><sub>m</sub></span> <span class="main">(</span>dim_col <span class="free">G1</span> <span class="main">*</span> dim_col <span class="free">G2</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
<span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">&lt;</span> dim_col <span class="main">(</span><span class="keyword1">1<span class="hidden">⇩</span><sub>m</sub></span> <span class="main">(</span>dim_col <span class="free">G1</span> <span class="main">*</span> dim_col <span class="free">G2</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">G1</span> <span class="main">⨂</span> <span class="free">G2</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="free">G1</span> <span class="main">⨂</span> <span class="free">G2</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span><span class="main">)</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span> <span class="free">j</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>m</sub></span><span class="main">(</span>dim_col <span class="free">G1</span> <span class="main">*</span> dim_col <span class="free">G2</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span> <span class="free">j</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">k</span><span class="main">.</span> <span class="bound">k</span><span class="main">&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">m</span><span class="main">+</span><span class="free">n</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">G1</span> <span class="main">⨂</span> <span class="free">G2</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span> <span class="main">=</span> 
<span class="free">G1</span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">,</span> <span class="bound">k</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">)</span> <span class="main">*</span> <span class="free">G2</span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span> <span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">,</span> <span class="bound">k</span> <span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1-3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> gate_def power_add<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">k</span><span class="main">.</span> <span class="bound">k</span><span class="main">&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">m</span><span class="main">+</span><span class="free">n</span><span class="main">)</span> <span class="main">⟹</span> cnj<span class="main">(</span><span class="main">(</span><span class="free">G1</span> <span class="main">⨂</span> <span class="free">G2</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="free">j</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
cnj<span class="main">(</span><span class="free">G1</span> <span class="main">$$</span> <span class="main">(</span><span class="free">j</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">,</span> <span class="bound">k</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> cnj<span class="main">(</span><span class="free">G2</span> <span class="main">$$</span> <span class="main">(</span><span class="free">j</span> <span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">,</span> <span class="bound">k</span> <span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">,</span>2<span class="main">,</span>4<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> gate_def power_add<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">k</span><span class="main">.</span> <span class="bound">k</span><span class="main">∈</span><span class="main">{..&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">m</span><span class="main">+</span><span class="free">n</span><span class="main">)</span><span class="main">}</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">G1</span> <span class="main">⨂</span> <span class="free">G2</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span> <span class="main">*</span> cnj<span class="main">(</span><span class="main">(</span><span class="free">G1</span> <span class="main">⨂</span> <span class="free">G2</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="free">j</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
                         <span class="free">G1</span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">,</span> <span class="bound">k</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">)</span> <span class="main">*</span> cnj<span class="main">(</span><span class="free">G1</span> <span class="main">$$</span> <span class="main">(</span><span class="free">j</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">,</span> <span class="bound">k</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> 
                         <span class="free">G2</span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span> <span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">,</span> <span class="bound">k</span> <span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">)</span> <span class="main">*</span> cnj<span class="main">(</span><span class="free">G2</span> <span class="main">$$</span> <span class="main">(</span><span class="free">j</span> <span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">,</span> <span class="bound">k</span> <span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">m</span><span class="main">+</span><span class="free">n</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="free">G1</span> <span class="main">⨂</span> <span class="free">G2</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span> <span class="main">*</span> cnj<span class="main">(</span><span class="main">(</span><span class="free">G1</span> <span class="main">⨂</span> <span class="free">G2</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="free">j</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
      <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">m</span><span class="main">+</span><span class="free">n</span><span class="main">)</span><span class="main">.</span> <span class="free">G1</span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">,</span> <span class="bound">k</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">)</span> <span class="main">*</span> cnj<span class="main">(</span><span class="free">G1</span> <span class="main">$$</span> <span class="main">(</span><span class="free">j</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">,</span> <span class="bound">k</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> 
      <span class="free">G2</span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span> <span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">,</span> <span class="bound">k</span> <span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">)</span> <span class="main">*</span> cnj<span class="main">(</span><span class="free">G2</span> <span class="main">$$</span> <span class="main">(</span><span class="free">j</span> <span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">,</span> <span class="bound">k</span> <span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> 
             <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="free">m</span><span class="main">.</span> <span class="free">G1</span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">,</span> <span class="bound">k</span><span class="main">)</span> <span class="main">*</span> cnj<span class="main">(</span><span class="free">G1</span> <span class="main">$$</span> <span class="main">(</span><span class="free">j</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">,</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> 
             <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">.</span> <span class="free">G2</span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span> <span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">,</span> <span class="bound">k</span><span class="main">)</span> <span class="main">*</span> cnj<span class="main">(</span><span class="free">G2</span> <span class="main">$$</span> <span class="main">(</span><span class="free">j</span> <span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">,</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> sum_prod<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">k</span><span class="main">.</span> <span class="free">G1</span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">,</span> <span class="bound">k</span><span class="main">)</span> <span class="main">*</span> cnj<span class="main">(</span><span class="free">G1</span> <span class="main">$$</span> <span class="main">(</span><span class="free">j</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">,</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span><span class="main">^</span><span class="free">n</span>"</span></span> 
                        <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">k</span><span class="main">.</span> <span class="free">G2</span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span> <span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">,</span> <span class="bound">k</span><span class="main">)</span> <span class="main">*</span> cnj<span class="main">(</span><span class="free">G2</span> <span class="main">$$</span> <span class="main">(</span><span class="free">j</span> <span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">,</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span><span class="main">^</span><span class="free">m</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> power_add semigroup_mult_class.mult.assoc sum.cong<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">G1</span> <span class="main">⨂</span> <span class="free">G2</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="free">G1</span> <span class="main">⨂</span> <span class="free">G2</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span><span class="main">)</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span> <span class="free">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">m</span><span class="main">+</span><span class="free">n</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="free">G1</span> <span class="main">⨂</span> <span class="free">G2</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span> <span class="main">*</span> cnj<span class="main">(</span><span class="main">(</span><span class="free">G1</span> <span class="main">⨂</span> <span class="free">G2</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="free">j</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms index_matrix_prod<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">i</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G1</span> <span class="main">⨂</span> <span class="free">G2</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G1</span> <span class="main">⨂</span> <span class="free">G2</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span>"</span></span><span class="main">]</span> dagger_def
dim_row_of_tensor_gate tensor_gate_sqr_mat <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">G1</span> <span class="main">⨂</span> <span class="free">G2</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="free">G1</span> <span class="main">⨂</span> <span class="free">G2</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span><span class="main">)</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="free">j</span><span class="main">)</span> <span class="main">=</span> 
             <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="free">m</span><span class="main">.</span> <span class="free">G1</span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">,</span> <span class="bound">k</span><span class="main">)</span> <span class="main">*</span> cnj<span class="main">(</span><span class="free">G1</span> <span class="main">$$</span> <span class="main">(</span><span class="free">j</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">,</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> 
             <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">.</span> <span class="free">G2</span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span> <span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">,</span> <span class="bound">k</span><span class="main">)</span> <span class="main">*</span> cnj<span class="main">(</span><span class="free">G2</span> <span class="main">$$</span> <span class="main">(</span><span class="free">j</span> <span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">,</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="free">m</span><span class="main">.</span> <span class="free">G1</span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">,</span> <span class="bound">k</span><span class="main">)</span> <span class="main">*</span> cnj<span class="main">(</span><span class="free">G1</span> <span class="main">$$</span> <span class="main">(</span><span class="free">j</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">,</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">G1</span> <span class="main">*</span> <span class="main">(</span><span class="free">G1</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span><span class="main">)</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">,</span> <span class="free">j</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms gate_def dagger_def index_matrix_prod<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">G1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">G1</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_mult_imp_div_less power_add<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>m</sub></span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="free">m</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">,</span> <span class="free">j</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> gate_def unitary_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">.</span> <span class="free">G2</span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span> <span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">,</span> <span class="bound">k</span><span class="main">)</span> <span class="main">*</span> cnj<span class="main">(</span><span class="free">G2</span> <span class="main">$$</span> <span class="main">(</span><span class="free">j</span> <span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">,</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">G2</span> <span class="main">*</span> <span class="main">(</span><span class="free">G2</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span><span class="main">)</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span> <span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">,</span> <span class="free">j</span> <span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> gate_def dagger_def index_matrix_prod<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">G2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">G2</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>m</sub></span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span> <span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">,</span> <span class="free">j</span> <span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> gate_def unitary_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">G1</span> <span class="main">⨂</span> <span class="free">G2</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="free">G1</span> <span class="main">⨂</span> <span class="free">G2</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span><span class="main">)</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="free">j</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>m</sub></span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="free">m</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">,</span> <span class="free">j</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">)</span> <span class="main">*</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>m</sub></span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span> <span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">,</span> <span class="free">j</span> <span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms gate_def index_one_mat_div_mod<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">i</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power_add<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="More_Tensor-tensor_gate_unitary2"><span class="command">lemma</span></span> tensor_gate_unitary2 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"gate <span class="free">m</span> <span class="free">G1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"gate <span class="free">n</span> <span class="free">G2</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G1</span> <span class="main">⨂</span> <span class="free">G2</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="free">G1</span> <span class="main">⨂</span> <span class="free">G2</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>m</sub></span><span class="main">(</span>dim_col <span class="free">G1</span> <span class="main">*</span> dim_col <span class="free">G2</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_row <span class="main">(</span><span class="main">(</span><span class="free">G1</span> <span class="main">⨂</span> <span class="free">G2</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="free">G1</span> <span class="main">⨂</span> <span class="free">G2</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> dim_row<span class="main">(</span><span class="keyword1">1<span class="hidden">⇩</span><sub>m</sub></span> <span class="main">(</span>dim_col <span class="free">G1</span> <span class="main">*</span> dim_col <span class="free">G2</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms gate_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_col <span class="main">(</span><span class="main">(</span><span class="free">G1</span> <span class="main">⨂</span> <span class="free">G2</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="free">G1</span> <span class="main">⨂</span> <span class="free">G2</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> dim_col <span class="main">(</span><span class="keyword1">1<span class="hidden">⇩</span><sub>m</sub></span><span class="main">(</span>dim_col <span class="free">G1</span> <span class="main">*</span> dim_col <span class="free">G2</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms gate_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> dim_row <span class="main">(</span><span class="keyword1">1<span class="hidden">⇩</span><sub>m</sub></span> <span class="main">(</span>dim_col <span class="free">G1</span> <span class="main">*</span> dim_col <span class="free">G2</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> dim_col <span class="main">(</span><span class="keyword1">1<span class="hidden">⇩</span><sub>m</sub></span> <span class="main">(</span>dim_col <span class="free">G1</span> <span class="main">*</span> dim_col <span class="free">G2</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">G1</span> <span class="main">⨂</span> <span class="free">G2</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="free">G1</span> <span class="main">⨂</span> <span class="free">G2</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span><span class="main">)</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>m</sub></span><span class="main">(</span>dim_col <span class="free">G1</span> <span class="main">*</span> dim_col <span class="free">G2</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms index_tensor_gate_unitary2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="More_Tensor-tensor_gate"><span class="command">lemma</span></span> tensor_gate <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"gate <span class="free">m</span> <span class="free">G1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"gate <span class="free">n</span> <span class="free">G2</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"gate <span class="main">(</span><span class="free">m</span> <span class="main">+</span> <span class="free">n</span><span class="main">)</span> <span class="main">(</span><span class="free">G1</span> <span class="main">⨂</span> <span class="free">G2</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_row <span class="main">(</span><span class="free">G1</span> <span class="main">⨂</span> <span class="free">G2</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">m</span><span class="main">+</span><span class="free">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms dim_row_tensor_mat gate.dim_row <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power_add<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"square_mat <span class="main">(</span><span class="free">G1</span> <span class="main">⨂</span> <span class="free">G2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms gate.square_mat <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"unitary <span class="main">(</span><span class="free">G1</span> <span class="main">⨂</span> <span class="free">G2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms unitary_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="Measurement">
<div class="head">
<h1>Theory Measurement</h1>
</div>
<pre class="source"><span class="comment1">(* 
Author: 
  Anthony Bordg, University of Cambridge, apdb3@cam.ac.uk
  Yijun He, University of Cambridge, yh403@cam.ac.uk
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Measurement›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Measurement
<span class="keyword2"><span class="keyword">imports</span></span>
  <a href="#Quantum">Quantum</a>
<span class="keyword2"><span class="keyword">begin</span></span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
Given an element v  such that <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">"state n v"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, its components <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">"v $ i"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> (when v is seen as 
a vector, v being a matrix column) for <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">"0 ≤ i &lt; n"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> have to be understood as the coefficients 
of the representation of v in the basis given by the unit vectors of dimension $2^n$, unless stated otherwise. 
Such a vector v is a state for a quantum system of n qubits.
In the literature on quantum computing, for $n = 1$, i.e. for a quantum system of 1 qubit, the elements
of the so-called computational basis are denoted $|0\rangle$,$|1\rangle$, and these last elements might be understood
for instance as $(1,0)$,$(0,1)$, i.e. as the zeroth and the first elements of a given basis ; for $n = 2$, 
i.e. for a quantum system of 2 qubits, the elements of the computational basis are denoted $|00\rangle$,
$|01\rangle$, $|10\rangle$,$|11\rangle$, and they might be understood for instance as $(1,0,0,0)$,
$(0,1,0,0)$, $(0,0,1,0)$, $(0,0,0,1)$; and so on for higher values of $n$. 
The idea behind these standard notations is that the labels on the vectors of the 
computational basis are the binary expressions of the natural numbers indexing the elements
in a given ordered basis interpreting the computational basis in a specific context, another point of
view is that the order of the basis corresponds to the lexicographic order for the labels. 
Those labels also represent the possible outcomes of a measurement of the $n$ qubits of the system, 
while the squared modules of the corresponding coefficients represent the probabilities for those 
outcomes. The fact that the vector v has to be normalized expresses precisely the fact that the squared 
modules of the coefficients represent some probabilities and hence their sum should be $1$.
Note that in the case of a system with multiple qubits, i.e. $n \geq 2$, one can model the simultaneous 
measurement of multiple qubits by sequential measurements of single qubits. Indeed, this last process
leads to the same probabilities for the various possible outcomes.
Given a system with n-qubits and i the index of one qubit among the $n$ qubits of the system, where
$0 \leq i \leq n-1$ (i.e. we start the indexing from $0$), we want to find the indices of the states of the
computational basis whose labels have a $1$ at the ith spot (counting from $0$). For instance, 
if $n=3$ and $i=2$ then $1$,$3$,$5$,$7$ are the indices of the elements of the computational basis 
with a $1$ at the 2nd spot, namely $|001\rangle$,$|011\rangle$,$|101\rangle$,$|111\rangle$. To achieve that we define the 
predicate <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">select_index</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> below.
›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">select_index</span> <span class="main">::</span><span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> nat <span class="main">⇒</span> nat <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">select_index</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">≤</span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">≤</span><span class="numeral">2</span><span class="main">^</span><span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">-</span><span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span> <span class="main">≥</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">-</span><span class="main">1</span><span class="main">-</span><span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Measurement-select_index_union"><span class="command">lemma</span></span> select_index_union<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">k</span><span class="main">|</span> <span class="bound">k</span><span class="main">::</span>nat<span class="main">.</span> select_index <span class="free">n</span> <span class="free">i</span> <span class="bound">k</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="bound">k</span><span class="main">|</span> <span class="bound">k</span><span class="main">::</span>nat<span class="main">.</span> <span class="main">(</span><span class="bound">k</span><span class="main">&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">)</span> <span class="main">∧</span> <span class="main">¬</span> select_index <span class="free">n</span> <span class="free">i</span> <span class="bound">k</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">::</span>nat<span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">k</span> <span class="main">|</span><span class="bound">k</span><span class="main">.</span> select_index <span class="free">n</span> <span class="free">i</span> <span class="bound">k</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="numeral">2</span> <span class="main">^</span> <span class="free">n</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span><span class="main">::</span><span class="quoted">nat</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">k</span> <span class="main">|</span><span class="bound">k</span><span class="main">.</span> select_index <span class="free">n</span> <span class="free">i</span> <span class="bound">k</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">}</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> select_index_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> atLeastLessThan_iff diff_diff_cancel diff_is_0_eq' diff_le_mono2 
le_less_linear le_numeral_extra<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> mem_Collect_eq one_le_numeral one_le_power select_index_def zero_order<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">k</span> <span class="main">|</span><span class="bound">k</span><span class="main">.</span> <span class="bound">k</span><span class="main">&lt;</span><span class="numeral">2</span> <span class="main">^</span> <span class="free">n</span> <span class="main">∧</span> <span class="main">¬</span> select_index <span class="free">n</span> <span class="free">i</span> <span class="bound">k</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="numeral">2</span> <span class="main">^</span> <span class="free">n</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">k</span> <span class="main">|</span><span class="bound">k</span><span class="main">.</span> select_index <span class="free">n</span> <span class="free">i</span> <span class="bound">k</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="bound">k</span> <span class="main">|</span><span class="bound">k</span><span class="main">.</span> <span class="bound">k</span><span class="main">&lt;</span><span class="numeral">2</span> <span class="main">^</span> <span class="free">n</span> <span class="main">∧</span> <span class="main">¬</span> select_index <span class="free">n</span> <span class="free">i</span> <span class="bound">k</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="numeral">2</span> <span class="main">^</span> <span class="free">n</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="numeral">2</span> <span class="main">^</span> <span class="free">n</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound">k</span> <span class="main">|</span><span class="bound">k</span><span class="main">.</span> select_index <span class="free">n</span> <span class="free">i</span> <span class="bound">k</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="bound">k</span> <span class="main">|</span><span class="bound">k</span><span class="main">.</span> <span class="bound">k</span><span class="main">&lt;</span><span class="numeral">2</span> <span class="main">^</span> <span class="free">n</span> <span class="main">∧</span> <span class="main">¬</span> select_index <span class="free">n</span> <span class="free">i</span> <span class="bound">k</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Measurement-select_index_inter"><span class="command">lemma</span></span> select_index_inter<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">k</span><span class="main">|</span> <span class="bound">k</span><span class="main">::</span>nat<span class="main">.</span> select_index <span class="free">n</span> <span class="free">i</span> <span class="bound">k</span><span class="main">}</span> <span class="main">∩</span> <span class="main">{</span><span class="bound">k</span><span class="main">|</span> <span class="bound">k</span><span class="main">::</span>nat<span class="main">.</span> <span class="main">(</span><span class="bound">k</span><span class="main">&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">)</span> <span class="main">∧</span> <span class="main">¬</span> select_index <span class="free">n</span> <span class="free">i</span> <span class="bound">k</span><span class="main">}</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Measurement-outcomes_sum"><span class="command">lemma</span></span> outcomes_sum <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> real"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="bound">k</span><span class="main">|</span> <span class="bound">k</span><span class="main">::</span>nat<span class="main">.</span> select_index <span class="free">n</span> <span class="free">i</span> <span class="bound">k</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="free">f</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> 
   <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="bound">k</span><span class="main">|</span> <span class="bound">k</span><span class="main">::</span>nat<span class="main">.</span> <span class="main">(</span><span class="bound">k</span><span class="main">&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">)</span> <span class="main">∧</span> <span class="main">¬</span> select_index <span class="free">n</span> <span class="free">i</span> <span class="bound">k</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="free">f</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
   <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">::</span>nat<span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="free">f</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">k</span><span class="main">|</span> <span class="bound">k</span><span class="main">::</span>nat<span class="main">.</span> select_index <span class="free">n</span> <span class="free">i</span> <span class="bound">k</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">::</span>nat<span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> select_index_union <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound">k</span><span class="main">|</span> <span class="bound">k</span><span class="main">::</span>nat<span class="main">.</span> select_index <span class="free">n</span> <span class="free">i</span> <span class="bound">k</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> rev_finite_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">k</span><span class="main">|</span> <span class="bound">k</span><span class="main">::</span>nat<span class="main">.</span> <span class="main">(</span><span class="bound">k</span><span class="main">&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">)</span> <span class="main">∧</span> <span class="main">¬</span> select_index <span class="free">n</span> <span class="free">i</span> <span class="bound">k</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">::</span>nat<span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> select_index_union <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound">k</span><span class="main">|</span> <span class="bound">k</span><span class="main">::</span>nat<span class="main">.</span> <span class="main">(</span><span class="bound">k</span><span class="main">&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">)</span> <span class="main">∧</span> <span class="main">¬</span> select_index <span class="free">n</span> <span class="free">i</span> <span class="bound">k</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> rev_finite_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="bound">k</span><span class="main">|</span> <span class="bound">k</span><span class="main">::</span>nat<span class="main">.</span> select_index <span class="free">n</span> <span class="free">i</span> <span class="bound">k</span><span class="main">}</span><span class="main">∪</span><span class="main">{</span><span class="bound">k</span><span class="main">|</span> <span class="bound">k</span><span class="main">::</span>nat<span class="main">.</span> <span class="main">(</span><span class="bound">k</span><span class="main">&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">)</span> <span class="main">∧</span> <span class="main">¬</span> select_index <span class="free">n</span> <span class="free">i</span> <span class="bound">k</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="free">f</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
           <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="bound">k</span><span class="main">|</span> <span class="bound">k</span><span class="main">::</span>nat<span class="main">.</span> select_index <span class="free">n</span> <span class="free">i</span> <span class="bound">k</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="free">f</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> 
           <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="bound">k</span><span class="main">|</span> <span class="bound">k</span><span class="main">::</span>nat<span class="main">.</span> <span class="main">(</span><span class="bound">k</span><span class="main">&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">)</span> <span class="main">∧</span> <span class="main">¬</span> select_index <span class="free">n</span> <span class="free">i</span> <span class="bound">k</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="free">f</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span>
           <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="bound">k</span><span class="main">|</span> <span class="bound">k</span><span class="main">::</span>nat<span class="main">.</span> select_index <span class="free">n</span> <span class="free">i</span> <span class="bound">k</span><span class="main">}</span><span class="main">∩</span><span class="main">{</span><span class="bound">k</span><span class="main">|</span> <span class="bound">k</span><span class="main">::</span>nat<span class="main">.</span> <span class="main">(</span><span class="bound">k</span><span class="main">&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">)</span> <span class="main">∧</span> <span class="main">¬</span> select_index <span class="free">n</span> <span class="free">i</span> <span class="bound">k</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="free">f</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> sum_Un <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">::</span>nat<span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="free">f</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
                <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="bound">k</span><span class="main">|</span> <span class="bound">k</span><span class="main">::</span>nat<span class="main">.</span> select_index <span class="free">n</span> <span class="free">i</span> <span class="bound">k</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="free">f</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> 
                <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="bound">k</span><span class="main">|</span> <span class="bound">k</span><span class="main">::</span>nat<span class="main">.</span> <span class="main">(</span><span class="bound">k</span><span class="main">&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">)</span> <span class="main">∧</span> <span class="main">¬</span> select_index <span class="free">n</span> <span class="free">i</span> <span class="bound">k</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="free">f</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span>
                <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="main">{}</span><span class="main">.</span> <span class="main">(</span><span class="free">f</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> select_index_union select_index_inter <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
Given a state v of a n-qbit system, we compute the probability that a measure 
of qubit i has the outcome 1.
›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">prob1</span> <span class="main">::</span><span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> complex mat <span class="main">⇒</span> nat <span class="main">⇒</span> real"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">prob1</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">≡</span> <span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="bound">k</span><span class="main">|</span> <span class="bound">k</span><span class="main">::</span>nat<span class="main">.</span> select_index <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="bound">k</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span>cmod<span class="main">(</span><span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">$$</span> <span class="main">(</span><span class="bound">j</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">prob0</span> <span class="main">::</span><span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> complex mat <span class="main">⇒</span> nat <span class="main">⇒</span> real"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">prob0</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">≡</span> <span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="bound">k</span><span class="main">|</span> <span class="bound">k</span><span class="main">::</span>nat<span class="main">.</span> <span class="main">(</span><span class="bound">k</span><span class="main">&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">∧</span> <span class="main">¬</span> select_index <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="bound">k</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span>cmod<span class="main">(</span><span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">$$</span> <span class="main">(</span><span class="bound">j</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> prob1_geq_zero<span class="main">:</span><span class="quoted"><span class="quoted">"prob1 <span class="free">n</span> <span class="free">v</span> <span class="free">i</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> prob0_geq_zero<span class="main">:</span><span class="quoted"><span class="quoted">"prob0 <span class="free">n</span> <span class="free">v</span> <span class="free">i</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="bound">k</span><span class="main">|</span> <span class="bound">k</span><span class="main">::</span>nat<span class="main">.</span> select_index <span class="free">n</span> <span class="free">i</span> <span class="bound">k</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span>cmod<span class="main">(</span><span class="free">v</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">j</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">≥</span> 
           <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="bound">k</span><span class="main">|</span> <span class="bound">k</span><span class="main">::</span>nat<span class="main">.</span> select_index <span class="free">n</span> <span class="free">i</span> <span class="bound">k</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span>real<span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_nonneg<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="bound">k</span><span class="main">|</span> <span class="bound">k</span><span class="main">::</span>nat<span class="main">.</span> select_index <span class="free">n</span> <span class="free">i</span> <span class="bound">k</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span>cmod<span class="main">(</span><span class="free">v</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">j</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"prob1 <span class="free">n</span> <span class="free">v</span> <span class="free">i</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> prob1_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="bound">k</span><span class="main">|</span> <span class="bound">k</span><span class="main">::</span>nat<span class="main">.</span> <span class="main">(</span><span class="bound">k</span> <span class="main">&lt;</span> <span class="numeral">2</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span> <span class="main">∧</span> <span class="main">¬</span> select_index <span class="free">n</span> <span class="free">i</span> <span class="bound">k</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span>cmod<span class="main">(</span><span class="free">v</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">j</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">≥</span> 
           <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="bound">k</span><span class="main">|</span> <span class="bound">k</span><span class="main">::</span>nat<span class="main">.</span> <span class="main">(</span><span class="bound">k</span> <span class="main">&lt;</span> <span class="numeral">2</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span> <span class="main">∧</span> <span class="main">¬</span> select_index <span class="free">n</span> <span class="free">i</span> <span class="bound">k</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span>real<span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_nonneg<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="bound">k</span><span class="main">|</span> <span class="bound">k</span><span class="main">::</span>nat<span class="main">.</span> <span class="main">(</span><span class="bound">k</span> <span class="main">&lt;</span> <span class="numeral">2</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span> <span class="main">∧</span> <span class="main">¬</span> select_index <span class="free">n</span> <span class="free">i</span> <span class="bound">k</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span>cmod<span class="main">(</span><span class="free">v</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">j</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"prob0 <span class="free">n</span> <span class="free">v</span> <span class="free">i</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> prob0_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Measurement-prob_sum_is_one"><span class="command">lemma</span></span> prob_sum_is_one <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"state <span class="free">n</span> <span class="free">v</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"prob1 <span class="free">n</span> <span class="free">v</span> <span class="free">i</span> <span class="main">+</span> prob0 <span class="free">n</span> <span class="free">v</span> <span class="free">i</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prob1 <span class="free">n</span> <span class="free">v</span> <span class="free">i</span> <span class="main">+</span> prob0 <span class="free">n</span> <span class="free">v</span> <span class="free">i</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">::</span>nat<span class="main">}</span><span class="main">.</span> <span class="main">(</span>cmod<span class="main">(</span><span class="free">v</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">j</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> prob1_def prob0_def outcomes_sum <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">∥</span>col <span class="free">v</span> <span class="main">0</span><span class="main">∥</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> cpx_vec_length_def assms state_def atLeast0LessThan <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms state_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"state <span class="free">n</span> <span class="free">v</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> prob1_leq_one<span class="main">:</span><span class="quoted"><span class="quoted">"prob1 <span class="free">n</span> <span class="free">v</span> <span class="free">i</span> <span class="main">≤</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> prob0_leq_one<span class="main">:</span><span class="quoted"><span class="quoted">"prob0 <span class="free">n</span> <span class="free">v</span> <span class="free">i</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">metis</span> assms le_add_same_cancel1 prob0_geq_zero prob_sum_is_one<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">metis</span> assms le_add_same_cancel2 prob1_geq_zero prob_sum_is_one<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Measurement-prob0_is_prob"><span class="command">lemma</span></span> prob0_is_prob<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"state <span class="free">n</span> <span class="free">v</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"prob0 <span class="free">n</span> <span class="free">v</span> <span class="free">i</span> <span class="main">≥</span> <span class="main">0</span> <span class="main">∧</span> prob0 <span class="free">n</span> <span class="free">v</span> <span class="free">i</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms prob0_geq_zero prob0_leq_one<span class="main">)</span>

<span class="keyword1" id="Measurement-prob1_is_prob"><span class="command">lemma</span></span> prob1_is_prob<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"state <span class="free">n</span> <span class="free">v</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"prob1 <span class="free">n</span> <span class="free">v</span> <span class="free">i</span> <span class="main">≥</span> <span class="main">0</span> <span class="main">∧</span> prob1 <span class="free">n</span> <span class="free">v</span> <span class="free">i</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms prob1_geq_zero prob1_leq_one<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Below we give the new state of a n-qubits system after a measurement of the ith qubit gave 0.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">post_meas0</span> <span class="main">::</span><span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> complex mat <span class="main">⇒</span> nat <span class="main">⇒</span> complex mat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">post_meas0</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">≡</span> 
  of_real<span class="main">(</span><span class="main">1</span><span class="main">/</span>sqrt<span class="main">(</span>prob0 <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span><span class="main">)</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>m</sub></span> <span class="main">|</span>vec <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">j</span><span class="main">.</span> <span class="keyword1">if</span> <span class="main">¬</span> select_index <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="bound">j</span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">$$</span> <span class="main">(</span><span class="bound">j</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span><span class="main">⟩</span>"</span></span>
 
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
Note that a division by 0 never occurs. Indeed, if <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">"sqrt(prob0 n v i)"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> would be 0 then 
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">"prob0 n v i"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> would be 0 and it would mean that the measurement of the ith qubit gave 1.
›</span></span>

<span class="keyword1" id="Measurement-post_meas0_is_state"><span class="command">lemma</span></span> post_meas0_is_state <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"state <span class="free">n</span> <span class="free">v</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"prob0 <span class="free">n</span> <span class="free">v</span> <span class="free">i</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"state <span class="free">n</span> <span class="main">(</span>post_meas0 <span class="free">n</span> <span class="free">v</span> <span class="free">i</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">::</span>nat<span class="main">}</span><span class="main">.</span> <span class="main">(</span>cmod <span class="main">(</span><span class="keyword1">if</span> <span class="main">¬</span> select_index <span class="free">n</span> <span class="free">i</span> <span class="bound">j</span> <span class="keyword1">then</span> <span class="free">v</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">j</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">=</span> 
           <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="bound">k</span><span class="main">|</span> <span class="bound">k</span><span class="main">::</span>nat<span class="main">.</span> select_index <span class="free">n</span> <span class="free">i</span> <span class="bound">k</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span>cmod <span class="main">(</span><span class="keyword1">if</span> <span class="main">¬</span> select_index <span class="free">n</span> <span class="free">i</span> <span class="bound">j</span> <span class="keyword1">then</span> <span class="free">v</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">j</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">+</span>
           <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="bound">k</span><span class="main">|</span> <span class="bound">k</span><span class="main">::</span>nat<span class="main">.</span> <span class="main">(</span><span class="bound">k</span><span class="main">&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">)</span> <span class="main">∧</span> <span class="main">¬</span> select_index <span class="free">n</span> <span class="free">i</span> <span class="bound">k</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span>cmod <span class="main">(</span><span class="keyword1">if</span> <span class="main">¬</span> select_index <span class="free">n</span> <span class="free">i</span> <span class="bound">j</span> <span class="keyword1">then</span> <span class="free">v</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">j</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> outcomes_sum<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">j</span><span class="main">.</span> <span class="main">(</span>cmod <span class="main">(</span><span class="keyword1">if</span> <span class="main">¬</span> select_index <span class="free">n</span> <span class="free">i</span> <span class="bound">j</span> <span class="keyword1">then</span> <span class="free">v</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">j</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span> <span class="quoted"><span class="free">n</span></span> <span class="quoted"><span class="free">i</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="bound">k</span><span class="main">|</span> <span class="bound">k</span><span class="main">::</span>nat<span class="main">.</span> <span class="main">(</span><span class="bound">k</span><span class="main">&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">)</span> <span class="main">∧</span> <span class="main">¬</span> select_index <span class="free">n</span> <span class="free">i</span> <span class="bound">k</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span>cmod <span class="main">(</span><span class="keyword1">if</span> <span class="main">¬</span> select_index <span class="free">n</span> <span class="free">i</span> <span class="bound">j</span> <span class="keyword1">then</span> <span class="free">v</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">j</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">=</span> 
           prob0 <span class="free">n</span> <span class="free">v</span> <span class="free">i</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prob0_def<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∥</span>vec <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">j</span><span class="main">.</span> <span class="keyword1">if</span> <span class="main">¬</span> select_index <span class="free">n</span> <span class="free">i</span> <span class="bound">j</span> <span class="keyword1">then</span> <span class="free">v</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">j</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span><span class="main">∥</span> <span class="main">=</span> sqrt<span class="main">(</span>prob0 <span class="free">n</span> <span class="free">v</span> <span class="free">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> lessThan_atLeast0 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cpx_vec_length_def<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∥</span>col <span class="main">(</span>complex_of_real <span class="main">(</span><span class="main">1</span><span class="main">/</span>sqrt <span class="main">(</span>prob0 <span class="free">n</span> <span class="free">v</span> <span class="free">i</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>m</sub></span> <span class="main">|</span>vec <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">j</span><span class="main">.</span> <span class="keyword1">if</span> <span class="main">¬</span> select_index <span class="free">n</span> <span class="free">i</span> <span class="bound">j</span> <span class="keyword1">then</span> <span class="free">v</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">j</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span><span class="main">⟩</span><span class="main">)</span> <span class="main">0</span><span class="main">∥</span> <span class="main">=</span> 
           <span class="main">(</span><span class="main">1</span><span class="main">/</span>sqrt <span class="main">(</span>prob0 <span class="free">n</span> <span class="free">v</span> <span class="free">i</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">∥</span>vec <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">j</span><span class="main">.</span> <span class="keyword1">if</span> <span class="main">¬</span> select_index <span class="free">n</span> <span class="free">i</span> <span class="bound">j</span> <span class="keyword1">then</span> <span class="free">v</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">j</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span><span class="main">∥</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> prob0_geq_zero smult_vec_length_bis <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> real_sqrt_ge_0_iff zero_le_divide_1_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> state_def post_meas0_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ket_vec_def post_meas0_def assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Below we give the new state of a n-qubits system after a measurement of the ith qubit gave 1.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">post_meas1</span> <span class="main">::</span><span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> complex mat <span class="main">⇒</span> nat <span class="main">⇒</span> complex mat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">post_meas1</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">≡</span> 
  of_real<span class="main">(</span><span class="main">1</span><span class="main">/</span>sqrt<span class="main">(</span>prob1 <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span><span class="main">)</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>m</sub></span> <span class="main">|</span>vec <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">j</span><span class="main">.</span> <span class="keyword1">if</span> select_index <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="bound">j</span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">$$</span> <span class="main">(</span><span class="bound">j</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span><span class="main">⟩</span>"</span></span>
 
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
Note that a division by 0 never occurs. Indeed, if <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">"sqrt(prob1 n v i)"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> would be 0 then 
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">"prob1 n v i"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> would be 0 and it would mean that the measurement of the ith qubit gave 0.
›</span></span> 

<span class="keyword1" id="Measurement-post_meas_1_is_state"><span class="command">lemma</span></span> post_meas_1_is_state <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"state <span class="free">n</span> <span class="free">v</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"prob1 <span class="free">n</span> <span class="free">v</span> <span class="free">i</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"state <span class="free">n</span> <span class="main">(</span>post_meas1 <span class="free">n</span> <span class="free">v</span> <span class="free">i</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">::</span>nat<span class="main">}</span><span class="main">.</span> <span class="main">(</span>cmod <span class="main">(</span><span class="keyword1">if</span> select_index <span class="free">n</span> <span class="free">i</span> <span class="bound">j</span> <span class="keyword1">then</span> <span class="free">v</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">j</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">=</span> 
           <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="bound">k</span><span class="main">|</span> <span class="bound">k</span><span class="main">::</span>nat<span class="main">.</span> select_index <span class="free">n</span> <span class="free">i</span> <span class="bound">k</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span>cmod <span class="main">(</span><span class="keyword1">if</span> select_index <span class="free">n</span> <span class="free">i</span> <span class="bound">j</span> <span class="keyword1">then</span> <span class="free">v</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">j</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">+</span>
           <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="bound">k</span><span class="main">|</span> <span class="bound">k</span><span class="main">::</span>nat<span class="main">.</span> <span class="main">(</span><span class="bound">k</span><span class="main">&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">)</span> <span class="main">∧</span> <span class="main">¬</span> select_index <span class="free">n</span> <span class="free">i</span> <span class="bound">k</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span>cmod <span class="main">(</span><span class="keyword1">if</span> select_index <span class="free">n</span> <span class="free">i</span> <span class="bound">j</span> <span class="keyword1">then</span> <span class="free">v</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">j</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> outcomes_sum<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">j</span><span class="main">.</span> <span class="main">(</span>cmod <span class="main">(</span><span class="keyword1">if</span> select_index <span class="free">n</span> <span class="free">i</span> <span class="bound">j</span> <span class="keyword1">then</span> <span class="free">v</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">j</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span> <span class="quoted"><span class="free">n</span></span> <span class="quoted"><span class="free">i</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∥</span>vec <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">j</span><span class="main">.</span> <span class="keyword1">if</span> select_index <span class="free">n</span> <span class="free">i</span> <span class="bound">j</span> <span class="keyword1">then</span> <span class="free">v</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">j</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span><span class="main">∥</span> <span class="main">=</span> sqrt<span class="main">(</span>prob1 <span class="free">n</span> <span class="free">v</span> <span class="free">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> lessThan_atLeast0 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cpx_vec_length_def prob1_def<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∥</span>col<span class="main">(</span>complex_of_real <span class="main">(</span><span class="main">1</span><span class="main">/</span>sqrt <span class="main">(</span>prob1 <span class="free">n</span> <span class="free">v</span> <span class="free">i</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>m</sub></span> <span class="main">|</span>vec <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">j</span><span class="main">.</span> <span class="keyword1">if</span> select_index <span class="free">n</span> <span class="free">i</span> <span class="bound">j</span> <span class="keyword1">then</span> <span class="free">v</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">j</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span><span class="main">⟩</span><span class="main">)</span> <span class="main">0</span><span class="main">∥</span> <span class="main">=</span> 
           <span class="main">(</span><span class="main">1</span><span class="main">/</span>sqrt<span class="main">(</span>prob1 <span class="free">n</span> <span class="free">v</span> <span class="free">i</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">∥</span>vec <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">j</span><span class="main">.</span> <span class="keyword1">if</span> select_index <span class="free">n</span> <span class="free">i</span> <span class="bound">j</span> <span class="keyword1">then</span> <span class="free">v</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">j</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span><span class="main">∥</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> prob1_geq_zero smult_vec_length_bis
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> real_sqrt_ge_0_iff zero_le_divide_1_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∥</span>col<span class="main">(</span>complex_of_real <span class="main">(</span><span class="main">1</span><span class="main">/</span>sqrt <span class="main">(</span>prob1 <span class="free">n</span> <span class="free">v</span> <span class="free">i</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>m</sub></span> <span class="main">|</span>vec <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">j</span><span class="main">.</span> <span class="keyword1">if</span> select_index <span class="free">n</span> <span class="free">i</span> <span class="bound">j</span> <span class="keyword1">then</span> <span class="free">v</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">j</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span><span class="main">⟩</span><span class="main">)</span> <span class="main">0</span><span class="main">∥</span>
<span class="main">=</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span>sqrt<span class="main">(</span>prob1 <span class="free">n</span> <span class="free">v</span> <span class="free">i</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> sqrt<span class="main">(</span>prob1 <span class="free">n</span> <span class="free">v</span> <span class="free">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> state_def post_meas1_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ket_vec_def post_meas1_def assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The measurement operator below takes a number of qubits n, a state v of a n-qubits system, a number
i corresponding to the index (starting from 0) of one qubit among the n-qubits, and it computes a list 
whose first (resp. second) element is the pair made of the probability that the outcome of the measurement
of the ith qubit is 0 (resp. 1) and the corresponding post-measurement state of the system.
Of course, note that i should be strictly less than n and v should be a state of dimension n, i.e. 
state n v should hold".
›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">meas</span> <span class="main">::</span><span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> complex mat <span class="main">⇒</span> nat <span class="main">⇒</span> <span class="main">_</span>list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">meas</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">≡</span> <span class="main">[</span><span class="main">(</span>prob0 <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">,</span> post_meas0 <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span><span class="main">,</span> <span class="main">(</span>prob1 <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">,</span> post_meas1 <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span><span class="main">]</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
We want to determine the probability that the first n qubits of an n+1 qubit system are 0. 
For this we need to find the indices of the states of the computational basis whose labels do 
not have a 1 at spot $i=0,...,n$.
›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">prob0_fst_qubits</span><span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> complex Matrix.mat <span class="main">⇒</span> real"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">prob0_fst_qubits</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">≡</span> 
<span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="bound">k</span><span class="main">|</span> <span class="bound">k</span><span class="main">::</span>nat<span class="main">.</span> <span class="main">(</span><span class="bound">k</span><span class="main">&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">i</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">}</span><span class="main">.</span> <span class="main">¬</span> select_index <span class="main">(</span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="bound">i</span> <span class="bound">k</span><span class="main">)</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span>cmod<span class="main">(</span><span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">$$</span> <span class="main">(</span><span class="bound">j</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>

<span class="keyword1" id="Measurement-select_index_div_2"><span class="command">lemma</span></span> select_index_div_2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">n</span> <span class="free">i</span> <span class="free">j</span><span class="main">::</span><span class="quoted"><span class="quoted">"nat"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span><span class="main">&lt;</span><span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"select_index <span class="free">n</span> <span class="free">j</span> <span class="main">(</span><span class="free">i</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">=</span> select_index <span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="free">j</span> <span class="free">i</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">-</span>Suc <span class="free">j</span><span class="main">)</span> <span class="main">≤</span> <span class="free">i</span> <span class="keyword1">div</span> <span class="numeral">2</span> <span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="free">j</span><span class="main">)</span> <span class="main">⟹</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="free">j</span><span class="main">)</span> <span class="main">≤</span> <span class="free">i</span> <span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">-</span><span class="free">j</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">a</span></span><span class="main">::</span><span class="quoted">nat</span> <span class="keyword2"><span class="keyword">where</span></span> a0<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> <span class="free">i</span> <span class="keyword1">div</span> <span class="numeral">2</span> <span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="free">j</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">-</span>Suc <span class="free">j</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">a</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span><span class="main">*</span><span class="skolem">a</span> <span class="main">+</span> <span class="free">i</span> <span class="keyword1">mod</span> <span class="numeral">2</span> <span class="main">≥</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="main">(</span>Suc <span class="free">j</span><span class="main">)</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> f0<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="numeral">2</span><span class="main">*</span><span class="skolem">a</span> <span class="main">+</span> <span class="free">i</span> <span class="keyword1">mod</span> <span class="numeral">2</span> <span class="main">≥</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="free">j</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc_diff_Suc Suc_eq_plus1 assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">&lt;</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="free">j</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span><span class="main">*</span><span class="skolem">a</span> <span class="main">+</span> <span class="free">i</span> <span class="keyword1">mod</span> <span class="numeral">2</span> <span class="main">&lt;</span> <span class="numeral">2</span><span class="main">*</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="free">j</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span><span class="main">*</span><span class="skolem">a</span> <span class="main">+</span> <span class="free">i</span> <span class="keyword1">mod</span> <span class="numeral">2</span> <span class="main">&lt;</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="free">j</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> f1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="numeral">2</span><span class="main">*</span><span class="skolem">a</span> <span class="main">+</span> <span class="free">i</span> <span class="keyword1">mod</span> <span class="numeral">2</span> <span class="main">&lt;</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">-</span><span class="free">j</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Nat.add_diff_assoc2 Suc_leD Suc_leI assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">*</span><span class="main">(</span><span class="skolem">a</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="free">j</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="free">i</span> <span class="keyword1">div</span> <span class="numeral">2</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="free">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="free">i</span> <span class="keyword1">mod</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">*</span><span class="skolem">a</span> <span class="main">+</span> <span class="free">i</span> <span class="keyword1">mod</span> <span class="numeral">2</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="free">j</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="free">i</span> <span class="keyword1">div</span> <span class="numeral">2</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="free">j</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">*</span><span class="skolem">a</span> <span class="main">+</span> <span class="free">i</span> <span class="keyword1">mod</span> <span class="numeral">2</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">-</span><span class="free">j</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="free">i</span> <span class="keyword1">div</span> <span class="numeral">2</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="free">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Nat.add_diff_assoc2 Suc_leD Suc_leI assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">-</span><span class="free">j</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">*</span><span class="skolem">a</span> <span class="main">+</span> <span class="free">i</span> <span class="keyword1">mod</span> <span class="numeral">2</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> f1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mod_if mod_mult_self2<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="free">j</span><span class="main">)</span> <span class="main">≤</span> <span class="free">i</span> <span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">-</span><span class="free">j</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> f0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="free">j</span><span class="main">)</span> <span class="main">≤</span> <span class="free">i</span> <span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">-</span><span class="free">j</span><span class="main">)</span> <span class="main">⟹</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">-</span>Suc <span class="free">j</span><span class="main">)</span> <span class="main">≤</span> <span class="free">i</span> <span class="keyword1">div</span> <span class="numeral">2</span> <span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="free">j</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">a</span></span><span class="main">::</span><span class="quoted">nat</span> <span class="keyword2"><span class="keyword">where</span></span> a0<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> <span class="free">i</span> <span class="keyword1">div</span> <span class="numeral">2</span> <span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="free">j</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="free">j</span><span class="main">)</span> <span class="main">≤</span> <span class="free">i</span> <span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">-</span><span class="free">j</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> f0<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="free">j</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">-</span>Suc <span class="free">j</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc_diff_Suc Suc_eq_plus1 assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">&lt;</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="free">j</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span><span class="main">*</span><span class="skolem">a</span> <span class="main">+</span> <span class="free">i</span> <span class="keyword1">mod</span> <span class="numeral">2</span> <span class="main">&lt;</span> <span class="numeral">2</span><span class="main">*</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="free">j</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span><span class="main">*</span><span class="skolem">a</span> <span class="main">+</span> <span class="free">i</span> <span class="keyword1">mod</span> <span class="numeral">2</span> <span class="main">&lt;</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="free">j</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> f1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="numeral">2</span><span class="main">*</span><span class="skolem">a</span> <span class="main">+</span> <span class="free">i</span> <span class="keyword1">mod</span> <span class="numeral">2</span> <span class="main">&lt;</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">-</span><span class="free">j</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Nat.add_diff_assoc2 Suc_leD Suc_leI assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">*</span><span class="main">(</span><span class="skolem">a</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="free">j</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="free">i</span> <span class="keyword1">div</span> <span class="numeral">2</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="free">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="free">i</span> <span class="keyword1">mod</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">*</span><span class="skolem">a</span> <span class="main">+</span> <span class="free">i</span> <span class="keyword1">mod</span> <span class="numeral">2</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="free">j</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="free">i</span> <span class="keyword1">div</span> <span class="numeral">2</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="free">j</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">*</span><span class="skolem">a</span> <span class="main">+</span> <span class="free">i</span> <span class="keyword1">mod</span> <span class="numeral">2</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">-</span><span class="free">j</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="free">i</span> <span class="keyword1">div</span> <span class="numeral">2</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="free">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Nat.add_diff_assoc2 Suc_leD Suc_leI assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">-</span><span class="free">j</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">*</span><span class="skolem">a</span> <span class="main">+</span> <span class="free">i</span> <span class="keyword1">mod</span> <span class="numeral">2</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> f1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mod_if mod_mult_self2<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span><span class="main">*</span><span class="skolem">a</span> <span class="main">+</span> <span class="free">i</span> <span class="keyword1">mod</span> <span class="numeral">2</span> <span class="main">≥</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="free">j</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> a1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="skolem">a</span> <span class="main">+</span> <span class="free">i</span> <span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">)</span> <span class="keyword1">div</span> <span class="numeral">2</span> <span class="main">≥</span> <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">div</span> <span class="numeral">2</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> div_le_mono <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">-</span>Suc <span class="free">j</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f0<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> select_index_def assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Measurement-select_index_suc_even"><span class="command">lemma</span></span> select_index_suc_even<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">n</span> <span class="free">k</span> <span class="free">i</span><span class="main">::</span> <span class="quoted">nat</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">&lt;</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"select_index <span class="free">n</span> <span class="free">i</span> <span class="free">k</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"select_index <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="free">i</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">k</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"select_index <span class="free">n</span> <span class="free">i</span> <span class="free">k</span> <span class="main">=</span> select_index <span class="free">n</span> <span class="free">i</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">k</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> select_index <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="free">i</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">k</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> select_index_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> Suc_eq_plus1 assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> calculation diff_diff_left diff_le_self 
diff_self_eq_0 div_by_1 le_0_eq le_eq_less_or_eq less_imp_diff_less mod_div_trivial mult.left_neutral mult_eq_0_iff mult_le_mono1 not_less plus_1_eq_Suc power_0 semiring_normalization_rules<span class="main"><span class="main">(</span></span>7<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> select_index_div_2 assms<span class="main">(</span>1<span class="main">)</span> select_index_def <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">metis</span> Suc_1 Suc_eq_plus1 Suc_mult_less_cancel1 power_Suc<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"select_index <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="free">i</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">k</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Measurement-select_index_suc_odd"><span class="command">lemma</span></span> select_index_suc_odd<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">n</span> <span class="free">k</span> <span class="free">i</span><span class="main">::</span> <span class="quoted">nat</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">≤</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span> <span class="main">-</span><span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"select_index <span class="free">n</span> <span class="free">i</span> <span class="free">k</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"select_index <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="free">i</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span>Suc <span class="free">n</span> <span class="main">-</span> <span class="free">i</span><span class="main">)</span> <span class="main">≥</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="free">i</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>  
<span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="free">i</span><span class="main">)</span> <span class="main">≥</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="main">1</span><span class="main">-</span><span class="free">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span><span class="main">*</span><span class="free">k</span><span class="main">+</span><span class="main">1</span> <span class="main">&lt;</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> Suc_1 Suc_eq_plus1 Suc_le_lessD Suc_le_mono add_Suc_right distrib_left_numeral le_add_diff_inverse mult_le_mono2 nat_mult_1_right one_le_numeral one_le_power plus_1_eq_Suc power_add power_one_right<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> select_index_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> add_cancel_left_left add_diff_inverse_nat diff_le_self div_by_1 le_antisym less_le_trans less_one mod_div_trivial not_le power_0<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> select_index_div_2<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span><span class="main">*</span><span class="free">k</span><span class="main">+</span><span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span>"</span></span> <span class="quoted"><span class="free">i</span></span><span class="main">]</span> select_index_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Nat.le_diff_conv2 Suc_eq_plus1 Suc_leI assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> diff_Suc_1 less_imp_le less_power_add_imp_div_less one_le_numeral one_le_power power_one_right<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="free">k</span> <span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="free">i</span><span class="main">)</span> <span class="main">≥</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="main">1</span><span class="main">-</span><span class="free">i</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≤</span> Suc <span class="free">n</span> <span class="main">-</span><span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> select_index_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span><span class="main">*</span><span class="free">k</span><span class="main">+</span><span class="main">1</span> <span class="main">≤</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span><span class="main">-</span><span class="main">1</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> Suc_diff_1 Suc_eq_plus1 add_diff_cancel_right' diff_Suc_diff_eq2 diff_diff_left diff_is_0_eq diff_mult_distrib2 le_add2 mult_2 mult_Suc_right plus_1_eq_Suc pos2 power_Suc zero_less_power<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> select_index_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="main">1</span> <span class="main">-</span> <span class="free">i</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">k</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">div</span> <span class="numeral">2</span> <span class="keyword1">mod</span> <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="free">i</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="main">1</span> <span class="main">-</span> <span class="free">i</span><span class="main">)</span> <span class="main">≤</span> <span class="free">k</span> <span class="keyword1">mod</span> <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="free">i</span><span class="main">)</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="free">i</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">k</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span>Suc <span class="free">n</span> <span class="main">-</span> <span class="free">i</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="main">1</span> <span class="main">-</span> <span class="free">i</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">k</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">div</span> <span class="numeral">2</span> <span class="keyword1">mod</span> <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="free">i</span><span class="main">)</span><span class="main">)</span>›</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> diff_Suc_1<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Measurement-aux_range"><span class="command">lemma</span></span> aux_range<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">k</span><span class="main">::</span> <span class="quoted">nat</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">&lt;</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span>Suc <span class="free">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">≥</span> <span class="numeral">2</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">∨</span> <span class="free">k</span> <span class="main">=</span> <span class="numeral">3</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">l</span><span class="main">.</span> <span class="bound">l</span><span class="main">≥</span><span class="numeral">2</span> <span class="main">∧</span> <span class="bound">l</span><span class="main">≤</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">-</span><span class="main">1</span> <span class="main">∧</span> <span class="main">(</span><span class="free">k</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">*</span><span class="bound">l</span> <span class="main">∨</span> <span class="free">k</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">*</span><span class="bound">l</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span> disjCI<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="free">k</span> <span class="main">=</span> <span class="numeral">3</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">l</span></span><span class="main">≥</span><span class="numeral">2</span><span class="main">.</span> <span class="bound">l</span> <span class="main">≤</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span> <span class="main">∧</span> <span class="main">(</span><span class="free">k</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">*</span> <span class="bound">l</span> <span class="main">∨</span> <span class="free">k</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">*</span> <span class="bound">l</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">&gt;</span> <span class="numeral">3</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">l</span></span><span class="main">≥</span><span class="numeral">2</span><span class="main">.</span> <span class="bound">l</span> <span class="main">≤</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span> <span class="main">∧</span> <span class="main">(</span><span class="free">k</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">*</span> <span class="bound">l</span> <span class="main">∨</span> <span class="free">k</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">*</span> <span class="bound">l</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> asm<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">&gt;</span> <span class="numeral">3</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"even <span class="free">k</span> <span class="main">∨</span> odd <span class="free">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">l</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">*</span><span class="skolem">l</span> <span class="main">∨</span> <span class="free">k</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">*</span><span class="skolem">l</span><span class="main">+</span><span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> evenE oddE<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">≥</span> <span class="numeral">2</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> asm calculation <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">≤</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc_diff_1 Suc_eq_plus1 calculation<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> dvd_triv_left even_Suc_div_two less_Suc_eq_le less_power_add_imp_div_less nonzero_mult_div_cancel_left pos2 power_one_right zero_less_power zero_neq_numeral<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">l</span></span><span class="main">≥</span><span class="numeral">2</span><span class="main">.</span> <span class="bound">l</span> <span class="main">≤</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span> <span class="main">∧</span> <span class="main">(</span><span class="free">k</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">*</span> <span class="bound">l</span> <span class="main">∨</span> <span class="free">k</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">*</span> <span class="bound">l</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">≤</span> <span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="main">(</span><span class="free">k</span> <span class="main">=</span> <span class="numeral">3</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">l</span></span><span class="main">≥</span><span class="numeral">2</span><span class="main">.</span> <span class="bound">l</span> <span class="main">≤</span> <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span> <span class="main">∧</span> <span class="main">(</span><span class="free">k</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">*</span> <span class="bound">l</span> <span class="main">∨</span> <span class="free">k</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">*</span> <span class="bound">l</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>›</span></span> less_Suc_eq_le <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">=</span> <span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Measurement-select_index_with_1"><span class="command">lemma</span></span> select_index_with_1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">n</span><span class="main">::</span> <span class="quoted">nat</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≥</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">k</span><span class="main">.</span> <span class="bound">k</span> <span class="main">&lt;</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">⟶</span> <span class="bound">k</span> <span class="main">≥</span> <span class="numeral">2</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> select_index <span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="bound">i</span> <span class="bound">k</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span> nat_induct_at_least<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">k</span></span><span class="main">&lt;</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="main">1</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">.</span> <span class="numeral">2</span> <span class="main">≤</span> <span class="bound">k</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span><span class="main">1</span><span class="main">.</span> select_index <span class="main">(</span><span class="main">1</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="bound">i</span> <span class="bound">k</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"select_index <span class="numeral">2</span> <span class="main">0</span> <span class="numeral">2</span> <span class="main">=</span> True"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> select_index_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"select_index <span class="numeral">2</span> <span class="main">0</span> <span class="numeral">3</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> select_index_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc_leI add_Suc_shift le_eq_less_or_eq mult_2 not_less one_add_one one_plus_numeral 
plus_1_eq_Suc power.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> power_one_right semiring_norm<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> zero_less_one_class.zero_less_one<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="main">1</span> <span class="main">≤</span> <span class="bound">n</span> <span class="main">⟹</span>
         <span class="main">∀</span><span class="bound"><span class="bound">k</span></span> <span class="main">&lt;</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="bound">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">.</span> <span class="numeral">2</span> <span class="main">≤</span> <span class="bound">k</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span><span class="bound">n</span><span class="main">.</span> select_index <span class="main">(</span><span class="bound">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="bound">i</span> <span class="bound">k</span><span class="main">)</span> <span class="main">⟹</span>
         <span class="main">∀</span><span class="bound"><span class="bound">k</span></span> <span class="main">&lt;</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span>Suc <span class="bound">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">.</span> <span class="numeral">2</span> <span class="main">≤</span> <span class="bound">k</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span>Suc <span class="bound">n</span><span class="main">.</span> select_index <span class="main">(</span>Suc <span class="bound">n</span> <span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="bound">i</span> <span class="bound">k</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span><span class="main">::</span> <span class="quoted">nat</span>
    <span class="keyword3"><span class="command">assume</span></span> asm<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">≥</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> IH<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">k</span></span> <span class="main">&lt;</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="skolem">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">.</span> <span class="numeral">2</span> <span class="main">≤</span> <span class="bound">k</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span><span class="skolem">n</span><span class="main">.</span> select_index <span class="main">(</span><span class="skolem">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="bound">i</span> <span class="bound">k</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"select_index <span class="main">(</span>Suc <span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="skolem">n</span> <span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"select_index <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="skolem">n</span> <span class="main">1</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> select_index_def <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">smt</span> Suc_1 Suc_diff_Suc Suc_lessI add_diff_cancel_right' diff_Suc_1 
diff_commute diff_zero le_eq_less_or_eq less_Suc_eq_le nat.simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> nat_power_eq_Suc_0_iff 
one_mod_two_eq_one plus_1_eq_Suc power_one_right zero_less_power<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
        <span class="keyword1"><span class="command">using</span></span> select_index_suc_even <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc_eq_plus1 less_numeral_extra<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> mult_2 not_less_less_Suc_eq one_add_one one_less_power zero_less_Suc<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"select_index <span class="main">(</span>Suc <span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="skolem">n</span> <span class="numeral">3</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"select_index <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="skolem">n</span> <span class="main">1</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> select_index_def <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">smt</span> Suc_1 Suc_diff_Suc Suc_lessI add_diff_cancel_right' diff_Suc_1 
diff_commute diff_zero le_eq_less_or_eq less_Suc_eq_le nat.simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> nat_power_eq_Suc_0_iff 
one_mod_two_eq_one plus_1_eq_Suc power_one_right zero_less_power<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
        <span class="keyword1"><span class="command">using</span></span> select_index_suc_odd <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> One_nat_def Suc_eq_plus1 mult_2 numeral_3_eq_3 select_index_def<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span>Suc <span class="skolem">n</span><span class="main">.</span> select_index <span class="main">(</span>Suc <span class="skolem">n</span> <span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="bound">i</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="skolem">k</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">≥</span> <span class="numeral">2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">≤</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">-</span><span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span><span class="main">::</span> <span class="quoted">nat</span>
    <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span><span class="main">&lt;</span><span class="skolem">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"select_index <span class="main">(</span><span class="skolem">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="skolem">i</span> <span class="skolem">k</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> IH <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">metis</span> One_nat_def Suc_diff_Suc <span class="quoted"><span class="quoted">‹<span class="numeral">2</span> <span class="main">≤</span> <span class="skolem">k</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">k</span> <span class="main">≤</span> <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span>›</span></span> diff_zero le_imp_less_Suc pos2 zero_less_power<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"select_index <span class="main">(</span>Suc <span class="skolem">n</span> <span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="skolem">i</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="skolem">k</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> select_index_suc_even
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> One_nat_def Suc_diff_Suc add.commute diff_zero le_imp_less_Suc plus_1_eq_Suc pos2 that<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> zero_less_power<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">&lt;</span> <span class="skolem">n</span>›</span></span> less_SucI <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span>Suc <span class="skolem">n</span><span class="main">.</span> select_index <span class="main">(</span>Suc <span class="skolem">n</span> <span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="bound">i</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="skolem">k</span> <span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">≥</span> <span class="numeral">2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">≤</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">-</span><span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span><span class="main">::</span> <span class="quoted">nat</span>
    <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span><span class="main">&lt;</span><span class="skolem">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"select_index <span class="main">(</span><span class="skolem">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="skolem">i</span> <span class="skolem">k</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> IH <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">metis</span> One_nat_def Suc_diff_Suc <span class="quoted"><span class="quoted">‹<span class="numeral">2</span> <span class="main">≤</span> <span class="skolem">k</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">k</span> <span class="main">≤</span> <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span>›</span></span> diff_zero le_imp_less_Suc pos2 zero_less_power<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"select_index <span class="main">(</span>Suc <span class="skolem">n</span> <span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="skolem">i</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="skolem">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> select_index_suc_odd that<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">&lt;</span> <span class="skolem">n</span>›</span></span> less_SucI <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">k</span></span><span class="main">&lt;</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span>Suc <span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">.</span> <span class="numeral">2</span> <span class="main">≤</span> <span class="bound">k</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span>Suc <span class="skolem">n</span><span class="main">.</span> select_index <span class="main">(</span>Suc <span class="skolem">n</span> <span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="bound">i</span> <span class="bound">k</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> aux_range <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> lessI<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Measurement-prob0_fst_qubits_index"><span class="command">lemma</span></span> prob0_fst_qubits_index<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">n</span><span class="main">::</span> <span class="quoted">nat</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">v</span><span class="main">::</span> <span class="quoted"><span class="quoted">"complex Matrix.mat"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">k</span><span class="main">|</span> <span class="bound">k</span><span class="main">::</span>nat<span class="main">.</span> <span class="main">(</span><span class="bound">k</span><span class="main">&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">i</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">}</span><span class="main">.</span> <span class="main">¬</span> select_index <span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="bound">i</span> <span class="bound">k</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">k</span> <span class="main">|</span><span class="bound">k</span><span class="main">.</span> <span class="bound">k</span> <span class="main">&lt;</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="main">0</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">i</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="main">0</span><span class="main">}</span><span class="main">.</span> <span class="main">¬</span> select_index <span class="main">(</span><span class="main">0</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="bound">i</span> <span class="bound">k</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="main">{</span><span class="bound">k</span> <span class="main">|</span><span class="bound">k</span><span class="main">.</span> <span class="bound">k</span> <span class="main">&lt;</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="bound">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">i</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="bound">n</span><span class="main">}</span><span class="main">.</span> <span class="main">¬</span> select_index <span class="main">(</span><span class="bound">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="bound">i</span> <span class="bound">k</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">}</span> <span class="main">⟹</span>
         <span class="main">{</span><span class="bound">k</span> <span class="main">|</span><span class="bound">k</span><span class="main">.</span> <span class="bound">k</span> <span class="main">&lt;</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span>Suc <span class="bound">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">i</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="bound">n</span><span class="main">}</span><span class="main">.</span> <span class="main">¬</span> select_index <span class="main">(</span>Suc <span class="bound">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="bound">i</span> <span class="bound">k</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span>
         <span class="main">{</span><span class="main">0</span><span class="main">,</span> <span class="main">1</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span>
    <span class="keyword3"><span class="command">assume</span></span> IH<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">k</span> <span class="main">|</span><span class="bound">k</span><span class="main">.</span> <span class="bound">k</span> <span class="main">&lt;</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="skolem">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">i</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="skolem">n</span><span class="main">}</span><span class="main">.</span> <span class="main">¬</span> select_index <span class="main">(</span><span class="skolem">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="bound">i</span> <span class="bound">k</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound">k</span> <span class="main">|</span><span class="bound">k</span><span class="main">.</span> <span class="bound">k</span> <span class="main">&lt;</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span>Suc <span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">i</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="skolem">n</span><span class="main">}</span><span class="main">.</span> <span class="main">¬</span> select_index <span class="main">(</span>Suc <span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="bound">i</span> <span class="bound">k</span><span class="main">)</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">&lt;</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="skolem">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">⟶</span> <span class="skolem">k</span> <span class="main">&lt;</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span>Suc <span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span><span class="main">::</span><span class="quoted">nat</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">i</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="skolem">n</span><span class="main">}</span><span class="main">.</span> <span class="main">¬</span> select_index <span class="main">(</span><span class="skolem">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="bound">i</span> <span class="main">0</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">i</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="skolem">n</span><span class="main">}</span><span class="main">.</span> <span class="main">¬</span> select_index <span class="main">(</span><span class="skolem">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="bound">i</span> <span class="main">1</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> IH <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">i</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="skolem">n</span><span class="main">}</span><span class="main">.</span> <span class="main">¬</span> select_index <span class="main">(</span>Suc <span class="skolem">n</span> <span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="bound">i</span> <span class="main">0</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">i</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="skolem">n</span><span class="main">}</span><span class="main">.</span> <span class="main">¬</span> select_index <span class="main">(</span>Suc <span class="skolem">n</span> <span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="bound">i</span> <span class="main">1</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> select_index_suc_odd<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">0</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">+</span><span class="main">1</span>"</span></span><span class="main">]</span> Suc_eq_plus1
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> One_nat_def Suc_1 add_Suc_shift add_diff_cancel_right' atLeastLessThan_iff diff_diff_cancel 
le_eq_less_or_eq less_Suc_eq linorder_not_le mod_less nat_power_eq_Suc_0_iff select_index_def zero_less_power<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"select_index <span class="main">(</span>Suc <span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="skolem">n</span> <span class="main">0</span> <span class="main">=</span> False"</span></span> <span class="keyword1"><span class="command">using</span></span> select_index_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"select_index <span class="main">(</span>Suc <span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="skolem">n</span> <span class="main">1</span> <span class="main">=</span> False"</span></span> <span class="keyword1"><span class="command">using</span></span> select_index_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> One_nat_def Suc_1 Suc_eq_plus1 Suc_lessI atLeast0_lessThan_Suc empty_iff insertE 
mem_Collect_eq nat.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> nat_power_eq_Suc_0_iff pos2 subsetI zero_less_power<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">k</span> <span class="main">|</span><span class="bound">k</span><span class="main">.</span> <span class="bound">k</span> <span class="main">&lt;</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span>Suc <span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">i</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="skolem">n</span><span class="main">}</span><span class="main">.</span> <span class="main">¬</span> select_index <span class="main">(</span>Suc <span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="bound">i</span> <span class="bound">k</span><span class="main">)</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">k</span></span><span class="main">&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span>Suc <span class="skolem">n</span> <span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">.</span> <span class="bound">k</span> <span class="main">≥</span> <span class="numeral">2</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span>Suc <span class="skolem">n</span><span class="main">.</span> <span class="main">¬</span> select_index <span class="main">(</span>Suc <span class="skolem">n</span> <span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="bound">i</span> <span class="bound">k</span> <span class="main">=</span> False<span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> select_index_with_1<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">n</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc_eq_plus1 add.commute le_add1<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">k</span> <span class="main">|</span><span class="bound">k</span><span class="main">.</span> <span class="bound">k</span><span class="main">&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span>Suc <span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">i</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="skolem">n</span><span class="main">}</span><span class="main">.</span> <span class="main">¬</span> select_index <span class="main">(</span>Suc <span class="skolem">n</span> <span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="bound">i</span> <span class="bound">k</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Measurement-prob0_fst_qubits_eq"><span class="command">lemma</span></span> prob0_fst_qubits_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">n</span><span class="main">::</span> <span class="quoted">nat</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"prob0_fst_qubits <span class="free">n</span> <span class="free">v</span> <span class="main">=</span> <span class="main">(</span>cmod<span class="main">(</span><span class="free">v</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="main">(</span>cmod<span class="main">(</span><span class="free">v</span> <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prob0_fst_qubits <span class="free">n</span> <span class="free">v</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="bound">k</span><span class="main">|</span> <span class="bound">k</span><span class="main">::</span>nat<span class="main">.</span> <span class="main">(</span><span class="bound">k</span><span class="main">&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">i</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">}</span><span class="main">.</span> <span class="main">¬</span> select_index <span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="bound">i</span> <span class="bound">k</span><span class="main">)</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span>cmod<span class="main">(</span><span class="free">v</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">j</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> prob0_fst_qubits_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span>cmod<span class="main">(</span><span class="free">v</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">j</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> prob0_fst_qubits_index <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(* Below in iter_post_meas0, the first argument n corresponds to the number of qubits of the system
, and the second argument m corresponds to the number of qubits that have been measured. *)</span>
<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">iter_post_meas0</span><span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> nat <span class="main">⇒</span> complex Matrix.mat <span class="main">⇒</span> complex Matrix.mat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">iter_post_meas0</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">0</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">iter_post_meas0</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">=</span> post_meas0 <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">(</span><span class="free">iter_post_meas0</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span>"</span></span>

<span class="comment1">(* iter_prob0 outputs the probability that successive measurements of the first m qubits
(out of n qubits in the system) give m zeros. *)</span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">iter_prob0</span><span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> nat <span class="main">⇒</span> complex Matrix.mat <span class="main">⇒</span> real"</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free">iter_prob0</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">i</span><span class="main">&lt;</span><span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">.</span> prob0 <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">(</span>iter_post_meas0 <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="bound">i</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span> <span class="bound">i</span><span class="main">)</span>"</span></span>

<span class="comment1">(* To do:
lemma iter_prob0_eq:
  fixes n:: nat and v:: "complex Matrix.mat"
  assumes "n ≥ 1"
  shows "iter_prob0 (Suc n) n v = prob0_fst_qubits n v"
*)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Measurements with Bell States›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
A Bell state is a remarkable state. Indeed, if one makes one measure, either of the first or the second 
qubit, then one gets either $0$ with probability $1/2$ or $1$ with probability $1/2$. Moreover, in the case of 
two successive measurements of the first and second qubit, the outcomes are correlated. 
Indeed, in the case of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">"|β<span class="hidden">⇩</span><sub>0</sub><span class="hidden">⇩</span><sub>0</sub>⟩"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> or <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">"|β<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>0</sub>⟩"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> (resp. <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">"|β<span class="hidden">⇩</span><sub>0</sub><span class="hidden">⇩</span><sub>1</sub>⟩"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> or <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">"|β<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>1</sub>⟩"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>) if 
one measures the second qubit after a measurement of the first qubit (or the other way around) then 
one gets the same outcomes (resp. opposite outcomes), i.e. for instance the probability of measuring 
$0$ for the second qubit after a measure with outcome $0$ for the first qubit is $1$ (resp. $0$).
›</span></span>

<span class="keyword1" id="Measurement-prob0_bell_fst"><span class="command">lemma</span></span> prob0_bell_fst <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">=</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>0</sub><span class="hidden">⇩</span><sub>0</sub>⟩</span> <span class="main">∨</span> <span class="free">v</span> <span class="main">=</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>0</sub><span class="hidden">⇩</span><sub>1</sub>⟩</span> <span class="main">∨</span> <span class="free">v</span> <span class="main">=</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>0</sub>⟩</span> <span class="main">∨</span> <span class="free">v</span> <span class="main">=</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>1</sub>⟩</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"prob0 <span class="numeral">2</span> <span class="free">v</span> <span class="main">0</span> <span class="main">=</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> set_0 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">k</span><span class="main">|</span> <span class="bound">k</span><span class="main">::</span>nat<span class="main">.</span> <span class="main">(</span><span class="bound">k</span><span class="main">&lt;</span><span class="numeral">4</span><span class="main">)</span> <span class="main">∧</span> <span class="main">¬</span> select_index <span class="numeral">2</span> <span class="main">0</span> <span class="bound">k</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> select_index_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">=</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>0</sub><span class="hidden">⇩</span><sub>0</sub>⟩</span> <span class="main">⟹</span> prob0 <span class="numeral">2</span> <span class="free">v</span> <span class="main">0</span> <span class="main">=</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">v</span> <span class="keyword3"><span class="command">assume</span></span> asm<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">=</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>0</sub><span class="hidden">⇩</span><sub>0</sub>⟩</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"prob0 <span class="numeral">2</span> <span class="skolem">v</span> <span class="main">0</span> <span class="main">=</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prob0 <span class="numeral">2</span> <span class="skolem">v</span> <span class="main">0</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="bound">k</span><span class="main">|</span> <span class="bound">k</span><span class="main">::</span>nat<span class="main">.</span> <span class="main">(</span><span class="bound">k</span><span class="main">&lt;</span><span class="numeral">4</span><span class="main">)</span> <span class="main">∧</span> <span class="main">¬</span> select_index <span class="numeral">2</span> <span class="main">0</span> <span class="bound">k</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span>cmod<span class="main">(</span>bell00 <span class="main">$$</span> <span class="main">(</span><span class="bound">j</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> prob0_def asm<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span>cmod<span class="main">(</span>bell00 <span class="main">$$</span> <span class="main">(</span><span class="bound">j</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> set_0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span>cmod<span class="main">(</span><span class="main">1</span><span class="main">/</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="main">(</span>cmod<span class="main">(</span><span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> bell00_def ket_vec_def<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span>  <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cmod_def power_divide<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">=</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>0</sub><span class="hidden">⇩</span><sub>1</sub>⟩</span> <span class="main">⟹</span> prob0 <span class="numeral">2</span> <span class="free">v</span> <span class="main">0</span> <span class="main">=</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">v</span> <span class="keyword3"><span class="command">assume</span></span> asm<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">=</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>0</sub><span class="hidden">⇩</span><sub>1</sub>⟩</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"prob0 <span class="numeral">2</span> <span class="skolem">v</span> <span class="main">0</span> <span class="main">=</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prob0 <span class="numeral">2</span> <span class="skolem">v</span> <span class="main">0</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="bound">k</span><span class="main">|</span> <span class="bound">k</span><span class="main">::</span>nat<span class="main">.</span> <span class="main">(</span><span class="bound">k</span><span class="main">&lt;</span><span class="numeral">4</span><span class="main">)</span> <span class="main">∧</span> <span class="main">¬</span> select_index <span class="numeral">2</span> <span class="main">0</span> <span class="bound">k</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span>cmod<span class="main">(</span>bell01 <span class="main">$$</span> <span class="main">(</span><span class="bound">j</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> prob0_def asm<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span>cmod<span class="main">(</span>bell01 <span class="main">$$</span> <span class="main">(</span><span class="bound">j</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> set_0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span>cmod<span class="main">(</span><span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="main">(</span>cmod<span class="main">(</span><span class="main">1</span><span class="main">/</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> bell01_def ket_vec_def<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cmod_def power_divide<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">=</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>0</sub>⟩</span> <span class="main">⟹</span> prob0 <span class="numeral">2</span> <span class="free">v</span> <span class="main">0</span> <span class="main">=</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">v</span> <span class="keyword3"><span class="command">assume</span></span> asm<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">=</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>0</sub>⟩</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"prob0 <span class="numeral">2</span> <span class="skolem">v</span> <span class="main">0</span> <span class="main">=</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prob0 <span class="numeral">2</span> <span class="skolem">v</span> <span class="main">0</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="bound">k</span><span class="main">|</span> <span class="bound">k</span><span class="main">::</span>nat<span class="main">.</span> <span class="main">(</span><span class="bound">k</span><span class="main">&lt;</span><span class="numeral">4</span><span class="main">)</span> <span class="main">∧</span> <span class="main">¬</span> select_index <span class="numeral">2</span> <span class="main">0</span> <span class="bound">k</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span>cmod<span class="main">(</span>bell10 <span class="main">$$</span> <span class="main">(</span><span class="bound">j</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> prob0_def asm<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span>cmod<span class="main">(</span>bell10 <span class="main">$$</span> <span class="main">(</span><span class="bound">j</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> set_0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span>cmod<span class="main">(</span><span class="main">1</span><span class="main">/</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="main">(</span>cmod<span class="main">(</span><span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> bell10_def ket_vec_def<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cmod_def power_divide<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">=</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>1</sub>⟩</span> <span class="main">⟹</span> prob0 <span class="numeral">2</span> <span class="free">v</span> <span class="main">0</span> <span class="main">=</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">v</span> <span class="keyword3"><span class="command">assume</span></span> asm<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">=</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>1</sub>⟩</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"prob0 <span class="numeral">2</span> <span class="skolem">v</span> <span class="main">0</span> <span class="main">=</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prob0 <span class="numeral">2</span> <span class="skolem">v</span> <span class="main">0</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="bound">k</span><span class="main">|</span> <span class="bound">k</span><span class="main">::</span>nat<span class="main">.</span> <span class="main">(</span><span class="bound">k</span><span class="main">&lt;</span><span class="numeral">4</span><span class="main">)</span> <span class="main">∧</span> <span class="main">¬</span> select_index <span class="numeral">2</span> <span class="main">0</span> <span class="bound">k</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span>cmod<span class="main">(</span>bell11 <span class="main">$$</span> <span class="main">(</span><span class="bound">j</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> prob0_def asm<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span>cmod<span class="main">(</span>bell11 <span class="main">$$</span> <span class="main">(</span><span class="bound">j</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> set_0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span>cmod<span class="main">(</span><span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="main">(</span>cmod<span class="main">(</span><span class="main">1</span><span class="main">/</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> bell11_def ket_vec_def<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cmod_def power_divide<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Measurement-prob_1_bell_fst"><span class="command">lemma</span></span> prob_1_bell_fst <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">=</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>0</sub><span class="hidden">⇩</span><sub>0</sub>⟩</span> <span class="main">∨</span> <span class="free">v</span> <span class="main">=</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>0</sub><span class="hidden">⇩</span><sub>1</sub>⟩</span> <span class="main">∨</span> <span class="free">v</span> <span class="main">=</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>0</sub>⟩</span> <span class="main">∨</span> <span class="free">v</span> <span class="main">=</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>1</sub>⟩</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"prob1 <span class="numeral">2</span> <span class="free">v</span> <span class="main">0</span> <span class="main">=</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> set_0 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">k</span><span class="main">|</span> <span class="bound">k</span><span class="main">::</span>nat<span class="main">.</span> select_index <span class="numeral">2</span> <span class="main">0</span> <span class="bound">k</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> select_index_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">=</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>0</sub><span class="hidden">⇩</span><sub>0</sub>⟩</span> <span class="main">⟹</span> prob1 <span class="numeral">2</span> <span class="free">v</span> <span class="main">0</span> <span class="main">=</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">v</span> <span class="keyword3"><span class="command">assume</span></span> asm<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">=</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>0</sub><span class="hidden">⇩</span><sub>0</sub>⟩</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"prob1 <span class="numeral">2</span> <span class="skolem">v</span> <span class="main">0</span> <span class="main">=</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prob1 <span class="numeral">2</span> <span class="skolem">v</span> <span class="main">0</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="bound">k</span><span class="main">|</span> <span class="bound">k</span><span class="main">::</span>nat<span class="main">.</span> select_index <span class="numeral">2</span> <span class="main">0</span> <span class="bound">k</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span>cmod<span class="main">(</span>bell00 <span class="main">$$</span> <span class="main">(</span><span class="bound">j</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> prob1_def asm<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span>cmod<span class="main">(</span>bell00 <span class="main">$$</span> <span class="main">(</span><span class="bound">j</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> set_0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span>cmod<span class="main">(</span><span class="main">1</span><span class="main">/</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="main">(</span>cmod<span class="main">(</span><span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> bell00_def ket_vec_def<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cmod_def power_divide<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">=</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>0</sub><span class="hidden">⇩</span><sub>1</sub>⟩</span> <span class="main">⟹</span> prob1 <span class="numeral">2</span> <span class="free">v</span> <span class="main">0</span> <span class="main">=</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">v</span> <span class="keyword3"><span class="command">assume</span></span> asm<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">=</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>0</sub><span class="hidden">⇩</span><sub>1</sub>⟩</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"prob1 <span class="numeral">2</span> <span class="skolem">v</span> <span class="main">0</span> <span class="main">=</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prob1 <span class="numeral">2</span> <span class="skolem">v</span> <span class="main">0</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="bound">k</span><span class="main">|</span> <span class="bound">k</span><span class="main">::</span>nat<span class="main">.</span> select_index <span class="numeral">2</span> <span class="main">0</span> <span class="bound">k</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span>cmod<span class="main">(</span>bell01 <span class="main">$$</span> <span class="main">(</span><span class="bound">j</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> prob1_def asm<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span>cmod<span class="main">(</span>bell01 <span class="main">$$</span> <span class="main">(</span><span class="bound">j</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> set_0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span>cmod<span class="main">(</span><span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="main">(</span>cmod<span class="main">(</span><span class="main">1</span><span class="main">/</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> bell01_def ket_vec_def<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cmod_def power_divide<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">=</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>0</sub>⟩</span> <span class="main">⟹</span> prob1 <span class="numeral">2</span> <span class="free">v</span> <span class="main">0</span> <span class="main">=</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">v</span> <span class="keyword3"><span class="command">assume</span></span> asm<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">=</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>0</sub>⟩</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"prob1 <span class="numeral">2</span> <span class="skolem">v</span> <span class="main">0</span> <span class="main">=</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prob1 <span class="numeral">2</span> <span class="skolem">v</span> <span class="main">0</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="bound">k</span><span class="main">|</span> <span class="bound">k</span><span class="main">::</span>nat<span class="main">.</span> select_index <span class="numeral">2</span> <span class="main">0</span> <span class="bound">k</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span>cmod<span class="main">(</span>bell10 <span class="main">$$</span> <span class="main">(</span><span class="bound">j</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> prob1_def asm<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span>cmod<span class="main">(</span>bell10 <span class="main">$$</span> <span class="main">(</span><span class="bound">j</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> set_0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span>cmod<span class="main">(</span><span class="main">1</span><span class="main">/</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="main">(</span>cmod<span class="main">(</span><span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> bell10_def ket_vec_def<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cmod_def power_divide<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">=</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>1</sub>⟩</span> <span class="main">⟹</span> prob1 <span class="numeral">2</span> <span class="free">v</span> <span class="main">0</span> <span class="main">=</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">v</span> <span class="keyword3"><span class="command">assume</span></span> asm<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">=</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>1</sub>⟩</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"prob1 <span class="numeral">2</span> <span class="skolem">v</span> <span class="main">0</span> <span class="main">=</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prob1 <span class="numeral">2</span> <span class="skolem">v</span> <span class="main">0</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="bound">k</span><span class="main">|</span> <span class="bound">k</span><span class="main">::</span>nat<span class="main">.</span> select_index <span class="numeral">2</span> <span class="main">0</span> <span class="bound">k</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span>cmod<span class="main">(</span>bell11 <span class="main">$$</span> <span class="main">(</span><span class="bound">j</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> prob1_def asm<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span>cmod<span class="main">(</span>bell11 <span class="main">$$</span> <span class="main">(</span><span class="bound">j</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> set_0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span>cmod<span class="main">(</span><span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="main">(</span>cmod<span class="main">(</span><span class="main">1</span><span class="main">/</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> bell11_def ket_vec_def<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cmod_def power_divide<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Measurement-prob0_bell_snd"><span class="command">lemma</span></span> prob0_bell_snd <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">=</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>0</sub><span class="hidden">⇩</span><sub>0</sub>⟩</span> <span class="main">∨</span> <span class="free">v</span> <span class="main">=</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>0</sub><span class="hidden">⇩</span><sub>1</sub>⟩</span> <span class="main">∨</span> <span class="free">v</span> <span class="main">=</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>0</sub>⟩</span> <span class="main">∨</span> <span class="free">v</span> <span class="main">=</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>1</sub>⟩</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"prob0 <span class="numeral">2</span> <span class="free">v</span> <span class="main">1</span> <span class="main">=</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> set_0 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">k</span><span class="main">|</span> <span class="bound">k</span><span class="main">::</span>nat<span class="main">.</span> <span class="main">(</span><span class="bound">k</span><span class="main">&lt;</span><span class="numeral">4</span><span class="main">)</span> <span class="main">∧</span> <span class="main">¬</span> select_index <span class="numeral">2</span> <span class="main">1</span> <span class="bound">k</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="main">0</span><span class="main">,</span><span class="numeral">2</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> select_index_def<span class="main">)</span>
      <span class="main">(</span><span class="operator">metis</span> Suc_le_mono add_Suc add_Suc_right le_numeral_extra<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> less_antisym mod_Suc_eq mod_less 
        neq0_conv not_mod2_eq_Suc_0_eq_0 numeral_2_eq_2 numeral_Bit0 one_add_one one_mod_two_eq_one one_neq_zero<span class="main">)</span> 
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">=</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>0</sub><span class="hidden">⇩</span><sub>0</sub>⟩</span> <span class="main">⟹</span> prob0 <span class="numeral">2</span> <span class="free">v</span> <span class="main">1</span> <span class="main">=</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">v</span> <span class="keyword3"><span class="command">assume</span></span> asm<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">=</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>0</sub><span class="hidden">⇩</span><sub>0</sub>⟩</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"prob0 <span class="numeral">2</span> <span class="skolem">v</span> <span class="main">1</span> <span class="main">=</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prob0 <span class="numeral">2</span> <span class="skolem">v</span> <span class="main">1</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="bound">k</span><span class="main">|</span> <span class="bound">k</span><span class="main">::</span>nat<span class="main">.</span> <span class="main">(</span><span class="bound">k</span><span class="main">&lt;</span><span class="numeral">4</span><span class="main">)</span> <span class="main">∧</span> <span class="main">¬</span> select_index <span class="numeral">2</span> <span class="main">1</span> <span class="bound">k</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span>cmod<span class="main">(</span>bell00 <span class="main">$$</span> <span class="main">(</span><span class="bound">j</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> prob0_def asm<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">,</span><span class="numeral">2</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span>cmod<span class="main">(</span>bell00 <span class="main">$$</span> <span class="main">(</span><span class="bound">j</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> set_0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span>cmod<span class="main">(</span><span class="main">1</span><span class="main">/</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="main">(</span>cmod<span class="main">(</span><span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> bell00_def ket_vec_def<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cmod_def power_divide<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">=</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>0</sub><span class="hidden">⇩</span><sub>1</sub>⟩</span> <span class="main">⟹</span> prob0 <span class="numeral">2</span> <span class="free">v</span> <span class="main">1</span> <span class="main">=</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">v</span> <span class="keyword3"><span class="command">assume</span></span> asm<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">=</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>0</sub><span class="hidden">⇩</span><sub>1</sub>⟩</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"prob0 <span class="numeral">2</span> <span class="skolem">v</span> <span class="main">1</span> <span class="main">=</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prob0 <span class="numeral">2</span> <span class="skolem">v</span> <span class="main">1</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="bound">k</span><span class="main">|</span> <span class="bound">k</span><span class="main">::</span>nat<span class="main">.</span> <span class="main">(</span><span class="bound">k</span><span class="main">&lt;</span><span class="numeral">4</span><span class="main">)</span> <span class="main">∧</span> <span class="main">¬</span> select_index <span class="numeral">2</span> <span class="main">1</span> <span class="bound">k</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span>cmod<span class="main">(</span>bell01 <span class="main">$$</span> <span class="main">(</span><span class="bound">j</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> prob0_def asm<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">,</span><span class="numeral">2</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span>cmod<span class="main">(</span>bell01 <span class="main">$$</span> <span class="main">(</span><span class="bound">j</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> set_0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span>cmod<span class="main">(</span><span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="main">(</span>cmod<span class="main">(</span><span class="main">1</span><span class="main">/</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> bell01_def ket_vec_def<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cmod_def power_divide<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">=</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>0</sub>⟩</span> <span class="main">⟹</span> prob0 <span class="numeral">2</span> <span class="free">v</span> <span class="main">1</span> <span class="main">=</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">v</span> <span class="keyword3"><span class="command">assume</span></span> asm<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">=</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>0</sub>⟩</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"prob0 <span class="numeral">2</span> <span class="skolem">v</span> <span class="main">1</span> <span class="main">=</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prob0 <span class="numeral">2</span> <span class="skolem">v</span> <span class="main">1</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="bound">k</span><span class="main">|</span> <span class="bound">k</span><span class="main">::</span>nat<span class="main">.</span> <span class="main">(</span><span class="bound">k</span><span class="main">&lt;</span><span class="numeral">4</span><span class="main">)</span> <span class="main">∧</span> <span class="main">¬</span> select_index <span class="numeral">2</span> <span class="main">1</span> <span class="bound">k</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span>cmod<span class="main">(</span>bell10 <span class="main">$$</span> <span class="main">(</span><span class="bound">j</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> prob0_def asm<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">,</span><span class="numeral">2</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span>cmod<span class="main">(</span>bell10 <span class="main">$$</span> <span class="main">(</span><span class="bound">j</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> set_0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span>cmod<span class="main">(</span><span class="main">1</span><span class="main">/</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="main">(</span>cmod<span class="main">(</span><span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> bell10_def ket_vec_def<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cmod_def power_divide<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">=</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>1</sub>⟩</span> <span class="main">⟹</span> prob0 <span class="numeral">2</span> <span class="free">v</span> <span class="main">1</span> <span class="main">=</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">v</span> <span class="keyword3"><span class="command">assume</span></span> asm<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">=</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>1</sub>⟩</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"prob0 <span class="numeral">2</span> <span class="skolem">v</span> <span class="main">1</span> <span class="main">=</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prob0 <span class="numeral">2</span> <span class="skolem">v</span> <span class="main">1</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="bound">k</span><span class="main">|</span> <span class="bound">k</span><span class="main">::</span>nat<span class="main">.</span> <span class="main">(</span><span class="bound">k</span><span class="main">&lt;</span><span class="numeral">4</span><span class="main">)</span> <span class="main">∧</span> <span class="main">¬</span> select_index <span class="numeral">2</span> <span class="main">1</span> <span class="bound">k</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span>cmod<span class="main">(</span>bell11 <span class="main">$$</span> <span class="main">(</span><span class="bound">j</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> prob0_def asm<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">,</span><span class="numeral">2</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span>cmod<span class="main">(</span>bell11 <span class="main">$$</span> <span class="main">(</span><span class="bound">j</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> set_0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span>cmod<span class="main">(</span><span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="main">(</span>cmod<span class="main">(</span><span class="main">1</span><span class="main">/</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> bell11_def ket_vec_def<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cmod_def power_divide<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Measurement-prob_1_bell_snd"><span class="command">lemma</span></span> prob_1_bell_snd <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">=</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>0</sub><span class="hidden">⇩</span><sub>0</sub>⟩</span> <span class="main">∨</span> <span class="free">v</span> <span class="main">=</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>0</sub><span class="hidden">⇩</span><sub>1</sub>⟩</span> <span class="main">∨</span> <span class="free">v</span> <span class="main">=</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>0</sub>⟩</span> <span class="main">∨</span> <span class="free">v</span> <span class="main">=</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>1</sub>⟩</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"prob1 <span class="numeral">2</span> <span class="free">v</span> <span class="main">1</span> <span class="main">=</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> set_0<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">k</span><span class="main">|</span> <span class="bound">k</span><span class="main">::</span>nat<span class="main">.</span> select_index <span class="numeral">2</span> <span class="main">1</span> <span class="bound">k</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="main">1</span><span class="main">,</span><span class="numeral">3</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> select_index_def<span class="main">)</span>
      <span class="main">(</span><span class="operator">metis</span> Suc_le_lessD le_SucE le_less mod2_gr_0 mod_less mod_self numeral_2_eq_2 numeral_3_eq_3<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">=</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>0</sub><span class="hidden">⇩</span><sub>0</sub>⟩</span> <span class="main">⟹</span> prob1 <span class="numeral">2</span> <span class="free">v</span> <span class="main">1</span> <span class="main">=</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">v</span> <span class="keyword3"><span class="command">assume</span></span> asm<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">=</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>0</sub><span class="hidden">⇩</span><sub>0</sub>⟩</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"prob1 <span class="numeral">2</span> <span class="skolem">v</span> <span class="main">1</span> <span class="main">=</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prob1 <span class="numeral">2</span> <span class="skolem">v</span> <span class="main">1</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="bound">k</span><span class="main">|</span> <span class="bound">k</span><span class="main">::</span>nat<span class="main">.</span> select_index <span class="numeral">2</span> <span class="main">1</span> <span class="bound">k</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span>cmod<span class="main">(</span>bell00 <span class="main">$$</span> <span class="main">(</span><span class="bound">j</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> prob1_def asm<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="main">1</span><span class="main">,</span><span class="numeral">3</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span>cmod<span class="main">(</span>bell00 <span class="main">$$</span> <span class="main">(</span><span class="bound">j</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> set_0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span>cmod<span class="main">(</span><span class="main">1</span><span class="main">/</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="main">(</span>cmod<span class="main">(</span><span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> bell00_def ket_vec_def<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cmod_def power_divide<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">=</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>0</sub><span class="hidden">⇩</span><sub>1</sub>⟩</span> <span class="main">⟹</span> prob1 <span class="numeral">2</span> <span class="free">v</span> <span class="main">1</span> <span class="main">=</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">v</span> <span class="keyword3"><span class="command">assume</span></span> asm<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">=</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>0</sub><span class="hidden">⇩</span><sub>1</sub>⟩</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"prob1 <span class="numeral">2</span> <span class="skolem">v</span> <span class="main">1</span> <span class="main">=</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prob1 <span class="numeral">2</span> <span class="skolem">v</span> <span class="main">1</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="bound">k</span><span class="main">|</span> <span class="bound">k</span><span class="main">::</span>nat<span class="main">.</span> select_index <span class="numeral">2</span> <span class="main">1</span> <span class="bound">k</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span>cmod<span class="main">(</span>bell01 <span class="main">$$</span> <span class="main">(</span><span class="bound">j</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> prob1_def asm<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="main">1</span><span class="main">,</span><span class="numeral">3</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span>cmod<span class="main">(</span>bell01 <span class="main">$$</span> <span class="main">(</span><span class="bound">j</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> set_0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span>cmod<span class="main">(</span><span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="main">(</span>cmod<span class="main">(</span><span class="main">1</span><span class="main">/</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> bell01_def ket_vec_def<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cmod_def power_divide<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">=</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>0</sub>⟩</span> <span class="main">⟹</span> prob1 <span class="numeral">2</span> <span class="free">v</span> <span class="main">1</span> <span class="main">=</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">v</span> <span class="keyword3"><span class="command">assume</span></span> asm<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">=</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>0</sub>⟩</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"prob1 <span class="numeral">2</span> <span class="skolem">v</span> <span class="main">1</span> <span class="main">=</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prob1 <span class="numeral">2</span> <span class="skolem">v</span> <span class="main">1</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="bound">k</span><span class="main">|</span> <span class="bound">k</span><span class="main">::</span>nat<span class="main">.</span> select_index <span class="numeral">2</span> <span class="main">1</span> <span class="bound">k</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span>cmod<span class="main">(</span>bell10 <span class="main">$$</span> <span class="main">(</span><span class="bound">j</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> prob1_def asm<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="main">1</span><span class="main">,</span><span class="numeral">3</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span>cmod<span class="main">(</span>bell10 <span class="main">$$</span> <span class="main">(</span><span class="bound">j</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> set_0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span>cmod<span class="main">(</span><span class="main">1</span><span class="main">/</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="main">(</span>cmod<span class="main">(</span><span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> bell10_def ket_vec_def<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cmod_def power_divide<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">=</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>1</sub>⟩</span> <span class="main">⟹</span> prob1 <span class="numeral">2</span> <span class="free">v</span> <span class="main">1</span> <span class="main">=</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">v</span> <span class="keyword3"><span class="command">assume</span></span> asm<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">=</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>1</sub>⟩</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"prob1 <span class="numeral">2</span> <span class="skolem">v</span> <span class="main">1</span> <span class="main">=</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prob1 <span class="numeral">2</span> <span class="skolem">v</span> <span class="main">1</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="bound">k</span><span class="main">|</span> <span class="bound">k</span><span class="main">::</span>nat<span class="main">.</span> select_index <span class="numeral">2</span> <span class="main">1</span> <span class="bound">k</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span>cmod<span class="main">(</span>bell11 <span class="main">$$</span> <span class="main">(</span><span class="bound">j</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> prob1_def asm<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="main">1</span><span class="main">,</span><span class="numeral">3</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span>cmod<span class="main">(</span>bell11 <span class="main">$$</span> <span class="main">(</span><span class="bound">j</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> set_0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span>cmod<span class="main">(</span><span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="main">(</span>cmod<span class="main">(</span><span class="main">1</span><span class="main">/</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> bell11_def ket_vec_def<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cmod_def power_divide<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Measurement-post_meas0_bell00_fst"><span class="command">lemma</span></span> post_meas0_bell00_fst <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"post_meas0 <span class="numeral">2</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>0</sub><span class="hidden">⇩</span><sub>0</sub>⟩</span> <span class="main">0</span> <span class="main">=</span> <span class="main">|</span>unit_vec <span class="numeral">4</span> <span class="main">0</span><span class="main">⟩</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span><span class="main">::</span><span class="quoted">nat</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> dim_row <span class="main">|</span>unit_vec <span class="numeral">4</span> <span class="main">0</span><span class="main">⟩</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> dim_col <span class="main">|</span>unit_vec <span class="numeral">4</span> <span class="main">0</span><span class="main">⟩</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ket_vec_def<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"post_meas0 <span class="numeral">2</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>0</sub><span class="hidden">⇩</span><sub>0</sub>⟩</span> <span class="main">0</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">|</span>unit_vec <span class="numeral">4</span> <span class="main">0</span><span class="main">⟩</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> post_meas0_def unit_vec_def select_index_def ket_vec_def real_sqrt_divide<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"post_meas0 <span class="numeral">2</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>0</sub><span class="hidden">⇩</span><sub>0</sub>⟩</span> <span class="main">0</span> <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">|</span>unit_vec <span class="numeral">4</span> <span class="main">0</span><span class="main">⟩</span> <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> post_meas0_def unit_vec_def select_index_def bell00_def ket_vec_def real_sqrt_divide<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"post_meas0 <span class="numeral">2</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>0</sub><span class="hidden">⇩</span><sub>0</sub>⟩</span> <span class="main">0</span> <span class="main">$$</span> <span class="main">(</span><span class="numeral">2</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">|</span>unit_vec <span class="numeral">4</span> <span class="main">0</span><span class="main">⟩</span> <span class="main">$$</span> <span class="main">(</span><span class="numeral">2</span><span class="main">,</span><span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> post_meas0_def unit_vec_def select_index_def bell00_def ket_vec_def real_sqrt_divide<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"post_meas0 <span class="numeral">2</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>0</sub><span class="hidden">⇩</span><sub>0</sub>⟩</span> <span class="main">0</span> <span class="main">$$</span> <span class="main">(</span><span class="numeral">3</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">|</span>unit_vec <span class="numeral">4</span> <span class="main">0</span><span class="main">⟩</span> <span class="main">$$</span> <span class="main">(</span><span class="numeral">3</span><span class="main">,</span><span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> post_meas0_def unit_vec_def select_index_def bell00_def ket_vec_def real_sqrt_divide<span class="main">)</span> 
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"post_meas0 <span class="numeral">2</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>0</sub><span class="hidden">⇩</span><sub>0</sub>⟩</span> <span class="main">0</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">|</span>unit_vec <span class="numeral">4</span> <span class="main">0</span><span class="main">⟩</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_row <span class="main">(</span>post_meas0 <span class="numeral">2</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>0</sub><span class="hidden">⇩</span><sub>0</sub>⟩</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> dim_row <span class="main">|</span>unit_vec <span class="numeral">4</span> <span class="main">0</span><span class="main">⟩</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> post_meas0_def ket_vec_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_col <span class="main">(</span>post_meas0 <span class="numeral">2</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>0</sub><span class="hidden">⇩</span><sub>0</sub>⟩</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> dim_col <span class="main">|</span>unit_vec <span class="numeral">4</span> <span class="main">0</span><span class="main">⟩</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> post_meas0_def ket_vec_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Measurement-post_meas0_bell00_snd"><span class="command">lemma</span></span> post_meas0_bell00_snd <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"post_meas0 <span class="numeral">2</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>0</sub><span class="hidden">⇩</span><sub>0</sub>⟩</span> <span class="main">1</span> <span class="main">=</span> <span class="main">|</span>unit_vec <span class="numeral">4</span> <span class="main">0</span><span class="main">⟩</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span><span class="main">::</span><span class="quoted">nat</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> dim_row <span class="main">|</span>unit_vec <span class="numeral">4</span> <span class="main">0</span><span class="main">⟩</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> dim_col <span class="main">|</span>unit_vec <span class="numeral">4</span> <span class="main">0</span><span class="main">⟩</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ket_vec_def<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"post_meas0 <span class="numeral">2</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>0</sub><span class="hidden">⇩</span><sub>0</sub>⟩</span> <span class="main">1</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">|</span>unit_vec <span class="numeral">4</span> <span class="main">0</span><span class="main">⟩</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> post_meas0_def unit_vec_def select_index_def bell00_def ket_vec_def real_sqrt_divide <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span>One_nat_def<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"post_meas0 <span class="numeral">2</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>0</sub><span class="hidden">⇩</span><sub>0</sub>⟩</span> <span class="main">1</span> <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">|</span>unit_vec <span class="numeral">4</span> <span class="main">0</span><span class="main">⟩</span> <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> post_meas0_def unit_vec_def select_index_def bell00_def ket_vec_def real_sqrt_divide<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"post_meas0 <span class="numeral">2</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>0</sub><span class="hidden">⇩</span><sub>0</sub>⟩</span> <span class="main">1</span> <span class="main">$$</span> <span class="main">(</span><span class="numeral">2</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">|</span>unit_vec <span class="numeral">4</span> <span class="main">0</span><span class="main">⟩</span> <span class="main">$$</span> <span class="main">(</span><span class="numeral">2</span><span class="main">,</span><span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> post_meas0_def unit_vec_def select_index_def bell00_def ket_vec_def real_sqrt_divide<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"post_meas0 <span class="numeral">2</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>0</sub><span class="hidden">⇩</span><sub>0</sub>⟩</span> <span class="main">1</span> <span class="main">$$</span> <span class="main">(</span><span class="numeral">3</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">|</span>unit_vec <span class="numeral">4</span> <span class="main">0</span><span class="main">⟩</span> <span class="main">$$</span> <span class="main">(</span><span class="numeral">3</span><span class="main">,</span><span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> post_meas0_def unit_vec_def select_index_def bell00_def ket_vec_def real_sqrt_divide<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"post_meas0 <span class="numeral">2</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>0</sub><span class="hidden">⇩</span><sub>0</sub>⟩</span> <span class="main">1</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">|</span>unit_vec <span class="numeral">4</span> <span class="main">0</span><span class="main">⟩</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_row <span class="main">(</span>post_meas0 <span class="numeral">2</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>0</sub><span class="hidden">⇩</span><sub>0</sub>⟩</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> dim_row <span class="main">|</span>unit_vec <span class="numeral">4</span> <span class="main">0</span><span class="main">⟩</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> post_meas0_def ket_vec_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_col <span class="main">(</span>post_meas0 <span class="numeral">2</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>0</sub><span class="hidden">⇩</span><sub>0</sub>⟩</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> dim_col <span class="main">|</span>unit_vec <span class="numeral">4</span> <span class="main">0</span><span class="main">⟩</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> post_meas0_def ket_vec_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Measurement-post_meas0_bell01_fst"><span class="command">lemma</span></span> post_meas0_bell01_fst <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"post_meas0 <span class="numeral">2</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>0</sub><span class="hidden">⇩</span><sub>1</sub>⟩</span> <span class="main">0</span> <span class="main">=</span> <span class="main">|</span>unit_vec <span class="numeral">4</span> <span class="main">1</span><span class="main">⟩</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span><span class="main">::</span><span class="quoted">nat</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> dim_row <span class="main">|</span>unit_vec <span class="numeral">4</span> <span class="main">1</span><span class="main">⟩</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> dim_col <span class="main">|</span>unit_vec <span class="numeral">4</span> <span class="main">1</span><span class="main">⟩</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ket_vec_def<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"post_meas0 <span class="numeral">2</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>0</sub><span class="hidden">⇩</span><sub>1</sub>⟩</span> <span class="main">0</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">|</span>unit_vec <span class="numeral">4</span> <span class="main">1</span><span class="main">⟩</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> post_meas0_def unit_vec_def select_index_def bell01_def ket_vec_def real_sqrt_divide<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"post_meas0 <span class="numeral">2</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>0</sub><span class="hidden">⇩</span><sub>1</sub>⟩</span> <span class="main">0</span> <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">|</span>unit_vec <span class="numeral">4</span> <span class="main">1</span><span class="main">⟩</span> <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> post_meas0_def unit_vec_def select_index_def bell01_def ket_vec_def real_sqrt_divide<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"post_meas0 <span class="numeral">2</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>0</sub><span class="hidden">⇩</span><sub>1</sub>⟩</span> <span class="main">0</span> <span class="main">$$</span> <span class="main">(</span><span class="numeral">2</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">|</span>unit_vec <span class="numeral">4</span> <span class="main">1</span><span class="main">⟩</span> <span class="main">$$</span> <span class="main">(</span><span class="numeral">2</span><span class="main">,</span><span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> post_meas0_def unit_vec_def select_index_def bell01_def ket_vec_def real_sqrt_divide<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"post_meas0 <span class="numeral">2</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>0</sub><span class="hidden">⇩</span><sub>1</sub>⟩</span> <span class="main">0</span> <span class="main">$$</span> <span class="main">(</span><span class="numeral">3</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">|</span>unit_vec <span class="numeral">4</span> <span class="main">1</span><span class="main">⟩</span> <span class="main">$$</span> <span class="main">(</span><span class="numeral">3</span><span class="main">,</span><span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> post_meas0_def unit_vec_def select_index_def bell01_def ket_vec_def real_sqrt_divide<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"post_meas0 <span class="numeral">2</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>0</sub><span class="hidden">⇩</span><sub>1</sub>⟩</span> <span class="main">0</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">|</span>unit_vec <span class="numeral">4</span> <span class="main">1</span><span class="main">⟩</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_row <span class="main">(</span>post_meas0 <span class="numeral">2</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>0</sub><span class="hidden">⇩</span><sub>1</sub>⟩</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> dim_row <span class="main">|</span>unit_vec <span class="numeral">4</span> <span class="main">1</span><span class="main">⟩</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> post_meas0_def ket_vec_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_col <span class="main">(</span>post_meas0 <span class="numeral">2</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>0</sub><span class="hidden">⇩</span><sub>1</sub>⟩</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> dim_col <span class="main">|</span>unit_vec <span class="numeral">4</span> <span class="main">1</span><span class="main">⟩</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> post_meas0_def ket_vec_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Measurement-post_meas0_bell01_snd"><span class="command">lemma</span></span> post_meas0_bell01_snd <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"post_meas0 <span class="numeral">2</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>0</sub><span class="hidden">⇩</span><sub>1</sub>⟩</span> <span class="main">1</span> <span class="main">=</span> <span class="main">|</span>unit_vec <span class="numeral">4</span> <span class="numeral">2</span><span class="main">⟩</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span><span class="main">::</span><span class="quoted">nat</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> dim_row <span class="main">|</span>unit_vec <span class="numeral">4</span> <span class="numeral">2</span><span class="main">⟩</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> dim_col <span class="main">|</span>unit_vec <span class="numeral">4</span> <span class="numeral">2</span><span class="main">⟩</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ket_vec_def<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"post_meas0 <span class="numeral">2</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>0</sub><span class="hidden">⇩</span><sub>1</sub>⟩</span> <span class="main">1</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">|</span>unit_vec <span class="numeral">4</span> <span class="numeral">2</span><span class="main">⟩</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> post_meas0_def unit_vec_def select_index_def bell01_def ket_vec_def real_sqrt_divide<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"post_meas0 <span class="numeral">2</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>0</sub><span class="hidden">⇩</span><sub>1</sub>⟩</span> <span class="main">1</span> <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">|</span>unit_vec <span class="numeral">4</span> <span class="numeral">2</span><span class="main">⟩</span> <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> post_meas0_def unit_vec_def select_index_def bell01_def ket_vec_def real_sqrt_divide<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"post_meas0 <span class="numeral">2</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>0</sub><span class="hidden">⇩</span><sub>1</sub>⟩</span> <span class="main">1</span> <span class="main">$$</span> <span class="main">(</span><span class="numeral">2</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">|</span>unit_vec <span class="numeral">4</span> <span class="numeral">2</span><span class="main">⟩</span> <span class="main">$$</span> <span class="main">(</span><span class="numeral">2</span><span class="main">,</span><span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> post_meas0_def unit_vec_def select_index_def bell01_def ket_vec_def real_sqrt_divide <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span>One_nat_def<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"post_meas0 <span class="numeral">2</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>0</sub><span class="hidden">⇩</span><sub>1</sub>⟩</span> <span class="main">1</span> <span class="main">$$</span> <span class="main">(</span><span class="numeral">3</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">|</span>unit_vec <span class="numeral">4</span> <span class="numeral">2</span><span class="main">⟩</span> <span class="main">$$</span> <span class="main">(</span><span class="numeral">3</span><span class="main">,</span><span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> post_meas0_def unit_vec_def select_index_def bell01_def ket_vec_def real_sqrt_divide<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"post_meas0 <span class="numeral">2</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>0</sub><span class="hidden">⇩</span><sub>1</sub>⟩</span> <span class="main">1</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">|</span>unit_vec <span class="numeral">4</span> <span class="numeral">2</span><span class="main">⟩</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_row <span class="main">(</span>post_meas0 <span class="numeral">2</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>0</sub><span class="hidden">⇩</span><sub>1</sub>⟩</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> dim_row <span class="main">|</span>unit_vec <span class="numeral">4</span> <span class="numeral">2</span><span class="main">⟩</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> post_meas0_def ket_vec_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_col <span class="main">(</span>post_meas0 <span class="numeral">2</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>0</sub><span class="hidden">⇩</span><sub>1</sub>⟩</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> dim_col <span class="main">|</span>unit_vec <span class="numeral">4</span> <span class="numeral">2</span><span class="main">⟩</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> post_meas0_def ket_vec_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Measurement-post_meas0_bell10_fst"><span class="command">lemma</span></span> post_meas0_bell10_fst <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"post_meas0 <span class="numeral">2</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>0</sub>⟩</span> <span class="main">0</span> <span class="main">=</span> <span class="main">|</span>unit_vec <span class="numeral">4</span> <span class="main">0</span><span class="main">⟩</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span><span class="main">::</span><span class="quoted">nat</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> dim_row <span class="main">|</span>unit_vec <span class="numeral">4</span> <span class="main">0</span><span class="main">⟩</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> dim_col <span class="main">|</span>unit_vec <span class="numeral">4</span> <span class="main">0</span><span class="main">⟩</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ket_vec_def<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"post_meas0 <span class="numeral">2</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>0</sub>⟩</span> <span class="main">0</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">|</span>unit_vec <span class="numeral">4</span> <span class="main">0</span><span class="main">⟩</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> post_meas0_def unit_vec_def select_index_def bell10_def ket_vec_def real_sqrt_divide<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"post_meas0 <span class="numeral">2</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>0</sub>⟩</span> <span class="main">0</span> <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">|</span>unit_vec <span class="numeral">4</span> <span class="main">0</span><span class="main">⟩</span> <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> post_meas0_def unit_vec_def select_index_def bell10_def ket_vec_def real_sqrt_divide<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"post_meas0 <span class="numeral">2</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>0</sub>⟩</span> <span class="main">0</span> <span class="main">$$</span> <span class="main">(</span><span class="numeral">2</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">|</span>unit_vec <span class="numeral">4</span> <span class="main">0</span><span class="main">⟩</span> <span class="main">$$</span> <span class="main">(</span><span class="numeral">2</span><span class="main">,</span><span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> post_meas0_def unit_vec_def select_index_def bell10_def ket_vec_def real_sqrt_divide<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"post_meas0 <span class="numeral">2</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>0</sub>⟩</span> <span class="main">0</span> <span class="main">$$</span> <span class="main">(</span><span class="numeral">3</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">|</span>unit_vec <span class="numeral">4</span> <span class="main">0</span><span class="main">⟩</span> <span class="main">$$</span> <span class="main">(</span><span class="numeral">3</span><span class="main">,</span><span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> post_meas0_def unit_vec_def select_index_def bell10_def ket_vec_def real_sqrt_divide<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"post_meas0 <span class="numeral">2</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>0</sub>⟩</span> <span class="main">0</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">|</span>unit_vec <span class="numeral">4</span> <span class="main">0</span><span class="main">⟩</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_row <span class="main">(</span>post_meas0 <span class="numeral">2</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>0</sub>⟩</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> dim_row <span class="main">|</span>unit_vec <span class="numeral">4</span> <span class="main">0</span><span class="main">⟩</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> post_meas0_def ket_vec_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_col <span class="main">(</span>post_meas0 <span class="numeral">2</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>0</sub>⟩</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> dim_col <span class="main">|</span>unit_vec <span class="numeral">4</span> <span class="main">0</span><span class="main">⟩</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> post_meas0_def ket_vec_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Measurement-post_meas0_bell10_snd"><span class="command">lemma</span></span> post_meas0_bell10_snd <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"post_meas0 <span class="numeral">2</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>0</sub>⟩</span> <span class="main">1</span> <span class="main">=</span> <span class="main">|</span>unit_vec <span class="numeral">4</span> <span class="main">0</span><span class="main">⟩</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span><span class="main">::</span><span class="quoted">nat</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> dim_row <span class="main">|</span>unit_vec <span class="numeral">4</span> <span class="main">0</span><span class="main">⟩</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> dim_col <span class="main">|</span>unit_vec <span class="numeral">4</span> <span class="main">0</span><span class="main">⟩</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ket_vec_def<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"post_meas0 <span class="numeral">2</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>0</sub>⟩</span> <span class="main">1</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">|</span>unit_vec <span class="numeral">4</span> <span class="main">0</span><span class="main">⟩</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> post_meas0_def unit_vec_def select_index_def bell10_def ket_vec_def real_sqrt_divide <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span>One_nat_def<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"post_meas0 <span class="numeral">2</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>0</sub>⟩</span> <span class="main">1</span> <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">|</span>unit_vec <span class="numeral">4</span> <span class="main">0</span><span class="main">⟩</span> <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> post_meas0_def unit_vec_def select_index_def bell10_def ket_vec_def real_sqrt_divide<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"post_meas0 <span class="numeral">2</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>0</sub>⟩</span> <span class="main">1</span> <span class="main">$$</span> <span class="main">(</span><span class="numeral">2</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">|</span>unit_vec <span class="numeral">4</span> <span class="main">0</span><span class="main">⟩</span> <span class="main">$$</span> <span class="main">(</span><span class="numeral">2</span><span class="main">,</span><span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> post_meas0_def unit_vec_def select_index_def bell10_def ket_vec_def real_sqrt_divide<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"post_meas0 <span class="numeral">2</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>0</sub>⟩</span> <span class="main">1</span> <span class="main">$$</span> <span class="main">(</span><span class="numeral">3</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">|</span>unit_vec <span class="numeral">4</span> <span class="main">0</span><span class="main">⟩</span> <span class="main">$$</span> <span class="main">(</span><span class="numeral">3</span><span class="main">,</span><span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> post_meas0_def unit_vec_def select_index_def bell10_def ket_vec_def real_sqrt_divide<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"post_meas0 <span class="numeral">2</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>0</sub>⟩</span> <span class="main">1</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">|</span>unit_vec <span class="numeral">4</span> <span class="main">0</span><span class="main">⟩</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_row <span class="main">(</span>post_meas0 <span class="numeral">2</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>0</sub>⟩</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> dim_row <span class="main">|</span>unit_vec <span class="numeral">4</span> <span class="main">0</span><span class="main">⟩</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> post_meas0_def ket_vec_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_col <span class="main">(</span>post_meas0 <span class="numeral">2</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>0</sub>⟩</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> dim_col <span class="main">|</span>unit_vec <span class="numeral">4</span> <span class="main">0</span><span class="main">⟩</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> post_meas0_def ket_vec_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Measurement-post_meas0_bell11_fst"><span class="command">lemma</span></span> post_meas0_bell11_fst <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"post_meas0 <span class="numeral">2</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>1</sub>⟩</span> <span class="main">0</span> <span class="main">=</span> <span class="main">|</span>unit_vec <span class="numeral">4</span> <span class="main">1</span><span class="main">⟩</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span><span class="main">::</span><span class="quoted">nat</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> dim_row <span class="main">|</span>unit_vec <span class="numeral">4</span> <span class="main">1</span><span class="main">⟩</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> dim_col <span class="main">|</span>unit_vec <span class="numeral">4</span> <span class="main">1</span><span class="main">⟩</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">=</span> <span class="main">0</span>"</span></span>  
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ket_vec_def<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"post_meas0 <span class="numeral">2</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>1</sub>⟩</span> <span class="main">0</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">|</span>unit_vec <span class="numeral">4</span> <span class="main">1</span><span class="main">⟩</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> post_meas0_def unit_vec_def select_index_def bell11_def ket_vec_def real_sqrt_divide<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"post_meas0 <span class="numeral">2</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>1</sub>⟩</span> <span class="main">0</span> <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">|</span>unit_vec <span class="numeral">4</span> <span class="main">1</span><span class="main">⟩</span> <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> post_meas0_def unit_vec_def select_index_def bell11_def ket_vec_def real_sqrt_divide<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"post_meas0 <span class="numeral">2</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>1</sub>⟩</span> <span class="main">0</span> <span class="main">$$</span> <span class="main">(</span><span class="numeral">2</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">|</span>unit_vec <span class="numeral">4</span> <span class="main">1</span><span class="main">⟩</span> <span class="main">$$</span> <span class="main">(</span><span class="numeral">2</span><span class="main">,</span><span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> post_meas0_def unit_vec_def select_index_def bell11_def ket_vec_def real_sqrt_divide<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"post_meas0 <span class="numeral">2</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>1</sub>⟩</span> <span class="main">0</span> <span class="main">$$</span> <span class="main">(</span><span class="numeral">3</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">|</span>unit_vec <span class="numeral">4</span> <span class="main">1</span><span class="main">⟩</span> <span class="main">$$</span> <span class="main">(</span><span class="numeral">3</span><span class="main">,</span><span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> post_meas0_def unit_vec_def select_index_def bell11_def ket_vec_def real_sqrt_divide<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"post_meas0 <span class="numeral">2</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>1</sub>⟩</span> <span class="main">0</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">|</span>unit_vec <span class="numeral">4</span> <span class="main">1</span><span class="main">⟩</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_row <span class="main">(</span>post_meas0 <span class="numeral">2</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>1</sub>⟩</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> dim_row <span class="main">|</span>unit_vec <span class="numeral">4</span> <span class="main">1</span><span class="main">⟩</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> post_meas0_def ket_vec_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_col <span class="main">(</span>post_meas0 <span class="numeral">2</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>1</sub>⟩</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> dim_col <span class="main">|</span>unit_vec <span class="numeral">4</span> <span class="main">1</span><span class="main">⟩</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> post_meas0_def ket_vec_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Measurement-post_meas0_bell11_snd"><span class="command">lemma</span></span> post_meas0_bell11_snd <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"post_meas0 <span class="numeral">2</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>1</sub>⟩</span> <span class="main">1</span> <span class="main">=</span> <span class="main">-</span> <span class="main">|</span>unit_vec <span class="numeral">4</span> <span class="numeral">2</span><span class="main">⟩</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span><span class="main">::</span><span class="quoted">nat</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> dim_row <span class="main">(</span><span class="main">-</span> <span class="main">|</span>unit_vec <span class="numeral">4</span> <span class="numeral">2</span><span class="main">⟩</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> dim_col <span class="main">(</span><span class="main">-</span> <span class="main">|</span>unit_vec <span class="numeral">4</span> <span class="numeral">2</span><span class="main">⟩</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ket_vec_def<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"post_meas0 <span class="numeral">2</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>1</sub>⟩</span> <span class="main">1</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span> <span class="main">|</span>unit_vec <span class="numeral">4</span> <span class="numeral">2</span><span class="main">⟩</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> post_meas0_def unit_vec_def select_index_def bell11_def ket_vec_def real_sqrt_divide<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"post_meas0 <span class="numeral">2</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>1</sub>⟩</span> <span class="main">1</span> <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span> <span class="main">|</span>unit_vec <span class="numeral">4</span> <span class="numeral">2</span><span class="main">⟩</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> post_meas0_def unit_vec_def select_index_def bell11_def ket_vec_def real_sqrt_divide<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"post_meas0 <span class="numeral">2</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>1</sub>⟩</span> <span class="main">1</span> <span class="main">$$</span> <span class="main">(</span><span class="numeral">2</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span> <span class="main">|</span>unit_vec <span class="numeral">4</span> <span class="numeral">2</span><span class="main">⟩</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="numeral">2</span><span class="main">,</span><span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> post_meas0_def unit_vec_def select_index_def bell11_def ket_vec_def real_sqrt_divide <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span>One_nat_def<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"post_meas0 <span class="numeral">2</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>1</sub>⟩</span> <span class="main">1</span> <span class="main">$$</span> <span class="main">(</span><span class="numeral">3</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span> <span class="main">|</span>unit_vec <span class="numeral">4</span> <span class="numeral">2</span><span class="main">⟩</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="numeral">3</span><span class="main">,</span><span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> post_meas0_def unit_vec_def select_index_def bell11_def ket_vec_def real_sqrt_divide<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"post_meas0 <span class="numeral">2</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>1</sub>⟩</span> <span class="main">1</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span> <span class="main">|</span>unit_vec <span class="numeral">4</span> <span class="numeral">2</span><span class="main">⟩</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_row <span class="main">(</span>post_meas0 <span class="numeral">2</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>1</sub>⟩</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> dim_row <span class="main">(</span><span class="main">-</span> <span class="main">|</span>unit_vec <span class="numeral">4</span> <span class="numeral">2</span><span class="main">⟩</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> post_meas0_def ket_vec_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_col <span class="main">(</span>post_meas0 <span class="numeral">2</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>1</sub>⟩</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> dim_col <span class="main">(</span><span class="main">-</span> <span class="main">|</span>unit_vec <span class="numeral">4</span> <span class="numeral">2</span><span class="main">⟩</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> post_meas0_def ket_vec_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Measurement-post_meas1_bell00_fst"><span class="command">lemma</span></span> post_meas1_bell00_fst <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"post_meas1 <span class="numeral">2</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>0</sub><span class="hidden">⇩</span><sub>0</sub>⟩</span> <span class="main">0</span> <span class="main">=</span> <span class="main">|</span>unit_vec <span class="numeral">4</span> <span class="numeral">3</span><span class="main">⟩</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span><span class="main">::</span><span class="quoted">nat</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> dim_row <span class="main">|</span>unit_vec <span class="numeral">4</span> <span class="numeral">3</span><span class="main">⟩</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> dim_col <span class="main">|</span>unit_vec <span class="numeral">4</span> <span class="numeral">3</span><span class="main">⟩</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">=</span> <span class="main">0</span>"</span></span>  
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ket_vec_def<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"post_meas1 <span class="numeral">2</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>0</sub><span class="hidden">⇩</span><sub>0</sub>⟩</span> <span class="main">0</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">|</span>unit_vec <span class="numeral">4</span> <span class="numeral">3</span><span class="main">⟩</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> post_meas1_def unit_vec_def select_index_def bell00_def ket_vec_def real_sqrt_divide<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"post_meas1 <span class="numeral">2</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>0</sub><span class="hidden">⇩</span><sub>0</sub>⟩</span> <span class="main">0</span> <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">|</span>unit_vec <span class="numeral">4</span> <span class="numeral">3</span><span class="main">⟩</span> <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> post_meas1_def unit_vec_def select_index_def bell00_def ket_vec_def real_sqrt_divide<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"post_meas1 <span class="numeral">2</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>0</sub><span class="hidden">⇩</span><sub>0</sub>⟩</span> <span class="main">0</span> <span class="main">$$</span> <span class="main">(</span><span class="numeral">2</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">|</span>unit_vec <span class="numeral">4</span> <span class="numeral">3</span><span class="main">⟩</span> <span class="main">$$</span> <span class="main">(</span><span class="numeral">2</span><span class="main">,</span><span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> post_meas1_def unit_vec_def select_index_def bell00_def ket_vec_def real_sqrt_divide<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"post_meas1 <span class="numeral">2</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>0</sub><span class="hidden">⇩</span><sub>0</sub>⟩</span> <span class="main">0</span> <span class="main">$$</span> <span class="main">(</span><span class="numeral">3</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">|</span>unit_vec <span class="numeral">4</span> <span class="numeral">3</span><span class="main">⟩</span> <span class="main">$$</span> <span class="main">(</span><span class="numeral">3</span><span class="main">,</span><span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> post_meas1_def unit_vec_def select_index_def bell00_def ket_vec_def real_sqrt_divide<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"post_meas1 <span class="numeral">2</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>0</sub><span class="hidden">⇩</span><sub>0</sub>⟩</span> <span class="main">0</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">|</span>unit_vec <span class="numeral">4</span> <span class="numeral">3</span><span class="main">⟩</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_row <span class="main">(</span>post_meas1 <span class="numeral">2</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>0</sub><span class="hidden">⇩</span><sub>0</sub>⟩</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> dim_row <span class="main">|</span>unit_vec <span class="numeral">4</span> <span class="numeral">3</span><span class="main">⟩</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> post_meas1_def ket_vec_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_col <span class="main">(</span>post_meas1 <span class="numeral">2</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>0</sub><span class="hidden">⇩</span><sub>0</sub>⟩</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> dim_col <span class="main">|</span>unit_vec <span class="numeral">4</span> <span class="numeral">3</span><span class="main">⟩</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> post_meas1_def ket_vec_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Measurement-post_meas1_bell00_snd"><span class="command">lemma</span></span> post_meas1_bell00_snd <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"post_meas1 <span class="numeral">2</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>0</sub><span class="hidden">⇩</span><sub>0</sub>⟩</span> <span class="main">1</span> <span class="main">=</span> <span class="main">|</span>unit_vec <span class="numeral">4</span> <span class="numeral">3</span><span class="main">⟩</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span><span class="main">::</span><span class="quoted">nat</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> dim_row <span class="main">|</span>unit_vec <span class="numeral">4</span> <span class="numeral">3</span><span class="main">⟩</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> dim_col <span class="main">|</span>unit_vec <span class="numeral">4</span> <span class="numeral">3</span><span class="main">⟩</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ket_vec_def<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"post_meas1 <span class="numeral">2</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>0</sub><span class="hidden">⇩</span><sub>0</sub>⟩</span> <span class="main">1</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">|</span>unit_vec <span class="numeral">4</span> <span class="numeral">3</span><span class="main">⟩</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> post_meas1_def unit_vec_def select_index_def bell00_def ket_vec_def real_sqrt_divide<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"post_meas1 <span class="numeral">2</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>0</sub><span class="hidden">⇩</span><sub>0</sub>⟩</span> <span class="main">1</span> <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">|</span>unit_vec <span class="numeral">4</span> <span class="numeral">3</span><span class="main">⟩</span> <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> post_meas1_def unit_vec_def select_index_def bell00_def ket_vec_def real_sqrt_divide<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"post_meas1 <span class="numeral">2</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>0</sub><span class="hidden">⇩</span><sub>0</sub>⟩</span> <span class="main">1</span> <span class="main">$$</span> <span class="main">(</span><span class="numeral">2</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">|</span>unit_vec <span class="numeral">4</span> <span class="numeral">3</span><span class="main">⟩</span> <span class="main">$$</span> <span class="main">(</span><span class="numeral">2</span><span class="main">,</span><span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> post_meas1_def unit_vec_def select_index_def bell00_def ket_vec_def real_sqrt_divide<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"post_meas1 <span class="numeral">2</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>0</sub><span class="hidden">⇩</span><sub>0</sub>⟩</span> <span class="main">1</span> <span class="main">$$</span> <span class="main">(</span><span class="numeral">3</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">|</span>unit_vec <span class="numeral">4</span> <span class="numeral">3</span><span class="main">⟩</span> <span class="main">$$</span> <span class="main">(</span><span class="numeral">3</span><span class="main">,</span><span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> post_meas1_def unit_vec_def select_index_def bell00_def ket_vec_def real_sqrt_divide <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> One_nat_def<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"post_meas1 <span class="numeral">2</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>0</sub><span class="hidden">⇩</span><sub>0</sub>⟩</span> <span class="main">1</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">|</span>unit_vec <span class="numeral">4</span> <span class="numeral">3</span><span class="main">⟩</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_row <span class="main">(</span>post_meas1 <span class="numeral">2</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>0</sub><span class="hidden">⇩</span><sub>0</sub>⟩</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> dim_row <span class="main">|</span>unit_vec <span class="numeral">4</span> <span class="numeral">3</span><span class="main">⟩</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> post_meas1_def ket_vec_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_col <span class="main">(</span>post_meas1 <span class="numeral">2</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>0</sub><span class="hidden">⇩</span><sub>0</sub>⟩</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> dim_col <span class="main">|</span>unit_vec <span class="numeral">4</span> <span class="numeral">3</span><span class="main">⟩</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> post_meas1_def ket_vec_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Measurement-post_meas1_bell01_fst"><span class="command">lemma</span></span> post_meas1_bell01_fst <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"post_meas1 <span class="numeral">2</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>0</sub><span class="hidden">⇩</span><sub>1</sub>⟩</span> <span class="main">0</span> <span class="main">=</span> <span class="main">|</span>unit_vec <span class="numeral">4</span> <span class="numeral">2</span><span class="main">⟩</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span><span class="main">::</span><span class="quoted">nat</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> dim_row <span class="main">|</span>unit_vec <span class="numeral">4</span> <span class="numeral">2</span><span class="main">⟩</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> dim_col <span class="main">|</span>unit_vec <span class="numeral">4</span> <span class="numeral">2</span><span class="main">⟩</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ket_vec_def<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"post_meas1 <span class="numeral">2</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>0</sub><span class="hidden">⇩</span><sub>1</sub>⟩</span> <span class="main">0</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">|</span>unit_vec <span class="numeral">4</span> <span class="numeral">2</span><span class="main">⟩</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> post_meas1_def unit_vec_def select_index_def bell01_def ket_vec_def real_sqrt_divide<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"post_meas1 <span class="numeral">2</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>0</sub><span class="hidden">⇩</span><sub>1</sub>⟩</span> <span class="main">0</span> <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">|</span>unit_vec <span class="numeral">4</span> <span class="numeral">2</span><span class="main">⟩</span> <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> post_meas1_def unit_vec_def select_index_def bell01_def ket_vec_def real_sqrt_divide<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"post_meas1 <span class="numeral">2</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>0</sub><span class="hidden">⇩</span><sub>1</sub>⟩</span> <span class="main">0</span> <span class="main">$$</span> <span class="main">(</span><span class="numeral">2</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">|</span>unit_vec <span class="numeral">4</span> <span class="numeral">2</span><span class="main">⟩</span> <span class="main">$$</span> <span class="main">(</span><span class="numeral">2</span><span class="main">,</span><span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> post_meas1_def unit_vec_def select_index_def bell01_def ket_vec_def real_sqrt_divide<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"post_meas1 <span class="numeral">2</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>0</sub><span class="hidden">⇩</span><sub>1</sub>⟩</span> <span class="main">0</span> <span class="main">$$</span> <span class="main">(</span><span class="numeral">3</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">|</span>unit_vec <span class="numeral">4</span> <span class="numeral">2</span><span class="main">⟩</span> <span class="main">$$</span> <span class="main">(</span><span class="numeral">3</span><span class="main">,</span><span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> post_meas1_def unit_vec_def select_index_def bell01_def ket_vec_def real_sqrt_divide<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"post_meas1 <span class="numeral">2</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>0</sub><span class="hidden">⇩</span><sub>1</sub>⟩</span> <span class="main">0</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">|</span>unit_vec <span class="numeral">4</span> <span class="numeral">2</span><span class="main">⟩</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_row <span class="main">(</span>post_meas1 <span class="numeral">2</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>0</sub><span class="hidden">⇩</span><sub>1</sub>⟩</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> dim_row <span class="main">|</span>unit_vec <span class="numeral">4</span> <span class="numeral">2</span><span class="main">⟩</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> post_meas1_def ket_vec_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_col <span class="main">(</span>post_meas1 <span class="numeral">2</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>0</sub><span class="hidden">⇩</span><sub>1</sub>⟩</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> dim_col <span class="main">|</span>unit_vec <span class="numeral">4</span> <span class="numeral">2</span><span class="main">⟩</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> post_meas1_def ket_vec_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Measurement-post_meas1_bell01_snd"><span class="command">lemma</span></span> post_meas1_bell01_snd <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"post_meas1 <span class="numeral">2</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>0</sub><span class="hidden">⇩</span><sub>1</sub>⟩</span> <span class="main">1</span> <span class="main">=</span> <span class="main">|</span>unit_vec <span class="numeral">4</span> <span class="main">1</span><span class="main">⟩</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span><span class="main">::</span><span class="quoted">nat</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> dim_row <span class="main">|</span>unit_vec <span class="numeral">4</span> <span class="main">1</span><span class="main">⟩</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> dim_col <span class="main">|</span>unit_vec <span class="numeral">4</span> <span class="main">1</span><span class="main">⟩</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ket_vec_def<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"post_meas1 <span class="numeral">2</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>0</sub><span class="hidden">⇩</span><sub>1</sub>⟩</span> <span class="main">1</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">|</span>unit_vec <span class="numeral">4</span> <span class="main">1</span><span class="main">⟩</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> post_meas1_def unit_vec_def select_index_def bell01_def ket_vec_def real_sqrt_divide<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"post_meas1 <span class="numeral">2</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>0</sub><span class="hidden">⇩</span><sub>1</sub>⟩</span> <span class="main">1</span> <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">|</span>unit_vec <span class="numeral">4</span> <span class="main">1</span><span class="main">⟩</span> <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> post_meas1_def unit_vec_def select_index_def bell01_def ket_vec_def real_sqrt_divide <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> One_nat_def<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"post_meas1 <span class="numeral">2</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>0</sub><span class="hidden">⇩</span><sub>1</sub>⟩</span> <span class="main">1</span> <span class="main">$$</span> <span class="main">(</span><span class="numeral">2</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">|</span>unit_vec <span class="numeral">4</span> <span class="main">1</span><span class="main">⟩</span> <span class="main">$$</span> <span class="main">(</span><span class="numeral">2</span><span class="main">,</span><span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> post_meas1_def unit_vec_def select_index_def bell01_def ket_vec_def real_sqrt_divide<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"post_meas1 <span class="numeral">2</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>0</sub><span class="hidden">⇩</span><sub>1</sub>⟩</span> <span class="main">1</span> <span class="main">$$</span> <span class="main">(</span><span class="numeral">3</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">|</span>unit_vec <span class="numeral">4</span> <span class="main">1</span><span class="main">⟩</span> <span class="main">$$</span> <span class="main">(</span><span class="numeral">3</span><span class="main">,</span><span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> post_meas1_def unit_vec_def select_index_def bell01_def ket_vec_def real_sqrt_divide<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"post_meas1 <span class="numeral">2</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>0</sub><span class="hidden">⇩</span><sub>1</sub>⟩</span> <span class="main">1</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">|</span>unit_vec <span class="numeral">4</span> <span class="main">1</span><span class="main">⟩</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_row <span class="main">(</span>post_meas1 <span class="numeral">2</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>0</sub><span class="hidden">⇩</span><sub>1</sub>⟩</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> dim_row <span class="main">|</span>unit_vec <span class="numeral">4</span> <span class="main">1</span><span class="main">⟩</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> post_meas1_def ket_vec_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_col <span class="main">(</span>post_meas1 <span class="numeral">2</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>0</sub><span class="hidden">⇩</span><sub>1</sub>⟩</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> dim_col <span class="main">|</span>unit_vec <span class="numeral">4</span> <span class="main">1</span><span class="main">⟩</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> post_meas1_def ket_vec_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Measurement-post_meas1_bell10_fst"><span class="command">lemma</span></span> post_meas1_bell10_fst <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"post_meas1 <span class="numeral">2</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>0</sub>⟩</span> <span class="main">0</span> <span class="main">=</span> <span class="main">-</span> <span class="main">|</span>unit_vec <span class="numeral">4</span> <span class="numeral">3</span><span class="main">⟩</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span><span class="main">::</span><span class="quoted">nat</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> dim_row <span class="main">(</span><span class="main">-</span> <span class="main">|</span>unit_vec <span class="numeral">4</span> <span class="numeral">3</span><span class="main">⟩</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> dim_col <span class="main">(</span><span class="main">-</span> <span class="main">|</span>unit_vec <span class="numeral">4</span> <span class="numeral">3</span><span class="main">⟩</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ket_vec_def<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"post_meas1 <span class="numeral">2</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>0</sub>⟩</span> <span class="main">0</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span> <span class="main">|</span>unit_vec <span class="numeral">4</span> <span class="numeral">3</span><span class="main">⟩</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> post_meas1_def unit_vec_def select_index_def bell10_def ket_vec_def real_sqrt_divide<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"post_meas1 <span class="numeral">2</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>0</sub>⟩</span> <span class="main">0</span> <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span> <span class="main">|</span>unit_vec <span class="numeral">4</span> <span class="numeral">3</span><span class="main">⟩</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> post_meas1_def unit_vec_def select_index_def bell10_def ket_vec_def real_sqrt_divide<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"post_meas1 <span class="numeral">2</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>0</sub>⟩</span> <span class="main">0</span> <span class="main">$$</span> <span class="main">(</span><span class="numeral">2</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span> <span class="main">|</span>unit_vec <span class="numeral">4</span> <span class="numeral">3</span><span class="main">⟩</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="numeral">2</span><span class="main">,</span><span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> post_meas1_def unit_vec_def select_index_def bell10_def ket_vec_def real_sqrt_divide<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"post_meas1 <span class="numeral">2</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>0</sub>⟩</span> <span class="main">0</span> <span class="main">$$</span> <span class="main">(</span><span class="numeral">3</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span> <span class="main">|</span>unit_vec <span class="numeral">4</span> <span class="numeral">3</span><span class="main">⟩</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="numeral">3</span><span class="main">,</span><span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> post_meas1_def unit_vec_def select_index_def bell10_def ket_vec_def real_sqrt_divide<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"post_meas1 <span class="numeral">2</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>0</sub>⟩</span> <span class="main">0</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span> <span class="main">|</span>unit_vec <span class="numeral">4</span> <span class="numeral">3</span><span class="main">⟩</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_row <span class="main">(</span>post_meas1 <span class="numeral">2</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>0</sub>⟩</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> dim_row <span class="main">(</span><span class="main">-</span> <span class="main">|</span>unit_vec <span class="numeral">4</span> <span class="numeral">3</span><span class="main">⟩</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> post_meas1_def ket_vec_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_col <span class="main">(</span>post_meas1 <span class="numeral">2</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>0</sub>⟩</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> dim_col <span class="main">(</span><span class="main">-</span> <span class="main">|</span>unit_vec <span class="numeral">4</span> <span class="numeral">3</span><span class="main">⟩</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> post_meas1_def ket_vec_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Measurement-post_meas1_bell10_snd"><span class="command">lemma</span></span> post_meas1_bell10_snd <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"post_meas1 <span class="numeral">2</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>0</sub>⟩</span> <span class="main">1</span> <span class="main">=</span> <span class="main">-</span> <span class="main">|</span>unit_vec <span class="numeral">4</span> <span class="numeral">3</span><span class="main">⟩</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span><span class="main">::</span><span class="quoted">nat</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> dim_row <span class="main">(</span><span class="main">-</span> <span class="main">|</span>unit_vec <span class="numeral">4</span> <span class="numeral">3</span><span class="main">⟩</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> dim_col <span class="main">(</span><span class="main">-</span> <span class="main">|</span>unit_vec <span class="numeral">4</span> <span class="numeral">3</span><span class="main">⟩</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ket_vec_def<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"post_meas1 <span class="numeral">2</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>0</sub>⟩</span> <span class="main">1</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span> <span class="main">|</span>unit_vec <span class="numeral">4</span> <span class="numeral">3</span><span class="main">⟩</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> post_meas1_def unit_vec_def select_index_def bell10_def ket_vec_def real_sqrt_divide<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"post_meas1 <span class="numeral">2</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>0</sub>⟩</span> <span class="main">1</span> <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span> <span class="main">|</span>unit_vec <span class="numeral">4</span> <span class="numeral">3</span><span class="main">⟩</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> post_meas1_def unit_vec_def select_index_def bell10_def ket_vec_def real_sqrt_divide<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"post_meas1 <span class="numeral">2</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>0</sub>⟩</span> <span class="main">1</span> <span class="main">$$</span> <span class="main">(</span><span class="numeral">2</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span> <span class="main">|</span>unit_vec <span class="numeral">4</span> <span class="numeral">3</span><span class="main">⟩</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="numeral">2</span><span class="main">,</span><span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> post_meas1_def unit_vec_def select_index_def bell10_def ket_vec_def real_sqrt_divide<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"post_meas1 <span class="numeral">2</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>0</sub>⟩</span> <span class="main">1</span> <span class="main">$$</span> <span class="main">(</span><span class="numeral">3</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span> <span class="main">|</span>unit_vec <span class="numeral">4</span> <span class="numeral">3</span><span class="main">⟩</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="numeral">3</span><span class="main">,</span><span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> post_meas1_def unit_vec_def select_index_def bell10_def ket_vec_def real_sqrt_divide <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> One_nat_def<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"post_meas1 <span class="numeral">2</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>0</sub>⟩</span> <span class="main">1</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span> <span class="main">|</span>unit_vec <span class="numeral">4</span> <span class="numeral">3</span><span class="main">⟩</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>    
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_row <span class="main">(</span>post_meas1 <span class="numeral">2</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>0</sub>⟩</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> dim_row <span class="main">(</span><span class="main">-</span> <span class="main">|</span>unit_vec <span class="numeral">4</span> <span class="numeral">3</span><span class="main">⟩</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> post_meas1_def ket_vec_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_col <span class="main">(</span>post_meas1 <span class="numeral">2</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>0</sub>⟩</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> dim_col <span class="main">(</span><span class="main">-</span> <span class="main">|</span>unit_vec <span class="numeral">4</span> <span class="numeral">3</span><span class="main">⟩</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> post_meas1_def ket_vec_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Measurement-post_meas1_bell11_fst"><span class="command">lemma</span></span> post_meas1_bell11_fst <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"post_meas1 <span class="numeral">2</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>1</sub>⟩</span> <span class="main">0</span> <span class="main">=</span> <span class="main">-</span> <span class="main">|</span>unit_vec <span class="numeral">4</span> <span class="numeral">2</span><span class="main">⟩</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span><span class="main">::</span><span class="quoted">nat</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> dim_row <span class="main">(</span><span class="main">-</span> <span class="main">|</span>unit_vec <span class="numeral">4</span> <span class="numeral">2</span><span class="main">⟩</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> dim_col <span class="main">(</span><span class="main">-</span> <span class="main">|</span>unit_vec <span class="numeral">4</span> <span class="numeral">2</span><span class="main">⟩</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ket_vec_def<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"post_meas1 <span class="numeral">2</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>1</sub>⟩</span> <span class="main">0</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span> <span class="main">|</span>unit_vec <span class="numeral">4</span> <span class="numeral">2</span><span class="main">⟩</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> post_meas1_def unit_vec_def select_index_def bell11_def ket_vec_def real_sqrt_divide<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"post_meas1 <span class="numeral">2</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>1</sub>⟩</span> <span class="main">0</span> <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span> <span class="main">|</span>unit_vec <span class="numeral">4</span> <span class="numeral">2</span><span class="main">⟩</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> post_meas1_def unit_vec_def select_index_def bell11_def ket_vec_def real_sqrt_divide<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"post_meas1 <span class="numeral">2</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>1</sub>⟩</span> <span class="main">0</span> <span class="main">$$</span> <span class="main">(</span><span class="numeral">2</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span> <span class="main">|</span>unit_vec <span class="numeral">4</span> <span class="numeral">2</span><span class="main">⟩</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="numeral">2</span><span class="main">,</span><span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> post_meas1_def unit_vec_def select_index_def bell11_def ket_vec_def real_sqrt_divide<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"post_meas1 <span class="numeral">2</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>1</sub>⟩</span> <span class="main">0</span> <span class="main">$$</span> <span class="main">(</span><span class="numeral">3</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span> <span class="main">|</span>unit_vec <span class="numeral">4</span> <span class="numeral">2</span><span class="main">⟩</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="numeral">3</span><span class="main">,</span><span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> post_meas1_def unit_vec_def select_index_def bell11_def ket_vec_def real_sqrt_divide<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"post_meas1 <span class="numeral">2</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>1</sub>⟩</span> <span class="main">0</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span> <span class="main">|</span>unit_vec <span class="numeral">4</span> <span class="numeral">2</span><span class="main">⟩</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>    
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_row <span class="main">(</span>post_meas1 <span class="numeral">2</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>1</sub>⟩</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> dim_row <span class="main">(</span><span class="main">-</span> <span class="main">|</span>unit_vec <span class="numeral">4</span> <span class="numeral">2</span><span class="main">⟩</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> post_meas1_def ket_vec_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_col <span class="main">(</span>post_meas1 <span class="numeral">2</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>1</sub>⟩</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> dim_col <span class="main">(</span><span class="main">-</span> <span class="main">|</span>unit_vec <span class="numeral">4</span> <span class="numeral">2</span><span class="main">⟩</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> post_meas1_def ket_vec_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Measurement-post_meas1_bell11_snd"><span class="command">lemma</span></span> post_meas1_bell11_snd <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"post_meas1 <span class="numeral">2</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>1</sub>⟩</span> <span class="main">1</span> <span class="main">=</span> <span class="main">|</span>unit_vec <span class="numeral">4</span> <span class="main">1</span><span class="main">⟩</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span><span class="main">::</span><span class="quoted">nat</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> dim_row <span class="main">|</span>unit_vec <span class="numeral">4</span> <span class="main">1</span><span class="main">⟩</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> dim_col <span class="main">|</span>unit_vec <span class="numeral">4</span> <span class="main">1</span><span class="main">⟩</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">=</span> <span class="main">0</span>"</span></span>  
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ket_vec_def<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"post_meas1 <span class="numeral">2</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>1</sub>⟩</span> <span class="main">1</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">|</span>unit_vec <span class="numeral">4</span> <span class="main">1</span><span class="main">⟩</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> post_meas1_def unit_vec_def select_index_def bell11_def ket_vec_def real_sqrt_divide<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"post_meas1 <span class="numeral">2</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>1</sub>⟩</span> <span class="main">1</span> <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">|</span>unit_vec <span class="numeral">4</span> <span class="main">1</span><span class="main">⟩</span> <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> post_meas1_def unit_vec_def select_index_def bell11_def ket_vec_def real_sqrt_divide <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> One_nat_def<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"post_meas1 <span class="numeral">2</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>1</sub>⟩</span> <span class="main">1</span> <span class="main">$$</span> <span class="main">(</span><span class="numeral">2</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">|</span>unit_vec <span class="numeral">4</span> <span class="main">1</span><span class="main">⟩</span> <span class="main">$$</span> <span class="main">(</span><span class="numeral">2</span><span class="main">,</span><span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> post_meas1_def unit_vec_def select_index_def bell11_def ket_vec_def real_sqrt_divide<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"post_meas1 <span class="numeral">2</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>1</sub>⟩</span> <span class="main">1</span> <span class="main">$$</span> <span class="main">(</span><span class="numeral">3</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">|</span>unit_vec <span class="numeral">4</span> <span class="main">1</span><span class="main">⟩</span> <span class="main">$$</span> <span class="main">(</span><span class="numeral">3</span><span class="main">,</span><span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> post_meas1_def unit_vec_def select_index_def bell11_def ket_vec_def real_sqrt_divide<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"post_meas1 <span class="numeral">2</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>1</sub>⟩</span> <span class="main">1</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">|</span>unit_vec <span class="numeral">4</span> <span class="main">1</span><span class="main">⟩</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_row <span class="main">(</span>post_meas1 <span class="numeral">2</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>1</sub>⟩</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> dim_row <span class="main">|</span>unit_vec <span class="numeral">4</span> <span class="main">1</span><span class="main">⟩</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> post_meas1_def ket_vec_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_col <span class="main">(</span>post_meas1 <span class="numeral">2</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>1</sub>⟩</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> dim_col <span class="main">|</span>unit_vec <span class="numeral">4</span> <span class="main">1</span><span class="main">⟩</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> post_meas1_def ket_vec_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="Entanglement">
<div class="head">
<h1>Theory Entanglement</h1>
</div>
<pre class="source"><span class="comment1">(* 
Authors: 

  Anthony Bordg, University of Cambridge, apdb3@cam.ac.uk;
  Yijun He, University of Cambridge, yh403@cam.ac.uk
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Quantum Entanglement›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Entanglement
<span class="keyword2"><span class="keyword">imports</span></span>
  <a href="#Quantum">Quantum</a>
  <a href="#More_Tensor">More_Tensor</a>
<span class="keyword2"><span class="keyword">begin</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹The Product States and Entangled States of a 2-qubits System›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Below we add the condition that <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">v</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">w</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> are two-dimensional states, otherwise 
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">u</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> can always be represented by the tensor product of the 1-dimensional vector <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="main"><span class="quoted"><span class="main">1</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and 
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">u</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> itself.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">prod_state2</span><span class="main">::</span> <span class="quoted"><span class="quoted">"complex Matrix.mat <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">prod_state2</span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main">≡</span> <span class="keyword1">if</span> state <span class="numeral">2</span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="keyword1">then</span> <span class="main">∃</span><span class="bound">v</span> <span class="bound">w</span><span class="main">.</span> state <span class="main">1</span> <span class="bound">v</span> <span class="main">∧</span> state <span class="main">1</span> <span class="bound">w</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main">=</span> <span class="bound">v</span> <span class="main">⨂</span> <span class="bound">w</span> <span class="keyword1">else</span> undefined"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">entangled2</span><span class="main">::</span> <span class="quoted"><span class="quoted">"complex Matrix.mat <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">entangled2</span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main">≡</span> <span class="main">¬</span> prod_state2 <span class="free"><span class="bound"><span class="entity">u</span></span></span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The Bell states are entangled states.›</span></span>

<span class="keyword1" id="Entanglement-bell00_is_entangled2"><span class="command">lemma</span></span> bell00_is_entangled2 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"entangled2 <span class="keyword1">|β<span class="hidden">⇩</span><sub>0</sub><span class="hidden">⇩</span><sub>0</sub>⟩</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">v</span> <span class="bound">w</span><span class="main">.</span> state <span class="main">1</span> <span class="bound">v</span> <span class="main">⟶</span> state <span class="main">1</span> <span class="bound">w</span> <span class="main">⟶</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>0</sub><span class="hidden">⇩</span><sub>0</sub>⟩</span> <span class="main">≠</span> <span class="bound">v</span> <span class="main">⨂</span> <span class="bound">w</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="main">(</span><span class="operator">rule</span> allI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">,</span></span><span class="main">(</span><span class="operator">rule</span> impI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> notI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">v</span> <span class="skolem">w</span>
    <span class="keyword3"><span class="command">assume</span></span> a0<span class="main">:</span><span class="quoted"><span class="quoted">"state <span class="main">1</span> <span class="skolem">v</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted">"state <span class="main">1</span> <span class="skolem">w</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="keyword1">|β<span class="hidden">⇩</span><sub>0</sub><span class="hidden">⇩</span><sub>0</sub>⟩</span> <span class="main">=</span> <span class="skolem">v</span> <span class="main">⨂</span> <span class="skolem">w</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">v</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">w</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">v</span> <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">w</span> <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
          <span class="main">(</span><span class="skolem">v</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">w</span> <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">v</span> <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">w</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">v</span> <span class="main">⨂</span> <span class="skolem">w</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">v</span> <span class="main">⨂</span> <span class="skolem">w</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="numeral">3</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">v</span> <span class="main">⨂</span> <span class="skolem">w</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">v</span> <span class="main">⨂</span> <span class="skolem">w</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="numeral">2</span><span class="main">,</span><span class="main">0</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> a0 a1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">|β<span class="hidden">⇩</span><sub>0</sub><span class="hidden">⇩</span><sub>0</sub>⟩</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">*</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>0</sub><span class="hidden">⇩</span><sub>0</sub>⟩</span> <span class="main">$$</span> <span class="main">(</span><span class="numeral">3</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>0</sub><span class="hidden">⇩</span><sub>0</sub>⟩</span> <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">*</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>0</sub><span class="hidden">⇩</span><sub>0</sub>⟩</span> <span class="main">$$</span> <span class="main">(</span><span class="numeral">2</span><span class="main">,</span><span class="main">0</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> a2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">/</span> sqrt <span class="numeral">2</span> <span class="main">*</span> <span class="main">1</span><span class="main">/</span>sqrt <span class="numeral">2</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> entangled2_def prod_state2_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Entanglement-bell01_is_entangled2"><span class="command">lemma</span></span> bell01_is_entangled2 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"entangled2 <span class="keyword1">|β<span class="hidden">⇩</span><sub>0</sub><span class="hidden">⇩</span><sub>1</sub>⟩</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">v</span> <span class="bound">w</span><span class="main">.</span> state <span class="main">1</span> <span class="bound">v</span> <span class="main">⟶</span> state <span class="main">1</span> <span class="bound">w</span> <span class="main">⟶</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>0</sub><span class="hidden">⇩</span><sub>1</sub>⟩</span> <span class="main">≠</span> <span class="bound">v</span> <span class="main">⨂</span> <span class="bound">w</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="main">(</span><span class="operator">rule</span> allI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">,</span></span><span class="main">(</span><span class="operator">rule</span> impI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> notI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">v</span> <span class="skolem">w</span>
    <span class="keyword3"><span class="command">assume</span></span> a0<span class="main">:</span><span class="quoted"><span class="quoted">"state <span class="main">1</span> <span class="skolem">v</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted">"state <span class="main">1</span> <span class="skolem">w</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="keyword1">|β<span class="hidden">⇩</span><sub>0</sub><span class="hidden">⇩</span><sub>1</sub>⟩</span> <span class="main">=</span> <span class="skolem">v</span> <span class="main">⨂</span> <span class="skolem">w</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">v</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">w</span> <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">v</span> <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">w</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
          <span class="main">(</span><span class="skolem">v</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">w</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">v</span> <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">w</span> <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">v</span> <span class="main">⨂</span> <span class="skolem">w</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">v</span> <span class="main">⨂</span> <span class="skolem">w</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="numeral">2</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">v</span> <span class="main">⨂</span> <span class="skolem">w</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">v</span> <span class="main">⨂</span> <span class="skolem">w</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="numeral">3</span><span class="main">,</span><span class="main">0</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> a0 a1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">|β<span class="hidden">⇩</span><sub>0</sub><span class="hidden">⇩</span><sub>1</sub>⟩</span> <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">*</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>0</sub><span class="hidden">⇩</span><sub>1</sub>⟩</span> <span class="main">$$</span> <span class="main">(</span><span class="numeral">2</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>0</sub><span class="hidden">⇩</span><sub>1</sub>⟩</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">*</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>0</sub><span class="hidden">⇩</span><sub>1</sub>⟩</span> <span class="main">$$</span> <span class="main">(</span><span class="numeral">3</span><span class="main">,</span><span class="main">0</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> a2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">/</span>sqrt <span class="numeral">2</span> <span class="main">*</span> <span class="main">1</span><span class="main">/</span>sqrt <span class="numeral">2</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> bell01_index <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> entangled2_def prod_state2_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Entanglement-bell10_is_entangled2"><span class="command">lemma</span></span> bell10_is_entangled2 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"entangled2 <span class="keyword1">|β<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>0</sub>⟩</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">v</span> <span class="bound">w</span><span class="main">.</span> state <span class="main">1</span> <span class="bound">v</span> <span class="main">⟶</span> state <span class="main">1</span> <span class="bound">w</span> <span class="main">⟶</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>0</sub>⟩</span> <span class="main">≠</span> <span class="bound">v</span> <span class="main">⨂</span> <span class="bound">w</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="main">(</span><span class="operator">rule</span> allI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">,</span></span><span class="main">(</span><span class="operator">rule</span> impI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> notI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">v</span> <span class="skolem">w</span>
    <span class="keyword3"><span class="command">assume</span></span> a0<span class="main">:</span><span class="quoted"><span class="quoted">"state <span class="main">1</span> <span class="skolem">v</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted">"state <span class="main">1</span> <span class="skolem">w</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="keyword1">|β<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>0</sub>⟩</span> <span class="main">=</span> <span class="skolem">v</span> <span class="main">⨂</span> <span class="skolem">w</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">v</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">w</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">v</span> <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">w</span> <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
          <span class="main">(</span><span class="skolem">v</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">w</span> <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">v</span> <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">w</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">v</span> <span class="main">⨂</span> <span class="skolem">w</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">v</span> <span class="main">⨂</span> <span class="skolem">w</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="numeral">3</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">v</span> <span class="main">⨂</span> <span class="skolem">w</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">v</span> <span class="main">⨂</span> <span class="skolem">w</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="numeral">2</span><span class="main">,</span><span class="main">0</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> a0 a1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">|β<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>0</sub>⟩</span> <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">*</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>0</sub>⟩</span> <span class="main">$$</span> <span class="main">(</span><span class="numeral">2</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>0</sub>⟩</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">*</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>0</sub>⟩</span> <span class="main">$$</span> <span class="main">(</span><span class="numeral">3</span><span class="main">,</span><span class="main">0</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> a2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">/</span>sqrt <span class="numeral">2</span> <span class="main">*</span> <span class="main">1</span><span class="main">/</span>sqrt <span class="numeral">2</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> entangled2_def prod_state2_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Entanglement-bell11_is_entangled2"><span class="command">lemma</span></span> bell11_is_entangled2 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"entangled2 <span class="keyword1">|β<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>1</sub>⟩</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">v</span> <span class="bound">w</span><span class="main">.</span> state <span class="main">1</span> <span class="bound">v</span> <span class="main">⟶</span> state <span class="main">1</span> <span class="bound">w</span> <span class="main">⟶</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>1</sub>⟩</span> <span class="main">≠</span> <span class="bound">v</span> <span class="main">⨂</span> <span class="bound">w</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="main">(</span><span class="operator">rule</span> allI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">,</span></span><span class="main">(</span><span class="operator">rule</span> impI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> notI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">v</span> <span class="skolem">w</span>
    <span class="keyword3"><span class="command">assume</span></span> a0<span class="main">:</span><span class="quoted"><span class="quoted">"state <span class="main">1</span> <span class="skolem">v</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted">"state <span class="main">1</span> <span class="skolem">w</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="keyword1">|β<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>1</sub>⟩</span> <span class="main">=</span> <span class="skolem">v</span> <span class="main">⨂</span> <span class="skolem">w</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">v</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">w</span> <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">v</span> <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">w</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
          <span class="main">(</span><span class="skolem">v</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">w</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">v</span> <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">w</span> <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">v</span> <span class="main">⨂</span> <span class="skolem">w</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">v</span> <span class="main">⨂</span> <span class="skolem">w</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="numeral">2</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">v</span> <span class="main">⨂</span> <span class="skolem">w</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">v</span> <span class="main">⨂</span> <span class="skolem">w</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="numeral">3</span><span class="main">,</span><span class="main">0</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> a0 a1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">|β<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>1</sub>⟩</span> <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">*</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>1</sub>⟩</span> <span class="main">$$</span> <span class="main">(</span><span class="numeral">2</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>1</sub>⟩</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">*</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>1</sub>⟩</span> <span class="main">$$</span> <span class="main">(</span><span class="numeral">3</span><span class="main">,</span><span class="main">0</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> a2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">/</span>sqrt <span class="numeral">2</span> <span class="main">*</span> <span class="main">1</span><span class="main">/</span>sqrt <span class="numeral">2</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> bell_11_index <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> entangled2_def prod_state2_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
An entangled state is a state that cannot be broken down as the tensor product of smaller states.
›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">prod_state</span><span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> complex Matrix.mat <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">prod_state</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main">≡</span> <span class="keyword1">if</span> state <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="keyword1">then</span> <span class="main">∃</span><span class="bound">n</span> <span class="bound">p</span><span class="main">::</span>nat<span class="main">.</span><span class="main">∃</span><span class="bound">v</span> <span class="bound">w</span><span class="main">.</span> state <span class="bound">n</span> <span class="bound">v</span> <span class="main">∧</span> state <span class="bound">p</span> <span class="bound">w</span> <span class="main">∧</span> 
  <span class="bound">n</span> <span class="main">&lt;</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">∧</span> <span class="bound">p</span> <span class="main">&lt;</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">∧</span>  <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main">=</span> <span class="bound">v</span> <span class="main">⨂</span> <span class="bound">w</span> <span class="keyword1">else</span> undefined"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">entangled</span><span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> complex Matrix.mat <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">entangled</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">≡</span> <span class="main">¬</span> <span class="main">(</span>prod_state <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span>"</span></span>

<span class="comment1">(* To do: as an exercise prove the equivalence between entangled2 and (entangled 2). *)</span>

<span class="keyword1" id="Entanglement-sanity_check"><span class="command">lemma</span></span> sanity_check<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span>entangled <span class="numeral">2</span> <span class="main">(</span>mat_of_cols_list <span class="numeral">2</span> <span class="main">[</span><span class="main">[</span><span class="main">1</span><span class="main">/</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">,</span> <span class="main">1</span><span class="main">/</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">]</span><span class="main">]</span> <span class="main">⨂</span> mat_of_cols_list <span class="numeral">2</span> <span class="main">[</span><span class="main">[</span><span class="main">1</span><span class="main">/</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">,</span> <span class="main">1</span><span class="main">/</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">]</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">=</span> mat_of_cols_list <span class="numeral">2</span> <span class="main">[</span><span class="main">[</span><span class="main">1</span><span class="main">/</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">,</span> <span class="main">1</span><span class="main">/</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">]</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"state <span class="main">1</span> <span class="skolem">u</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"dim_col <span class="skolem">u</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> u_def mat_of_cols_list_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> f<span class="main">:</span><span class="quoted"><span class="quoted">"dim_row <span class="skolem">u</span> <span class="main">=</span> <span class="numeral">2</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> u_def mat_of_cols_list_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∥</span>Matrix.col <span class="skolem">u</span> <span class="main">0</span><span class="main">∥</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="numeral">2</span><span class="main">.</span> <span class="main">(</span>cmod <span class="main">(</span><span class="skolem">u</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span>sqrt <span class="numeral">2</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span>sqrt <span class="numeral">2</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> u_def cmod_def numeral_2_eq_2<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∥</span>Matrix.col <span class="skolem">u</span> <span class="main">0</span><span class="main">∥</span> <span class="main">=</span> sqrt <span class="main">(</span><span class="main">(</span><span class="main">1</span><span class="main">/</span>sqrt <span class="numeral">2</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span>sqrt <span class="numeral">2</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> f <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Matrix.col_def u_def cpx_vec_length_def<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power_divide<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> state_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"state <span class="numeral">2</span> <span class="main">(</span><span class="skolem">u</span> <span class="main">⨂</span> <span class="skolem">u</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> tensor_state <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">metis</span> one_add_one<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> entangled_def prod_state_def <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹state <span class="main">1</span> <span class="skolem">u</span>›</span></span> one_less_numeral_iff semiring_norm<span class="main"><span class="main">(</span></span>76<span class="main"><span class="main">)</span></span> u_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="Quantum_Teleportation">
<div class="head">
<h1>Theory Quantum_Teleportation</h1>
</div>
<pre class="source"><span class="comment1">(* 
Authors: 

  Anthony Bordg, University of Cambridge, apdb3@cam.ac.uk;
  Yijun He, University of Cambridge, yh403@cam.ac.uk
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Quantum Teleportation›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Quantum_Teleportation
<span class="keyword2"><span class="keyword">imports</span></span> 
  <a href="#More_Tensor">More_Tensor</a>
  <a href="#Basics">Basics</a>
  <a href="#Measurement">Measurement</a>
<span class="keyword2"><span class="keyword">begin</span></span>


<span class="keyword1"><span class="command">definition</span></span> <span class="entity">alice</span><span class="main">::</span> <span class="quoted"><span class="quoted">"complex Matrix.mat <span class="main">⇒</span> complex Matrix.mat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">alice</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">≡</span> <span class="main">(</span>H <span class="main">⨂</span> Id <span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span>CNOT <span class="main">⨂</span> Id <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">⨂</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>0</sub><span class="hidden">⇩</span><sub>0</sub>⟩</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">M1</span><span class="main">::</span> <span class="quoted"><span class="quoted">"complex Matrix.mat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">M1</span> <span class="main">≡</span> mat_of_cols_list <span class="numeral">8</span> <span class="main">[</span><span class="main">[</span><span class="main">1</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">]</span><span class="main">,</span>
                          <span class="main">[</span><span class="main">0</span><span class="main">,</span> <span class="main">1</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">]</span><span class="main">,</span>
                          <span class="main">[</span><span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">1</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">]</span><span class="main">,</span>
                          <span class="main">[</span><span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">1</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">]</span><span class="main">,</span>
                          <span class="main">[</span><span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">1</span><span class="main">,</span> <span class="main">0</span><span class="main">]</span><span class="main">,</span>
                          <span class="main">[</span><span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">1</span><span class="main">]</span><span class="main">,</span>
                          <span class="main">[</span><span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">1</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">]</span><span class="main">,</span>
                          <span class="main">[</span><span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">1</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">]</span><span class="main">]</span>"</span></span>

<span class="keyword1" id="Quantum_Teleportation-tensor_prod_of_cnot_id_1"><span class="command">lemma</span></span> tensor_prod_of_cnot_id_1<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>CNOT <span class="main">⨂</span> Id <span class="main">1</span><span class="main">)</span> <span class="main">=</span> M1"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_col <span class="main">(</span>CNOT <span class="main">⨂</span> Id <span class="main">1</span><span class="main">)</span> <span class="main">=</span> dim_col M1"</span></span> 
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> CNOT_def Id_def mat_of_cols_list_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_row <span class="main">(</span>CNOT <span class="main">⨂</span> Id <span class="main">1</span><span class="main">)</span> <span class="main">=</span> dim_row M1"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> CNOT_def Id_def  mat_of_cols_list_def<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span><span class="main">::</span><span class="quoted">nat</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> dim_row M1"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> dim_col M1"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="numeral">8</span><span class="main">}</span> <span class="main">∧</span> <span class="skolem">j</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="numeral">8</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>  mat_of_cols_list_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>CNOT <span class="main">⨂</span> Id <span class="main">1</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> M1 <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Id_def CNOT_def mat_of_cols_list_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">M2</span><span class="main">::</span> <span class="quoted"><span class="quoted">"complex Matrix.mat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">M2</span> <span class="main">≡</span> mat_of_cols_list <span class="numeral">8</span> <span class="main">[</span><span class="main">[</span><span class="main">1</span><span class="main">/</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">1</span><span class="main">/</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">]</span><span class="main">,</span>
                          <span class="main">[</span><span class="main">0</span><span class="main">,</span> <span class="main">1</span><span class="main">/</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">1</span><span class="main">/</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">]</span><span class="main">,</span>
                          <span class="main">[</span><span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">1</span><span class="main">/</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">1</span><span class="main">/</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">,</span> <span class="main">0</span><span class="main">]</span><span class="main">,</span>
                          <span class="main">[</span><span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">1</span><span class="main">/</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">1</span><span class="main">/</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">]</span><span class="main">,</span>
                          <span class="main">[</span><span class="main">1</span><span class="main">/</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">-</span><span class="main">1</span><span class="main">/</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">]</span><span class="main">,</span>
                          <span class="main">[</span><span class="main">0</span><span class="main">,</span> <span class="main">1</span><span class="main">/</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">-</span><span class="main">1</span><span class="main">/</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">]</span><span class="main">,</span>
                          <span class="main">[</span><span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">1</span><span class="main">/</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">-</span><span class="main">1</span><span class="main">/</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">,</span> <span class="main">0</span><span class="main">]</span><span class="main">,</span>
                          <span class="main">[</span><span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">1</span><span class="main">/</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">-</span><span class="main">1</span><span class="main">/</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">]</span><span class="main">]</span>"</span></span>

<span class="keyword1" id="Quantum_Teleportation-tensor_prod_of_h_id_2"><span class="command">lemma</span></span> tensor_prod_of_h_id_2<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>H <span class="main">⨂</span> Id <span class="numeral">2</span><span class="main">)</span> <span class="main">=</span> M2"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_col <span class="main">(</span>H <span class="main">⨂</span> Id <span class="numeral">2</span><span class="main">)</span> <span class="main">=</span> dim_col M2"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> H_def Id_def mat_of_cols_list_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_row <span class="main">(</span>H <span class="main">⨂</span> Id <span class="numeral">2</span><span class="main">)</span> <span class="main">=</span> dim_row M2"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> H_def Id_def mat_of_cols_list_def<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span><span class="main">::</span><span class="quoted">nat</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> dim_row M2"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> dim_col M2"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="numeral">8</span><span class="main">}</span> <span class="main">∧</span> <span class="skolem">j</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="numeral">8</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>  mat_of_cols_list_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>H <span class="main">⨂</span> Id <span class="numeral">2</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> M2 <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Id_def H_def mat_of_cols_list_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Quantum_Teleportation-alice_step_1_state"><span class="command">lemma</span></span> alice_step_1_state <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"state <span class="main">1</span> <span class="free">φ</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"state <span class="numeral">3</span> <span class="main">(</span><span class="free">φ</span> <span class="main">⨂</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>0</sub><span class="hidden">⇩</span><sub>0</sub>⟩</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms bell00_is_state tensor_state <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">metis</span> One_nat_def Suc_1 numeral_3_eq_3 plus_1_eq_Suc<span class="main">)</span>

<span class="keyword1" id="Quantum_Teleportation-alice_step_2_state"><span class="command">lemma</span></span> alice_step_2_state<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"state <span class="main">1</span> <span class="free">φ</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"state <span class="numeral">3</span> <span class="main">(</span><span class="main">(</span>CNOT <span class="main">⨂</span> Id <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">φ</span> <span class="main">⨂</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>0</sub><span class="hidden">⇩</span><sub>0</sub>⟩</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"gate <span class="numeral">3</span> <span class="main">(</span>CNOT <span class="main">⨂</span> Id <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> CNOT_is_gate id_is_gate tensor_gate <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> numeral_plus_one semiring_norm<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"state <span class="numeral">3</span> <span class="main">(</span><span class="main">(</span>CNOT <span class="main">⨂</span> Id <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">φ</span> <span class="main">⨂</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>0</sub><span class="hidden">⇩</span><sub>0</sub>⟩</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Quantum_Teleportation-alice_state"><span class="command">lemma</span></span> alice_state <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"state <span class="main">1</span> <span class="free">φ</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"state <span class="numeral">3</span> <span class="main">(</span>alice <span class="free">φ</span><span class="main">)</span> "</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"gate <span class="numeral">3</span> <span class="main">(</span>H <span class="main">⨂</span> Id <span class="numeral">2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> tensor_gate id_is_gate H_is_gate <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">metis</span> eval_nat_numeral<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> plus_1_eq_Suc<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms alice_step_2_state <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> alice_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Quantum_Teleportation-alice_step_1"><span class="command">lemma</span></span> alice_step_1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"state <span class="main">1</span> <span class="free">φ</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">α</span> <span class="main">=</span> <span class="free">φ</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">β</span> <span class="main">=</span> <span class="free">φ</span> <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">φ</span> <span class="main">⨂</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>0</sub><span class="hidden">⇩</span><sub>0</sub>⟩</span><span class="main">)</span> <span class="main">=</span> mat_of_cols_list <span class="numeral">8</span> <span class="main">[</span><span class="main">[</span><span class="free">α</span><span class="main">/</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="free">α</span><span class="main">/</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">,</span><span class="free">β</span><span class="main">/</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="free">β</span><span class="main">/</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">]</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span> asm<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">=</span> mat_of_cols_list <span class="numeral">8</span> <span class="main">[</span><span class="main">[</span><span class="free">α</span><span class="main">/</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="free">α</span><span class="main">/</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">,</span><span class="free">β</span><span class="main">/</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="free">β</span><span class="main">/</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">]</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_row <span class="main">(</span><span class="free">φ</span> <span class="main">⨂</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>0</sub><span class="hidden">⇩</span><sub>0</sub>⟩</span><span class="main">)</span> <span class="main">=</span> dim_row <span class="skolem">v</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> alice_step_1_state state.dim_row mat_of_cols_list_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_col <span class="main">(</span><span class="free">φ</span> <span class="main">⨂</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>0</sub><span class="hidden">⇩</span><sub>0</sub>⟩</span><span class="main">)</span> <span class="main">=</span> dim_col <span class="skolem">v</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> alice_step_1_state state.is_column asm mat_of_cols_list_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span> <span class="bound">j</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> dim_row <span class="skolem">v</span> <span class="main">⟹</span> <span class="bound">j</span> <span class="main">&lt;</span> dim_col <span class="skolem">v</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">φ</span> <span class="main">⨂</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>0</sub><span class="hidden">⇩</span><sub>0</sub>⟩</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">v</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> dim_row <span class="skolem">v</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> dim_col <span class="skolem">v</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="numeral">8</span><span class="main">}</span> <span class="main">∧</span> <span class="skolem">j</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> asm <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mat_of_cols_list_def<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"dim_row <span class="keyword1">|β<span class="hidden">⇩</span><sub>0</sub><span class="hidden">⇩</span><sub>0</sub>⟩</span> <span class="main">=</span> <span class="numeral">4</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> bell00_is_state state_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"dim_col <span class="keyword1">|β<span class="hidden">⇩</span><sub>0</sub><span class="hidden">⇩</span><sub>0</sub>⟩</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> bell00_is_state state_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">φ</span> <span class="main">⨂</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>0</sub><span class="hidden">⇩</span><sub>0</sub>⟩</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">v</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> state_def assms asm <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bell00_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Quantum_Teleportation-alice_step_2"><span class="command">lemma</span></span> alice_step_2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"state <span class="main">1</span> <span class="free">φ</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">α</span> <span class="main">=</span> <span class="free">φ</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">β</span> <span class="main">=</span> <span class="free">φ</span> <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>CNOT <span class="main">⨂</span> Id <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">φ</span> <span class="main">⨂</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>0</sub><span class="hidden">⇩</span><sub>0</sub>⟩</span><span class="main">)</span> <span class="main">=</span> mat_of_cols_list <span class="numeral">8</span> <span class="main">[</span><span class="main">[</span><span class="free">α</span><span class="main">/</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="free">α</span><span class="main">/</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="free">β</span><span class="main">/</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">,</span><span class="free">β</span><span class="main">/</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">,</span><span class="main">0</span><span class="main">]</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword1"><span class="command">have</span></span> f0<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">φ</span> <span class="main">⨂</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>0</sub><span class="hidden">⇩</span><sub>0</sub>⟩</span><span class="main">)</span> <span class="main">=</span> mat_of_cols_list <span class="numeral">8</span> <span class="main">[</span><span class="main">[</span><span class="free">α</span><span class="main">/</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="free">α</span><span class="main">/</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">,</span><span class="free">β</span><span class="main">/</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="free">β</span><span class="main">/</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">]</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms alice_step_1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span> asm<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">=</span> mat_of_cols_list <span class="numeral">8</span> <span class="main">[</span><span class="main">[</span><span class="free">α</span><span class="main">/</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="free">α</span><span class="main">/</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="free">β</span><span class="main">/</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">,</span><span class="free">β</span><span class="main">/</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">,</span><span class="main">0</span><span class="main">]</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_row <span class="main">(</span><span class="main">(</span>CNOT <span class="main">⨂</span> Id <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">φ</span> <span class="main">⨂</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>0</sub><span class="hidden">⇩</span><sub>0</sub>⟩</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> dim_row <span class="skolem">v</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> alice_step_2_state state.dim_row mat_of_cols_list_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_col <span class="main">(</span><span class="main">(</span>CNOT <span class="main">⨂</span> Id <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">φ</span> <span class="main">⨂</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>0</sub><span class="hidden">⇩</span><sub>0</sub>⟩</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> dim_col <span class="skolem">v</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> alice_step_2_state state.is_column asm mat_of_cols_list_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span> <span class="bound">j</span><span class="main">.</span> <span class="bound">i</span><span class="main">&lt;</span>dim_row <span class="skolem">v</span> <span class="main">⟹</span> <span class="bound">j</span><span class="main">&lt;</span>dim_col <span class="skolem">v</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">(</span>CNOT <span class="main">⨂</span> Id <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">φ</span> <span class="main">⨂</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>0</sub><span class="hidden">⇩</span><sub>0</sub>⟩</span><span class="main">)</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">v</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> dim_row <span class="skolem">v</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> dim_col <span class="skolem">v</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="numeral">8</span><span class="main">::</span>nat<span class="main">}</span> <span class="main">∧</span> <span class="skolem">j</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> asm <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mat_of_cols_list_def<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>M1 <span class="main">*</span> <span class="main">(</span><span class="free">φ</span> <span class="main">⨂</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>0</sub><span class="hidden">⇩</span><sub>0</sub>⟩</span><span class="main">)</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">v</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f0 asm mat_of_cols_list_def times_mat_def scalar_prod_def<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>CNOT <span class="main">⨂</span> Id <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">φ</span> <span class="main">⨂</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>0</sub><span class="hidden">⇩</span><sub>0</sub>⟩</span><span class="main">)</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">v</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> tensor_prod_of_cnot_id_1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Quantum_Teleportation-alice_result"><span class="command">lemma</span></span> alice_result<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"state <span class="main">1</span> <span class="free">φ</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">α</span> <span class="main">=</span> <span class="free">φ</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">β</span> <span class="main">=</span> <span class="free">φ</span> <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"alice <span class="free">φ</span> <span class="main">=</span> mat_of_cols_list <span class="numeral">8</span> <span class="main">[</span><span class="main">[</span><span class="free">α</span><span class="main">/</span><span class="numeral">2</span><span class="main">,</span> <span class="free">β</span><span class="main">/</span><span class="numeral">2</span><span class="main">,</span> <span class="free">β</span><span class="main">/</span><span class="numeral">2</span><span class="main">,</span> <span class="free">α</span><span class="main">/</span><span class="numeral">2</span><span class="main">,</span> <span class="free">α</span><span class="main">/</span><span class="numeral">2</span><span class="main">,</span> <span class="main">-</span><span class="free">β</span><span class="main">/</span><span class="numeral">2</span><span class="main">,</span> <span class="main">-</span><span class="free">β</span><span class="main">/</span><span class="numeral">2</span><span class="main">,</span> <span class="free">α</span><span class="main">/</span><span class="numeral">2</span><span class="main">]</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span> a0<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">=</span> mat_of_cols_list <span class="numeral">8</span> <span class="main">[</span><span class="main">[</span><span class="free">α</span><span class="main">/</span><span class="numeral">2</span><span class="main">,</span> <span class="free">β</span><span class="main">/</span><span class="numeral">2</span><span class="main">,</span> <span class="free">β</span><span class="main">/</span><span class="numeral">2</span><span class="main">,</span> <span class="free">α</span><span class="main">/</span><span class="numeral">2</span><span class="main">,</span> <span class="free">α</span><span class="main">/</span><span class="numeral">2</span><span class="main">,</span> <span class="main">-</span><span class="free">β</span><span class="main">/</span><span class="numeral">2</span><span class="main">,</span> <span class="main">-</span><span class="free">β</span><span class="main">/</span><span class="numeral">2</span><span class="main">,</span> <span class="free">α</span><span class="main">/</span><span class="numeral">2</span><span class="main">]</span><span class="main">]</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">w</span></span> <span class="keyword2"><span class="keyword">where</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">=</span> <span class="main">(</span>CNOT <span class="main">⨂</span> Id <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">φ</span> <span class="main">⨂</span> <span class="keyword1">|β<span class="hidden">⇩</span><sub>0</sub><span class="hidden">⇩</span><sub>0</sub>⟩</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> f0<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">=</span> mat_of_cols_list <span class="numeral">8</span> <span class="main">[</span><span class="main">[</span><span class="free">α</span><span class="main">/</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="free">α</span><span class="main">/</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="free">β</span><span class="main">/</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">,</span> <span class="free">β</span><span class="main">/</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">,</span> <span class="main">0</span><span class="main">]</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms alice_step_2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_row <span class="main">(</span>alice <span class="free">φ</span><span class="main">)</span> <span class="main">=</span> dim_row <span class="skolem">v</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> alice_state state_def a0 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mat_of_cols_list_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_col <span class="main">(</span>alice <span class="free">φ</span><span class="main">)</span> <span class="main">=</span> dim_col <span class="skolem">v</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> alice_state state_def a0 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mat_of_cols_list_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span> <span class="bound">j</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> dim_row <span class="skolem">v</span> <span class="main">⟹</span> <span class="bound">j</span> <span class="main">&lt;</span> dim_col <span class="skolem">v</span> <span class="main">⟹</span> alice <span class="free">φ</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">v</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> dim_row <span class="skolem">v</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> dim_col <span class="skolem">v</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="numeral">8</span><span class="main">}</span> <span class="main">∧</span> <span class="skolem">j</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> a0 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Tensor.mat_of_cols_list_def<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>M2 <span class="main">*</span> <span class="skolem">w</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">v</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f0 a0 mat_of_cols_list_def times_mat_def scalar_prod_def<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"alice <span class="free">φ</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">v</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tensor_prod_of_h_id_2 alice_def a1<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
An application of function <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"alice"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> to a state <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">φ</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> of a 1-qubit system results in the following cases.
›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">alice_meas</span><span class="main">::</span> <span class="quoted"><span class="quoted">"complex Matrix.mat <span class="main">⇒</span> <span class="main">_</span>list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">alice_meas</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">=</span> <span class="main">[</span>
  <span class="main">(</span><span class="main">(</span>prob0 <span class="numeral">3</span> <span class="main">(</span>alice <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="main">0</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>prob0 <span class="numeral">3</span> <span class="main">(</span>post_meas0 <span class="numeral">3</span> <span class="main">(</span>alice <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="main">0</span><span class="main">)</span> <span class="main">1</span><span class="main">)</span><span class="main">,</span> post_meas0 <span class="numeral">3</span> <span class="main">(</span>post_meas0 <span class="numeral">3</span> <span class="main">(</span>alice <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="main">0</span><span class="main">)</span> <span class="main">1</span><span class="main">)</span>
<span class="main">,</span> <span class="main">(</span><span class="main">(</span>prob0 <span class="numeral">3</span> <span class="main">(</span>alice <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="main">0</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>prob1 <span class="numeral">3</span> <span class="main">(</span>post_meas0 <span class="numeral">3</span> <span class="main">(</span>alice <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="main">0</span><span class="main">)</span> <span class="main">1</span><span class="main">)</span><span class="main">,</span> post_meas1 <span class="numeral">3</span> <span class="main">(</span>post_meas0 <span class="numeral">3</span> <span class="main">(</span>alice <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="main">0</span><span class="main">)</span> <span class="main">1</span><span class="main">)</span>
<span class="main">,</span> <span class="main">(</span><span class="main">(</span>prob1 <span class="numeral">3</span> <span class="main">(</span>alice <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="main">0</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>prob0 <span class="numeral">3</span> <span class="main">(</span>post_meas1 <span class="numeral">3</span> <span class="main">(</span>alice <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="main">0</span><span class="main">)</span> <span class="main">1</span><span class="main">)</span><span class="main">,</span> post_meas0 <span class="numeral">3</span> <span class="main">(</span>post_meas1 <span class="numeral">3</span> <span class="main">(</span>alice <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="main">0</span><span class="main">)</span> <span class="main">1</span><span class="main">)</span>
<span class="main">,</span> <span class="main">(</span><span class="main">(</span>prob1 <span class="numeral">3</span> <span class="main">(</span>alice <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="main">0</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>prob1 <span class="numeral">3</span> <span class="main">(</span>post_meas1 <span class="numeral">3</span> <span class="main">(</span>alice <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="main">0</span><span class="main">)</span> <span class="main">1</span><span class="main">)</span><span class="main">,</span> post_meas1 <span class="numeral">3</span> <span class="main">(</span>post_meas1 <span class="numeral">3</span> <span class="main">(</span>alice <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="main">0</span><span class="main">)</span> <span class="main">1</span><span class="main">)</span>
<span class="main">]</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">alice_pos</span><span class="main">::</span> <span class="quoted"><span class="quoted">"complex Matrix.mat <span class="main">⇒</span> complex Matrix.mat <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">alice_pos</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">≡</span>  <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">=</span> mat_of_cols_list <span class="numeral">8</span> <span class="main">[</span><span class="main">[</span><span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">]</span><span class="main">]</span> <span class="main">∨</span>
                  <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">=</span> mat_of_cols_list <span class="numeral">8</span> <span class="main">[</span><span class="main">[</span><span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">]</span><span class="main">]</span> <span class="main">∨</span>
                  <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">=</span> mat_of_cols_list <span class="numeral">8</span> <span class="main">[</span><span class="main">[</span><span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">,</span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">]</span><span class="main">]</span> <span class="main">∨</span>
                  <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">=</span> mat_of_cols_list <span class="numeral">8</span> <span class="main">[</span><span class="main">[</span><span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">]</span><span class="main">]</span>"</span></span>

<span class="keyword1" id="Quantum_Teleportation-phi_vec_length"><span class="command">lemma</span></span> phi_vec_length<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"state <span class="main">1</span> <span class="free">φ</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"cmod<span class="main">(</span><span class="free">φ</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> cmod<span class="main">(</span><span class="free">φ</span> <span class="main">$$</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> set_2 assms state_def Matrix.col_def cpx_vec_length_def <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> atLeast0LessThan<span class="main">)</span>

<span class="keyword1" id="Quantum_Teleportation-select_index_3_subsets"><span class="command">lemma</span></span> select_index_3_subsets <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">j</span><span class="main">::</span>nat<span class="main">.</span> select_index <span class="numeral">3</span> <span class="main">0</span> <span class="bound">j</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="numeral">4</span><span class="main">,</span><span class="numeral">5</span><span class="main">,</span><span class="numeral">6</span><span class="main">,</span><span class="numeral">7</span><span class="main">}</span> <span class="main">∧</span>
         <span class="main">{</span><span class="bound">j</span><span class="main">::</span>nat<span class="main">.</span> <span class="bound">j</span> <span class="main">&lt;</span> <span class="numeral">8</span> <span class="main">∧</span> <span class="main">¬</span> select_index <span class="numeral">3</span> <span class="main">0</span> <span class="bound">j</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">}</span> <span class="main">∧</span>
         <span class="main">{</span><span class="bound">j</span><span class="main">::</span>nat<span class="main">.</span> select_index <span class="numeral">3</span> <span class="main">1</span> <span class="bound">j</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">6</span><span class="main">,</span><span class="numeral">7</span><span class="main">}</span> <span class="main">∧</span>
         <span class="main">{</span><span class="bound">j</span><span class="main">::</span>nat<span class="main">.</span> <span class="bound">j</span> <span class="main">&lt;</span> <span class="numeral">8</span> <span class="main">∧</span> <span class="main">¬</span> select_index <span class="numeral">3</span> <span class="main">1</span> <span class="bound">j</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="numeral">5</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">j</span><span class="main">::</span>nat<span class="main">.</span> select_index <span class="numeral">3</span> <span class="main">0</span> <span class="bound">j</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="numeral">4</span><span class="main">,</span><span class="numeral">5</span><span class="main">,</span><span class="numeral">6</span><span class="main">,</span><span class="numeral">7</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> select_index_def<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">j</span><span class="main">::</span>nat<span class="main">.</span> <span class="bound">j</span> <span class="main">&lt;</span> <span class="numeral">8</span> <span class="main">∧</span> <span class="main">¬</span> select_index <span class="numeral">3</span> <span class="main">0</span> <span class="bound">j</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> select_index_def<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> f1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">j</span><span class="main">::</span>nat<span class="main">.</span> select_index <span class="numeral">3</span> <span class="main">1</span> <span class="bound">j</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">6</span><span class="main">,</span><span class="numeral">7</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">j</span><span class="main">.</span> select_index <span class="numeral">3</span> <span class="main">1</span> <span class="bound">j</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">6</span><span class="main">,</span><span class="numeral">7</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">j</span><span class="main">::</span><span class="quoted">nat</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">j</span><span class="main">.</span> select_index <span class="numeral">3</span> <span class="main">1</span> <span class="bound">j</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="numeral">8</span><span class="main">}</span> <span class="main">∧</span> <span class="skolem">j</span> <span class="keyword1">mod</span> <span class="numeral">4</span> <span class="main">∈</span> <span class="main">{</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> select_index_def<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">∈</span> <span class="main">{</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">6</span><span class="main">,</span><span class="numeral">7</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">6</span><span class="main">,</span><span class="numeral">7</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound">j</span><span class="main">.</span> select_index <span class="numeral">3</span> <span class="main">1</span> <span class="bound">j</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> select_index_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">j</span><span class="main">::</span>nat<span class="main">.</span> <span class="bound">j</span> <span class="main">&lt;</span> <span class="numeral">8</span> <span class="main">∧</span> <span class="main">¬</span> select_index <span class="numeral">3</span> <span class="main">1</span> <span class="bound">j</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="numeral">5</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">j</span><span class="main">::</span>nat<span class="main">.</span> <span class="bound">j</span> <span class="main">&lt;</span> <span class="numeral">8</span> <span class="main">∧</span> <span class="bound">j</span> <span class="main">∉</span> <span class="main">{</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">6</span><span class="main">,</span><span class="numeral">7</span><span class="main">}</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="numeral">5</span><span class="main">}</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> f1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Quantum_Teleportation-prob_index_0_alice"><span class="command">lemma</span></span> prob_index_0_alice<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"state <span class="main">1</span> <span class="free">φ</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"prob0 <span class="numeral">3</span> <span class="main">(</span>alice <span class="free">φ</span><span class="main">)</span> <span class="main">0</span> <span class="main">=</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span> <span class="main">∧</span> prob1 <span class="numeral">3</span> <span class="main">(</span>alice <span class="free">φ</span><span class="main">)</span> <span class="main">0</span> <span class="main">=</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"prob0 <span class="numeral">3</span> <span class="main">(</span>alice <span class="free">φ</span><span class="main">)</span> <span class="main">0</span> <span class="main">=</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> alice_result assms prob0_def alice_state
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> One_nat_def phi_vec_length four_x_squared mult.commute 
nonzero_mult_div_cancel_right times_divide_eq_right zero_neq_numeral<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span><span class="quoted"><span class="quoted">"prob1 <span class="numeral">3</span> <span class="main">(</span>alice <span class="free">φ</span><span class="main">)</span> <span class="main">0</span> <span class="main">=</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> prob_sum_is_one<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="numeral">3</span>"</span></span> <span class="quoted"><span class="quoted">"alice <span class="free">φ</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span>"</span></span><span class="main">]</span> alice_state<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">φ</span>"</span></span><span class="main">]</span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Quantum_Teleportation-post_meas0_index_0_alice"><span class="command">lemma</span></span> post_meas0_index_0_alice<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"state <span class="main">1</span> <span class="free">φ</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">α</span> <span class="main">=</span> <span class="free">φ</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">β</span> <span class="main">=</span> <span class="free">φ</span> <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"post_meas0 <span class="numeral">3</span> <span class="main">(</span>alice <span class="free">φ</span><span class="main">)</span> <span class="main">0</span> <span class="main">=</span> 
mat_of_cols_list <span class="numeral">8</span> <span class="main">[</span><span class="main">[</span><span class="free">α</span><span class="main">/</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">,</span> <span class="free">β</span><span class="main">/</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">,</span> <span class="free">β</span><span class="main">/</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">,</span> <span class="free">α</span><span class="main">/</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">]</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span> asm<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">=</span> mat_of_cols_list <span class="numeral">8</span> <span class="main">[</span><span class="main">[</span><span class="free">α</span><span class="main">/</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">,</span><span class="free">β</span><span class="main">/</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">,</span><span class="free">β</span><span class="main">/</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">,</span><span class="free">α</span><span class="main">/</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">]</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_row <span class="main">(</span>post_meas0 <span class="numeral">3</span> <span class="main">(</span>alice <span class="free">φ</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> dim_row <span class="skolem">v</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> mat_of_cols_list_def post_meas0_def assms<span class="main">(</span>1<span class="main">)</span> alice_state ket_vec_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_col <span class="main">(</span>post_meas0 <span class="numeral">3</span> <span class="main">(</span>alice <span class="free">φ</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> dim_col <span class="skolem">v</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> mat_of_cols_list_def post_meas0_def assms<span class="main">(</span>1<span class="main">)</span> alice_state ket_vec_def asm <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span> <span class="bound">j</span><span class="main">.</span> <span class="bound">i</span><span class="main">&lt;</span>dim_row <span class="skolem">v</span> <span class="main">⟹</span> <span class="bound">j</span><span class="main">&lt;</span>dim_col <span class="skolem">v</span> <span class="main">⟹</span> post_meas0 <span class="numeral">3</span> <span class="main">(</span>alice <span class="free">φ</span><span class="main">)</span> <span class="main">0</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">v</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> dim_row <span class="skolem">v</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> dim_col <span class="skolem">v</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="numeral">8</span><span class="main">}</span> <span class="main">∧</span> <span class="skolem">j</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> asm set_8_atLeast0 mat_of_cols_list_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"post_meas0 <span class="numeral">3</span> <span class="main">(</span>alice <span class="free">φ</span><span class="main">)</span> <span class="main">0</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">v</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> post_meas0_def assms asm mat_of_cols_list_def ket_vec_def
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prob_index_0_alice<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> alice_result select_index_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Quantum_Teleportation-post_meas1_index_0_alice"><span class="command">lemma</span></span> post_meas1_index_0_alice<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"state <span class="main">1</span> <span class="free">φ</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">α</span> <span class="main">=</span> <span class="free">φ</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">β</span> <span class="main">=</span> <span class="free">φ</span> <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"post_meas1 <span class="numeral">3</span> <span class="main">(</span>alice <span class="free">φ</span><span class="main">)</span> <span class="main">0</span> <span class="main">=</span> mat_of_cols_list <span class="numeral">8</span> <span class="main">[</span><span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="free">α</span><span class="main">/</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">,</span><span class="main">-</span><span class="free">β</span><span class="main">/</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">,</span><span class="main">-</span><span class="free">β</span><span class="main">/</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">,</span><span class="free">α</span><span class="main">/</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">]</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span> asm<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">=</span> mat_of_cols_list <span class="numeral">8</span> <span class="main">[</span><span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="free">α</span><span class="main">/</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">,</span><span class="main">-</span><span class="free">β</span><span class="main">/</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">,</span><span class="main">-</span><span class="free">β</span><span class="main">/</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">,</span><span class="free">α</span><span class="main">/</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">]</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_row <span class="main">(</span>post_meas1 <span class="numeral">3</span> <span class="main">(</span>alice <span class="free">φ</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> dim_row <span class="skolem">v</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> mat_of_cols_list_def post_meas1_def assms<span class="main">(</span>1<span class="main">)</span> alice_state ket_vec_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_col <span class="main">(</span>post_meas1 <span class="numeral">3</span> <span class="main">(</span>alice <span class="free">φ</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> dim_col <span class="skolem">v</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> mat_of_cols_list_def post_meas1_def assms<span class="main">(</span>1<span class="main">)</span> alice_state ket_vec_def asm <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span> <span class="bound">j</span><span class="main">.</span> <span class="bound">i</span><span class="main">&lt;</span>dim_row <span class="skolem">v</span> <span class="main">⟹</span> <span class="bound">j</span><span class="main">&lt;</span>dim_col <span class="skolem">v</span> <span class="main">⟹</span> post_meas1 <span class="numeral">3</span> <span class="main">(</span>alice <span class="free">φ</span><span class="main">)</span> <span class="main">0</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">v</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> dim_row <span class="skolem">v</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> dim_col <span class="skolem">v</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="numeral">8</span><span class="main">}</span> <span class="main">∧</span> <span class="skolem">j</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> asm set_8_atLeast0 mat_of_cols_list_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"post_meas1 <span class="numeral">3</span> <span class="main">(</span>alice <span class="free">φ</span><span class="main">)</span> <span class="main">0</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">v</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> post_meas1_def assms asm mat_of_cols_list_def ket_vec_def
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prob_index_0_alice<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> alice_result select_index_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Quantum_Teleportation-post_meas0_index_0_alice_state"><span class="command">lemma</span></span> post_meas0_index_0_alice_state <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"state <span class="main">1</span> <span class="free">φ</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"state <span class="numeral">3</span> <span class="main">(</span>post_meas0 <span class="numeral">3</span> <span class="main">(</span>alice <span class="free">φ</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prob_index_0_alice<span class="main">)</span>

<span class="keyword1" id="Quantum_Teleportation-post_meas1_index_0_alice_state"><span class="command">lemma</span></span> post_meas1_index_0_alice_state <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"state <span class="main">1</span> <span class="free">φ</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"state <span class="numeral">3</span> <span class="main">(</span>post_meas1 <span class="numeral">3</span> <span class="main">(</span>alice <span class="free">φ</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prob_index_0_alice<span class="main">)</span>

<span class="keyword1" id="Quantum_Teleportation-Alice_case"><span class="command">lemma</span></span> Alice_case <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"state <span class="main">1</span> <span class="free">φ</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"state <span class="numeral">3</span> <span class="free">q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"List.member <span class="main">(</span>alice_meas <span class="free">φ</span><span class="main">)</span> <span class="main">(</span><span class="free">p</span><span class="main">,</span> <span class="free">q</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"alice_pos <span class="free">φ</span> <span class="free">q</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">α</span></span> <span class="skolem"><span class="skolem">β</span></span> <span class="keyword2"><span class="keyword">where</span></span> a0<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">α</span> <span class="main">=</span> <span class="free">φ</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">β</span> <span class="main">=</span> <span class="free">φ</span> <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> f0<span class="main">:</span><span class="quoted"><span class="quoted">"prob0 <span class="numeral">3</span> <span class="main">(</span>Matrix.mat <span class="numeral">8</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="main">[</span><span class="main">[</span><span class="free">φ</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">/</span>sqrt <span class="numeral">2</span><span class="main">,</span> <span class="free">φ</span> <span class="main">$$</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">/</span>sqrt <span class="numeral">2</span><span class="main">,</span> 
                    <span class="free">φ</span> <span class="main">$$</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">/</span>sqrt <span class="numeral">2</span><span class="main">,</span> <span class="free">φ</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">/</span>sqrt <span class="numeral">2</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">]</span><span class="main">]</span><span class="main">!</span><span class="bound">j</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> post_meas0_index_0_alice prob0_def mat_of_cols_list_def post_meas0_index_0_alice_state 
assms<span class="main">(</span>1<span class="main">)</span> a0 a1 select_index_3_subsets <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> norm_divide power_divide phi_vec_length<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> f1<span class="main">:</span><span class="quoted"><span class="quoted">"prob1 <span class="numeral">3</span> <span class="main">(</span>Matrix.mat <span class="numeral">8</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="main">[</span><span class="main">[</span><span class="free">φ</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">/</span>sqrt <span class="numeral">2</span><span class="main">,</span> <span class="free">φ</span> <span class="main">$$</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">/</span>sqrt <span class="numeral">2</span><span class="main">,</span> 
                    <span class="free">φ</span> <span class="main">$$</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">/</span>sqrt <span class="numeral">2</span><span class="main">,</span> <span class="free">φ</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">/</span>sqrt <span class="numeral">2</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">]</span><span class="main">]</span> <span class="main">!</span> <span class="bound">j</span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> post_meas0_index_0_alice prob1_def mat_of_cols_list_def post_meas0_index_0_alice_state 
assms<span class="main">(</span>1<span class="main">)</span> a0 a1 select_index_3_subsets <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> norm_divide power_divide phi_vec_length <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> f2<span class="main">:</span><span class="quoted"><span class="quoted">"prob0 <span class="numeral">3</span> <span class="main">(</span>Matrix.mat <span class="numeral">8</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> 
          <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="main">[</span><span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="free">φ</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">/</span>complex_of_real <span class="main">(</span>sqrt <span class="numeral">2</span><span class="main">)</span><span class="main">,</span><span class="main">-</span><span class="main">(</span><span class="free">φ</span> <span class="main">$$</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">/</span>complex_of_real <span class="main">(</span>sqrt <span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> 
<span class="main">-</span><span class="main">(</span><span class="free">φ</span> <span class="main">$$</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">/</span>complex_of_real <span class="main">(</span>sqrt <span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">,</span><span class="free">φ</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">/</span>complex_of_real <span class="main">(</span>sqrt <span class="numeral">2</span><span class="main">)</span><span class="main">]</span><span class="main">]</span> <span class="main">!</span> <span class="bound">j</span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> post_meas1_index_0_alice prob0_def mat_of_cols_list_def post_meas1_index_0_alice_state 
      assms<span class="main">(</span>1<span class="main">)</span> a0 a1 select_index_3_subsets <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> norm_divide power_divide phi_vec_length<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> f3<span class="main">:</span><span class="quoted"><span class="quoted">"prob1 <span class="numeral">3</span> <span class="main">(</span>Matrix.mat <span class="numeral">8</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> 
          <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="main">[</span><span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="free">φ</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">/</span>complex_of_real <span class="main">(</span>sqrt <span class="numeral">2</span><span class="main">)</span><span class="main">,</span><span class="main">-</span><span class="main">(</span><span class="free">φ</span> <span class="main">$$</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">/</span>complex_of_real <span class="main">(</span>sqrt <span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> 
<span class="main">-</span><span class="main">(</span><span class="free">φ</span> <span class="main">$$</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">/</span>complex_of_real <span class="main">(</span>sqrt <span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> <span class="free">φ</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">/</span>complex_of_real <span class="main">(</span>sqrt <span class="numeral">2</span><span class="main">)</span><span class="main">]</span><span class="main">]</span> <span class="main">!</span> <span class="bound">j</span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> post_meas1_index_0_alice prob1_def mat_of_cols_list_def post_meas1_index_0_alice_state 
assms<span class="main">(</span>1<span class="main">)</span> a0 a1 select_index_3_subsets <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> norm_divide power_divide phi_vec_length <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">p</span><span class="main">,</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>prob0 <span class="numeral">3</span> <span class="main">(</span>alice <span class="free">φ</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>prob0 <span class="numeral">3</span> <span class="main">(</span>post_meas0 <span class="numeral">3</span> <span class="main">(</span>alice <span class="free">φ</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span> <span class="main">1</span><span class="main">)</span><span class="main">,</span> post_meas0 <span class="numeral">3</span> <span class="main">(</span>post_meas0 <span class="numeral">3</span> <span class="main">(</span>alice <span class="free">φ</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span> <span class="main">1</span><span class="main">)</span> <span class="main">∨</span>
        <span class="main">(</span><span class="free">p</span><span class="main">,</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>prob0 <span class="numeral">3</span> <span class="main">(</span>alice <span class="free">φ</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>prob1 <span class="numeral">3</span> <span class="main">(</span>post_meas0 <span class="numeral">3</span> <span class="main">(</span>alice <span class="free">φ</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span> <span class="main">1</span><span class="main">)</span><span class="main">,</span> post_meas1 <span class="numeral">3</span> <span class="main">(</span>post_meas0 <span class="numeral">3</span> <span class="main">(</span>alice <span class="free">φ</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span> <span class="main">1</span><span class="main">)</span> <span class="main">∨</span>
        <span class="main">(</span><span class="free">p</span><span class="main">,</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>prob1 <span class="numeral">3</span> <span class="main">(</span>alice <span class="free">φ</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>prob0 <span class="numeral">3</span> <span class="main">(</span>post_meas1 <span class="numeral">3</span> <span class="main">(</span>alice <span class="free">φ</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span> <span class="main">1</span><span class="main">)</span><span class="main">,</span> post_meas0 <span class="numeral">3</span> <span class="main">(</span>post_meas1 <span class="numeral">3</span> <span class="main">(</span>alice <span class="free">φ</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span> <span class="main">1</span><span class="main">)</span> <span class="main">∨</span>
        <span class="main">(</span><span class="free">p</span><span class="main">,</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>prob1 <span class="numeral">3</span> <span class="main">(</span>alice <span class="free">φ</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>prob1 <span class="numeral">3</span> <span class="main">(</span>post_meas1 <span class="numeral">3</span> <span class="main">(</span>alice <span class="free">φ</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span> <span class="main">1</span><span class="main">)</span><span class="main">,</span> post_meas1 <span class="numeral">3</span> <span class="main">(</span>post_meas1 <span class="numeral">3</span> <span class="main">(</span>alice <span class="free">φ</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span> alice_meas_def List.member_def <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">smt</span> list.distinct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> list.exhaust list.inject member_rec<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> member_rec<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">=</span> post_meas0 <span class="numeral">3</span> <span class="main">(</span>post_meas0 <span class="numeral">3</span> <span class="main">(</span>alice <span class="free">φ</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span> <span class="main">1</span> <span class="main">∨</span> <span class="free">q</span> <span class="main">=</span> post_meas1 <span class="numeral">3</span> <span class="main">(</span>post_meas0 <span class="numeral">3</span> <span class="main">(</span>alice <span class="free">φ</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span> <span class="main">1</span> <span class="main">∨</span>
             <span class="free">q</span> <span class="main">=</span> post_meas0 <span class="numeral">3</span> <span class="main">(</span>post_meas1 <span class="numeral">3</span> <span class="main">(</span>alice <span class="free">φ</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span> <span class="main">1</span> <span class="main">∨</span> <span class="free">q</span> <span class="main">=</span> post_meas1 <span class="numeral">3</span> <span class="main">(</span>post_meas1 <span class="numeral">3</span> <span class="main">(</span>alice <span class="free">φ</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"post_meas0 <span class="numeral">3</span> <span class="main">(</span>post_meas0 <span class="numeral">3</span> <span class="main">(</span>alice <span class="free">φ</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span> <span class="main">1</span> <span class="main">=</span> mat_of_cols_list <span class="numeral">8</span> <span class="main">[</span><span class="main">[</span><span class="skolem">α</span><span class="main">,</span><span class="skolem">β</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">]</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span> asm<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">=</span> mat_of_cols_list <span class="numeral">8</span> <span class="main">[</span><span class="main">[</span><span class="skolem">α</span><span class="main">,</span> <span class="skolem">β</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">]</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_row <span class="main">(</span>post_meas0 <span class="numeral">3</span> <span class="main">(</span>post_meas0 <span class="numeral">3</span> <span class="main">(</span>alice <span class="free">φ</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> dim_row <span class="skolem">v</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> mat_of_cols_list_def post_meas0_def ket_vec_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_col <span class="main">(</span>post_meas0 <span class="numeral">3</span> <span class="main">(</span>post_meas0 <span class="numeral">3</span> <span class="main">(</span>alice <span class="free">φ</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> dim_col <span class="skolem">v</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> mat_of_cols_list_def post_meas0_def ket_vec_def asm <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span> <span class="bound">j</span><span class="main">.</span> <span class="bound">i</span><span class="main">&lt;</span>dim_row <span class="skolem">v</span> <span class="main">⟹</span> <span class="bound">j</span><span class="main">&lt;</span>dim_col <span class="skolem">v</span> <span class="main">⟹</span> post_meas0 <span class="numeral">3</span> <span class="main">(</span>post_meas0 <span class="numeral">3</span> <span class="main">(</span>alice <span class="free">φ</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span> <span class="main">1</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">v</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> dim_row <span class="skolem">v</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> dim_col <span class="skolem">v</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="numeral">8</span><span class="main">}</span> <span class="main">∧</span> <span class="skolem">j</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> asm mat_of_cols_list_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"post_meas0 <span class="numeral">3</span> <span class="main">(</span>post_meas0 <span class="numeral">3</span> <span class="main">(</span>alice <span class="free">φ</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span> <span class="main">1</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">v</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> post_meas0_index_0_alice assms<span class="main">(</span>1<span class="main">)</span> a0 a1
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> post_meas0_def asm mat_of_cols_list_def ket_vec_def select_index_def
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f0 real_sqrt_divide<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"post_meas1 <span class="numeral">3</span> <span class="main">(</span>post_meas0 <span class="numeral">3</span> <span class="main">(</span>alice <span class="free">φ</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span> <span class="main">1</span> <span class="main">=</span> mat_of_cols_list <span class="numeral">8</span> <span class="main">[</span><span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="skolem">β</span><span class="main">,</span><span class="skolem">α</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">]</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span> asm<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">=</span> mat_of_cols_list <span class="numeral">8</span> <span class="main">[</span><span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="skolem">β</span><span class="main">,</span><span class="skolem">α</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">]</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_row <span class="main">(</span>post_meas1 <span class="numeral">3</span> <span class="main">(</span>post_meas0 <span class="numeral">3</span> <span class="main">(</span>alice <span class="free">φ</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> dim_row <span class="skolem">v</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> mat_of_cols_list_def post_meas1_def ket_vec_def asm <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_col <span class="main">(</span>post_meas1 <span class="numeral">3</span> <span class="main">(</span>post_meas0 <span class="numeral">3</span> <span class="main">(</span>alice <span class="free">φ</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> dim_col <span class="skolem">v</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> mat_of_cols_list_def post_meas1_def ket_vec_def asm <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span> <span class="bound">j</span><span class="main">.</span> <span class="bound">i</span><span class="main">&lt;</span>dim_row <span class="skolem">v</span> <span class="main">⟹</span> <span class="bound">j</span><span class="main">&lt;</span>dim_col <span class="skolem">v</span> <span class="main">⟹</span> post_meas1 <span class="numeral">3</span> <span class="main">(</span>post_meas0 <span class="numeral">3</span> <span class="main">(</span>alice <span class="free">φ</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span> <span class="main">1</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">v</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> dim_row <span class="skolem">v</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> dim_col <span class="skolem">v</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="numeral">8</span><span class="main">}</span> <span class="main">∧</span> <span class="skolem">j</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> asm mat_of_cols_list_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"post_meas1 <span class="numeral">3</span> <span class="main">(</span>post_meas0 <span class="numeral">3</span> <span class="main">(</span>alice <span class="free">φ</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span> <span class="main">1</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">v</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> post_meas0_index_0_alice assms<span class="main">(</span>1<span class="main">)</span> a0 a1
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> post_meas1_def asm mat_of_cols_list_def ket_vec_def select_index_def
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f1 real_sqrt_divide<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"post_meas0 <span class="numeral">3</span> <span class="main">(</span>post_meas1 <span class="numeral">3</span> <span class="main">(</span>alice <span class="free">φ</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span> <span class="main">1</span> <span class="main">=</span> mat_of_cols_list <span class="numeral">8</span> <span class="main">[</span><span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="skolem">α</span><span class="main">,</span><span class="main">-</span><span class="skolem">β</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">]</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span> asm<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">=</span> mat_of_cols_list <span class="numeral">8</span> <span class="main">[</span><span class="main">[</span><span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="skolem">α</span><span class="main">,</span> <span class="main">-</span><span class="skolem">β</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">]</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_row <span class="main">(</span>post_meas0 <span class="numeral">3</span> <span class="main">(</span>post_meas1 <span class="numeral">3</span> <span class="main">(</span>alice <span class="free">φ</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> dim_row <span class="skolem">v</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> mat_of_cols_list_def post_meas0_def ket_vec_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_col <span class="main">(</span>post_meas0 <span class="numeral">3</span> <span class="main">(</span>post_meas1 <span class="numeral">3</span> <span class="main">(</span>alice <span class="free">φ</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> dim_col <span class="skolem">v</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> mat_of_cols_list_def post_meas0_def ket_vec_def asm <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span> <span class="bound">j</span><span class="main">.</span> <span class="bound">i</span><span class="main">&lt;</span>dim_row <span class="skolem">v</span> <span class="main">⟹</span> <span class="bound">j</span><span class="main">&lt;</span>dim_col <span class="skolem">v</span> <span class="main">⟹</span> post_meas0 <span class="numeral">3</span> <span class="main">(</span>post_meas1 <span class="numeral">3</span> <span class="main">(</span>alice <span class="free">φ</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span> <span class="main">1</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">v</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> dim_row <span class="skolem">v</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> dim_col <span class="skolem">v</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="numeral">8</span><span class="main">}</span> <span class="main">∧</span> <span class="skolem">j</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> asm mat_of_cols_list_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"post_meas0 <span class="numeral">3</span> <span class="main">(</span>post_meas1 <span class="numeral">3</span> <span class="main">(</span>alice <span class="free">φ</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span> <span class="main">1</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">v</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> post_meas1_index_0_alice assms<span class="main">(</span>1<span class="main">)</span> a0 a1
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> post_meas0_def asm mat_of_cols_list_def ket_vec_def select_index_def
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f2 real_sqrt_divide<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"post_meas1 <span class="numeral">3</span> <span class="main">(</span>post_meas1 <span class="numeral">3</span> <span class="main">(</span>alice <span class="free">φ</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span> <span class="main">1</span> <span class="main">=</span> mat_of_cols_list <span class="numeral">8</span> <span class="main">[</span><span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">-</span><span class="skolem">β</span><span class="main">,</span><span class="skolem">α</span><span class="main">]</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span> asm<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">=</span> mat_of_cols_list <span class="numeral">8</span> <span class="main">[</span><span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">-</span><span class="skolem">β</span><span class="main">,</span><span class="skolem">α</span><span class="main">]</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_row <span class="main">(</span>post_meas1 <span class="numeral">3</span> <span class="main">(</span>post_meas1 <span class="numeral">3</span> <span class="main">(</span>alice <span class="free">φ</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> dim_row <span class="skolem">v</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> mat_of_cols_list_def post_meas1_def ket_vec_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_col <span class="main">(</span>post_meas1 <span class="numeral">3</span> <span class="main">(</span>post_meas1 <span class="numeral">3</span> <span class="main">(</span>alice <span class="free">φ</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> dim_col <span class="skolem">v</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> mat_of_cols_list_def post_meas1_def ket_vec_def asm <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span> <span class="bound">j</span><span class="main">.</span> <span class="bound">i</span><span class="main">&lt;</span>dim_row <span class="skolem">v</span> <span class="main">⟹</span> <span class="bound">j</span><span class="main">&lt;</span>dim_col <span class="skolem">v</span> <span class="main">⟹</span> post_meas1 <span class="numeral">3</span> <span class="main">(</span>post_meas1 <span class="numeral">3</span> <span class="main">(</span>alice <span class="free">φ</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span> <span class="main">1</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">v</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> dim_row <span class="skolem">v</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> dim_col <span class="skolem">v</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="numeral">8</span><span class="main">}</span> <span class="main">∧</span> <span class="skolem">j</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> asm mat_of_cols_list_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"post_meas1 <span class="numeral">3</span> <span class="main">(</span>post_meas1 <span class="numeral">3</span> <span class="main">(</span>alice <span class="free">φ</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span> <span class="main">1</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">v</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> post_meas1_index_0_alice assms<span class="main">(</span>1<span class="main">)</span> a0 a1
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> post_meas1_def asm mat_of_cols_list_def ket_vec_def select_index_def
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f3 real_sqrt_divide<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> alice_pos_def a0 a1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">datatype</span></span> bit <span class="main">=</span> zero <span class="main">|</span> one

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">alice_out</span><span class="main">::</span> <span class="quoted"><span class="quoted">"complex Matrix.mat <span class="main">=&gt;</span> complex Matrix.mat <span class="main">=&gt;</span> bit <span class="main">×</span> bit"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">alice_out</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">≡</span> 
<span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">=</span> mat_of_cols_list <span class="numeral">8</span> <span class="main">[</span><span class="main">[</span><span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">]</span><span class="main">]</span> <span class="keyword1">then</span> <span class="main">(</span>zero<span class="main">,</span> zero<span class="main">)</span> <span class="keyword1">else</span>
  <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">=</span> mat_of_cols_list <span class="numeral">8</span> <span class="main">[</span><span class="main">[</span><span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">]</span><span class="main">]</span> <span class="keyword1">then</span> <span class="main">(</span>zero<span class="main">,</span> one<span class="main">)</span> <span class="keyword1">else</span>
    <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">=</span> mat_of_cols_list <span class="numeral">8</span> <span class="main">[</span><span class="main">[</span><span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">,</span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">]</span><span class="main">]</span> <span class="keyword1">then</span> <span class="main">(</span>one<span class="main">,</span> zero<span class="main">)</span> <span class="keyword1">else</span>
      <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">=</span> mat_of_cols_list <span class="numeral">8</span> <span class="main">[</span><span class="main">[</span><span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">]</span><span class="main">]</span> <span class="keyword1">then</span> <span class="main">(</span>one<span class="main">,</span> one<span class="main">)</span> <span class="keyword1">else</span> 
        undefined"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">bob</span><span class="main">::</span> <span class="quoted"><span class="quoted">"complex Matrix.mat <span class="main">=&gt;</span> bit <span class="main">×</span> bit <span class="main">⇒</span> complex Matrix.mat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">bob</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">≡</span> 
<span class="keyword1">if</span> <span class="main">(</span>fst <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">,</span> snd <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>zero<span class="main">,</span> zero<span class="main">)</span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="keyword1">else</span> 
  <span class="keyword1">if</span> <span class="main">(</span>fst <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">,</span> snd <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>zero<span class="main">,</span> one<span class="main">)</span> <span class="keyword1">then</span> <span class="main">(</span>Id <span class="numeral">2</span> <span class="main">⨂</span> X<span class="main">)</span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="keyword1">else</span>
    <span class="keyword1">if</span> <span class="main">(</span>fst <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">,</span> snd <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>one<span class="main">,</span> zero<span class="main">)</span> <span class="keyword1">then</span> <span class="main">(</span>Id <span class="numeral">2</span> <span class="main">⨂</span> Z<span class="main">)</span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="keyword1">else</span>
      <span class="keyword1">if</span> <span class="main">(</span>fst <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">,</span> snd <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>one<span class="main">,</span> one<span class="main">)</span> <span class="keyword1">then</span> <span class="main">(</span>Id <span class="numeral">2</span> <span class="main">⨂</span> Z <span class="main">*</span> X<span class="main">)</span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="keyword1">else</span> 
        undefined"</span></span>

<span class="keyword1" id="Quantum_Teleportation-alice_out_unique"><span class="command">lemma</span></span> alice_out_unique <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"state <span class="main">1</span> <span class="free">φ</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Matrix.mat <span class="numeral">8</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="main">[</span><span class="main">[</span><span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="free">φ</span> <span class="main">$$</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">,</span> <span class="free">φ</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">]</span><span class="main">]</span><span class="main">!</span><span class="bound">j</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span> <span class="main">≠</span>
         Matrix.mat <span class="numeral">8</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="main">[</span><span class="main">[</span><span class="free">φ</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">,</span> <span class="free">φ</span> <span class="main">$$</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">]</span><span class="main">]</span><span class="main">!</span><span class="bound">j</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span> <span class="main">∧</span> 
         Matrix.mat <span class="numeral">8</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="main">[</span><span class="main">[</span><span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="free">φ</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">,</span> <span class="main">-</span><span class="free">φ</span> <span class="main">$$</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">]</span><span class="main">]</span><span class="main">!</span><span class="bound">j</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span> <span class="main">≠</span>
         Matrix.mat <span class="numeral">8</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="main">[</span><span class="main">[</span><span class="free">φ</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">,</span> <span class="free">φ</span> <span class="main">$$</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">]</span><span class="main">]</span><span class="main">!</span><span class="bound">j</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span> <span class="main">∧</span> 
         Matrix.mat <span class="numeral">8</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="main">[</span><span class="main">[</span><span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">-</span><span class="free">φ</span> <span class="main">$$</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">,</span> <span class="free">φ</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">]</span><span class="main">]</span><span class="main">!</span><span class="bound">j</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span> <span class="main">≠</span>
         Matrix.mat <span class="numeral">8</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="main">[</span><span class="main">[</span><span class="free">φ</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">,</span> <span class="free">φ</span> <span class="main">$$</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">]</span><span class="main">]</span><span class="main">!</span><span class="bound">j</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span> <span class="main">∧</span> 
         Matrix.mat <span class="numeral">8</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="main">[</span><span class="main">[</span><span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="free">φ</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">,</span> <span class="main">-</span><span class="free">φ</span> <span class="main">$$</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">]</span><span class="main">]</span><span class="main">!</span><span class="bound">j</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span> <span class="main">≠</span>
         Matrix.mat <span class="numeral">8</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="main">[</span><span class="main">[</span><span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="free">φ</span> <span class="main">$$</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">,</span> <span class="free">φ</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">]</span><span class="main">]</span><span class="main">!</span><span class="bound">j</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span> <span class="main">∧</span> 
         Matrix.mat <span class="numeral">8</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="main">[</span><span class="main">[</span><span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">-</span><span class="free">φ</span> <span class="main">$$</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">,</span> <span class="free">φ</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">]</span><span class="main">]</span><span class="main">!</span><span class="bound">j</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span> <span class="main">≠</span>
         Matrix.mat <span class="numeral">8</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="main">[</span><span class="main">[</span><span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="free">φ</span> <span class="main">$$</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">,</span> <span class="free">φ</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">]</span><span class="main">]</span><span class="main">!</span><span class="bound">j</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span> <span class="main">∧</span> 
         Matrix.mat <span class="numeral">8</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="main">[</span><span class="main">[</span><span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">-</span><span class="free">φ</span> <span class="main">$$</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">,</span> <span class="free">φ</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">]</span><span class="main">]</span><span class="main">!</span><span class="bound">j</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span> <span class="main">≠</span>
         Matrix.mat <span class="numeral">8</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="main">[</span><span class="main">[</span><span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="free">φ</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">,</span> <span class="main">-</span><span class="free">φ</span> <span class="main">$$</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">]</span><span class="main">]</span><span class="main">!</span><span class="bound">j</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> f0<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∨</span> <span class="free">φ</span> <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms state_def Matrix.col_def cpx_vec_length_def set_2 <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> atLeast0LessThan<span class="main">)</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">v1</span></span> <span class="skolem"><span class="skolem">v2</span></span> <span class="skolem"><span class="skolem">v3</span></span> <span class="skolem"><span class="skolem">v4</span></span> <span class="keyword2"><span class="keyword">where</span></span> d0<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">v1</span> <span class="main">=</span> Matrix.mat <span class="numeral">8</span> <span class="main">1</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="main">[</span><span class="main">[</span><span class="free">φ</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">,</span><span class="free">φ</span> <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">]</span><span class="main">]</span><span class="main">!</span><span class="bound">j</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span>"</span></span>
                       <span class="keyword2"><span class="keyword">and</span></span> d1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">v2</span> <span class="main">=</span> Matrix.mat <span class="numeral">8</span> <span class="main">1</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="main">[</span><span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="free">φ</span> <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">,</span> <span class="free">φ</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">]</span><span class="main">]</span><span class="main">!</span><span class="bound">j</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span>"</span></span>
                       <span class="keyword2"><span class="keyword">and</span></span> d2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">v3</span> <span class="main">=</span> Matrix.mat <span class="numeral">8</span> <span class="main">1</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="main">[</span><span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="free">φ</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">,</span><span class="main">-</span><span class="free">φ</span> <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">]</span><span class="main">]</span><span class="main">!</span><span class="bound">j</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span>"</span></span>
                       <span class="keyword2"><span class="keyword">and</span></span> d3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">v4</span> <span class="main">=</span> Matrix.mat <span class="numeral">8</span> <span class="main">1</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="main">[</span><span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">-</span><span class="free">φ</span> <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">,</span><span class="free">φ</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">]</span><span class="main">]</span><span class="main">!</span><span class="bound">j</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">v1</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">≠</span> <span class="skolem">v2</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">∨</span> <span class="skolem">v1</span> <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">≠</span> <span class="skolem">v2</span> <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> 
             <span class="main">(</span><span class="skolem">v1</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">≠</span> <span class="skolem">v3</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">∨</span> <span class="skolem">v1</span> <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">≠</span> <span class="skolem">v3</span> <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>  
             <span class="main">(</span><span class="skolem">v1</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">≠</span> <span class="skolem">v4</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">∨</span> <span class="skolem">v1</span> <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">≠</span> <span class="skolem">v4</span> <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>  
             <span class="main">(</span><span class="skolem">v2</span> <span class="main">$$</span> <span class="main">(</span><span class="numeral">2</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">≠</span> <span class="skolem">v3</span> <span class="main">$$</span> <span class="main">(</span><span class="numeral">2</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">∨</span> <span class="skolem">v2</span> <span class="main">$$</span> <span class="main">(</span><span class="numeral">3</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">≠</span> <span class="skolem">v3</span> <span class="main">$$</span> <span class="main">(</span><span class="numeral">3</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>  
             <span class="main">(</span><span class="skolem">v2</span> <span class="main">$$</span> <span class="main">(</span><span class="numeral">2</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">≠</span> <span class="skolem">v4</span> <span class="main">$$</span> <span class="main">(</span><span class="numeral">2</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">∨</span> <span class="skolem">v2</span> <span class="main">$$</span> <span class="main">(</span><span class="numeral">3</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">≠</span> <span class="skolem">v4</span> <span class="main">$$</span> <span class="main">(</span><span class="numeral">3</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>  
             <span class="main">(</span><span class="skolem">v3</span> <span class="main">$$</span> <span class="main">(</span><span class="numeral">4</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">≠</span> <span class="skolem">v4</span> <span class="main">$$</span> <span class="main">(</span><span class="numeral">4</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">∨</span> <span class="skolem">v3</span> <span class="main">$$</span> <span class="main">(</span><span class="numeral">5</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">≠</span> <span class="skolem">v4</span> <span class="main">$$</span> <span class="main">(</span><span class="numeral">5</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> f0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v1</span> <span class="main">≠</span> <span class="skolem">v2</span> <span class="main">∧</span> <span class="skolem">v1</span> <span class="main">≠</span> <span class="skolem">v3</span> <span class="main">∧</span> <span class="skolem">v1</span> <span class="main">≠</span> <span class="skolem">v4</span> <span class="main">∧</span> <span class="skolem">v2</span> <span class="main">≠</span> <span class="skolem">v3</span> <span class="main">∧</span> <span class="skolem">v2</span> <span class="main">≠</span> <span class="skolem">v4</span> <span class="main">∧</span> <span class="skolem">v3</span> <span class="main">≠</span> <span class="skolem">v4</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> d0 d1 d2 d3<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">M3</span><span class="main">::</span> <span class="quoted"><span class="quoted">"complex Matrix.mat"</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
<span class="quoted"><span class="quoted">"<span class="free">M3</span> <span class="main">≡</span> mat_of_cols_list <span class="numeral">8</span> <span class="main">[</span><span class="main">[</span><span class="main">0</span><span class="main">,</span> <span class="main">1</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">]</span><span class="main">,</span>
                          <span class="main">[</span><span class="main">1</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">]</span><span class="main">,</span>
                          <span class="main">[</span><span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">1</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">]</span><span class="main">,</span>
                          <span class="main">[</span><span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">1</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">]</span><span class="main">,</span>
                          <span class="main">[</span><span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">1</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">]</span><span class="main">,</span>
                          <span class="main">[</span><span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">1</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">]</span><span class="main">,</span>
                          <span class="main">[</span><span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">1</span><span class="main">]</span><span class="main">,</span>
                          <span class="main">[</span><span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">1</span><span class="main">,</span> <span class="main">0</span><span class="main">]</span><span class="main">]</span>"</span></span>

<span class="keyword1" id="Quantum_Teleportation-tensor_prod_of_id_2_x"><span class="command">lemma</span></span> tensor_prod_of_id_2_x<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Id <span class="numeral">2</span> <span class="main">⨂</span> X<span class="main">)</span> <span class="main">=</span> M3"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword1"><span class="command">have</span></span> f0<span class="main">:</span><span class="quoted"><span class="quoted">"gate <span class="numeral">3</span> <span class="main">(</span>Id <span class="numeral">2</span> <span class="main">⨂</span> X<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> X_is_gate tensor_gate<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span>"</span></span> <span class="quoted"><span class="quoted">"Id <span class="numeral">2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"X"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_row <span class="main">(</span>Id <span class="numeral">2</span> <span class="main">⨂</span> X<span class="main">)</span> <span class="main">=</span> dim_row M3"</span></span>
      <span class="keyword1"><span class="command">using</span></span> gate_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mat_of_cols_list_def<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_col <span class="main">(</span>Id <span class="numeral">2</span> <span class="main">⨂</span> X<span class="main">)</span> <span class="main">=</span> dim_col M3"</span></span>
      <span class="keyword1"><span class="command">using</span></span> f0 gate_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mat_of_cols_list_def<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span> <span class="bound">j</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> dim_row M3 <span class="main">⟹</span> <span class="bound">j</span> <span class="main">&lt;</span> dim_col M3 <span class="main">⟹</span> <span class="main">(</span>Id <span class="numeral">2</span> <span class="main">⨂</span> X<span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span> <span class="main">=</span> M3 <span class="main">$$</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> dim_row M3"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> dim_col M3"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="numeral">8</span><span class="main">}</span> <span class="main">∧</span> <span class="skolem">j</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="numeral">8</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mat_of_cols_list_def<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Id <span class="numeral">2</span> <span class="main">⨂</span> X<span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> M3 <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> Id_def X_def index_tensor_mat<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"Id <span class="numeral">2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">4</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">4</span>"</span></span> <span class="quoted"><span class="quoted">"X"</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span>"</span></span><span class="main">]</span> gate_def X_is_gate 
id_is_gate Id_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mat_of_cols_list_def X_def<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">M4</span><span class="main">::</span> <span class="quoted"><span class="quoted">"complex Matrix.mat"</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
<span class="quoted"><span class="quoted">"<span class="free">M4</span> <span class="main">≡</span> mat_of_cols_list <span class="numeral">8</span> <span class="main">[</span><span class="main">[</span><span class="main">0</span><span class="main">,</span> <span class="main">-</span><span class="main">1</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">]</span><span class="main">,</span>
                          <span class="main">[</span><span class="main">1</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">]</span><span class="main">,</span>
                          <span class="main">[</span><span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">-</span><span class="main">1</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">]</span><span class="main">,</span>
                          <span class="main">[</span><span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">1</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">]</span><span class="main">,</span>
                          <span class="main">[</span><span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">-</span><span class="main">1</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">]</span><span class="main">,</span>
                          <span class="main">[</span><span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">1</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">]</span><span class="main">,</span>
                          <span class="main">[</span><span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">-</span><span class="main">1</span><span class="main">]</span><span class="main">,</span>
                          <span class="main">[</span><span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">1</span><span class="main">,</span> <span class="main">0</span><span class="main">]</span><span class="main">]</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">ZX</span><span class="main">::</span> <span class="quoted"><span class="quoted">"complex Matrix.mat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">ZX</span> <span class="main">≡</span> mat_of_cols_list <span class="numeral">2</span> <span class="main">[</span><span class="main">[</span><span class="main">0</span><span class="main">,</span> <span class="main">-</span><span class="main">1</span><span class="main">]</span><span class="main">,</span> <span class="main">[</span><span class="main">1</span><span class="main">,</span> <span class="main">0</span><span class="main">]</span><span class="main">]</span>"</span></span>

<span class="keyword1" id="Quantum_Teleportation-l_inv_of_ZX"><span class="command">lemma</span></span> l_inv_of_ZX<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ZX<span class="main"><span class="hidden">⇧</span><sup>†</sup></span> <span class="main">*</span> ZX <span class="main">=</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>m</sub></span> <span class="numeral">2</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_row <span class="main">(</span>ZX<span class="main"><span class="hidden">⇧</span><sup>†</sup></span> <span class="main">*</span> ZX<span class="main">)</span> <span class="main">=</span> dim_row <span class="main">(</span><span class="keyword1">1<span class="hidden">⇩</span><sub>m</sub></span> <span class="numeral">2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> dagger_def mat_of_cols_list_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_col <span class="main">(</span>ZX<span class="main"><span class="hidden">⇧</span><sup>†</sup></span> <span class="main">*</span> ZX<span class="main">)</span> <span class="main">=</span> dim_col <span class="main">(</span><span class="keyword1">1<span class="hidden">⇩</span><sub>m</sub></span> <span class="numeral">2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> dagger_def mat_of_cols_list_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span> <span class="bound">j</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> dim_row <span class="main">(</span><span class="keyword1">1<span class="hidden">⇩</span><sub>m</sub></span> <span class="numeral">2</span><span class="main">)</span> <span class="main">⟹</span> <span class="bound">j</span> <span class="main">&lt;</span> dim_col <span class="main">(</span><span class="keyword1">1<span class="hidden">⇩</span><sub>m</sub></span> <span class="numeral">2</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span>ZX<span class="main"><span class="hidden">⇧</span><sup>†</sup></span> <span class="main">*</span> ZX<span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>m</sub></span> <span class="numeral">2</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> dim_row <span class="main">(</span><span class="keyword1">1<span class="hidden">⇩</span><sub>m</sub></span> <span class="numeral">2</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> dim_col <span class="main">(</span><span class="keyword1">1<span class="hidden">⇩</span><sub>m</sub></span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="numeral">2</span><span class="main">}</span> <span class="main">∧</span> <span class="skolem">j</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="numeral">2</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>ZX<span class="main"><span class="hidden">⇧</span><sup>†</sup></span> <span class="main">*</span> ZX<span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>m</sub></span> <span class="numeral">2</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> mat_of_cols_list_def dagger_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_2<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Quantum_Teleportation-r_inv_of_ZX"><span class="command">lemma</span></span> r_inv_of_ZX<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ZX <span class="main">*</span> <span class="main">(</span>ZX<span class="main"><span class="hidden">⇧</span><sup>†</sup></span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>m</sub></span> <span class="numeral">2</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_row <span class="main">(</span>ZX <span class="main">*</span> <span class="main">(</span>ZX<span class="main"><span class="hidden">⇧</span><sup>†</sup></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> dim_row <span class="main">(</span><span class="keyword1">1<span class="hidden">⇩</span><sub>m</sub></span> <span class="numeral">2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> dagger_def mat_of_cols_list_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_col <span class="main">(</span>ZX <span class="main">*</span> <span class="main">(</span>ZX<span class="main"><span class="hidden">⇧</span><sup>†</sup></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> dim_col <span class="main">(</span><span class="keyword1">1<span class="hidden">⇩</span><sub>m</sub></span> <span class="numeral">2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> dagger_def mat_of_cols_list_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span> <span class="bound">j</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> dim_row <span class="main">(</span><span class="keyword1">1<span class="hidden">⇩</span><sub>m</sub></span> <span class="numeral">2</span><span class="main">)</span> <span class="main">⟹</span> <span class="bound">j</span> <span class="main">&lt;</span> dim_col <span class="main">(</span><span class="keyword1">1<span class="hidden">⇩</span><sub>m</sub></span> <span class="numeral">2</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span>ZX <span class="main">*</span> <span class="main">(</span>ZX<span class="main"><span class="hidden">⇧</span><sup>†</sup></span><span class="main">)</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>m</sub></span> <span class="numeral">2</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> dim_row <span class="main">(</span><span class="keyword1">1<span class="hidden">⇩</span><sub>m</sub></span> <span class="numeral">2</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> dim_col <span class="main">(</span><span class="keyword1">1<span class="hidden">⇩</span><sub>m</sub></span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="numeral">2</span><span class="main">}</span> <span class="main">∧</span> <span class="skolem">j</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="numeral">2</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>ZX <span class="main">*</span> <span class="main">(</span>ZX<span class="main"><span class="hidden">⇧</span><sup>†</sup></span><span class="main">)</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>m</sub></span> <span class="numeral">2</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> mat_of_cols_list_def dagger_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_2<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Quantum_Teleportation-ZX_is_gate"><span class="command">lemma</span></span> ZX_is_gate <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"gate <span class="main">1</span> ZX"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_row ZX <span class="main">=</span> <span class="numeral">2</span> <span class="main">^</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> mat_of_cols_list_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"square_mat ZX"</span></span> <span class="keyword1"><span class="command">using</span></span> mat_of_cols_list_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"unitary ZX"</span></span> <span class="keyword1"><span class="command">using</span></span> unitary_def l_inv_of_ZX r_inv_of_ZX mat_of_cols_list_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Quantum_Teleportation-prod_of_ZX"><span class="command">lemma</span></span> prod_of_ZX<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Z <span class="main">*</span> X <span class="main">=</span> ZX"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_row <span class="main">(</span>Z <span class="main">*</span> X<span class="main">)</span> <span class="main">=</span> dim_row ZX"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Z_is_gate mat_of_cols_list_def gate_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_col <span class="main">(</span>Z <span class="main">*</span> X<span class="main">)</span> <span class="main">=</span> dim_col ZX"</span></span>
    <span class="keyword1"><span class="command">using</span></span> X_is_gate mat_of_cols_list_def gate_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span> <span class="bound">j</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> dim_row ZX <span class="main">⟹</span> <span class="bound">j</span> <span class="main">&lt;</span> dim_col ZX <span class="main">⟹</span> <span class="main">(</span>Z <span class="main">*</span> X<span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span> <span class="main">=</span> ZX <span class="main">$$</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> dim_row ZX"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> dim_col ZX"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="numeral">2</span><span class="main">}</span> <span class="main">∧</span> <span class="skolem">j</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="numeral">2</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mat_of_cols_list_def<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Z <span class="main">*</span> X<span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> ZX <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_2 Z_def X_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Quantum_Teleportation-tensor_prod_of_id_2_y"><span class="command">lemma</span></span> tensor_prod_of_id_2_y<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Id <span class="numeral">2</span> <span class="main">⨂</span> Z <span class="main">*</span> X<span class="main">)</span> <span class="main">=</span> M4"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword1"><span class="command">have</span></span> f0<span class="main">:</span><span class="quoted"><span class="quoted">"gate <span class="numeral">3</span> <span class="main">(</span>Id <span class="numeral">2</span> <span class="main">⨂</span> Z <span class="main">*</span> X<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> prod_of_ZX ZX_is_gate tensor_gate<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span>"</span></span> <span class="quoted"><span class="quoted">"Id <span class="numeral">2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"Z <span class="main">*</span> X"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_row <span class="main">(</span>Id <span class="numeral">2</span> <span class="main">⨂</span> Z <span class="main">*</span> X<span class="main">)</span> <span class="main">=</span> dim_row M4"</span></span>
      <span class="keyword1"><span class="command">using</span></span> gate_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mat_of_cols_list_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_col <span class="main">(</span>Id <span class="numeral">2</span> <span class="main">⨂</span> Z <span class="main">*</span> X<span class="main">)</span> <span class="main">=</span> dim_col M4"</span></span>
    <span class="keyword1"><span class="command">using</span></span> f0 gate_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mat_of_cols_list_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span> <span class="bound">j</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> dim_row M4 <span class="main">⟹</span> <span class="bound">j</span> <span class="main">&lt;</span> dim_col M4 <span class="main">⟹</span> <span class="main">(</span>Id <span class="numeral">2</span> <span class="main">⨂</span> Z <span class="main">*</span> X<span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span> <span class="main">=</span> M4 <span class="main">$$</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> dim_row M4"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> dim_col M4"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="numeral">8</span><span class="main">}</span> <span class="main">∧</span> <span class="skolem">j</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="numeral">8</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mat_of_cols_list_def<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Id <span class="numeral">2</span> <span class="main">⨂</span> ZX<span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> M4 <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Id_def mat_of_cols_list_def index_tensor_mat<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"Id <span class="numeral">2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">4</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">4</span>"</span></span> <span class="quoted"><span class="quoted">"ZX"</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span>"</span></span><span class="main">]</span> 
        gate_def ZX_is_gate id_is_gate
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mat_of_cols_list_def<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Id <span class="numeral">2</span> <span class="main">⨂</span> Z <span class="main">*</span> X<span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> M4 <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> prod_of_ZX <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">M5</span><span class="main">::</span> <span class="quoted"><span class="quoted">"complex Matrix.mat"</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
<span class="quoted"><span class="quoted">"<span class="free">M5</span> <span class="main">≡</span> mat_of_cols_list <span class="numeral">8</span> <span class="main">[</span><span class="main">[</span><span class="main">1</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">]</span><span class="main">,</span>
                          <span class="main">[</span><span class="main">0</span><span class="main">,</span> <span class="main">-</span><span class="main">1</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">]</span><span class="main">,</span>
                          <span class="main">[</span><span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">1</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">]</span><span class="main">,</span>
                          <span class="main">[</span><span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">-</span><span class="main">1</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">]</span><span class="main">,</span>
                          <span class="main">[</span><span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">1</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">]</span><span class="main">,</span>
                          <span class="main">[</span><span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">-</span><span class="main">1</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">]</span><span class="main">,</span>
                          <span class="main">[</span><span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">1</span><span class="main">,</span> <span class="main">0</span><span class="main">]</span><span class="main">,</span>
                          <span class="main">[</span><span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">-</span><span class="main">1</span><span class="main">]</span><span class="main">]</span>"</span></span>

<span class="keyword1" id="Quantum_Teleportation-tensor_prod_of_id_2_z"><span class="command">lemma</span></span> tensor_prod_of_id_2_z<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Id <span class="numeral">2</span> <span class="main">⨂</span> Z<span class="main">)</span> <span class="main">=</span> M5"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword1"><span class="command">have</span></span> f0<span class="main">:</span><span class="quoted"><span class="quoted">"gate <span class="numeral">3</span> <span class="main">(</span>Id <span class="numeral">2</span> <span class="main">⨂</span> Z<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Z_is_gate tensor_gate<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span>"</span></span> <span class="quoted"><span class="quoted">"Id <span class="numeral">2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"Z"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_row <span class="main">(</span>Id <span class="numeral">2</span> <span class="main">⨂</span> Z<span class="main">)</span> <span class="main">=</span> dim_row M5"</span></span>
      <span class="keyword1"><span class="command">using</span></span> gate_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>  mat_of_cols_list_def<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_col <span class="main">(</span>Id <span class="numeral">2</span> <span class="main">⨂</span> Z<span class="main">)</span> <span class="main">=</span> dim_col M5"</span></span>
      <span class="keyword1"><span class="command">using</span></span> f0 gate_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>  mat_of_cols_list_def<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span> <span class="bound">j</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> dim_row M5 <span class="main">⟹</span> <span class="bound">j</span> <span class="main">&lt;</span> dim_col M5 <span class="main">⟹</span> <span class="main">(</span>Id <span class="numeral">2</span> <span class="main">⨂</span> Z<span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span> <span class="main">=</span> M5 <span class="main">$$</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> dim_row M5"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> dim_col M5"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="numeral">8</span><span class="main">}</span> <span class="main">∧</span> <span class="skolem">j</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="numeral">8</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mat_of_cols_list_def<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Id <span class="numeral">2</span> <span class="main">⨂</span> Z<span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> M5 <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> Id_def Z_def index_tensor_mat<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"Id <span class="numeral">2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">4</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">4</span>"</span></span> <span class="quoted"><span class="quoted">"Z"</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span>"</span></span><span class="main">]</span> gate_def Z_is_gate 
id_is_gate Id_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mat_of_cols_list_def Z_def<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Quantum_Teleportation-teleportation"><span class="command">lemma</span></span> teleportation<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"state <span class="main">1</span> <span class="free">φ</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"state <span class="numeral">3</span> <span class="free">q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"List.member <span class="main">(</span>alice_meas <span class="free">φ</span><span class="main">)</span> <span class="main">(</span><span class="free">p</span><span class="main">,</span> <span class="free">q</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">r</span><span class="main">.</span> state <span class="numeral">2</span> <span class="bound">r</span> <span class="main">∧</span> bob <span class="free">q</span> <span class="main">(</span>alice_out <span class="free">φ</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> <span class="bound">r</span> <span class="main">⨂</span> <span class="free">φ</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">α</span></span> <span class="skolem"><span class="skolem">β</span></span> <span class="keyword2"><span class="keyword">where</span></span> a0<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">α</span> <span class="main">=</span> <span class="free">φ</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">β</span> <span class="main">=</span> <span class="free">φ</span> <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">=</span> mat_of_cols_list <span class="numeral">8</span> <span class="main">[</span><span class="main">[</span><span class="skolem">α</span><span class="main">,</span> <span class="skolem">β</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">]</span><span class="main">]</span> <span class="main">∨</span>
             <span class="free">q</span> <span class="main">=</span> mat_of_cols_list <span class="numeral">8</span> <span class="main">[</span><span class="main">[</span><span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="skolem">β</span><span class="main">,</span> <span class="skolem">α</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">]</span><span class="main">]</span> <span class="main">∨</span>
             <span class="free">q</span> <span class="main">=</span> mat_of_cols_list <span class="numeral">8</span> <span class="main">[</span><span class="main">[</span><span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="skolem">α</span><span class="main">,</span> <span class="main">-</span><span class="skolem">β</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">]</span><span class="main">]</span> <span class="main">∨</span>
             <span class="free">q</span> <span class="main">=</span> mat_of_cols_list <span class="numeral">8</span> <span class="main">[</span><span class="main">[</span><span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">-</span><span class="skolem">β</span><span class="main">,</span> <span class="skolem">α</span><span class="main">]</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms Alice_case alice_pos_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">=</span> mat_of_cols_list <span class="numeral">8</span> <span class="main">[</span><span class="main">[</span><span class="skolem">α</span><span class="main">,</span><span class="skolem">β</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">]</span><span class="main">]</span> <span class="main">⟹</span> bob <span class="free">q</span> <span class="main">(</span>alice_out <span class="free">φ</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> 
mat_of_cols_list <span class="numeral">4</span> <span class="main">[</span><span class="main">[</span><span class="main">1</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">]</span><span class="main">]</span> <span class="main">⨂</span> <span class="free">φ</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> asm<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">=</span> Tensor.mat_of_cols_list <span class="numeral">8</span> <span class="main">[</span><span class="main">[</span><span class="skolem">α</span><span class="main">,</span> <span class="skolem">β</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">]</span><span class="main">]</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_row <span class="main">(</span>bob <span class="free">q</span> <span class="main">(</span>alice_out <span class="free">φ</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> dim_row <span class="main">(</span>Tensor.mat_of_cols_list <span class="numeral">4</span> <span class="main">[</span><span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">]</span><span class="main">]</span> <span class="main">⨂</span> <span class="free">φ</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> mat_of_cols_list_def a0 a1 assms<span class="main">(</span>1<span class="main">)</span> state_def bob_def alice_out_def asm <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_col <span class="main">(</span>bob <span class="free">q</span> <span class="main">(</span>alice_out <span class="free">φ</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> dim_col <span class="main">(</span>Tensor.mat_of_cols_list <span class="numeral">4</span> <span class="main">[</span><span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">]</span><span class="main">]</span> <span class="main">⨂</span> <span class="free">φ</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> mat_of_cols_list_def a0 a1 assms<span class="main">(</span>1<span class="main">)</span> state_def bob_def alice_out_def asm <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span> <span class="bound">j</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> dim_row <span class="main">(</span>Tensor.mat_of_cols_list <span class="numeral">4</span> <span class="main">[</span><span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">]</span><span class="main">]</span> <span class="main">⨂</span> <span class="free">φ</span><span class="main">)</span> <span class="main">⟹</span> 
                <span class="bound">j</span> <span class="main">&lt;</span> dim_col <span class="main">(</span>Tensor.mat_of_cols_list <span class="numeral">4</span> <span class="main">[</span><span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">]</span><span class="main">]</span> <span class="main">⨂</span> <span class="free">φ</span><span class="main">)</span> <span class="main">⟹</span>
           bob <span class="free">q</span> <span class="main">(</span>alice_out <span class="free">φ</span> <span class="free">q</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Tensor.mat_of_cols_list <span class="numeral">4</span> <span class="main">[</span><span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">]</span><span class="main">]</span> <span class="main">⨂</span> <span class="free">φ</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> dim_row <span class="main">(</span>Tensor.mat_of_cols_list <span class="numeral">4</span> <span class="main">[</span><span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">]</span><span class="main">]</span> <span class="main">⨂</span> <span class="free">φ</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
                     <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> dim_col <span class="main">(</span>Tensor.mat_of_cols_list <span class="numeral">4</span> <span class="main">[</span><span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">]</span><span class="main">]</span> <span class="main">⨂</span> <span class="free">φ</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="numeral">8</span><span class="main">}</span> <span class="main">∧</span> <span class="skolem">j</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> asm mat_of_cols_list_def assms state_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"bob <span class="free">q</span> <span class="main">(</span>alice_out <span class="free">φ</span> <span class="free">q</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Tensor.mat_of_cols_list <span class="numeral">4</span> <span class="main">[</span><span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">]</span><span class="main">]</span> <span class="main">⨂</span> <span class="free">φ</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> bob_def alice_out_def asm mat_of_cols_list_def a0 a1 assms state_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">=</span> mat_of_cols_list <span class="numeral">8</span> <span class="main">[</span><span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="skolem">β</span><span class="main">,</span><span class="skolem">α</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">]</span><span class="main">]</span> <span class="main">⟹</span> bob <span class="free">q</span> <span class="main">(</span>alice_out <span class="free">φ</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> 
mat_of_cols_list <span class="numeral">4</span> <span class="main">[</span><span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">]</span><span class="main">]</span> <span class="main">⨂</span> <span class="free">φ</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> asm<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">=</span> Tensor.mat_of_cols_list <span class="numeral">8</span> <span class="main">[</span><span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="skolem">β</span><span class="main">,</span><span class="skolem">α</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">]</span><span class="main">]</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_row <span class="main">(</span>bob <span class="free">q</span> <span class="main">(</span>alice_out <span class="free">φ</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> dim_row <span class="main">(</span>Tensor.mat_of_cols_list <span class="numeral">4</span> <span class="main">[</span><span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">]</span><span class="main">]</span> <span class="main">⨂</span> <span class="free">φ</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> mat_of_cols_list_def a0 a1 assms<span class="main">(</span>1<span class="main">)</span> state_def bob_def alice_out_def asm tensor_prod_of_id_2_x <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_col <span class="main">(</span>bob <span class="free">q</span> <span class="main">(</span>alice_out <span class="free">φ</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> dim_col <span class="main">(</span>Tensor.mat_of_cols_list <span class="numeral">4</span> <span class="main">[</span><span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">]</span><span class="main">]</span> <span class="main">⨂</span> <span class="free">φ</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> mat_of_cols_list_def a0 a1 assms<span class="main">(</span>1<span class="main">)</span> state_def bob_def alice_out_def asm <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>    
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span> <span class="bound">j</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> dim_row <span class="main">(</span>Tensor.mat_of_cols_list <span class="numeral">4</span> <span class="main">[</span><span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">]</span><span class="main">]</span> <span class="main">⨂</span> <span class="free">φ</span><span class="main">)</span> <span class="main">⟹</span> 
                <span class="bound">j</span> <span class="main">&lt;</span> dim_col <span class="main">(</span>Tensor.mat_of_cols_list <span class="numeral">4</span> <span class="main">[</span><span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">]</span><span class="main">]</span> <span class="main">⨂</span> <span class="free">φ</span><span class="main">)</span> <span class="main">⟹</span>
           bob <span class="free">q</span> <span class="main">(</span>alice_out <span class="free">φ</span> <span class="free">q</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Tensor.mat_of_cols_list <span class="numeral">4</span> <span class="main">[</span><span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">]</span><span class="main">]</span> <span class="main">⨂</span> <span class="free">φ</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> dim_row <span class="main">(</span>Tensor.mat_of_cols_list <span class="numeral">4</span> <span class="main">[</span><span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">]</span><span class="main">]</span> <span class="main">⨂</span> <span class="free">φ</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
                     <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> dim_col <span class="main">(</span>Tensor.mat_of_cols_list <span class="numeral">4</span> <span class="main">[</span><span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">]</span><span class="main">]</span> <span class="main">⨂</span> <span class="free">φ</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> c1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="numeral">8</span><span class="main">}</span> <span class="main">∧</span> <span class="skolem">j</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> asm mat_of_cols_list_def assms<span class="main">(</span>1<span class="main">)</span> state_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>M3 <span class="main">*</span> <span class="main">(</span>Matrix.mat <span class="numeral">8</span> <span class="main">1</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="main">[</span><span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="free">φ</span> <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">,</span><span class="free">φ</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">]</span><span class="main">]</span><span class="main">!</span><span class="bound">j</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> 
<span class="main">(</span>Tensor.mat_of_cols_list <span class="numeral">4</span> <span class="main">[</span><span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">]</span><span class="main">]</span> <span class="main">⨂</span> <span class="free">φ</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> state_def assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>  a0 a1 mat_of_cols_list_def times_mat_def scalar_prod_def<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"bob <span class="free">q</span> <span class="main">(</span>alice_out <span class="free">φ</span> <span class="free">q</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Tensor.mat_of_cols_list <span class="numeral">4</span> <span class="main">[</span><span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">]</span><span class="main">]</span> <span class="main">⨂</span> <span class="free">φ</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> bob_def alice_out_def asm c1 a0 a1 mat_of_cols_list_def tensor_prod_of_id_2_x assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">=</span> mat_of_cols_list <span class="numeral">8</span> <span class="main">[</span><span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="skolem">α</span><span class="main">,</span><span class="main">-</span><span class="skolem">β</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">]</span><span class="main">]</span> <span class="main">⟹</span> bob <span class="free">q</span> <span class="main">(</span>alice_out <span class="free">φ</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> 
mat_of_cols_list <span class="numeral">4</span> <span class="main">[</span><span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">]</span><span class="main">]</span> <span class="main">⨂</span> <span class="free">φ</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> asm<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">=</span> Tensor.mat_of_cols_list <span class="numeral">8</span> <span class="main">[</span><span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="skolem">α</span><span class="main">,</span><span class="main">-</span><span class="skolem">β</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">]</span><span class="main">]</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_row <span class="main">(</span>bob <span class="free">q</span> <span class="main">(</span>alice_out <span class="free">φ</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> dim_row <span class="main">(</span>Tensor.mat_of_cols_list <span class="numeral">4</span> <span class="main">[</span><span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">]</span><span class="main">]</span> <span class="main">⨂</span> <span class="free">φ</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> mat_of_cols_list_def a0 a1 assms<span class="main">(</span>1<span class="main">)</span> state_def bob_def alice_out_def asm tensor_prod_of_id_2_z <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_col <span class="main">(</span>bob <span class="free">q</span> <span class="main">(</span>alice_out <span class="free">φ</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> dim_col <span class="main">(</span>Tensor.mat_of_cols_list <span class="numeral">4</span> <span class="main">[</span><span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">]</span><span class="main">]</span> <span class="main">⨂</span> <span class="free">φ</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> mat_of_cols_list_def a0 a1 assms<span class="main">(</span>1<span class="main">)</span> state_def bob_def alice_out_def asm <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>      
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span> <span class="bound">j</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> dim_row <span class="main">(</span>Tensor.mat_of_cols_list <span class="numeral">4</span> <span class="main">[</span><span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">]</span><span class="main">]</span> <span class="main">⨂</span> <span class="free">φ</span><span class="main">)</span> <span class="main">⟹</span> 
                <span class="bound">j</span> <span class="main">&lt;</span> dim_col <span class="main">(</span>Tensor.mat_of_cols_list <span class="numeral">4</span> <span class="main">[</span><span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">]</span><span class="main">]</span> <span class="main">⨂</span> <span class="free">φ</span><span class="main">)</span> <span class="main">⟹</span>
           bob <span class="free">q</span> <span class="main">(</span>alice_out <span class="free">φ</span> <span class="free">q</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Tensor.mat_of_cols_list <span class="numeral">4</span> <span class="main">[</span><span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">]</span><span class="main">]</span> <span class="main">⨂</span> <span class="free">φ</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> dim_row <span class="main">(</span>Tensor.mat_of_cols_list <span class="numeral">4</span> <span class="main">[</span><span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">]</span><span class="main">]</span> <span class="main">⨂</span> <span class="free">φ</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
                     <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> dim_col <span class="main">(</span>Tensor.mat_of_cols_list <span class="numeral">4</span> <span class="main">[</span><span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">]</span><span class="main">]</span> <span class="main">⨂</span> <span class="free">φ</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> c1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="numeral">8</span><span class="main">}</span> <span class="main">∧</span> <span class="skolem">j</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> asm mat_of_cols_list_def assms state_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>M5 <span class="main">*</span> <span class="main">(</span>Matrix.mat <span class="numeral">8</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="main">[</span><span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="free">φ</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">,</span><span class="main">-</span><span class="free">φ</span> <span class="main">$$</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">]</span><span class="main">]</span><span class="main">!</span><span class="bound">j</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> 
<span class="main">(</span>Tensor.mat_of_cols_list <span class="numeral">4</span> <span class="main">[</span><span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">]</span><span class="main">]</span> <span class="main">⨂</span> <span class="free">φ</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> state_def assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a0 a1 mat_of_cols_list_def times_mat_def scalar_prod_def<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"bob <span class="free">q</span> <span class="main">(</span>alice_out <span class="free">φ</span> <span class="free">q</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Tensor.mat_of_cols_list <span class="numeral">4</span> <span class="main">[</span><span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">]</span><span class="main">]</span> <span class="main">⨂</span> <span class="free">φ</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> bob_def alice_out_def asm c1 a0 a1 mat_of_cols_list_def tensor_prod_of_id_2_z assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">=</span> mat_of_cols_list <span class="numeral">8</span> <span class="main">[</span><span class="main">[</span><span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">-</span><span class="skolem">β</span><span class="main">,</span> <span class="skolem">α</span><span class="main">]</span><span class="main">]</span> <span class="main">⟹</span> bob <span class="free">q</span> <span class="main">(</span>alice_out <span class="free">φ</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> 
mat_of_cols_list <span class="numeral">4</span> <span class="main">[</span><span class="main">[</span><span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">1</span><span class="main">]</span><span class="main">]</span> <span class="main">⨂</span> <span class="free">φ</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> asm<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">=</span> Tensor.mat_of_cols_list <span class="numeral">8</span> <span class="main">[</span><span class="main">[</span><span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">-</span><span class="skolem">β</span><span class="main">,</span> <span class="skolem">α</span><span class="main">]</span><span class="main">]</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_row <span class="main">(</span>bob <span class="free">q</span> <span class="main">(</span>alice_out <span class="free">φ</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> dim_row <span class="main">(</span>Tensor.mat_of_cols_list <span class="numeral">4</span> <span class="main">[</span><span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">]</span><span class="main">]</span> <span class="main">⨂</span> <span class="free">φ</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> mat_of_cols_list_def a0 a1 assms<span class="main">(</span>1<span class="main">)</span> state_def bob_def alice_out_def asm tensor_prod_of_id_2_y <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_col <span class="main">(</span>bob <span class="free">q</span> <span class="main">(</span>alice_out <span class="free">φ</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> dim_col <span class="main">(</span>Tensor.mat_of_cols_list <span class="numeral">4</span> <span class="main">[</span><span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">]</span><span class="main">]</span> <span class="main">⨂</span> <span class="free">φ</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> mat_of_cols_list_def a0 a1 assms<span class="main">(</span>1<span class="main">)</span> state_def bob_def alice_out_def asm <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>  
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span> <span class="bound">j</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> dim_row <span class="main">(</span>Tensor.mat_of_cols_list <span class="numeral">4</span> <span class="main">[</span><span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">]</span><span class="main">]</span> <span class="main">⨂</span> <span class="free">φ</span><span class="main">)</span> <span class="main">⟹</span> 
                <span class="bound">j</span> <span class="main">&lt;</span> dim_col <span class="main">(</span>Tensor.mat_of_cols_list <span class="numeral">4</span> <span class="main">[</span><span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">]</span><span class="main">]</span> <span class="main">⨂</span> <span class="free">φ</span><span class="main">)</span> <span class="main">⟹</span>
           bob <span class="free">q</span> <span class="main">(</span>alice_out <span class="free">φ</span> <span class="free">q</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Tensor.mat_of_cols_list <span class="numeral">4</span> <span class="main">[</span><span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">]</span><span class="main">]</span> <span class="main">⨂</span> <span class="free">φ</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> dim_row <span class="main">(</span>Tensor.mat_of_cols_list <span class="numeral">4</span> <span class="main">[</span><span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">]</span><span class="main">]</span> <span class="main">⨂</span> <span class="free">φ</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
                     <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> dim_col <span class="main">(</span>Tensor.mat_of_cols_list <span class="numeral">4</span> <span class="main">[</span><span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">]</span><span class="main">]</span> <span class="main">⨂</span> <span class="free">φ</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> c1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="numeral">8</span><span class="main">}</span> <span class="main">∧</span> <span class="skolem">j</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> asm mat_of_cols_list_def assms state_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>M4 <span class="main">*</span> <span class="main">(</span>Matrix.mat <span class="numeral">8</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">i</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="main">[</span><span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">-</span><span class="free">φ</span> <span class="main">$$</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">,</span><span class="free">φ</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">]</span><span class="main">]</span><span class="main">!</span><span class="bound">j</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> 
<span class="main">(</span>Tensor.mat_of_cols_list <span class="numeral">4</span> <span class="main">[</span><span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">]</span><span class="main">]</span> <span class="main">⨂</span> <span class="free">φ</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> state_def assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a0 a1 mat_of_cols_list_def times_mat_def scalar_prod_def<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"bob <span class="free">q</span> <span class="main">(</span>alice_out <span class="free">φ</span> <span class="free">q</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Tensor.mat_of_cols_list <span class="numeral">4</span> <span class="main">[</span><span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">]</span><span class="main">]</span> <span class="main">⨂</span> <span class="free">φ</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> bob_def alice_out_def asm c1 a0 a1 mat_of_cols_list_def tensor_prod_of_id_2_y assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"state <span class="numeral">2</span> <span class="main">(</span>mat_of_cols_list <span class="numeral">4</span> <span class="main">[</span><span class="main">[</span><span class="main">1</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">]</span><span class="main">]</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> state_def mat_of_cols_list_def cpx_vec_length_def lessThan_atLeast0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"state <span class="numeral">2</span> <span class="main">(</span>mat_of_cols_list <span class="numeral">4</span> <span class="main">[</span><span class="main">[</span><span class="main">0</span><span class="main">,</span> <span class="main">1</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">]</span><span class="main">]</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> state_def mat_of_cols_list_def cpx_vec_length_def lessThan_atLeast0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"state <span class="numeral">2</span> <span class="main">(</span>mat_of_cols_list <span class="numeral">4</span> <span class="main">[</span><span class="main">[</span><span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">1</span><span class="main">,</span> <span class="main">0</span><span class="main">]</span><span class="main">]</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> state_def mat_of_cols_list_def cpx_vec_length_def lessThan_atLeast0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"state <span class="numeral">2</span> <span class="main">(</span>mat_of_cols_list <span class="numeral">4</span> <span class="main">[</span><span class="main">[</span><span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">1</span><span class="main">]</span><span class="main">]</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> state_def mat_of_cols_list_def cpx_vec_length_def lessThan_atLeast0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(* 
Biblio:

@inproceedings{Boender2015FormalizationOQ,
  title={Formalization of Quantum Protocols using Coq},
  author={Jaap Boender and Florian Kamm{\"u}ller and Rajagopal Nagarajan},
  booktitle={QPL},
  year={2015}
}
*)</span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="Deutsch">
<div class="head">
<h1>Theory Deutsch</h1>
</div>
<pre class="source"><span class="comment1">(*
Authors: 

  Hanna Lachnitt, TU Wien, lachnitt@student.tuwien.ac.at
  Anthony Bordg, University of Cambridge, apdb3@cam.ac.uk
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹The Deutsch Algorithm›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Deutsch
<span class="keyword2"><span class="keyword">imports</span></span>
  <a href="#More_Tensor">More_Tensor</a>
  <a href="#Measurement">Measurement</a>
<span class="keyword2"><span class="keyword">begin</span></span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
Given a function $f:{0,1}\mapsto {0,1}$, Deutsch's algorithm decides if this function is constant
or balanced with a single $f(x)$ circuit to evaluate the function for multiple values of $x$ 
simultaneously. The algorithm makes use of quantum parallelism and quantum interference.
›</span></span>
                                   
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
A constant function with values in {0,1} returns either always 0 or always 1. 
A balanced function is 0 for half of the inputs and 1 for the other half. 
›</span></span>

<span class="keyword1"><span class="command">locale</span></span> deutsch <span class="main">=</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span><span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> nat"</span></span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> dom<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> <span class="main">(</span><span class="main">{</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">}</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="main">{</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">}</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">context</span></span> deutsch
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">is_swap</span><span class="main">::</span> <span class="quoted">bool</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">is_swap</span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">1</span> <span class="main">-</span> <span class="bound">x</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Deutsch-is_swap_values"><span class="command">lemma</span></span> is_swap_values<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_swap"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">0</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">1</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> assms is_swap_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Deutsch-is_swap_sum_mod_2"><span class="command">lemma</span></span> is_swap_sum_mod_2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_swap"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">0</span> <span class="main">+</span> <span class="free">f</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="numeral">2</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms is_swap_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">const</span><span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
<span class="quoted"><span class="quoted">"<span class="free">const</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">}</span><span class="main">.</span><span class="main">(</span><span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">is_const</span><span class="main">::</span> <span class="quoted"><span class="quoted">"bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
<span class="quoted"><span class="quoted">"<span class="free">is_const</span> <span class="main">≡</span> const <span class="main">0</span> <span class="main">∨</span> const <span class="main">1</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">is_balanced</span><span class="main">::</span> <span class="quoted"><span class="quoted">"bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">is_balanced</span> <span class="main">≡</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">}</span><span class="main">.</span><span class="main">(</span><span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span> is_swap"</span></span>

<span class="keyword1" id="Deutsch-f_values"><span class="command">lemma</span></span> f_values<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="free">f</span> <span class="main">0</span> <span class="main">=</span> <span class="main">1</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">f</span> <span class="main">1</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="free">f</span> <span class="main">1</span> <span class="main">=</span> <span class="main">1</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> dom <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 
<span class="keyword1" id="Deutsch-f_cases"><span class="command">lemma</span></span> f_cases<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_const <span class="main">∨</span> is_balanced"</span></span>   
  <span class="keyword1"><span class="command">using</span></span> dom is_balanced_def const_def is_const_def is_swap_def f_values <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Deutsch-const_0_sum_mod_2"><span class="command">lemma</span></span> const_0_sum_mod_2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"const <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">0</span> <span class="main">+</span> <span class="free">f</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="numeral">2</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms const_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Deutsch-const_1_sum_mod_2"><span class="command">lemma</span></span> const_1_sum_mod_2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"const <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">0</span> <span class="main">+</span> <span class="free">f</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="numeral">2</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms const_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Deutsch-is_const_sum_mod_2"><span class="command">lemma</span></span> is_const_sum_mod_2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_const"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">0</span> <span class="main">+</span> <span class="free">f</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="numeral">2</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms is_const_def const_0_sum_mod_2 const_1_sum_mod_2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Deutsch-id_sum_mod_2"><span class="command">lemma</span></span> id_sum_mod_2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">=</span> id"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">0</span> <span class="main">+</span> <span class="free">f</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="numeral">2</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Deutsch-is_balanced_sum_mod_2"><span class="command">lemma</span></span> is_balanced_sum_mod_2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_balanced"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">0</span> <span class="main">+</span> <span class="free">f</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="numeral">2</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms is_balanced_def id_sum_mod_2 is_swap_sum_mod_2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Deutsch-f_ge_0"><span class="command">lemma</span></span> f_ge_0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span> <span class="main">≥</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* context deutsch *)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The Deutsch's Transform <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">U<span class="hidden">⇩</span><sub>f</sub></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> deutsch<span class="main">)</span> <span class="entity">deutsch_transform</span><span class="main">::</span> <span class="quoted"><span class="quoted">"complex Matrix.mat"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span>"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span> 
<span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">U<span class="hidden">⇩</span><sub>f</sub></span></span> <span class="main">≡</span> mat_of_cols_list <span class="numeral">4</span> <span class="main">[</span><span class="main">[</span><span class="main">1</span> <span class="main">-</span> <span class="free">f</span><span class="main">(</span><span class="main">0</span><span class="main">)</span><span class="main">,</span> <span class="free">f</span><span class="main">(</span><span class="main">0</span><span class="main">)</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">]</span><span class="main">,</span>
                          <span class="main">[</span><span class="free">f</span><span class="main">(</span><span class="main">0</span><span class="main">)</span><span class="main">,</span> <span class="main">1</span> <span class="main">-</span> <span class="free">f</span><span class="main">(</span><span class="main">0</span><span class="main">)</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">]</span><span class="main">,</span>
                          <span class="main">[</span><span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">1</span> <span class="main">-</span> <span class="free">f</span><span class="main">(</span><span class="main">1</span><span class="main">)</span><span class="main">,</span> <span class="free">f</span><span class="main">(</span><span class="main">1</span><span class="main">)</span><span class="main">]</span><span class="main">,</span>
                          <span class="main">[</span><span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="free">f</span><span class="main">(</span><span class="main">1</span><span class="main">)</span><span class="main">,</span> <span class="main">1</span> <span class="main">-</span> <span class="free">f</span><span class="main">(</span><span class="main">1</span><span class="main">)</span><span class="main">]</span><span class="main">]</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> deutsch<span class="main">)</span> deutsch_transform_dim <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"dim_row <span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">=</span> <span class="numeral">4</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"dim_col <span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">=</span> <span class="numeral">4</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> deutsch_transform_def mat_of_cols_list_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> deutsch<span class="main">)</span> deutsch_transform_coeff_is_zero <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="numeral">2</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="numeral">3</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">$$</span><span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="numeral">3</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">$$</span> <span class="main">(</span><span class="numeral">2</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">$$</span><span class="main">(</span><span class="numeral">2</span><span class="main">,</span><span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">$$</span> <span class="main">(</span><span class="numeral">3</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">$$</span> <span class="main">(</span><span class="numeral">3</span><span class="main">,</span><span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> deutsch_transform_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> deutsch<span class="main">)</span> deutsch_transform_coeff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span><span class="main">(</span><span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span><span class="main">(</span><span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">$$</span><span class="main">(</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span><span class="main">(</span><span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">$$</span> <span class="main">(</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">2</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span><span class="main">(</span><span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span> <span class="main">-</span> <span class="free">f</span><span class="main">(</span><span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">$$</span><span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span> <span class="main">-</span> <span class="free">f</span><span class="main">(</span><span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">$$</span> <span class="main">(</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">2</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span> <span class="main">-</span> <span class="free">f</span><span class="main">(</span><span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">$$</span> <span class="main">(</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">3</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span> <span class="main">-</span> <span class="free">f</span><span class="main">(</span><span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> deutsch_transform_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> deutsch<span class="main">)</span> <span class="entity">V<span class="hidden">⇩</span><sub>f</sub></span><span class="main">::</span> <span class="quoted"><span class="quoted">"complex Matrix.mat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">V<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">≡</span> Matrix.mat <span class="numeral">4</span> <span class="numeral">4</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span><span class="main">.</span> 
                <span class="keyword1">if</span> <span class="bound">i</span><span class="main">=</span><span class="main">0</span> <span class="main">∧</span> <span class="bound">j</span><span class="main">=</span><span class="main">0</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="main">-</span> <span class="free">f</span><span class="main">(</span><span class="main">0</span><span class="main">)</span> <span class="keyword1">else</span>
                  <span class="main">(</span><span class="keyword1">if</span> <span class="bound">i</span><span class="main">=</span><span class="main">0</span> <span class="main">∧</span> <span class="bound">j</span><span class="main">=</span><span class="main">1</span> <span class="keyword1">then</span> <span class="free">f</span><span class="main">(</span><span class="main">0</span><span class="main">)</span> <span class="keyword1">else</span>
                    <span class="main">(</span><span class="keyword1">if</span> <span class="bound">i</span><span class="main">=</span><span class="main">1</span> <span class="main">∧</span> <span class="bound">j</span><span class="main">=</span><span class="main">0</span> <span class="keyword1">then</span> <span class="free">f</span><span class="main">(</span><span class="main">0</span><span class="main">)</span> <span class="keyword1">else</span>
                      <span class="main">(</span><span class="keyword1">if</span> <span class="bound">i</span><span class="main">=</span><span class="main">1</span> <span class="main">∧</span> <span class="bound">j</span><span class="main">=</span><span class="main">1</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="main">-</span> <span class="free">f</span><span class="main">(</span><span class="main">0</span><span class="main">)</span> <span class="keyword1">else</span>
                        <span class="main">(</span><span class="keyword1">if</span> <span class="bound">i</span><span class="main">=</span><span class="numeral">2</span> <span class="main">∧</span> <span class="bound">j</span><span class="main">=</span><span class="numeral">2</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="main">-</span> <span class="free">f</span><span class="main">(</span><span class="main">1</span><span class="main">)</span> <span class="keyword1">else</span>
                          <span class="main">(</span><span class="keyword1">if</span> <span class="bound">i</span><span class="main">=</span><span class="numeral">2</span> <span class="main">∧</span> <span class="bound">j</span><span class="main">=</span><span class="numeral">3</span> <span class="keyword1">then</span> <span class="free">f</span><span class="main">(</span><span class="main">1</span><span class="main">)</span> <span class="keyword1">else</span>
                            <span class="main">(</span><span class="keyword1">if</span> <span class="bound">i</span><span class="main">=</span><span class="numeral">3</span> <span class="main">∧</span> <span class="bound">j</span><span class="main">=</span><span class="numeral">2</span> <span class="keyword1">then</span> <span class="free">f</span><span class="main">(</span><span class="main">1</span><span class="main">)</span> <span class="keyword1">else</span>
                              <span class="main">(</span><span class="keyword1">if</span> <span class="bound">i</span><span class="main">=</span><span class="numeral">3</span> <span class="main">∧</span> <span class="bound">j</span><span class="main">=</span><span class="numeral">3</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="main">-</span> <span class="free">f</span><span class="main">(</span><span class="main">1</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> deutsch<span class="main">)</span> deutsch_transform_alt_rep_coeff_is_zero <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"V<span class="hidden">⇩</span><sub>f</sub> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="numeral">2</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"V<span class="hidden">⇩</span><sub>f</sub> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="numeral">3</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"V<span class="hidden">⇩</span><sub>f</sub> <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"V<span class="hidden">⇩</span><sub>f</sub> <span class="main">$$</span><span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="numeral">3</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"V<span class="hidden">⇩</span><sub>f</sub> <span class="main">$$</span> <span class="main">(</span><span class="numeral">2</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"V<span class="hidden">⇩</span><sub>f</sub> <span class="main">$$</span><span class="main">(</span><span class="numeral">2</span><span class="main">,</span><span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"V<span class="hidden">⇩</span><sub>f</sub> <span class="main">$$</span> <span class="main">(</span><span class="numeral">3</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"V<span class="hidden">⇩</span><sub>f</sub> <span class="main">$$</span> <span class="main">(</span><span class="numeral">3</span><span class="main">,</span><span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> deutsch<span class="main">)</span> deutsch_transform_alt_rep_coeff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"V<span class="hidden">⇩</span><sub>f</sub> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span><span class="main">(</span><span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"V<span class="hidden">⇩</span><sub>f</sub> <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span><span class="main">(</span><span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"V<span class="hidden">⇩</span><sub>f</sub> <span class="main">$$</span><span class="main">(</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span><span class="main">(</span><span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"V<span class="hidden">⇩</span><sub>f</sub> <span class="main">$$</span> <span class="main">(</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">2</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span><span class="main">(</span><span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"V<span class="hidden">⇩</span><sub>f</sub> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span> <span class="main">-</span> <span class="free">f</span><span class="main">(</span><span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"V<span class="hidden">⇩</span><sub>f</sub> <span class="main">$$</span><span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span> <span class="main">-</span> <span class="free">f</span><span class="main">(</span><span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"V<span class="hidden">⇩</span><sub>f</sub> <span class="main">$$</span> <span class="main">(</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">2</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span> <span class="main">-</span> <span class="free">f</span><span class="main">(</span><span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"V<span class="hidden">⇩</span><sub>f</sub> <span class="main">$$</span> <span class="main">(</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">3</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span> <span class="main">-</span> <span class="free">f</span><span class="main">(</span><span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> deutsch<span class="main">)</span> deutsch_transform_alt_rep<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">=</span> V<span class="hidden">⇩</span><sub>f</sub>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> c0<span class="main">:</span><span class="quoted"><span class="quoted">"dim_row <span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">=</span> dim_row V<span class="hidden">⇩</span><sub>f</sub>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> c1<span class="main">:</span><span class="quoted"><span class="quoted">"dim_col <span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">=</span> dim_col V<span class="hidden">⇩</span><sub>f</sub>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span><span class="main">::</span> <span class="quoted">nat</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> dim_row V<span class="hidden">⇩</span><sub>f</sub>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> dim_col V<span class="hidden">⇩</span><sub>f</sub>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="numeral">4</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> <span class="numeral">4</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> V<span class="hidden">⇩</span><sub>f</sub> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> deutsch_transform_alt_rep_coeff deutsch_transform_alt_rep_coeff_is_zero deutsch_transform_coeff
 deutsch_transform_coeff_is_zero set_4_disj<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">U<span class="hidden">⇩</span><sub>f</sub></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is a gate.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> deutsch<span class="main">)</span> transpose_of_deutsch_transform<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup></span> <span class="main">=</span> <span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_row <span class="main">(</span><span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup></span><span class="main">)</span> <span class="main">=</span> dim_row <span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_col <span class="main">(</span><span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup></span><span class="main">)</span> <span class="main">=</span> dim_col <span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span><span class="main">::</span> <span class="quoted">nat</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> dim_row <span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> dim_col <span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup></span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> transpose_mat_def<span class="main">)</span>
      <span class="main">(</span><span class="operator">metis</span> deutsch_transform_coeff<span class="main"><span class="main">(</span></span>1-4<span class="main"><span class="main">)</span></span> deutsch_transform_coeff_is_zero set_4_disj<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> deutsch<span class="main">)</span> adjoint_of_deutsch_transform<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span> <span class="main">=</span> <span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_row <span class="main">(</span><span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span><span class="main">)</span> <span class="main">=</span> dim_row <span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_col <span class="main">(</span><span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span><span class="main">)</span> <span class="main">=</span> dim_col <span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span><span class="main">::</span> <span class="quoted">nat</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> dim_row <span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> dim_col <span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dagger_def<span class="main">)</span>
      <span class="main">(</span><span class="operator">metis</span> complex_cnj_of_nat complex_cnj_zero deutsch_transform_coeff 
        deutsch_transform_coeff_is_zero set_4_disj<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> deutsch<span class="main">)</span> deutsch_transform_is_gate<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"gate <span class="numeral">2</span> <span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_row <span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">=</span> <span class="numeral">2</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"square_mat <span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"unitary <span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">*</span> <span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">=</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>m</sub></span> <span class="main">(</span>dim_col <span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_row <span class="main">(</span><span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">*</span> <span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span><span class="main">)</span> <span class="main">=</span> dim_row <span class="main">(</span><span class="keyword1">1<span class="hidden">⇩</span><sub>m</sub></span> <span class="main">(</span>dim_col <span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_col <span class="main">(</span><span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">*</span> <span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span><span class="main">)</span> <span class="main">=</span> dim_col <span class="main">(</span><span class="keyword1">1<span class="hidden">⇩</span><sub>m</sub></span> <span class="main">(</span>dim_col <span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span><span class="main">::</span> <span class="quoted">nat</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> dim_row <span class="main">(</span><span class="keyword1">1<span class="hidden">⇩</span><sub>m</sub></span> <span class="main">(</span>dim_col <span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> dim_col <span class="main">(</span><span class="keyword1">1<span class="hidden">⇩</span><sub>m</sub></span> <span class="main">(</span>dim_col <span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">*</span> <span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>m</sub></span> <span class="main">(</span>dim_col <span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> deutsch_transform_alt_rep one_mat_def times_mat_def<span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> scalar_prod_def<span class="main">)</span> 
        <span class="keyword1"><span class="command">using</span></span> f_values <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> adjoint_of_deutsch_transform unitary_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
Two qubits are prepared. 
The first one in the state $|0\rangle$, the second one in the state $|1\rangle$.
›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">zero</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">zero</span> <span class="main">≡</span> unit_vec <span class="numeral">2</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">one</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">one</span> <span class="main">≡</span> unit_vec <span class="numeral">2</span> <span class="main">1</span>"</span></span> 

<span class="keyword1" id="Deutsch-ket_zero_is_state"><span class="command">lemma</span></span> ket_zero_is_state<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"state <span class="main">1</span> <span class="main">|</span>zero<span class="main">⟩</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> state_def ket_vec_def cpx_vec_length_def numerals<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>

<span class="keyword1" id="Deutsch-ket_one_is_state"><span class="command">lemma</span></span> ket_one_is_state<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"state <span class="main">1</span> <span class="main">|</span>one<span class="main">⟩</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> state_def ket_vec_def cpx_vec_length_def numerals<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>

<span class="keyword1" id="Deutsch-ket_zero_to_mat_of_cols_list"><span class="command">lemma</span></span> ket_zero_to_mat_of_cols_list <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|</span>zero<span class="main">⟩</span> <span class="main">=</span> mat_of_cols_list <span class="numeral">2</span> <span class="main">[</span><span class="main">[</span><span class="main">1</span><span class="main">,</span> <span class="main">0</span><span class="main">]</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ket_vec_def mat_of_cols_list_def<span class="main">)</span>

<span class="keyword1" id="Deutsch-ket_one_to_mat_of_cols_list"><span class="command">lemma</span></span> ket_one_to_mat_of_cols_list <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|</span>one<span class="main">⟩</span> <span class="main">=</span> mat_of_cols_list <span class="numeral">2</span> <span class="main">[</span><span class="main">[</span><span class="main">0</span><span class="main">,</span> <span class="main">1</span><span class="main">]</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ket_vec_def unit_vec_def mat_of_cols_list_def<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> less_2_cases <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
Applying the Hadamard gate to the state $|0\rangle$ results in the new state 
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">ψ<span class="hidden">⇩</span><sub>0</sub><span class="hidden">⇩</span><sub>0</sub></span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> = $\dfrac {(|0\rangle + |1\rangle)} {\sqrt 2 }$
›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">ψ<span class="hidden">⇩</span><sub>0</sub><span class="hidden">⇩</span><sub>0</sub></span><span class="main">::</span> <span class="quoted"><span class="quoted">"complex Matrix.mat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">ψ<span class="hidden">⇩</span><sub>0</sub><span class="hidden">⇩</span><sub>0</sub></span> <span class="main">≡</span> mat_of_cols_list <span class="numeral">2</span> <span class="main">[</span><span class="main">[</span><span class="main">1</span><span class="main">/</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">,</span> <span class="main">1</span><span class="main">/</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">]</span><span class="main">]</span>"</span></span>

<span class="keyword1" id="Deutsch-H_on_ket_zero"><span class="command">lemma</span></span> H_on_ket_zero<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>H <span class="main">*</span> <span class="main">|</span>zero<span class="main">⟩</span><span class="main">)</span> <span class="main">=</span> ψ<span class="hidden">⇩</span><sub>0</sub><span class="hidden">⇩</span><sub>0</sub>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> 
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span><span class="main">::</span> <span class="quoted">nat</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> dim_row ψ<span class="hidden">⇩</span><sub>0</sub><span class="hidden">⇩</span><sub>0</sub>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> dim_col ψ<span class="hidden">⇩</span><sub>0</sub><span class="hidden">⇩</span><sub>0</sub>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">}</span> <span class="main">∧</span> <span class="skolem">j</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mat_of_cols_list_def less_2_cases<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>H <span class="main">*</span> <span class="main">|</span>zero<span class="main">⟩</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> ψ<span class="hidden">⇩</span><sub>0</sub><span class="hidden">⇩</span><sub>0</sub> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mat_of_cols_list_def times_mat_def scalar_prod_def H_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_row <span class="main">(</span>H <span class="main">*</span> <span class="main">|</span>zero<span class="main">⟩</span><span class="main">)</span> <span class="main">=</span> dim_row ψ<span class="hidden">⇩</span><sub>0</sub><span class="hidden">⇩</span><sub>0</sub>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> H_def mat_of_cols_list_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_col <span class="main">(</span>H <span class="main">*</span> <span class="main">|</span>zero<span class="main">⟩</span><span class="main">)</span> <span class="main">=</span> dim_col ψ<span class="hidden">⇩</span><sub>0</sub><span class="hidden">⇩</span><sub>0</sub>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> H_def mat_of_cols_list_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Deutsch-H_on_ket_zero_is_state"><span class="command">lemma</span></span> H_on_ket_zero_is_state<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"state <span class="main">1</span> <span class="main">(</span>H <span class="main">*</span> <span class="main">|</span>zero<span class="main">⟩</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"gate <span class="main">1</span> H"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> H_is_gate <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"state <span class="main">1</span> <span class="main">|</span>zero<span class="main">⟩</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> ket_zero_is_state <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
Applying the Hadamard gate to the state $|0\rangle$ results in the new state 
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">ψ<span class="hidden">⇩</span><sub>0</sub><span class="hidden">⇩</span><sub>1</sub></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> = $\dfrac {(|0\rangle - |1\rangle)} {\sqrt 2}$.
›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">ψ<span class="hidden">⇩</span><sub>0</sub><span class="hidden">⇩</span><sub>1</sub></span><span class="main">::</span> <span class="quoted"><span class="quoted">"complex Matrix.mat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">ψ<span class="hidden">⇩</span><sub>0</sub><span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≡</span> mat_of_cols_list <span class="numeral">2</span> <span class="main">[</span><span class="main">[</span><span class="main">1</span><span class="main">/</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">,</span> <span class="main">-</span><span class="main">1</span><span class="main">/</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">]</span><span class="main">]</span>"</span></span>

<span class="keyword1" id="Deutsch-H_on_ket_one"><span class="command">lemma</span></span> H_on_ket_one<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>H <span class="main">*</span> <span class="main">|</span>one<span class="main">⟩</span><span class="main">)</span> <span class="main">=</span> ψ<span class="hidden">⇩</span><sub>0</sub><span class="hidden">⇩</span><sub>1</sub>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> 
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span><span class="main">::</span> <span class="quoted">nat</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> dim_row ψ<span class="hidden">⇩</span><sub>0</sub><span class="hidden">⇩</span><sub>1</sub>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> dim_col ψ<span class="hidden">⇩</span><sub>0</sub><span class="hidden">⇩</span><sub>1</sub>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">}</span> <span class="main">∧</span> <span class="skolem">j</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mat_of_cols_list_def less_2_cases<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>H <span class="main">*</span> <span class="main">|</span>one<span class="main">⟩</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> ψ<span class="hidden">⇩</span><sub>0</sub><span class="hidden">⇩</span><sub>1</sub> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mat_of_cols_list_def times_mat_def scalar_prod_def H_def ket_vec_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_row <span class="main">(</span>H <span class="main">*</span> <span class="main">|</span>one<span class="main">⟩</span><span class="main">)</span> <span class="main">=</span> dim_row ψ<span class="hidden">⇩</span><sub>0</sub><span class="hidden">⇩</span><sub>1</sub>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> H_def mat_of_cols_list_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_col <span class="main">(</span>H <span class="main">*</span> <span class="main">|</span>one<span class="main">⟩</span><span class="main">)</span> <span class="main">=</span> dim_col ψ<span class="hidden">⇩</span><sub>0</sub><span class="hidden">⇩</span><sub>1</sub>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> H_def mat_of_cols_list_def ket_vec_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Deutsch-H_on_ket_one_is_state"><span class="command">lemma</span></span> H_on_ket_one_is_state<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"state <span class="main">1</span> <span class="main">(</span>H <span class="main">*</span> <span class="main">|</span>one<span class="main">⟩</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> H_is_gate ket_one_is_state <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
Then, the state <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">ψ<span class="hidden">⇩</span><sub>1</sub></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> = $\dfrac {(|00\rangle - |01\rangle + |10\rangle - |11\rangle)} {2} $
is obtained by taking the tensor product of the states 
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">ψ<span class="hidden">⇩</span><sub>0</sub><span class="hidden">⇩</span><sub>0</sub></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> = $\dfrac {(|0\rangle + |1\rangle)} {\sqrt 2} $  and  
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">ψ<span class="hidden">⇩</span><sub>0</sub><span class="hidden">⇩</span><sub>1</sub></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> = $\dfrac {(|0\rangle - |1\rangle)} {\sqrt 2} $.
›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">ψ<span class="hidden">⇩</span><sub>1</sub></span><span class="main">::</span> <span class="quoted"><span class="quoted">"complex Matrix.mat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">ψ<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≡</span> mat_of_cols_list <span class="numeral">4</span> <span class="main">[</span><span class="main">[</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">,</span> <span class="main">-</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">,</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">,</span> <span class="main">-</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">]</span><span class="main">]</span>"</span></span>

<span class="keyword1" id="Deutsch-ψ"><span class="command">lemma</span></span> ψ<span class="hidden">⇩</span><sub>0</sub>_to_ψ<span class="hidden">⇩</span><sub>1</sub><span class="main">:</span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>ψ<span class="hidden">⇩</span><sub>0</sub><span class="hidden">⇩</span><sub>0</sub> <span class="main">⨂</span> ψ<span class="hidden">⇩</span><sub>0</sub><span class="hidden">⇩</span><sub>1</sub><span class="main">)</span> <span class="main">=</span> ψ<span class="hidden">⇩</span><sub>1</sub>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> 
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span><span class="main">::</span> <span class="quoted">nat</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> dim_row ψ<span class="hidden">⇩</span><sub>1</sub>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> dim_col ψ<span class="hidden">⇩</span><sub>1</sub>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> mat_of_cols_list_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"complex_of_real <span class="main">(</span>sqrt <span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> complex_of_real <span class="main">(</span>sqrt <span class="numeral">2</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult_2_right numeral_Bit0 of_real_mult of_real_numeral real_sqrt_four real_sqrt_mult<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>ψ<span class="hidden">⇩</span><sub>0</sub><span class="hidden">⇩</span><sub>0</sub> <span class="main">⨂</span> ψ<span class="hidden">⇩</span><sub>0</sub><span class="hidden">⇩</span><sub>1</sub><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> ψ<span class="hidden">⇩</span><sub>1</sub> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> mat_of_cols_list_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span> 
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_row <span class="main">(</span>ψ<span class="hidden">⇩</span><sub>0</sub><span class="hidden">⇩</span><sub>0</sub> <span class="main">⨂</span> ψ<span class="hidden">⇩</span><sub>0</sub><span class="hidden">⇩</span><sub>1</sub><span class="main">)</span> <span class="main">=</span> dim_row ψ<span class="hidden">⇩</span><sub>1</sub>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mat_of_cols_list_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_col <span class="main">(</span>ψ<span class="hidden">⇩</span><sub>0</sub><span class="hidden">⇩</span><sub>0</sub> <span class="main">⨂</span> ψ<span class="hidden">⇩</span><sub>0</sub><span class="hidden">⇩</span><sub>1</sub><span class="main">)</span> <span class="main">=</span> dim_col ψ<span class="hidden">⇩</span><sub>1</sub>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mat_of_cols_list_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Deutsch-ψ"><span class="command">lemma</span></span> ψ<span class="hidden">⇩</span><sub>1</sub>_is_state<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"state <span class="numeral">2</span> ψ<span class="hidden">⇩</span><sub>1</sub>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> 
  <span class="keyword3"><span class="command">show</span></span>  <span class="quoted"><span class="quoted">"dim_col ψ<span class="hidden">⇩</span><sub>1</sub> <span class="main">=</span> <span class="main">1</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Tensor.mat_of_cols_list_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_row ψ<span class="hidden">⇩</span><sub>1</sub> <span class="main">=</span> <span class="numeral">2</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Tensor.mat_of_cols_list_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∥</span>Matrix.col ψ<span class="hidden">⇩</span><sub>1</sub> <span class="main">0</span><span class="main">∥</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> H_on_ket_one_is_state H_on_ket_zero_is_state state.is_normal tensor_state2 ψ<span class="hidden">⇩</span><sub>0</sub>_to_ψ<span class="hidden">⇩</span><sub>1</sub>
    H_on_ket_one H_on_ket_zero <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
Next, the gate <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">U<span class="hidden">⇩</span><sub>f</sub></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is applied to the state 
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">ψ<span class="hidden">⇩</span><sub>1</sub></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> = $\dfrac {(|00\rangle - |01\rangle + |10\rangle - |11\rangle)} {2}$ and 
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">ψ<span class="hidden">⇩</span><sub>2</sub></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>= $\dfrac {(|0f(0)\oplus 0\rangle - |0 f(0) \oplus 1\rangle + |1 f(1)\oplus 0\rangle - |1f(1)\oplus 1\rangle)} {2}$ 
is obtained. This simplifies to 
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">ψ<span class="hidden">⇩</span><sub>2</sub></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>= $\dfrac {(|0f(0)\rangle - |0 \overline{f(0)} \rangle + |1 f(1)\rangle - |1\overline{f(1)}\rangle)} {2}$ 
›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> deutsch<span class="main">)</span> <span class="entity">ψ<span class="hidden">⇩</span><sub>2</sub></span><span class="main">::</span> <span class="quoted"><span class="quoted">"complex Matrix.mat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">ψ<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">≡</span>  mat_of_cols_list <span class="numeral">4</span> <span class="main">[</span><span class="main">[</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">f</span><span class="main">(</span><span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">/</span><span class="numeral">2</span> <span class="main">-</span> <span class="free">f</span><span class="main">(</span><span class="main">0</span><span class="main">)</span><span class="main">/</span><span class="numeral">2</span><span class="main">,</span>
                            <span class="free">f</span><span class="main">(</span><span class="main">0</span><span class="main">)</span><span class="main">/</span><span class="numeral">2</span> <span class="main">-</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">f</span><span class="main">(</span><span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">/</span><span class="numeral">2</span><span class="main">,</span>
                            <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">f</span><span class="main">(</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">/</span><span class="numeral">2</span> <span class="main">-</span> <span class="free">f</span><span class="main">(</span><span class="main">1</span><span class="main">)</span><span class="main">/</span><span class="numeral">2</span><span class="main">,</span>
                            <span class="free">f</span><span class="main">(</span><span class="main">1</span><span class="main">)</span><span class="main">/</span><span class="numeral">2</span> <span class="main">-</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span> <span class="free">f</span><span class="main">(</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">/</span><span class="numeral">2</span><span class="main">]</span><span class="main">]</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> deutsch<span class="main">)</span> ψ<span class="hidden">⇩</span><sub>1</sub>_to_ψ<span class="hidden">⇩</span><sub>2</sub><span class="main">:</span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">*</span> ψ<span class="hidden">⇩</span><sub>1</sub> <span class="main">=</span> ψ<span class="hidden">⇩</span><sub>2</sub>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> 
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span><span class="main">::</span> <span class="quoted">nat</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> dim_row ψ<span class="hidden">⇩</span><sub>2</sub> "</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> dim_col ψ<span class="hidden">⇩</span><sub>2</sub>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> asm<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">}</span> <span class="main">∧</span> <span class="skolem">j</span> <span class="main">=</span> <span class="main">0</span> "</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mat_of_cols_list_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> dim_row <span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">∧</span> <span class="skolem">j</span> <span class="main">&lt;</span> dim_col ψ<span class="hidden">⇩</span><sub>1</sub>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> deutsch_transform_def mat_of_cols_list_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">*</span> ψ<span class="hidden">⇩</span><sub>1</sub><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span> 
        <span class="main">=</span> <span class="main">(</span><span class="main">∑</span> <span class="bound">k</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span> <span class="main">..&lt;</span> dim_vec ψ<span class="hidden">⇩</span><sub>1</sub><span class="main">}</span><span class="main">.</span> <span class="main">(</span>Matrix.row <span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span> <span class="skolem">i</span><span class="main">)</span> <span class="main">$</span> <span class="bound">k</span> <span class="main">*</span> <span class="main">(</span>Matrix.col ψ<span class="hidden">⇩</span><sub>1</sub> <span class="skolem">j</span><span class="main">)</span> <span class="main">$</span> <span class="bound">k</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> times_mat_def scalar_prod_def<span class="main">)</span><span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">*</span> ψ<span class="hidden">⇩</span><sub>1</sub><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> ψ<span class="hidden">⇩</span><sub>2</sub> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span>  mat_of_cols_list_def deutsch_transform_def asm <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_row <span class="main">(</span><span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">*</span> ψ<span class="hidden">⇩</span><sub>1</sub><span class="main">)</span> <span class="main">=</span> dim_row ψ<span class="hidden">⇩</span><sub>2</sub>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mat_of_cols_list_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_col <span class="main">(</span><span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">*</span> ψ<span class="hidden">⇩</span><sub>1</sub><span class="main">)</span> <span class="main">=</span> dim_col ψ<span class="hidden">⇩</span><sub>2</sub>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mat_of_cols_list_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> deutsch<span class="main">)</span> ψ<span class="hidden">⇩</span><sub>2</sub>_is_state<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"state <span class="numeral">2</span> ψ<span class="hidden">⇩</span><sub>2</sub>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span>  <span class="quoted"><span class="quoted">"dim_col ψ<span class="hidden">⇩</span><sub>2</sub> <span class="main">=</span> <span class="main">1</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Tensor.mat_of_cols_list_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_row ψ<span class="hidden">⇩</span><sub>2</sub> <span class="main">=</span> <span class="numeral">2</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Tensor.mat_of_cols_list_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∥</span>Matrix.col ψ<span class="hidden">⇩</span><sub>2</sub> <span class="main">0</span><span class="main">∥</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> gate_on_state_is_state ψ<span class="hidden">⇩</span><sub>1</sub>_is_state deutsch_transform_is_gate ψ<span class="hidden">⇩</span><sub>1</sub>_to_ψ<span class="hidden">⇩</span><sub>2</sub> state_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Deutsch-H_tensor_Id_1"><span class="command">lemma</span></span> H_tensor_Id_1<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">defines</span></span> d<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">≡</span>  mat_of_cols_list <span class="numeral">4</span> <span class="main">[</span><span class="main">[</span><span class="main">1</span><span class="main">/</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">1</span><span class="main">/</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">,</span> <span class="main">0</span><span class="main">]</span><span class="main">,</span>
                                  <span class="main">[</span><span class="main">0</span><span class="main">,</span> <span class="main">1</span><span class="main">/</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">1</span><span class="main">/</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">]</span><span class="main">,</span>
                                  <span class="main">[</span><span class="main">1</span><span class="main">/</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">-</span><span class="main">1</span><span class="main">/</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">,</span> <span class="main">0</span><span class="main">]</span><span class="main">,</span>
                                  <span class="main">[</span><span class="main">0</span><span class="main">,</span> <span class="main">1</span><span class="main">/</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">-</span><span class="main">1</span><span class="main">/</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">]</span><span class="main">]</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>H <span class="main">⨂</span> Id <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="free">v</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_col <span class="main">(</span>H <span class="main">⨂</span> Id <span class="main">1</span><span class="main">)</span> <span class="main">=</span> dim_col <span class="free">v</span>"</span></span>  
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> d H_def Id_def mat_of_cols_list_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_row <span class="main">(</span>H <span class="main">⨂</span> Id <span class="main">1</span><span class="main">)</span> <span class="main">=</span> dim_row <span class="free">v</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> d H_def Id_def mat_of_cols_list_def<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span><span class="main">::</span> <span class="quoted">nat</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> dim_row <span class="free">v</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> dim_col <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="numeral">4</span><span class="main">}</span> <span class="main">∧</span> <span class="skolem">j</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="numeral">4</span><span class="main">}</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> d mat_of_cols_list_def<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>H <span class="main">⨂</span> Id <span class="main">1</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="free">v</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> d Id_def H_def mat_of_cols_list_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Deutsch-H_tensor_Id_1_is_gate"><span class="command">lemma</span></span> H_tensor_Id_1_is_gate<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"gate <span class="numeral">2</span> <span class="main">(</span>H <span class="main">⨂</span> Id <span class="main">1</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> 
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_row <span class="main">(</span>H <span class="main">⨂</span> Quantum.Id <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">2</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> H_tensor_Id_1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mat_of_cols_list_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"square_mat <span class="main">(</span>H <span class="main">⨂</span> Quantum.Id <span class="main">1</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> H_is_gate id_is_gate tensor_gate_sqr_mat <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"unitary <span class="main">(</span>H <span class="main">⨂</span> Quantum.Id <span class="main">1</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> H_is_gate gate_def id_is_gate tensor_gate <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
Applying the Hadamard gate to the first qubit of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">ψ<span class="hidden">⇩</span><sub>2</sub></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> results in <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">ψ<span class="hidden">⇩</span><sub>3</sub></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> = 
$\pm |f(0)\oplus f(1)\rangle \left[ \dfrac {(|0\rangle - |1\rangle)} {\sqrt 2}\right]$ 
›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> deutsch<span class="main">)</span> <span class="entity">ψ<span class="hidden">⇩</span><sub>3</sub></span><span class="main">::</span> <span class="quoted"><span class="quoted">"complex Matrix.mat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">ψ<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">≡</span> mat_of_cols_list <span class="numeral">4</span> 
<span class="main">[</span><span class="main">[</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="free">f</span><span class="main">(</span><span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">/</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="free">f</span><span class="main">(</span><span class="main">0</span><span class="main">)</span><span class="main">/</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="free">f</span><span class="main">(</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">/</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="free">f</span><span class="main">(</span><span class="main">1</span><span class="main">)</span><span class="main">/</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">,</span>
  <span class="free">f</span><span class="main">(</span><span class="main">0</span><span class="main">)</span><span class="main">/</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="free">f</span><span class="main">(</span><span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">/</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="free">f</span><span class="main">(</span><span class="main">1</span><span class="main">)</span><span class="main">/</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="free">f</span><span class="main">(</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">/</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">,</span>
  <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="free">f</span><span class="main">(</span><span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">/</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="free">f</span><span class="main">(</span><span class="main">0</span><span class="main">)</span><span class="main">/</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="free">f</span><span class="main">(</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">/</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="free">f</span><span class="main">(</span><span class="main">1</span><span class="main">)</span><span class="main">/</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">,</span>
  <span class="free">f</span><span class="main">(</span><span class="main">0</span><span class="main">)</span><span class="main">/</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="free">f</span><span class="main">(</span><span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">/</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="free">f</span><span class="main">(</span><span class="main">1</span><span class="main">)</span><span class="main">/</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="free">f</span><span class="main">(</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">/</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">]</span><span class="main">]</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> deutsch<span class="main">)</span> ψ<span class="hidden">⇩</span><sub>2</sub>_to_ψ<span class="hidden">⇩</span><sub>3</sub><span class="main">:</span> 
 <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>H <span class="main">⨂</span> Id <span class="main">1</span><span class="main">)</span> <span class="main">*</span> ψ<span class="hidden">⇩</span><sub>2</sub> <span class="main">=</span> ψ<span class="hidden">⇩</span><sub>3</sub>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span><span class="main">::</span> <span class="quoted">nat</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> dim_row ψ<span class="hidden">⇩</span><sub>3</sub>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> dim_col ψ<span class="hidden">⇩</span><sub>3</sub>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> a0<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">}</span> <span class="main">∧</span> <span class="skolem">j</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mat_of_cols_list_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> dim_row <span class="main">(</span>H <span class="main">⨂</span> Id <span class="main">1</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">j</span> <span class="main">&lt;</span> dim_col ψ<span class="hidden">⇩</span><sub>2</sub>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> mat_of_cols_list_def H_tensor_Id_1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>H <span class="main">⨂</span> Id <span class="main">1</span><span class="main">)</span><span class="main">*</span>ψ<span class="hidden">⇩</span><sub>2</sub><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>
        <span class="main">=</span> <span class="main">(</span><span class="main">∑</span> <span class="bound">k</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span> <span class="main">..&lt;</span> dim_vec ψ<span class="hidden">⇩</span><sub>2</sub><span class="main">}</span><span class="main">.</span> <span class="main">(</span>Matrix.row <span class="main">(</span>H <span class="main">⨂</span> Id <span class="main">1</span><span class="main">)</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">$</span> <span class="bound">k</span> <span class="main">*</span> <span class="main">(</span>Matrix.col ψ<span class="hidden">⇩</span><sub>2</sub> <span class="skolem">j</span><span class="main">)</span> <span class="main">$</span> <span class="bound">k</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> times_mat_def scalar_prod_def<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>H <span class="main">⨂</span> Id <span class="main">1</span><span class="main">)</span> <span class="main">*</span> ψ<span class="hidden">⇩</span><sub>2</sub><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> ψ<span class="hidden">⇩</span><sub>3</sub> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span>  mat_of_cols_list_def H_tensor_Id_1 a0 f_ge_0 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> diff_divide_distrib<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_row <span class="main">(</span><span class="main">(</span>H <span class="main">⨂</span> Id <span class="main">1</span><span class="main">)</span> <span class="main">*</span> ψ<span class="hidden">⇩</span><sub>2</sub><span class="main">)</span> <span class="main">=</span> dim_row ψ<span class="hidden">⇩</span><sub>3</sub>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> H_tensor_Id_1 mat_of_cols_list_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_col <span class="main">(</span><span class="main">(</span>H <span class="main">⨂</span> Id <span class="main">1</span><span class="main">)</span> <span class="main">*</span> ψ<span class="hidden">⇩</span><sub>2</sub><span class="main">)</span> <span class="main">=</span> dim_col ψ<span class="hidden">⇩</span><sub>3</sub>"</span></span>    
    <span class="keyword1"><span class="command">using</span></span> H_tensor_Id_1 mat_of_cols_list_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> deutsch<span class="main">)</span> ψ<span class="hidden">⇩</span><sub>3</sub>_is_state<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"state <span class="numeral">2</span> ψ<span class="hidden">⇩</span><sub>3</sub>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"gate <span class="numeral">2</span> <span class="main">(</span>H <span class="main">⨂</span> Id <span class="main">1</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> H_tensor_Id_1_is_gate <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"state <span class="numeral">2</span> ψ<span class="hidden">⇩</span><sub>3</sub>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> ψ<span class="hidden">⇩</span><sub>2</sub>_is_state ψ<span class="hidden">⇩</span><sub>2</sub>_to_ψ<span class="hidden">⇩</span><sub>3</sub> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> gate_on_state_is_state<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
Finally, all steps are put together. The result depends on the function f. If f is constant
the first qubit of $\pm |f(0)\oplus f(1)\rangle \left[ \dfrac {(|0\rangle - |1\rangle)} {\sqrt 2}\right]$
is 0, if it is is\_balanced it is 1. 
The algorithm only uses one evaluation of f(x) and will always succeed. 
›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> deutsch<span class="main">)</span> <span class="entity">deutsch_algo</span><span class="main">::</span> <span class="quoted"><span class="quoted">"complex Matrix.mat"</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
<span class="quoted"><span class="quoted">"<span class="free">deutsch_algo</span> <span class="main">≡</span> <span class="main">(</span>H <span class="main">⨂</span> Id <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span>H <span class="main">*</span> <span class="main">|</span>zero<span class="main">⟩</span><span class="main">)</span> <span class="main">⨂</span> <span class="main">(</span>H <span class="main">*</span> <span class="main">|</span>one<span class="main">⟩</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> deutsch<span class="main">)</span> deutsch_algo_result <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"deutsch_algo <span class="main">=</span> ψ<span class="hidden">⇩</span><sub>3</sub>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> deutsch_algo_def H_on_ket_zero H_on_ket_one ψ<span class="hidden">⇩</span><sub>0</sub>_to_ψ<span class="hidden">⇩</span><sub>1</sub> ψ<span class="hidden">⇩</span><sub>1</sub>_to_ψ<span class="hidden">⇩</span><sub>2</sub> ψ<span class="hidden">⇩</span><sub>2</sub>_to_ψ<span class="hidden">⇩</span><sub>3</sub> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> deutsch<span class="main">)</span> deutsch_algo_result_is_state<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"state <span class="numeral">2</span> deutsch_algo"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> ψ<span class="hidden">⇩</span><sub>3</sub>_is_state <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
If the function is constant then the measurement of the first qubit should result in the state 
$|0\rangle$ with probability 1. 
›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> deutsch<span class="main">)</span> prob0_deutsch_algo_const<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_const"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"prob0 <span class="numeral">2</span> deutsch_algo <span class="main">0</span> <span class="main">=</span> <span class="main">1</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">k</span><span class="main">|</span> <span class="bound">k</span><span class="main">::</span>nat<span class="main">.</span> <span class="main">(</span><span class="bound">k</span> <span class="main">&lt;</span> <span class="numeral">4</span><span class="main">)</span> <span class="main">∧</span> <span class="main">¬</span> select_index <span class="numeral">2</span> <span class="main">0</span> <span class="bound">k</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> select_index_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prob0 <span class="numeral">2</span> deutsch_algo <span class="main">0</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span>cmod<span class="main">(</span>deutsch_algo <span class="main">$$</span> <span class="main">(</span><span class="bound">j</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> deutsch_algo_result_is_state prob0_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"prob0 <span class="numeral">2</span> deutsch_algo <span class="main">0</span> <span class="main">=</span> <span class="main">1</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms is_const_def const_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> deutsch<span class="main">)</span> prob1_deutsch_algo_const<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_const"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"prob1 <span class="numeral">2</span> deutsch_algo <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> assms prob0_deutsch_algo_const prob_sum_is_one<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span>"</span></span> <span class="quoted"><span class="quoted">"deutsch_algo"</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span>"</span></span><span class="main">]</span> 
deutsch_algo_result_is_state <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
If the function is balanced the measurement of the first qubit should result in the state $|1\rangle$ 
with probability 1. 
›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> deutsch<span class="main">)</span> prob0_deutsch_algo_balanced<span class="main">:</span>  
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_balanced"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"prob0 <span class="numeral">2</span> deutsch_algo <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">k</span><span class="main">|</span> <span class="bound">k</span><span class="main">::</span>nat<span class="main">.</span> <span class="main">(</span><span class="bound">k</span> <span class="main">&lt;</span> <span class="numeral">4</span><span class="main">)</span> <span class="main">∧</span> <span class="main">¬</span> select_index <span class="numeral">2</span> <span class="main">0</span> <span class="bound">k</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> select_index_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prob0 <span class="numeral">2</span> deutsch_algo <span class="main">0</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span>cmod<span class="main">(</span>deutsch_algo <span class="main">$$</span> <span class="main">(</span><span class="bound">j</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> deutsch_algo_result_is_state prob0_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"prob0 <span class="numeral">2</span> deutsch_algo <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> is_swap_values assms is_balanced_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> deutsch<span class="main">)</span> prob1_deutsch_algo_balanced<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_balanced"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"prob1 <span class="numeral">2</span> deutsch_algo <span class="main">0</span> <span class="main">=</span> <span class="main">1</span>"</span></span> 
<span class="keyword1"><span class="command">using</span></span> assms prob0_deutsch_algo_balanced prob_sum_is_one<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span>"</span></span> <span class="quoted"><span class="quoted">"deutsch_algo"</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span>"</span></span><span class="main">]</span> 
deutsch_algo_result_is_state <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
 
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Eventually, the measurement of the first qubit results in $f(0)\oplus f(1)$. ›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> deutsch<span class="main">)</span> <span class="entity">deutsch_algo_eval</span><span class="main">::</span> <span class="quoted"><span class="quoted">"real"</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
<span class="quoted"><span class="quoted">"<span class="free">deutsch_algo_eval</span> <span class="main">≡</span> prob1 <span class="numeral">2</span> deutsch_algo <span class="main">0</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> deutsch<span class="main">)</span> sum_mod_2_cases<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">0</span> <span class="main">+</span> <span class="free">f</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="numeral">2</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟶</span> is_const"</span></span> 
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">0</span> <span class="main">+</span> <span class="free">f</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="numeral">2</span> <span class="main">=</span> <span class="main">1</span> <span class="main">⟶</span> is_balanced"</span></span>
  <span class="keyword1"><span class="command">using</span></span> f_cases is_balanced_sum_mod_2 is_const_sum_mod_2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> deutsch<span class="main">)</span> deutsch_algo_eval_is_sum_mod_2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"deutsch_algo_eval <span class="main">=</span> <span class="main">(</span><span class="free">f</span> <span class="main">0</span> <span class="main">+</span> <span class="free">f</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="numeral">2</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> deutsch_algo_eval_def f_cases is_const_sum_mod_2 is_balanced_sum_mod_2 
prob1_deutsch_algo_const prob1_deutsch_algo_balanced <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
If the algorithm returns 0 then one concludes that the input function is constant and
if it returns 1 then the function is balanced.
›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> deutsch<span class="main">)</span> deutsch_algo_is_correct<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"deutsch_algo_eval <span class="main">=</span> <span class="main">0</span> <span class="main">⟶</span> is_const"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"deutsch_algo_eval <span class="main">=</span> <span class="main">1</span> <span class="main">⟶</span> is_balanced"</span></span>
  <span class="keyword1"><span class="command">using</span></span> deutsch_algo_eval_is_sum_mod_2 sum_mod_2_cases <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="Deutsch_Jozsa">
<div class="head">
<h1>Theory Deutsch_Jozsa</h1>
</div>
<pre class="source"><span class="comment1">(*
Authors: 
  Hanna Lachnitt, TU Wien, lachnitt@student.tuwien.ac.at
  Anthony Bordg, University of Cambridge, apdb3@cam.ac.uk
*)</span> 

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹The Deutsch-Jozsa Algorithm›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Deutsch_Jozsa
<span class="keyword2"><span class="keyword">imports</span></span>
  <a href="#Deutsch">Deutsch</a>
  <a href="#More_Tensor">More_Tensor</a>
  <a href="#Binary_Nat">Binary_Nat</a>
<span class="keyword2"><span class="keyword">begin</span></span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
Given a function $f:{0,1}^n \mapsto {0,1}$, the Deutsch-Jozsa algorithm decides if this function is 
constant or balanced with a single $f(x)$ circuit to evaluate the function for multiple values of $x$ 
simultaneously. The algorithm makes use of quantum parallelism and quantum interference.

A constant function with values in {0,1} returns either always 0 or always 1. 
A balanced function is 0 for half of the inputs and 1 for the other half. 
›</span></span>

<span class="keyword1"><span class="command">locale</span></span> bob_fun <span class="main">=</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span><span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> nat"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">n</span><span class="main">::</span> <span class="quoted"><span class="quoted">"nat"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> dom<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> <span class="main">(</span><span class="main">{</span><span class="main">(</span><span class="bound">i</span><span class="main">::</span>nat<span class="main">)</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">}</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="main">{</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> dim<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≥</span> <span class="main">1</span>"</span></span>

<span class="keyword1"><span class="command">context</span></span> bob_fun
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">const</span><span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
<span class="quoted"><span class="quoted">"<span class="free">const</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="bound">i</span><span class="main">::</span>nat<span class="main">.</span> <span class="bound">i</span><span class="main">&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">}</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">is_const</span><span class="main">::</span> <span class="quoted">bool</span> <span class="keyword2"><span class="keyword">where</span></span> 
<span class="quoted"><span class="quoted">"<span class="free">is_const</span> <span class="main">≡</span> const <span class="main">0</span> <span class="main">∨</span> const <span class="main">1</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">is_balanced</span><span class="main">::</span> <span class="quoted">bool</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">is_balanced</span> <span class="main">≡</span> <span class="main">∃</span><span class="bound">A</span> <span class="bound">B</span> <span class="main">::</span>nat set<span class="main">.</span> <span class="bound">A</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound">i</span><span class="main">::</span>nat<span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">}</span> <span class="main">∧</span> <span class="bound">B</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound">i</span><span class="main">::</span>nat<span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">}</span>
                   <span class="main">∧</span> card <span class="bound">A</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">∧</span> card <span class="bound">B</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="main">1</span><span class="main">)</span>  
                   <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="bound">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>  <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="bound">B</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">1</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Deutsch_Jozsa-is_balanced_inter"><span class="command">lemma</span></span> is_balanced_inter<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span> <span class="free">B</span><span class="main">::</span> <span class="quoted"><span class="quoted">"nat set"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="free">B</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">1</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">∩</span> <span class="free">B</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Deutsch_Jozsa-is_balanced_union"><span class="command">lemma</span></span> is_balanced_union<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span> <span class="free">B</span><span class="main">::</span> <span class="quoted"><span class="quoted">"nat set"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound">i</span><span class="main">::</span>nat<span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound">i</span><span class="main">::</span>nat<span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">}</span>"</span></span> 
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"card <span class="free">A</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"card <span class="free">B</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="main">1</span><span class="main">)</span>"</span></span> 
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">∩</span> <span class="free">B</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">∪</span> <span class="free">B</span> <span class="main">=</span> <span class="main">{</span><span class="bound">i</span><span class="main">::</span>nat<span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">B</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> card_ge_0_finite<span class="main">)</span>
      <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> card_ge_0_finite<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card<span class="main">(</span><span class="free">A</span> <span class="main">∪</span> <span class="free">B</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">*</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="main">1</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3-5<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> card_Un_disjoint<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card<span class="main">(</span><span class="free">A</span> <span class="main">∪</span> <span class="free">B</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Nat.nat.simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> One_nat_def dim le_0_eq power_eq_if<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> card<span class="main">(</span><span class="main">{</span><span class="bound">i</span><span class="main">::</span>nat<span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">∪</span> <span class="free">B</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound">i</span><span class="main">::</span>nat<span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">}</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="main">{</span><span class="bound">i</span><span class="main">::</span>nat<span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command">using</span></span> card_subset_eq<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">i</span><span class="main">::</span>nat<span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">∪</span> <span class="free">B</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Deutsch_Jozsa-f_ge_0"><span class="command">lemma</span></span> f_ge_0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Deutsch_Jozsa-f_dom_not_zero"><span class="command">lemma</span></span> f_dom_not_zero<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> <span class="main">(</span><span class="main">{</span><span class="bound">i</span><span class="main">::</span>nat<span class="main">.</span> <span class="free">n</span> <span class="main">≥</span> <span class="main">1</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">}</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="main">{</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">}</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> dim dom <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Deutsch_Jozsa-f_values"><span class="command">lemma</span></span> f_values<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">(</span><span class="bound">i</span><span class="main">::</span>nat<span class="main">)</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">}</span> <span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">1</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> dom <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* bob_fun *)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The input function has to be constant or balanced.›</span></span>

<span class="keyword1"><span class="command">locale</span></span> jozsa <span class="main">=</span> bob_fun <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> const_or_balanced<span class="main">:</span> <span class="quoted"><span class="quoted">"is_const <span class="main">∨</span> is_balanced "</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
Introduce two customised rules: disjunctions with four disjuncts and induction starting from one 
instead of zero.
›</span></span>

<span class="comment1">(* To deal with Uf it is often necessary to do a case distinction with four different cases.*)</span>
<span class="keyword1" id="Deutsch_Jozsa-disj_four_cases"><span class="command">lemma</span></span> disj_four_cases<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">∨</span> <span class="free">B</span> <span class="main">∨</span> <span class="free">C</span> <span class="main">∨</span> <span class="free">D</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">⟹</span> <span class="free">P</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">⟹</span> <span class="free">P</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">C</span> <span class="main">⟹</span> <span class="free">P</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">D</span> <span class="main">⟹</span> <span class="free">P</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The unitary transform <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">U<span class="hidden">⇩</span><sub>f</sub></span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> jozsa<span class="main">)</span> <span class="entity">jozsa_transform</span><span class="main">::</span> <span class="quoted"><span class="quoted">"complex Matrix.mat"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span>"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span> 
<span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">U<span class="hidden">⇩</span><sub>f</sub></span></span> <span class="main">≡</span> Matrix.mat <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span><span class="main">.</span> 
  <span class="keyword1">if</span> <span class="bound">i</span> <span class="main">=</span> <span class="bound">j</span> <span class="keyword1">then</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="free">f</span><span class="main">(</span><span class="bound">i</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">else</span> 
    <span class="keyword1">if</span> <span class="bound">i</span> <span class="main">=</span> <span class="bound">j</span> <span class="main">+</span> <span class="main">1</span> <span class="main">∧</span> odd <span class="bound">i</span> <span class="keyword1">then</span> <span class="free">f</span><span class="main">(</span><span class="bound">i</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span> <span class="keyword1">else</span>
      <span class="keyword1">if</span> <span class="bound">i</span> <span class="main">=</span> <span class="bound">j</span> <span class="main">-</span> <span class="main">1</span> <span class="main">∧</span> even <span class="bound">i</span> <span class="main">∧</span> <span class="bound">j</span><span class="main">≥</span><span class="main">1</span> <span class="keyword1">then</span> <span class="free">f</span><span class="main">(</span><span class="bound">i</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> jozsa<span class="main">)</span> jozsa_transform_dim <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"dim_row <span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">=</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"dim_col <span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">=</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> jozsa_transform_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> jozsa<span class="main">)</span> jozsa_transform_coeff_is_zero <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> dim_row <span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">∧</span> <span class="free">j</span> <span class="main">&lt;</span> dim_col <span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">i</span><span class="main">≠</span><span class="free">j</span> <span class="main">∧</span> <span class="main">¬</span><span class="main">(</span><span class="free">i</span><span class="main">=</span><span class="free">j</span><span class="main">+</span><span class="main">1</span> <span class="main">∧</span> odd <span class="free">i</span><span class="main">)</span> <span class="main">∧</span> <span class="main">¬</span> <span class="main">(</span><span class="free">i</span><span class="main">=</span><span class="free">j</span><span class="main">-</span><span class="main">1</span> <span class="main">∧</span> even <span class="free">i</span> <span class="main">∧</span> <span class="free">j</span><span class="main">≥</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> <span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="free">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> jozsa_transform_def assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> jozsa<span class="main">)</span> jozsa_transform_coeff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> dim_row <span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">∧</span> <span class="free">j</span> <span class="main">&lt;</span> dim_col <span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">=</span> <span class="free">j</span> <span class="main">⟶</span> <span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="free">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span> <span class="main">-</span> <span class="free">f</span> <span class="main">(</span><span class="free">i</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">=</span> <span class="free">j</span> <span class="main">+</span> <span class="main">1</span> <span class="main">∧</span> odd <span class="free">i</span> <span class="main">⟶</span> <span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="free">j</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="main">(</span><span class="free">i</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">≥</span> <span class="main">1</span> <span class="main">∧</span> <span class="free">i</span> <span class="main">=</span> <span class="free">j</span> <span class="main">-</span> <span class="main">1</span> <span class="main">∧</span> even <span class="free">i</span> <span class="main">⟶</span> <span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="free">j</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="main">(</span><span class="free">i</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> jozsa_transform_def assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> jozsa<span class="main">)</span> U<span class="hidden">⇩</span><sub>f</sub>_mult_without_empty_summands_sum_even<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">i</span> <span class="free">j</span> <span class="free">A</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> dim_row <span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">&lt;</span> dim_col <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"even <span class="free">i</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"dim_col <span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">=</span> dim_row <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span> dim_row <span class="free">A</span><span class="main">}</span><span class="main">.</span> <span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span> <span class="main">*</span> <span class="free">A</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span><span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="main">{</span><span class="free">i</span><span class="main">,</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> <span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span> <span class="main">*</span> <span class="free">A</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="free">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">}</span><span class="main">.</span> <span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span> <span class="main">*</span> <span class="free">A</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
             <span class="main">(</span><span class="main">∑</span><span class="bound">k</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">i</span><span class="main">}</span><span class="main">.</span> <span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span> <span class="main">*</span> <span class="free">A</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span>
             <span class="main">(</span><span class="main">∑</span><span class="bound">k</span> <span class="main">∈</span> <span class="main">{</span><span class="free">i</span><span class="main">,</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> <span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span> <span class="main">*</span> <span class="free">A</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span>
             <span class="main">(</span><span class="main">∑</span><span class="bound">k</span> <span class="main">∈</span> <span class="main">{</span><span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="numeral">2</span><span class="main">)</span><span class="main">..&lt;</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">}</span><span class="main">.</span> <span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span> <span class="main">*</span> <span class="free">A</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="free">j</span><span class="main">)</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span> 
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">i</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="free">i</span><span class="main">..&lt;</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">}</span> 
          <span class="main">∧</span> <span class="main">{</span><span class="free">i</span><span class="main">..&lt;</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="free">i</span><span class="main">,</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="numeral">2</span><span class="main">)</span><span class="main">..&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1-3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">i</span><span class="main">}</span> <span class="main">∩</span> <span class="main">{</span><span class="free">i</span><span class="main">,</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">}</span> <span class="main">=</span> <span class="main">{}</span> 
                  <span class="main">∧</span> <span class="main">{</span><span class="free">i</span><span class="main">,</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">}</span> <span class="main">∩</span> <span class="main">{</span><span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="numeral">2</span><span class="main">)</span><span class="main">..&lt;</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span> <span class="main">{}</span> 
                  <span class="main">∧</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">i</span><span class="main">}</span> <span class="main">∩</span> <span class="main">{</span><span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="numeral">2</span><span class="main">)</span><span class="main">..&lt;</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> sum.union_disjoint
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> finite_Un finite_atLeastLessThan is_num_normalize<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> ivl_disj_int_two<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">i</span><span class="main">}</span><span class="main">.</span> <span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span> <span class="main">*</span> <span class="free">A</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">i</span><span class="main">}</span> <span class="main">⟶</span> <span class="main">(</span><span class="free">i</span><span class="main">≠</span><span class="skolem">k</span> <span class="main">∧</span> <span class="main">¬</span><span class="main">(</span><span class="free">i</span><span class="main">=</span><span class="skolem">k</span><span class="main">+</span><span class="main">1</span> <span class="main">∧</span> odd <span class="free">i</span><span class="main">)</span> <span class="main">∧</span> <span class="main">¬</span> <span class="main">(</span><span class="free">i</span><span class="main">=</span><span class="skolem">k</span><span class="main">-</span><span class="main">1</span> <span class="main">∧</span> even <span class="free">i</span> <span class="main">∧</span> <span class="skolem">k</span><span class="main">≥</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span> 
      <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">i</span><span class="main">}</span> <span class="main">⟶</span> <span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="skolem">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span>
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span> <span class="main">∈</span> <span class="main">{</span><span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="numeral">2</span><span class="main">)</span><span class="main">..&lt;</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">}</span><span class="main">.</span> <span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span> <span class="main">*</span> <span class="free">A</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span> 
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span><span class="main">∈</span><span class="main">{</span><span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="numeral">2</span><span class="main">)</span><span class="main">..&lt;</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">}</span> <span class="main">⟶</span> <span class="main">(</span><span class="free">i</span><span class="main">≠</span><span class="skolem">k</span> <span class="main">∧</span> <span class="main">¬</span><span class="main">(</span><span class="free">i</span><span class="main">=</span><span class="skolem">k</span><span class="main">+</span><span class="main">1</span> <span class="main">∧</span> odd <span class="free">i</span><span class="main">)</span> <span class="main">∧</span> <span class="main">¬</span> <span class="main">(</span><span class="free">i</span><span class="main">=</span><span class="skolem">k</span><span class="main">-</span><span class="main">1</span> <span class="main">∧</span> even <span class="free">i</span> <span class="main">∧</span> <span class="skolem">k</span><span class="main">≥</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">∈</span> <span class="main">{</span><span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="numeral">2</span><span class="main">)</span><span class="main">..&lt;</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">}</span><span class="main">⟶</span> <span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="skolem">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span>
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span>  <span class="quoted"><span class="quoted">"dim_row <span class="free">A</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?thesis</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> add.left_neutral add.right_neutral<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> jozsa<span class="main">)</span> U<span class="hidden">⇩</span><sub>f</sub>_mult_without_empty_summands_even<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">i</span> <span class="free">j</span> <span class="free">A</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> dim_row <span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">&lt;</span> dim_col <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"even <span class="free">i</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"dim_col <span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">=</span> dim_row <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">*</span> <span class="free">A</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="free">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span> <span class="main">∈</span> <span class="main">{</span><span class="free">i</span><span class="main">,</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> <span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span> <span class="main">*</span> <span class="free">A</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="free">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">*</span> <span class="free">A</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="free">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span> <span class="bound">k</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span> dim_row <span class="free">A</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">A</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="free">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">,</span>2<span class="main">,</span>4<span class="main">)</span> index_matrix_prod <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> atLeast0LessThan<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms U<span class="hidden">⇩</span><sub>f</sub>_mult_without_empty_summands_sum_even <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> jozsa<span class="main">)</span> U<span class="hidden">⇩</span><sub>f</sub>_mult_without_empty_summands_sum_odd<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">i</span> <span class="free">j</span> <span class="free">A</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> dim_row <span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">&lt;</span> dim_col <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"odd <span class="free">i</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"dim_col <span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">=</span> dim_row <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span> dim_row <span class="free">A</span><span class="main">}</span><span class="main">.</span> <span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span> <span class="main">*</span> <span class="free">A</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span><span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="main">{</span><span class="free">i</span><span class="main">-</span><span class="main">1</span><span class="main">,</span><span class="free">i</span><span class="main">}</span><span class="main">.</span> <span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span> <span class="main">*</span> <span class="free">A</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="free">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">}</span><span class="main">.</span> <span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span> <span class="main">*</span> <span class="free">A</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
             <span class="main">(</span><span class="main">∑</span><span class="bound">k</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">i</span><span class="main">-</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> <span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span> <span class="main">*</span> <span class="free">A</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span>
             <span class="main">(</span><span class="main">∑</span><span class="bound">k</span> <span class="main">∈</span> <span class="main">{</span><span class="free">i</span><span class="main">-</span><span class="main">1</span><span class="main">,</span><span class="free">i</span><span class="main">}</span><span class="main">.</span> <span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span> <span class="main">*</span> <span class="free">A</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span>
             <span class="main">(</span><span class="main">∑</span><span class="bound">k</span> <span class="main">∈</span> <span class="main">{</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">..&lt;</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">}</span><span class="main">.</span> <span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span> <span class="main">*</span> <span class="free">A</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="free">j</span><span class="main">)</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span> 
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">i</span><span class="main">-</span><span class="main">1</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="free">i</span><span class="main">-</span><span class="main">1</span><span class="main">..&lt;</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">}</span> 
          <span class="main">∧</span> <span class="main">{</span><span class="free">i</span><span class="main">-</span><span class="main">1</span><span class="main">..&lt;</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="free">i</span><span class="main">-</span><span class="main">1</span><span class="main">,</span><span class="free">i</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">..&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1-3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">i</span><span class="main">-</span><span class="main">1</span><span class="main">}</span> <span class="main">∩</span> <span class="main">{</span><span class="free">i</span><span class="main">-</span><span class="main">1</span><span class="main">,</span><span class="free">i</span><span class="main">}</span> <span class="main">=</span> <span class="main">{}</span> 
                  <span class="main">∧</span> <span class="main">{</span><span class="free">i</span><span class="main">-</span><span class="main">1</span><span class="main">,</span><span class="free">i</span><span class="main">}</span> <span class="main">∩</span> <span class="main">{</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">..&lt;</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span> <span class="main">{}</span> 
                  <span class="main">∧</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">i</span><span class="main">-</span><span class="main">1</span><span class="main">}</span> <span class="main">∩</span> <span class="main">{</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">..&lt;</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> sum.union_disjoint 
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> finite_Un finite_atLeastLessThan is_num_normalize<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> ivl_disj_int_two<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">i</span><span class="main">-</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> <span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span> <span class="main">*</span> <span class="free">A</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">i</span><span class="main">-</span><span class="main">1</span><span class="main">}</span> <span class="main">⟶</span> <span class="main">(</span><span class="free">i</span><span class="main">≠</span><span class="skolem">k</span> <span class="main">∧</span> <span class="main">¬</span><span class="main">(</span><span class="free">i</span><span class="main">=</span><span class="skolem">k</span><span class="main">+</span><span class="main">1</span> <span class="main">∧</span> odd <span class="free">i</span><span class="main">)</span> <span class="main">∧</span> <span class="main">¬</span> <span class="main">(</span><span class="free">i</span><span class="main">=</span><span class="skolem">k</span><span class="main">-</span><span class="main">1</span> <span class="main">∧</span> even <span class="free">i</span> <span class="main">∧</span> <span class="skolem">k</span><span class="main">≥</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">i</span><span class="main">-</span><span class="main">1</span><span class="main">}</span> <span class="main">⟶</span> <span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="skolem">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span>
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span> <span class="main">∈</span> <span class="main">{</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">..&lt;</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">}</span><span class="main">.</span> <span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span> <span class="main">*</span> <span class="free">A</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span>  <span class="quoted"><span class="quoted">"dim_row <span class="free">A</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?thesis</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> add.left_neutral add.right_neutral<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> jozsa<span class="main">)</span> U<span class="hidden">⇩</span><sub>f</sub>_mult_without_empty_summands_odd<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">i</span> <span class="free">j</span> <span class="free">A</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> dim_row <span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">&lt;</span> dim_col <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"odd <span class="free">i</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"dim_col <span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">=</span> dim_row <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">*</span> <span class="free">A</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="free">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span> <span class="main">∈</span> <span class="main">{</span><span class="free">i</span><span class="main">-</span><span class="main">1</span><span class="main">,</span><span class="free">i</span><span class="main">}</span><span class="main">.</span> <span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span> <span class="main">*</span> <span class="free">A</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="free">j</span><span class="main">)</span><span class="main">)</span> "</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">*</span> <span class="free">A</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="free">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span> <span class="main">..&lt;</span> dim_row <span class="free">A</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">A</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="free">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">,</span>2<span class="main">,</span>4<span class="main">)</span> index_matrix_prod <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> atLeast0LessThan<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?thesis</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms U<span class="hidden">⇩</span><sub>f</sub>_mult_without_empty_summands_sum_odd <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">U<span class="hidden">⇩</span><sub>f</sub></span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is a gate.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> jozsa<span class="main">)</span> transpose_of_jozsa_transform<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup></span> <span class="main">=</span> <span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_row <span class="main">(</span><span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup></span><span class="main">)</span> <span class="main">=</span> dim_row <span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_col <span class="main">(</span><span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup></span><span class="main">)</span> <span class="main">=</span> dim_col <span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span><span class="main">::</span> <span class="quoted">nat</span>
  <span class="keyword3"><span class="command">assume</span></span> a0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> dim_row <span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> dim_col <span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup></span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> disj_four_cases<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span><span class="main">=</span><span class="skolem">j</span> <span class="main">∨</span> <span class="main">(</span><span class="skolem">i</span><span class="main">=</span><span class="skolem">j</span><span class="main">+</span><span class="main">1</span> <span class="main">∧</span> odd <span class="skolem">i</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="skolem">i</span><span class="main">=</span><span class="skolem">j</span><span class="main">-</span><span class="main">1</span> <span class="main">∧</span> even <span class="skolem">i</span> <span class="main">∧</span> <span class="skolem">j</span><span class="main">≥</span><span class="main">1</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="skolem">i</span><span class="main">≠</span><span class="skolem">j</span> <span class="main">∧</span> <span class="main">¬</span><span class="main">(</span><span class="skolem">i</span><span class="main">=</span><span class="skolem">j</span><span class="main">+</span><span class="main">1</span> <span class="main">∧</span> odd <span class="skolem">i</span><span class="main">)</span> <span class="main">∧</span> <span class="main">¬</span> <span class="main">(</span><span class="skolem">i</span><span class="main">=</span><span class="skolem">j</span><span class="main">-</span><span class="main">1</span> <span class="main">∧</span> even <span class="skolem">i</span> <span class="main">∧</span> <span class="skolem">j</span><span class="main">≥</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">=</span> <span class="skolem">j</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup></span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">i</span><span class="main">=</span><span class="skolem">j</span><span class="main">+</span><span class="main">1</span> <span class="main">∧</span> odd <span class="skolem">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup></span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> transpose_mat_def a0 a1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">i</span><span class="main">=</span><span class="skolem">j</span><span class="main">-</span><span class="main">1</span> <span class="main">∧</span> even <span class="skolem">i</span> <span class="main">∧</span> <span class="skolem">j</span><span class="main">≥</span><span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="main">(</span><span class="skolem">i</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> a0 a1 jozsa_transform_coeff <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">j</span><span class="main">,</span><span class="skolem">i</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="main">(</span><span class="skolem">i</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> a0 a1 a2 jozsa_transform_coeff
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_diff_assoc2 diff_add_inverse2 even_plus_one_iff even_succ_div_two jozsa_transform_dim<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?thesis</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> transpose_mat_def a0 a1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span> 
    <span class="keyword3"><span class="command">assume</span></span> a2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">i</span><span class="main">≠</span><span class="skolem">j</span> <span class="main">∧</span> <span class="main">¬</span><span class="main">(</span><span class="skolem">i</span><span class="main">=</span><span class="skolem">j</span><span class="main">+</span><span class="main">1</span> <span class="main">∧</span> odd <span class="skolem">i</span><span class="main">)</span> <span class="main">∧</span> <span class="main">¬</span> <span class="main">(</span><span class="skolem">i</span><span class="main">=</span><span class="skolem">j</span><span class="main">-</span><span class="main">1</span> <span class="main">∧</span> even <span class="skolem">i</span> <span class="main">∧</span> <span class="skolem">j</span><span class="main">≥</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">j</span><span class="main">≠</span><span class="skolem">i</span> <span class="main">∧</span> <span class="main">¬</span><span class="main">(</span><span class="skolem">j</span><span class="main">=</span><span class="skolem">i</span><span class="main">+</span><span class="main">1</span> <span class="main">∧</span> odd <span class="skolem">j</span><span class="main">)</span> <span class="main">∧</span> <span class="main">¬</span> <span class="main">(</span><span class="skolem">j</span><span class="main">=</span><span class="skolem">i</span><span class="main">-</span><span class="main">1</span> <span class="main">∧</span> even <span class="skolem">j</span> <span class="main">∧</span> <span class="skolem">i</span><span class="main">≥</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> le_imp_diff_is_add diff_add_inverse even_plus_one_iff le_add1<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">j</span><span class="main">,</span><span class="skolem">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> jozsa_transform_coeff_is_zero a0 a1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> jozsa_transform_coeff_is_zero a0 a1 a2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup></span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> transpose_mat_def a0 a1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span> 
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> jozsa<span class="main">)</span> adjoint_of_jozsa_transform<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span> <span class="main">=</span> <span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_row <span class="main">(</span><span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span><span class="main">)</span> <span class="main">=</span> dim_row <span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_col <span class="main">(</span><span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span><span class="main">)</span> <span class="main">=</span> dim_col <span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span><span class="main">::</span> <span class="quoted">nat</span>
  <span class="keyword3"><span class="command">assume</span></span> a0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> dim_row <span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> dim_col <span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> disj_four_cases<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span><span class="main">=</span><span class="skolem">j</span> <span class="main">∨</span> <span class="main">(</span><span class="skolem">i</span><span class="main">=</span><span class="skolem">j</span><span class="main">+</span><span class="main">1</span> <span class="main">∧</span> odd <span class="skolem">i</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="skolem">i</span><span class="main">=</span><span class="skolem">j</span><span class="main">-</span><span class="main">1</span> <span class="main">∧</span> even <span class="skolem">i</span> <span class="main">∧</span> <span class="skolem">j</span><span class="main">≥</span><span class="main">1</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="skolem">i</span><span class="main">≠</span><span class="skolem">j</span> <span class="main">∧</span> <span class="main">¬</span><span class="main">(</span><span class="skolem">i</span><span class="main">=</span><span class="skolem">j</span><span class="main">+</span><span class="main">1</span> <span class="main">∧</span> odd <span class="skolem">i</span><span class="main">)</span> <span class="main">∧</span> <span class="main">¬</span> <span class="main">(</span><span class="skolem">i</span><span class="main">=</span><span class="skolem">j</span><span class="main">-</span><span class="main">1</span> <span class="main">∧</span> even <span class="skolem">i</span> <span class="main">∧</span> <span class="skolem">j</span><span class="main">≥</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span><span class="main">=</span><span class="skolem">j</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a0 dagger_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">i</span><span class="main">=</span><span class="skolem">j</span><span class="main">+</span><span class="main">1</span> <span class="main">∧</span> odd <span class="skolem">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a0 dagger_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">i</span><span class="main">=</span><span class="skolem">j</span><span class="main">-</span><span class="main">1</span> <span class="main">∧</span> even <span class="skolem">i</span> <span class="main">∧</span> <span class="skolem">j</span><span class="main">≥</span><span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="main">(</span><span class="skolem">i</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> a0 a1 jozsa_transform_coeff <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span>  <span class="main">$$</span> <span class="main">(</span><span class="skolem">j</span><span class="main">,</span><span class="skolem">i</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="main">(</span><span class="skolem">i</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> a1 a2 jozsa_transform_coeff dagger_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">metis</span> a0 a1 cnj_transpose_is_dagger dim_row_of_dagger index_transpose_mat dagger_of_transpose_is_cnj transpose_of_jozsa_transform<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span> 
    <span class="keyword3"><span class="command">assume</span></span> a2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">i</span><span class="main">≠</span><span class="skolem">j</span> <span class="main">∧</span> <span class="main">¬</span><span class="main">(</span><span class="skolem">i</span><span class="main">=</span><span class="skolem">j</span><span class="main">+</span><span class="main">1</span> <span class="main">∧</span> odd <span class="skolem">i</span><span class="main">)</span> <span class="main">∧</span> <span class="main">¬</span> <span class="main">(</span><span class="skolem">i</span><span class="main">=</span><span class="skolem">j</span><span class="main">-</span><span class="main">1</span> <span class="main">∧</span> even <span class="skolem">i</span> <span class="main">∧</span> <span class="skolem">j</span><span class="main">≥</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> f0<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">i</span><span class="main">≠</span><span class="skolem">j</span> <span class="main">∧</span> <span class="main">¬</span><span class="main">(</span><span class="skolem">j</span><span class="main">=</span><span class="skolem">i</span><span class="main">+</span><span class="main">1</span> <span class="main">∧</span> odd <span class="skolem">j</span><span class="main">)</span> <span class="main">∧</span> <span class="main">¬</span> <span class="main">(</span><span class="skolem">j</span><span class="main">=</span><span class="skolem">i</span><span class="main">-</span><span class="main">1</span> <span class="main">∧</span> even <span class="skolem">j</span> <span class="main">∧</span> <span class="skolem">i</span><span class="main">≥</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> le_imp_diff_is_add diff_add_inverse even_plus_one_iff le_add1<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">j</span><span class="main">,</span><span class="skolem">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"cnj <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> jozsa_transform_coeff_is_zero a0 a1 a2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> a0 a1 dagger_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> a0 a1 a2 jozsa_transform_coeff_is_zero <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span> 
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> jozsa<span class="main">)</span> jozsa_transform_is_unitary_index_even<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">i</span> <span class="free">j</span><span class="main">::</span> <span class="quoted">nat</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> dim_row <span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">&lt;</span> dim_col <span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"even <span class="free">i</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">*</span> <span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="free">j</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>m</sub></span> <span class="main">(</span>dim_col <span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="free">j</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">*</span> <span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="free">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span> <span class="main">∈</span> <span class="main">{</span><span class="free">i</span><span class="main">,</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> <span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span> <span class="main">*</span> <span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">$$</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="free">j</span><span class="main">)</span><span class="main">)</span> "</span></span> 
    <span class="keyword1"><span class="command">using</span></span> U<span class="hidden">⇩</span><sub>f</sub>_mult_without_empty_summands_even<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">i</span></span> <span class="quoted"><span class="free">j</span></span> <span class="quoted"><span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span></span> <span class="main">]</span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="free">i</span><span class="main">)</span> <span class="main">*</span> <span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="free">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="free">f</span><span class="main">(</span><span class="free">i</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="free">j</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">,</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> f0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">,</span><span class="free">j</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span><span class="main">(</span><span class="free">i</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">,</span><span class="free">j</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> One_nat_def Suc_leI add.right_neutral add_Suc_right assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> diff_add_inverse2 
even_add even_mult_iff jozsa_transform_coeff<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> jozsa_transform_dim le_add2 le_eq_less_or_eq odd_one 
one_add_one power.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> f1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">*</span> <span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="free">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="free">f</span><span class="main">(</span><span class="free">i</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="free">j</span><span class="main">)</span> <span class="main">+</span>  <span class="free">f</span><span class="main">(</span><span class="free">i</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">,</span><span class="free">j</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> disj_four_cases<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span><span class="main">=</span><span class="free">i</span> <span class="main">∨</span> <span class="main">(</span><span class="free">j</span><span class="main">=</span><span class="free">i</span><span class="main">+</span><span class="main">1</span> <span class="main">∧</span> odd <span class="free">j</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="free">j</span><span class="main">=</span><span class="free">i</span><span class="main">-</span><span class="main">1</span> <span class="main">∧</span> even <span class="free">j</span> <span class="main">∧</span> <span class="free">i</span><span class="main">≥</span><span class="main">1</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="free">j</span><span class="main">≠</span><span class="free">i</span> <span class="main">∧</span> <span class="main">¬</span><span class="main">(</span><span class="free">j</span><span class="main">=</span><span class="free">i</span><span class="main">+</span><span class="main">1</span> <span class="main">∧</span> odd <span class="free">j</span><span class="main">)</span> <span class="main">∧</span> <span class="main">¬</span> <span class="main">(</span><span class="free">j</span><span class="main">=</span><span class="free">i</span><span class="main">-</span><span class="main">1</span> <span class="main">∧</span> even <span class="free">j</span> <span class="main">∧</span> <span class="free">i</span><span class="main">≥</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a0<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">j</span><span class="main">=</span><span class="free">i</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="free">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="free">f</span><span class="main">(</span><span class="free">i</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> a0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">,</span><span class="free">j</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span><span class="main">(</span><span class="free">i</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">,</span>3<span class="main">)</span> a0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">*</span> <span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="free">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="free">f</span><span class="main">(</span><span class="free">i</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="free">f</span><span class="main">(</span><span class="free">i</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span>  <span class="free">f</span><span class="main">(</span><span class="free">i</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="free">f</span><span class="main">(</span><span class="free">i</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> f1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="free">f</span><span class="main">(</span><span class="free">i</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="free">f</span><span class="main">(</span><span class="free">i</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="free">f</span><span class="main">(</span><span class="free">i</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="free">f</span><span class="main">(</span><span class="free">i</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> f_values assms<span class="main">(</span>1<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Nat.minus_nat.diff_0 diff_add_0 diff_add_inverse jozsa_transform_dim<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> 
          less_power_add_imp_div_less mem_Collect_eq mult_eq_if one_power2 power2_eq_square power_one_right<span class="main">)</span> 
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">*</span> <span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="free">j</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>m</sub></span> <span class="main">(</span>dim_col <span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="free">j</span><span class="main">)</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> a0 index_one_mat<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> of_nat_1<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">j</span><span class="main">=</span><span class="free">i</span><span class="main">+</span><span class="main">1</span> <span class="main">∧</span> odd <span class="free">j</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="free">j</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span><span class="main">(</span><span class="free">i</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> a0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">,</span><span class="free">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="free">f</span><span class="main">(</span><span class="free">i</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span> a0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">*</span> <span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="free">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="free">f</span><span class="main">(</span><span class="free">i</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="free">f</span><span class="main">(</span><span class="free">i</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">+</span> <span class="free">f</span><span class="main">(</span><span class="free">i</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="free">f</span><span class="main">(</span><span class="free">i</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> f0 f1 assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">*</span> <span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="free">j</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>m</sub></span> <span class="main">(</span>dim_col <span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="free">j</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> a0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">j</span><span class="main">=</span><span class="free">i</span><span class="main">-</span><span class="main">1</span> <span class="main">∧</span> even <span class="free">j</span> <span class="main">∧</span> <span class="free">i</span><span class="main">≥</span><span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">*</span> <span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="free">j</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>m</sub></span> <span class="main">(</span>dim_col <span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="free">j</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span> dvd_diffD1 odd_one <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">next</span></span> 
    <span class="keyword3"><span class="command">assume</span></span> a0<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">j</span><span class="main">≠</span><span class="free">i</span> <span class="main">∧</span> <span class="main">¬</span><span class="main">(</span><span class="free">j</span><span class="main">=</span><span class="free">i</span><span class="main">+</span><span class="main">1</span> <span class="main">∧</span> odd <span class="free">j</span><span class="main">)</span> <span class="main">∧</span> <span class="main">¬</span> <span class="main">(</span><span class="free">j</span><span class="main">=</span><span class="free">i</span><span class="main">-</span><span class="main">1</span> <span class="main">∧</span> even <span class="free">j</span> <span class="main">∧</span> <span class="free">i</span><span class="main">≥</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="free">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">metis</span> index_transpose_mat<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> jozsa_transform_coeff_is_zero jozsa_transform_dim transpose_of_jozsa_transform<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">,</span><span class="free">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> assms a0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">*</span> <span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="free">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="free">f</span><span class="main">(</span><span class="free">i</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">0</span> <span class="main">+</span>  <span class="free">f</span><span class="main">(</span><span class="free">i</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="main">0</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f1<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">*</span> <span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="free">j</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>m</sub></span> <span class="main">(</span>dim_col <span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="free">j</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> a0 assms<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">metis</span> add.left_neutral index_one_mat<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> jozsa_transform_dim mult_0_right of_nat_0<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> jozsa<span class="main">)</span> jozsa_transform_is_unitary_index_odd<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">i</span> <span class="free">j</span><span class="main">::</span> <span class="quoted">nat</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> dim_row <span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">&lt;</span> dim_col <span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"odd <span class="free">i</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">*</span> <span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="free">j</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>m</sub></span> <span class="main">(</span>dim_col <span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="free">j</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> f0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≥</span> <span class="main">1</span>"</span></span>  
    <span class="keyword1"><span class="command">using</span></span> linorder_not_less assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">*</span> <span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="free">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span> <span class="main">∈</span> <span class="main">{</span><span class="free">i</span><span class="main">-</span><span class="main">1</span><span class="main">,</span><span class="free">i</span><span class="main">}</span><span class="main">.</span> <span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span> <span class="main">*</span> <span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">$$</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="free">j</span><span class="main">)</span><span class="main">)</span> "</span></span> 
    <span class="keyword1"><span class="command">using</span></span> U<span class="hidden">⇩</span><sub>f</sub>_mult_without_empty_summands_odd<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">i</span></span> <span class="quoted"><span class="free">j</span></span> <span class="quoted"><span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span></span> <span class="main">]</span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span> <span class="main">∈</span> <span class="main">{</span><span class="free">i</span><span class="main">-</span><span class="main">1</span><span class="main">,</span><span class="free">i</span><span class="main">}</span><span class="main">.</span> <span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span> <span class="main">*</span> <span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">$$</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="free">j</span><span class="main">)</span><span class="main">)</span> 
                 <span class="main">=</span> <span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="free">i</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span><span class="main">-</span><span class="main">1</span><span class="main">,</span><span class="free">j</span><span class="main">)</span> <span class="main">+</span>  <span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="free">i</span><span class="main">)</span> <span class="main">*</span> <span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="free">j</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> f0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="free">i</span><span class="main">)</span> <span class="main">*</span> <span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="free">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="free">f</span><span class="main">(</span><span class="free">i</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="free">j</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> f1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="free">i</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span><span class="main">-</span><span class="main">1</span><span class="main">,</span><span class="free">j</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span><span class="main">(</span><span class="free">i</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span><span class="main">-</span><span class="main">1</span><span class="main">,</span><span class="free">j</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> f2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">*</span> <span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="free">j</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span><span class="main">(</span><span class="free">i</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span><span class="main">-</span><span class="main">1</span><span class="main">,</span><span class="free">j</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="free">f</span><span class="main">(</span><span class="free">i</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="free">j</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?thesis</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> disj_four_cases<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span><span class="main">=</span><span class="free">i</span> <span class="main">∨</span> <span class="main">(</span><span class="free">j</span><span class="main">=</span><span class="free">i</span><span class="main">+</span><span class="main">1</span> <span class="main">∧</span> odd <span class="free">j</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="free">j</span><span class="main">=</span><span class="free">i</span><span class="main">-</span><span class="main">1</span> <span class="main">∧</span> even <span class="free">j</span> <span class="main">∧</span> <span class="free">i</span><span class="main">≥</span><span class="main">1</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="free">j</span><span class="main">≠</span><span class="free">i</span> <span class="main">∧</span> <span class="main">¬</span><span class="main">(</span><span class="free">j</span><span class="main">=</span><span class="free">i</span><span class="main">+</span><span class="main">1</span> <span class="main">∧</span> odd <span class="free">j</span><span class="main">)</span> <span class="main">∧</span> <span class="main">¬</span> <span class="main">(</span><span class="free">j</span><span class="main">=</span><span class="free">i</span><span class="main">-</span><span class="main">1</span> <span class="main">∧</span> even <span class="free">j</span> <span class="main">∧</span> <span class="free">i</span><span class="main">≥</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a0<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">j</span><span class="main">=</span><span class="free">i</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="free">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="free">f</span><span class="main">(</span><span class="free">i</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span><span class="main">-</span><span class="main">1</span><span class="main">,</span><span class="free">j</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span><span class="main">(</span><span class="free">i</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> a0 assms
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> index_transpose_mat<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> jozsa_transform_coeff<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> less_imp_diff_less odd_two_times_div_two_nat 
          odd_two_times_div_two_succ transpose_of_jozsa_transform<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">*</span> <span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="free">j</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span><span class="main">(</span><span class="free">i</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="free">f</span><span class="main">(</span><span class="free">i</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="free">f</span><span class="main">(</span><span class="free">i</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="free">f</span><span class="main">(</span><span class="free">i</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> f2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span><span class="main">(</span><span class="free">i</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="free">f</span><span class="main">(</span><span class="free">i</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="free">f</span><span class="main">(</span><span class="free">i</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="free">f</span><span class="main">(</span><span class="free">i</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> f_values assms<span class="main">(</span>1<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Nat.minus_nat.diff_0 diff_add_0 diff_add_inverse jozsa_transform_dim<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> 
          less_power_add_imp_div_less mem_Collect_eq mult_eq_if one_power2 power2_eq_square power_one_right<span class="main">)</span> 
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">*</span> <span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="free">j</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>m</sub></span> <span class="main">(</span>dim_col <span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="free">j</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> a0 index_one_mat<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> of_nat_1<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a0<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">j</span><span class="main">=</span><span class="free">i</span><span class="main">+</span><span class="main">1</span> <span class="main">∧</span> odd <span class="free">j</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">*</span> <span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="free">j</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>m</sub></span> <span class="main">(</span>dim_col <span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="free">j</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span> dvd_diffD1 odd_one even_plus_one_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a0<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">j</span><span class="main">=</span><span class="free">i</span><span class="main">-</span><span class="main">1</span> <span class="main">∧</span> even <span class="free">j</span> <span class="main">∧</span> <span class="free">i</span><span class="main">≥</span><span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">*</span> <span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="free">j</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span><span class="main">(</span><span class="free">i</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="free">f</span><span class="main">(</span><span class="free">i</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="free">f</span><span class="main">(</span><span class="free">i</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="free">f</span><span class="main">(</span><span class="free">i</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> f0 f1 f2 assms
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> jozsa_transform_coeff<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> Groups.ab_semigroup_mult_class.mult.commute even_succ_div_two f2 
          jozsa_transform_dim odd_two_times_div_two_nat odd_two_times_div_two_succ of_nat_add of_nat_mult<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">*</span> <span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="free">j</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>m</sub></span> <span class="main">(</span>dim_col <span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="free">j</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> a0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span> 
    <span class="keyword3"><span class="command">assume</span></span> a0<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">j</span><span class="main">≠</span><span class="free">i</span> <span class="main">∧</span> <span class="main">¬</span><span class="main">(</span><span class="free">j</span><span class="main">=</span><span class="free">i</span><span class="main">+</span><span class="main">1</span> <span class="main">∧</span> odd <span class="free">j</span><span class="main">)</span> <span class="main">∧</span> <span class="main">¬</span> <span class="main">(</span><span class="free">j</span><span class="main">=</span><span class="free">i</span><span class="main">-</span><span class="main">1</span> <span class="main">∧</span> even <span class="free">j</span> <span class="main">∧</span> <span class="free">i</span><span class="main">≥</span><span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="free">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>2<span class="main"><span class="main">)</span></span> index_transpose_mat<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> jozsa_transform_coeff_is_zero jozsa_transform_dim transpose_of_jozsa_transform<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span><span class="main">-</span><span class="main">1</span><span class="main">,</span><span class="free">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> assms a0 f0 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="main">(</span><span class="operator">smt</span> One_nat_def Suc_n_not_le_n add_diff_inverse_nat assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> diff_Suc_less even_add 
jozsa_transform_coeff_is_zero jozsa_axioms less_imp_le less_le_trans less_one odd_one<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">*</span> <span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="free">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="free">f</span><span class="main">(</span><span class="free">i</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">0</span> <span class="main">+</span>  <span class="free">f</span><span class="main">(</span><span class="free">i</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="main">0</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> f2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">*</span> <span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="free">j</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>m</sub></span> <span class="main">(</span>dim_col <span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="free">j</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> a0 assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add.left_neutral index_one_mat<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> jozsa_transform_dim mult_0_right of_nat_0<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> jozsa<span class="main">)</span> jozsa_transform_is_gate<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"gate <span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_row <span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">=</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"square_mat <span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"unitary <span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">*</span> <span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">=</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>m</sub></span> <span class="main">(</span>dim_col <span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_row <span class="main">(</span><span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">*</span> <span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span><span class="main">)</span> <span class="main">=</span> dim_row <span class="main">(</span><span class="keyword1">1<span class="hidden">⇩</span><sub>m</sub></span> <span class="main">(</span>dim_col <span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_col <span class="main">(</span><span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">*</span> <span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span><span class="main">)</span> <span class="main">=</span> dim_col <span class="main">(</span><span class="keyword1">1<span class="hidden">⇩</span><sub>m</sub></span> <span class="main">(</span>dim_col <span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span><span class="main">::</span> <span class="quoted">nat</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> dim_row <span class="main">(</span><span class="keyword1">1<span class="hidden">⇩</span><sub>m</sub></span> <span class="main">(</span>dim_col <span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> dim_col <span class="main">(</span><span class="keyword1">1<span class="hidden">⇩</span><sub>m</sub></span> <span class="main">(</span>dim_col <span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> dim_row <span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> dim_col <span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">*</span> <span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>m</sub></span> <span class="main">(</span>dim_col <span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> jozsa_transform_is_unitary_index_odd jozsa_transform_is_unitary_index_even <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> adjoint_of_jozsa_transform unitary_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹N-fold application of the tensor product›</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">iter_tensor</span><span class="main">::</span> <span class="quoted"><span class="quoted">"complex Matrix.mat <span class="main">⇒</span> nat <span class="main">⇒</span> complex Matrix.mat"</span></span> <span class="main">(</span><span class="quoted">"_ <span class="keyword1">⊗⇗</span>_<span class="keyword1">⇖</span>"</span> 75<span class="main">)</span>  <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">A</span></span></span> ⊗<span class="hidden">⇗</span><sup><span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span></sup><span class="hidden">⇖</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span>"</span></span>  
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">A</span></span></span> ⊗<span class="hidden">⇗</span><sup><span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">)</span></sup><span class="hidden">⇖</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">⨂</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">A</span></span></span> ⊗<span class="hidden">⇗</span><sup><span class="free"><span class="bound"><span class="entity">k</span></span></span></sup><span class="hidden">⇖</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Deutsch_Jozsa-one_tensor_is_id"><span class="command">lemma</span></span> one_tensor_is_id <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> ⊗<span class="hidden">⇗</span><sup><span class="main">1</span></sup><span class="hidden">⇖</span> <span class="main">=</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> one_mat_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Deutsch_Jozsa-iter_tensor_suc"><span class="command">lemma</span></span> iter_tensor_suc<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">n</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≥</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">" <span class="free">A</span> ⊗<span class="hidden">⇗</span><sup><span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span></sup><span class="hidden">⇖</span> <span class="main">=</span> <span class="free">A</span> <span class="main">⨂</span> <span class="main">(</span><span class="free">A</span> ⊗<span class="hidden">⇗</span><sup><span class="free">n</span></sup><span class="hidden">⇖</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Deutsch_Jozsa.iter_tensor.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> One_nat_def Suc_le_D<span class="main">)</span>

<span class="keyword1" id="Deutsch_Jozsa-dim_row_of_iter_tensor"><span class="command">lemma</span></span> dim_row_of_iter_tensor <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span> <span class="free">n</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≥</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"dim_row<span class="main">(</span><span class="free">A</span> ⊗<span class="hidden">⇗</span><sup><span class="free">n</span></sup><span class="hidden">⇖</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>dim_row <span class="free">A</span><span class="main">)</span><span class="main">^</span><span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> nat_induct_at_least<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_row <span class="main">(</span><span class="free">A</span> ⊗<span class="hidden">⇗</span><sup><span class="main">1</span></sup><span class="hidden">⇖</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>dim_row <span class="free">A</span><span class="main">)</span><span class="main">^</span><span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> one_tensor_is_id <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span><span class="main">::</span> <span class="quoted">nat</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">≥</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"dim_row <span class="main">(</span><span class="free">A</span> ⊗<span class="hidden">⇗</span><sup><span class="skolem">n</span></sup><span class="hidden">⇖</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>dim_row <span class="free">A</span><span class="main">)</span><span class="main">^</span><span class="skolem">n</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_row <span class="main">(</span><span class="free">A</span> ⊗<span class="hidden">⇗</span><sup>Suc <span class="skolem">n</span></sup><span class="hidden">⇖</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>dim_row <span class="free">A</span><span class="main">)</span><span class="main">^</span>Suc <span class="skolem">n</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> iter_tensor_suc assms dim_row_tensor_mat <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Deutsch_Jozsa-dim_col_of_iter_tensor"><span class="command">lemma</span></span> dim_col_of_iter_tensor <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span> <span class="free">n</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≥</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"dim_col<span class="main">(</span><span class="free">A</span> ⊗<span class="hidden">⇗</span><sup><span class="free">n</span></sup><span class="hidden">⇖</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>dim_col <span class="free">A</span><span class="main">)</span><span class="main">^</span><span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> nat_induct_at_least<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_col <span class="main">(</span><span class="free">A</span> ⊗<span class="hidden">⇗</span><sup><span class="main">1</span></sup><span class="hidden">⇖</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>dim_col <span class="free">A</span><span class="main">)</span><span class="main">^</span><span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> one_tensor_is_id <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span><span class="main">::</span> <span class="quoted">nat</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">≥</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"dim_col <span class="main">(</span><span class="free">A</span> ⊗<span class="hidden">⇗</span><sup><span class="skolem">n</span></sup><span class="hidden">⇖</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>dim_col <span class="free">A</span><span class="main">)</span><span class="main">^</span><span class="skolem">n</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_col <span class="main">(</span><span class="free">A</span> ⊗<span class="hidden">⇗</span><sup>Suc <span class="skolem">n</span></sup><span class="hidden">⇖</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>dim_col <span class="free">A</span><span class="main">)</span><span class="main">^</span>Suc <span class="skolem">n</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> iter_tensor_suc assms dim_col_tensor_mat <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Deutsch_Jozsa-iter_tensor_values"><span class="command">lemma</span></span> iter_tensor_values<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span> <span class="free">n</span> <span class="free">i</span> <span class="free">j</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≥</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> dim_row <span class="main">(</span><span class="free">A</span> <span class="main">⨂</span> <span class="main">(</span><span class="free">A</span> ⊗<span class="hidden">⇗</span><sup><span class="free">n</span></sup><span class="hidden">⇖</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">&lt;</span> dim_col <span class="main">(</span><span class="free">A</span> <span class="main">⨂</span> <span class="main">(</span><span class="free">A</span> ⊗<span class="hidden">⇗</span><sup><span class="free">n</span></sup><span class="hidden">⇖</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">A</span> ⊗<span class="hidden">⇗</span><sup><span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span></sup><span class="hidden">⇖</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="free">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">A</span> <span class="main">⨂</span> <span class="main">(</span><span class="free">A</span> ⊗<span class="hidden">⇗</span><sup><span class="free">n</span></sup><span class="hidden">⇖</span><span class="main">)</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="free">j</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> One_nat_def le_0_eq not0_implies_Suc iter_tensor.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>

<span class="keyword1" id="Deutsch_Jozsa-iter_tensor_mult_distr"><span class="command">lemma</span></span> iter_tensor_mult_distr<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≥</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"dim_col <span class="free">A</span> <span class="main">=</span> dim_row <span class="free">B</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"dim_col <span class="free">A</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"dim_col <span class="free">B</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">A</span> ⊗<span class="hidden">⇗</span><sup><span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span></sup><span class="hidden">⇖</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">B</span> ⊗<span class="hidden">⇗</span><sup><span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span></sup><span class="hidden">⇖</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">A</span> <span class="main">*</span> <span class="free">B</span><span class="main">)</span> <span class="main">⨂</span> <span class="main">(</span><span class="main">(</span><span class="free">A</span> ⊗<span class="hidden">⇗</span><sup><span class="free">n</span></sup><span class="hidden">⇖</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">B</span> ⊗<span class="hidden">⇗</span><sup><span class="free">n</span></sup><span class="hidden">⇖</span><span class="main">)</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">A</span> ⊗<span class="hidden">⇗</span><sup><span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span></sup><span class="hidden">⇖</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">B</span> ⊗<span class="hidden">⇗</span><sup><span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span></sup><span class="hidden">⇖</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">A</span> <span class="main">⨂</span> <span class="main">(</span><span class="free">A</span> ⊗<span class="hidden">⇗</span><sup><span class="free">n</span></sup><span class="hidden">⇖</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">B</span> <span class="main">⨂</span> <span class="main">(</span><span class="free">B</span> ⊗<span class="hidden">⇗</span><sup><span class="free">n</span></sup><span class="hidden">⇖</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> Suc_le_D assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?thesis</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> mult_distr_tensor<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>iter_tensor <span class="free">A</span> <span class="free">n</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>iter_tensor <span class="free">B</span> <span class="free">n</span><span class="main">)</span>"</span></span><span class="main">]</span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Deutsch_Jozsa-index_tensor_mat_with_vec2_row_cond"><span class="command">lemma</span></span> index_tensor_mat_with_vec2_row_cond<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span> <span class="free">B</span><span class="main">::</span> <span class="quoted"><span class="quoted">"complex Matrix.mat"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">i</span><span class="main">::</span> <span class="quoted"><span class="quoted">"nat"</span></span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span>dim_row <span class="free">B</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≥</span> dim_row <span class="free">B</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"dim_col <span class="free">B</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"dim_row <span class="free">A</span> <span class="main">=</span> <span class="numeral">2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"dim_col <span class="free">A</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">A</span> <span class="main">⨂</span> <span class="free">B</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">A</span> <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">B</span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span><span class="main">-</span>dim_row <span class="free">B</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">A</span> <span class="main">⨂</span> <span class="free">B</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="free">A</span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span> <span class="keyword1">div</span> <span class="main">(</span>dim_row <span class="free">B</span><span class="main">)</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">*</span> <span class="free">B</span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span> <span class="keyword1">mod</span> <span class="main">(</span>dim_row <span class="free">B</span><span class="main">)</span><span class="main">,</span><span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms index_tensor_mat<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="quoted">"dim_row <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"dim_col <span class="free">A</span>"</span></span> <span class="quoted"><span class="free">B</span></span> <span class="quoted"><span class="quoted">"dim_row <span class="free">B</span>"</span></span> <span class="quoted"><span class="quoted">"dim_col <span class="free">B</span>"</span></span> <span class="quoted"><span class="free">i</span></span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="keyword1">div</span> <span class="main">(</span>dim_row <span class="free">B</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">,</span>2<span class="main">,</span>4<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="keyword1">mod</span> <span class="main">(</span>dim_row <span class="free">B</span><span class="main">)</span> <span class="main">=</span> <span class="free">i</span> <span class="main">-</span> <span class="main">(</span>dim_row <span class="free">B</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> modulo_nat_def<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">A</span> <span class="main">⨂</span> <span class="free">B</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">A</span> <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">B</span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span><span class="main">-</span>dim_row <span class="free">B</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="free">i</span> <span class="keyword1">div</span> dim_row <span class="free">B</span> <span class="main">=</span> <span class="main">1</span>›</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Deutsch_Jozsa-iter_tensor_of_gate_is_gate"><span class="command">lemma</span></span> iter_tensor_of_gate_is_gate<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span> <span class="quoted"><span class="quoted">"complex Matrix.mat"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">n</span> <span class="free">m</span><span class="main">::</span> <span class="quoted"><span class="quoted">"nat"</span></span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"gate <span class="free">m</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≥</span> <span class="main">1</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"gate <span class="main">(</span><span class="free">m</span><span class="main">*</span><span class="free">n</span><span class="main">)</span> <span class="main">(</span><span class="free">A</span> ⊗<span class="hidden">⇗</span><sup><span class="free">n</span></sup><span class="hidden">⇖</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span> nat_induct_at_least<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"gate <span class="main">(</span><span class="free">m</span> <span class="main">*</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span><span class="free">A</span> ⊗<span class="hidden">⇗</span><sup><span class="main">1</span></sup><span class="hidden">⇖</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span><span class="main">::</span> <span class="quoted">nat</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">≥</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> IH<span class="main">:</span><span class="quoted"><span class="quoted">"gate <span class="main">(</span><span class="free">m</span> <span class="main">*</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span><span class="free">A</span> ⊗<span class="hidden">⇗</span><sup><span class="skolem">n</span></sup><span class="hidden">⇖</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> ⊗<span class="hidden">⇗</span><sup><span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span></sup><span class="hidden">⇖</span> <span class="main">=</span> <span class="free">A</span> <span class="main">⨂</span> <span class="main">(</span><span class="free">A</span> ⊗<span class="hidden">⇗</span><sup><span class="skolem">n</span></sup><span class="hidden">⇖</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iter_tensor_suc<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"gate <span class="main">(</span><span class="free">m</span><span class="main">*</span><span class="skolem">n</span> <span class="main">+</span> <span class="free">m</span><span class="main">)</span> <span class="main">(</span><span class="free">A</span> ⊗<span class="hidden">⇗</span><sup><span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span></sup><span class="hidden">⇖</span><span class="main">)</span>"</span></span>  
    <span class="keyword1"><span class="command">using</span></span> tensor_gate assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> IH add.commute calculation<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"gate <span class="main">(</span><span class="free">m</span><span class="main">*</span><span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">A</span> ⊗<span class="hidden">⇗</span><sup><span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span></sup><span class="hidden">⇖</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add.commute<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Deutsch_Jozsa-iter_tensor_of_state_is_state"><span class="command">lemma</span></span> iter_tensor_of_state_is_state<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span> <span class="quoted"><span class="quoted">"complex Matrix.mat"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">n</span> <span class="free">m</span><span class="main">::</span> <span class="quoted"><span class="quoted">"nat"</span></span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"state <span class="free">m</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span><span class="main">≥</span><span class="main">1</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"state <span class="main">(</span><span class="free">m</span><span class="main">*</span><span class="free">n</span><span class="main">)</span> <span class="main">(</span><span class="free">A</span> ⊗<span class="hidden">⇗</span><sup><span class="free">n</span></sup><span class="hidden">⇖</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span> nat_induct_at_least<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"state <span class="main">(</span><span class="free">m</span> <span class="main">*</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span><span class="free">A</span> ⊗<span class="hidden">⇗</span><sup><span class="main">1</span></sup><span class="hidden">⇖</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> one_tensor_is_id assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span><span class="main">::</span> <span class="quoted">nat</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">≥</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> IH<span class="main">:</span><span class="quoted"><span class="quoted">"state <span class="main">(</span><span class="free">m</span> <span class="main">*</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span><span class="free">A</span> ⊗<span class="hidden">⇗</span><sup><span class="skolem">n</span></sup><span class="hidden">⇖</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> ⊗<span class="hidden">⇗</span><sup><span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span></sup><span class="hidden">⇖</span> <span class="main">=</span> <span class="free">A</span> <span class="main">⨂</span> <span class="main">(</span><span class="free">A</span> ⊗<span class="hidden">⇗</span><sup><span class="skolem">n</span></sup><span class="hidden">⇖</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iter_tensor_suc<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"state <span class="main">(</span><span class="free">m</span><span class="main">*</span><span class="skolem">n</span> <span class="main">+</span> <span class="free">m</span><span class="main">)</span> <span class="main">(</span><span class="free">A</span> ⊗<span class="hidden">⇗</span><sup><span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span></sup><span class="hidden">⇖</span><span class="main">)</span>"</span></span>  
    <span class="keyword1"><span class="command">using</span></span> tensor_gate assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> IH add.commute calculation<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"state <span class="main">(</span><span class="free">m</span><span class="main">*</span><span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">A</span> ⊗<span class="hidden">⇗</span><sup><span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span></sup><span class="hidden">⇖</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add.commute<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
We prepare n+1 qubits. The first n qubits in the state $|0\rangle$, the last one in the state 
$|1\rangle$.
›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">ψ<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>0</sub></span><span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> complex Matrix.mat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">ψ<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>0</sub></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">≡</span> Matrix.mat <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">1</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="main">1</span><span class="main">/</span><span class="main">(</span>sqrt <span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span>"</span></span> 

<span class="keyword1" id="Deutsch_Jozsa-ψ"><span class="command">lemma</span></span> ψ<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>0</sub>_values<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">i</span> <span class="free">j</span> <span class="free">n</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> dim_row <span class="main">(</span>ψ<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>0</sub> <span class="free">n</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">&lt;</span> dim_col <span class="main">(</span>ψ<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>0</sub> <span class="free">n</span><span class="main">)</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>ψ<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>0</sub> <span class="free">n</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="free">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span><span class="main">/</span><span class="main">(</span>sqrt <span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="free">n</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> assms case_prod_conv <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹$H^{\otimes n}$ is applied to $|0\rangle^{\otimes n}$.›</span></span>

<span class="keyword1" id="Deutsch_Jozsa-H_on_ket_zero"><span class="command">lemma</span></span> H_on_ket_zero<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>H <span class="main">*</span> <span class="main">|</span>zero<span class="main">⟩</span><span class="main">)</span> <span class="main">=</span> ψ<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>0</sub> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> 
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span><span class="main">::</span> <span class="quoted">nat</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> dim_row <span class="main">(</span>ψ<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>0</sub> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> dim_col <span class="main">(</span>ψ<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>0</sub> <span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> f1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">}</span> <span class="main">∧</span> <span class="skolem">j</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_2_cases<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>H <span class="main">*</span> <span class="main">|</span>zero<span class="main">⟩</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>ψ<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>0</sub> <span class="main">1</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> times_mat_def scalar_prod_def H_def ket_vec_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_row <span class="main">(</span>H <span class="main">*</span> <span class="main">|</span>zero<span class="main">⟩</span><span class="main">)</span> <span class="main">=</span> dim_row <span class="main">(</span>ψ<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>0</sub> <span class="main">1</span><span class="main">)</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> H_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_col <span class="main">(</span>H <span class="main">*</span> <span class="main">|</span>zero<span class="main">⟩</span><span class="main">)</span> <span class="main">=</span> dim_col <span class="main">(</span>ψ<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>0</sub> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> H_def  
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ket_vec_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Deutsch_Jozsa-ψ"><span class="command">lemma</span></span> ψ<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>0</sub>_tensor<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≥</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>ψ<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>0</sub> <span class="main">1</span><span class="main">)</span> <span class="main">⨂</span> <span class="main">(</span>ψ<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>0</sub> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>ψ<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>0</sub> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"dim_row <span class="main">(</span>ψ<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>0</sub> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> dim_row <span class="main">(</span>ψ<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>0</sub> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_row <span class="main">(</span><span class="main">(</span>ψ<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>0</sub> <span class="main">1</span><span class="main">)</span> <span class="main">⨂</span> <span class="main">(</span>ψ<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>0</sub> <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> dim_row <span class="main">(</span>ψ<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>0</sub> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"dim_col <span class="main">(</span>ψ<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>0</sub> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> dim_col <span class="main">(</span>ψ<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>0</sub> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_col <span class="main">(</span><span class="main">(</span>ψ<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>0</sub> <span class="main">1</span><span class="main">)</span> <span class="main">⨂</span> <span class="main">(</span>ψ<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>0</sub> <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> dim_col <span class="main">(</span>ψ<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>0</sub> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span><span class="main">::</span> <span class="quoted">nat</span>
  <span class="keyword3"><span class="command">assume</span></span> a0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> dim_row <span class="main">(</span>ψ<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>0</sub> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> dim_col <span class="main">(</span>ψ<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>0</sub> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> f0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> f1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> f2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>ψ<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>0</sub> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span><span class="main">/</span><span class="main">(</span>sqrt <span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> ψ<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>0</sub>_values<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span>"</span></span><span class="main">]</span> a0 a1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>ψ<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>0</sub> <span class="main">1</span><span class="main">)</span> <span class="main">⨂</span> <span class="main">(</span>ψ<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>0</sub> <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>ψ<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>0</sub> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> disjE<span class="main">)</span> <span class="comment1">(*case distinction*)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> dim_row <span class="main">(</span>ψ<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>0</sub> <span class="free">n</span><span class="main">)</span> <span class="main">∨</span> <span class="skolem">i</span> <span class="main">≥</span> dim_row <span class="main">(</span>ψ<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>0</sub> <span class="free">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
  <span class="keyword1"><span class="command">next</span></span> <span class="comment1">(* case i &lt; dim_row (ψ<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>0</sub> n) *)</span>
    <span class="keyword3"><span class="command">assume</span></span> a2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> dim_row <span class="main">(</span>ψ<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>0</sub> <span class="free">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>ψ<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>0</sub> <span class="main">1</span><span class="main">)</span> <span class="main">⨂</span> <span class="main">(</span>ψ<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>0</sub> <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>ψ<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>0</sub> <span class="main">1</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>ψ<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>0</sub> <span class="free">n</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="main">0</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> index_tensor_mat f0 assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">1</span><span class="main">/</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="main">1</span><span class="main">/</span><span class="main">(</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="free">n</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> ψ<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>0</sub>_values a2 assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>ψ<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>0</sub> <span class="main">1</span><span class="main">)</span> <span class="main">⨂</span> <span class="main">(</span>ψ<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>0</sub> <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>ψ<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>0</sub> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> f2 divide_divide_eq_left power_Suc <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span> <span class="comment1">(* case i ≥ dim_row (ψ<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>0</sub> n) *)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≥</span> dim_row <span class="main">(</span>ψ<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>0</sub> <span class="free">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>ψ<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>0</sub> <span class="main">1</span><span class="main">)</span> <span class="main">⨂</span> <span class="main">(</span>ψ<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>0</sub> <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>ψ<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>0</sub> <span class="main">1</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span>ψ<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>0</sub> <span class="free">n</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span> <span class="skolem">i</span> <span class="main">-</span>dim_row <span class="main">(</span>ψ<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>0</sub> <span class="free">n</span><span class="main">)</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> index_tensor_mat_with_vec2_row_cond<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">i</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>ψ<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>0</sub> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>ψ<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>0</sub> <span class="free">n</span><span class="main">)</span>"</span></span> <span class="main">]</span> a0 a1 f0
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> dim_col_mat<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> dim_row_mat<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> index_tensor_mat_with_vec2_row_cond power_Suc power_one_right<span class="main">)</span>  
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>ψ<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>0</sub> <span class="main">1</span><span class="main">)</span> <span class="main">⨂</span> <span class="main">(</span>ψ<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>0</sub> <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span><span class="main">/</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="main">1</span><span class="main">/</span><span class="main">(</span>sqrt <span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="free">n</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> ψ<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>0</sub>_values<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">-</span>dim_row <span class="main">(</span>ψ<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>0</sub> <span class="free">n</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span>"</span></span><span class="main">]</span> a0 a1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span>  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>ψ<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>0</sub> <span class="main">1</span><span class="main">)</span> <span class="main">⨂</span> <span class="main">(</span>ψ<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>0</sub> <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>ψ<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>0</sub> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> f0 f1 divide_divide_eq_left power_Suc <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Deutsch_Jozsa-ψ"><span class="command">lemma</span></span> ψ<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>0</sub>_tensor_is_state<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≥</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"state <span class="free">n</span> <span class="main">(</span> <span class="main">|</span>zero<span class="main">⟩</span> ⊗<span class="hidden">⇗</span><sup><span class="free">n</span></sup><span class="hidden">⇖</span><span class="main">)</span>"</span></span>  
  <span class="keyword1"><span class="command">using</span></span> iter_tensor_of_state_is_state ket_zero_is_state assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="Deutsch_Jozsa-iter_tensor_of_H_is_gate"><span class="command">lemma</span></span> iter_tensor_of_H_is_gate<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≥</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"gate <span class="free">n</span> <span class="main">(</span>H ⊗<span class="hidden">⇗</span><sup><span class="free">n</span></sup><span class="hidden">⇖</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> iter_tensor_of_gate_is_gate H_is_gate assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="Deutsch_Jozsa-iter_tensor_of_H_on_zero_tensor"><span class="command">lemma</span></span> iter_tensor_of_H_on_zero_tensor<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≥</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>H ⊗<span class="hidden">⇗</span><sup><span class="free">n</span></sup><span class="hidden">⇖</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span> <span class="main">|</span>zero<span class="main">⟩</span> ⊗<span class="hidden">⇗</span><sup><span class="free">n</span></sup><span class="hidden">⇖</span><span class="main">)</span> <span class="main">=</span> ψ<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>0</sub> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span> nat_induct_at_least<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>H ⊗<span class="hidden">⇗</span><sup><span class="main">1</span></sup><span class="hidden">⇖</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span> <span class="main">|</span>zero<span class="main">⟩</span> ⊗<span class="hidden">⇗</span><sup><span class="main">1</span></sup><span class="hidden">⇖</span><span class="main">)</span> <span class="main">=</span> ψ<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>0</sub> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> H_on_ket_zero <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span><span class="main">::</span> <span class="quoted">nat</span>
  <span class="keyword3"><span class="command">assume</span></span> a0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">≥</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> IH<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>H ⊗<span class="hidden">⇗</span><sup><span class="skolem">n</span></sup><span class="hidden">⇖</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span> <span class="main">|</span>zero<span class="main">⟩</span> ⊗<span class="hidden">⇗</span><sup><span class="skolem">n</span></sup><span class="hidden">⇖</span><span class="main">)</span> <span class="main">=</span> ψ<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>0</sub> <span class="skolem">n</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>H ⊗<span class="hidden">⇗</span><sup><span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span></sup><span class="hidden">⇖</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span> <span class="main">|</span>zero<span class="main">⟩</span> ⊗<span class="hidden">⇗</span><sup><span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span></sup><span class="hidden">⇖</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>H <span class="main">*</span> <span class="main">|</span>zero<span class="main">⟩</span><span class="main">)</span> <span class="main">⨂</span> <span class="main">(</span><span class="main">(</span>H ⊗<span class="hidden">⇗</span><sup><span class="skolem">n</span></sup><span class="hidden">⇖</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span> <span class="main">|</span>zero<span class="main">⟩</span> ⊗<span class="hidden">⇗</span><sup><span class="skolem">n</span></sup><span class="hidden">⇖</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> iter_tensor_mult_distr<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span>"</span></span> <span class="quoted"><span class="quoted">"H"</span></span> <span class="quoted"><span class="quoted">"<span class="main">|</span>zero<span class="main">⟩</span>"</span></span><span class="main">]</span> a0 ket_vec_def H_def <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> H_def<span class="main">)</span> 
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span>  <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span>H <span class="main">*</span> <span class="main">|</span>zero<span class="main">⟩</span><span class="main">)</span> <span class="main">⨂</span> <span class="main">(</span>ψ<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>0</sub> <span class="skolem">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> IH <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span>ψ<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>0</sub> <span class="main">1</span><span class="main">)</span> <span class="main">⨂</span> <span class="main">(</span>ψ<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>0</sub> <span class="skolem">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> H_on_ket_zero <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span>ψ<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>0</sub> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ψ<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>0</sub>_tensor a0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>H ⊗<span class="hidden">⇗</span><sup><span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span></sup><span class="hidden">⇖</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span> <span class="main">|</span>zero<span class="main">⟩</span> ⊗<span class="hidden">⇗</span><sup><span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span></sup><span class="hidden">⇖</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>ψ<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>0</sub> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Deutsch_Jozsa-ψ"><span class="command">lemma</span></span> ψ<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>0</sub>_is_state<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≥</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"state <span class="free">n</span> <span class="main">(</span>ψ<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>0</sub> <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> iter_tensor_of_H_is_gate ψ<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>0</sub>_tensor_is_state assms gate_on_state_is_state iter_tensor_of_H_on_zero_tensor assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">ψ<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>1</sub></span><span class="main">::</span> <span class="quoted"><span class="quoted">"complex Matrix.mat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">ψ<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≡</span> Matrix.mat <span class="numeral">2</span> <span class="main">1</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">i</span><span class="main">=</span><span class="main">0</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">/</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">-</span><span class="main">1</span><span class="main">/</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Deutsch_Jozsa-H_on_ket_one_is_ψ"><span class="command">lemma</span></span> H_on_ket_one_is_ψ<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>1</sub><span class="main">:</span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>H <span class="main">*</span> <span class="main">|</span>one<span class="main">⟩</span><span class="main">)</span> <span class="main">=</span> ψ<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>1</sub>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> 
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span><span class="main">::</span> <span class="quoted">nat</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> dim_row ψ<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>1</sub>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> dim_col ψ<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>1</sub>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">}</span> <span class="main">∧</span> <span class="skolem">j</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_2_cases<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>H <span class="main">*</span> <span class="main">|</span>one<span class="main">⟩</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> ψ<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>1</sub> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> times_mat_def scalar_prod_def H_def ket_vec_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_row <span class="main">(</span>H <span class="main">*</span> <span class="main">|</span>one<span class="main">⟩</span><span class="main">)</span> <span class="main">=</span> dim_row ψ<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>1</sub>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> H_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span> 
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_col <span class="main">(</span>H <span class="main">*</span> <span class="main">|</span>one<span class="main">⟩</span><span class="main">)</span> <span class="main">=</span> dim_col ψ<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>1</sub>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> H_def ket_vec_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">ψ<span class="hidden">⇩</span><sub>1</sub></span><span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> complex Matrix.mat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">ψ<span class="hidden">⇩</span><sub>1</sub></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">≡</span> Matrix.mat <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">1</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="keyword1">if</span> even <span class="bound">i</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">/</span><span class="main">(</span>sqrt <span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">-</span><span class="main">1</span><span class="main">/</span><span class="main">(</span>sqrt <span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Deutsch_Jozsa-ψ"><span class="command">lemma</span></span> ψ<span class="hidden">⇩</span><sub>1</sub>_values_even<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">i</span> <span class="free">j</span> <span class="free">n</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> dim_row <span class="main">(</span>ψ<span class="hidden">⇩</span><sub>1</sub> <span class="free">n</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">&lt;</span> dim_col <span class="main">(</span>ψ<span class="hidden">⇩</span><sub>1</sub> <span class="free">n</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"even <span class="free">i</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>ψ<span class="hidden">⇩</span><sub>1</sub> <span class="free">n</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="free">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span><span class="main">/</span><span class="main">(</span>sqrt <span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> assms case_prod_conv <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Deutsch_Jozsa-ψ"><span class="command">lemma</span></span> ψ<span class="hidden">⇩</span><sub>1</sub>_values_odd <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">i</span> <span class="free">j</span> <span class="free">n</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> dim_row <span class="main">(</span>ψ<span class="hidden">⇩</span><sub>1</sub> <span class="free">n</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">&lt;</span> dim_col <span class="main">(</span>ψ<span class="hidden">⇩</span><sub>1</sub> <span class="free">n</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"odd <span class="free">i</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>ψ<span class="hidden">⇩</span><sub>1</sub> <span class="free">n</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="free">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span><span class="main">1</span><span class="main">/</span><span class="main">(</span>sqrt <span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> assms case_prod_conv <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted">"ψ<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>0</sub>_tensor_ψ<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>1</sub>_is_ψ<span class="hidden">⇩</span><sub>1</sub>"</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≥</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>ψ<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>0</sub> <span class="free">n</span><span class="main">)</span> <span class="main">⨂</span> ψ<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>1</sub> <span class="main">=</span> ψ<span class="hidden">⇩</span><sub>1</sub> <span class="free">n</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> 
 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_col <span class="main">(</span><span class="main">(</span>ψ<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>0</sub> <span class="free">n</span><span class="main">)</span> <span class="main">⨂</span> ψ<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>1</sub><span class="main">)</span> <span class="main">=</span> dim_col <span class="main">(</span>ψ<span class="hidden">⇩</span><sub>1</sub> <span class="free">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_row <span class="main">(</span><span class="main">(</span>ψ<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>0</sub> <span class="free">n</span><span class="main">)</span> <span class="main">⨂</span> ψ<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>1</sub><span class="main">)</span> <span class="main">=</span> dim_row <span class="main">(</span>ψ<span class="hidden">⇩</span><sub>1</sub> <span class="free">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span><span class="main">::</span> <span class="quoted">nat</span>
  <span class="keyword3"><span class="command">assume</span></span> a0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> dim_row <span class="main">(</span>ψ<span class="hidden">⇩</span><sub>1</sub> <span class="free">n</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> dim_col <span class="main">(</span>ψ<span class="hidden">⇩</span><sub>1</sub> <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> f0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>ψ<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>0</sub> <span class="free">n</span><span class="main">)</span> <span class="main">⨂</span> ψ<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>1</sub><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span><span class="main">/</span><span class="main">(</span>sqrt <span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="free">n</span> <span class="main">*</span> ψ<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>1</sub> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span> <span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> ψ<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>0</sub>_values<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="keyword1">div</span> <span class="numeral">2</span>"</span></span> <span class="quoted"><span class="free">n</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="keyword1">div</span> <span class="main">1</span>"</span></span><span class="main">]</span> a0 a1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>ψ<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>0</sub> <span class="free">n</span><span class="main">)</span> <span class="main">⨂</span> ψ<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>1</sub><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>ψ<span class="hidden">⇩</span><sub>1</sub> <span class="free">n</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> f0 ψ<span class="hidden">⇩</span><sub>1</sub>_values_even ψ<span class="hidden">⇩</span><sub>1</sub>_values_odd a0 a1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Deutsch_Jozsa-ψ"><span class="command">lemma</span></span> ψ<span class="hidden">⇩</span><sub>1</sub>_is_state<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≥</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"state <span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">(</span>ψ<span class="hidden">⇩</span><sub>1</sub> <span class="free">n</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> assms ψ<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>0</sub>_tensor_ψ<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>1</sub>_is_ψ<span class="hidden">⇩</span><sub>1</sub> ψ<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>0</sub>_is_state H_on_ket_one_is_state H_on_ket_one_is_ψ<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>1</sub> tensor_state <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> jozsa<span class="main">)</span> <span class="entity">ψ<span class="hidden">⇩</span><sub>2</sub></span><span class="main">::</span> <span class="quoted"><span class="quoted">"complex Matrix.mat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">ψ<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">≡</span> Matrix.mat <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">1</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="keyword1">if</span> even <span class="bound">i</span> <span class="keyword1">then</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="free">f</span><span class="main">(</span><span class="bound">i</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span><span class="main">/</span><span class="main">(</span>sqrt <span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> 
                                        <span class="keyword1">else</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">f</span><span class="main">(</span><span class="bound">i</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">/</span><span class="main">(</span>sqrt <span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> jozsa<span class="main">)</span> ψ<span class="hidden">⇩</span><sub>2</sub>_values_even <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">i</span> <span class="free">j</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> dim_row ψ<span class="hidden">⇩</span><sub>2</sub> "</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">&lt;</span> dim_col ψ<span class="hidden">⇩</span><sub>2</sub>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"even <span class="free">i</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ψ<span class="hidden">⇩</span><sub>2</sub> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="free">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="free">f</span><span class="main">(</span><span class="free">i</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span><span class="main">/</span><span class="main">(</span>sqrt <span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> assms case_prod_conv <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> jozsa<span class="main">)</span> ψ<span class="hidden">⇩</span><sub>2</sub>_values_odd <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">i</span> <span class="free">j</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> dim_row ψ<span class="hidden">⇩</span><sub>2</sub>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">&lt;</span> dim_col ψ<span class="hidden">⇩</span><sub>2</sub>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"odd <span class="free">i</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ψ<span class="hidden">⇩</span><sub>2</sub> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="free">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">f</span><span class="main">(</span><span class="free">i</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">/</span><span class="main">(</span>sqrt <span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> assms case_prod_conv <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> jozsa<span class="main">)</span> ψ<span class="hidden">⇩</span><sub>2</sub>_values_odd_hidden <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span><span class="main">*</span><span class="free">k</span><span class="main">+</span><span class="main">1</span> <span class="main">&lt;</span> dim_row ψ<span class="hidden">⇩</span><sub>2</sub>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">&lt;</span> dim_col ψ<span class="hidden">⇩</span><sub>2</sub>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ψ<span class="hidden">⇩</span><sub>2</sub> <span class="main">$$</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">k</span><span class="main">+</span><span class="main">1</span><span class="main">,</span><span class="free">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">f</span><span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">/</span><span class="main">(</span>sqrt <span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> jozsa<span class="main">)</span> snd_rep_of_ψ<span class="hidden">⇩</span><sub>2</sub><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> dim_row ψ<span class="hidden">⇩</span><sub>2</sub>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="free">f</span><span class="main">(</span><span class="free">i</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">-</span><span class="free">f</span><span class="main">(</span><span class="free">i</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">1</span><span class="main">/</span><span class="main">(</span>sqrt <span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="free">f</span><span class="main">(</span><span class="free">i</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span><span class="main">/</span><span class="main">(</span>sqrt <span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="free">f</span><span class="main">(</span><span class="free">i</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">+</span><span class="main">(</span><span class="free">f</span><span class="main">(</span><span class="free">i</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">*</span> <span class="main">1</span><span class="main">/</span><span class="main">(</span>sqrt <span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">f</span><span class="main">(</span><span class="free">i</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">/</span><span class="main">(</span>sqrt <span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span> 
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="keyword1">div</span> <span class="numeral">2</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="numeral">2</span> <span class="main">^</span> <span class="free">n</span><span class="main">}</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"real <span class="main">(</span>Suc <span class="main">0</span> <span class="main">-</span> <span class="free">f</span> <span class="main">(</span><span class="free">i</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> real <span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="free">i</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="free">f</span> <span class="main">(</span><span class="free">i</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms f_values <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="free">f</span><span class="main">(</span><span class="free">i</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">-</span><span class="free">f</span><span class="main">(</span><span class="free">i</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">1</span><span class="main">/</span><span class="main">(</span>sqrt <span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="free">f</span><span class="main">(</span><span class="free">i</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span><span class="main">/</span><span class="main">(</span>sqrt <span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="keyword1">div</span> <span class="numeral">2</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">}</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>real <span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="free">i</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> real <span class="main">(</span>Suc <span class="main">0</span> <span class="main">-</span> <span class="free">f</span> <span class="main">(</span><span class="free">i</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span>sqrt <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
           <span class="main">-</span> <span class="main">(</span><span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="free">f</span> <span class="main">(</span><span class="free">i</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span>sqrt <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
   <span class="keyword1"><span class="command">using</span></span> assms f_values <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="free">f</span><span class="main">(</span><span class="free">i</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">+</span><span class="main">(</span><span class="free">f</span><span class="main">(</span><span class="free">i</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">*</span> <span class="main">1</span><span class="main">/</span><span class="main">(</span>sqrt <span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">f</span><span class="main">(</span><span class="free">i</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">/</span><span class="main">(</span>sqrt <span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> jozsa<span class="main">)</span> jozsa_transform_times_ψ<span class="hidden">⇩</span><sub>1</sub>_is_ψ<span class="hidden">⇩</span><sub>2</sub><span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">*</span> <span class="main">(</span>ψ<span class="hidden">⇩</span><sub>1</sub> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> ψ<span class="hidden">⇩</span><sub>2</sub>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> 
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_row <span class="main">(</span><span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">*</span> <span class="main">(</span>ψ<span class="hidden">⇩</span><sub>1</sub> <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> dim_row ψ<span class="hidden">⇩</span><sub>2</sub>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_col <span class="main">(</span><span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">*</span> <span class="main">(</span>ψ<span class="hidden">⇩</span><sub>1</sub> <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> dim_col ψ<span class="hidden">⇩</span><sub>2</sub>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span> <span class="main">::</span><span class="quoted">nat</span>
  <span class="keyword3"><span class="command">assume</span></span> a0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> dim_row ψ<span class="hidden">⇩</span><sub>2</sub>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> dim_col ψ<span class="hidden">⇩</span><sub>2</sub>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> f0<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">}</span> <span class="main">∧</span> <span class="skolem">j</span><span class="main">=</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> f1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> dim_row <span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">∧</span> <span class="skolem">j</span> <span class="main">&lt;</span> dim_col <span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span> "</span></span> <span class="keyword1"><span class="command">using</span></span> a0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> f2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> dim_row <span class="main">(</span>ψ<span class="hidden">⇩</span><sub>1</sub> <span class="free">n</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">j</span> <span class="main">&lt;</span> dim_col <span class="main">(</span>ψ<span class="hidden">⇩</span><sub>1</sub> <span class="free">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a0 a1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">*</span> <span class="main">(</span>ψ<span class="hidden">⇩</span><sub>1</sub> <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> ψ<span class="hidden">⇩</span><sub>2</sub> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> disjE<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"even <span class="skolem">i</span> <span class="main">∨</span> odd <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a2<span class="main">:</span> <span class="quoted"><span class="quoted">"even <span class="skolem">i</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">*</span> <span class="main">(</span>ψ<span class="hidden">⇩</span><sub>1</sub> <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span> <span class="main">∈</span> <span class="main">{</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">i</span><span class="main">+</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> <span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>ψ<span class="hidden">⇩</span><sub>1</sub> <span class="free">n</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> f1 f2 U<span class="hidden">⇩</span><sub>f</sub>_mult_without_empty_summands_even<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">i</span></span> <span class="quoted"><span class="skolem">j</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>ψ<span class="hidden">⇩</span><sub>1</sub> <span class="free">n</span><span class="main">)</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">i</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>ψ<span class="hidden">⇩</span><sub>1</sub> <span class="free">n</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="free">f</span><span class="main">(</span><span class="skolem">i</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">*</span> <span class="main">1</span><span class="main">/</span><span class="main">(</span>sqrt <span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> f0 f1 a2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>ψ<span class="hidden">⇩</span><sub>1</sub> <span class="free">n</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">+</span><span class="main">1</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span><span class="free">f</span><span class="main">(</span><span class="skolem">i</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">*</span> <span class="main">1</span><span class="main">/</span><span class="main">(</span>sqrt <span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> f0 f1 a2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">*</span> <span class="main">(</span>ψ<span class="hidden">⇩</span><sub>1</sub> <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="free">f</span><span class="main">(</span><span class="skolem">i</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">*</span> <span class="main">1</span><span class="main">/</span><span class="main">(</span>sqrt <span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">-</span><span class="free">f</span><span class="main">(</span><span class="skolem">i</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">*</span> <span class="main">1</span><span class="main">/</span><span class="main">(</span>sqrt <span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="free">f</span><span class="main">(</span><span class="skolem">i</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">+</span><span class="main">-</span><span class="free">f</span><span class="main">(</span><span class="skolem">i</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">1</span><span class="main">/</span><span class="main">(</span>sqrt <span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> add_divide_distrib 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> mult.right_neutral of_int_add of_int_of_nat_eq<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> ψ<span class="hidden">⇩</span><sub>2</sub> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> a0 a1 a2 snd_rep_of_ψ<span class="hidden">⇩</span><sub>2</sub> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">*</span> <span class="main">(</span>ψ<span class="hidden">⇩</span><sub>1</sub> <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> ψ<span class="hidden">⇩</span><sub>2</sub> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span> 
    <span class="keyword3"><span class="command">assume</span></span> a2<span class="main">:</span> <span class="quoted"><span class="quoted">"odd <span class="skolem">i</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> f6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span><span class="main">≥</span><span class="main">1</span>"</span></span>  
    <span class="keyword1"><span class="command">using</span></span> linorder_not_less <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">*</span> <span class="main">(</span>ψ<span class="hidden">⇩</span><sub>1</sub> <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span> <span class="main">∈</span> <span class="main">{</span><span class="skolem">i</span><span class="main">-</span><span class="main">1</span><span class="main">,</span><span class="skolem">i</span><span class="main">}</span><span class="main">.</span> <span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>ψ<span class="hidden">⇩</span><sub>1</sub> <span class="free">n</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> f1 f2 a2 U<span class="hidden">⇩</span><sub>f</sub>_mult_without_empty_summands_odd<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">i</span></span> <span class="quoted"><span class="skolem">j</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>ψ<span class="hidden">⇩</span><sub>1</sub> <span class="free">n</span><span class="main">)</span>"</span></span><span class="main">]</span>  
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> dim_row_mat<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> jozsa_transform_dim<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span> 
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span> <span class="main">∈</span> <span class="main">{</span><span class="skolem">i</span><span class="main">-</span><span class="main">1</span><span class="main">,</span><span class="skolem">i</span><span class="main">}</span><span class="main">.</span> <span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>ψ<span class="hidden">⇩</span><sub>1</sub> <span class="free">n</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span><span class="main">)</span> 
                 <span class="main">=</span> <span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">i</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>ψ<span class="hidden">⇩</span><sub>1</sub> <span class="free">n</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">-</span><span class="main">1</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">+</span>  <span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">i</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>ψ<span class="hidden">⇩</span><sub>1</sub> <span class="free">n</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> a2 f6 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span>  <span class="quoted"><span class="quoted">"<span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">i</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>ψ<span class="hidden">⇩</span><sub>1</sub> <span class="free">n</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="free">f</span><span class="main">(</span><span class="skolem">i</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">*</span> <span class="main">-</span><span class="main">1</span><span class="main">/</span><span class="main">(</span>sqrt <span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> f1 f2 a2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">i</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>ψ<span class="hidden">⇩</span><sub>1</sub> <span class="free">n</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">-</span><span class="main">1</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span><span class="main">(</span><span class="skolem">i</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span><span class="main">*</span> <span class="main">1</span><span class="main">/</span><span class="main">(</span>sqrt <span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> a0 a1 a2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">*</span> <span class="main">(</span>ψ<span class="hidden">⇩</span><sub>1</sub> <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="free">f</span><span class="main">(</span><span class="skolem">i</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">*</span> <span class="main">-</span><span class="main">1</span><span class="main">/</span><span class="main">(</span>sqrt <span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">+</span><span class="main">(</span><span class="free">f</span><span class="main">(</span><span class="skolem">i</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">*</span> <span class="main">1</span><span class="main">/</span><span class="main">(</span>sqrt <span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> of_real_add <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="free">f</span><span class="main">(</span><span class="skolem">i</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="free">f</span><span class="main">(</span><span class="skolem">i</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">1</span><span class="main">/</span><span class="main">(</span>sqrt <span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> mult.right_neutral add_divide_distrib mult_minus1_right 
          of_int_add of_int_of_nat_eq<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">f</span><span class="main">(</span><span class="skolem">i</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">/</span><span class="main">(</span>sqrt <span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span> 
       <span class="keyword1"><span class="command">using</span></span> a0 a1 a2 snd_rep_of_ψ<span class="hidden">⇩</span><sub>2</sub> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
   <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">*</span> <span class="main">(</span>ψ<span class="hidden">⇩</span><sub>1</sub> <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> ψ<span class="hidden">⇩</span><sub>2</sub> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> a0 a1 a2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> jozsa<span class="main">)</span> ψ<span class="hidden">⇩</span><sub>2</sub>_is_state<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"state <span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> ψ<span class="hidden">⇩</span><sub>2</sub>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> jozsa_transform_times_ψ<span class="hidden">⇩</span><sub>1</sub>_is_ψ<span class="hidden">⇩</span><sub>2</sub> jozsa_transform_is_gate ψ<span class="hidden">⇩</span><sub>1</sub>_is_state dim gate_on_state_is_state <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">"H^<span class="hidden">⇩</span><sub>⊗</sub> n"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is the result of taking the nth tensor product of H›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">iter_tensor_of_H_rep</span><span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> complex Matrix.mat"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">H^<span class="hidden">⇩</span><sub>⊗</sub></span> _"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">iter_tensor_of_H_rep</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">≡</span> Matrix.mat <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span><span class="main">.</span><span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="bound">i</span> ⋅<span class="hidden">⇘</span><sub><span class="free"><span class="bound"><span class="entity">n</span></span></span></sub><span class="hidden">⇙</span> <span class="bound">j</span><span class="main">)</span><span class="main">/</span><span class="main">(</span>sqrt <span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Deutsch_Jozsa-tensor_of_H_values"><span class="command">lemma</span></span> tensor_of_H_values <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">n</span> <span class="free">i</span> <span class="free">j</span><span class="main">::</span> <span class="quoted">nat</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> dim_row <span class="main">(</span><span class="keyword1">H^<span class="hidden">⇩</span><sub>⊗</sub></span> <span class="free">n</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">&lt;</span> dim_col <span class="main">(</span><span class="keyword1">H^<span class="hidden">⇩</span><sub>⊗</sub></span> <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">H^<span class="hidden">⇩</span><sub>⊗</sub></span> <span class="free">n</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="free">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">i</span> ⋅<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span> <span class="free">j</span><span class="main">)</span><span class="main">/</span><span class="main">(</span>sqrt <span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Deutsch_Jozsa-dim_row_of_iter_tensor_of_H"><span class="command">lemma</span></span> dim_row_of_iter_tensor_of_H <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≥</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">&lt;</span> dim_row <span class="main">(</span><span class="keyword1">H^<span class="hidden">⇩</span><sub>⊗</sub></span> <span class="free">n</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">metis</span> One_nat_def Suc_1 dim_row_mat<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> le_trans lessI linorder_not_less one_less_power<span class="main">)</span>

<span class="keyword1" id="Deutsch_Jozsa-iter_tensor_of_H_fst_pos"><span class="command">lemma</span></span> iter_tensor_of_H_fst_pos<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">n</span> <span class="free">i</span> <span class="free">j</span><span class="main">::</span> <span class="quoted">nat</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span> <span class="main">∨</span> <span class="free">j</span> <span class="main">&lt;</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">∧</span> <span class="free">j</span> <span class="main">&lt;</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">H^<span class="hidden">⇩</span><sub>⊗</sub></span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="free">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span><span class="main">/</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">H^<span class="hidden">⇩</span><sub>⊗</sub></span> <span class="free">n</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span> <span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">,</span> <span class="free">j</span> <span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">H^<span class="hidden">⇩</span><sub>⊗</sub></span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="free">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="main">(</span>bip <span class="free">i</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="free">j</span><span class="main">)</span><span class="main">/</span><span class="main">(</span>sqrt <span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bip <span class="free">i</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="free">j</span> <span class="main">=</span> bip <span class="main">(</span><span class="free">i</span> <span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">)</span> <span class="free">n</span> <span class="main">(</span><span class="free">j</span> <span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> bitwise_inner_prod_fst_el_0 assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command">using</span></span> bitwise_inner_prod_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Deutsch_Jozsa-iter_tensor_of_H_fst_neg"><span class="command">lemma</span></span> iter_tensor_of_H_fst_neg<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">n</span> <span class="free">i</span> <span class="free">j</span><span class="main">::</span> <span class="quoted">nat</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≥</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span> <span class="main">∧</span> <span class="free">j</span> <span class="main">≥</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">∧</span> <span class="free">j</span> <span class="main">&lt;</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">H^<span class="hidden">⇩</span><sub>⊗</sub></span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="free">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span><span class="main">1</span><span class="main">/</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">H^<span class="hidden">⇩</span><sub>⊗</sub></span> <span class="free">n</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span> <span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">,</span> <span class="free">j</span> <span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">H^<span class="hidden">⇩</span><sub>⊗</sub></span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="free">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="main">(</span>bip <span class="free">i</span> <span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="free">j</span><span class="main">)</span><span class="main">/</span><span class="main">(</span>sqrt <span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bip <span class="free">i</span> <span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="free">j</span> <span class="main">=</span> <span class="main">1</span> <span class="main">+</span> bip <span class="main">(</span><span class="free">i</span> <span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">)</span> <span class="free">n</span> <span class="main">(</span><span class="free">j</span> <span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> bitwise_inner_prod_fst_el_is_1 assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span> 

<span class="keyword1" id="Deutsch_Jozsa-H_tensor_iter_tensor_of_H"><span class="command">lemma</span></span> H_tensor_iter_tensor_of_H<span class="main">:</span>   
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">n</span><span class="main">::</span> <span class="quoted">nat</span>
  <span class="keyword2"><span class="keyword">shows</span></span>  <span class="quoted"><span class="quoted">"<span class="main">(</span>H <span class="main">⨂</span> <span class="keyword1">H^<span class="hidden">⇩</span><sub>⊗</sub></span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">H^<span class="hidden">⇩</span><sub>⊗</sub></span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span><span class="main">::</span> <span class="quoted">nat</span>
  <span class="keyword3"><span class="command">assume</span></span> a0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> dim_row <span class="main">(</span><span class="keyword1">H^<span class="hidden">⇩</span><sub>⊗</sub></span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> dim_col <span class="main">(</span><span class="keyword1">H^<span class="hidden">⇩</span><sub>⊗</sub></span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> f0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">}</span> <span class="main">∧</span> <span class="skolem">j</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> f1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>H <span class="main">⨂</span> <span class="keyword1">H^<span class="hidden">⇩</span><sub>⊗</sub></span> <span class="free">n</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> H <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span> <span class="keyword1">div</span> <span class="main">(</span>dim_row <span class="main">(</span><span class="keyword1">H^<span class="hidden">⇩</span><sub>⊗</sub></span> <span class="free">n</span><span class="main">)</span><span class="main">)</span><span class="main">,</span><span class="skolem">j</span> <span class="keyword1">div</span> <span class="main">(</span>dim_col <span class="main">(</span><span class="keyword1">H^<span class="hidden">⇩</span><sub>⊗</sub></span> <span class="free">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                                       <span class="main">*</span> <span class="main">(</span><span class="keyword1">H^<span class="hidden">⇩</span><sub>⊗</sub></span> <span class="free">n</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span> <span class="keyword1">mod</span> <span class="main">(</span>dim_row <span class="main">(</span><span class="keyword1">H^<span class="hidden">⇩</span><sub>⊗</sub></span> <span class="free">n</span><span class="main">)</span><span class="main">)</span><span class="main">,</span><span class="skolem">j</span> <span class="keyword1">mod</span> <span class="main">(</span>dim_col <span class="main">(</span><span class="keyword1">H^<span class="hidden">⇩</span><sub>⊗</sub></span> <span class="free">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> H_without_scalar_prod<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>H <span class="main">⨂</span> <span class="keyword1">H^<span class="hidden">⇩</span><sub>⊗</sub></span> <span class="free">n</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">H^<span class="hidden">⇩</span><sub>⊗</sub></span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> disjE<span class="main">)</span> 
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">i</span> <span class="main">&lt;</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span> <span class="main">∨</span> <span class="skolem">j</span> <span class="main">&lt;</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">)</span> <span class="main">∨</span> <span class="main">¬</span><span class="main">(</span><span class="skolem">i</span> <span class="main">&lt;</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span> <span class="main">∨</span> <span class="skolem">j</span> <span class="main">&lt;</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">i</span> <span class="main">&lt;</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span> <span class="main">∨</span> <span class="skolem">j</span> <span class="main">&lt;</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">H^<span class="hidden">⇩</span><sub>⊗</sub></span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span><span class="main">/</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">H^<span class="hidden">⇩</span><sub>⊗</sub></span> <span class="free">n</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span> <span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">,</span> <span class="skolem">j</span> <span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> a0 a1 f0 iter_tensor_of_H_fst_pos <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> atLeastLessThan_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"H <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span> <span class="keyword1">div</span> <span class="main">(</span>dim_row <span class="main">(</span><span class="keyword1">H^<span class="hidden">⇩</span><sub>⊗</sub></span> <span class="free">n</span><span class="main">)</span><span class="main">)</span><span class="main">,</span><span class="skolem">j</span> <span class="keyword1">div</span> <span class="main">(</span>dim_col <span class="main">(</span><span class="keyword1">H^<span class="hidden">⇩</span><sub>⊗</sub></span> <span class="free">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span><span class="main">/</span>sqrt <span class="numeral">2</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> a0 a1 f0 H_without_scalar_prod H_values a2
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> dim_col_mat<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> dim_row_mat<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> div_less le_eq_less_or_eq 
          le_numeral_extra<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> less_power_add_imp_div_less plus_1_eq_Suc power_one_right<span class="main">)</span> 
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>H <span class="main">⨂</span> <span class="keyword1">H^<span class="hidden">⇩</span><sub>⊗</sub></span> <span class="free">n</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">H^<span class="hidden">⇩</span><sub>⊗</sub></span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> f1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span> 
    <span class="keyword3"><span class="command">assume</span></span> a2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="skolem">i</span> <span class="main">&lt;</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span> <span class="main">∨</span> <span class="skolem">j</span> <span class="main">&lt;</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≥</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span> <span class="main">∧</span> <span class="skolem">j</span> <span class="main">≥</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> f2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">H^<span class="hidden">⇩</span><sub>⊗</sub></span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span><span class="main">1</span><span class="main">/</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">H^<span class="hidden">⇩</span><sub>⊗</sub></span> <span class="free">n</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span> <span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">,</span> <span class="skolem">j</span> <span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> a0 a1 f0 iter_tensor_of_H_fst_neg <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="keyword1">div</span> <span class="main">(</span>dim_row <span class="main">(</span><span class="keyword1">H^<span class="hidden">⇩</span><sub>⊗</sub></span> <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span><span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="keyword1">div</span> <span class="main">(</span>dim_row <span class="main">(</span><span class="keyword1">H^<span class="hidden">⇩</span><sub>⊗</sub></span> <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>  
      <span class="keyword1"><span class="command">using</span></span> a2 a0 a1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"H <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span> <span class="keyword1">div</span> <span class="main">(</span>dim_row <span class="main">(</span><span class="keyword1">H^<span class="hidden">⇩</span><sub>⊗</sub></span> <span class="free">n</span><span class="main">)</span><span class="main">)</span><span class="main">,</span><span class="skolem">j</span> <span class="keyword1">div</span> <span class="main">(</span>dim_col <span class="main">(</span><span class="keyword1">H^<span class="hidden">⇩</span><sub>⊗</sub></span> <span class="free">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span><span class="main">1</span><span class="main">/</span>sqrt <span class="numeral">2</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> a0 a1 f0 H_values_right_bottom<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="keyword1">div</span> <span class="main">(</span>dim_row <span class="main">(</span><span class="keyword1">H^<span class="hidden">⇩</span><sub>⊗</sub></span> <span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="keyword1">div</span> <span class="main">(</span>dim_col <span class="main">(</span><span class="keyword1">H^<span class="hidden">⇩</span><sub>⊗</sub></span> <span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">]</span> a2 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>H <span class="main">⨂</span> <span class="keyword1">H^<span class="hidden">⇩</span><sub>⊗</sub></span> <span class="free">n</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">H^<span class="hidden">⇩</span><sub>⊗</sub></span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> f1 f2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_row <span class="main">(</span>H <span class="main">⨂</span> <span class="keyword1">H^<span class="hidden">⇩</span><sub>⊗</sub></span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> dim_row <span class="main">(</span><span class="keyword1">H^<span class="hidden">⇩</span><sub>⊗</sub></span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> H_without_scalar_prod<span class="main">)</span> 
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_col <span class="main">(</span>H <span class="main">⨂</span> <span class="keyword1">H^<span class="hidden">⇩</span><sub>⊗</sub></span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> dim_col <span class="main">(</span><span class="keyword1">H^<span class="hidden">⇩</span><sub>⊗</sub></span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> H_without_scalar_prod<span class="main">)</span> 
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
We prove that <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="keyword1">H^<span class="hidden">⇩</span><sub>⊗</sub></span></span> <span class="free"><span class="free">n</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is indeed the matrix representation of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"H ⊗<span class="hidden">⇗</span><sup><span class="free"><span class="free">n</span></span></sup><span class="hidden">⇖</span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, the iterated 
tensor product of the Hadamard gate H.
›</span></span>

<span class="keyword1" id="Deutsch_Jozsa-one_tensor_of_H_is_H"><span class="command">lemma</span></span> one_tensor_of_H_is_H<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">H^<span class="hidden">⇩</span><sub>⊗</sub></span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> H"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span> eq_matI<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_row <span class="main">(</span><span class="keyword1">H^<span class="hidden">⇩</span><sub>⊗</sub></span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> dim_row H"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> H_without_scalar_prod<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_col <span class="main">(</span><span class="keyword1">H^<span class="hidden">⇩</span><sub>⊗</sub></span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> dim_col H"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> H_without_scalar_prod<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span><span class="main">::</span> <span class="quoted">nat</span>
  <span class="keyword3"><span class="command">assume</span></span> a0<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> dim_row H"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> dim_col H"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">H^<span class="hidden">⇩</span><sub>⊗</sub></span> <span class="main">1</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> H <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">H^<span class="hidden">⇩</span><sub>⊗</sub></span> <span class="main">1</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span><span class="main">/</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span>"</span></span> 
       <span class="keyword1"><span class="command">using</span></span> bitwise_inner_prod_def bin_rep_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">H^<span class="hidden">⇩</span><sub>⊗</sub></span> <span class="main">1</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span><span class="main">/</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span>"</span></span> 
       <span class="keyword1"><span class="command">using</span></span> bitwise_inner_prod_def bin_rep_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">H^<span class="hidden">⇩</span><sub>⊗</sub></span> <span class="main">1</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span><span class="main">/</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span>"</span></span> 
       <span class="keyword1"><span class="command">using</span></span> bitwise_inner_prod_def bin_rep_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">H^<span class="hidden">⇩</span><sub>⊗</sub></span> <span class="main">1</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span><span class="main">1</span><span class="main">/</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span>"</span></span> 
       <span class="keyword1"><span class="command">using</span></span> bitwise_inner_prod_def bin_rep_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
     <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">H^<span class="hidden">⇩</span><sub>⊗</sub></span> <span class="main">1</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> H <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span> 
       <span class="keyword1"><span class="command">using</span></span> a0 a1 H_values H_values_right_bottom
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> H_without_scalar_prod One_nat_def dim_col_mat<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> dim_row_mat<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> 
divide_minus_left less_2_cases<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Deutsch_Jozsa-iter_tensor_of_H_rep_is_correct"><span class="command">lemma</span></span> iter_tensor_of_H_rep_is_correct<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">n</span><span class="main">::</span> <span class="quoted">nat</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≥</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>H ⊗<span class="hidden">⇗</span><sup><span class="free">n</span></sup><span class="hidden">⇖</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">H^<span class="hidden">⇩</span><sub>⊗</sub></span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span> nat_induct_at_least<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>H ⊗<span class="hidden">⇗</span><sup><span class="main">1</span></sup><span class="hidden">⇖</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">H^<span class="hidden">⇩</span><sub>⊗</sub></span> <span class="main">1</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> one_tensor_is_id one_tensor_of_H_is_H <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span><span class="main">::</span> <span class="quoted">nat</span>
  <span class="keyword3"><span class="command">assume</span></span> a0<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">≥</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> IH<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>H ⊗<span class="hidden">⇗</span><sup><span class="skolem">n</span></sup><span class="hidden">⇖</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">H^<span class="hidden">⇩</span><sub>⊗</sub></span> <span class="skolem">n</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>H ⊗<span class="hidden">⇗</span><sup><span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span></sup><span class="hidden">⇖</span><span class="main">)</span> <span class="main">=</span> H <span class="main">⨂</span> <span class="main">(</span>H ⊗<span class="hidden">⇗</span><sup><span class="skolem">n</span></sup><span class="hidden">⇖</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> iter_tensor_suc Nat.Suc_eq_plus1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> H <span class="main">⨂</span> <span class="main">(</span><span class="keyword1">H^<span class="hidden">⇩</span><sub>⊗</sub></span> <span class="skolem">n</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> IH <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="keyword1">H^<span class="hidden">⇩</span><sub>⊗</sub></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> a0 H_tensor_iter_tensor_of_H <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>H ⊗<span class="hidden">⇗</span><sup><span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span></sup><span class="hidden">⇖</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">H^<span class="hidden">⇩</span><sub>⊗</sub></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">"HId^<span class="hidden">⇩</span><sub>⊗</sub> 1"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is the result of taking the tensor product of the nth tensor of H and Id 1 ›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">tensor_of_H_tensor_Id</span><span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> complex Matrix.mat"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">HId^<span class="hidden">⇩</span><sub>⊗</sub></span> _"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">tensor_of_H_tensor_Id</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">≡</span> Matrix.mat <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span><span class="main">.</span>
  <span class="keyword1">if</span> <span class="main">(</span><span class="bound">i</span> <span class="keyword1">mod</span> <span class="numeral">2</span> <span class="main">=</span> <span class="bound">j</span> <span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">)</span> <span class="keyword1">then</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="main">(</span><span class="bound">i</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span> ⋅<span class="hidden">⇘</span><sub><span class="free"><span class="bound"><span class="entity">n</span></span></span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="bound">j</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">/</span><span class="main">(</span>sqrt <span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Deutsch_Jozsa-mod_2_is_both_even_or_odd"><span class="command">lemma</span></span> mod_2_is_both_even_or_odd<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>even <span class="free">i</span> <span class="main">∧</span> even <span class="free">j</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span>odd <span class="free">i</span> <span class="main">∧</span> odd <span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="free">i</span> <span class="keyword1">mod</span> <span class="numeral">2</span> <span class="main">=</span> <span class="free">j</span> <span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> even_iff_mod_2_eq_zero odd_iff_mod_2_eq_one<span class="main">)</span>
  
<span class="keyword1" id="Deutsch_Jozsa-HId_values"><span class="command">lemma</span></span> HId_values <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≥</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> dim_row <span class="main">(</span><span class="keyword1">HId^<span class="hidden">⇩</span><sub>⊗</sub></span> <span class="free">n</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">&lt;</span> dim_col <span class="main">(</span><span class="keyword1">HId^<span class="hidden">⇩</span><sub>⊗</sub></span> <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"even <span class="free">i</span> <span class="main">∧</span> even <span class="free">j</span> <span class="main">⟶</span> <span class="main">(</span><span class="keyword1">HId^<span class="hidden">⇩</span><sub>⊗</sub></span> <span class="free">n</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="free">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="main">(</span><span class="free">i</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span> ⋅<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="free">j</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">/</span><span class="main">(</span>sqrt <span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="free">n</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"odd <span class="free">i</span> <span class="main">∧</span> odd <span class="free">j</span> <span class="main">⟶</span> <span class="main">(</span><span class="keyword1">HId^<span class="hidden">⇩</span><sub>⊗</sub></span> <span class="free">n</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="free">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="main">(</span><span class="free">i</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span> ⋅<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="free">j</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">/</span><span class="main">(</span>sqrt <span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="free">n</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">i</span> <span class="keyword1">mod</span> <span class="numeral">2</span> <span class="main">=</span> <span class="free">j</span> <span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="keyword1">HId^<span class="hidden">⇩</span><sub>⊗</sub></span> <span class="free">n</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="free">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="main">(</span><span class="free">i</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span> ⋅<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="free">j</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">/</span><span class="main">(</span>sqrt <span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="free">n</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="free">i</span> <span class="keyword1">mod</span> <span class="numeral">2</span> <span class="main">=</span> <span class="free">j</span> <span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="keyword1">HId^<span class="hidden">⇩</span><sub>⊗</sub></span> <span class="free">n</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="free">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms mod_2_is_both_even_or_odd <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Deutsch_Jozsa-iter_tensor_of_H_tensor_Id_is_HId"><span class="command">lemma</span></span> iter_tensor_of_H_tensor_Id_is_HId<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">H^<span class="hidden">⇩</span><sub>⊗</sub></span> <span class="free">n</span><span class="main">)</span> <span class="main">⨂</span> Id <span class="main">1</span> <span class="main">=</span> <span class="keyword1">HId^<span class="hidden">⇩</span><sub>⊗</sub></span> <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_row <span class="main">(</span><span class="main">(</span><span class="keyword1">H^<span class="hidden">⇩</span><sub>⊗</sub></span> <span class="free">n</span><span class="main">)</span> <span class="main">⨂</span> Id <span class="main">1</span><span class="main">)</span> <span class="main">=</span> dim_row <span class="main">(</span><span class="keyword1">HId^<span class="hidden">⇩</span><sub>⊗</sub></span> <span class="free">n</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Quantum.Id_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_col <span class="main">(</span><span class="main">(</span><span class="keyword1">H^<span class="hidden">⇩</span><sub>⊗</sub></span> <span class="free">n</span><span class="main">)</span> <span class="main">⨂</span> Id <span class="main">1</span><span class="main">)</span> <span class="main">=</span> dim_col <span class="main">(</span><span class="keyword1">HId^<span class="hidden">⇩</span><sub>⊗</sub></span> <span class="free">n</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Quantum.Id_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span><span class="main">::</span> <span class="quoted">nat</span>
  <span class="keyword3"><span class="command">assume</span></span> a0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> dim_row <span class="main">(</span><span class="keyword1">HId^<span class="hidden">⇩</span><sub>⊗</sub></span> <span class="free">n</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> dim_col <span class="main">(</span><span class="keyword1">HId^<span class="hidden">⇩</span><sub>⊗</sub></span> <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> f0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">j</span> <span class="main">&lt;</span> <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> dim_row <span class="main">(</span><span class="keyword1">H^<span class="hidden">⇩</span><sub>⊗</sub></span> <span class="free">n</span><span class="main">)</span> <span class="main">*</span> dim_row <span class="main">(</span>Id <span class="main">1</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">j</span> <span class="main">&lt;</span> dim_col <span class="main">(</span><span class="keyword1">H^<span class="hidden">⇩</span><sub>⊗</sub></span> <span class="free">n</span><span class="main">)</span> <span class="main">*</span> dim_col <span class="main">(</span>Id <span class="main">1</span><span class="main">)</span>"</span></span>   
    <span class="keyword1"><span class="command">using</span></span> Id_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"dim_col <span class="main">(</span><span class="keyword1">H^<span class="hidden">⇩</span><sub>⊗</sub></span> <span class="free">n</span><span class="main">)</span> <span class="main">≥</span> <span class="main">0</span> <span class="main">∧</span> dim_col <span class="main">(</span>Id <span class="main">1</span><span class="main">)</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>  
    <span class="keyword1"><span class="command">using</span></span> Id_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> f1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="keyword1">H^<span class="hidden">⇩</span><sub>⊗</sub></span> <span class="free">n</span><span class="main">)</span> <span class="main">⨂</span> <span class="main">(</span>Id <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> 
    <span class="main">=</span> <span class="main">(</span><span class="keyword1">H^<span class="hidden">⇩</span><sub>⊗</sub></span> <span class="free">n</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span> <span class="keyword1">div</span> <span class="main">(</span>dim_row <span class="main">(</span>Id <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">,</span><span class="skolem">j</span> <span class="keyword1">div</span> <span class="main">(</span>dim_col <span class="main">(</span>Id <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> 
      <span class="main">(</span>Id <span class="main">1</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span> <span class="keyword1">mod</span> <span class="main">(</span>dim_row <span class="main">(</span>Id <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">,</span><span class="skolem">j</span> <span class="keyword1">mod</span> <span class="main">(</span>dim_col <span class="main">(</span>Id <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Quantum.Id_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="keyword1">H^<span class="hidden">⇩</span><sub>⊗</sub></span> <span class="free">n</span><span class="main">)</span><span class="main">⨂</span>Id <span class="main">1</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">HId^<span class="hidden">⇩</span><sub>⊗</sub></span> <span class="free">n</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> disjE<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">i</span> <span class="keyword1">mod</span> <span class="numeral">2</span> <span class="main">=</span> <span class="skolem">j</span> <span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">∨</span> <span class="main">¬</span> <span class="main">(</span><span class="skolem">i</span> <span class="keyword1">mod</span> <span class="numeral">2</span> <span class="main">=</span> <span class="skolem">j</span> <span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">i</span> <span class="keyword1">mod</span> <span class="numeral">2</span> <span class="main">=</span> <span class="skolem">j</span> <span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Id <span class="main">1</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span> <span class="keyword1">mod</span> <span class="main">(</span>dim_row <span class="main">(</span>Id <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">,</span><span class="skolem">j</span> <span class="keyword1">mod</span> <span class="main">(</span>dim_col <span class="main">(</span>Id <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Quantum.Id_def<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">H^<span class="hidden">⇩</span><sub>⊗</sub></span> <span class="free">n</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span> <span class="keyword1">div</span> <span class="main">(</span>dim_row <span class="main">(</span>Id <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> <span class="skolem">j</span> <span class="keyword1">div</span> <span class="main">(</span>dim_col <span class="main">(</span>Id <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                    <span class="main">=</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="main">(</span><span class="skolem">i</span> <span class="keyword1">div</span> <span class="main">(</span>dim_row <span class="main">(</span>Id <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> ⋅<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="skolem">j</span> <span class="keyword1">div</span> <span class="main">(</span>dim_col <span class="main">(</span>Id <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">/</span><span class="main">(</span>sqrt <span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="free">n</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> tensor_of_H_values Id_def f0 less_mult_imp_div_less <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="keyword1">H^<span class="hidden">⇩</span><sub>⊗</sub></span> <span class="free">n</span><span class="main">)</span> <span class="main">⨂</span> Id <span class="main">1</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">HId^<span class="hidden">⇩</span><sub>⊗</sub></span> <span class="free">n</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> a2 f0 f1 Id_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="skolem">i</span> <span class="keyword1">mod</span> <span class="numeral">2</span> <span class="main">=</span> <span class="skolem">j</span> <span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Id <span class="main">1</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span> <span class="keyword1">mod</span> <span class="main">(</span>dim_row <span class="main">(</span>Id <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">,</span><span class="skolem">j</span> <span class="keyword1">mod</span> <span class="main">(</span>dim_col <span class="main">(</span>Id <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Quantum.Id_def<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="keyword1">H^<span class="hidden">⇩</span><sub>⊗</sub></span> <span class="free">n</span><span class="main">)</span> <span class="main">⨂</span> Id <span class="main">1</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">HId^<span class="hidden">⇩</span><sub>⊗</sub></span> <span class="free">n</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> a2 f0 f1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Deutsch_Jozsa-HId_is_gate"><span class="command">lemma</span></span> HId_is_gate<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≥</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"gate <span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">HId^<span class="hidden">⇩</span><sub>⊗</sub></span> <span class="free">n</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span> 
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">HId^<span class="hidden">⇩</span><sub>⊗</sub></span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">H^<span class="hidden">⇩</span><sub>⊗</sub></span> <span class="free">n</span><span class="main">)</span> <span class="main">⨂</span> Id <span class="main">1</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> iter_tensor_of_H_tensor_Id_is_HId <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"gate <span class="main">1</span> <span class="main">(</span>Id <span class="main">1</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> id_is_gate <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"gate <span class="free">n</span> <span class="main">(</span><span class="keyword1">H^<span class="hidden">⇩</span><sub>⊗</sub></span> <span class="free">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> H_is_gate iter_tensor_of_gate_is_gate<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span> <span class="quoted">H</span> <span class="quoted"><span class="free">n</span></span><span class="main">]</span> assms <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iter_tensor_of_H_rep_is_correct<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"gate <span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">HId^<span class="hidden">⇩</span><sub>⊗</sub></span> <span class="free">n</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> tensor_gate <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹State <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">ψ<span class="hidden">⇩</span><sub>3</sub></span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is obtained by the multiplication of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="keyword1">HId^<span class="hidden">⇩</span><sub>⊗</sub></span></span> <span class="free"><span class="free">n</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">ψ<span class="hidden">⇩</span><sub>2</sub></span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> jozsa<span class="main">)</span> <span class="entity">ψ<span class="hidden">⇩</span><sub>3</sub></span><span class="main">::</span> <span class="quoted"><span class="quoted">"complex Matrix.mat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">ψ<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">≡</span> Matrix.mat <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">1</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span><span class="main">.</span> 
<span class="keyword1">if</span> even <span class="bound">i</span> 
  <span class="keyword1">then</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">f</span><span class="main">(</span><span class="bound">k</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">(</span><span class="bound">i</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span> ⋅<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span><span class="main">/</span><span class="main">(</span><span class="main">(</span>sqrt <span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="free">n</span> <span class="main">*</span> <span class="main">(</span>sqrt <span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
    <span class="keyword1">else</span>  <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">f</span><span class="main">(</span><span class="bound">k</span><span class="main">)</span><span class="main">+</span> <span class="main">1</span> <span class="main">+</span> <span class="main">(</span><span class="main">(</span><span class="bound">i</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span> ⋅<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span><span class="main">(</span><span class="main">(</span>sqrt <span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="free">n</span> <span class="main">*</span> <span class="main">(</span>sqrt <span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> jozsa<span class="main">)</span> ψ<span class="hidden">⇩</span><sub>3</sub>_values<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> dim_row ψ<span class="hidden">⇩</span><sub>3</sub>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"odd <span class="free">i</span> <span class="main">⟶</span> ψ<span class="hidden">⇩</span><sub>3</sub> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">f</span><span class="main">(</span><span class="bound">k</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span> <span class="main">+</span> <span class="main">(</span><span class="main">(</span><span class="free">i</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span> ⋅<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span><span class="main">/</span><span class="main">(</span><span class="main">(</span>sqrt <span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="free">n</span> <span class="main">*</span> <span class="main">(</span>sqrt <span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> jozsa<span class="main">)</span> ψ<span class="hidden">⇩</span><sub>3</sub>_dim <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">&lt;</span> dim_row ψ<span class="hidden">⇩</span><sub>3</sub>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> dim_row_mat<span class="main">(</span>1<span class="main">)</span> nat_neq_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="Deutsch_Jozsa-sum_every_odd_summand_is_zero"><span class="command">lemma</span></span> sum_every_odd_summand_is_zero<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">n</span><span class="main">::</span> <span class="quoted">nat</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≥</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">f</span><span class="main">::</span><span class="main">(</span>nat <span class="main">⇒</span> complex<span class="main">)</span><span class="main">.</span><span class="main">(</span><span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span><span class="main">&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">∧</span> odd <span class="bound">i</span> <span class="main">⟶</span> <span class="bound">f</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">⟶</span> 
            <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">}</span><span class="main">.</span> <span class="bound">f</span> <span class="bound">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">}</span><span class="main">.</span> <span class="bound">f</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="bound">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span> nat_induct_at_least<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">f</span><span class="main">::</span><span class="main">(</span>nat <span class="main">⇒</span> complex<span class="main">)</span><span class="main">.</span><span class="main">(</span><span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span><span class="main">&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="main">1</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">∧</span> odd <span class="bound">i</span> <span class="main">⟶</span> <span class="bound">f</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">⟶</span>
            <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="main">1</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">}</span><span class="main">.</span> <span class="bound">f</span> <span class="bound">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> <span class="bound">f</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="bound">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span> allI<span class="main"><span class="keyword3">,</span></span><span class="operator">rule</span> impI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>nat <span class="main">⇒</span> complex<span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> asm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span><span class="main">&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="main">1</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">∧</span> odd <span class="bound">i</span> <span class="main">⟶</span> <span class="skolem">f</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="numeral">4</span><span class="main">}</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">k</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">f</span> <span class="main">0</span> <span class="main">+</span> <span class="skolem">f</span> <span class="main">1</span> <span class="main">+</span> <span class="skolem">f</span> <span class="numeral">2</span> <span class="main">+</span> <span class="skolem">f</span> <span class="numeral">3</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add.commute add.left_commute<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">1</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> asm <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="numeral">3</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> asm <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> <span class="skolem">f</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">f</span> <span class="main">0</span> <span class="main">+</span> <span class="skolem">f</span> <span class="numeral">2</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> add.commute add.left_commute <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="main">1</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">}</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> <span class="skolem">f</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="bound">k</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span><span class="main">::</span> <span class="quoted">nat</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">≥</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> IH<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">f</span><span class="main">::</span><span class="main">(</span>nat <span class="main">⇒</span>complex<span class="main">)</span><span class="main">.</span><span class="main">(</span><span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span><span class="main">&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="skolem">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">∧</span> odd <span class="bound">i</span> <span class="main">⟶</span> <span class="bound">f</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">⟶</span>
<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="skolem">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">}</span><span class="main">.</span> <span class="bound">f</span> <span class="bound">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">n</span><span class="main">}</span><span class="main">.</span> <span class="bound">f</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="bound">k</span><span class="main">)</span><span class="main">)</span>"</span></span> 
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">f</span><span class="main">::</span><span class="main">(</span>nat <span class="main">⇒</span>complex<span class="main">)</span><span class="main">.</span><span class="main">(</span><span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span><span class="main">&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span>Suc <span class="skolem">n</span> <span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">∧</span> odd <span class="bound">i</span> <span class="main">⟶</span> <span class="bound">f</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">⟶</span>
<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span>Suc <span class="skolem">n</span> <span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">}</span><span class="main">.</span> <span class="bound">f</span> <span class="bound">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">}</span><span class="main">.</span> <span class="bound">f</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="bound">k</span><span class="main">)</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> allI<span class="main"><span class="keyword3">,</span></span><span class="operator">rule</span> impI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span><span class="main">::</span><span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> complex"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> asm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span><span class="main">&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span>Suc <span class="skolem">n</span> <span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">∧</span> odd <span class="bound">i</span> <span class="main">⟶</span> <span class="skolem">f</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> f0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="skolem">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">}</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">n</span><span class="main">}</span><span class="main">.</span> <span class="skolem">f</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="bound">k</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> asm IH <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> f1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="skolem">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">f</span> <span class="main">(</span><span class="bound">x</span><span class="main">+</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="skolem">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="bound">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span> <span class="numeral">2</span><span class="main">^</span><span class="skolem">n</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">f</span> <span class="main">(</span><span class="bound">x</span><span class="main">+</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="skolem">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="bound">k</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> asm IH <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="skolem">n</span><span class="main">+</span><span class="numeral">2</span><span class="main">)</span><span class="main">}</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="skolem">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">}</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">k</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="main">{</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="skolem">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">..&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="skolem">n</span><span class="main">+</span><span class="numeral">2</span><span class="main">)</span><span class="main">}</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">k</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum.atLeastLessThan_concat<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">n</span><span class="main">}</span><span class="main">.</span> <span class="skolem">f</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="main">{</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="skolem">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">..&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="skolem">n</span><span class="main">+</span><span class="numeral">2</span><span class="main">)</span><span class="main">}</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">k</span><span class="main">)</span>"</span></span>  
      <span class="keyword1"><span class="command">using</span></span> f0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">n</span><span class="main">}</span><span class="main">.</span> <span class="skolem">f</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="skolem">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">}</span><span class="main">.</span> <span class="skolem">f</span> <span class="main">(</span><span class="bound">k</span><span class="main">+</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="skolem">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>  
      <span class="keyword1"><span class="command">using</span></span> sum.shift_bounds_nat_ivl<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="skolem">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="skolem">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">n</span><span class="main">}</span><span class="main">.</span> <span class="skolem">f</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span> <span class="numeral">2</span><span class="main">^</span><span class="skolem">n</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">f</span> <span class="main">(</span><span class="bound">x</span><span class="main">+</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="skolem">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="bound">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> f1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">n</span><span class="main">}</span><span class="main">.</span> <span class="skolem">f</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="main">{</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">n</span><span class="main">..&lt;</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="skolem">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">}</span><span class="main">.</span> <span class="skolem">f</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span><span class="bound">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> sum.shift_bounds_nat_ivl<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="skolem">f</span><span class="main">::</span>nat<span class="main">⇒</span>complex<span class="main">)</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="main">(</span><span class="bound">x</span><span class="main">-</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">n</span><span class="main">)</span><span class="main">+</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="skolem">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span><span class="main">^</span><span class="skolem">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span><span class="main">^</span><span class="skolem">n</span>"</span></span><span class="main">]</span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_2<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="skolem">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">}</span><span class="main">.</span> <span class="skolem">f</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="bound">k</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc_eq_plus1 lessI less_imp_le_nat one_le_numeral power_increasing sum.atLeastLessThan_concat zero_le<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">}</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">}</span><span class="main">.</span> <span class="skolem">f</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="bound">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc_eq_plus1 add_2_eq_Suc'<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Deutsch_Jozsa-sum_every_even_summand_is_zero"><span class="command">lemma</span></span> sum_every_even_summand_is_zero<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">n</span><span class="main">::</span> <span class="quoted">nat</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≥</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">f</span><span class="main">::</span><span class="main">(</span>nat <span class="main">⇒</span> complex<span class="main">)</span><span class="main">.</span><span class="main">(</span><span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span><span class="main">&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">∧</span> even <span class="bound">i</span> <span class="main">⟶</span> <span class="bound">f</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">⟶</span> 
            <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">}</span><span class="main">.</span> <span class="bound">f</span> <span class="bound">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">}</span><span class="main">.</span> <span class="bound">f</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="bound">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span> nat_induct_at_least<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">f</span><span class="main">::</span><span class="main">(</span>nat <span class="main">⇒</span> complex<span class="main">)</span><span class="main">.</span><span class="main">(</span><span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span><span class="main">&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="main">1</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">∧</span> even <span class="bound">i</span> <span class="main">⟶</span> <span class="bound">f</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">⟶</span> 
            <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="main">1</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">}</span><span class="main">.</span> <span class="bound">f</span> <span class="bound">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span> <span class="numeral">2</span><span class="main">^</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> <span class="bound">f</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="bound">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span> allI<span class="main"><span class="keyword3">,</span></span><span class="operator">rule</span> impI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span><span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span>complex"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> asm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span><span class="main">&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="main">1</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">∧</span> even <span class="bound">i</span> <span class="main">⟶</span> <span class="skolem">f</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="numeral">4</span><span class="main">}</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">k</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">f</span> <span class="main">0</span> <span class="main">+</span> <span class="skolem">f</span> <span class="main">1</span> <span class="main">+</span> <span class="skolem">f</span> <span class="numeral">2</span> <span class="main">+</span> <span class="skolem">f</span> <span class="numeral">3</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add.commute add.left_commute<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> asm <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="numeral">2</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> asm <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span> <span class="numeral">2</span><span class="main">^</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> <span class="skolem">f</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="bound">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">f</span> <span class="main">1</span> <span class="main">+</span> <span class="skolem">f</span> <span class="numeral">3</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> add.commute add.left_commute <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="main">1</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">}</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span> <span class="numeral">2</span><span class="main">^</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> <span class="skolem">f</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="bound">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span><span class="main">::</span> <span class="quoted">nat</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">≥</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> IH<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">f</span><span class="main">::</span><span class="main">(</span>nat <span class="main">⇒</span>complex<span class="main">)</span><span class="main">.</span><span class="main">(</span><span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span><span class="main">&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="skolem">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">∧</span> even <span class="bound">i</span> <span class="main">⟶</span> <span class="bound">f</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">⟶</span>
<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="skolem">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">}</span><span class="main">.</span> <span class="bound">f</span> <span class="bound">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span> <span class="numeral">2</span><span class="main">^</span><span class="skolem">n</span><span class="main">}</span><span class="main">.</span> <span class="bound">f</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="bound">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span> 
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">f</span><span class="main">::</span><span class="main">(</span>nat <span class="main">⇒</span>complex<span class="main">)</span><span class="main">.</span><span class="main">(</span><span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span><span class="main">&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">∧</span> even <span class="bound">i</span> <span class="main">⟶</span> <span class="bound">f</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">⟶</span>
<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">}</span><span class="main">.</span> <span class="bound">f</span> <span class="bound">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">}</span><span class="main">.</span> <span class="bound">f</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="bound">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> allI<span class="main"><span class="keyword3">,</span></span><span class="operator">rule</span> impI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span><span class="main">::</span><span class="quoted"><span class="quoted">"nat <span class="main">⇒</span>complex"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> asm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span><span class="main">&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">∧</span> even <span class="bound">i</span> <span class="main">⟶</span> <span class="skolem">f</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> f0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span> <span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="skolem">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">}</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span> <span class="numeral">2</span><span class="main">^</span><span class="skolem">n</span><span class="main">}</span><span class="main">.</span> <span class="skolem">f</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="bound">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> asm IH <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> f1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="skolem">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">f</span> <span class="main">(</span><span class="bound">x</span><span class="main">+</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="skolem">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="bound">k</span><span class="main">)</span> 
              <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span> <span class="numeral">2</span><span class="main">^</span><span class="skolem">n</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">f</span> <span class="main">(</span><span class="bound">x</span><span class="main">+</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="skolem">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="bound">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> asm IH <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="skolem">n</span><span class="main">+</span><span class="numeral">2</span><span class="main">)</span><span class="main">}</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">k</span><span class="main">)</span> 
               <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="skolem">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">}</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">k</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="main">{</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="skolem">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">..&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="skolem">n</span><span class="main">+</span><span class="numeral">2</span><span class="main">)</span><span class="main">}</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">k</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum.atLeastLessThan_concat<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span> <span class="numeral">2</span><span class="main">^</span><span class="skolem">n</span><span class="main">}</span><span class="main">.</span> <span class="skolem">f</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="bound">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="main">{</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="skolem">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">..&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="skolem">n</span><span class="main">+</span><span class="numeral">2</span><span class="main">)</span><span class="main">}</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">k</span><span class="main">)</span>"</span></span>  
      <span class="keyword1"><span class="command">using</span></span> f0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span> <span class="numeral">2</span><span class="main">^</span><span class="skolem">n</span><span class="main">}</span><span class="main">.</span> <span class="skolem">f</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="bound">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="skolem">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">}</span><span class="main">.</span> <span class="skolem">f</span> <span class="main">(</span><span class="bound">k</span><span class="main">+</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="skolem">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>  
      <span class="keyword1"><span class="command">using</span></span> sum.shift_bounds_nat_ivl<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="skolem">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="skolem">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span> <span class="numeral">2</span><span class="main">^</span><span class="skolem">n</span><span class="main">}</span><span class="main">.</span> <span class="skolem">f</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="bound">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span> <span class="numeral">2</span><span class="main">^</span><span class="skolem">n</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">f</span> <span class="main">(</span><span class="bound">x</span><span class="main">+</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="skolem">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="bound">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> f1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span> <span class="numeral">2</span><span class="main">^</span><span class="skolem">n</span><span class="main">}</span><span class="main">.</span> <span class="skolem">f</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="bound">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="main">{</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">n</span><span class="main">..&lt;</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="skolem">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">}</span><span class="main">.</span> <span class="skolem">f</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span><span class="bound">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> sum.shift_bounds_nat_ivl<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="skolem">f</span><span class="main">::</span>nat<span class="main">⇒</span>complex<span class="main">)</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="main">(</span><span class="bound">x</span><span class="main">-</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">n</span><span class="main">)</span><span class="main">+</span><span class="main">1</span><span class="main">+</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="skolem">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span><span class="main">^</span><span class="skolem">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span><span class="main">^</span><span class="skolem">n</span>"</span></span><span class="main">]</span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_2<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="skolem">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">}</span><span class="main">.</span> <span class="skolem">f</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="bound">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc_eq_plus1 lessI less_imp_le_nat one_le_numeral power_increasing sum.atLeastLessThan_concat zero_le<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">}</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">}</span><span class="main">.</span> <span class="skolem">f</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="bound">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc_eq_plus1 add_2_eq_Suc'<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> jozsa<span class="main">)</span> iter_tensor_of_H_times_ψ<span class="hidden">⇩</span><sub>2</sub>_is_ψ<span class="hidden">⇩</span><sub>3</sub><span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="keyword1">H^<span class="hidden">⇩</span><sub>⊗</sub></span> <span class="free">n</span><span class="main">)</span> <span class="main">⨂</span> Id <span class="main">1</span><span class="main">)</span> <span class="main">*</span> ψ<span class="hidden">⇩</span><sub>2</sub> <span class="main">=</span> ψ<span class="hidden">⇩</span><sub>3</sub>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span>
  <span class="keyword3"><span class="command">assume</span></span> a0<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> dim_row ψ<span class="hidden">⇩</span><sub>3</sub>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> dim_col ψ<span class="hidden">⇩</span><sub>3</sub>"</span></span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> f0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">j</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> f1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="keyword1">HId^<span class="hidden">⇩</span><sub>⊗</sub></span> <span class="free">n</span><span class="main">)</span><span class="main">*</span> ψ<span class="hidden">⇩</span><sub>2</sub><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">&lt;</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">HId^<span class="hidden">⇩</span><sub>⊗</sub></span> <span class="free">n</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>ψ<span class="hidden">⇩</span><sub>2</sub> <span class="main">$$</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> a1 f0 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> atLeast0LessThan<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="keyword1">H^<span class="hidden">⇩</span><sub>⊗</sub></span> <span class="free">n</span><span class="main">)</span> <span class="main">⨂</span> Id <span class="main">1</span><span class="main">)</span> <span class="main">*</span> ψ<span class="hidden">⇩</span><sub>2</sub><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> ψ<span class="hidden">⇩</span><sub>3</sub> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span> disjE<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"even <span class="skolem">i</span> <span class="main">∨</span> odd <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a2<span class="main">:</span> <span class="quoted"><span class="quoted">"even <span class="skolem">i</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">¬</span><span class="main">(</span><span class="skolem">i</span> <span class="keyword1">mod</span> <span class="numeral">2</span> <span class="main">=</span> <span class="skolem">k</span> <span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">k</span><span class="main">&lt;</span>dim_col <span class="main">(</span><span class="keyword1">HId^<span class="hidden">⇩</span><sub>⊗</sub></span> <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">HId^<span class="hidden">⇩</span><sub>⊗</sub></span> <span class="free">n</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>ψ<span class="hidden">⇩</span><sub>2</sub> <span class="main">$$</span> <span class="main">(</span><span class="skolem">k</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span> 
      <span class="keyword1"><span class="command">using</span></span> f0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span><span class="main">&lt;</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> odd <span class="skolem">k</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">HId^<span class="hidden">⇩</span><sub>⊗</sub></span> <span class="free">n</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>ψ<span class="hidden">⇩</span><sub>2</sub> <span class="main">$$</span> <span class="main">(</span><span class="skolem">k</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span> 
      <span class="keyword1"><span class="command">using</span></span> a2 mod_2_is_both_even_or_odd f0 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> dim_col_mat<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="main">{</span><span class="main">(</span><span class="main">0</span><span class="main">::</span>nat<span class="main">)</span><span class="main">..&lt;</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">HId^<span class="hidden">⇩</span><sub>⊗</sub></span> <span class="free">n</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>ψ<span class="hidden">⇩</span><sub>2</sub> <span class="main">$$</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
             <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="main">{</span><span class="main">(</span><span class="main">0</span><span class="main">::</span>nat<span class="main">)</span><span class="main">..&lt;</span> <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">)</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">HId^<span class="hidden">⇩</span><sub>⊗</sub></span> <span class="free">n</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="numeral">2</span><span class="main">*</span><span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>ψ<span class="hidden">⇩</span><sub>2</sub> <span class="main">$$</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="bound">k</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> sum_every_odd_summand_is_zero dim <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">HId^<span class="hidden">⇩</span><sub>⊗</sub></span> <span class="free">n</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="numeral">2</span><span class="main">*</span><span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>ψ<span class="hidden">⇩</span><sub>2</sub> <span class="main">$$</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="bound">k</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                 <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">.</span><span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="main">(</span><span class="skolem">i</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span> ⋅<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span> <span class="bound">k</span><span class="main">)</span><span class="main">/</span><span class="main">(</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="free">n</span><span class="main">)</span> <span class="main">*</span><span class="main">(</span><span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="free">f</span><span class="main">(</span><span class="bound">k</span><span class="main">)</span><span class="main">)</span><span class="main">/</span><span class="main">(</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>even <span class="skolem">k</span> <span class="main">∧</span> <span class="skolem">k</span><span class="main">&lt;</span>dim_row ψ<span class="hidden">⇩</span><sub>2</sub><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span>ψ<span class="hidden">⇩</span><sub>2</sub> <span class="main">$$</span> <span class="main">(</span><span class="skolem">k</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="free">f</span><span class="main">(</span><span class="skolem">k</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">/</span><span class="main">(</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span> 
          <span class="keyword1"><span class="command">using</span></span> a0 a1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">HId^<span class="hidden">⇩</span><sub>⊗</sub></span> <span class="free">n</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="numeral">2</span><span class="main">*</span><span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>ψ<span class="hidden">⇩</span><sub>2</sub> <span class="main">$$</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="bound">k</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
               <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">HId^<span class="hidden">⇩</span><sub>⊗</sub></span> <span class="free">n</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="numeral">2</span><span class="main">*</span><span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span><span class="main">(</span><span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="free">f</span><span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="bound">k</span><span class="main">)</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">/</span><span class="main">(</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>even <span class="skolem">k</span> <span class="main">∧</span> <span class="skolem">k</span><span class="main">&lt;</span>dim_col <span class="main">(</span><span class="keyword1">HId^<span class="hidden">⇩</span><sub>⊗</sub></span> <span class="free">n</span><span class="main">)</span><span class="main">)</span>
                 <span class="main">⟶</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">HId^<span class="hidden">⇩</span><sub>⊗</sub></span> <span class="free">n</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span> <span class="main">(</span><span class="main">(</span><span class="skolem">i</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span> ⋅<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="skolem">k</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">/</span><span class="main">(</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="free">n</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span>
        <span class="keyword1"><span class="command">using</span></span> a2 a0 a1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">HId^<span class="hidden">⇩</span><sub>⊗</sub></span> <span class="free">n</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="numeral">2</span><span class="main">*</span><span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>ψ<span class="hidden">⇩</span><sub>2</sub> <span class="main">$$</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="bound">k</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                     <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="main">(</span><span class="skolem">i</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span> ⋅<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span>  <span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="bound">k</span><span class="main">)</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">/</span><span class="main">(</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="free">n</span><span class="main">)</span> <span class="main">*</span> 
                                   <span class="main">(</span><span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="free">f</span><span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="bound">k</span><span class="main">)</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">/</span><span class="main">(</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">HId^<span class="hidden">⇩</span><sub>⊗</sub></span> <span class="free">n</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="numeral">2</span><span class="main">*</span><span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>ψ<span class="hidden">⇩</span><sub>2</sub> <span class="main">$$</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="bound">k</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
               <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="main">(</span><span class="skolem">i</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span> ⋅<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span>  <span class="bound">k</span><span class="main">)</span><span class="main">/</span><span class="main">(</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="free">n</span><span class="main">)</span> <span class="main">*</span><span class="main">(</span><span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="free">f</span><span class="main">(</span><span class="bound">k</span><span class="main">)</span><span class="main">)</span><span class="main">/</span><span class="main">(</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="keyword1">HId^<span class="hidden">⇩</span><sub>⊗</sub></span> <span class="free">n</span><span class="main">)</span><span class="main">*</span> ψ<span class="hidden">⇩</span><sub>2</sub><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="main">(</span><span class="skolem">i</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span> ⋅<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span> <span class="bound">k</span><span class="main">)</span><span class="main">/</span><span class="main">(</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="free">n</span><span class="main">)</span> 
                                                        <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="free">f</span><span class="main">(</span><span class="bound">k</span><span class="main">)</span><span class="main">)</span><span class="main">/</span><span class="main">(</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> f1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> atLeast0LessThan<span class="main">)</span> 
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span>  <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">f</span><span class="main">(</span><span class="bound">k</span><span class="main">)</span><span class="main">+</span><span class="main">(</span><span class="main">(</span><span class="skolem">i</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span> ⋅<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span><span class="main">/</span><span class="main">(</span><span class="main">(</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="free">n</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power_add mult.commute<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="keyword1">HId^<span class="hidden">⇩</span><sub>⊗</sub></span> <span class="free">n</span><span class="main">)</span><span class="main">*</span> ψ<span class="hidden">⇩</span><sub>2</sub><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">f</span><span class="main">(</span><span class="bound">k</span><span class="main">)</span><span class="main">+</span><span class="main">(</span><span class="main">(</span><span class="skolem">i</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span> ⋅<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span><span class="main">/</span><span class="main">(</span><span class="main">(</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="free">n</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
       <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ψ<span class="hidden">⇩</span><sub>3</sub> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">f</span><span class="main">(</span><span class="bound">k</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">(</span><span class="skolem">i</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span> ⋅<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span><span class="main">/</span><span class="main">(</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="free">n</span> <span class="main">*</span> sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> a0 a1 a2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="keyword1">H^<span class="hidden">⇩</span><sub>⊗</sub></span> <span class="free">n</span><span class="main">)</span> <span class="main">⨂</span> Id <span class="main">1</span><span class="main">)</span><span class="main">*</span> ψ<span class="hidden">⇩</span><sub>2</sub><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> ψ<span class="hidden">⇩</span><sub>3</sub> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> iter_tensor_of_H_tensor_Id_is_HId dim <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a2<span class="main">:</span> <span class="quoted"><span class="quoted">"odd <span class="skolem">i</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">¬</span><span class="main">(</span><span class="skolem">i</span> <span class="keyword1">mod</span> <span class="numeral">2</span> <span class="main">=</span> <span class="skolem">k</span> <span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">k</span><span class="main">&lt;</span>dim_col <span class="main">(</span><span class="keyword1">HId^<span class="hidden">⇩</span><sub>⊗</sub></span> <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">HId^<span class="hidden">⇩</span><sub>⊗</sub></span> <span class="free">n</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>ψ<span class="hidden">⇩</span><sub>2</sub> <span class="main">$$</span> <span class="main">(</span><span class="skolem">k</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span> 
      <span class="keyword1"><span class="command">using</span></span> f0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span><span class="main">&lt;</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> even <span class="skolem">k</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">HId^<span class="hidden">⇩</span><sub>⊗</sub></span> <span class="free">n</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>ψ<span class="hidden">⇩</span><sub>2</sub> <span class="main">$$</span> <span class="main">(</span><span class="skolem">k</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span> 
      <span class="keyword1"><span class="command">using</span></span> a2 mod_2_is_both_even_or_odd f0 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> dim_col_mat<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">HId^<span class="hidden">⇩</span><sub>⊗</sub></span> <span class="free">n</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>ψ<span class="hidden">⇩</span><sub>2</sub> <span class="main">$$</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
             <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">HId^<span class="hidden">⇩</span><sub>⊗</sub></span> <span class="free">n</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="numeral">2</span><span class="main">*</span><span class="bound">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>ψ<span class="hidden">⇩</span><sub>2</sub> <span class="main">$$</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="bound">k</span><span class="main">+</span><span class="main">1</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> sum_every_even_summand_is_zero dim <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">HId^<span class="hidden">⇩</span><sub>⊗</sub></span> <span class="free">n</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="numeral">2</span><span class="main">*</span><span class="bound">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>ψ<span class="hidden">⇩</span><sub>2</sub> <span class="main">$$</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="bound">k</span><span class="main">+</span><span class="main">1</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                 <span class="main">=</span> <span class="main">(</span><span class="main">∑</span> <span class="bound">k</span><span class="main">&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="main">(</span><span class="skolem">i</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span> ⋅<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span> <span class="bound">k</span><span class="main">)</span><span class="main">/</span><span class="main">(</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="free">n</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">f</span><span class="main">(</span><span class="bound">k</span><span class="main">)</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">/</span><span class="main">(</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>odd <span class="skolem">k</span> <span class="main">∧</span> <span class="skolem">k</span><span class="main">&lt;</span>dim_row ψ<span class="hidden">⇩</span><sub>2</sub><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span>ψ<span class="hidden">⇩</span><sub>2</sub> <span class="main">$$</span> <span class="main">(</span><span class="skolem">k</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">f</span><span class="main">(</span><span class="skolem">k</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">/</span><span class="main">(</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span> 
        <span class="keyword1"><span class="command">using</span></span> a0 a1 a2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> f2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">HId^<span class="hidden">⇩</span><sub>⊗</sub></span> <span class="free">n</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="numeral">2</span><span class="main">*</span><span class="bound">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>ψ<span class="hidden">⇩</span><sub>2</sub> <span class="main">$$</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="bound">k</span><span class="main">+</span><span class="main">1</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                  <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">HId^<span class="hidden">⇩</span><sub>⊗</sub></span> <span class="free">n</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="numeral">2</span><span class="main">*</span><span class="bound">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">f</span><span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="bound">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">/</span><span class="main">(</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> dim_row <span class="main">(</span><span class="keyword1">HId^<span class="hidden">⇩</span><sub>⊗</sub></span> <span class="free">n</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> f0 a2 mod_2_is_both_even_or_odd <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="skolem">i</span> <span class="keyword1">mod</span> <span class="numeral">2</span> <span class="main">=</span> <span class="skolem">k</span> <span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">k</span><span class="main">&lt;</span>dim_col <span class="main">(</span><span class="keyword1">HId^<span class="hidden">⇩</span><sub>⊗</sub></span> <span class="free">n</span><span class="main">)</span><span class="main">)</span>
                 <span class="main">⟶</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">HId^<span class="hidden">⇩</span><sub>⊗</sub></span> <span class="free">n</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="main">(</span><span class="skolem">i</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span> ⋅<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="skolem">k</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">/</span><span class="main">(</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="free">n</span><span class="main">)</span> "</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span>
        <span class="keyword1"><span class="command">using</span></span> a2 a0 a1 f0 dim HId_values <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"odd <span class="skolem">k</span> <span class="main">⟶</span> <span class="main">(</span><span class="skolem">i</span> <span class="keyword1">mod</span> <span class="numeral">2</span> <span class="main">=</span> <span class="skolem">k</span> <span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span> 
        <span class="keyword1"><span class="command">using</span></span> a2 mod_2_is_both_even_or_odd <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>odd <span class="skolem">k</span> <span class="main">∧</span> <span class="skolem">k</span><span class="main">&lt;</span>dim_col <span class="main">(</span><span class="keyword1">HId^<span class="hidden">⇩</span><sub>⊗</sub></span> <span class="free">n</span><span class="main">)</span><span class="main">)</span>
                 <span class="main">⟶</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">HId^<span class="hidden">⇩</span><sub>⊗</sub></span> <span class="free">n</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="main">(</span><span class="skolem">i</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span> ⋅<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="skolem">k</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">/</span><span class="main">(</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="free">n</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span><span class="main">&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="free">n</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">HId^<span class="hidden">⇩</span><sub>⊗</sub></span> <span class="free">n</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="numeral">2</span><span class="main">*</span><span class="skolem">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="main">(</span><span class="skolem">i</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span> ⋅<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="skolem">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">/</span><span class="main">(</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="free">n</span><span class="main">)</span> "</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">HId^<span class="hidden">⇩</span><sub>⊗</sub></span> <span class="free">n</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="numeral">2</span><span class="main">*</span><span class="bound">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>ψ<span class="hidden">⇩</span><sub>2</sub> <span class="main">$$</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="bound">k</span><span class="main">+</span><span class="main">1</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
               <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="main">(</span><span class="skolem">i</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span> ⋅<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="bound">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">/</span><span class="main">(</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="free">n</span><span class="main">)</span> 
                             <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">f</span><span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="bound">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">/</span><span class="main">(</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> f2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">HId^<span class="hidden">⇩</span><sub>⊗</sub></span> <span class="free">n</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="numeral">2</span><span class="main">*</span><span class="bound">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>ψ<span class="hidden">⇩</span><sub>2</sub> <span class="main">$$</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="bound">k</span><span class="main">+</span><span class="main">1</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
               <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="main">(</span><span class="skolem">i</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span> ⋅<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span> <span class="bound">k</span><span class="main">)</span><span class="main">/</span><span class="main">(</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="free">n</span><span class="main">)</span> <span class="main">*</span><span class="main">(</span><span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">f</span><span class="main">(</span><span class="bound">k</span><span class="main">)</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">/</span><span class="main">(</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="keyword1">HId^<span class="hidden">⇩</span><sub>⊗</sub></span> <span class="free">n</span><span class="main">)</span><span class="main">*</span> ψ<span class="hidden">⇩</span><sub>2</sub><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="main">(</span><span class="skolem">i</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span> ⋅<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span> <span class="bound">k</span><span class="main">)</span><span class="main">/</span><span class="main">(</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="free">n</span><span class="main">)</span> 
                <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">f</span><span class="main">(</span><span class="bound">k</span><span class="main">)</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">/</span><span class="main">(</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> f1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> atLeast0LessThan<span class="main">)</span> 
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">f</span><span class="main">(</span><span class="bound">k</span><span class="main">)</span><span class="main">+</span><span class="main">1</span><span class="main">+</span><span class="main">(</span><span class="main">(</span><span class="skolem">i</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span> ⋅<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span><span class="main">/</span><span class="main">(</span><span class="main">(</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="free">n</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult.commute power_add<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="keyword1">HId^<span class="hidden">⇩</span><sub>⊗</sub></span> <span class="free">n</span><span class="main">)</span><span class="main">*</span> ψ<span class="hidden">⇩</span><sub>2</sub><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> 
                <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">&lt;</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">f</span><span class="main">(</span><span class="bound">k</span><span class="main">)</span><span class="main">+</span><span class="main">1</span><span class="main">+</span><span class="main">(</span><span class="main">(</span><span class="skolem">i</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span> ⋅<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span><span class="main">/</span><span class="main">(</span><span class="main">(</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="free">n</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="keyword1">H^<span class="hidden">⇩</span><sub>⊗</sub></span> <span class="free">n</span><span class="main">)</span> <span class="main">⨂</span> Id <span class="main">1</span><span class="main">)</span><span class="main">*</span> ψ<span class="hidden">⇩</span><sub>2</sub><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> ψ<span class="hidden">⇩</span><sub>3</sub> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> iter_tensor_of_H_tensor_Id_is_HId dim a2 a0 a1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_row <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="keyword1">H^<span class="hidden">⇩</span><sub>⊗</sub></span> <span class="free">n</span><span class="main">)</span> <span class="main">⨂</span> Id <span class="main">1</span><span class="main">)</span> <span class="main">*</span> ψ<span class="hidden">⇩</span><sub>2</sub><span class="main">)</span> <span class="main">=</span> dim_row ψ<span class="hidden">⇩</span><sub>3</sub>"</span></span>  
    <span class="keyword1"><span class="command">using</span></span> iter_tensor_of_H_tensor_Id_is_HId dim <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_col <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="keyword1">H^<span class="hidden">⇩</span><sub>⊗</sub></span> <span class="free">n</span><span class="main">)</span> <span class="main">⨂</span> Id <span class="main">1</span><span class="main">)</span><span class="main">*</span> ψ<span class="hidden">⇩</span><sub>2</sub><span class="main">)</span> <span class="main">=</span> dim_col ψ<span class="hidden">⇩</span><sub>3</sub>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> iter_tensor_of_H_tensor_Id_is_HId dim <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> jozsa<span class="main">)</span> ψ<span class="hidden">⇩</span><sub>3</sub>_is_state<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"state <span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> ψ<span class="hidden">⇩</span><sub>3</sub>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="keyword1">H^<span class="hidden">⇩</span><sub>⊗</sub></span> <span class="free">n</span><span class="main">)</span> <span class="main">⨂</span> Id <span class="main">1</span><span class="main">)</span> <span class="main">*</span> ψ<span class="hidden">⇩</span><sub>2</sub> <span class="main">=</span> ψ<span class="hidden">⇩</span><sub>3</sub>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> iter_tensor_of_H_times_ψ<span class="hidden">⇩</span><sub>2</sub>_is_ψ<span class="hidden">⇩</span><sub>3</sub> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"gate <span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">H^<span class="hidden">⇩</span><sub>⊗</sub></span> <span class="free">n</span><span class="main">)</span> <span class="main">⨂</span> Id <span class="main">1</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> iter_tensor_of_H_tensor_Id_is_HId HId_is_gate dim <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"state <span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> ψ<span class="hidden">⇩</span><sub>2</sub>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> ψ<span class="hidden">⇩</span><sub>2</sub>_is_state <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"state <span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> ψ<span class="hidden">⇩</span><sub>3</sub>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> gate_on_state_is_state dim <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
Finally, all steps are put together. The result depends on the function f. If f is constant
the first n qubits are 0, if f is balanced there is at least one qubit in state 1 among the 
first n qubits. 
The algorithm only uses one evaluation of f(x) and will always succeed. 
›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> jozsa<span class="main">)</span> <span class="entity">jozsa_algo</span><span class="main">::</span> <span class="quoted"><span class="quoted">"complex Matrix.mat"</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
<span class="quoted"><span class="quoted">"<span class="free">jozsa_algo</span> <span class="main">≡</span> <span class="main">(</span><span class="main">(</span>H ⊗<span class="hidden">⇗</span><sup><span class="free">n</span></sup><span class="hidden">⇖</span><span class="main">)</span> <span class="main">⨂</span> Id <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">U<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span>H ⊗<span class="hidden">⇗</span><sup><span class="free">n</span></sup><span class="hidden">⇖</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span> <span class="main">|</span>zero<span class="main">⟩</span> ⊗<span class="hidden">⇗</span><sup><span class="free">n</span></sup><span class="hidden">⇖</span><span class="main">)</span><span class="main">)</span> <span class="main">⨂</span> <span class="main">(</span>H <span class="main">*</span> <span class="main">|</span>one<span class="main">⟩</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> jozsa<span class="main">)</span> jozsa_algo_result <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"jozsa_algo <span class="main">=</span> ψ<span class="hidden">⇩</span><sub>3</sub>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> jozsa_algo_def H_on_ket_one_is_ψ<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>1</sub> iter_tensor_of_H_on_zero_tensor ψ<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>0</sub>_tensor_ψ<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>1</sub>_is_ψ<span class="hidden">⇩</span><sub>1</sub>
  jozsa_transform_times_ψ<span class="hidden">⇩</span><sub>1</sub>_is_ψ<span class="hidden">⇩</span><sub>2</sub> iter_tensor_of_H_times_ψ<span class="hidden">⇩</span><sub>2</sub>_is_ψ<span class="hidden">⇩</span><sub>3</sub> dim iter_tensor_of_H_rep_is_correct 
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> jozsa<span class="main">)</span> jozsa_algo_result_is_state<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"state <span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> jozsa_algo"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> ψ<span class="hidden">⇩</span><sub>3</sub>_is_state <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> jozsa<span class="main">)</span> prob0_fst_qubits_of_jozsa_algo<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>prob0_fst_qubits <span class="free">n</span> jozsa_algo<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span>cmod<span class="main">(</span>jozsa_algo <span class="main">$$</span> <span class="main">(</span><span class="bound">j</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> prob0_fst_qubits_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹General lemmata required to compute probabilities.›</span></span>

<span class="keyword1" id="Deutsch_Jozsa-aux_comp_with_sqrt2"><span class="command">lemma</span></span> aux_comp_with_sqrt2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>sqrt <span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="free">n</span> <span class="main">*</span> <span class="main">(</span>sqrt <span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="free">n</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> power_mult_distrib real_sqrt_mult_self<span class="main">)</span>

<span class="keyword1" id="Deutsch_Jozsa-aux_comp_with_sqrt2_bis"><span class="command">lemma</span></span> aux_comp_with_sqrt2_bis <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">/</span><span class="main">(</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="free">n</span> <span class="main">*</span> sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span><span class="main">/</span>sqrt <span class="numeral">2</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> aux_comp_with_sqrt2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult.left_commute<span class="main">)</span>

<span class="keyword1" id="Deutsch_Jozsa-aux_ineq_with_card"><span class="command">lemma</span></span> aux_ineq_with_card<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">g</span><span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> nat"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">A</span><span class="main">::</span> <span class="quoted"><span class="quoted">"nat set"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">g</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> card <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">g</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="main">≥</span> <span class="main">-</span>card <span class="free">A</span>"</span></span> 
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">smt</span> assms neg_one_even_power neg_one_odd_power card_eq_sum of_nat_1 of_nat_sum sum_mono<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">smt</span> assms neg_one_even_power neg_one_odd_power card_eq_sum of_nat_1 of_nat_sum sum_mono sum_negf<span class="main">)</span><span class="keyword1"><span class="command">.</span></span>

<span class="keyword1" id="Deutsch_Jozsa-aux_comp_with_cmod"><span class="command">lemma</span></span> aux_comp_with_cmod<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">g</span><span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> nat"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">x</span></span><span class="main">&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">.</span> <span class="free">g</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">x</span></span><span class="main">&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">.</span> <span class="free">g</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>cmod <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">g</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>  <span class="main">=</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">n</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span> disjE<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">x</span></span><span class="main">&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">.</span> <span class="free">g</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">x</span></span><span class="main">&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">.</span> <span class="free">g</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">1</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">x</span></span><span class="main">&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">.</span> <span class="free">g</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>cmod <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">g</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">=</span> <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> norm_power<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?thesis</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power_even_eq<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span> 
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">x</span></span><span class="main">&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">.</span> <span class="free">g</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">1</span>"</span></span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>cmod <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">g</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">=</span> <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> norm_power<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?thesis</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power_even_eq<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Deutsch_Jozsa-cmod_less"><span class="command">lemma</span></span> cmod_less<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">a</span> <span class="free">n</span><span class="main">::</span> <span class="quoted">int</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&gt;</span> <span class="main">-</span><span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"cmod <span class="free">a</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Deutsch_Jozsa-square_less"><span class="command">lemma</span></span> square_less<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">a</span> <span class="free">n</span><span class="main">::</span> <span class="quoted">real</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&gt;</span> <span class="main">-</span><span class="free">n</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">&lt;</span> <span class="free">n</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> power2_eq_iff power2_minus power_less_imp_less_base<span class="main">)</span>

<span class="keyword1" id="Deutsch_Jozsa-cmod_square_real"><span class="command">lemma</span></span> cmod_square_real <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">n</span><span class="main">::</span> <span class="quoted">real</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>cmod <span class="free">n</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">=</span> <span class="free">n</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Deutsch_Jozsa-aux_comp_sum_divide_cmod"><span class="command">lemma</span></span> aux_comp_sum_divide_cmod<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">n</span><span class="main">::</span> <span class="quoted">nat</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">g</span><span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> int"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">a</span><span class="main">::</span> <span class="quoted">real</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>cmod<span class="main">(</span>complex_of_real<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> <span class="free">g</span> <span class="bound">k</span> <span class="main">/</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">=</span> <span class="main">(</span>cmod <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> <span class="free">g</span> <span class="bound">k</span><span class="main">)</span> <span class="main">/</span> <span class="free">a</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> cmod_square_real of_int_sum of_real_of_int_eq power_divide sum_divide_distrib<span class="main">)</span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The function is constant if and only if the first n qubits are 0. So, if the function is constant, 
then the probability of measuring 0 for the first n qubits is 1.
›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> jozsa<span class="main">)</span> prob0_jozsa_algo_of_const_0<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"const <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"prob0_fst_qubits <span class="free">n</span> jozsa_algo <span class="main">=</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prob0_fst_qubits <span class="free">n</span> jozsa_algo <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span>cmod<span class="main">(</span>jozsa_algo <span class="main">$$</span> <span class="main">(</span><span class="bound">j</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> prob0_fst_qubits_of_jozsa_algo <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>cmod<span class="main">(</span>jozsa_algo <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">=</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span><span class="main">&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="free">n</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">(</span><span class="main">0</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span> ⋅<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span>  <span class="skolem">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span><span class="main">::</span><span class="quoted">nat</span> 
      <span class="keyword1"><span class="command">using</span></span> bitwise_inner_prod_with_zero <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>cmod<span class="main">(</span>jozsa_algo <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">=</span> <span class="main">(</span>cmod<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">::</span>nat<span class="main">&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">.</span> <span class="main">1</span><span class="main">/</span><span class="main">(</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="free">n</span> <span class="main">*</span> sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> jozsa_algo_result const_def assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span>cmod<span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span><span class="main">^</span><span class="free">n</span><span class="main">/</span><span class="main">(</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="free">n</span> <span class="main">*</span> sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span>cmod<span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="main">(</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> aux_comp_with_sqrt2_bis <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> norm_divide power2_eq_square<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?thesis</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>cmod<span class="main">(</span>jozsa_algo <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">=</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span><span class="main">&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="free">n</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span> ⋅<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span>  <span class="skolem">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span><span class="main">::</span> <span class="quoted">nat</span>
      <span class="keyword1"><span class="command">using</span></span> bitwise_inner_prod_with_zero <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span><span class="main">&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="free">n</span> <span class="main">⟶</span> <span class="free">f</span> <span class="skolem">k</span> <span class="main">+</span> <span class="main">1</span> <span class="main">+</span> <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span> ⋅<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span>  <span class="skolem">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span><span class="main">::</span><span class="quoted">nat</span> 
      <span class="keyword1"><span class="command">using</span></span> const_def assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>cmod<span class="main">(</span>jozsa_algo <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> 
    <span class="main">=</span> <span class="main">(</span>cmod <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">::</span>nat<span class="main">&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">f</span> <span class="bound">k</span> <span class="main">+</span> <span class="main">1</span> <span class="main">+</span> <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span> ⋅<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span><span class="main">/</span><span class="main">(</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="free">n</span> <span class="main">*</span> sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> ψ<span class="hidden">⇩</span><sub>3</sub>_dim <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>cmod<span class="main">(</span>jozsa_algo <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">=</span> <span class="main">(</span>cmod<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">::</span>nat<span class="main">&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">.</span> <span class="main">-</span><span class="main">1</span><span class="main">/</span><span class="main">(</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="free">n</span> <span class="main">*</span> sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> lessThan_iff power_one_right sum.cong<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span>cmod<span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">/</span><span class="main">(</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> aux_comp_with_sqrt2_bis <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> norm_divide power2_eq_square<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?thesis</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prob0_fst_qubits <span class="free">n</span> jozsa_algo <span class="main">=</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span> <span class="main">+</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span>  <span class="quoted"><span class="quoted">"<span class="var">?thesis</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> jozsa<span class="main">)</span> prob0_jozsa_algo_of_const_1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"const <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"prob0_fst_qubits <span class="free">n</span> jozsa_algo <span class="main">=</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prob0_fst_qubits <span class="free">n</span> jozsa_algo <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span>cmod<span class="main">(</span>jozsa_algo <span class="main">$$</span> <span class="main">(</span><span class="bound">j</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> prob0_fst_qubits_of_jozsa_algo <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>cmod<span class="main">(</span>jozsa_algo <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">=</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
     <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span><span class="main">&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="free">n</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">(</span><span class="main">0</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span> ⋅<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span>  <span class="skolem">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span><span class="main">::</span><span class="quoted">nat</span>
      <span class="keyword1"><span class="command">using</span></span> bitwise_inner_prod_with_zero <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>cmod<span class="main">(</span>jozsa_algo <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">=</span> <span class="main">(</span>cmod<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">::</span>nat<span class="main">&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">.</span> <span class="main">1</span><span class="main">/</span><span class="main">(</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="free">n</span> <span class="main">*</span> sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> jozsa_algo_result const_def assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span>cmod<span class="main">(</span><span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">/</span><span class="main">(</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> "</span></span> 
      <span class="keyword1"><span class="command">using</span></span> aux_comp_with_sqrt2_bis <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> norm_divide power2_eq_square<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?thesis</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>cmod<span class="main">(</span>jozsa_algo <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">=</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span><span class="main">&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="free">n</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span> ⋅<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span>  <span class="skolem">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span><span class="main">::</span><span class="quoted">nat</span>
      <span class="keyword1"><span class="command">using</span></span> bitwise_inner_prod_with_zero <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">::</span>nat<span class="main">&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">f</span> <span class="bound">k</span> <span class="main">+</span><span class="main">1</span> <span class="main">+</span> <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span> ⋅<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span>  <span class="bound">k</span><span class="main">)</span><span class="main">)</span><span class="main">/</span><span class="main">(</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="free">n</span> <span class="main">*</span> sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
             <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">::</span>nat<span class="main">&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">.</span> <span class="main">1</span><span class="main">/</span><span class="main">(</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="free">n</span> <span class="main">*</span> sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> const_def assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>cmod<span class="main">(</span>jozsa_algo <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> 
    <span class="main">=</span> <span class="main">(</span>cmod <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">::</span>nat<span class="main">&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">f</span> <span class="bound">k</span> <span class="main">+</span> <span class="main">1</span> <span class="main">+</span> <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span> ⋅<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span>  <span class="bound">k</span><span class="main">)</span><span class="main">)</span><span class="main">/</span><span class="main">(</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="free">n</span> <span class="main">*</span> sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span>  ψ<span class="hidden">⇩</span><sub>3</sub>_dim <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>cmod<span class="main">(</span>jozsa_algo <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">=</span> <span class="main">(</span>cmod<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">::</span>nat<span class="main">&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">.</span> <span class="main">1</span><span class="main">/</span><span class="main">(</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="free">n</span> <span class="main">*</span> sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span>cmod<span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="main">(</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> "</span></span> 
      <span class="keyword1"><span class="command">using</span></span> aux_comp_with_sqrt2_bis <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> norm_divide power2_eq_square<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?thesis</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prob0_fst_qubits <span class="free">n</span> jozsa_algo <span class="main">=</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span> <span class="main">+</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span>  <span class="quoted"><span class="quoted">"<span class="var">?thesis</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹If the probability of measuring 0 for the first n qubits is 1, then the function is constant.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> jozsa<span class="main">)</span> max_value_of_not_const_less<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> const <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> const <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>cmod <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">::</span>nat<span class="main">&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">f</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">&lt;</span> <span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">n</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cmod <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">::</span>nat<span class="main">&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">f</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">::</span>nat<span class="main">&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">f</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> f0<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">&lt;</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> f1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> const_def f_values <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">::</span>nat<span class="main">&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">f</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="main">{</span><span class="bound">i</span><span class="main">|</span> <span class="bound">i</span><span class="main">::</span> nat<span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">}</span><span class="main">-</span><span class="main">{</span><span class="skolem">x</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">f</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span><span class="main">^</span> <span class="free">f</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">-</span><span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> f1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="main">{</span><span class="bound">i</span><span class="main">|</span> <span class="bound">i</span><span class="main">::</span>nat<span class="main">.</span> <span class="bound">i</span><span class="main">&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> f0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound">i</span><span class="main">|</span> <span class="bound">i</span><span class="main">::</span>nat<span class="main">.</span> <span class="bound">i</span><span class="main">&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="main">{</span><span class="bound">i</span><span class="main">|</span> <span class="bound">i</span><span class="main">::</span>nat<span class="main">.</span> <span class="bound">i</span><span class="main">&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">f</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> 
<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="main">{</span><span class="bound">i</span><span class="main">|</span> <span class="bound">i</span><span class="main">::</span> nat<span class="main">.</span> <span class="bound">i</span><span class="main">&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">}</span><span class="main">-</span><span class="main">{</span><span class="skolem">x</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">f</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> calculation<span class="main">(</span>1<span class="main">,</span>2<span class="main">,</span>3<span class="main">)</span> sum_diff1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_diff1<span class="main">)</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Collect_cong Collect_mem_eq lessThan_iff<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> int <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="free">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> aux_ineq_with_card<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">i</span><span class="main">|</span> <span class="bound">i</span><span class="main">::</span> nat<span class="main">.</span> <span class="bound">i</span><span class="main">&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">}</span><span class="main">-</span><span class="main">{</span><span class="skolem">x</span><span class="main">}</span>"</span></span><span class="main">]</span> f0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> diff_le_self less_le_trans of_nat_le_numeral_power_cancel_iff<span class="main">)</span>
   <span class="keyword1"><span class="command">qed</span></span>
   <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">::</span>nat<span class="main">&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">f</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">-</span> <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> f0<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">&lt;</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> f1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> const_def f_values <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">::</span>nat<span class="main">&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">f</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="main">{</span><span class="bound">i</span><span class="main">|</span> <span class="bound">i</span><span class="main">::</span> nat<span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">}</span><span class="main">-</span><span class="main">{</span><span class="skolem">x</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">f</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span><span class="main">^</span> <span class="free">f</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> f1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="main">{</span><span class="bound">i</span><span class="main">|</span> <span class="bound">i</span><span class="main">::</span>nat<span class="main">.</span> <span class="bound">i</span><span class="main">&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> f0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound">i</span><span class="main">|</span> <span class="bound">i</span><span class="main">::</span>nat<span class="main">.</span> <span class="bound">i</span><span class="main">&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="main">{</span><span class="bound">i</span><span class="main">|</span> <span class="bound">i</span><span class="main">::</span>nat<span class="main">.</span> <span class="bound">i</span><span class="main">&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">f</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="main">&gt;</span> 
<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="main">{</span><span class="bound">i</span><span class="main">|</span> <span class="bound">i</span><span class="main">::</span> nat<span class="main">.</span> <span class="bound">i</span><span class="main">&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">}</span><span class="main">-</span><span class="main">{</span><span class="skolem">x</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">f</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> calculation<span class="main">(</span>1<span class="main">,</span>2<span class="main">,</span>3<span class="main">)</span> sum_diff1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_diff1<span class="main">)</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Collect_cong Collect_mem_eq lessThan_iff<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span> int <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="free">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="main">{</span><span class="bound">i</span><span class="main">|</span> <span class="bound">i</span><span class="main">::</span> nat<span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">}</span><span class="main">-</span><span class="main">{</span><span class="skolem">x</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">f</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> aux_ineq_with_card<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">i</span><span class="main">|</span> <span class="bound">i</span><span class="main">::</span> nat<span class="main">.</span> <span class="bound">i</span><span class="main">&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">}</span><span class="main">-</span><span class="main">{</span><span class="skolem">x</span><span class="main">}</span>"</span></span><span class="main">]</span> f0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> diff_le_self of_nat_1 of_nat_add of_nat_power_le_of_nat_cancel_iff one_add_one<span class="main">)</span>
   <span class="keyword1"><span class="command">qed</span></span>
   <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
     <span class="keyword1"><span class="command">using</span></span> cmod_less of_int_of_nat_eq of_nat_numeral of_nat_power <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>cmod <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">::</span>nat<span class="main">&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">f</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">&lt;</span> <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> square_less norm_ge_zero <span class="keyword1"><span class="command">by</span></span> <span class="operator">smt</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power_even_eq<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> jozsa<span class="main">)</span> max_value_of_not_const_less_bis<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> const <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> const <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>cmod <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">::</span>nat<span class="main">&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">f</span> <span class="bound">k</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">&lt;</span> <span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">n</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cmod <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">::</span>nat<span class="main">&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">f</span> <span class="bound">k</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">::</span>nat<span class="main">&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">f</span> <span class="bound">k</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> f0<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">&lt;</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> f1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> const_def f_values <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">::</span>nat<span class="main">&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">f</span> <span class="bound">k</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="main">{</span><span class="bound">i</span><span class="main">|</span> <span class="bound">i</span><span class="main">::</span> nat<span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">}</span><span class="main">-</span><span class="main">{</span><span class="skolem">x</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">f</span> <span class="bound">k</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span><span class="main">^</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">x</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span><span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> f1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="main">{</span><span class="bound">i</span><span class="main">|</span> <span class="bound">i</span><span class="main">::</span>nat<span class="main">.</span> <span class="bound">i</span><span class="main">&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> f0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound">i</span><span class="main">|</span> <span class="bound">i</span><span class="main">::</span>nat<span class="main">.</span> <span class="bound">i</span><span class="main">&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="main">{</span><span class="bound">i</span><span class="main">|</span> <span class="bound">i</span><span class="main">::</span>nat<span class="main">.</span> <span class="bound">i</span><span class="main">&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">f</span> <span class="bound">k</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> 
<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="main">{</span><span class="bound">i</span><span class="main">|</span> <span class="bound">i</span><span class="main">::</span> nat<span class="main">.</span> <span class="bound">i</span><span class="main">&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">}</span><span class="main">-</span><span class="main">{</span><span class="skolem">x</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">f</span> <span class="bound">k</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> calculation<span class="main">(</span>1<span class="main">,</span>2<span class="main">,</span>3<span class="main">)</span> sum_diff1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_diff1<span class="main">)</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Collect_cong Collect_mem_eq lessThan_iff<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> int <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="free">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> aux_ineq_with_card<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">i</span><span class="main">|</span> <span class="bound">i</span><span class="main">::</span> nat<span class="main">.</span> <span class="bound">i</span><span class="main">&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">}</span><span class="main">-</span><span class="main">{</span><span class="skolem">x</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">k</span><span class="main">.</span> <span class="free">f</span> <span class="bound">k</span> <span class="main">+</span> <span class="main">1</span>"</span></span><span class="main">]</span> f0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> diff_le_self less_le_trans of_nat_le_numeral_power_cancel_iff<span class="main">)</span>
   <span class="keyword1"><span class="command">qed</span></span>
   <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">::</span>nat<span class="main">&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">f</span> <span class="bound">k</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">-</span> <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> f0<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">&lt;</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> f1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> const_def f_values <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">::</span>nat<span class="main">&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">f</span> <span class="bound">k</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="main">{</span><span class="bound">i</span><span class="main">|</span> <span class="bound">i</span><span class="main">::</span> nat<span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">}</span><span class="main">-</span><span class="main">{</span><span class="skolem">x</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">f</span> <span class="bound">k</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span><span class="main">^</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">x</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> f1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="main">{</span><span class="bound">i</span><span class="main">|</span> <span class="bound">i</span><span class="main">::</span>nat<span class="main">.</span> <span class="bound">i</span><span class="main">&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> f0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound">i</span><span class="main">|</span> <span class="bound">i</span><span class="main">::</span>nat<span class="main">.</span> <span class="bound">i</span><span class="main">&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="main">{</span><span class="bound">i</span><span class="main">|</span> <span class="bound">i</span><span class="main">::</span>nat<span class="main">.</span> <span class="bound">i</span><span class="main">&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">f</span> <span class="bound">k</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">&gt;</span> 
<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="main">{</span><span class="bound">i</span><span class="main">|</span> <span class="bound">i</span><span class="main">::</span> nat<span class="main">.</span> <span class="bound">i</span><span class="main">&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">}</span><span class="main">-</span><span class="main">{</span><span class="skolem">x</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">f</span> <span class="bound">k</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> calculation<span class="main">(</span>1<span class="main">,</span>2<span class="main">,</span>3<span class="main">)</span> sum_diff1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_diff1<span class="main">)</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Collect_cong Collect_mem_eq lessThan_iff<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span> int <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="free">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="main">{</span><span class="bound">i</span><span class="main">|</span> <span class="bound">i</span><span class="main">::</span> nat<span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">}</span><span class="main">-</span><span class="main">{</span><span class="skolem">x</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">f</span> <span class="bound">k</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> aux_ineq_with_card<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">i</span><span class="main">|</span> <span class="bound">i</span><span class="main">::</span> nat<span class="main">.</span> <span class="bound">i</span><span class="main">&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">}</span><span class="main">-</span><span class="main">{</span><span class="skolem">x</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">k</span><span class="main">.</span> <span class="free">f</span> <span class="bound">k</span> <span class="main">+</span> <span class="main">1</span>"</span></span><span class="main">]</span> f0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> diff_le_self of_nat_1 of_nat_add of_nat_power_le_of_nat_cancel_iff one_add_one<span class="main">)</span>
   <span class="keyword1"><span class="command">qed</span></span>
   <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
     <span class="keyword1"><span class="command">using</span></span> cmod_less of_int_of_nat_eq of_nat_numeral of_nat_power <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>cmod <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">::</span>nat<span class="main">&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">f</span> <span class="bound">k</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">&lt;</span> <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> square_less norm_ge_zero <span class="keyword1"><span class="command">by</span></span> <span class="operator">smt</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power_even_eq<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> jozsa<span class="main">)</span> f_const_has_max_value<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"const <span class="main">0</span> <span class="main">∨</span> const <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>cmod <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">&lt;</span><span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span><span class="main">^</span><span class="free">n</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">f</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">=</span> <span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">n</span><span class="main">)</span>"</span></span> 
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>cmod <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">&lt;</span><span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span><span class="main">^</span><span class="free">n</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">f</span> <span class="bound">k</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">=</span> <span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">n</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> aux_comp_with_cmod<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">n</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">k</span><span class="main">.</span> <span class="free">f</span> <span class="bound">k</span>"</span></span><span class="main">]</span> aux_comp_with_cmod<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">n</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">k</span><span class="main">.</span> <span class="free">f</span> <span class="bound">k</span> <span class="main">+</span> <span class="main">1</span>"</span></span><span class="main">]</span> const_def assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> jozsa<span class="main">)</span> prob0_fst_qubits_leq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>cmod <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">&lt;</span><span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span><span class="main">^</span><span class="free">n</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">f</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">≤</span> <span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">n</span><span class="main">)</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>cmod <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">&lt;</span><span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span><span class="main">^</span><span class="free">n</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">f</span> <span class="bound">k</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">≤</span> <span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">n</span><span class="main">)</span>"</span></span>  
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>cmod <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">&lt;</span><span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span><span class="main">^</span><span class="free">n</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">f</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">≤</span> <span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">n</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span> disjE<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>const <span class="main">0</span> <span class="main">∨</span> const <span class="main">1</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">¬</span> const <span class="main">0</span> <span class="main">∧</span> <span class="main">¬</span> const <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"const <span class="main">0</span> <span class="main">∨</span> const <span class="main">1</span>"</span></span> 
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>cmod <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">&lt;</span><span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span><span class="main">^</span><span class="free">n</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">f</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">≤</span> <span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">n</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> f_const_has_max_value <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> const <span class="main">0</span> <span class="main">∧</span> <span class="main">¬</span> const <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>cmod <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">&lt;</span><span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span><span class="main">^</span><span class="free">n</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">f</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">≤</span> <span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">n</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> max_value_of_not_const_less <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>cmod <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">&lt;</span><span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span><span class="main">^</span><span class="free">n</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">f</span> <span class="bound">k</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">≤</span> <span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">n</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span> disjE<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>const <span class="main">0</span> <span class="main">∨</span> const <span class="main">1</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">¬</span> const <span class="main">0</span> <span class="main">∧</span> <span class="main">¬</span> const <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"const <span class="main">0</span> <span class="main">∨</span> const <span class="main">1</span>"</span></span> 
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>cmod <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">&lt;</span><span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span><span class="main">^</span><span class="free">n</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">f</span> <span class="bound">k</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">≤</span> <span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">n</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> f_const_has_max_value <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> const <span class="main">0</span> <span class="main">∧</span> <span class="main">¬</span> const <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>cmod <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">&lt;</span><span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span><span class="main">^</span><span class="free">n</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">f</span> <span class="bound">k</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">≤</span> <span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">n</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> max_value_of_not_const_less_bis <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> jozsa<span class="main">)</span> prob0_jozsa_algo_1_is_const<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"prob0_fst_qubits <span class="free">n</span> jozsa_algo <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"const <span class="main">0</span> <span class="main">∨</span> const <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> f0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span>cmod<span class="main">(</span>jozsa_algo <span class="main">$$</span> <span class="main">(</span><span class="bound">j</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> prob0_fst_qubits_of_jozsa_algo assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">&lt;</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">⟶</span><span class="main">(</span><span class="main">(</span><span class="main">0</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span> ⋅<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span>  <span class="skolem">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span><span class="main">::</span><span class="quoted">nat</span>
    <span class="keyword1"><span class="command">using</span></span> bitwise_inner_prod_with_zero <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> f1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>cmod<span class="main">(</span>jozsa_algo <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">=</span> <span class="main">(</span>cmod<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">&lt;</span><span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span><span class="main">^</span><span class="free">n</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">f</span> <span class="bound">k</span><span class="main">)</span><span class="main">/</span><span class="main">(</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="free">n</span> <span class="main">*</span> sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">&lt;</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">⟶</span><span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span> ⋅<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span>  <span class="skolem">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span><span class="main">::</span><span class="quoted">nat</span>
    <span class="keyword1"><span class="command">using</span></span> bitwise_inner_prod_with_zero <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>cmod<span class="main">(</span>jozsa_algo <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> 
               <span class="main">=</span> <span class="main">(</span>cmod <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">&lt;</span><span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span><span class="main">^</span><span class="free">n</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">f</span> <span class="bound">k</span><span class="main">+</span> <span class="main">1</span> <span class="main">+</span> <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span> ⋅<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span>  <span class="bound">k</span><span class="main">)</span><span class="main">)</span><span class="main">/</span><span class="main">(</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="free">n</span> <span class="main">*</span> sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> ψ<span class="hidden">⇩</span><sub>3</sub>_dim <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> f2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>cmod<span class="main">(</span>jozsa_algo <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> 
                     <span class="main">=</span> <span class="main">(</span>cmod <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">&lt;</span><span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span><span class="main">^</span><span class="free">n</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">f</span> <span class="bound">k</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">/</span><span class="main">(</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="free">n</span> <span class="main">*</span> sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>   
  <span class="keyword1"><span class="command">have</span></span> f3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">=</span> <span class="main">(</span>cmod<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">::</span>nat<span class="main">&lt;</span><span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span><span class="main">^</span><span class="free">n</span><span class="main">.</span><span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">f</span> <span class="bound">k</span><span class="main">)</span><span class="main">/</span><span class="main">(</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="free">n</span> <span class="main">*</span> sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>
        <span class="main">+</span> <span class="main">(</span>cmod <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">::</span>nat<span class="main">&lt;</span><span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span><span class="main">^</span><span class="free">n</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">f</span> <span class="bound">k</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">/</span><span class="main">(</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="free">n</span> <span class="main">*</span> sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> f0 f1 f2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>cmod <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">::</span>nat<span class="main">&lt;</span><span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span><span class="main">^</span><span class="free">n</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">f</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="main">)</span> <span class="main">/</span><span class="main">(</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="free">n</span> <span class="main">*</span> sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>
                 <span class="main">+</span> <span class="main">(</span><span class="main">(</span>cmod<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">::</span>nat<span class="main">&lt;</span><span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span><span class="main">^</span><span class="free">n</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">f</span> <span class="bound">k</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span><span class="main">(</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="free">n</span> <span class="main">*</span> sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> aux_comp_sum_divide_cmod<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">k</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">f</span> <span class="bound">k</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="free">n</span> <span class="main">*</span> sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span><span class="main">^</span><span class="free">n</span>"</span></span><span class="main">]</span> 
          aux_comp_sum_divide_cmod<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">k</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">f</span> <span class="bound">k</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="free">n</span> <span class="main">*</span> sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span><span class="main">^</span><span class="free">n</span>"</span></span><span class="main">]</span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>cmod <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">::</span>nat<span class="main">&lt;</span><span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span><span class="main">^</span><span class="free">n</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">f</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">/</span><span class="main">(</span><span class="main">(</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="free">n</span> <span class="main">*</span> sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>
                 <span class="main">+</span> <span class="main">(</span><span class="main">(</span>cmod<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">::</span>nat<span class="main">&lt;</span><span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span><span class="main">^</span><span class="free">n</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">f</span> <span class="bound">k</span> <span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">/</span><span class="main">(</span><span class="main">(</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="free">n</span> <span class="main">*</span> sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power_divide<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>cmod <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">::</span>nat<span class="main">&lt;</span><span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span><span class="main">^</span><span class="free">n</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">f</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="main">)</span> <span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">/</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>
                 <span class="main">+</span> <span class="main">(</span><span class="main">(</span>cmod<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">::</span>nat<span class="main">&lt;</span><span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span><span class="main">^</span><span class="free">n</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">f</span> <span class="bound">k</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">/</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> left_add_twice power2_eq_square power_add power_mult_distrib real_sqrt_pow2<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span>cmod <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">::</span>nat<span class="main">&lt;</span><span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span><span class="main">^</span><span class="free">n</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">f</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> 
                 <span class="main">+</span> <span class="main">(</span><span class="main">(</span>cmod<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">::</span>nat<span class="main">&lt;</span><span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span><span class="main">^</span><span class="free">n</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">f</span> <span class="bound">k</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span><span class="main">/</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> "</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_divide_distrib<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span>cmod <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">::</span>nat<span class="main">&lt;</span><span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span><span class="main">^</span><span class="free">n</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">f</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> 
                 <span class="main">+</span> <span class="main">(</span><span class="main">(</span>cmod<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">::</span>nat<span class="main">&lt;</span><span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span><span class="main">^</span><span class="free">n</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">f</span> <span class="bound">k</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">n</span><span class="main">)</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>cmod <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">&lt;</span><span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span><span class="main">^</span><span class="free">n</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">f</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">≤</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">n</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> prob0_fst_qubits_leq <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>cmod <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">&lt;</span><span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span><span class="main">^</span><span class="free">n</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">f</span> <span class="bound">k</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">≤</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">n</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> prob0_fst_qubits_leq <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>cmod <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">::</span>nat<span class="main">&lt;</span><span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span><span class="main">^</span><span class="free">n</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">f</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span>  max_value_of_not_const_less <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The function is balanced if and only if at least one qubit among the first n qubits is not zero.
So, if the function is balanced then the probability of measuring 0 for the first n qubits is 0.
›</span></span>

<span class="keyword1" id="Deutsch_Jozsa-sum_union_disjoint_finite_set"><span class="command">lemma</span></span> sum_union_disjoint_finite_set<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">C</span><span class="main">::</span><span class="quoted"><span class="quoted">"nat set"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">g</span><span class="main">::</span><span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> int"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">C</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">A</span> <span class="bound">B</span><span class="main">.</span> <span class="bound">A</span> <span class="main">∩</span> <span class="bound">B</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">∧</span> <span class="bound">A</span> <span class="main">∪</span> <span class="bound">B</span> <span class="main">=</span> <span class="free">C</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="free">C</span><span class="main">.</span> <span class="free">g</span> <span class="bound">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="bound">A</span><span class="main">.</span> <span class="free">g</span> <span class="bound">k</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="bound">B</span><span class="main">.</span> <span class="free">g</span> <span class="bound">k</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> assms sum.union_disjoint <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> jozsa<span class="main">)</span> balanced_pos_and_neg_terms_cancel_out1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_balanced"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">&lt;</span><span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span><span class="main">^</span><span class="free">n</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">f</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">A</span> <span class="bound">B</span><span class="main">.</span> <span class="bound">A</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound">i</span><span class="main">::</span>nat<span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span><span class="main">^</span><span class="free">n</span><span class="main">}</span> <span class="main">∧</span> <span class="bound">B</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound">i</span><span class="main">::</span>nat<span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span><span class="main">^</span><span class="free">n</span><span class="main">}</span>
             <span class="main">∧</span> card <span class="bound">A</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> card <span class="bound">B</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>  
             <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">x</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">∈</span> <span class="bound">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span>  <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">x</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">∈</span> <span class="bound">B</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">1</span><span class="main">)</span>
        <span class="main">⟶</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">&lt;</span><span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span><span class="main">^</span><span class="free">n</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">f</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">A</span> <span class="skolem">B</span><span class="main">::</span><span class="quoted"><span class="quoted">"nat set"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> asm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound">i</span><span class="main">::</span>nat<span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span><span class="main">^</span><span class="free">n</span><span class="main">}</span> <span class="main">∧</span> <span class="skolem">B</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound">i</span><span class="main">::</span>nat<span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span><span class="main">^</span><span class="free">n</span><span class="main">}</span>
             <span class="main">∧</span> card <span class="skolem">A</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> card <span class="skolem">B</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>  
             <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">x</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">∈</span> <span class="skolem">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span>  <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">x</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">∈</span> <span class="skolem">B</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">1</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" <span class="skolem">A</span> <span class="main">∩</span> <span class="skolem">B</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span><span class="main">^</span><span class="free">n</span><span class="main">}</span> <span class="main">=</span> <span class="skolem">A</span> <span class="main">∪</span> <span class="skolem">B</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> is_balanced_union is_balanced_inter <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span><span class="main">^</span><span class="free">n</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">f</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
               <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="skolem">A</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">f</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span> 
             <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="skolem">B</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">f</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> finite_atLeastLessThan sum_union_disjoint_finite_set<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="skolem">A</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">f</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> asm <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="skolem">B</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">f</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span><span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> asm <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span><span class="main">^</span><span class="free">n</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">f</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">&lt;</span><span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span><span class="main">^</span><span class="free">n</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">f</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lessThan_atLeast0<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms is_balanced_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> jozsa<span class="main">)</span> balanced_pos_and_neg_terms_cancel_out2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_balanced"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">&lt;</span><span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span><span class="main">^</span><span class="free">n</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">f</span> <span class="bound">k</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">A</span> <span class="bound">B</span><span class="main">.</span> <span class="bound">A</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound">i</span><span class="main">::</span>nat<span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span><span class="main">^</span><span class="free">n</span><span class="main">}</span> <span class="main">∧</span> <span class="bound">B</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound">i</span><span class="main">::</span>nat<span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span><span class="main">^</span><span class="free">n</span><span class="main">}</span>
             <span class="main">∧</span> card <span class="bound">A</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> card <span class="bound">B</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>  
             <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">x</span><span class="main">::</span>nat<span class="main">)</span><span class="main">∈</span><span class="bound">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span>  <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">x</span><span class="main">::</span>nat<span class="main">)</span><span class="main">∈</span><span class="bound">B</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">1</span><span class="main">)</span>
        <span class="main">⟶</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">&lt;</span><span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span><span class="main">^</span><span class="free">n</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">f</span> <span class="bound">k</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">A</span> <span class="skolem">B</span><span class="main">::</span><span class="quoted"><span class="quoted">"nat set"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> asm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound">i</span><span class="main">::</span>nat<span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span><span class="main">^</span><span class="free">n</span><span class="main">}</span> <span class="main">∧</span> <span class="skolem">B</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound">i</span><span class="main">::</span>nat<span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span><span class="main">^</span><span class="free">n</span><span class="main">}</span>
             <span class="main">∧</span> card <span class="skolem">A</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> card <span class="skolem">B</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>  
             <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">x</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">∈</span> <span class="skolem">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span>  <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">x</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">∈</span> <span class="skolem">B</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">1</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">∩</span> <span class="skolem">B</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span><span class="main">^</span><span class="free">n</span><span class="main">}</span> <span class="main">=</span> <span class="skolem">A</span> <span class="main">∪</span> <span class="skolem">B</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> is_balanced_union is_balanced_inter asm <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span><span class="main">^</span><span class="free">n</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">f</span> <span class="bound">k</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
               <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="skolem">A</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">f</span> <span class="bound">k</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> 
             <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="skolem">B</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">f</span> <span class="bound">k</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> finite_atLeastLessThan sum_union_disjoint_finite_set<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="skolem">A</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">f</span> <span class="bound">k</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span><span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> asm <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="skolem">B</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">f</span> <span class="bound">k</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> asm <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span><span class="main">^</span><span class="free">n</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">f</span> <span class="bound">k</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span> "</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">&lt;</span><span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span><span class="main">^</span><span class="free">n</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">f</span> <span class="bound">k</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lessThan_atLeast0<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">&lt;</span><span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span><span class="main">^</span><span class="free">n</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">f</span> <span class="bound">k</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms is_balanced_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> jozsa<span class="main">)</span> prob0_jozsa_algo_of_balanced<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_balanced"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"prob0_fst_qubits <span class="free">n</span> jozsa_algo <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prob0_fst_qubits <span class="free">n</span> jozsa_algo <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span>cmod<span class="main">(</span>jozsa_algo <span class="main">$$</span> <span class="main">(</span><span class="bound">j</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> prob0_fst_qubits_of_jozsa_algo <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>cmod<span class="main">(</span>jozsa_algo <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
     <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">&lt;</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">⟶</span><span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span> ⋅<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span>  <span class="skolem">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span><span class="main">::</span><span class="quoted">nat</span>
      <span class="keyword1"><span class="command">using</span></span> bitwise_inner_prod_with_zero <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>cmod<span class="main">(</span>jozsa_algo <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">=</span> <span class="main">(</span>cmod<span class="main">(</span><span class="main">∑</span> <span class="bound">k</span> <span class="main">&lt;</span> <span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span><span class="main">^</span><span class="free">n</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">f</span> <span class="bound">k</span><span class="main">)</span><span class="main">/</span><span class="main">(</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="free">n</span> <span class="main">*</span> sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> ψ<span class="hidden">⇩</span><sub>3</sub>_values <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span>cmod<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">&lt;</span><span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span><span class="main">^</span><span class="free">n</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">f</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span><span class="main">/</span><span class="main">(</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="free">n</span> <span class="main">*</span> sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> aux_comp_sum_divide_cmod<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">k</span><span class="main">.</span><span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">f</span> <span class="bound">k</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="free">n</span> <span class="main">*</span> sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span><span class="main">^</span><span class="free">n</span>"</span></span><span class="main">]</span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span>cmod <span class="main">(</span><span class="main">(</span><span class="main">0</span><span class="main">::</span>int<span class="main">)</span><span class="main">/</span><span class="main">(</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="free">n</span> <span class="main">*</span> sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> balanced_pos_and_neg_terms_cancel_out1 assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bob_fun_axioms<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>cmod<span class="main">(</span>jozsa_algo <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
     <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">&lt;</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span> ⋅<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span>  <span class="skolem">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span><span class="main">::</span><span class="quoted">nat</span>
       <span class="keyword1"><span class="command">using</span></span> bitwise_inner_prod_with_zero <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
     <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>cmod<span class="main">(</span>jozsa_algo <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> 
     <span class="main">=</span> <span class="main">(</span>cmod <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">&lt;</span><span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span><span class="main">^</span><span class="free">n</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">f</span> <span class="bound">k</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span> ⋅<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span>  <span class="bound">k</span><span class="main">)</span><span class="main">)</span><span class="main">/</span><span class="main">(</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="free">n</span> <span class="main">*</span> sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> ψ<span class="hidden">⇩</span><sub>3</sub>_dim <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>cmod<span class="main">(</span>jozsa_algo <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> 
    <span class="main">=</span> <span class="main">(</span>cmod<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">&lt;</span><span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span><span class="main">^</span><span class="free">n</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">f</span> <span class="bound">k</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span><span class="main">/</span><span class="main">(</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="free">n</span> <span class="main">*</span> sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span> 
       <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span>cmod<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">&lt;</span><span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span><span class="main">^</span><span class="free">n</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">f</span> <span class="bound">k</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">/</span><span class="main">(</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="free">n</span> <span class="main">*</span> sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> aux_comp_sum_divide_cmod<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">k</span><span class="main">.</span><span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">f</span> <span class="bound">k</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="free">n</span> <span class="main">*</span> sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span><span class="main">^</span><span class="free">n</span>"</span></span><span class="main">]</span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span>cmod <span class="main">(</span><span class="main">(</span><span class="main">0</span><span class="main">::</span>int<span class="main">)</span><span class="main">/</span><span class="main">(</span>sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="free">n</span> <span class="main">*</span> sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> balanced_pos_and_neg_terms_cancel_out2 assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bob_fun_axioms<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prob0_fst_qubits <span class="free">n</span> jozsa_algo <span class="main">=</span> <span class="main">0</span> <span class="main">+</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span>  <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹If the probability that the first n qubits are 0 is 0, then the function is balanced.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> jozsa<span class="main">)</span> balanced_prob0_jozsa_algo<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"prob0_fst_qubits <span class="free">n</span> jozsa_algo <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_balanced"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_const <span class="main">∨</span> is_balanced"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> const_or_balanced <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_const <span class="main">⟶</span> <span class="main">¬</span> prob0_fst_qubits <span class="free">n</span> jozsa_algo <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> is_const_def prob0_jozsa_algo_of_const_0 prob0_jozsa_algo_of_const_1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We prove the correctness of the algorithm.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> jozsa<span class="main">)</span> <span class="entity">jozsa_algo_eval</span><span class="main">::</span> <span class="quoted"><span class="quoted">"real"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">jozsa_algo_eval</span> <span class="main">≡</span> prob0_fst_qubits <span class="free">n</span> jozsa_algo"</span></span>

<span class="keyword1"><span class="command">theorem</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> jozsa<span class="main">)</span> jozsa_algo_is_correct<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"jozsa_algo_eval <span class="main">=</span> <span class="main">1</span> <span class="main">⟷</span> is_const"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"jozsa_algo_eval <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> is_balanced"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> prob0_jozsa_algo_of_const_1 prob0_jozsa_algo_of_const_0 jozsa_algo_eval_def
prob0_jozsa_algo_1_is_const is_const_def balanced_prob0_jozsa_algo prob0_jozsa_algo_of_balanced 
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="No_Cloning">
<div class="head">
<h1>Theory No_Cloning</h1>
</div>
<pre class="source"><span class="comment1">(*
Authors:

  Anthony Bordg, University of Cambridge, apdb3@cam.ac.uk;
  Yijun He, University of Cambridge, yh403@cam.ac.uk
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹The No-Cloning Theorem›</span></span>

<span class="keyword1"><span class="command">theory</span></span> No_Cloning
<span class="keyword2"><span class="keyword">imports</span></span>
  <a href="#Quantum">Quantum</a>
  <a href="#Tensor">Tensor</a>
<span class="keyword2"><span class="keyword">begin</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹The Cauchy-Schwarz Inequality›</span></span>

<span class="keyword1" id="No_Cloning-inner_prod_expand"><span class="command">lemma</span></span> inner_prod_expand<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"dim_vec <span class="free">a</span> <span class="main">=</span> dim_vec <span class="free">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"dim_vec <span class="free">a</span> <span class="main">=</span> dim_vec <span class="free">c</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"dim_vec <span class="free">a</span> <span class="main">=</span> dim_vec <span class="free">d</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">a</span> <span class="main">+</span> <span class="free">b</span><span class="main">|</span><span class="free">c</span> <span class="main">+</span> <span class="free">d</span><span class="main">⟩</span> <span class="main">=</span> <span class="main">⟨</span><span class="free">a</span><span class="main">|</span><span class="free">c</span><span class="main">⟩</span> <span class="main">+</span> <span class="main">⟨</span><span class="free">a</span><span class="main">|</span><span class="free">d</span><span class="main">⟩</span> <span class="main">+</span> <span class="main">⟨</span><span class="free">b</span><span class="main">|</span><span class="free">c</span><span class="main">⟩</span> <span class="main">+</span> <span class="main">⟨</span><span class="free">b</span><span class="main">|</span><span class="free">d</span><span class="main">⟩</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inner_prod_def<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> assms sum.cong <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum.distrib <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>

<span class="keyword1" id="No_Cloning-inner_prod_distrib_left"><span class="command">lemma</span></span> inner_prod_distrib_left<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"dim_vec <span class="free">a</span> <span class="main">=</span> dim_vec <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">c</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">a</span><span class="main">|</span><span class="free">b</span><span class="main">⟩</span> <span class="main">=</span> cnj<span class="main">(</span><span class="free">c</span><span class="main">)</span> <span class="main">*</span> <span class="main">⟨</span><span class="free">a</span><span class="main">|</span><span class="free">b</span><span class="main">⟩</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms inner_prod_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span> mult_hom.hom_sum<span class="main">)</span>

<span class="keyword1" id="No_Cloning-inner_prod_distrib_right"><span class="command">lemma</span></span> inner_prod_distrib_right<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"dim_vec <span class="free">a</span> <span class="main">=</span> dim_vec <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">a</span><span class="main">|</span><span class="free">c</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">b</span><span class="main">⟩</span> <span class="main">=</span> <span class="free">c</span> <span class="main">*</span> <span class="main">⟨</span><span class="free">a</span><span class="main">|</span><span class="free">b</span><span class="main">⟩</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span> mult_hom.hom_sum<span class="main">)</span>

<span class="keyword1" id="No_Cloning-cauchy_schwarz_ineq"><span class="command">lemma</span></span> cauchy_schwarz_ineq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"dim_vec <span class="free">v</span> <span class="main">=</span> dim_vec <span class="free">w</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>cmod<span class="main">(</span><span class="main">⟨</span><span class="free">v</span><span class="main">|</span><span class="free">w</span><span class="main">⟩</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">≤</span> Re <span class="main">(</span><span class="main">⟨</span><span class="free">v</span><span class="main">|</span><span class="free">v</span><span class="main">⟩</span> <span class="main">*</span> <span class="main">⟨</span><span class="free">w</span><span class="main">|</span><span class="free">w</span><span class="main">⟩</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">v</span><span class="main">|</span><span class="free">v</span><span class="main">⟩</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> c0<span class="main">:</span>True
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> dim_vec <span class="free">v</span> <span class="main">⟹</span> <span class="free">v</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">metis</span> index_zero_vec<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> inner_prod_with_itself_nonneg_reals_non0<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>cmod<span class="main">(</span><span class="main">⟨</span><span class="free">v</span><span class="main">|</span><span class="free">w</span><span class="main">⟩</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms inner_prod_def<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Re <span class="main">(</span><span class="main">⟨</span><span class="free">v</span><span class="main">|</span><span class="free">v</span><span class="main">⟩</span> <span class="main">*</span> <span class="main">⟨</span><span class="free">w</span><span class="main">|</span><span class="free">w</span><span class="main">⟩</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> c0<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> c1<span class="main">:</span>False
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"dim_vec <span class="free">w</span> <span class="main">=</span> dim_vec <span class="main">(</span><span class="main">-</span> <span class="main">⟨</span><span class="free">v</span><span class="main">|</span><span class="free">w</span><span class="main">⟩</span> <span class="main">/</span> <span class="main">⟨</span><span class="free">v</span><span class="main">|</span><span class="free">v</span><span class="main">⟩</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">v</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">w</span> <span class="main">+</span> <span class="main">-</span><span class="main">⟨</span><span class="free">v</span><span class="main">|</span><span class="free">w</span><span class="main">⟩</span><span class="main">/</span><span class="main">⟨</span><span class="free">v</span><span class="main">|</span><span class="free">v</span><span class="main">⟩</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">v</span><span class="main">|</span><span class="free">w</span> <span class="main">+</span> <span class="main">-</span><span class="main">⟨</span><span class="free">v</span><span class="main">|</span><span class="free">w</span><span class="main">⟩</span><span class="main">/</span><span class="main">⟨</span><span class="free">v</span><span class="main">|</span><span class="free">v</span><span class="main">⟩</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">v</span><span class="main">⟩</span> <span class="main">=</span> <span class="main">⟨</span><span class="free">w</span><span class="main">|</span><span class="free">w</span><span class="main">⟩</span> <span class="main">+</span> <span class="main">⟨</span><span class="free">w</span><span class="main">|</span><span class="main">-</span><span class="main">⟨</span><span class="free">v</span><span class="main">|</span><span class="free">w</span><span class="main">⟩</span><span class="main">/</span><span class="main">⟨</span><span class="free">v</span><span class="main">|</span><span class="free">v</span><span class="main">⟩</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">v</span><span class="main">⟩</span> <span class="main">+</span>
<span class="main">⟨</span><span class="main">-</span><span class="main">⟨</span><span class="free">v</span><span class="main">|</span><span class="free">w</span><span class="main">⟩</span><span class="main">/</span><span class="main">⟨</span><span class="free">v</span><span class="main">|</span><span class="free">v</span><span class="main">⟩</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">v</span><span class="main">|</span><span class="free">w</span><span class="main">⟩</span> <span class="main">+</span> <span class="main">⟨</span><span class="main">-</span><span class="main">⟨</span><span class="free">v</span><span class="main">|</span><span class="free">w</span><span class="main">⟩</span><span class="main">/</span><span class="main">⟨</span><span class="free">v</span><span class="main">|</span><span class="free">v</span><span class="main">⟩</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">v</span><span class="main">|</span><span class="main">-</span><span class="main">⟨</span><span class="free">v</span><span class="main">|</span><span class="free">w</span><span class="main">⟩</span><span class="main">/</span><span class="main">⟨</span><span class="free">v</span><span class="main">|</span><span class="free">v</span><span class="main">⟩</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">v</span><span class="main">⟩</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> inner_prod_expand<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">w</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">⟨</span><span class="free">v</span><span class="main">|</span><span class="free">w</span><span class="main">⟩</span><span class="main">/</span><span class="main">⟨</span><span class="free">v</span><span class="main">|</span><span class="free">v</span><span class="main">⟩</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">v</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">⟨</span><span class="free">v</span><span class="main">|</span><span class="free">w</span><span class="main">⟩</span><span class="main">/</span><span class="main">⟨</span><span class="free">v</span><span class="main">|</span><span class="free">v</span><span class="main">⟩</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">v</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">w</span><span class="main">|</span><span class="main">-</span><span class="main">⟨</span><span class="free">v</span><span class="main">|</span><span class="free">w</span><span class="main">⟩</span><span class="main">/</span><span class="main">⟨</span><span class="free">v</span><span class="main">|</span><span class="free">v</span><span class="main">⟩</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">v</span><span class="main">⟩</span> <span class="main">=</span> <span class="main">-</span><span class="main">⟨</span><span class="free">v</span><span class="main">|</span><span class="free">w</span><span class="main">⟩</span><span class="main">/</span><span class="main">⟨</span><span class="free">v</span><span class="main">|</span><span class="free">v</span><span class="main">⟩</span> <span class="main">*</span> <span class="main">⟨</span><span class="free">w</span><span class="main">|</span><span class="free">v</span><span class="main">⟩</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms inner_prod_distrib_right<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">w</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">⟨</span><span class="free">v</span><span class="main">|</span><span class="free">w</span><span class="main">⟩</span><span class="main">/</span><span class="main">⟨</span><span class="free">v</span><span class="main">|</span><span class="free">v</span><span class="main">⟩</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="main">-</span><span class="main">⟨</span><span class="free">v</span><span class="main">|</span><span class="free">w</span><span class="main">⟩</span><span class="main">/</span><span class="main">⟨</span><span class="free">v</span><span class="main">|</span><span class="free">v</span><span class="main">⟩</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">v</span><span class="main">|</span><span class="free">w</span><span class="main">⟩</span> <span class="main">=</span> cnj<span class="main">(</span><span class="main">-</span><span class="main">⟨</span><span class="free">v</span><span class="main">|</span><span class="free">w</span><span class="main">⟩</span><span class="main">/</span><span class="main">⟨</span><span class="free">v</span><span class="main">|</span><span class="free">v</span><span class="main">⟩</span><span class="main">)</span> <span class="main">*</span> <span class="main">⟨</span><span class="free">v</span><span class="main">|</span><span class="free">w</span><span class="main">⟩</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms inner_prod_distrib_left<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">v</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">⟨</span><span class="free">v</span><span class="main">|</span><span class="free">w</span><span class="main">⟩</span><span class="main">/</span><span class="main">⟨</span><span class="free">v</span><span class="main">|</span><span class="free">v</span><span class="main">⟩</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="main">-</span><span class="main">⟨</span><span class="free">v</span><span class="main">|</span><span class="free">w</span><span class="main">⟩</span><span class="main">/</span><span class="main">⟨</span><span class="free">v</span><span class="main">|</span><span class="free">v</span><span class="main">⟩</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">v</span><span class="main">|</span><span class="main">-</span><span class="main">⟨</span><span class="free">v</span><span class="main">|</span><span class="free">w</span><span class="main">⟩</span><span class="main">/</span><span class="main">⟨</span><span class="free">v</span><span class="main">|</span><span class="free">v</span><span class="main">⟩</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">v</span><span class="main">⟩</span> <span class="main">=</span> cnj<span class="main">(</span><span class="main">-</span><span class="main">⟨</span><span class="free">v</span><span class="main">|</span><span class="free">w</span><span class="main">⟩</span><span class="main">/</span><span class="main">⟨</span><span class="free">v</span><span class="main">|</span><span class="free">v</span><span class="main">⟩</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span><span class="main">⟨</span><span class="free">v</span><span class="main">|</span><span class="free">w</span><span class="main">⟩</span><span class="main">/</span><span class="main">⟨</span><span class="free">v</span><span class="main">|</span><span class="free">v</span><span class="main">⟩</span><span class="main">)</span> <span class="main">*</span> <span class="main">⟨</span><span class="free">v</span><span class="main">|</span><span class="free">v</span><span class="main">⟩</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> inner_prod_distrib_left<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">v</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">⟨</span><span class="free">v</span><span class="main">|</span><span class="free">w</span><span class="main">⟩</span><span class="main">/</span><span class="main">⟨</span><span class="free">v</span><span class="main">|</span><span class="free">v</span><span class="main">⟩</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">v</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">⟨</span><span class="free">v</span><span class="main">|</span><span class="free">w</span><span class="main">⟩</span><span class="main">/</span><span class="main">⟨</span><span class="free">v</span><span class="main">|</span><span class="free">v</span><span class="main">⟩</span>"</span></span><span class="main">]</span>
inner_prod_distrib_right<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">v</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">⟨</span><span class="free">v</span><span class="main">|</span><span class="free">w</span><span class="main">⟩</span><span class="main">/</span><span class="main">⟨</span><span class="free">v</span><span class="main">|</span><span class="free">v</span><span class="main">⟩</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">w</span> <span class="main">+</span> <span class="main">-</span><span class="main">⟨</span><span class="free">v</span><span class="main">|</span><span class="free">w</span><span class="main">⟩</span><span class="main">/</span><span class="main">⟨</span><span class="free">v</span><span class="main">|</span><span class="free">v</span><span class="main">⟩</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">v</span><span class="main">|</span><span class="free">w</span> <span class="main">+</span> <span class="main">-</span><span class="main">⟨</span><span class="free">v</span><span class="main">|</span><span class="free">w</span><span class="main">⟩</span><span class="main">/</span><span class="main">⟨</span><span class="free">v</span><span class="main">|</span><span class="free">v</span><span class="main">⟩</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">v</span><span class="main">⟩</span> <span class="main">=</span> <span class="main">⟨</span><span class="free">w</span><span class="main">|</span><span class="free">w</span><span class="main">⟩</span> <span class="main">-</span>  cmod<span class="main">(</span><span class="main">⟨</span><span class="free">v</span><span class="main">|</span><span class="free">w</span><span class="main">⟩</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span> <span class="main">/</span> <span class="main">⟨</span><span class="free">v</span><span class="main">|</span><span class="free">v</span><span class="main">⟩</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms inner_prod_cnj<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">w</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span>"</span></span><span class="main">]</span> inner_prod_cnj<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">v</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span>"</span></span><span class="main">]</span> complex_norm_square <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Re<span class="main">(</span><span class="main">⟨</span><span class="free">w</span> <span class="main">+</span> <span class="main">-</span><span class="main">⟨</span><span class="free">v</span><span class="main">|</span><span class="free">w</span><span class="main">⟩</span><span class="main">/</span><span class="main">⟨</span><span class="free">v</span><span class="main">|</span><span class="free">v</span><span class="main">⟩</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">v</span><span class="main">|</span><span class="free">w</span> <span class="main">+</span> <span class="main">-</span><span class="main">⟨</span><span class="free">v</span><span class="main">|</span><span class="free">w</span><span class="main">⟩</span><span class="main">/</span><span class="main">⟨</span><span class="free">v</span><span class="main">|</span><span class="free">v</span><span class="main">⟩</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">v</span><span class="main">⟩</span><span class="main">)</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> inner_prod_with_itself_Re <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Re<span class="main">(</span><span class="main">⟨</span><span class="free">w</span><span class="main">|</span><span class="free">w</span><span class="main">⟩</span><span class="main">)</span> <span class="main">≥</span> cmod<span class="main">(</span><span class="main">⟨</span><span class="free">v</span><span class="main">|</span><span class="free">w</span><span class="main">⟩</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span><span class="main">/</span>Re<span class="main">(</span><span class="main">⟨</span><span class="free">v</span><span class="main">|</span><span class="free">v</span><span class="main">⟩</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> inner_prod_with_itself_real <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> c2<span class="main">:</span><span class="quoted"><span class="quoted">"Re<span class="main">(</span><span class="main">⟨</span><span class="free">v</span><span class="main">|</span><span class="free">v</span><span class="main">⟩</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> inner_prod_with_itself_Re_non0 inner_prod_with_itself_eq0 c1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Re<span class="main">(</span><span class="main">⟨</span><span class="free">w</span><span class="main">|</span><span class="free">w</span><span class="main">⟩</span><span class="main">)</span> <span class="main">*</span> Re<span class="main">(</span><span class="main">⟨</span><span class="free">v</span><span class="main">|</span><span class="free">v</span><span class="main">⟩</span><span class="main">)</span> <span class="main">≥</span> cmod<span class="main">(</span><span class="main">⟨</span><span class="free">v</span><span class="main">|</span><span class="free">w</span><span class="main">⟩</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span><span class="main">/</span>Re<span class="main">(</span><span class="main">⟨</span><span class="free">v</span><span class="main">|</span><span class="free">v</span><span class="main">⟩</span><span class="main">)</span> <span class="main">*</span> Re<span class="main">(</span><span class="main">⟨</span><span class="free">v</span><span class="main">|</span><span class="free">v</span><span class="main">⟩</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> less_numeral_extra<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> nonzero_divide_eq_eq pos_divide_le_eq<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> inner_prod_with_itself_Im c2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult.commute<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="No_Cloning-cauchy_schwarz_eq"><span class="command">lemma</span></span> cauchy_schwarz_eq <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">=</span> <span class="main">(</span><span class="free">l</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">w</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>cmod<span class="main">(</span><span class="main">⟨</span><span class="free">v</span><span class="main">|</span><span class="free">w</span><span class="main">⟩</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">=</span> Re <span class="main">(</span><span class="main">⟨</span><span class="free">v</span><span class="main">|</span><span class="free">v</span><span class="main">⟩</span> <span class="main">*</span> <span class="main">⟨</span><span class="free">w</span><span class="main">|</span><span class="free">w</span><span class="main">⟩</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cmod<span class="main">(</span><span class="main">⟨</span><span class="free">v</span><span class="main">|</span><span class="free">w</span><span class="main">⟩</span><span class="main">)</span> <span class="main">=</span> cmod<span class="main">(</span>cnj<span class="main">(</span><span class="free">l</span><span class="main">)</span> <span class="main">*</span> <span class="main">⟨</span><span class="free">w</span><span class="main">|</span><span class="free">w</span><span class="main">⟩</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms inner_prod_distrib_left<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">w</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">l</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cmod<span class="main">(</span><span class="main">⟨</span><span class="free">v</span><span class="main">|</span><span class="free">w</span><span class="main">⟩</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span> <span class="main">=</span> cmod<span class="main">(</span><span class="free">l</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span> <span class="main">*</span> <span class="main">⟨</span><span class="free">w</span><span class="main">|</span><span class="free">w</span><span class="main">⟩</span> <span class="main">*</span> <span class="main">⟨</span><span class="free">w</span><span class="main">|</span><span class="free">w</span><span class="main">⟩</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> complex_norm_square inner_prod_cnj<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">w</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">v</span><span class="main">|</span><span class="free">v</span><span class="main">⟩</span> <span class="main">=</span> cmod<span class="main">(</span><span class="free">l</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span> <span class="main">*</span> <span class="main">⟨</span><span class="free">w</span><span class="main">|</span><span class="free">w</span><span class="main">⟩</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms complex_norm_square inner_prod_distrib_left<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">w</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">l</span>"</span></span><span class="main">]</span>
inner_prod_distrib_right<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">w</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">l</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Re_complex_of_real<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="No_Cloning-cauchy_schwarz_col"><span class="command">lemma</span></span> cauchy_schwarz_col <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"dim_vec <span class="free">v</span> <span class="main">=</span> dim_vec <span class="free">w</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>cmod<span class="main">(</span><span class="main">⟨</span><span class="free">v</span><span class="main">|</span><span class="free">w</span><span class="main">⟩</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">=</span> Re <span class="main">(</span><span class="main">⟨</span><span class="free">v</span><span class="main">|</span><span class="free">v</span><span class="main">⟩</span> <span class="main">*</span> <span class="main">⟨</span><span class="free">w</span><span class="main">|</span><span class="free">w</span><span class="main">⟩</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">l</span><span class="main">.</span> <span class="free">v</span> <span class="main">=</span> <span class="main">(</span><span class="bound">l</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">w</span><span class="main">)</span> <span class="main">∨</span> <span class="free">w</span> <span class="main">=</span> <span class="main">(</span><span class="bound">l</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">v</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">v</span><span class="main">|</span><span class="free">v</span><span class="main">⟩</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> c0<span class="main">:</span>True
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> dim_vec <span class="free">v</span> <span class="main">⟹</span> <span class="free">v</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">metis</span> index_zero_vec<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> inner_prod_with_itself_nonneg_reals_non0<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">w</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> assms<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> c1<span class="main">:</span>False
  <span class="keyword1"><span class="command">have</span></span> f0<span class="main">:</span><span class="quoted"><span class="quoted">"dim_vec <span class="free">w</span> <span class="main">=</span> dim_vec <span class="main">(</span><span class="main">-</span> <span class="main">⟨</span><span class="free">v</span><span class="main">|</span><span class="free">w</span><span class="main">⟩</span> <span class="main">/</span> <span class="main">⟨</span><span class="free">v</span><span class="main">|</span><span class="free">v</span><span class="main">⟩</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">v</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">w</span> <span class="main">+</span> <span class="main">-</span><span class="main">⟨</span><span class="free">v</span><span class="main">|</span><span class="free">w</span><span class="main">⟩</span><span class="main">/</span><span class="main">⟨</span><span class="free">v</span><span class="main">|</span><span class="free">v</span><span class="main">⟩</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">v</span><span class="main">|</span><span class="free">w</span> <span class="main">+</span> <span class="main">-</span><span class="main">⟨</span><span class="free">v</span><span class="main">|</span><span class="free">w</span><span class="main">⟩</span><span class="main">/</span><span class="main">⟨</span><span class="free">v</span><span class="main">|</span><span class="free">v</span><span class="main">⟩</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">v</span><span class="main">⟩</span> <span class="main">=</span> <span class="main">⟨</span><span class="free">w</span><span class="main">|</span><span class="free">w</span><span class="main">⟩</span> <span class="main">+</span> <span class="main">⟨</span><span class="free">w</span><span class="main">|</span><span class="main">-</span><span class="main">⟨</span><span class="free">v</span><span class="main">|</span><span class="free">w</span><span class="main">⟩</span><span class="main">/</span><span class="main">⟨</span><span class="free">v</span><span class="main">|</span><span class="free">v</span><span class="main">⟩</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">v</span><span class="main">⟩</span> <span class="main">+</span>
<span class="main">⟨</span><span class="main">-</span><span class="main">⟨</span><span class="free">v</span><span class="main">|</span><span class="free">w</span><span class="main">⟩</span><span class="main">/</span><span class="main">⟨</span><span class="free">v</span><span class="main">|</span><span class="free">v</span><span class="main">⟩</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">v</span><span class="main">|</span><span class="free">w</span><span class="main">⟩</span> <span class="main">+</span> <span class="main">⟨</span><span class="main">-</span><span class="main">⟨</span><span class="free">v</span><span class="main">|</span><span class="free">w</span><span class="main">⟩</span><span class="main">/</span><span class="main">⟨</span><span class="free">v</span><span class="main">|</span><span class="free">v</span><span class="main">⟩</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">v</span><span class="main">|</span><span class="main">-</span><span class="main">⟨</span><span class="free">v</span><span class="main">|</span><span class="free">w</span><span class="main">⟩</span><span class="main">/</span><span class="main">⟨</span><span class="free">v</span><span class="main">|</span><span class="free">v</span><span class="main">⟩</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">v</span><span class="main">⟩</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> inner_prod_expand<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">w</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">⟨</span><span class="free">v</span><span class="main">|</span><span class="free">w</span><span class="main">⟩</span><span class="main">/</span><span class="main">⟨</span><span class="free">v</span><span class="main">|</span><span class="free">v</span><span class="main">⟩</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">v</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">⟨</span><span class="free">v</span><span class="main">|</span><span class="free">w</span><span class="main">⟩</span><span class="main">/</span><span class="main">⟨</span><span class="free">v</span><span class="main">|</span><span class="free">v</span><span class="main">⟩</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">v</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">w</span><span class="main">|</span><span class="main">-</span><span class="main">⟨</span><span class="free">v</span><span class="main">|</span><span class="free">w</span><span class="main">⟩</span><span class="main">/</span><span class="main">⟨</span><span class="free">v</span><span class="main">|</span><span class="free">v</span><span class="main">⟩</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">v</span><span class="main">⟩</span> <span class="main">=</span> <span class="main">-</span><span class="main">⟨</span><span class="free">v</span><span class="main">|</span><span class="free">w</span><span class="main">⟩</span><span class="main">/</span><span class="main">⟨</span><span class="free">v</span><span class="main">|</span><span class="free">v</span><span class="main">⟩</span> <span class="main">*</span> <span class="main">⟨</span><span class="free">w</span><span class="main">|</span><span class="free">v</span><span class="main">⟩</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> inner_prod_distrib_right<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">w</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">⟨</span><span class="free">v</span><span class="main">|</span><span class="free">w</span><span class="main">⟩</span><span class="main">/</span><span class="main">⟨</span><span class="free">v</span><span class="main">|</span><span class="free">v</span><span class="main">⟩</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="main">-</span><span class="main">⟨</span><span class="free">v</span><span class="main">|</span><span class="free">w</span><span class="main">⟩</span><span class="main">/</span><span class="main">⟨</span><span class="free">v</span><span class="main">|</span><span class="free">v</span><span class="main">⟩</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">v</span><span class="main">|</span><span class="free">w</span><span class="main">⟩</span> <span class="main">=</span> cnj<span class="main">(</span><span class="main">-</span><span class="main">⟨</span><span class="free">v</span><span class="main">|</span><span class="free">w</span><span class="main">⟩</span><span class="main">/</span><span class="main">⟨</span><span class="free">v</span><span class="main">|</span><span class="free">v</span><span class="main">⟩</span><span class="main">)</span> <span class="main">*</span> <span class="main">⟨</span><span class="free">v</span><span class="main">|</span><span class="free">w</span><span class="main">⟩</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> inner_prod_distrib_left<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">v</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">⟨</span><span class="free">v</span><span class="main">|</span><span class="free">w</span><span class="main">⟩</span><span class="main">/</span><span class="main">⟨</span><span class="free">v</span><span class="main">|</span><span class="free">v</span><span class="main">⟩</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="main">-</span><span class="main">⟨</span><span class="free">v</span><span class="main">|</span><span class="free">w</span><span class="main">⟩</span><span class="main">/</span><span class="main">⟨</span><span class="free">v</span><span class="main">|</span><span class="free">v</span><span class="main">⟩</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">v</span><span class="main">|</span><span class="main">-</span><span class="main">⟨</span><span class="free">v</span><span class="main">|</span><span class="free">w</span><span class="main">⟩</span><span class="main">/</span><span class="main">⟨</span><span class="free">v</span><span class="main">|</span><span class="free">v</span><span class="main">⟩</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">v</span><span class="main">⟩</span> <span class="main">=</span> cnj<span class="main">(</span><span class="main">-</span><span class="main">⟨</span><span class="free">v</span><span class="main">|</span><span class="free">w</span><span class="main">⟩</span><span class="main">/</span><span class="main">⟨</span><span class="free">v</span><span class="main">|</span><span class="free">v</span><span class="main">⟩</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span><span class="main">⟨</span><span class="free">v</span><span class="main">|</span><span class="free">w</span><span class="main">⟩</span><span class="main">/</span><span class="main">⟨</span><span class="free">v</span><span class="main">|</span><span class="free">v</span><span class="main">⟩</span><span class="main">)</span> <span class="main">*</span> <span class="main">⟨</span><span class="free">v</span><span class="main">|</span><span class="free">v</span><span class="main">⟩</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> inner_prod_distrib_left<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">v</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">⟨</span><span class="free">v</span><span class="main">|</span><span class="free">w</span><span class="main">⟩</span><span class="main">/</span><span class="main">⟨</span><span class="free">v</span><span class="main">|</span><span class="free">v</span><span class="main">⟩</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">v</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">⟨</span><span class="free">v</span><span class="main">|</span><span class="free">w</span><span class="main">⟩</span><span class="main">/</span><span class="main">⟨</span><span class="free">v</span><span class="main">|</span><span class="free">v</span><span class="main">⟩</span>"</span></span><span class="main">]</span>
inner_prod_distrib_right<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">v</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">⟨</span><span class="free">v</span><span class="main">|</span><span class="free">w</span><span class="main">⟩</span><span class="main">/</span><span class="main">⟨</span><span class="free">v</span><span class="main">|</span><span class="free">v</span><span class="main">⟩</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">w</span> <span class="main">+</span> <span class="main">-</span><span class="main">⟨</span><span class="free">v</span><span class="main">|</span><span class="free">w</span><span class="main">⟩</span><span class="main">/</span><span class="main">⟨</span><span class="free">v</span><span class="main">|</span><span class="free">v</span><span class="main">⟩</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">v</span><span class="main">|</span><span class="free">w</span> <span class="main">+</span> <span class="main">-</span><span class="main">⟨</span><span class="free">v</span><span class="main">|</span><span class="free">w</span><span class="main">⟩</span><span class="main">/</span><span class="main">⟨</span><span class="free">v</span><span class="main">|</span><span class="free">v</span><span class="main">⟩</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">v</span><span class="main">⟩</span> <span class="main">=</span> <span class="main">⟨</span><span class="free">w</span><span class="main">|</span><span class="free">w</span><span class="main">⟩</span> <span class="main">-</span>  cmod<span class="main">(</span><span class="main">⟨</span><span class="free">v</span><span class="main">|</span><span class="free">w</span><span class="main">⟩</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span> <span class="main">/</span> <span class="main">⟨</span><span class="free">v</span><span class="main">|</span><span class="free">v</span><span class="main">⟩</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> inner_prod_cnj<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">w</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span>"</span></span><span class="main">]</span> inner_prod_cnj<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">v</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span>"</span></span><span class="main">]</span> assms<span class="main">(</span>1<span class="main">)</span> complex_norm_square <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">w</span><span class="main">|</span><span class="free">w</span><span class="main">⟩</span> <span class="main">=</span> cmod<span class="main">(</span><span class="main">⟨</span><span class="free">v</span><span class="main">|</span><span class="free">w</span><span class="main">⟩</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span> <span class="main">/</span> <span class="main">⟨</span><span class="free">v</span><span class="main">|</span><span class="free">v</span><span class="main">⟩</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> inner_prod_with_itself_real <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">metis</span> Reals_mult c1 nonzero_mult_div_cancel_left of_real_Re<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">w</span> <span class="main">+</span> <span class="main">-</span><span class="main">⟨</span><span class="free">v</span><span class="main">|</span><span class="free">w</span><span class="main">⟩</span><span class="main">/</span><span class="main">⟨</span><span class="free">v</span><span class="main">|</span><span class="free">v</span><span class="main">⟩</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">v</span><span class="main">|</span><span class="free">w</span> <span class="main">+</span> <span class="main">-</span><span class="main">⟨</span><span class="free">v</span><span class="main">|</span><span class="free">w</span><span class="main">⟩</span><span class="main">/</span><span class="main">⟨</span><span class="free">v</span><span class="main">|</span><span class="free">v</span><span class="main">⟩</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">v</span><span class="main">⟩</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span><span class="main">&lt;</span>dim_vec <span class="free">w</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">w</span> <span class="main">+</span> <span class="main">-</span><span class="main">⟨</span><span class="free">v</span><span class="main">|</span><span class="free">w</span><span class="main">⟩</span><span class="main">/</span><span class="main">⟨</span><span class="free">v</span><span class="main">|</span><span class="free">v</span><span class="main">⟩</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">v</span><span class="main">)</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> f0 index_add_vec<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> index_zero_vec<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> inner_prod_with_itself_nonneg_reals_non0<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span><span class="main">&lt;</span>dim_vec <span class="free">w</span> <span class="main">⟹</span> <span class="free">w</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">+</span> <span class="main">-</span><span class="main">⟨</span><span class="free">v</span><span class="main">|</span><span class="free">w</span><span class="main">⟩</span><span class="main">/</span><span class="main">⟨</span><span class="free">v</span><span class="main">|</span><span class="free">v</span><span class="main">⟩</span> <span class="main">*</span> <span class="free">v</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> f0 index_add_vec<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> index_smult_vec<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span><span class="main">&lt;</span>dim_vec <span class="free">w</span> <span class="main">⟹</span> <span class="free">w</span> <span class="main">$</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">⟨</span><span class="free">v</span><span class="main">|</span><span class="free">w</span><span class="main">⟩</span><span class="main">/</span><span class="main">⟨</span><span class="free">v</span><span class="main">|</span><span class="free">v</span><span class="main">⟩</span> <span class="main">*</span> <span class="free">v</span> <span class="main">$</span> <span class="bound">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">=</span> <span class="main">⟨</span><span class="free">v</span><span class="main">|</span><span class="free">w</span><span class="main">⟩</span><span class="main">/</span><span class="main">⟨</span><span class="free">v</span><span class="main">|</span><span class="free">v</span><span class="main">⟩</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹The No-Cloning Theorem›</span></span>

<span class="keyword1" id="No_Cloning-eq_from_inner_prod"><span class="command">lemma</span></span> eq_from_inner_prod <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"dim_vec <span class="free">v</span> <span class="main">=</span> dim_vec <span class="free">w</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">v</span><span class="main">|</span><span class="free">w</span><span class="main">⟩</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">v</span><span class="main">|</span><span class="free">v</span><span class="main">⟩</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">w</span><span class="main">|</span><span class="free">w</span><span class="main">⟩</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">=</span> <span class="free">w</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>cmod<span class="main">(</span><span class="main">⟨</span><span class="free">v</span><span class="main">|</span><span class="free">w</span><span class="main">⟩</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">=</span> Re <span class="main">(</span><span class="main">⟨</span><span class="free">v</span><span class="main">|</span><span class="free">v</span><span class="main">⟩</span> <span class="main">*</span> <span class="main">⟨</span><span class="free">w</span><span class="main">|</span><span class="free">w</span><span class="main">⟩</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> f0<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">l</span><span class="main">.</span> <span class="free">v</span> <span class="main">=</span> <span class="main">(</span><span class="bound">l</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">w</span><span class="main">)</span> <span class="main">∨</span> <span class="free">w</span> <span class="main">=</span> <span class="main">(</span><span class="bound">l</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">v</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">l</span><span class="main">.</span> <span class="free">v</span> <span class="main">=</span> <span class="main">(</span><span class="bound">l</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">w</span><span class="main">)</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">l</span><span class="main">.</span> <span class="free">v</span> <span class="main">=</span> <span class="main">(</span><span class="bound">l</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">w</span><span class="main">)</span> <span class="main">∧</span> <span class="main">⟨</span><span class="free">v</span><span class="main">|</span><span class="free">w</span><span class="main">⟩</span> <span class="main">=</span> cnj<span class="main">(</span><span class="bound">l</span><span class="main">)</span> <span class="main">*</span> <span class="main">⟨</span><span class="free">w</span><span class="main">|</span><span class="free">w</span><span class="main">⟩</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> inner_prod_distrib_left <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">,</span></span>4<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">l</span><span class="main">.</span> <span class="free">w</span> <span class="main">=</span> <span class="main">(</span><span class="bound">l</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">v</span><span class="main">)</span> <span class="main">∧</span> <span class="main">⟨</span><span class="free">v</span><span class="main">|</span><span class="free">w</span><span class="main">⟩</span> <span class="main">=</span> <span class="bound">l</span> <span class="main">*</span> <span class="main">⟨</span><span class="free">v</span><span class="main">|</span><span class="free">v</span><span class="main">⟩</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> f0 inner_prod_distrib_right <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">,</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="No_Cloning-hermite_cnj_of_tensor"><span class="command">lemma</span></span> hermite_cnj_of_tensor<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">A</span> <span class="main">⨂</span> <span class="free">B</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span>  <span class="main">=</span> <span class="main">(</span><span class="free">A</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span><span class="main">)</span> <span class="main">⨂</span> <span class="main">(</span><span class="free">B</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> c0<span class="main">:</span><span class="quoted"><span class="quoted">"dim_row <span class="main">(</span><span class="main">(</span><span class="free">A</span> <span class="main">⨂</span> <span class="free">B</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span><span class="main">)</span> <span class="main">=</span> dim_row <span class="main">(</span><span class="main">(</span><span class="free">A</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span><span class="main">)</span> <span class="main">⨂</span> <span class="main">(</span><span class="free">B</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> c1<span class="main">:</span><span class="quoted"><span class="quoted">"dim_col <span class="main">(</span><span class="main">(</span><span class="free">A</span> <span class="main">⨂</span> <span class="free">B</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span><span class="main">)</span> <span class="main">=</span> dim_col <span class="main">(</span><span class="main">(</span><span class="free">A</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span><span class="main">)</span> <span class="main">⨂</span> <span class="main">(</span><span class="free">B</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span> <span class="bound">j</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> dim_row <span class="main">(</span><span class="main">(</span><span class="free">A</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span><span class="main">)</span> <span class="main">⨂</span> <span class="main">(</span><span class="free">B</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> <span class="bound">j</span> <span class="main">&lt;</span> dim_col <span class="main">(</span><span class="main">(</span><span class="free">A</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span><span class="main">)</span> <span class="main">⨂</span> <span class="main">(</span><span class="free">B</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span>
<span class="main">(</span><span class="main">(</span><span class="free">A</span> <span class="main">⨂</span> <span class="free">B</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">A</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span><span class="main">)</span> <span class="main">⨂</span> <span class="main">(</span><span class="free">B</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span><span class="main">)</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span> <span class="keyword3"><span class="command">assume</span></span> a0<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> dim_row <span class="main">(</span><span class="main">(</span><span class="free">A</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span><span class="main">)</span> <span class="main">⨂</span> <span class="main">(</span><span class="free">B</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> dim_col <span class="main">(</span><span class="main">(</span><span class="free">A</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span><span class="main">)</span> <span class="main">⨂</span> <span class="main">(</span><span class="free">B</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">A</span> <span class="main">⨂</span> <span class="free">B</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> cnj<span class="main">(</span><span class="main">(</span><span class="free">A</span> <span class="main">⨂</span> <span class="free">B</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">j</span><span class="main">,</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dagger_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> cnj<span class="main">(</span><span class="free">A</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">j</span> <span class="keyword1">div</span> dim_row<span class="main">(</span><span class="free">B</span><span class="main">)</span><span class="main">,</span> <span class="skolem">i</span> <span class="keyword1">div</span> dim_col<span class="main">(</span><span class="free">B</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="free">B</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">j</span> <span class="keyword1">mod</span> dim_row<span class="main">(</span><span class="free">B</span><span class="main">)</span><span class="main">,</span> <span class="skolem">i</span> <span class="keyword1">mod</span> dim_col<span class="main">(</span><span class="free">B</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> a0 a1 c1 dim_row_tensor_mat dim_col_of_dagger dim_row_of_dagger
index_tensor_mat less_nat_zero_code mult_not_zero neq0_conv<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">A</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span><span class="main">)</span> <span class="main">⨂</span> <span class="main">(</span><span class="free">B</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span><span class="main">)</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">=</span>
<span class="main">(</span><span class="free">A</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span> <span class="keyword1">div</span> dim_col<span class="main">(</span><span class="free">B</span><span class="main">)</span><span class="main">,</span> <span class="skolem">j</span> <span class="keyword1">div</span> dim_row<span class="main">(</span><span class="free">B</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">B</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span> <span class="keyword1">mod</span> dim_col<span class="main">(</span><span class="free">B</span><span class="main">)</span><span class="main">,</span> <span class="skolem">j</span> <span class="keyword1">mod</span> dim_row<span class="main">(</span><span class="free">B</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> a0 a1 c1 dim_row_tensor_mat dim_col_of_dagger dim_row_of_dagger index_tensor_mat
less_nat_zero_code mult_eq_0_iff neq0_conv<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">B</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span> <span class="keyword1">mod</span> dim_col<span class="main">(</span><span class="free">B</span><span class="main">)</span><span class="main">,</span> <span class="skolem">j</span> <span class="keyword1">mod</span> dim_row<span class="main">(</span><span class="free">B</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> cnj<span class="main">(</span><span class="free">B</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">j</span> <span class="keyword1">mod</span> dim_row<span class="main">(</span><span class="free">B</span><span class="main">)</span><span class="main">,</span> <span class="skolem">i</span> <span class="keyword1">mod</span> dim_col<span class="main">(</span><span class="free">B</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="keyword1">mod</span> dim_col<span class="main">(</span><span class="free">B</span><span class="main">)</span> <span class="main">&lt;</span> dim_col<span class="main">(</span><span class="free">B</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> a0 gr_implies_not_zero mod_div_trivial <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="keyword1">mod</span> dim_row<span class="main">(</span><span class="free">B</span><span class="main">)</span> <span class="main">&lt;</span> dim_row<span class="main">(</span><span class="free">B</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> a1 gr_implies_not_zero mod_div_trivial <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dagger_def<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">A</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span> <span class="keyword1">div</span> dim_col<span class="main">(</span><span class="free">B</span><span class="main">)</span><span class="main">,</span> <span class="skolem">j</span> <span class="keyword1">div</span> dim_row<span class="main">(</span><span class="free">B</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> cnj<span class="main">(</span><span class="free">A</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">j</span> <span class="keyword1">div</span> dim_row<span class="main">(</span><span class="free">B</span><span class="main">)</span><span class="main">,</span> <span class="skolem">i</span> <span class="keyword1">div</span> dim_col<span class="main">(</span><span class="free">B</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="keyword1">div</span> dim_col<span class="main">(</span><span class="free">B</span><span class="main">)</span> <span class="main">&lt;</span> dim_col<span class="main">(</span><span class="free">A</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> a0 dagger_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_mult_imp_div_less<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="keyword1">div</span> dim_row<span class="main">(</span><span class="free">B</span><span class="main">)</span> <span class="main">&lt;</span> dim_row<span class="main">(</span><span class="free">A</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> a1 dagger_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_mult_imp_div_less<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dagger_def<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">A</span> <span class="main">⨂</span> <span class="free">B</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">A</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span><span class="main">)</span> <span class="main">⨂</span> <span class="main">(</span><span class="free">B</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span><span class="main">)</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">locale</span></span> quantum_machine <span class="main">=</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">n</span><span class="main">::</span> <span class="quoted">nat</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">s</span><span class="main">::</span> <span class="quoted"><span class="quoted">"complex Matrix.vec"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">U</span><span class="main">::</span> <span class="quoted"><span class="quoted">"complex Matrix.mat"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> dim_vec <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"dim_vec <span class="free">s</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> dim_col <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"dim_col <span class="free">U</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span> <span class="main">*</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> square <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"square_mat <span class="free">U</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> unitary <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"unitary <span class="free">U</span>"</span></span>

<span class="keyword1" id="No_Cloning-inner_prod_of_unit_vec"><span class="command">lemma</span></span> inner_prod_of_unit_vec<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">n</span> <span class="free">i</span><span class="main">::</span> <span class="quoted">nat</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span>unit_vec <span class="free">n</span> <span class="free">i</span><span class="main">|</span> unit_vec <span class="free">n</span> <span class="free">i</span><span class="main">⟩</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inner_prod_def unit_vec_def<span class="main">)</span>
    <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms sum.cong<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">}</span>"</span></span>
        <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">j</span><span class="main">.</span> cnj <span class="main">(</span><span class="keyword1">if</span> <span class="bound">j</span> <span class="main">=</span> <span class="free">i</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">j</span> <span class="main">=</span> <span class="free">i</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">j</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">j</span> <span class="main">=</span> <span class="free">i</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">theorem</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> quantum_machine<span class="main">)</span> no_cloning<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"dim_vec <span class="free">v</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"dim_vec <span class="free">w</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    cloning1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s</span><span class="main">.</span> <span class="free">U</span> <span class="main">*</span> <span class="main">(</span> <span class="main">|</span><span class="free">v</span><span class="main">⟩</span> <span class="main">⨂</span> <span class="main">|</span><span class="bound">s</span><span class="main">⟩</span><span class="main">)</span> <span class="main">=</span> <span class="main">|</span><span class="free">v</span><span class="main">⟩</span> <span class="main">⨂</span> <span class="main">|</span><span class="free">v</span><span class="main">⟩</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    cloning2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s</span><span class="main">.</span> <span class="free">U</span> <span class="main">*</span> <span class="main">(</span> <span class="main">|</span><span class="free">w</span><span class="main">⟩</span> <span class="main">⨂</span> <span class="main">|</span><span class="bound">s</span><span class="main">⟩</span><span class="main">)</span> <span class="main">=</span> <span class="main">|</span><span class="free">w</span><span class="main">⟩</span> <span class="main">⨂</span> <span class="main">|</span><span class="free">w</span><span class="main">⟩</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">v</span><span class="main">|</span><span class="free">v</span><span class="main">⟩</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">w</span><span class="main">|</span><span class="free">w</span><span class="main">⟩</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">=</span> <span class="free">w</span> <span class="main">∨</span> <span class="main">⟨</span><span class="free">v</span><span class="main">|</span><span class="free">w</span><span class="main">⟩</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">s</span></span><span class="main">::</span> <span class="quoted"><span class="quoted">"complex Matrix.vec"</span></span> <span class="keyword2"><span class="keyword">where</span></span> d0<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">=</span> unit_vec <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">)</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> f0<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="main">|</span><span class="free">v</span><span class="main">⟩</span><span class="main">|</span> <span class="main">⨂</span> <span class="main">⟨</span><span class="main">|</span><span class="skolem">s</span><span class="main">⟩</span><span class="main">|</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span> <span class="main">|</span><span class="free">v</span><span class="main">⟩</span> <span class="main">⨂</span> <span class="main">|</span><span class="skolem">s</span><span class="main">⟩</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> hermite_cnj_of_tensor<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="free">v</span><span class="main">⟩</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="skolem">s</span><span class="main">⟩</span>"</span></span><span class="main">]</span> bra_def dagger_def ket_vec_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> f1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span> <span class="main">|</span><span class="free">v</span><span class="main">⟩</span> <span class="main">⨂</span> <span class="main">|</span><span class="free">v</span><span class="main">⟩</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span> <span class="main">*</span> <span class="main">(</span> <span class="main">|</span><span class="free">w</span><span class="main">⟩</span> <span class="main">⨂</span> <span class="main">|</span><span class="free">w</span><span class="main">⟩</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⟨</span><span class="main">|</span><span class="free">v</span><span class="main">⟩</span><span class="main">|</span> <span class="main">⨂</span> <span class="main">⟨</span><span class="main">|</span><span class="skolem">s</span><span class="main">⟩</span><span class="main">|</span> <span class="main">)</span> <span class="main">*</span> <span class="main">(</span> <span class="main">|</span><span class="free">w</span><span class="main">⟩</span> <span class="main">⨂</span> <span class="main">|</span><span class="skolem">s</span><span class="main">⟩</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">U</span> <span class="main">*</span> <span class="main">(</span> <span class="main">|</span><span class="free">v</span><span class="main">⟩</span> <span class="main">⨂</span> <span class="main">|</span><span class="skolem">s</span><span class="main">⟩</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span> <span class="main">=</span> <span class="main">(</span><span class="main">⟨</span><span class="main">|</span><span class="free">v</span><span class="main">⟩</span><span class="main">|</span> <span class="main">⨂</span> <span class="main">⟨</span><span class="main">|</span><span class="skolem">s</span><span class="main">⟩</span><span class="main">|</span> <span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">U</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> dagger_of_prod<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">U</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="free">v</span><span class="main">⟩</span> <span class="main">⨂</span> <span class="main">|</span><span class="skolem">s</span><span class="main">⟩</span>"</span></span><span class="main">]</span> f0 d0 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ket_vec_def<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">U</span> <span class="main">*</span> <span class="main">(</span> <span class="main">|</span><span class="free">v</span><span class="main">⟩</span> <span class="main">⨂</span> <span class="main">|</span><span class="skolem">s</span><span class="main">⟩</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span> <span class="main">*</span> <span class="free">U</span> <span class="main">*</span> <span class="main">(</span> <span class="main">|</span><span class="free">w</span><span class="main">⟩</span> <span class="main">⨂</span> <span class="main">|</span><span class="skolem">s</span><span class="main">⟩</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⟨</span><span class="main">|</span><span class="free">v</span><span class="main">⟩</span><span class="main">|</span> <span class="main">⨂</span> <span class="main">⟨</span><span class="main">|</span><span class="skolem">s</span><span class="main">⟩</span><span class="main">|</span> <span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">U</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span><span class="main">)</span> <span class="main">*</span> <span class="free">U</span> <span class="main">*</span> <span class="main">(</span> <span class="main">|</span><span class="free">w</span><span class="main">⟩</span> <span class="main">⨂</span> <span class="main">|</span><span class="skolem">s</span><span class="main">⟩</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">U</span> <span class="main">*</span> <span class="main">(</span> <span class="main">|</span><span class="free">v</span><span class="main">⟩</span> <span class="main">⨂</span> <span class="main">|</span><span class="skolem">s</span><span class="main">⟩</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span> <span class="main">*</span> <span class="free">U</span> <span class="main">*</span> <span class="main">(</span> <span class="main">|</span><span class="free">w</span><span class="main">⟩</span> <span class="main">⨂</span> <span class="main">|</span><span class="skolem">s</span><span class="main">⟩</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span> <span class="main">|</span><span class="free">v</span><span class="main">⟩</span> <span class="main">⨂</span> <span class="main">|</span><span class="free">v</span><span class="main">⟩</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span> <span class="main">|</span><span class="free">w</span><span class="main">⟩</span> <span class="main">⨂</span> <span class="main">|</span><span class="free">w</span><span class="main">⟩</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2-4<span class="main">)</span> d0 unit_vec_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> Matrix.dim_vec assoc_mult_mat carrier_mat_triv dim_row_mat<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span>
dim_row_tensor_mat dim_col_of_dagger index_mult_mat<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> ket_vec_def square square_mat.elims<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">U</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span><span class="main">)</span> <span class="main">*</span> <span class="free">U</span> <span class="main">=</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>m</sub></span> <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="free">n</span> <span class="main">*</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> unitary_def dim_col unitary <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="main">|</span><span class="free">v</span><span class="main">⟩</span><span class="main">|</span> <span class="main">⨂</span> <span class="main">⟨</span><span class="main">|</span><span class="skolem">s</span><span class="main">⟩</span><span class="main">|</span> <span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">U</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span><span class="main">)</span> <span class="main">*</span> <span class="free">U</span> <span class="main">=</span> <span class="main">(</span><span class="main">⟨</span><span class="main">|</span><span class="free">v</span><span class="main">⟩</span><span class="main">|</span> <span class="main">⨂</span> <span class="main">⟨</span><span class="main">|</span><span class="skolem">s</span><span class="main">⟩</span><span class="main">|</span> <span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="free">U</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span><span class="main">)</span> <span class="main">*</span> <span class="free">U</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> d0 assms<span class="main">(</span>1<span class="main">)</span> unit_vec_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> Matrix.dim_vec assoc_mult_mat carrier_mat_triv dim_row_mat<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span>
dim_row_tensor_mat f0 dim_col_of_dagger dim_row_of_dagger ket_vec_def local.dim_col<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="main">|</span><span class="free">v</span><span class="main">⟩</span><span class="main">|</span> <span class="main">⨂</span> <span class="main">⟨</span><span class="main">|</span><span class="skolem">s</span><span class="main">⟩</span><span class="main">|</span> <span class="main">)</span> <span class="main">*</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>m</sub></span> <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="free">n</span> <span class="main">*</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⟨</span><span class="main">|</span><span class="free">v</span><span class="main">⟩</span><span class="main">|</span> <span class="main">⨂</span> <span class="main">⟨</span><span class="main">|</span><span class="skolem">s</span><span class="main">⟩</span><span class="main">|</span> <span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> f0 ket_vec_def d0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> f2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="main">|</span><span class="free">v</span><span class="main">⟩</span><span class="main">|</span> <span class="main">*</span> <span class="main">|</span><span class="free">w</span><span class="main">⟩</span><span class="main">)</span> <span class="main">⨂</span> <span class="main">(</span><span class="main">⟨</span><span class="main">|</span><span class="free">v</span><span class="main">⟩</span><span class="main">|</span> <span class="main">*</span> <span class="main">|</span><span class="free">w</span><span class="main">⟩</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⟨</span><span class="main">|</span><span class="free">v</span><span class="main">⟩</span><span class="main">|</span> <span class="main">*</span> <span class="main">|</span><span class="free">w</span><span class="main">⟩</span><span class="main">)</span> <span class="main">⨂</span> <span class="main">(</span><span class="main">⟨</span><span class="main">|</span><span class="skolem">s</span><span class="main">⟩</span><span class="main">|</span> <span class="main">*</span> <span class="main">|</span><span class="skolem">s</span><span class="main">⟩</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="main">|</span><span class="free">v</span><span class="main">⟩</span><span class="main">|</span> <span class="main">⨂</span> <span class="main">⟨</span><span class="main">|</span><span class="free">v</span><span class="main">⟩</span><span class="main">|</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span> <span class="main">|</span><span class="free">v</span><span class="main">⟩</span> <span class="main">⨂</span> <span class="main">|</span><span class="free">v</span><span class="main">⟩</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> hermite_cnj_of_tensor<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="free">v</span><span class="main">⟩</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="free">v</span><span class="main">⟩</span>"</span></span><span class="main">]</span> bra_def dagger_def ket_vec_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> f1 d0 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bra_def mult_distr_tensor ket_vec_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">v</span><span class="main">|</span><span class="free">w</span><span class="main">⟩</span> <span class="main">*</span> <span class="main">⟨</span><span class="free">v</span><span class="main">|</span><span class="free">w</span><span class="main">⟩</span> <span class="main">=</span> <span class="main">⟨</span><span class="free">v</span><span class="main">|</span><span class="free">w</span><span class="main">⟩</span> <span class="main">*</span> <span class="main">⟨</span><span class="skolem">s</span><span class="main">|</span><span class="skolem">s</span><span class="main">⟩</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">⟨</span><span class="main">|</span><span class="free">v</span><span class="main">⟩</span><span class="main">|</span> <span class="main">*</span> <span class="main">|</span><span class="free">w</span><span class="main">⟩</span><span class="main">)</span> <span class="main">⨂</span> <span class="main">(</span><span class="main">⟨</span><span class="main">|</span><span class="free">v</span><span class="main">⟩</span><span class="main">|</span> <span class="main">*</span> <span class="main">|</span><span class="free">w</span><span class="main">⟩</span><span class="main">)</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">⟨</span><span class="free">v</span><span class="main">|</span><span class="free">w</span><span class="main">⟩</span> <span class="main">*</span> <span class="main">⟨</span><span class="free">v</span><span class="main">|</span><span class="free">w</span><span class="main">⟩</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms inner_prod_with_times_mat<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">v</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bra_def ket_vec_def<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">⟨</span><span class="main">|</span><span class="free">v</span><span class="main">⟩</span><span class="main">|</span> <span class="main">*</span> <span class="main">|</span><span class="free">w</span><span class="main">⟩</span><span class="main">)</span> <span class="main">⨂</span> <span class="main">(</span><span class="main">⟨</span><span class="main">|</span><span class="skolem">s</span><span class="main">⟩</span><span class="main">|</span> <span class="main">*</span> <span class="main">|</span><span class="skolem">s</span><span class="main">⟩</span><span class="main">)</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">⟨</span><span class="free">v</span><span class="main">|</span><span class="free">w</span><span class="main">⟩</span> <span class="main">*</span> <span class="main">⟨</span><span class="skolem">s</span><span class="main">|</span><span class="skolem">s</span><span class="main">⟩</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> inner_prod_with_times_mat<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">v</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span>"</span></span><span class="main">]</span> inner_prod_with_times_mat<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bra_def ket_vec_def<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> f2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">v</span><span class="main">|</span><span class="free">w</span><span class="main">⟩</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="main">⟨</span><span class="free">v</span><span class="main">|</span><span class="free">w</span><span class="main">⟩</span> <span class="main">=</span> <span class="main">⟨</span><span class="skolem">s</span><span class="main">|</span><span class="skolem">s</span><span class="main">⟩</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_left_cancel<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="skolem">s</span><span class="main">|</span><span class="skolem">s</span><span class="main">⟩</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> d0 inner_prod_of_unit_vec<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">,</span>2<span class="main">,</span>5<span class="main">,</span>6<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="Quantum_Prisoners_Dilemma">
<div class="head">
<h1>Theory Quantum_Prisoners_Dilemma</h1>
</div>
<pre class="source"><span class="comment1">(*
authors:
  Yijun He, University of Cambridge, yh403@cam.ac.uk
  with contributions by Anthony Bordg and Hanna Lachnitt.
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Quantum Prisoner's Dilemma›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Quantum_Prisoners_Dilemma
<span class="keyword2"><span class="keyword">imports</span></span>
  <a href="#More_Tensor">More_Tensor</a>
  <a href="#Measurement">Measurement</a>
  <a href="#Basics">Basics</a>
<span class="keyword2"><span class="keyword">begin</span></span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
In the 2-parameter strategic space of Eisert, Wilkens and Lewenstein [EWL], Prisoner's Dilemma 
ceases to pose a dilemma if quantum strategies are allowed for. Indeed, Alice and Bob both choosing 
to defect is no longer a Nash equilibrium. However, a new Nash equilibrium appears which is at the 
same time Pareto optimal. Moreover, there exists a quantum strategy which always gives reward if 
played against any classical strategy. 
Below the parameter <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">"γ"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> can be seen as a measure of the game's entanglement. The game behaves 
classically if <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">"γ"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> = 0, and for the maximally entangled case (<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">"γ"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> = 2*$\pi$) the dilemma disappears
as pointed out above.   
›</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹The Set-Up›</span></span>

<span class="keyword1"><span class="command">locale</span></span> prisoner <span class="main">=</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">γ</span><span class="main">::</span> <span class="quoted"><span class="quoted">"real"</span></span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">γ</span> <span class="main">≤</span> pi<span class="main">/</span><span class="numeral">2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">γ</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> prisoner<span class="main">)</span> <span class="entity">J</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"complex Matrix.mat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">J</span> <span class="main">≡</span> mat_of_cols_list <span class="numeral">4</span>  <span class="main">[</span><span class="main">[</span>cos<span class="main">(</span><span class="free">γ</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="keyword1">𝗂</span><span class="main">*</span>sin<span class="main">(</span><span class="free">γ</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">]</span><span class="main">,</span>
                          <span class="main">[</span><span class="main">0</span><span class="main">,</span> cos<span class="main">(</span><span class="free">γ</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">,</span> <span class="main">-</span><span class="keyword1">𝗂</span><span class="main">*</span>sin<span class="main">(</span><span class="free">γ</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">,</span> <span class="main">0</span><span class="main">]</span><span class="main">,</span>
                          <span class="main">[</span><span class="main">0</span><span class="main">,</span> <span class="main">-</span><span class="keyword1">𝗂</span><span class="main">*</span>sin<span class="main">(</span><span class="free">γ</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">,</span> cos<span class="main">(</span><span class="free">γ</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">,</span> <span class="main">0</span><span class="main">]</span><span class="main">,</span>
                          <span class="main">[</span><span class="keyword1">𝗂</span><span class="main">*</span>sin<span class="main">(</span><span class="free">γ</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> cos<span class="main">(</span><span class="free">γ</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">]</span><span class="main">]</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> prisoner<span class="main">)</span> <span class="entity">ψ<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"complex Matrix.mat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">ψ<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≡</span> mat_of_cols_list <span class="numeral">4</span> <span class="main">[</span><span class="main">[</span>cos<span class="main">(</span><span class="free">γ</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="keyword1">𝗂</span><span class="main">*</span>sin<span class="main">(</span><span class="free">γ</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">]</span><span class="main">]</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> prisoner<span class="main">)</span> psi_one<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"J <span class="main">*</span> <span class="main">|</span>unit_vec <span class="numeral">4</span> <span class="main">0</span><span class="main">⟩</span> <span class="main">=</span> ψ<span class="hidden">⇩</span><sub>1</sub>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span> <span class="keyword3"><span class="command">assume</span></span> a0<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> dim_row ψ<span class="hidden">⇩</span><sub>1</sub>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> dim_col ψ<span class="hidden">⇩</span><sub>1</sub>"</span></span>      
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>J <span class="main">*</span> <span class="main">|</span>unit_vec <span class="numeral">4</span> <span class="main">0</span><span class="main">⟩</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">&lt;</span><span class="numeral">4</span><span class="main">.</span> <span class="main">(</span>J <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span> <span class="main">|</span>unit_vec <span class="numeral">4</span> <span class="main">0</span><span class="main">⟩</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> mat_of_cols_list_def ket_vec_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span>J <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span> <span class="main">|</span>unit_vec <span class="numeral">4</span> <span class="main">0</span><span class="main">⟩</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> set_4 atLeast0LessThan <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> ψ<span class="hidden">⇩</span><sub>1</sub> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">}</span> <span class="main">∧</span> <span class="skolem">j</span><span class="main">=</span><span class="main">0</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> a0 a1 mat_of_cols_list_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> mat_of_cols_list_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>J <span class="main">*</span> <span class="main">|</span>unit_vec <span class="numeral">4</span> <span class="main">0</span><span class="main">⟩</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> ψ<span class="hidden">⇩</span><sub>1</sub> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span> 
  <span class="keyword3"><span class="command">show</span></span>  <span class="quoted"><span class="quoted">"dim_row <span class="main">(</span>J <span class="main">*</span> <span class="main">|</span>unit_vec <span class="numeral">4</span> <span class="main">0</span><span class="main">⟩</span><span class="main">)</span> <span class="main">=</span> dim_row ψ<span class="hidden">⇩</span><sub>1</sub>"</span></span>  
    <span class="keyword1"><span class="command">using</span></span> mat_of_cols_list_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span>  <span class="quoted"><span class="quoted">"dim_col <span class="main">(</span>J<span class="main">*</span><span class="main">|</span>unit_vec <span class="numeral">4</span> <span class="main">0</span><span class="main">⟩</span><span class="main">)</span> <span class="main">=</span> dim_col ψ<span class="hidden">⇩</span><sub>1</sub>"</span></span>  
    <span class="keyword1"><span class="command">using</span></span> mat_of_cols_list_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ket_vec_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">locale</span></span> strategic_space_2p <span class="main">=</span> prisoner <span class="main">+</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">θ<span class="hidden">⇩</span><sub>A</sub></span><span class="main">::</span> <span class="quoted"><span class="quoted">"real"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">φ<span class="hidden">⇩</span><sub>A</sub></span><span class="main">::</span> <span class="quoted"><span class="quoted">"real"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">θ<span class="hidden">⇩</span><sub>B</sub></span><span class="main">::</span> <span class="quoted"><span class="quoted">"real"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">φ<span class="hidden">⇩</span><sub>B</sub></span><span class="main">::</span> <span class="quoted"><span class="quoted">"real"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="free">θ<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">∧</span> <span class="free">θ<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">≤</span> pi"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="free">φ<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">∧</span> <span class="free">φ<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">≤</span> pi<span class="main">/</span><span class="numeral">2</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="free">θ<span class="hidden">⇩</span><sub>B</sub></span> <span class="main">∧</span> <span class="free">θ<span class="hidden">⇩</span><sub>B</sub></span> <span class="main">≤</span> pi"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="free">φ<span class="hidden">⇩</span><sub>B</sub></span> <span class="main">∧</span> <span class="free">φ<span class="hidden">⇩</span><sub>B</sub></span> <span class="main">≤</span> pi<span class="main">/</span><span class="numeral">2</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> strategic_space_2p<span class="main">)</span> <span class="entity">U<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"complex Matrix.mat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">U<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">≡</span> mat_of_cols_list <span class="numeral">2</span> <span class="main">[</span><span class="main">[</span>exp<span class="main">(</span><span class="keyword1">𝗂</span><span class="main">*</span><span class="free">φ<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span><span class="main">*</span>cos<span class="main">(</span><span class="free">θ<span class="hidden">⇩</span><sub>A</sub></span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">,</span> <span class="main">-</span>sin<span class="main">(</span><span class="free">θ<span class="hidden">⇩</span><sub>A</sub></span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">]</span><span class="main">,</span>
                           <span class="main">[</span>sin<span class="main">(</span><span class="free">θ<span class="hidden">⇩</span><sub>A</sub></span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">,</span> exp<span class="main">(</span><span class="main">-</span><span class="keyword1">𝗂</span><span class="main">*</span><span class="free">φ<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span><span class="main">*</span>cos<span class="main">(</span><span class="free">θ<span class="hidden">⇩</span><sub>A</sub></span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">]</span><span class="main">]</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> strategic_space_2p<span class="main">)</span> <span class="entity">U<span class="hidden">⇩</span><sub>B</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"complex Matrix.mat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">U<span class="hidden">⇩</span><sub>B</sub></span> <span class="main">≡</span> mat_of_cols_list <span class="numeral">2</span> <span class="main">[</span><span class="main">[</span>exp<span class="main">(</span><span class="keyword1">𝗂</span><span class="main">*</span><span class="free">φ<span class="hidden">⇩</span><sub>B</sub></span><span class="main">)</span><span class="main">*</span>cos<span class="main">(</span><span class="free">θ<span class="hidden">⇩</span><sub>B</sub></span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">,</span> <span class="main">-</span>sin<span class="main">(</span><span class="free">θ<span class="hidden">⇩</span><sub>B</sub></span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">]</span><span class="main">,</span>
                           <span class="main">[</span>sin<span class="main">(</span><span class="free">θ<span class="hidden">⇩</span><sub>B</sub></span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">,</span> exp<span class="main">(</span><span class="main">-</span><span class="keyword1">𝗂</span><span class="main">*</span><span class="free">φ<span class="hidden">⇩</span><sub>B</sub></span><span class="main">)</span><span class="main">*</span>cos<span class="main">(</span><span class="free">θ<span class="hidden">⇩</span><sub>B</sub></span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">]</span><span class="main">]</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> strategic_space_2p<span class="main">)</span> <span class="entity">ψ<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"complex Matrix.mat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">ψ<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">≡</span> 
mat_of_cols_list <span class="numeral">4</span> <span class="main">[</span><span class="main">[</span>exp<span class="main">(</span><span class="keyword1">𝗂</span><span class="main">*</span><span class="free">φ<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span><span class="main">*</span>cos<span class="main">(</span><span class="free">θ<span class="hidden">⇩</span><sub>A</sub></span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> exp<span class="main">(</span><span class="keyword1">𝗂</span><span class="main">*</span><span class="free">φ<span class="hidden">⇩</span><sub>B</sub></span><span class="main">)</span><span class="main">*</span>cos<span class="main">(</span><span class="free">θ<span class="hidden">⇩</span><sub>B</sub></span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> cos<span class="main">(</span><span class="free">γ</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">+</span> sin<span class="main">(</span><span class="free">θ<span class="hidden">⇩</span><sub>A</sub></span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> sin<span class="main">(</span><span class="free">θ<span class="hidden">⇩</span><sub>B</sub></span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="keyword1">𝗂</span><span class="main">*</span>sin<span class="main">(</span><span class="free">γ</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">,</span>
                     exp<span class="main">(</span><span class="keyword1">𝗂</span><span class="main">*</span><span class="free">φ<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span><span class="main">*</span>cos<span class="main">(</span><span class="free">θ<span class="hidden">⇩</span><sub>A</sub></span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="main">-</span>sin<span class="main">(</span><span class="free">θ<span class="hidden">⇩</span><sub>B</sub></span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> cos<span class="main">(</span><span class="free">γ</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">+</span> sin<span class="main">(</span><span class="free">θ<span class="hidden">⇩</span><sub>A</sub></span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> exp<span class="main">(</span><span class="main">-</span><span class="keyword1">𝗂</span><span class="main">*</span><span class="free">φ<span class="hidden">⇩</span><sub>B</sub></span><span class="main">)</span><span class="main">*</span>cos<span class="main">(</span><span class="free">θ<span class="hidden">⇩</span><sub>B</sub></span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="keyword1">𝗂</span><span class="main">*</span>sin<span class="main">(</span><span class="free">γ</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">,</span>
                     <span class="main">-</span>sin<span class="main">(</span><span class="free">θ<span class="hidden">⇩</span><sub>A</sub></span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> exp<span class="main">(</span><span class="keyword1">𝗂</span><span class="main">*</span><span class="free">φ<span class="hidden">⇩</span><sub>B</sub></span><span class="main">)</span><span class="main">*</span>cos<span class="main">(</span><span class="free">θ<span class="hidden">⇩</span><sub>B</sub></span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> cos<span class="main">(</span><span class="free">γ</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">+</span> exp<span class="main">(</span><span class="main">-</span><span class="keyword1">𝗂</span><span class="main">*</span><span class="free">φ<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span><span class="main">*</span>cos<span class="main">(</span><span class="free">θ<span class="hidden">⇩</span><sub>A</sub></span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> sin<span class="main">(</span><span class="free">θ<span class="hidden">⇩</span><sub>B</sub></span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="keyword1">𝗂</span><span class="main">*</span>sin<span class="main">(</span><span class="free">γ</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">,</span>
                     sin<span class="main">(</span><span class="free">θ<span class="hidden">⇩</span><sub>A</sub></span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> sin<span class="main">(</span><span class="free">θ<span class="hidden">⇩</span><sub>B</sub></span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> cos<span class="main">(</span><span class="free">γ</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">+</span> exp<span class="main">(</span><span class="main">-</span><span class="keyword1">𝗂</span><span class="main">*</span><span class="free">φ<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span><span class="main">*</span>cos<span class="main">(</span><span class="free">θ<span class="hidden">⇩</span><sub>A</sub></span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> exp<span class="main">(</span><span class="main">-</span><span class="keyword1">𝗂</span><span class="main">*</span><span class="free">φ<span class="hidden">⇩</span><sub>B</sub></span><span class="main">)</span><span class="main">*</span>cos<span class="main">(</span><span class="free">θ<span class="hidden">⇩</span><sub>B</sub></span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="keyword1">𝗂</span><span class="main">*</span>sin<span class="main">(</span><span class="free">γ</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">]</span><span class="main">]</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> strategic_space_2p<span class="main">)</span> <span class="entity">U<span class="hidden">⇩</span><sub>A</sub><span class="hidden">⇩</span><sub>B</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"complex Matrix.mat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">U<span class="hidden">⇩</span><sub>A</sub><span class="hidden">⇩</span><sub>B</sub></span> <span class="main">≡</span> 
mat_of_cols_list <span class="numeral">4</span> <span class="main">[</span><span class="main">[</span>exp<span class="main">(</span><span class="keyword1">𝗂</span><span class="main">*</span><span class="free">φ<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span><span class="main">*</span>cos<span class="main">(</span><span class="free">θ<span class="hidden">⇩</span><sub>A</sub></span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> exp<span class="main">(</span><span class="keyword1">𝗂</span><span class="main">*</span><span class="free">φ<span class="hidden">⇩</span><sub>B</sub></span><span class="main">)</span><span class="main">*</span>cos<span class="main">(</span><span class="free">θ<span class="hidden">⇩</span><sub>B</sub></span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">,</span> exp<span class="main">(</span><span class="keyword1">𝗂</span><span class="main">*</span><span class="free">φ<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span><span class="main">*</span>cos<span class="main">(</span><span class="free">θ<span class="hidden">⇩</span><sub>A</sub></span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="main">-</span>sin<span class="main">(</span><span class="free">θ<span class="hidden">⇩</span><sub>B</sub></span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">,</span>
                            <span class="main">-</span>sin<span class="main">(</span><span class="free">θ<span class="hidden">⇩</span><sub>A</sub></span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> exp<span class="main">(</span><span class="keyword1">𝗂</span><span class="main">*</span><span class="free">φ<span class="hidden">⇩</span><sub>B</sub></span><span class="main">)</span><span class="main">*</span>cos<span class="main">(</span><span class="free">θ<span class="hidden">⇩</span><sub>B</sub></span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">,</span> <span class="main">-</span>sin<span class="main">(</span><span class="free">θ<span class="hidden">⇩</span><sub>A</sub></span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="main">-</span>sin<span class="main">(</span><span class="free">θ<span class="hidden">⇩</span><sub>B</sub></span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">]</span><span class="main">,</span>
                    <span class="main">[</span>exp<span class="main">(</span><span class="keyword1">𝗂</span><span class="main">*</span><span class="free">φ<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span><span class="main">*</span>cos<span class="main">(</span><span class="free">θ<span class="hidden">⇩</span><sub>A</sub></span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> sin<span class="main">(</span><span class="free">θ<span class="hidden">⇩</span><sub>B</sub></span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">,</span> exp<span class="main">(</span><span class="keyword1">𝗂</span><span class="main">*</span><span class="free">φ<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span><span class="main">*</span>cos<span class="main">(</span><span class="free">θ<span class="hidden">⇩</span><sub>A</sub></span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> exp<span class="main">(</span><span class="main">-</span><span class="keyword1">𝗂</span><span class="main">*</span><span class="free">φ<span class="hidden">⇩</span><sub>B</sub></span><span class="main">)</span><span class="main">*</span>cos<span class="main">(</span><span class="free">θ<span class="hidden">⇩</span><sub>B</sub></span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">,</span>
                            <span class="main">-</span>sin<span class="main">(</span><span class="free">θ<span class="hidden">⇩</span><sub>A</sub></span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> sin<span class="main">(</span><span class="free">θ<span class="hidden">⇩</span><sub>B</sub></span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">,</span> <span class="main">-</span>sin<span class="main">(</span><span class="free">θ<span class="hidden">⇩</span><sub>A</sub></span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> exp<span class="main">(</span><span class="main">-</span><span class="keyword1">𝗂</span><span class="main">*</span><span class="free">φ<span class="hidden">⇩</span><sub>B</sub></span><span class="main">)</span><span class="main">*</span>cos<span class="main">(</span><span class="free">θ<span class="hidden">⇩</span><sub>B</sub></span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">]</span><span class="main">,</span>
                    <span class="main">[</span>sin<span class="main">(</span><span class="free">θ<span class="hidden">⇩</span><sub>A</sub></span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> exp<span class="main">(</span><span class="keyword1">𝗂</span><span class="main">*</span><span class="free">φ<span class="hidden">⇩</span><sub>B</sub></span><span class="main">)</span><span class="main">*</span>cos<span class="main">(</span><span class="free">θ<span class="hidden">⇩</span><sub>B</sub></span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">,</span> <span class="main">-</span>sin<span class="main">(</span><span class="free">θ<span class="hidden">⇩</span><sub>A</sub></span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> sin<span class="main">(</span><span class="free">θ<span class="hidden">⇩</span><sub>B</sub></span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">,</span>
                            exp<span class="main">(</span><span class="main">-</span><span class="keyword1">𝗂</span><span class="main">*</span><span class="free">φ<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span><span class="main">*</span>cos<span class="main">(</span><span class="free">θ<span class="hidden">⇩</span><sub>A</sub></span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> exp <span class="main">(</span><span class="keyword1">𝗂</span><span class="main">*</span><span class="free">φ<span class="hidden">⇩</span><sub>B</sub></span><span class="main">)</span><span class="main">*</span>cos<span class="main">(</span><span class="free">θ<span class="hidden">⇩</span><sub>B</sub></span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">,</span> exp<span class="main">(</span><span class="main">-</span><span class="keyword1">𝗂</span><span class="main">*</span><span class="free">φ<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span><span class="main">*</span>cos<span class="main">(</span><span class="free">θ<span class="hidden">⇩</span><sub>A</sub></span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="main">-</span>sin<span class="main">(</span><span class="free">θ<span class="hidden">⇩</span><sub>B</sub></span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">]</span><span class="main">,</span>
                    <span class="main">[</span>sin<span class="main">(</span><span class="free">θ<span class="hidden">⇩</span><sub>A</sub></span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> sin<span class="main">(</span><span class="free">θ<span class="hidden">⇩</span><sub>B</sub></span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">,</span> sin<span class="main">(</span><span class="free">θ<span class="hidden">⇩</span><sub>A</sub></span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> exp<span class="main">(</span><span class="main">-</span><span class="keyword1">𝗂</span><span class="main">*</span><span class="free">φ<span class="hidden">⇩</span><sub>B</sub></span><span class="main">)</span><span class="main">*</span>cos<span class="main">(</span><span class="free">θ<span class="hidden">⇩</span><sub>B</sub></span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">,</span>
                            exp<span class="main">(</span><span class="main">-</span><span class="keyword1">𝗂</span><span class="main">*</span><span class="free">φ<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span><span class="main">*</span>cos<span class="main">(</span><span class="free">θ<span class="hidden">⇩</span><sub>A</sub></span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> sin<span class="main">(</span><span class="free">θ<span class="hidden">⇩</span><sub>B</sub></span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">,</span> exp <span class="main">(</span><span class="main">-</span><span class="keyword1">𝗂</span><span class="main">*</span><span class="free">φ<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span><span class="main">*</span>cos<span class="main">(</span><span class="free">θ<span class="hidden">⇩</span><sub>A</sub></span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> exp<span class="main">(</span><span class="main">-</span><span class="keyword1">𝗂</span><span class="main">*</span><span class="free">φ<span class="hidden">⇩</span><sub>B</sub></span><span class="main">)</span><span class="main">*</span>cos<span class="main">(</span><span class="free">θ<span class="hidden">⇩</span><sub>B</sub></span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">]</span><span class="main">]</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> strategic_space_2p<span class="main">)</span> U<span class="hidden">⇩</span><sub>A</sub>_tensor_U<span class="hidden">⇩</span><sub>B</sub><span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>U<span class="hidden">⇩</span><sub>A</sub> <span class="main">⨂</span> U<span class="hidden">⇩</span><sub>B</sub><span class="main">)</span> <span class="main">=</span> U<span class="hidden">⇩</span><sub>A</sub><span class="hidden">⇩</span><sub>B</sub>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span> <span class="keyword3"><span class="command">assume</span></span> a0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span><span class="main">&lt;</span>dim_row U<span class="hidden">⇩</span><sub>A</sub><span class="hidden">⇩</span><sub>B</sub>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span><span class="main">&lt;</span>dim_col U<span class="hidden">⇩</span><sub>A</sub><span class="hidden">⇩</span><sub>B</sub>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">}</span> <span class="main">∧</span> <span class="skolem">j</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> mat_of_cols_list_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>U<span class="hidden">⇩</span><sub>A</sub> <span class="main">⨂</span> U<span class="hidden">⇩</span><sub>B</sub><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> U<span class="hidden">⇩</span><sub>A</sub><span class="hidden">⇩</span><sub>B</sub> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> mat_of_cols_list_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_row <span class="main">(</span>U<span class="hidden">⇩</span><sub>A</sub> <span class="main">⨂</span> U<span class="hidden">⇩</span><sub>B</sub><span class="main">)</span> <span class="main">=</span> dim_row U<span class="hidden">⇩</span><sub>A</sub><span class="hidden">⇩</span><sub>B</sub>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> mat_of_cols_list_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_col <span class="main">(</span>U<span class="hidden">⇩</span><sub>A</sub> <span class="main">⨂</span> U<span class="hidden">⇩</span><sub>B</sub><span class="main">)</span> <span class="main">=</span> dim_col U<span class="hidden">⇩</span><sub>A</sub><span class="hidden">⇩</span><sub>B</sub>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> mat_of_cols_list_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> strategic_space_2p<span class="main">)</span> psi_two<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>U<span class="hidden">⇩</span><sub>A</sub> <span class="main">⨂</span> U<span class="hidden">⇩</span><sub>B</sub><span class="main">)</span> <span class="main">*</span> ψ<span class="hidden">⇩</span><sub>1</sub> <span class="main">=</span> ψ<span class="hidden">⇩</span><sub>2</sub>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span>
  <span class="keyword3"><span class="command">assume</span></span> a0<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> dim_row ψ<span class="hidden">⇩</span><sub>2</sub>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> dim_col ψ<span class="hidden">⇩</span><sub>2</sub>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>U<span class="hidden">⇩</span><sub>A</sub> <span class="main">⨂</span> U<span class="hidden">⇩</span><sub>B</sub><span class="main">)</span> <span class="main">*</span> ψ<span class="hidden">⇩</span><sub>1</sub><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> ψ<span class="hidden">⇩</span><sub>2</sub> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">}</span> <span class="main">∧</span> <span class="skolem">j</span><span class="main">=</span><span class="main">0</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> a0 a1 mat_of_cols_list_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> mat_of_cols_list_def U<span class="hidden">⇩</span><sub>A</sub>_tensor_U<span class="hidden">⇩</span><sub>B</sub> set_4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_row <span class="main">(</span><span class="main">(</span>U<span class="hidden">⇩</span><sub>A</sub> <span class="main">⨂</span> U<span class="hidden">⇩</span><sub>B</sub><span class="main">)</span><span class="main">*</span>ψ<span class="hidden">⇩</span><sub>1</sub><span class="main">)</span> <span class="main">=</span> dim_row ψ<span class="hidden">⇩</span><sub>2</sub>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> mat_of_cols_list_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_col <span class="main">(</span><span class="main">(</span>U<span class="hidden">⇩</span><sub>A</sub> <span class="main">⨂</span> U<span class="hidden">⇩</span><sub>B</sub><span class="main">)</span><span class="main">*</span>ψ<span class="hidden">⇩</span><sub>1</sub><span class="main">)</span> <span class="main">=</span> dim_col ψ<span class="hidden">⇩</span><sub>2</sub>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> mat_of_cols_list_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>  
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> prisoner<span class="main">)</span> <span class="entity">J_cnj</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"complex Matrix.mat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">J_cnj</span> <span class="main">≡</span> mat_of_cols_list <span class="numeral">4</span> <span class="main">[</span><span class="main">[</span>cos<span class="main">(</span><span class="free">γ</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">-</span><span class="keyword1">𝗂</span><span class="main">*</span>sin<span class="main">(</span><span class="free">γ</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">]</span><span class="main">,</span>
                             <span class="main">[</span><span class="main">0</span><span class="main">,</span> cos<span class="main">(</span><span class="free">γ</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">,</span> <span class="keyword1">𝗂</span><span class="main">*</span>sin<span class="main">(</span><span class="free">γ</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">,</span> <span class="main">0</span><span class="main">]</span><span class="main">,</span>
                             <span class="main">[</span><span class="main">0</span><span class="main">,</span> <span class="keyword1">𝗂</span><span class="main">*</span>sin<span class="main">(</span><span class="free">γ</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">,</span> cos<span class="main">(</span><span class="free">γ</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">,</span> <span class="main">0</span><span class="main">]</span><span class="main">,</span>
                             <span class="main">[</span><span class="main">-</span><span class="keyword1">𝗂</span><span class="main">*</span>sin<span class="main">(</span><span class="free">γ</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> cos<span class="main">(</span><span class="free">γ</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">]</span><span class="main">]</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> prisoner<span class="main">)</span> hermite_cnj_of_J <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"J<span class="main"><span class="hidden">⇧</span><sup>†</sup></span> <span class="main">=</span> J_cnj"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span> <span class="keyword3"><span class="command">assume</span></span> a0<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> dim_row J_cnj"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> dim_col J_cnj"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"J<span class="main"><span class="hidden">⇧</span><sup>†</sup></span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> J_cnj <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">}</span> <span class="main">∧</span> <span class="skolem">j</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">}</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> a0 a1 mat_of_cols_list_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> mat_of_cols_list_def dagger_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_row <span class="main">(</span>J<span class="main"><span class="hidden">⇧</span><sup>†</sup></span><span class="main">)</span> <span class="main">=</span> dim_row J_cnj"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> mat_of_cols_list_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_col <span class="main">(</span>J<span class="main"><span class="hidden">⇧</span><sup>†</sup></span><span class="main">)</span> <span class="main">=</span> dim_col J_cnj"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> mat_of_cols_list_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> strategic_space_2p<span class="main">)</span> <span class="entity">ψ<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"complex Matrix.mat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">ψ<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">≡</span> mat_of_cols_list <span class="numeral">4</span> <span class="main">[</span><span class="main">[</span>
cos<span class="main">(</span><span class="free">γ</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>exp<span class="main">(</span><span class="keyword1">𝗂</span><span class="main">*</span><span class="free">φ<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span><span class="main">*</span>cos<span class="main">(</span><span class="free">θ<span class="hidden">⇩</span><sub>A</sub></span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> exp<span class="main">(</span><span class="keyword1">𝗂</span><span class="main">*</span><span class="free">φ<span class="hidden">⇩</span><sub>B</sub></span><span class="main">)</span><span class="main">*</span>cos<span class="main">(</span><span class="free">θ<span class="hidden">⇩</span><sub>B</sub></span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> cos<span class="main">(</span><span class="free">γ</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">+</span> sin<span class="main">(</span><span class="free">θ<span class="hidden">⇩</span><sub>A</sub></span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> sin<span class="main">(</span><span class="free">θ<span class="hidden">⇩</span><sub>B</sub></span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="keyword1">𝗂</span><span class="main">*</span>sin<span class="main">(</span><span class="free">γ</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span>
<span class="main">+</span> <span class="main">(</span><span class="main">-</span><span class="keyword1">𝗂</span><span class="main">*</span>sin<span class="main">(</span><span class="free">γ</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>sin<span class="main">(</span><span class="free">θ<span class="hidden">⇩</span><sub>A</sub></span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> sin<span class="main">(</span><span class="free">θ<span class="hidden">⇩</span><sub>B</sub></span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> cos<span class="main">(</span><span class="free">γ</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">+</span> exp<span class="main">(</span><span class="main">-</span><span class="keyword1">𝗂</span><span class="main">*</span><span class="free">φ<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span><span class="main">*</span>cos<span class="main">(</span><span class="free">θ<span class="hidden">⇩</span><sub>A</sub></span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> exp<span class="main">(</span><span class="main">-</span><span class="keyword1">𝗂</span><span class="main">*</span><span class="free">φ<span class="hidden">⇩</span><sub>B</sub></span><span class="main">)</span><span class="main">*</span>cos<span class="main">(</span><span class="free">θ<span class="hidden">⇩</span><sub>B</sub></span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="keyword1">𝗂</span><span class="main">*</span>sin<span class="main">(</span><span class="free">γ</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">,</span>

cos<span class="main">(</span><span class="free">γ</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>exp<span class="main">(</span><span class="keyword1">𝗂</span><span class="main">*</span><span class="free">φ<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span><span class="main">*</span>cos<span class="main">(</span><span class="free">θ<span class="hidden">⇩</span><sub>A</sub></span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="main">-</span>sin<span class="main">(</span><span class="free">θ<span class="hidden">⇩</span><sub>B</sub></span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> cos<span class="main">(</span><span class="free">γ</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">+</span> sin<span class="main">(</span><span class="free">θ<span class="hidden">⇩</span><sub>A</sub></span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> exp<span class="main">(</span><span class="main">-</span><span class="keyword1">𝗂</span><span class="main">*</span><span class="free">φ<span class="hidden">⇩</span><sub>B</sub></span><span class="main">)</span><span class="main">*</span>cos<span class="main">(</span><span class="free">θ<span class="hidden">⇩</span><sub>B</sub></span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="keyword1">𝗂</span><span class="main">*</span>sin<span class="main">(</span><span class="free">γ</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> 
<span class="main">+</span> <span class="main">(</span><span class="keyword1">𝗂</span><span class="main">*</span>sin<span class="main">(</span><span class="free">γ</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span>sin<span class="main">(</span><span class="free">θ<span class="hidden">⇩</span><sub>A</sub></span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> exp<span class="main">(</span><span class="keyword1">𝗂</span><span class="main">*</span><span class="free">φ<span class="hidden">⇩</span><sub>B</sub></span><span class="main">)</span><span class="main">*</span>cos<span class="main">(</span><span class="free">θ<span class="hidden">⇩</span><sub>B</sub></span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> cos<span class="main">(</span><span class="free">γ</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">+</span> exp<span class="main">(</span><span class="main">-</span><span class="keyword1">𝗂</span><span class="main">*</span><span class="free">φ<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span><span class="main">*</span>cos<span class="main">(</span><span class="free">θ<span class="hidden">⇩</span><sub>A</sub></span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> sin<span class="main">(</span><span class="free">θ<span class="hidden">⇩</span><sub>B</sub></span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="keyword1">𝗂</span><span class="main">*</span>sin<span class="main">(</span><span class="free">γ</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">,</span>

<span class="main">(</span><span class="keyword1">𝗂</span><span class="main">*</span>sin<span class="main">(</span><span class="free">γ</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>exp<span class="main">(</span><span class="keyword1">𝗂</span><span class="main">*</span><span class="free">φ<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span><span class="main">*</span>cos<span class="main">(</span><span class="free">θ<span class="hidden">⇩</span><sub>A</sub></span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="main">-</span>sin<span class="main">(</span><span class="free">θ<span class="hidden">⇩</span><sub>B</sub></span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> cos<span class="main">(</span><span class="free">γ</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">+</span> sin<span class="main">(</span><span class="free">θ<span class="hidden">⇩</span><sub>A</sub></span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> exp<span class="main">(</span><span class="main">-</span><span class="keyword1">𝗂</span><span class="main">*</span><span class="free">φ<span class="hidden">⇩</span><sub>B</sub></span><span class="main">)</span><span class="main">*</span>cos<span class="main">(</span><span class="free">θ<span class="hidden">⇩</span><sub>B</sub></span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="keyword1">𝗂</span><span class="main">*</span>sin<span class="main">(</span><span class="free">γ</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span>
<span class="main">+</span> cos<span class="main">(</span><span class="free">γ</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span>sin<span class="main">(</span><span class="free">θ<span class="hidden">⇩</span><sub>A</sub></span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> exp<span class="main">(</span><span class="keyword1">𝗂</span><span class="main">*</span><span class="free">φ<span class="hidden">⇩</span><sub>B</sub></span><span class="main">)</span><span class="main">*</span>cos<span class="main">(</span><span class="free">θ<span class="hidden">⇩</span><sub>B</sub></span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> cos<span class="main">(</span><span class="free">γ</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">+</span> exp<span class="main">(</span><span class="main">-</span><span class="keyword1">𝗂</span><span class="main">*</span><span class="free">φ<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span><span class="main">*</span>cos<span class="main">(</span><span class="free">θ<span class="hidden">⇩</span><sub>A</sub></span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> sin<span class="main">(</span><span class="free">θ<span class="hidden">⇩</span><sub>B</sub></span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="keyword1">𝗂</span><span class="main">*</span>sin<span class="main">(</span><span class="free">γ</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">,</span>

<span class="main">(</span><span class="main">-</span><span class="keyword1">𝗂</span><span class="main">*</span>sin<span class="main">(</span><span class="free">γ</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>exp<span class="main">(</span><span class="keyword1">𝗂</span><span class="main">*</span><span class="free">φ<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span><span class="main">*</span>cos<span class="main">(</span><span class="free">θ<span class="hidden">⇩</span><sub>A</sub></span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> exp<span class="main">(</span><span class="keyword1">𝗂</span><span class="main">*</span><span class="free">φ<span class="hidden">⇩</span><sub>B</sub></span><span class="main">)</span><span class="main">*</span>cos<span class="main">(</span><span class="free">θ<span class="hidden">⇩</span><sub>B</sub></span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> cos<span class="main">(</span><span class="free">γ</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">+</span> sin<span class="main">(</span><span class="free">θ<span class="hidden">⇩</span><sub>A</sub></span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> sin<span class="main">(</span><span class="free">θ<span class="hidden">⇩</span><sub>B</sub></span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="keyword1">𝗂</span><span class="main">*</span>sin<span class="main">(</span><span class="free">γ</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> 
<span class="main">+</span> cos<span class="main">(</span><span class="free">γ</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>sin<span class="main">(</span><span class="free">θ<span class="hidden">⇩</span><sub>A</sub></span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> sin<span class="main">(</span><span class="free">θ<span class="hidden">⇩</span><sub>B</sub></span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> cos<span class="main">(</span><span class="free">γ</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">+</span> exp<span class="main">(</span><span class="main">-</span><span class="keyword1">𝗂</span><span class="main">*</span><span class="free">φ<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span><span class="main">*</span>cos<span class="main">(</span><span class="free">θ<span class="hidden">⇩</span><sub>A</sub></span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> exp<span class="main">(</span><span class="main">-</span><span class="keyword1">𝗂</span><span class="main">*</span><span class="free">φ<span class="hidden">⇩</span><sub>B</sub></span><span class="main">)</span><span class="main">*</span>cos<span class="main">(</span><span class="free">θ<span class="hidden">⇩</span><sub>B</sub></span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="keyword1">𝗂</span><span class="main">*</span>sin<span class="main">(</span><span class="free">γ</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span>
<span class="main">]</span><span class="main">]</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> strategic_space_2p<span class="main">)</span> psi_f<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>J<span class="main"><span class="hidden">⇧</span><sup>†</sup></span><span class="main">)</span> <span class="main">*</span> ψ<span class="hidden">⇩</span><sub>2</sub> <span class="main">=</span> ψ<span class="hidden">⇩</span><sub>f</sub>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span> <span class="keyword3"><span class="command">assume</span></span> a0<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> dim_row ψ<span class="hidden">⇩</span><sub>f</sub>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> dim_col ψ<span class="hidden">⇩</span><sub>f</sub>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>J<span class="main"><span class="hidden">⇧</span><sup>†</sup></span><span class="main">)</span> <span class="main">*</span> ψ<span class="hidden">⇩</span><sub>2</sub><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> ψ<span class="hidden">⇩</span><sub>f</sub> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">}</span> <span class="main">∧</span> <span class="skolem">j</span><span class="main">=</span><span class="main">0</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> a0 a1 mat_of_cols_list_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> mat_of_cols_list_def set_4 hermite_cnj_of_J <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_row <span class="main">(</span><span class="main">(</span>J<span class="main"><span class="hidden">⇧</span><sup>†</sup></span><span class="main">)</span> <span class="main">*</span> ψ<span class="hidden">⇩</span><sub>2</sub><span class="main">)</span> <span class="main">=</span> dim_row ψ<span class="hidden">⇩</span><sub>f</sub>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> mat_of_cols_list_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>  
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_col <span class="main">(</span><span class="main">(</span>J<span class="main"><span class="hidden">⇧</span><sup>†</sup></span><span class="main">)</span> <span class="main">*</span> ψ<span class="hidden">⇩</span><sub>2</sub><span class="main">)</span> <span class="main">=</span> dim_col ψ<span class="hidden">⇩</span><sub>f</sub>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> mat_of_cols_list_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>  
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> prisoner<span class="main">)</span> unit_vec_4_0_ket_is_state<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"state <span class="numeral">2</span> <span class="main">|</span>unit_vec <span class="numeral">4</span> <span class="main">0</span><span class="main">⟩</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> state_def cpx_vec_length_def ket_vec_def unit_vec_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_4<span class="main">)</span>

<span class="keyword1" id="Quantum_Prisoners_Dilemma-cos_sin_squared_add_cpx"><span class="command">lemma</span></span> cos_sin_squared_add_cpx<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"complex_of_real <span class="main">(</span>cos <span class="main">(</span><span class="free">γ</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> complex_of_real <span class="main">(</span>cos <span class="main">(</span><span class="free">γ</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span>
   <span class="keyword1">𝗂</span><span class="main">*</span>complex_of_real <span class="main">(</span>sin <span class="main">(</span><span class="free">γ</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">𝗂</span><span class="main">*</span>complex_of_real <span class="main">(</span>sin <span class="main">(</span><span class="free">γ</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> of_real_add of_real_hom.hom_one of_real_mult sin_cos_squared_add3<span class="main">)</span>

<span class="keyword1" id="Quantum_Prisoners_Dilemma-sin_cos_squared_add_cpx"><span class="command">lemma</span></span> sin_cos_squared_add_cpx<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="keyword1">𝗂</span><span class="main">*</span>complex_of_real <span class="main">(</span>sin <span class="main">(</span><span class="free">γ</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">𝗂</span><span class="main">*</span>complex_of_real <span class="main">(</span>sin <span class="main">(</span><span class="free">γ</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span>
   complex_of_real <span class="main">(</span>cos <span class="main">(</span><span class="free">γ</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> complex_of_real <span class="main">(</span>cos <span class="main">(</span><span class="free">γ</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span><span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> of_real_add of_real_hom.hom_one of_real_mult sin_cos_squared_add3<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> prisoner<span class="main">)</span> J_cnj_times_J<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"J<span class="main"><span class="hidden">⇧</span><sup>†</sup></span> <span class="main">*</span> J <span class="main">=</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>m</sub></span> <span class="numeral">4</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span> <span class="keyword3"><span class="command">assume</span></span> a0<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> dim_row <span class="main">(</span><span class="keyword1">1<span class="hidden">⇩</span><sub>m</sub></span> <span class="numeral">4</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> dim_col <span class="main">(</span><span class="keyword1">1<span class="hidden">⇩</span><sub>m</sub></span> <span class="numeral">4</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>J<span class="main"><span class="hidden">⇧</span><sup>†</sup></span> <span class="main">*</span> J<span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>m</sub></span> <span class="numeral">4</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">}</span> <span class="main">∧</span> <span class="skolem">j</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">}</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> a0 a1 mat_of_cols_list_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> mat_of_cols_list_def hermite_cnj_of_J set_4 cos_sin_squared_add_cpx <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_row <span class="main">(</span>J<span class="main"><span class="hidden">⇧</span><sup>†</sup></span> <span class="main">*</span> J<span class="main">)</span> <span class="main">=</span> dim_row <span class="main">(</span><span class="keyword1">1<span class="hidden">⇩</span><sub>m</sub></span> <span class="numeral">4</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> mat_of_cols_list_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_col <span class="main">(</span>J<span class="main"><span class="hidden">⇧</span><sup>†</sup></span> <span class="main">*</span> J<span class="main">)</span> <span class="main">=</span> dim_col <span class="main">(</span><span class="keyword1">1<span class="hidden">⇩</span><sub>m</sub></span> <span class="numeral">4</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> mat_of_cols_list_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> prisoner<span class="main">)</span> J_times_J_cnj<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"J <span class="main">*</span> <span class="main">(</span>J<span class="main"><span class="hidden">⇧</span><sup>†</sup></span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>m</sub></span> <span class="numeral">4</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span> <span class="keyword3"><span class="command">assume</span></span> a0<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> dim_row <span class="main">(</span><span class="keyword1">1<span class="hidden">⇩</span><sub>m</sub></span> <span class="numeral">4</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> dim_col <span class="main">(</span><span class="keyword1">1<span class="hidden">⇩</span><sub>m</sub></span> <span class="numeral">4</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>J <span class="main">*</span> <span class="main">(</span>J<span class="main"><span class="hidden">⇧</span><sup>†</sup></span><span class="main">)</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>m</sub></span> <span class="numeral">4</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">}</span> <span class="main">∧</span> <span class="skolem">j</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">}</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> a0 a1 mat_of_cols_list_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> mat_of_cols_list_def hermite_cnj_of_J set_4 cos_sin_squared_add_cpx <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_row <span class="main">(</span>J <span class="main">*</span> <span class="main">(</span>J<span class="main"><span class="hidden">⇧</span><sup>†</sup></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> dim_row <span class="main">(</span><span class="keyword1">1<span class="hidden">⇩</span><sub>m</sub></span> <span class="numeral">4</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> mat_of_cols_list_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_col <span class="main">(</span>J <span class="main">*</span> <span class="main">(</span>J<span class="main"><span class="hidden">⇧</span><sup>†</sup></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> dim_col <span class="main">(</span><span class="keyword1">1<span class="hidden">⇩</span><sub>m</sub></span> <span class="numeral">4</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> mat_of_cols_list_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> prisoner<span class="main">)</span> J_is_gate<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"gate <span class="numeral">2</span> J"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_row J <span class="main">=</span> <span class="numeral">2</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> mat_of_cols_list_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"square_mat J"</span></span>
    <span class="keyword1"><span class="command">using</span></span> mat_of_cols_list_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"unitary J"</span></span>
    <span class="keyword1"><span class="command">using</span></span> mat_of_cols_list_def unitary_def J_cnj_times_J J_times_J_cnj <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> strategic_space_2p<span class="main">)</span> psi_one_is_state<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"state <span class="numeral">2</span> ψ<span class="hidden">⇩</span><sub>1</sub>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"state <span class="numeral">2</span> <span class="main">(</span>J <span class="main">*</span> <span class="main">|</span>unit_vec <span class="numeral">4</span> <span class="main">0</span><span class="main">⟩</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> unit_vec_4_0_ket_is_state J_is_gate <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> psi_one <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> strategic_space_2p<span class="main">)</span> <span class="entity">U<span class="hidden">⇩</span><sub>A</sub>_cnj</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"complex Matrix.mat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">U<span class="hidden">⇩</span><sub>A</sub>_cnj</span> <span class="main">≡</span> mat_of_cols_list <span class="numeral">2</span> <span class="main">[</span><span class="main">[</span><span class="main">(</span>exp<span class="main">(</span><span class="main">-</span><span class="keyword1">𝗂</span><span class="main">*</span><span class="free">φ<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span><span class="main">)</span><span class="main">*</span>cos<span class="main">(</span><span class="free">θ<span class="hidden">⇩</span><sub>A</sub></span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">,</span> sin<span class="main">(</span><span class="free">θ<span class="hidden">⇩</span><sub>A</sub></span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">]</span><span class="main">,</span>
                              <span class="main">[</span><span class="main">-</span>sin<span class="main">(</span><span class="free">θ<span class="hidden">⇩</span><sub>A</sub></span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span>exp <span class="main">(</span><span class="keyword1">𝗂</span><span class="main">*</span><span class="free">φ<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span><span class="main">)</span><span class="main">*</span>cos<span class="main">(</span><span class="free">θ<span class="hidden">⇩</span><sub>A</sub></span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">]</span><span class="main">]</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> strategic_space_2p<span class="main">)</span> <span class="entity">U<span class="hidden">⇩</span><sub>B</sub>_cnj</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"complex Matrix.mat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">U<span class="hidden">⇩</span><sub>B</sub>_cnj</span> <span class="main">≡</span> mat_of_cols_list <span class="numeral">2</span> <span class="main">[</span><span class="main">[</span><span class="main">(</span>exp<span class="main">(</span><span class="main">-</span><span class="keyword1">𝗂</span><span class="main">*</span><span class="free">φ<span class="hidden">⇩</span><sub>B</sub></span><span class="main">)</span><span class="main">)</span><span class="main">*</span>cos<span class="main">(</span><span class="free">θ<span class="hidden">⇩</span><sub>B</sub></span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">,</span> sin<span class="main">(</span><span class="free">θ<span class="hidden">⇩</span><sub>B</sub></span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">]</span><span class="main">,</span>
                              <span class="main">[</span><span class="main">-</span>sin<span class="main">(</span><span class="free">θ<span class="hidden">⇩</span><sub>B</sub></span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span>exp<span class="main">(</span><span class="keyword1">𝗂</span><span class="main">*</span><span class="free">φ<span class="hidden">⇩</span><sub>B</sub></span><span class="main">)</span><span class="main">)</span><span class="main">*</span>cos<span class="main">(</span><span class="free">θ<span class="hidden">⇩</span><sub>B</sub></span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">]</span><span class="main">]</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> strategic_space_2p<span class="main">)</span> hermite_cnj_of_U<span class="hidden">⇩</span><sub>A</sub><span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"U<span class="hidden">⇩</span><sub>A</sub><span class="main"><span class="hidden">⇧</span><sup>†</sup></span> <span class="main">=</span> U<span class="hidden">⇩</span><sub>A</sub>_cnj"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span> <span class="keyword3"><span class="command">assume</span></span> a0<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> dim_row U<span class="hidden">⇩</span><sub>A</sub>_cnj"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> dim_col U<span class="hidden">⇩</span><sub>A</sub>_cnj"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"U<span class="hidden">⇩</span><sub>A</sub><span class="main"><span class="hidden">⇧</span><sup>†</sup></span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> U<span class="hidden">⇩</span><sub>A</sub>_cnj <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">}</span> <span class="main">∧</span> <span class="skolem">j</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> a0 a1 mat_of_cols_list_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> mat_of_cols_list_def dagger_def exp_of_real_cnj exp_of_real_cnj2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_row <span class="main">(</span>U<span class="hidden">⇩</span><sub>A</sub><span class="main"><span class="hidden">⇧</span><sup>†</sup></span><span class="main">)</span> <span class="main">=</span> dim_row U<span class="hidden">⇩</span><sub>A</sub>_cnj"</span></span>
    <span class="keyword1"><span class="command">using</span></span> mat_of_cols_list_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_col <span class="main">(</span>U<span class="hidden">⇩</span><sub>A</sub><span class="main"><span class="hidden">⇧</span><sup>†</sup></span><span class="main">)</span> <span class="main">=</span> dim_col U<span class="hidden">⇩</span><sub>A</sub>_cnj"</span></span>
    <span class="keyword1"><span class="command">using</span></span> mat_of_cols_list_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> strategic_space_2p<span class="main">)</span> hermite_cnj_of_U<span class="hidden">⇩</span><sub>B</sub><span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"U<span class="hidden">⇩</span><sub>B</sub><span class="main"><span class="hidden">⇧</span><sup>†</sup></span> <span class="main">=</span> U<span class="hidden">⇩</span><sub>B</sub>_cnj"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span> <span class="keyword3"><span class="command">assume</span></span> a0<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> dim_row U<span class="hidden">⇩</span><sub>B</sub>_cnj"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> dim_col U<span class="hidden">⇩</span><sub>B</sub>_cnj"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"U<span class="hidden">⇩</span><sub>B</sub><span class="main"><span class="hidden">⇧</span><sup>†</sup></span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> U<span class="hidden">⇩</span><sub>B</sub>_cnj <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">}</span> <span class="main">∧</span> <span class="skolem">j</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> a0 a1 mat_of_cols_list_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> mat_of_cols_list_def dagger_def exp_of_real_cnj exp_of_real_cnj2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_row <span class="main">(</span>U<span class="hidden">⇩</span><sub>B</sub><span class="main"><span class="hidden">⇧</span><sup>†</sup></span><span class="main">)</span> <span class="main">=</span> dim_row U<span class="hidden">⇩</span><sub>B</sub>_cnj"</span></span>
    <span class="keyword1"><span class="command">using</span></span> mat_of_cols_list_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_col <span class="main">(</span>U<span class="hidden">⇩</span><sub>B</sub><span class="main"><span class="hidden">⇧</span><sup>†</sup></span><span class="main">)</span> <span class="main">=</span> dim_col U<span class="hidden">⇩</span><sub>B</sub>_cnj"</span></span>
    <span class="keyword1"><span class="command">using</span></span> mat_of_cols_list_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Quantum_Prisoners_Dilemma-exp_sin_cos_squared_add"><span class="command">lemma</span></span> exp_sin_cos_squared_add<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="free">y</span> <span class="main">::</span> <span class="quoted">real</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"exp <span class="main">(</span><span class="main">-</span> <span class="main">(</span><span class="keyword1">𝗂</span> <span class="main">*</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> cos <span class="main">(</span><span class="free">y</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>exp <span class="main">(</span><span class="keyword1">𝗂</span> <span class="main">*</span> <span class="free">x</span><span class="main">)</span> <span class="main">*</span> cos <span class="main">(</span><span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> sin<span class="main">(</span><span class="free">y</span><span class="main">)</span> <span class="main">*</span> sin<span class="main">(</span><span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"exp <span class="main">(</span><span class="main">-</span> <span class="main">(</span><span class="keyword1">𝗂</span> <span class="main">*</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> cos <span class="main">(</span><span class="free">y</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>exp <span class="main">(</span><span class="keyword1">𝗂</span> <span class="main">*</span> <span class="free">x</span><span class="main">)</span> <span class="main">*</span> cos <span class="main">(</span><span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> cos<span class="main">(</span><span class="free">y</span><span class="main">)</span> <span class="main">*</span> cos<span class="main">(</span><span class="free">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> exp_minus_inverse <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> of_real_add of_real_hom.hom_one sin_cos_squared_add3<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> strategic_space_2p<span class="main">)</span> U<span class="hidden">⇩</span><sub>A</sub>_cnj_times_U<span class="hidden">⇩</span><sub>A</sub><span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"U<span class="hidden">⇩</span><sub>A</sub><span class="main"><span class="hidden">⇧</span><sup>†</sup></span> <span class="main">*</span> U<span class="hidden">⇩</span><sub>A</sub> <span class="main">=</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>m</sub></span> <span class="numeral">2</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span> <span class="keyword3"><span class="command">assume</span></span> a0<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> dim_row <span class="main">(</span><span class="keyword1">1<span class="hidden">⇩</span><sub>m</sub></span> <span class="numeral">2</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> dim_col <span class="main">(</span><span class="keyword1">1<span class="hidden">⇩</span><sub>m</sub></span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>U<span class="hidden">⇩</span><sub>A</sub><span class="main"><span class="hidden">⇧</span><sup>†</sup></span> <span class="main">*</span> U<span class="hidden">⇩</span><sub>A</sub><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>m</sub></span> <span class="numeral">2</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">}</span> <span class="main">∧</span> <span class="skolem">j</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">}</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> a0 a1 mat_of_cols_list_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> mat_of_cols_list_def cos_sin_squared_add_cpx hermite_cnj_of_U<span class="hidden">⇩</span><sub>A</sub> exp_sin_cos_squared_add<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">φ<span class="hidden">⇩</span><sub>A</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">θ<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">/</span> <span class="numeral">2</span>"</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_2 <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_row <span class="main">(</span>U<span class="hidden">⇩</span><sub>A</sub><span class="main"><span class="hidden">⇧</span><sup>†</sup></span> <span class="main">*</span> U<span class="hidden">⇩</span><sub>A</sub><span class="main">)</span> <span class="main">=</span> dim_row <span class="main">(</span><span class="keyword1">1<span class="hidden">⇩</span><sub>m</sub></span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> mat_of_cols_list_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_col <span class="main">(</span>U<span class="hidden">⇩</span><sub>A</sub><span class="main"><span class="hidden">⇧</span><sup>†</sup></span> <span class="main">*</span> U<span class="hidden">⇩</span><sub>A</sub><span class="main">)</span> <span class="main">=</span> dim_col <span class="main">(</span><span class="keyword1">1<span class="hidden">⇩</span><sub>m</sub></span> <span class="numeral">2</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> mat_of_cols_list_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> strategic_space_2p<span class="main">)</span> U<span class="hidden">⇩</span><sub>A</sub>_times_U<span class="hidden">⇩</span><sub>A</sub>_cnj<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"U<span class="hidden">⇩</span><sub>A</sub> <span class="main">*</span> <span class="main">(</span>U<span class="hidden">⇩</span><sub>A</sub><span class="main"><span class="hidden">⇧</span><sup>†</sup></span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>m</sub></span> <span class="numeral">2</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span> <span class="keyword3"><span class="command">assume</span></span> a0<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> dim_row <span class="main">(</span><span class="keyword1">1<span class="hidden">⇩</span><sub>m</sub></span> <span class="numeral">2</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> dim_col <span class="main">(</span><span class="keyword1">1<span class="hidden">⇩</span><sub>m</sub></span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>U<span class="hidden">⇩</span><sub>A</sub> <span class="main">*</span> <span class="main">(</span>U<span class="hidden">⇩</span><sub>A</sub><span class="main"><span class="hidden">⇧</span><sup>†</sup></span><span class="main">)</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>m</sub></span> <span class="numeral">2</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">}</span> <span class="main">∧</span> <span class="skolem">j</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">}</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> a0 a1 mat_of_cols_list_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> mat_of_cols_list_def cos_sin_squared_add_cpx hermite_cnj_of_U<span class="hidden">⇩</span><sub>A</sub> exp_sin_cos_squared_add<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">φ<span class="hidden">⇩</span><sub>A</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">θ<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">/</span> <span class="numeral">2</span>"</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_2 <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_row <span class="main">(</span>U<span class="hidden">⇩</span><sub>A</sub> <span class="main">*</span> <span class="main">(</span>U<span class="hidden">⇩</span><sub>A</sub><span class="main"><span class="hidden">⇧</span><sup>†</sup></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> dim_row <span class="main">(</span><span class="keyword1">1<span class="hidden">⇩</span><sub>m</sub></span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> mat_of_cols_list_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_col <span class="main">(</span>U<span class="hidden">⇩</span><sub>A</sub> <span class="main">*</span> <span class="main">(</span>U<span class="hidden">⇩</span><sub>A</sub><span class="main"><span class="hidden">⇧</span><sup>†</sup></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> dim_col <span class="main">(</span><span class="keyword1">1<span class="hidden">⇩</span><sub>m</sub></span> <span class="numeral">2</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> mat_of_cols_list_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> strategic_space_2p<span class="main">)</span> U<span class="hidden">⇩</span><sub>B</sub>_cnj_times_U<span class="hidden">⇩</span><sub>B</sub><span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"U<span class="hidden">⇩</span><sub>B</sub><span class="main"><span class="hidden">⇧</span><sup>†</sup></span> <span class="main">*</span> U<span class="hidden">⇩</span><sub>B</sub> <span class="main">=</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>m</sub></span> <span class="numeral">2</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span> <span class="keyword3"><span class="command">assume</span></span> a0<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> dim_row <span class="main">(</span><span class="keyword1">1<span class="hidden">⇩</span><sub>m</sub></span> <span class="numeral">2</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> dim_col <span class="main">(</span><span class="keyword1">1<span class="hidden">⇩</span><sub>m</sub></span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>U<span class="hidden">⇩</span><sub>B</sub><span class="main"><span class="hidden">⇧</span><sup>†</sup></span> <span class="main">*</span> U<span class="hidden">⇩</span><sub>B</sub><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>m</sub></span> <span class="numeral">2</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">}</span> <span class="main">∧</span> <span class="skolem">j</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">}</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> a0 a1 mat_of_cols_list_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> mat_of_cols_list_def cos_sin_squared_add_cpx hermite_cnj_of_U<span class="hidden">⇩</span><sub>B</sub> exp_sin_cos_squared_add<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">φ<span class="hidden">⇩</span><sub>B</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">θ<span class="hidden">⇩</span><sub>B</sub></span> <span class="main">/</span> <span class="numeral">2</span>"</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_2 <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_row <span class="main">(</span>U<span class="hidden">⇩</span><sub>B</sub><span class="main"><span class="hidden">⇧</span><sup>†</sup></span> <span class="main">*</span> U<span class="hidden">⇩</span><sub>B</sub><span class="main">)</span> <span class="main">=</span> dim_row <span class="main">(</span><span class="keyword1">1<span class="hidden">⇩</span><sub>m</sub></span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> mat_of_cols_list_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_col <span class="main">(</span>U<span class="hidden">⇩</span><sub>B</sub><span class="main"><span class="hidden">⇧</span><sup>†</sup></span> <span class="main">*</span> U<span class="hidden">⇩</span><sub>B</sub><span class="main">)</span> <span class="main">=</span> dim_col <span class="main">(</span><span class="keyword1">1<span class="hidden">⇩</span><sub>m</sub></span> <span class="numeral">2</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> mat_of_cols_list_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> strategic_space_2p<span class="main">)</span> U<span class="hidden">⇩</span><sub>B</sub>_times_U<span class="hidden">⇩</span><sub>B</sub>_cnj<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"U<span class="hidden">⇩</span><sub>B</sub> <span class="main">*</span> <span class="main">(</span>U<span class="hidden">⇩</span><sub>B</sub><span class="main"><span class="hidden">⇧</span><sup>†</sup></span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>m</sub></span> <span class="numeral">2</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span> <span class="keyword3"><span class="command">assume</span></span> a0<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> dim_row <span class="main">(</span><span class="keyword1">1<span class="hidden">⇩</span><sub>m</sub></span> <span class="numeral">2</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> dim_col <span class="main">(</span><span class="keyword1">1<span class="hidden">⇩</span><sub>m</sub></span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>U<span class="hidden">⇩</span><sub>B</sub> <span class="main">*</span> <span class="main">(</span>U<span class="hidden">⇩</span><sub>B</sub><span class="main"><span class="hidden">⇧</span><sup>†</sup></span><span class="main">)</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>m</sub></span> <span class="numeral">2</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">}</span> <span class="main">∧</span> <span class="skolem">j</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">}</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> a0 a1 mat_of_cols_list_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> mat_of_cols_list_def cos_sin_squared_add_cpx hermite_cnj_of_U<span class="hidden">⇩</span><sub>B</sub> exp_sin_cos_squared_add<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">φ<span class="hidden">⇩</span><sub>B</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">θ<span class="hidden">⇩</span><sub>B</sub></span> <span class="main">/</span> <span class="numeral">2</span>"</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_2 <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_row <span class="main">(</span>U<span class="hidden">⇩</span><sub>B</sub> <span class="main">*</span> <span class="main">(</span>U<span class="hidden">⇩</span><sub>B</sub><span class="main"><span class="hidden">⇧</span><sup>†</sup></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> dim_row <span class="main">(</span><span class="keyword1">1<span class="hidden">⇩</span><sub>m</sub></span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> mat_of_cols_list_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_col <span class="main">(</span>U<span class="hidden">⇩</span><sub>B</sub> <span class="main">*</span> <span class="main">(</span>U<span class="hidden">⇩</span><sub>B</sub><span class="main"><span class="hidden">⇧</span><sup>†</sup></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> dim_col <span class="main">(</span><span class="keyword1">1<span class="hidden">⇩</span><sub>m</sub></span> <span class="numeral">2</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> mat_of_cols_list_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> strategic_space_2p<span class="main">)</span> U<span class="hidden">⇩</span><sub>A</sub><span class="hidden">⇩</span><sub>_</sub>is_gate<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"gate <span class="main">1</span> U<span class="hidden">⇩</span><sub>A</sub>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_row U<span class="hidden">⇩</span><sub>A</sub> <span class="main">=</span> <span class="numeral">2</span><span class="main">^</span><span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> mat_of_cols_list_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"square_mat U<span class="hidden">⇩</span><sub>A</sub>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> mat_of_cols_list_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"unitary U<span class="hidden">⇩</span><sub>A</sub>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> mat_of_cols_list_def unitary_def U<span class="hidden">⇩</span><sub>A</sub>_cnj_times_U<span class="hidden">⇩</span><sub>A</sub> U<span class="hidden">⇩</span><sub>A</sub>_times_U<span class="hidden">⇩</span><sub>A</sub>_cnj <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> strategic_space_2p<span class="main">)</span> U<span class="hidden">⇩</span><sub>B</sub>_is_gate<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"gate <span class="main">1</span> U<span class="hidden">⇩</span><sub>B</sub>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_row U<span class="hidden">⇩</span><sub>B</sub> <span class="main">=</span> <span class="numeral">2</span><span class="main">^</span><span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> mat_of_cols_list_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"square_mat U<span class="hidden">⇩</span><sub>B</sub>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> mat_of_cols_list_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"unitary U<span class="hidden">⇩</span><sub>B</sub>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> mat_of_cols_list_def unitary_def U<span class="hidden">⇩</span><sub>B</sub>_cnj_times_U<span class="hidden">⇩</span><sub>B</sub> U<span class="hidden">⇩</span><sub>B</sub>_times_U<span class="hidden">⇩</span><sub>B</sub>_cnj <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> strategic_space_2p<span class="main">)</span> U<span class="hidden">⇩</span><sub>A</sub><span class="hidden">⇩</span><sub>B</sub>_is_gate<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"gate <span class="numeral">2</span> <span class="main">(</span>U<span class="hidden">⇩</span><sub>A</sub> <span class="main">⨂</span> U<span class="hidden">⇩</span><sub>B</sub><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"gate <span class="main">(</span><span class="main">1</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">(</span>U<span class="hidden">⇩</span><sub>A</sub> <span class="main">⨂</span> U<span class="hidden">⇩</span><sub>B</sub><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> U<span class="hidden">⇩</span><sub>A</sub><span class="hidden">⇩</span><sub>_</sub>is_gate U<span class="hidden">⇩</span><sub>B</sub>_is_gate tensor_gate<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"U<span class="hidden">⇩</span><sub>A</sub>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"U<span class="hidden">⇩</span><sub>B</sub>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> numeral_2_eq_2<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> strategic_space_2p<span class="main">)</span> psi_two_is_state<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"state <span class="numeral">2</span> ψ<span class="hidden">⇩</span><sub>2</sub>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"state <span class="numeral">2</span> <span class="main">(</span><span class="main">(</span>U<span class="hidden">⇩</span><sub>A</sub> <span class="main">⨂</span> U<span class="hidden">⇩</span><sub>B</sub><span class="main">)</span> <span class="main">*</span> ψ<span class="hidden">⇩</span><sub>1</sub><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> psi_one_is_state U<span class="hidden">⇩</span><sub>A</sub><span class="hidden">⇩</span><sub>B</sub>_is_gate <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> psi_two <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> strategic_space_2p<span class="main">)</span> J_cnj_is_gate<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"gate <span class="numeral">2</span> <span class="main">(</span>J<span class="main"><span class="hidden">⇧</span><sup>†</sup></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_row <span class="main">(</span>J<span class="main"><span class="hidden">⇧</span><sup>†</sup></span><span class="main">)</span> <span class="main">=</span> <span class="numeral">2</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> mat_of_cols_list_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"square_mat <span class="main">(</span>J<span class="main"><span class="hidden">⇧</span><sup>†</sup></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> mat_of_cols_list_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>J<span class="main"><span class="hidden">⇧</span><sup>†</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span> <span class="main">=</span> J"</span></span>
    <span class="keyword1"><span class="command">using</span></span> dagger_of_dagger_is_id <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"unitary <span class="main">(</span>J<span class="main"><span class="hidden">⇧</span><sup>†</sup></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> mat_of_cols_list_def unitary_def J_cnj_times_J J_times_J_cnj <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> strategic_space_2p<span class="main">)</span> psi_f_is_state<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"state <span class="numeral">2</span> ψ<span class="hidden">⇩</span><sub>f</sub>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"state <span class="numeral">2</span> <span class="main">(</span><span class="main">(</span>J<span class="main"><span class="hidden">⇧</span><sup>†</sup></span><span class="main">)</span> <span class="main">*</span> ψ<span class="hidden">⇩</span><sub>2</sub><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> psi_two_is_state J_cnj_is_gate <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> psi_f <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(* equation (1) in the paper *)</span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> strategic_space_2p<span class="main">)</span> equation_one<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>J<span class="main"><span class="hidden">⇧</span><sup>†</sup></span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span>U<span class="hidden">⇩</span><sub>A</sub> <span class="main">⨂</span> U<span class="hidden">⇩</span><sub>B</sub><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>J <span class="main">*</span> <span class="main">|</span>unit_vec <span class="numeral">4</span> <span class="main">0</span><span class="main">⟩</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> ψ<span class="hidden">⇩</span><sub>f</sub>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> psi_one psi_two psi_f <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> strategic_space_2p<span class="main">)</span> <span class="entity">prob00</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"complex Matrix.mat <span class="main">⇒</span> real"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">prob00</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">≡</span> <span class="keyword1">if</span> state <span class="numeral">2</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="keyword1">then</span> <span class="main">(</span>cmod <span class="main">(</span><span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="keyword1">else</span> undefined"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> strategic_space_2p<span class="main">)</span> <span class="entity">prob01</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"complex Matrix.mat <span class="main">⇒</span> real"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">prob01</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">≡</span> <span class="keyword1">if</span> state <span class="numeral">2</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="keyword1">then</span> <span class="main">(</span>cmod <span class="main">(</span><span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="keyword1">else</span> undefined"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> strategic_space_2p<span class="main">)</span> <span class="entity">prob10</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"complex Matrix.mat <span class="main">⇒</span> real"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">prob10</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">≡</span> <span class="keyword1">if</span> state <span class="numeral">2</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="keyword1">then</span> <span class="main">(</span>cmod <span class="main">(</span><span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">$$</span> <span class="main">(</span><span class="numeral">2</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="keyword1">else</span> undefined"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> strategic_space_2p<span class="main">)</span> <span class="entity">prob11</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"complex Matrix.mat <span class="main">⇒</span> real"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">prob11</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">≡</span> <span class="keyword1">if</span> state <span class="numeral">2</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="keyword1">then</span> <span class="main">(</span>cmod <span class="main">(</span><span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">$$</span> <span class="main">(</span><span class="numeral">3</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="keyword1">else</span> undefined"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> strategic_space_2p<span class="main">)</span> <span class="entity">alice_payoff</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">alice_payoff</span> <span class="main">≡</span> <span class="numeral">3</span> <span class="main">*</span> <span class="main">(</span>prob00 ψ<span class="hidden">⇩</span><sub>f</sub><span class="main">)</span> <span class="main">+</span> <span class="main">1</span> <span class="main">*</span> <span class="main">(</span>prob11 ψ<span class="hidden">⇩</span><sub>f</sub><span class="main">)</span> <span class="main">+</span> <span class="main">0</span> <span class="main">*</span> <span class="main">(</span>prob01 ψ<span class="hidden">⇩</span><sub>f</sub><span class="main">)</span> <span class="main">+</span> <span class="numeral">5</span> <span class="main">*</span> <span class="main">(</span>prob10 ψ<span class="hidden">⇩</span><sub>f</sub><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> strategic_space_2p<span class="main">)</span> <span class="entity">bob_payoff</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">bob_payoff</span> <span class="main">≡</span> <span class="numeral">3</span> <span class="main">*</span> <span class="main">(</span>prob00 ψ<span class="hidden">⇩</span><sub>f</sub><span class="main">)</span> <span class="main">+</span> <span class="main">1</span> <span class="main">*</span> <span class="main">(</span>prob11 ψ<span class="hidden">⇩</span><sub>f</sub><span class="main">)</span> <span class="main">+</span> <span class="numeral">5</span> <span class="main">*</span> <span class="main">(</span>prob01 ψ<span class="hidden">⇩</span><sub>f</sub><span class="main">)</span> <span class="main">+</span> <span class="main">0</span> <span class="main">*</span> <span class="main">(</span>prob10 ψ<span class="hidden">⇩</span><sub>f</sub><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> strategic_space_2p<span class="main">)</span> <span class="entity">is_nash_eq</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">is_nash_eq</span> <span class="main">≡</span> 
<span class="main">(</span><span class="main">∀</span><span class="bound">tA</span> <span class="bound">pA</span><span class="main">.</span> strategic_space_2p <span class="free">γ</span> <span class="bound">tA</span> <span class="bound">pA</span> <span class="free">θ<span class="hidden">⇩</span><sub>B</sub></span> <span class="free">φ<span class="hidden">⇩</span><sub>B</sub></span> <span class="main">⟶</span> 
    alice_payoff <span class="main">≥</span> strategic_space_2p.alice_payoff <span class="free">γ</span> <span class="bound">tA</span> <span class="bound">pA</span> <span class="free">θ<span class="hidden">⇩</span><sub>B</sub></span> <span class="free">φ<span class="hidden">⇩</span><sub>B</sub></span><span class="main">)</span> 
<span class="main">∧</span>
<span class="main">(</span><span class="main">∀</span><span class="bound">tB</span> <span class="bound">pB</span><span class="main">.</span> strategic_space_2p <span class="free">γ</span> <span class="free">θ<span class="hidden">⇩</span><sub>A</sub></span> <span class="free">φ<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">tB</span> <span class="bound">pB</span> <span class="main">⟶</span> 
    bob_payoff <span class="main">≥</span> strategic_space_2p.bob_payoff <span class="free">γ</span> <span class="free">θ<span class="hidden">⇩</span><sub>A</sub></span> <span class="free">φ<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">tB</span> <span class="bound">pB</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> strategic_space_2p<span class="main">)</span> <span class="entity">is_pareto_opt</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">is_pareto_opt</span> <span class="main">≡</span> <span class="main">∀</span><span class="bound">tA</span> <span class="bound">pA</span> <span class="bound">tB</span> <span class="bound">pB</span><span class="main">.</span> strategic_space_2p <span class="free">γ</span> <span class="bound">tA</span> <span class="bound">pA</span> <span class="bound">tB</span> <span class="bound">pB</span> <span class="main">⟶</span>
<span class="main">(</span><span class="main">(</span>strategic_space_2p.alice_payoff <span class="free">γ</span> <span class="bound">tA</span> <span class="bound">pA</span> <span class="bound">tB</span> <span class="bound">pB</span> <span class="main">&gt;</span> alice_payoff <span class="main">⟶</span> 
  strategic_space_2p.bob_payoff <span class="free">γ</span> <span class="bound">tA</span> <span class="bound">pA</span> <span class="bound">tB</span> <span class="bound">pB</span> <span class="main">&lt;</span> bob_payoff<span class="main">)</span> <span class="main">∧</span>
 <span class="main">(</span>strategic_space_2p.bob_payoff <span class="free">γ</span> <span class="bound">tA</span> <span class="bound">pA</span> <span class="bound">tB</span> <span class="bound">pB</span> <span class="main">&gt;</span> bob_payoff <span class="main">⟶</span> 
  strategic_space_2p.alice_payoff <span class="free">γ</span> <span class="bound">tA</span> <span class="bound">pA</span> <span class="bound">tB</span> <span class="bound">pB</span> <span class="main">&lt;</span> alice_payoff<span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> strategic_space_2p<span class="main">)</span> sum_of_prob<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">v</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"complex Matrix.mat"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"state <span class="numeral">2</span> <span class="free">v</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>prob00 <span class="free">v</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span>prob11 <span class="free">v</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span>prob01 <span class="free">v</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span>prob10 <span class="free">v</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>prob00 <span class="free">v</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span>prob11 <span class="free">v</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span>prob01 <span class="free">v</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span>prob10 <span class="free">v</span><span class="main">)</span> <span class="main">=</span> 
        <span class="main">(</span>cmod <span class="main">(</span><span class="free">v</span> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="main">(</span>cmod <span class="main">(</span><span class="free">v</span> <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="main">(</span>cmod <span class="main">(</span><span class="free">v</span> <span class="main">$$</span> <span class="main">(</span><span class="numeral">2</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="main">(</span>cmod <span class="main">(</span><span class="free">v</span> <span class="main">$$</span> <span class="main">(</span><span class="numeral">3</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> state_def assms cpx_vec_length_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_4<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> strategic_space_2p<span class="main">)</span> sum_payoff_le_6<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">tA</span> <span class="free">pA</span> <span class="free">tB</span> <span class="free">pB</span> <span class="main">::</span> <span class="quoted">real</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"alice_payoff <span class="main">+</span> bob_payoff <span class="main">≤</span> <span class="numeral">6</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"alice_payoff <span class="main">+</span> bob_payoff <span class="main">=</span> <span class="numeral">6</span> <span class="main">*</span> <span class="main">(</span>prob00 ψ<span class="hidden">⇩</span><sub>f</sub><span class="main">)</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span>prob11 ψ<span class="hidden">⇩</span><sub>f</sub><span class="main">)</span> <span class="main">+</span> <span class="numeral">5</span> <span class="main">*</span> <span class="main">(</span>prob01 ψ<span class="hidden">⇩</span><sub>f</sub><span class="main">)</span> <span class="main">+</span> <span class="numeral">5</span> <span class="main">*</span> <span class="main">(</span>prob10 ψ<span class="hidden">⇩</span><sub>f</sub><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> alice_payoff_def bob_payoff_def psi_f_is_state <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"alice_payoff <span class="main">+</span> bob_payoff <span class="main">≤</span> <span class="numeral">6</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span>prob00 ψ<span class="hidden">⇩</span><sub>f</sub><span class="main">)</span> <span class="main">+</span> <span class="main">(</span>prob11 ψ<span class="hidden">⇩</span><sub>f</sub><span class="main">)</span> <span class="main">+</span> <span class="main">(</span>prob01 ψ<span class="hidden">⇩</span><sub>f</sub><span class="main">)</span> <span class="main">+</span> <span class="main">(</span>prob10 ψ<span class="hidden">⇩</span><sub>f</sub><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> psi_f_is_state <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>prob00 ψ<span class="hidden">⇩</span><sub>f</sub><span class="main">)</span> <span class="main">+</span> <span class="main">(</span>prob11 ψ<span class="hidden">⇩</span><sub>f</sub><span class="main">)</span> <span class="main">+</span> <span class="main">(</span>prob01 ψ<span class="hidden">⇩</span><sub>f</sub><span class="main">)</span> <span class="main">+</span> <span class="main">(</span>prob10 ψ<span class="hidden">⇩</span><sub>f</sub><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> sum_of_prob<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"ψ<span class="hidden">⇩</span><sub>f</sub>"</span></span><span class="main">]</span> psi_f_is_state <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> strategic_space_2p<span class="main">)</span> coop_is_pareto_opt<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"alice_payoff <span class="main">=</span> <span class="numeral">3</span> <span class="main">∧</span> bob_payoff <span class="main">=</span> <span class="numeral">3</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_pareto_opt"</span></span>
  <span class="keyword1"><span class="command">using</span></span> is_pareto_opt_def strategic_space_2p.sum_payoff_le_6 assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹The Separable Case›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> strategic_space_2p<span class="main">)</span> separable_case_CC<span class="main">:</span> <span class="comment1">(* both player cooperate *)</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">γ</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">θ<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">φ<span class="hidden">⇩</span><sub>B</sub></span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">θ<span class="hidden">⇩</span><sub>B</sub></span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟶</span> alice_payoff <span class="main">=</span> <span class="numeral">3</span> <span class="main">∧</span> bob_payoff <span class="main">=</span> <span class="numeral">3</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> alice_payoff_def bob_payoff_def cos_sin_squared_add_cpx psi_f_is_state <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> strategic_space_2p<span class="main">)</span> separable_case_DD<span class="main">:</span> <span class="comment1">(* both player defect *)</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">γ</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">θ<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> pi <span class="main">∧</span> <span class="free">φ<span class="hidden">⇩</span><sub>B</sub></span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">θ<span class="hidden">⇩</span><sub>B</sub></span> <span class="main">=</span> pi <span class="main">⟶</span> alice_payoff <span class="main">=</span> <span class="main">1</span> <span class="main">∧</span> bob_payoff <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> alice_payoff_def bob_payoff_def cos_sin_squared_add_cpx psi_f_is_state <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> strategic_space_2p<span class="main">)</span> separable_case_DC<span class="main">:</span> <span class="comment1">(* Alice defects, and Bob cooperates *)</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">γ</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">θ<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> pi <span class="main">∧</span> <span class="free">φ<span class="hidden">⇩</span><sub>B</sub></span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">θ<span class="hidden">⇩</span><sub>B</sub></span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟶</span> alice_payoff <span class="main">=</span> <span class="numeral">5</span> <span class="main">∧</span> bob_payoff <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> alice_payoff_def bob_payoff_def sin_cos_squared_add_cpx psi_f_is_state <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> strategic_space_2p<span class="main">)</span> separable_alice_payoff_D<span class="hidden">⇩</span><sub>B</sub><span class="main">:</span> 
<span class="comment1">(* Alice's payoff in the separable case given that Bob defects *)</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">γ</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ<span class="hidden">⇩</span><sub>B</sub></span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">θ<span class="hidden">⇩</span><sub>B</sub></span> <span class="main">=</span> pi"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"alice_payoff <span class="main">≤</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> alice_payoff_def assms sin_squared_le_one psi_f_is_state <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> strategic_space_2p<span class="main">)</span> separable_bob_payoff_D<span class="hidden">⇩</span><sub>A</sub><span class="main">:</span>
<span class="comment1">(* Bob's payoff in the separable case given that Alice defects *)</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">γ</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">θ<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> pi"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"bob_payoff <span class="main">≤</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> bob_payoff_def assms sin_squared_le_one psi_f_is_state <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> strategic_space_2p<span class="main">)</span> separable_case_DD_alice_opt<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">γ</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">θ<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> pi <span class="main">∧</span> <span class="free">φ<span class="hidden">⇩</span><sub>B</sub></span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">θ<span class="hidden">⇩</span><sub>B</sub></span> <span class="main">=</span> pi"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">tA</span> <span class="bound">pA</span><span class="main">.</span> strategic_space_2p <span class="free">γ</span> <span class="bound">tA</span> <span class="bound">pA</span> <span class="free">θ<span class="hidden">⇩</span><sub>B</sub></span> <span class="free">φ<span class="hidden">⇩</span><sub>B</sub></span> <span class="main">⟶</span> strategic_space_2p.alice_payoff <span class="free">γ</span> <span class="bound">tA</span> <span class="bound">pA</span> <span class="free">θ<span class="hidden">⇩</span><sub>B</sub></span> <span class="free">φ<span class="hidden">⇩</span><sub>B</sub></span> <span class="main">≤</span> alice_payoff"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">tA</span> <span class="skolem">pA</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"strategic_space_2p <span class="free">γ</span> <span class="skolem">tA</span> <span class="skolem">pA</span> <span class="free">θ<span class="hidden">⇩</span><sub>B</sub></span> <span class="free">φ<span class="hidden">⇩</span><sub>B</sub></span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"strategic_space_2p.alice_payoff <span class="free">γ</span> <span class="skolem">tA</span> <span class="skolem">pA</span> <span class="free">θ<span class="hidden">⇩</span><sub>B</sub></span> <span class="free">φ<span class="hidden">⇩</span><sub>B</sub></span> <span class="main">≤</span> alice_payoff"</span></span>
    <span class="keyword1"><span class="command">using</span></span> separable_case_DD strategic_space_2p.separable_alice_payoff_D<span class="hidden">⇩</span><sub>B</sub> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> strategic_space_2p<span class="main">)</span> separable_case_DD_bob_opt<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">γ</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">θ<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> pi <span class="main">∧</span> <span class="free">φ<span class="hidden">⇩</span><sub>B</sub></span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">θ<span class="hidden">⇩</span><sub>B</sub></span> <span class="main">=</span> pi"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">tB</span> <span class="bound">pB</span><span class="main">.</span> strategic_space_2p <span class="free">γ</span> <span class="free">θ<span class="hidden">⇩</span><sub>A</sub></span> <span class="free">φ<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">tB</span> <span class="bound">pB</span> <span class="main">⟶</span> strategic_space_2p.bob_payoff <span class="free">γ</span> <span class="free">θ<span class="hidden">⇩</span><sub>A</sub></span> <span class="free">φ<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">tB</span> <span class="bound">pB</span> <span class="main">≤</span> bob_payoff"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">tB</span> <span class="skolem">pB</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"strategic_space_2p <span class="free">γ</span> <span class="free">θ<span class="hidden">⇩</span><sub>A</sub></span> <span class="free">φ<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">tB</span> <span class="skolem">pB</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"strategic_space_2p.bob_payoff <span class="free">γ</span> <span class="free">θ<span class="hidden">⇩</span><sub>A</sub></span> <span class="free">φ<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">tB</span> <span class="skolem">pB</span> <span class="main">≤</span> bob_payoff"</span></span>
    <span class="keyword1"><span class="command">using</span></span> separable_case_DD strategic_space_2p.separable_bob_payoff_D<span class="hidden">⇩</span><sub>A</sub> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> strategic_space_2p<span class="main">)</span> separable_case_DD_is_nash_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">γ</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">θ<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> pi <span class="main">∧</span> <span class="free">φ<span class="hidden">⇩</span><sub>B</sub></span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">θ<span class="hidden">⇩</span><sub>B</sub></span> <span class="main">=</span> pi <span class="main">⟶</span> is_nash_eq"</span></span>
  <span class="keyword1"><span class="command">using</span></span> is_nash_eq_def separable_case_DD_alice_opt separable_case_DD_bob_opt assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> strategic_space_2p<span class="main">)</span> separable_case_CC_is_not_nash_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">γ</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">θ<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">φ<span class="hidden">⇩</span><sub>B</sub></span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">θ<span class="hidden">⇩</span><sub>B</sub></span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟶</span> <span class="main">¬</span> is_nash_eq"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> asm<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">φ<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">θ<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">φ<span class="hidden">⇩</span><sub>B</sub></span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">θ<span class="hidden">⇩</span><sub>B</sub></span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> f0<span class="main">:</span><span class="quoted"><span class="quoted">"strategic_space_2p <span class="free">γ</span> pi <span class="main">0</span> <span class="free">θ<span class="hidden">⇩</span><sub>B</sub></span> <span class="free">φ<span class="hidden">⇩</span><sub>B</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> strategic_space_2p_def strategic_space_2p_axioms_def prisoner_def asm <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"strategic_space_2p.alice_payoff <span class="free">γ</span> pi <span class="main">0</span> <span class="free">θ<span class="hidden">⇩</span><sub>B</sub></span> <span class="free">φ<span class="hidden">⇩</span><sub>B</sub></span> <span class="main">=</span> <span class="numeral">5</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> strategic_space_2p.separable_case_DC assms asm <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"alice_payoff <span class="main">=</span> <span class="numeral">3</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> separable_case_CC assms asm <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"strategic_space_2p <span class="free">γ</span> pi <span class="main">0</span> <span class="free">θ<span class="hidden">⇩</span><sub>B</sub></span> <span class="free">φ<span class="hidden">⇩</span><sub>B</sub></span> <span class="main">∧</span> strategic_space_2p.alice_payoff <span class="free">γ</span> pi <span class="main">0</span> <span class="free">θ<span class="hidden">⇩</span><sub>B</sub></span> <span class="free">φ<span class="hidden">⇩</span><sub>B</sub></span> <span class="main">&gt;</span> alice_payoff"</span></span>
    <span class="keyword1"><span class="command">using</span></span> f0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>is_nash_eq"</span></span>
    <span class="keyword1"><span class="command">using</span></span> is_nash_eq_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> strategic_space_2p<span class="main">)</span> separable_case_CC_is_pareto_optimal<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">γ</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">θ<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">φ<span class="hidden">⇩</span><sub>B</sub></span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">θ<span class="hidden">⇩</span><sub>B</sub></span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟶</span> is_pareto_opt"</span></span>
  <span class="keyword1"><span class="command">using</span></span> coop_is_pareto_opt separable_case_CC assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹The Maximally Entangled Case›</span></span>

<span class="keyword1" id="Quantum_Prisoners_Dilemma-exp_to_sin"><span class="command">lemma</span></span> exp_to_sin<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span><span class="main">::</span> <span class="quoted">real</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"exp <span class="main">(</span><span class="keyword1">𝗂</span> <span class="main">*</span> <span class="free">x</span><span class="main">)</span> <span class="main">-</span> exp <span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="keyword1">𝗂</span> <span class="main">*</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">*</span> <span class="keyword1">𝗂</span> <span class="main">*</span> <span class="main">(</span>sin <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> exp_of_real exp_of_real_inv <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Quantum_Prisoners_Dilemma-exp_to_cos"><span class="command">lemma</span></span> exp_to_cos<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span><span class="main">::</span> <span class="quoted">real</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"exp <span class="main">(</span><span class="keyword1">𝗂</span> <span class="main">*</span> <span class="free">x</span><span class="main">)</span> <span class="main">+</span> exp <span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="keyword1">𝗂</span> <span class="main">*</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span>cos <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> exp_of_real exp_of_real_inv <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Quantum_Prisoners_Dilemma-cmod_real_prod_squared"><span class="command">lemma</span></span> cmod_real_prod_squared<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="free">y</span><span class="main">::</span> <span class="quoted">real</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>cmod <span class="main">(</span>complex_of_real <span class="free">x</span> <span class="main">*</span> complex_of_real <span class="free">y</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">=</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">*</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> norm_mult power_mult_distrib<span class="main">)</span>

<span class="keyword1" id="Quantum_Prisoners_Dilemma-quantum_payoff_simp"><span class="command">lemma</span></span> quantum_payoff_simp<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="free">y</span><span class="main">::</span> <span class="quoted">real</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">3</span> <span class="main">*</span> <span class="main">(</span>cmod <span class="main">(</span>complex_of_real <span class="main">(</span>sin <span class="free">x</span><span class="main">)</span> <span class="main">*</span> complex_of_real <span class="main">(</span>cos <span class="free">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span>
         <span class="main">(</span>cmod <span class="main">(</span>complex_of_real <span class="main">(</span>cos <span class="free">x</span><span class="main">)</span> <span class="main">*</span> complex_of_real <span class="main">(</span>cos <span class="free">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">=</span> 
         <span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span>sin <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">*</span> <span class="main">(</span>cos <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="main">(</span>cos <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">3</span> <span class="main">*</span> <span class="main">(</span>sin <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">*</span> <span class="main">(</span>cos <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="main">(</span>cos <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">*</span> <span class="main">(</span>cos <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">=</span> 
        <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span>sin <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">*</span> <span class="main">(</span>cos <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">(</span>sin <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="main">(</span>cos <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>cos <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> sin_cos_squared_add2<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cmod_real_prod_squared power_mult_distrib<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Quantum_Prisoners_Dilemma-quantum_payoff_le_3"><span class="command">lemma</span></span> quantum_payoff_le_3<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="free">y</span><span class="main">::</span> <span class="quoted">real</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span>sin <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">*</span> <span class="main">(</span>cos <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="main">(</span>cos <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">≤</span> <span class="numeral">3</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>sin <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">*</span> <span class="main">(</span>cos <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">≤</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sin_squared_le_one cos_squared_le_one mult_le_one<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span>sin <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">*</span> <span class="main">(</span>cos <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">≤</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>cos <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">≤</span> <span class="main">1</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> cos_squared_le_one<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">y</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Quantum_Prisoners_Dilemma-sqrt_two_squared_cpx"><span class="command">lemma</span></span> sqrt_two_squared_cpx<span class="main">:</span> <span class="quoted"><span class="quoted">"complex_of_real <span class="main">(</span>sqrt <span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> complex_of_real <span class="main">(</span>sqrt <span class="numeral">2</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">2</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult_2_right numeral_Bit0 of_real_mult of_real_numeral real_sqrt_four real_sqrt_mult<span class="main">)</span>

<span class="keyword1" id="Quantum_Prisoners_Dilemma-hidden_sqrt_two_squared_cpx"><span class="command">lemma</span></span> hidden_sqrt_two_squared_cpx<span class="main">:</span> <span class="quoted"><span class="quoted">"complex_of_real <span class="main">(</span>sqrt <span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>complex_of_real <span class="main">(</span>sqrt <span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="free">x</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">4</span> <span class="main">=</span> <span class="free">x</span><span class="main">/</span><span class="numeral">2</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> sqrt_two_squared_cpx <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> strategic_space_2p<span class="main">)</span> max_entangled_DD<span class="main">:</span>
<span class="comment1">(* both players defects in the maximally entangled case *)</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">γ</span> <span class="main">=</span> pi<span class="main">/</span><span class="numeral">2</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">θ<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> pi <span class="main">∧</span> <span class="free">φ<span class="hidden">⇩</span><sub>B</sub></span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">θ<span class="hidden">⇩</span><sub>B</sub></span> <span class="main">=</span> pi <span class="main">⟶</span> alice_payoff <span class="main">=</span> <span class="main">1</span> <span class="main">∧</span> bob_payoff <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> alice_payoff_def bob_payoff_def cos_sin_squared_add_cpx psi_f_is_state
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> strategic_space_2p<span class="main">)</span> max_entangled_QQ<span class="main">:</span>
<span class="comment1">(* both players play the move Q in the maximally entangled case *)</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">γ</span> <span class="main">=</span> pi<span class="main">/</span><span class="numeral">2</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> pi<span class="main">/</span><span class="numeral">2</span> <span class="main">∧</span> <span class="free">θ<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">φ<span class="hidden">⇩</span><sub>B</sub></span> <span class="main">=</span> pi<span class="main">/</span><span class="numeral">2</span> <span class="main">∧</span> <span class="free">θ<span class="hidden">⇩</span><sub>B</sub></span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟶</span> alice_payoff <span class="main">=</span> <span class="numeral">3</span> <span class="main">∧</span> bob_payoff <span class="main">=</span> <span class="numeral">3</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> alice_payoff_def bob_payoff_def sin_cos_squared_add_cpx exp_of_half_pi exp_of_minus_half_pi psi_f_is_state
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> strategic_space_2p<span class="main">)</span> max_entangled_QD<span class="main">:</span>
<span class="comment1">(* Alice plays the move Q, and Bob defects in the maximally entangled case *)</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">γ</span> <span class="main">=</span> pi<span class="main">/</span><span class="numeral">2</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> pi<span class="main">/</span><span class="numeral">2</span> <span class="main">∧</span> <span class="free">θ<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">φ<span class="hidden">⇩</span><sub>B</sub></span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">θ<span class="hidden">⇩</span><sub>B</sub></span> <span class="main">=</span> pi <span class="main">⟶</span> alice_payoff <span class="main">=</span> <span class="numeral">5</span> <span class="main">∧</span> bob_payoff <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> alice_payoff_def bob_payoff_def cos_sin_squared_add_cpx exp_of_half_pi exp_of_minus_half_pi 
        psi_f_is_state sqrt_two_squared_cpx
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms <span class="dynamic"><span class="dynamic">algebra_simps</span></span> sin_45 cos_45<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> strategic_space_2p<span class="main">)</span> max_entangled_alice_payoff_Q<span class="hidden">⇩</span><sub>B</sub><span class="main">:</span>
<span class="comment1">(* Alice's payoff in the maximally entangled case given that Bob plays the move Q *)</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">γ</span> <span class="main">=</span> pi<span class="main">/</span><span class="numeral">2</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ<span class="hidden">⇩</span><sub>B</sub></span> <span class="main">=</span> pi<span class="main">/</span><span class="numeral">2</span> <span class="main">∧</span> <span class="free">θ<span class="hidden">⇩</span><sub>B</sub></span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟶</span> alice_payoff <span class="main">≤</span> <span class="numeral">3</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> asm<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">φ<span class="hidden">⇩</span><sub>B</sub></span> <span class="main">=</span> pi<span class="main">/</span><span class="numeral">2</span> <span class="main">∧</span> <span class="free">θ<span class="hidden">⇩</span><sub>B</sub></span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ψ<span class="hidden">⇩</span><sub>f</sub> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span><span class="main">(</span>sin <span class="free">φ<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>cos <span class="main">(</span><span class="free">θ<span class="hidden">⇩</span><sub>A</sub></span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ψ<span class="hidden">⇩</span><sub>f</sub> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">𝗂</span> <span class="main">*</span> <span class="main">(</span>sqrt <span class="numeral">2</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>sqrt <span class="numeral">2</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>cos <span class="main">(</span><span class="free">θ<span class="hidden">⇩</span><sub>A</sub></span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> exp <span class="main">(</span><span class="keyword1">𝗂</span> <span class="main">*</span> <span class="free">φ<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span> <span class="main">+</span>
                        <span class="keyword1">𝗂</span> <span class="main">*</span> <span class="main">(</span>sqrt <span class="numeral">2</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>sqrt <span class="numeral">2</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>cos <span class="main">(</span><span class="free">θ<span class="hidden">⇩</span><sub>A</sub></span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">-</span>exp <span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="keyword1">𝗂</span> <span class="main">*</span> <span class="free">φ<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> mat_of_cols_list_def asm assms exp_of_half_pi exp_of_minus_half_pi
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sin_of_quarter_pi<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">γ</span>"</span></span><span class="main"><span class="main">]</span></span> cos_of_quarter_pi<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">γ</span>"</span></span><span class="main"><span class="main">]</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ψ<span class="hidden">⇩</span><sub>f</sub> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">𝗂</span> <span class="main">*</span> <span class="main">(</span>sqrt <span class="numeral">2</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>sqrt <span class="numeral">2</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>cos <span class="main">(</span><span class="free">θ<span class="hidden">⇩</span><sub>A</sub></span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>exp <span class="main">(</span><span class="keyword1">𝗂</span> <span class="main">*</span> <span class="free">φ<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span> <span class="main">-</span> exp <span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="keyword1">𝗂</span> <span class="main">*</span> <span class="free">φ<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ψ<span class="hidden">⇩</span><sub>f</sub> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">𝗂</span> <span class="main">*</span> <span class="main">(</span>cos <span class="main">(</span><span class="free">θ<span class="hidden">⇩</span><sub>A</sub></span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>exp <span class="main">(</span><span class="keyword1">𝗂</span> <span class="main">*</span> <span class="free">φ<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span> <span class="main">-</span> exp <span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="keyword1">𝗂</span> <span class="main">*</span> <span class="free">φ<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> sqrt_two_squared_cpx <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> exp_to_sin <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ψ<span class="hidden">⇩</span><sub>f</sub> <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">=</span> sin <span class="main">(</span><span class="free">θ<span class="hidden">⇩</span><sub>A</sub></span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> mat_of_cols_list_def asm assms exp_of_half_pi exp_of_minus_half_pi sqrt_two_squared_cpx
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sin_of_quarter_pi<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">γ</span>"</span></span><span class="main"><span class="main">]</span></span> cos_of_quarter_pi<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">γ</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ψ<span class="hidden">⇩</span><sub>f</sub> <span class="main">$$</span> <span class="main">(</span><span class="numeral">2</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> mat_of_cols_list_def asm assms exp_of_half_pi exp_of_minus_half_pi sqrt_two_squared_cpx
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sin_of_quarter_pi<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">γ</span>"</span></span><span class="main"><span class="main">]</span></span> cos_of_quarter_pi<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">γ</span>"</span></span><span class="main"><span class="main">]</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ψ<span class="hidden">⇩</span><sub>f</sub> <span class="main">$$</span> <span class="main">(</span><span class="numeral">3</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>cos <span class="free">φ<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>cos <span class="main">(</span><span class="free">θ<span class="hidden">⇩</span><sub>A</sub></span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ψ<span class="hidden">⇩</span><sub>f</sub> <span class="main">$$</span> <span class="main">(</span><span class="numeral">3</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">=</span> exp <span class="main">(</span><span class="keyword1">𝗂</span> <span class="main">*</span> <span class="free">φ<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>cos <span class="main">(</span><span class="free">θ<span class="hidden">⇩</span><sub>A</sub></span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>sqrt <span class="numeral">2</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>sqrt <span class="numeral">2</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">+</span>
                        exp <span class="main">(</span><span class="main">-</span> <span class="main">(</span><span class="keyword1">𝗂</span> <span class="main">*</span> <span class="free">φ<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>cos <span class="main">(</span><span class="free">θ<span class="hidden">⇩</span><sub>A</sub></span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>sqrt <span class="numeral">2</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>sqrt <span class="numeral">2</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> mat_of_cols_list_def asm assms exp_of_half_pi exp_of_minus_half_pi
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sin_of_quarter_pi<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">γ</span>"</span></span><span class="main"><span class="main">]</span></span> cos_of_quarter_pi<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">γ</span>"</span></span><span class="main"><span class="main">]</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ψ<span class="hidden">⇩</span><sub>f</sub> <span class="main">$$</span> <span class="main">(</span><span class="numeral">3</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>exp <span class="main">(</span><span class="keyword1">𝗂</span> <span class="main">*</span> <span class="free">φ<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span> <span class="main">+</span> exp <span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="keyword1">𝗂</span> <span class="main">*</span> <span class="free">φ<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>cos <span class="main">(</span><span class="free">θ<span class="hidden">⇩</span><sub>A</sub></span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>sqrt <span class="numeral">2</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>sqrt <span class="numeral">2</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ψ<span class="hidden">⇩</span><sub>f</sub> <span class="main">$$</span> <span class="main">(</span><span class="numeral">3</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>exp <span class="main">(</span><span class="keyword1">𝗂</span> <span class="main">*</span> <span class="free">φ<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span> <span class="main">+</span> exp <span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="keyword1">𝗂</span> <span class="main">*</span> <span class="free">φ<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>cos <span class="main">(</span><span class="free">θ<span class="hidden">⇩</span><sub>A</sub></span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> sqrt_two_squared_cpx hidden_sqrt_two_squared_cpx <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> exp_to_cos <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"alice_payoff <span class="main">≤</span> <span class="numeral">3</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> alice_payoff_def psi_f_is_state quantum_payoff_simp quantum_payoff_le_3 
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> strategic_space_2p<span class="main">)</span> max_entangled_bob_payoff_Q<span class="hidden">⇩</span><sub>A</sub><span class="main">:</span>
<span class="comment1">(* Bob's payoff in the maximally entangled case given that Alice plays the move Q *)</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">γ</span> <span class="main">=</span> pi<span class="main">/</span><span class="numeral">2</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> pi<span class="main">/</span><span class="numeral">2</span> <span class="main">∧</span> <span class="free">θ<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟶</span> bob_payoff <span class="main">≤</span> <span class="numeral">3</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> asm<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">φ<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> pi<span class="main">/</span><span class="numeral">2</span> <span class="main">∧</span> <span class="free">θ<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ψ<span class="hidden">⇩</span><sub>f</sub> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span><span class="main">(</span>sin <span class="free">φ<span class="hidden">⇩</span><sub>B</sub></span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>cos <span class="main">(</span><span class="free">θ<span class="hidden">⇩</span><sub>B</sub></span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ψ<span class="hidden">⇩</span><sub>f</sub> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">𝗂</span> <span class="main">*</span> <span class="main">(</span>sqrt <span class="numeral">2</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>sqrt <span class="numeral">2</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>cos <span class="main">(</span><span class="free">θ<span class="hidden">⇩</span><sub>B</sub></span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> exp <span class="main">(</span><span class="keyword1">𝗂</span> <span class="main">*</span> <span class="free">φ<span class="hidden">⇩</span><sub>B</sub></span><span class="main">)</span> <span class="main">+</span>
                        <span class="keyword1">𝗂</span> <span class="main">*</span> <span class="main">(</span>sqrt <span class="numeral">2</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>sqrt <span class="numeral">2</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>cos <span class="main">(</span><span class="free">θ<span class="hidden">⇩</span><sub>B</sub></span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">-</span>exp <span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="keyword1">𝗂</span> <span class="main">*</span> <span class="free">φ<span class="hidden">⇩</span><sub>B</sub></span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> mat_of_cols_list_def asm assms exp_of_half_pi exp_of_minus_half_pi
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sin_of_quarter_pi<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">γ</span>"</span></span><span class="main"><span class="main">]</span></span> cos_of_quarter_pi<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">γ</span>"</span></span><span class="main"><span class="main">]</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ψ<span class="hidden">⇩</span><sub>f</sub> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">𝗂</span> <span class="main">*</span> <span class="main">(</span>sqrt <span class="numeral">2</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>sqrt <span class="numeral">2</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>cos <span class="main">(</span><span class="free">θ<span class="hidden">⇩</span><sub>B</sub></span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>exp <span class="main">(</span><span class="keyword1">𝗂</span> <span class="main">*</span> <span class="free">φ<span class="hidden">⇩</span><sub>B</sub></span><span class="main">)</span> <span class="main">-</span> exp <span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="keyword1">𝗂</span> <span class="main">*</span> <span class="free">φ<span class="hidden">⇩</span><sub>B</sub></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ψ<span class="hidden">⇩</span><sub>f</sub> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">𝗂</span> <span class="main">*</span> <span class="main">(</span>cos <span class="main">(</span><span class="free">θ<span class="hidden">⇩</span><sub>B</sub></span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>exp <span class="main">(</span><span class="keyword1">𝗂</span> <span class="main">*</span> <span class="free">φ<span class="hidden">⇩</span><sub>B</sub></span><span class="main">)</span> <span class="main">-</span> exp <span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="keyword1">𝗂</span> <span class="main">*</span> <span class="free">φ<span class="hidden">⇩</span><sub>B</sub></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> sqrt_two_squared_cpx <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> exp_to_sin <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ψ<span class="hidden">⇩</span><sub>f</sub> <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> mat_of_cols_list_def asm assms exp_of_half_pi exp_of_minus_half_pi sqrt_two_squared_cpx
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sin_of_quarter_pi<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">γ</span>"</span></span><span class="main"><span class="main">]</span></span> cos_of_quarter_pi<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">γ</span>"</span></span><span class="main"><span class="main">]</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ψ<span class="hidden">⇩</span><sub>f</sub> <span class="main">$$</span> <span class="main">(</span><span class="numeral">2</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">=</span> sin <span class="main">(</span><span class="free">θ<span class="hidden">⇩</span><sub>B</sub></span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> mat_of_cols_list_def asm assms exp_of_half_pi exp_of_minus_half_pi sqrt_two_squared_cpx
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sin_of_quarter_pi<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">γ</span>"</span></span><span class="main"><span class="main">]</span></span> cos_of_quarter_pi<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">γ</span>"</span></span><span class="main"><span class="main">]</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ψ<span class="hidden">⇩</span><sub>f</sub> <span class="main">$$</span> <span class="main">(</span><span class="numeral">3</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>cos <span class="free">φ<span class="hidden">⇩</span><sub>B</sub></span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>cos <span class="main">(</span><span class="free">θ<span class="hidden">⇩</span><sub>B</sub></span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ψ<span class="hidden">⇩</span><sub>f</sub> <span class="main">$$</span> <span class="main">(</span><span class="numeral">3</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">=</span> exp <span class="main">(</span><span class="keyword1">𝗂</span> <span class="main">*</span> <span class="free">φ<span class="hidden">⇩</span><sub>B</sub></span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>cos <span class="main">(</span><span class="free">θ<span class="hidden">⇩</span><sub>B</sub></span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>sqrt <span class="numeral">2</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>sqrt <span class="numeral">2</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">+</span>
                        exp <span class="main">(</span><span class="main">-</span> <span class="main">(</span><span class="keyword1">𝗂</span> <span class="main">*</span> <span class="free">φ<span class="hidden">⇩</span><sub>B</sub></span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>cos <span class="main">(</span><span class="free">θ<span class="hidden">⇩</span><sub>B</sub></span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>sqrt <span class="numeral">2</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>sqrt <span class="numeral">2</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> mat_of_cols_list_def asm assms exp_of_half_pi exp_of_minus_half_pi
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sin_of_quarter_pi<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">γ</span>"</span></span><span class="main"><span class="main">]</span></span> cos_of_quarter_pi<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">γ</span>"</span></span><span class="main"><span class="main">]</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ψ<span class="hidden">⇩</span><sub>f</sub> <span class="main">$$</span> <span class="main">(</span><span class="numeral">3</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>exp <span class="main">(</span><span class="keyword1">𝗂</span> <span class="main">*</span> <span class="free">φ<span class="hidden">⇩</span><sub>B</sub></span><span class="main">)</span> <span class="main">+</span> exp <span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="keyword1">𝗂</span> <span class="main">*</span> <span class="free">φ<span class="hidden">⇩</span><sub>B</sub></span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>cos <span class="main">(</span><span class="free">θ<span class="hidden">⇩</span><sub>B</sub></span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>sqrt <span class="numeral">2</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>sqrt <span class="numeral">2</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ψ<span class="hidden">⇩</span><sub>f</sub> <span class="main">$$</span> <span class="main">(</span><span class="numeral">3</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>exp <span class="main">(</span><span class="keyword1">𝗂</span> <span class="main">*</span> <span class="free">φ<span class="hidden">⇩</span><sub>B</sub></span><span class="main">)</span> <span class="main">+</span> exp <span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="keyword1">𝗂</span> <span class="main">*</span> <span class="free">φ<span class="hidden">⇩</span><sub>B</sub></span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>cos <span class="main">(</span><span class="free">θ<span class="hidden">⇩</span><sub>B</sub></span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> sqrt_two_squared_cpx hidden_sqrt_two_squared_cpx <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> exp_to_cos <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"bob_payoff <span class="main">≤</span> <span class="numeral">3</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> bob_payoff_def psi_f_is_state quantum_payoff_simp quantum_payoff_le_3 
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> strategic_space_2p<span class="main">)</span> max_entangled_DD_is_not_nash_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">γ</span> <span class="main">=</span> pi<span class="main">/</span><span class="numeral">2</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">θ<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> pi <span class="main">∧</span> <span class="free">φ<span class="hidden">⇩</span><sub>B</sub></span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">θ<span class="hidden">⇩</span><sub>B</sub></span> <span class="main">=</span> pi <span class="main">⟶</span> <span class="main">¬</span>is_nash_eq"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> asm<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">φ<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">θ<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> pi <span class="main">∧</span> <span class="free">φ<span class="hidden">⇩</span><sub>B</sub></span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">θ<span class="hidden">⇩</span><sub>B</sub></span> <span class="main">=</span> pi"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> f0<span class="main">:</span><span class="quoted"><span class="quoted">"strategic_space_2p <span class="free">γ</span> <span class="main">0</span> <span class="main">(</span>pi<span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="free">θ<span class="hidden">⇩</span><sub>B</sub></span> <span class="free">φ<span class="hidden">⇩</span><sub>B</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> strategic_space_2p_def strategic_space_2p_axioms_def prisoner_def asm <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"strategic_space_2p.alice_payoff <span class="free">γ</span> <span class="main">0</span> <span class="main">(</span>pi<span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="free">θ<span class="hidden">⇩</span><sub>B</sub></span> <span class="free">φ<span class="hidden">⇩</span><sub>B</sub></span> <span class="main">=</span> <span class="numeral">5</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> strategic_space_2p.max_entangled_QD assms asm <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"alice_payoff <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> max_entangled_DD assms asm <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"strategic_space_2p <span class="free">γ</span> <span class="main">0</span> <span class="main">(</span>pi<span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="free">θ<span class="hidden">⇩</span><sub>B</sub></span> <span class="free">φ<span class="hidden">⇩</span><sub>B</sub></span> <span class="main">∧</span> strategic_space_2p.alice_payoff <span class="free">γ</span> <span class="main">0</span> <span class="main">(</span>pi<span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="free">θ<span class="hidden">⇩</span><sub>B</sub></span> <span class="free">φ<span class="hidden">⇩</span><sub>B</sub></span> <span class="main">&gt;</span> alice_payoff"</span></span>
    <span class="keyword1"><span class="command">using</span></span> f0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>is_nash_eq"</span></span>
    <span class="keyword1"><span class="command">using</span></span> is_nash_eq_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> strategic_space_2p<span class="main">)</span> max_entangled_alice_opt<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">γ</span> <span class="main">=</span> pi<span class="main">/</span><span class="numeral">2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> pi<span class="main">/</span><span class="numeral">2</span> <span class="main">∧</span> <span class="free">θ<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">φ<span class="hidden">⇩</span><sub>B</sub></span> <span class="main">=</span> pi<span class="main">/</span><span class="numeral">2</span> <span class="main">∧</span> <span class="free">θ<span class="hidden">⇩</span><sub>B</sub></span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">tA</span> <span class="bound">pA</span><span class="main">.</span> strategic_space_2p <span class="free">γ</span> <span class="bound">tA</span> <span class="bound">pA</span> <span class="free">θ<span class="hidden">⇩</span><sub>B</sub></span> <span class="free">φ<span class="hidden">⇩</span><sub>B</sub></span> <span class="main">⟶</span> strategic_space_2p.alice_payoff <span class="free">γ</span> <span class="bound">tA</span> <span class="bound">pA</span> <span class="free">θ<span class="hidden">⇩</span><sub>B</sub></span> <span class="free">φ<span class="hidden">⇩</span><sub>B</sub></span> <span class="main">≤</span> alice_payoff"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">tA</span> <span class="skolem">pA</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"strategic_space_2p <span class="free">γ</span> <span class="skolem">tA</span> <span class="skolem">pA</span> <span class="free">θ<span class="hidden">⇩</span><sub>B</sub></span> <span class="free">φ<span class="hidden">⇩</span><sub>B</sub></span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"strategic_space_2p.alice_payoff <span class="free">γ</span> <span class="skolem">tA</span> <span class="skolem">pA</span> <span class="free">θ<span class="hidden">⇩</span><sub>B</sub></span> <span class="free">φ<span class="hidden">⇩</span><sub>B</sub></span> <span class="main">≤</span> <span class="numeral">3</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> strategic_space_2p.max_entangled_alice_payoff_Q<span class="hidden">⇩</span><sub>B</sub> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"alice_payoff <span class="main">=</span> <span class="numeral">3</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> max_entangled_QQ assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"strategic_space_2p.alice_payoff <span class="free">γ</span> <span class="skolem">tA</span> <span class="skolem">pA</span> <span class="free">θ<span class="hidden">⇩</span><sub>B</sub></span> <span class="free">φ<span class="hidden">⇩</span><sub>B</sub></span> <span class="main">≤</span> alice_payoff"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> strategic_space_2p<span class="main">)</span> max_entangled_bob_opt<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">γ</span> <span class="main">=</span> pi<span class="main">/</span><span class="numeral">2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> pi<span class="main">/</span><span class="numeral">2</span> <span class="main">∧</span> <span class="free">θ<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">φ<span class="hidden">⇩</span><sub>B</sub></span> <span class="main">=</span> pi<span class="main">/</span><span class="numeral">2</span> <span class="main">∧</span> <span class="free">θ<span class="hidden">⇩</span><sub>B</sub></span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">tB</span> <span class="bound">pB</span><span class="main">.</span> strategic_space_2p <span class="free">γ</span> <span class="free">θ<span class="hidden">⇩</span><sub>A</sub></span> <span class="free">φ<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">tB</span> <span class="bound">pB</span> <span class="main">⟶</span> strategic_space_2p.bob_payoff <span class="free">γ</span> <span class="free">θ<span class="hidden">⇩</span><sub>A</sub></span> <span class="free">φ<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">tB</span> <span class="bound">pB</span> <span class="main">≤</span> bob_payoff"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">tB</span> <span class="skolem">pB</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"strategic_space_2p <span class="free">γ</span> <span class="free">θ<span class="hidden">⇩</span><sub>A</sub></span> <span class="free">φ<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">tB</span> <span class="skolem">pB</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"strategic_space_2p.bob_payoff <span class="free">γ</span> <span class="free">θ<span class="hidden">⇩</span><sub>A</sub></span> <span class="free">φ<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">tB</span> <span class="skolem">pB</span> <span class="main">≤</span> <span class="numeral">3</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> strategic_space_2p.max_entangled_bob_payoff_Q<span class="hidden">⇩</span><sub>A</sub> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bob_payoff <span class="main">=</span> <span class="numeral">3</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> max_entangled_QQ assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"strategic_space_2p.bob_payoff <span class="free">γ</span> <span class="free">θ<span class="hidden">⇩</span><sub>A</sub></span> <span class="free">φ<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">tB</span> <span class="skolem">pB</span> <span class="main">≤</span> bob_payoff"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> strategic_space_2p<span class="main">)</span> max_entangled_QQ_is_nash_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">γ</span> <span class="main">=</span> pi<span class="main">/</span><span class="numeral">2</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> pi<span class="main">/</span><span class="numeral">2</span> <span class="main">∧</span> <span class="free">θ<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">φ<span class="hidden">⇩</span><sub>B</sub></span> <span class="main">=</span> pi<span class="main">/</span><span class="numeral">2</span> <span class="main">∧</span> <span class="free">θ<span class="hidden">⇩</span><sub>B</sub></span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟶</span> is_nash_eq"</span></span>
  <span class="keyword1"><span class="command">using</span></span> max_entangled_alice_opt max_entangled_bob_opt is_nash_eq_def assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> strategic_space_2p<span class="main">)</span> max_entangled_QQ_is_pareto_optimal<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">γ</span> <span class="main">=</span> pi<span class="main">/</span><span class="numeral">2</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> pi<span class="main">/</span><span class="numeral">2</span> <span class="main">∧</span> <span class="free">θ<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">φ<span class="hidden">⇩</span><sub>B</sub></span> <span class="main">=</span> pi<span class="main">/</span><span class="numeral">2</span> <span class="main">∧</span> <span class="free">θ<span class="hidden">⇩</span><sub>B</sub></span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟶</span> is_pareto_opt"</span></span>
  <span class="keyword1"><span class="command">using</span></span> coop_is_pareto_opt max_entangled_QQ assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹The Unfair Strategy Case›</span></span>

<span class="keyword1" id="Quantum_Prisoners_Dilemma-half_sqrt_two_squared"><span class="command">lemma</span></span> half_sqrt_two_squared<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span>sqrt <span class="numeral">2</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power2_eq_square<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> strategic_space_2p<span class="main">)</span> max_entangled_MD<span class="main">:</span>
<span class="comment1">(* Alice plays the "miracle move", and Bob plays the classical defect move in the maximally entangled case *)</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">γ</span> <span class="main">=</span> pi<span class="main">/</span><span class="numeral">2</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> pi<span class="main">/</span><span class="numeral">2</span> <span class="main">∧</span> <span class="free">θ<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> pi<span class="main">/</span><span class="numeral">2</span> <span class="main">∧</span> <span class="free">φ<span class="hidden">⇩</span><sub>B</sub></span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">θ<span class="hidden">⇩</span><sub>B</sub></span> <span class="main">=</span> pi <span class="main">⟶</span> alice_payoff <span class="main">=</span> <span class="numeral">3</span> <span class="main">∧</span> bob_payoff <span class="main">=</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> asm<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">φ<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> pi<span class="main">/</span><span class="numeral">2</span> <span class="main">∧</span> <span class="free">θ<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> pi<span class="main">/</span><span class="numeral">2</span> <span class="main">∧</span> <span class="free">φ<span class="hidden">⇩</span><sub>B</sub></span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">θ<span class="hidden">⇩</span><sub>B</sub></span> <span class="main">=</span> pi"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"alice_payoff <span class="main">=</span> <span class="numeral">3</span> <span class="main">∧</span> bob_payoff <span class="main">=</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> alice_payoff_def bob_payoff_def sqrt_two_squared_cpx half_sqrt_two_squared
          exp_of_half_pi<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"pi<span class="main">/</span><span class="numeral">2</span>"</span></span><span class="main">]</span> exp_of_minus_half_pi<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"pi<span class="main">/</span><span class="numeral">2</span>"</span></span><span class="main">]</span> psi_f_is_state
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> asm assms sin_45 cos_45 <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> strategic_space_2p<span class="main">)</span> max_entangled_MC<span class="main">:</span>
<span class="comment1">(* Alice plays the "miracle move", and Bob plays the classical defect move in the maximally entangled case *)</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">γ</span> <span class="main">=</span> pi<span class="main">/</span><span class="numeral">2</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> pi<span class="main">/</span><span class="numeral">2</span> <span class="main">∧</span> <span class="free">θ<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> pi<span class="main">/</span><span class="numeral">2</span> <span class="main">∧</span> <span class="free">φ<span class="hidden">⇩</span><sub>B</sub></span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">θ<span class="hidden">⇩</span><sub>B</sub></span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟶</span> alice_payoff <span class="main">=</span> <span class="numeral">3</span> <span class="main">∧</span> bob_payoff <span class="main">=</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> asm<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">φ<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> pi<span class="main">/</span><span class="numeral">2</span> <span class="main">∧</span> <span class="free">θ<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> pi<span class="main">/</span><span class="numeral">2</span> <span class="main">∧</span> <span class="free">φ<span class="hidden">⇩</span><sub>B</sub></span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">θ<span class="hidden">⇩</span><sub>B</sub></span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"alice_payoff <span class="main">=</span> <span class="numeral">3</span> <span class="main">∧</span> bob_payoff <span class="main">=</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> alice_payoff_def bob_payoff_def sqrt_two_squared_cpx half_sqrt_two_squared
          exp_of_half_pi<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"pi<span class="main">/</span><span class="numeral">2</span>"</span></span><span class="main">]</span> exp_of_minus_half_pi<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"pi<span class="main">/</span><span class="numeral">2</span>"</span></span><span class="main">]</span> psi_f_is_state
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> asm assms sin_45 cos_45 <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> strategic_space_2p<span class="main">)</span> max_entangled_MH<span class="main">:</span>
<span class="comment1">(* Alice plays the "miracle move", and Bob plays the classical half move in the maximally entangled case *)</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">γ</span> <span class="main">=</span> pi<span class="main">/</span><span class="numeral">2</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> pi<span class="main">/</span><span class="numeral">2</span> <span class="main">∧</span> <span class="free">θ<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> pi<span class="main">/</span><span class="numeral">2</span> <span class="main">∧</span> <span class="free">φ<span class="hidden">⇩</span><sub>B</sub></span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">θ<span class="hidden">⇩</span><sub>B</sub></span> <span class="main">=</span> pi<span class="main">/</span><span class="numeral">2</span> <span class="main">⟶</span> alice_payoff <span class="main">=</span> <span class="main">1</span> <span class="main">∧</span> bob_payoff <span class="main">=</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> asm<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">φ<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> pi<span class="main">/</span><span class="numeral">2</span> <span class="main">∧</span> <span class="free">θ<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> pi<span class="main">/</span><span class="numeral">2</span> <span class="main">∧</span> <span class="free">φ<span class="hidden">⇩</span><sub>B</sub></span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">θ<span class="hidden">⇩</span><sub>B</sub></span> <span class="main">=</span> pi<span class="main">/</span><span class="numeral">2</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"alice_payoff <span class="main">=</span> <span class="main">1</span> <span class="main">∧</span> bob_payoff <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> alice_payoff_def bob_payoff_def sqrt_two_squared_cpx half_sqrt_two_squared
          exp_of_half_pi<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"pi<span class="main">/</span><span class="numeral">2</span>"</span></span><span class="main">]</span> exp_of_minus_half_pi<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"pi<span class="main">/</span><span class="numeral">2</span>"</span></span><span class="main">]</span> psi_f_is_state
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> asm assms sin_45 cos_45 <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(* This is the definition of M in equation (9) *)</span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">M</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"complex Matrix.mat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">M</span> <span class="main">≡</span> mat_of_cols_list <span class="numeral">2</span> <span class="main">[</span><span class="main">[</span><span class="keyword1">𝗂</span> <span class="main">*</span> sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">/</span><span class="numeral">2</span><span class="main">,</span> <span class="main">-</span><span class="main">1</span> <span class="main">*</span> sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">/</span><span class="numeral">2</span><span class="main">]</span><span class="main">,</span>
                          <span class="main">[</span><span class="main">1</span> <span class="main">*</span> sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">/</span><span class="numeral">2</span><span class="main">,</span> <span class="main">-</span><span class="keyword1">𝗂</span> <span class="main">*</span> sqrt<span class="main">(</span><span class="numeral">2</span><span class="main">)</span><span class="main">/</span><span class="numeral">2</span><span class="main">]</span><span class="main">]</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> strategic_space_2p<span class="main">)</span> M_correct<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> pi<span class="main">/</span><span class="numeral">2</span> <span class="main">∧</span> <span class="free">θ<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> pi<span class="main">/</span><span class="numeral">2</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"U<span class="hidden">⇩</span><sub>A</sub> <span class="main">=</span> M"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_row U<span class="hidden">⇩</span><sub>A</sub> <span class="main">=</span> dim_row M"</span></span> <span class="keyword1"><span class="command">using</span></span> mat_of_cols_list_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_col U<span class="hidden">⇩</span><sub>A</sub> <span class="main">=</span> dim_col M"</span></span> <span class="keyword1"><span class="command">using</span></span> mat_of_cols_list_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span> <span class="keyword3"><span class="command">assume</span></span> a0<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> dim_row M"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> dim_col M"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"U<span class="hidden">⇩</span><sub>A</sub> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> M <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">}</span> <span class="main">∧</span> <span class="skolem">j</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">}</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> a0 a1 mat_of_cols_list_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> mat_of_cols_list_def exp_of_half_pi<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"pi<span class="main">/</span><span class="numeral">2</span>"</span></span><span class="main">]</span> exp_of_minus_half_pi<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"pi<span class="main">/</span><span class="numeral">2</span>"</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms sin_45 cos_45<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Quantum_Prisoners_Dilemma-hidden_sqrt_two_squared_cpx2"><span class="command">lemma</span></span> hidden_sqrt_two_squared_cpx2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="free">y</span> <span class="main">::</span> <span class="quoted">complex</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>sqrt <span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span>sqrt <span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">=</span> <span class="free">x</span> <span class="main">*</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> sqrt_two_squared_cpx <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> strategic_space_2p<span class="main">)</span> unfair_strategy_no_benefit<span class="main">:</span>
<span class="comment1">(* Two players' payoffs in the maximally entangled case given that Alice plays a quantum move and Bob 
plays a classical move with the same θ *)</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">γ</span> <span class="main">=</span> pi<span class="main">/</span><span class="numeral">2</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> pi<span class="main">/</span><span class="numeral">2</span> <span class="main">∧</span> <span class="free">φ<span class="hidden">⇩</span><sub>B</sub></span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">θ<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> <span class="free">θ<span class="hidden">⇩</span><sub>B</sub></span> <span class="main">⟶</span> alice_payoff <span class="main">=</span> <span class="main">1</span> <span class="main">∧</span> bob_payoff <span class="main">=</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> asm<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">φ<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> pi<span class="main">/</span><span class="numeral">2</span> <span class="main">∧</span> <span class="free">φ<span class="hidden">⇩</span><sub>B</sub></span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">θ<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> <span class="free">θ<span class="hidden">⇩</span><sub>B</sub></span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ψ<span class="hidden">⇩</span><sub>f</sub> <span class="main">$$</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> exp_of_half_pi<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"pi<span class="main">/</span><span class="numeral">2</span>"</span></span><span class="main">]</span> exp_of_minus_half_pi<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"pi<span class="main">/</span><span class="numeral">2</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> asm assms sin_45 cos_45 <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ψ<span class="hidden">⇩</span><sub>f</sub> <span class="main">$$</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> exp_of_half_pi<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"pi<span class="main">/</span><span class="numeral">2</span>"</span></span><span class="main">]</span> exp_of_minus_half_pi<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"pi<span class="main">/</span><span class="numeral">2</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> asm assms sin_45 cos_45 <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ψ<span class="hidden">⇩</span><sub>f</sub> <span class="main">$$</span> <span class="main">(</span><span class="numeral">2</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> exp_of_half_pi<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"pi<span class="main">/</span><span class="numeral">2</span>"</span></span><span class="main">]</span> exp_of_minus_half_pi<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"pi<span class="main">/</span><span class="numeral">2</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> asm assms sin_45 cos_45 hidden_sqrt_two_squared_cpx2 <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ψ<span class="hidden">⇩</span><sub>f</sub> <span class="main">$$</span> <span class="main">(</span><span class="numeral">3</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> exp_of_half_pi<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"pi<span class="main">/</span><span class="numeral">2</span>"</span></span><span class="main">]</span> exp_of_minus_half_pi<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"pi<span class="main">/</span><span class="numeral">2</span>"</span></span><span class="main">]</span> cos_sin_squared_add_cpx
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> asm assms sin_45 cos_45 hidden_sqrt_two_squared_cpx2 <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"alice_payoff <span class="main">=</span> <span class="main">1</span> <span class="main">∧</span> bob_payoff <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> alice_payoff_def bob_payoff_def psi_f_is_state
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(*
Bibliography:

@ARTICLE{EWL,
   author = {{Eisert}, J. and {Wilkens}, M. and {Lewenstein}, M.},
    title = "{Quantum Games and Quantum Strategies}",
  journal = {Physical Review Letters},
   eprint = {quant-ph/9806088},
     year = 1999,
    month = oct,
   volume = 83,
    pages = {3077-3080},
      doi = {10.1103/PhysRevLett.83.3077},
   adsurl = {https://ui.adsabs.harvard.edu/abs/1999PhRvL..83.3077E},
  adsnote = {Provided by the SAO/NASA Astrophysics Data System}
}
*)</span>
<span class="keyword2"><span class="keyword">end</span></span></pre>
</div>