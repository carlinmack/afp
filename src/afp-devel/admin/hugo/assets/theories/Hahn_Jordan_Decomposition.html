<div id="Extended_Reals_Sums_Compl">
<div class="head">
<h1>Theory Extended_Reals_Sums_Compl</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> Extended_Reals_Sums_Compl <span class="keyword2"><span class="keyword">imports</span></span>  
  <span class="quoted">"<a href="https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL-Analysis/Analysis.html">HOL-Analysis.Analysis</a>"</span> 
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Extended_Reals_Sums_Compl-real_ereal_leq"><span class="command">lemma</span></span> real_ereal_leq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">a</span><span class="main">::</span><span class="quoted">ereal</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">b</span><span class="main">::</span><span class="quoted">real</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"real_of_ereal <span class="free">a</span> <span class="main">≤</span> <span class="free">b</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≠</span> <span class="main">∞</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≤</span> ereal <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> MInfty_eq_minfinity assms eq_iff ereal_eq_0<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> ereal_le_real_iff 
      ereal_less_eq<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> le_cases real_of_ereal.elims real_of_ereal.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> zero_ereal_def<span class="main">)</span> 

<span class="keyword1" id="Extended_Reals_Sums_Compl-ereal_sums_Pinfty"><span class="command">lemma</span></span> ereal_sums_Pinfty<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span><span class="main">::</span><span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> ereal"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">sums</span> <span class="main">∞</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">n</span><span class="main">¦</span> <span class="main">≠</span> <span class="main">∞</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">-</span> <span class="free">f</span> <span class="bound">n</span><span class="main">)</span> <span class="keyword1">sums</span> <span class="main">-</span><span class="main">∞</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">rf</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">rf</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> real_of_ereal <span class="main">(</span><span class="free">f</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="free">f</span> <span class="bound">n</span> <span class="main">=</span> ereal <span class="main">(</span><span class="skolem">rf</span> <span class="bound">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> rf_def <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ereal_real'<span class="main">)</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span> <span class="main">∈</span> <span class="main">{..&lt;</span> <span class="bound">n</span><span class="main">}</span><span class="main">.</span> <span class="skolem">rf</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">gm</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">gm</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span> <span class="main">∈</span> <span class="main">{..&lt;</span> <span class="bound">n</span><span class="main">}</span><span class="main">.</span> <span class="main">-</span> <span class="skolem">rf</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">gm</span> <span class="bound">n</span> <span class="main">=</span> <span class="main">-</span> <span class="skolem">g</span> <span class="bound">n</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> g_def gm_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_negf<span class="main">)</span>  
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> ereal <span class="main">(</span><span class="skolem">gm</span> <span class="bound">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span> <span class="main">∈</span> <span class="main">{..&lt;</span> <span class="bound">n</span><span class="main">}</span><span class="main">.</span><span class="main">-</span> <span class="free">f</span> <span class="bound">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="free">f</span> <span class="bound">n</span> <span class="main">=</span> ereal <span class="main">(</span><span class="skolem">rf</span> <span class="bound">n</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> gm_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> ereal <span class="main">(</span><span class="skolem">g</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">⇢</span> <span class="main">∞</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="quoted"><span class="quoted">‹<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="free">f</span> <span class="bound">n</span> <span class="main">=</span> ereal <span class="main">(</span><span class="skolem">rf</span> <span class="bound">n</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> sums_def g_def 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">M</span><span class="main">.</span> <span class="main">∃</span><span class="bound">N</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">n</span></span><span class="main">≥</span> <span class="bound">N</span><span class="main">.</span> <span class="main">(</span><span class="skolem">gm</span> <span class="bound">n</span><span class="main">)</span> <span class="main">≤</span> <span class="bound">M</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">M</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">N</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">n</span></span><span class="main">≥</span> <span class="bound">N</span><span class="main">.</span> ereal <span class="main">(</span><span class="main">-</span><span class="skolem">M</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">g</span> <span class="bound">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">g</span> <span class="main">⇢</span> <span class="main">∞</span>›</span></span>  Lim_PInfty <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">N</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">n</span></span><span class="main">≥</span> <span class="skolem">N</span><span class="main">.</span> ereal <span class="main">(</span><span class="main">-</span><span class="skolem">M</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">g</span> <span class="bound">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">n</span></span> <span class="main">≥</span> <span class="skolem">N</span><span class="main">.</span> <span class="main">-</span> <span class="main">(</span><span class="skolem">g</span> <span class="bound">n</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">M</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">n</span></span> <span class="main">≥</span> <span class="skolem">N</span><span class="main">.</span> <span class="skolem">gm</span> <span class="bound">n</span> <span class="main">≤</span> <span class="skolem">M</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">gm</span> <span class="bound">n</span> <span class="main">=</span> <span class="main">-</span> <span class="skolem">g</span> <span class="bound">n</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">N</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">n</span></span> <span class="main">≥</span> <span class="bound">N</span><span class="main">.</span> <span class="skolem">gm</span> <span class="bound">n</span> <span class="main">≤</span> <span class="skolem">M</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> ereal <span class="main">(</span><span class="skolem">gm</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">⇢</span> <span class="main">-</span><span class="main">∞</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Lim_MInfty<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>  <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> ereal <span class="main">(</span><span class="skolem">gm</span> <span class="bound">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span> <span class="main">∈</span> <span class="main">{..&lt;</span> <span class="bound">n</span><span class="main">}</span><span class="main">.</span><span class="main">-</span> <span class="free">f</span> <span class="bound">i</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> sums_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Extended_Reals_Sums_Compl-ereal_sums_Minfty"><span class="command">lemma</span></span> ereal_sums_Minfty<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span><span class="main">::</span><span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> ereal"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">sums</span> <span class="main">-</span><span class="main">∞</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">n</span><span class="main">¦</span> <span class="main">≠</span> <span class="main">∞</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">-</span> <span class="free">f</span> <span class="bound">n</span><span class="main">)</span> <span class="keyword1">sums</span> <span class="main">∞</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">rf</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">rf</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> real_of_ereal <span class="main">(</span><span class="free">f</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="free">f</span> <span class="bound">n</span> <span class="main">=</span> ereal <span class="main">(</span><span class="skolem">rf</span> <span class="bound">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> rf_def <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ereal_real'<span class="main">)</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span> <span class="main">∈</span> <span class="main">{..&lt;</span> <span class="bound">n</span><span class="main">}</span><span class="main">.</span> <span class="skolem">rf</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">gm</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">gm</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span> <span class="main">∈</span> <span class="main">{..&lt;</span> <span class="bound">n</span><span class="main">}</span><span class="main">.</span> <span class="main">-</span> <span class="skolem">rf</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">gm</span> <span class="bound">n</span> <span class="main">=</span> <span class="main">-</span> <span class="skolem">g</span> <span class="bound">n</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> g_def gm_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_negf<span class="main">)</span>  
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> ereal <span class="main">(</span><span class="skolem">gm</span> <span class="bound">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span> <span class="main">∈</span> <span class="main">{..&lt;</span> <span class="bound">n</span><span class="main">}</span><span class="main">.</span><span class="main">-</span> <span class="free">f</span> <span class="bound">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="free">f</span> <span class="bound">n</span> <span class="main">=</span> ereal <span class="main">(</span><span class="skolem">rf</span> <span class="bound">n</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> gm_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> ereal <span class="main">(</span><span class="skolem">g</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">⇢</span> <span class="main">-</span><span class="main">∞</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="quoted"><span class="quoted">‹<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="free">f</span> <span class="bound">n</span> <span class="main">=</span> ereal <span class="main">(</span><span class="skolem">rf</span> <span class="bound">n</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> sums_def g_def 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">M</span><span class="main">.</span> <span class="main">∃</span><span class="bound">N</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">n</span></span><span class="main">≥</span> <span class="bound">N</span><span class="main">.</span> <span class="bound">M</span> <span class="main">≤</span> <span class="main">(</span><span class="skolem">gm</span> <span class="bound">n</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">M</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">N</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">n</span></span><span class="main">≥</span> <span class="bound">N</span><span class="main">.</span> <span class="skolem">g</span> <span class="bound">n</span> <span class="main">≤</span> ereal <span class="main">(</span><span class="main">-</span><span class="skolem">M</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">g</span> <span class="main">⇢</span> <span class="main">-</span><span class="main">∞</span>›</span></span>  Lim_MInfty <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">N</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">n</span></span><span class="main">≥</span> <span class="skolem">N</span><span class="main">.</span> <span class="skolem">g</span> <span class="bound">n</span> <span class="main">≤</span> ereal <span class="main">(</span><span class="main">-</span><span class="skolem">M</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">n</span></span> <span class="main">≥</span> <span class="skolem">N</span><span class="main">.</span> <span class="skolem">M</span> <span class="main">≤</span> <span class="main">-</span> <span class="main">(</span><span class="skolem">g</span> <span class="bound">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">n</span></span> <span class="main">≥</span> <span class="skolem">N</span><span class="main">.</span> <span class="skolem">M</span> <span class="main">≤</span> <span class="skolem">gm</span> <span class="bound">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">gm</span> <span class="bound">n</span> <span class="main">=</span> <span class="main">-</span> <span class="skolem">g</span> <span class="bound">n</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">N</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">n</span></span> <span class="main">≥</span> <span class="bound">N</span><span class="main">.</span> <span class="skolem">M</span> <span class="main">≤</span> <span class="skolem">gm</span> <span class="bound">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> ereal <span class="main">(</span><span class="skolem">gm</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">⇢</span> <span class="main">∞</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Lim_PInfty<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>  <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> ereal <span class="main">(</span><span class="skolem">gm</span> <span class="bound">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span> <span class="main">∈</span> <span class="main">{..&lt;</span> <span class="bound">n</span><span class="main">}</span><span class="main">.</span><span class="main">-</span> <span class="free">f</span> <span class="bound">i</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> sums_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Extended_Reals_Sums_Compl-mem_sums_Pinfty"><span class="command">lemma</span></span> mem_sums_Pinfty<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">f</span> <span class="free">i</span><span class="main">)</span><span class="main">::</span>ereal<span class="main">)</span> <span class="main">=</span> <span class="main">∞</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">sums</span> <span class="main">∞</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span> <span class="main">∈</span> <span class="main">{..&lt;</span> <span class="bound">n</span><span class="main">}</span><span class="main">.</span> <span class="free">f</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> ginf<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound"><span class="bound">j</span></span> <span class="main">≥</span> Suc <span class="free">i</span><span class="main">.</span> <span class="skolem">g</span> <span class="bound">j</span> <span class="main">=</span> <span class="main">∞</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> allI impI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">j</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Suc <span class="free">i</span> <span class="main">≤</span> <span class="skolem">j</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="skolem">j</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">∈</span> <span class="main">{..&lt;</span> <span class="skolem">j</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="skolem">j</span> <span class="main">=</span> <span class="main">∞</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> g_def <span class="keyword1"><span class="command">using</span></span> sum_Pinfty<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">f</span></span> <span class="quoted"><span class="quoted">"<span class="main">{..&lt;</span> <span class="skolem">j</span><span class="main">}</span>"</span></span><span class="main">]</span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">M</span><span class="main">.</span> <span class="main">∃</span><span class="bound">N</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">n</span></span><span class="main">≥</span> <span class="bound">N</span><span class="main">.</span> <span class="bound">M</span> <span class="main">≤</span> <span class="main">(</span><span class="skolem">g</span> <span class="bound">n</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">M</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">N</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">n</span></span><span class="main">≥</span> <span class="bound">N</span><span class="main">.</span> <span class="skolem">M</span> <span class="main">≤</span> <span class="skolem">g</span> <span class="bound">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ginf <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">⇢</span> <span class="main">∞</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Lim_PInfty<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>   <span class="keyword1"><span class="command">unfolding</span></span> sums_def g_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Extended_Reals_Sums_Compl-sum_Minfty"><span class="command">lemma</span></span> sum_Minfty<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> ereal"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> finite <span class="free">P</span> <span class="main">⟹</span> <span class="bound">i</span> <span class="main">∈</span> <span class="free">P</span> <span class="main">⟹</span> <span class="free">f</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">-</span> <span class="main">∞</span> <span class="main">⟹</span> <span class="main">∞</span> <span class="main">∉</span> range <span class="free">f</span> <span class="main">⟹</span> sum <span class="free">f</span> <span class="free">P</span> <span class="main">=</span> <span class="main">-</span><span class="main">∞</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> 
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">P</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="free">P</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">i</span> <span class="main">=</span> <span class="main">-</span><span class="main">∞</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∞</span> <span class="main">∉</span> range <span class="free">f</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"sum <span class="free">f</span> <span class="free">P</span> <span class="main">=</span> <span class="main">-</span><span class="main">∞</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">induct</span>
    <span class="keyword3"><span class="command">case</span></span> empty
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>insert <span class="skolem">x</span> <span class="skolem">F</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ereal_plus_eq_MInfty insert_iff rangeI sum.insert sum_Pinfty<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Extended_Reals_Sums_Compl-mem_sums_Minfty"><span class="command">lemma</span></span> mem_sums_Minfty<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">f</span> <span class="free">i</span><span class="main">)</span><span class="main">::</span>ereal<span class="main">)</span> <span class="main">=</span> <span class="main">-</span><span class="main">∞</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∞</span> <span class="main">∉</span> range <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">sums</span> <span class="main">-</span><span class="main">∞</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span> <span class="main">∈</span> <span class="main">{..&lt;</span> <span class="bound">n</span><span class="main">}</span><span class="main">.</span> <span class="free">f</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> ginf<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound"><span class="bound">j</span></span> <span class="main">≥</span> Suc <span class="free">i</span><span class="main">.</span> <span class="skolem">g</span> <span class="bound">j</span> <span class="main">=</span> <span class="main">-</span><span class="main">∞</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> allI impI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">j</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Suc <span class="free">i</span> <span class="main">≤</span> <span class="skolem">j</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="skolem">j</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">∈</span> <span class="main">{..&lt;</span> <span class="skolem">j</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="skolem">j</span> <span class="main">=</span> <span class="main">-</span><span class="main">∞</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> g_def <span class="keyword1"><span class="command">using</span></span> sum_Minfty<span class="main">[</span><span class="operator">of</span>  <span class="quoted"><span class="quoted">"<span class="main">{..&lt;</span> <span class="skolem">j</span><span class="main">}</span>"</span></span><span class="main">]</span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">M</span><span class="main">.</span> <span class="main">∃</span><span class="bound">N</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">n</span></span><span class="main">≥</span> <span class="bound">N</span><span class="main">.</span> <span class="main">(</span><span class="skolem">g</span> <span class="bound">n</span><span class="main">)</span> <span class="main">≤</span> <span class="bound">M</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">M</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">N</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">n</span></span><span class="main">≥</span> <span class="bound">N</span><span class="main">.</span> <span class="skolem">g</span> <span class="bound">n</span> <span class="main">≤</span> <span class="skolem">M</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ginf <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">⇢</span> <span class="main">-</span><span class="main">∞</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Lim_MInfty<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>   <span class="keyword1"><span class="command">unfolding</span></span> sums_def g_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Extended_Reals_Sums_Compl-ereal_sums_not_infty"><span class="command">lemma</span></span> ereal_sums_not_infty<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">sums</span> <span class="main">(</span><span class="free">a</span><span class="main">::</span>ereal<span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="free">a</span><span class="main">¦</span> <span class="main">≠</span> <span class="main">∞</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">n</span><span class="main">¦</span> <span class="main">≠</span> <span class="main">∞</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">¦</span><span class="free">f</span> <span class="skolem">n</span><span class="main">¦</span> <span class="main">≠</span> <span class="main">∞</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="free">f</span> <span class="skolem">n</span><span class="main">¦</span> <span class="main">=</span> <span class="main">∞</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">n</span> <span class="main">=</span> <span class="main">∞</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">sums</span> <span class="main">∞</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> mem_sums_Pinfty <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> assms sums_unique2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">n</span> <span class="main">=</span> <span class="main">-</span><span class="main">∞</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¦</span><span class="free">f</span> <span class="skolem">n</span><span class="main">¦</span> <span class="main">=</span> <span class="main">∞</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">i</span><span class="main">.</span> <span class="free">f</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">∞</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">i</span> <span class="main">=</span> <span class="main">∞</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">sums</span> <span class="main">∞</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> mem_sums_Pinfty <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> assms sums_unique2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="free">f</span> <span class="bound">i</span> <span class="main">≠</span> <span class="main">∞</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">sums</span> <span class="main">-</span><span class="main">∞</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> mem_sums_Minfty <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="skolem">n</span> <span class="main">=</span> <span class="main">-</span><span class="main">∞</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> MInfty_eq_minfinity image_iff<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> assms sums_unique2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Extended_Reals_Sums_Compl-ereal_sums_not_infty_minus"><span class="command">lemma</span></span> ereal_sums_not_infty_minus<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">sums</span> <span class="main">(</span><span class="free">a</span><span class="main">::</span>ereal<span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="free">a</span><span class="main">¦</span> <span class="main">≠</span> <span class="main">∞</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">-</span> <span class="free">f</span> <span class="bound">n</span><span class="main">)</span> <span class="keyword1">sums</span> <span class="main">-</span><span class="free">a</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">n</span><span class="main">¦</span> <span class="main">≠</span> <span class="main">∞</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms  ereal_sums_not_infty <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> real_of_ereal <span class="main">(</span><span class="free">f</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="free">f</span> <span class="bound">n</span> <span class="main">=</span> ereal <span class="main">(</span><span class="skolem">g</span> <span class="bound">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span>  <span class="quoted"><span class="quoted">‹<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">n</span><span class="main">¦</span> <span class="main">≠</span> <span class="main">∞</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ereal_real' g_def<span class="main">)</span> 
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="main">-</span> <span class="free">f</span> <span class="bound">n</span> <span class="main">=</span> ereal <span class="main">(</span><span class="main">-</span><span class="skolem">g</span> <span class="bound">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">r</span><span class="main">.</span> <span class="free">a</span> <span class="main">=</span> ereal <span class="main">(</span><span class="bound">r</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> ereal <span class="skolem">r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">sums</span> <span class="main">(</span>ereal <span class="skolem">r</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> ereal <span class="main">(</span><span class="skolem">g</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">sums</span> <span class="main">(</span>ereal <span class="skolem">r</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="free">f</span> <span class="bound">n</span> <span class="main">=</span> ereal <span class="main">(</span><span class="skolem">g</span> <span class="bound">n</span><span class="main">)</span>›</span></span> 
      sums_cong<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">f</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">n</span><span class="main">.</span> ereal <span class="main">(</span><span class="skolem">g</span> <span class="bound">n</span><span class="main">)</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="keyword1">sums</span> <span class="skolem">r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sums_ereal<span class="main">)</span> 
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">-</span><span class="skolem">g</span> <span class="bound">n</span><span class="main">)</span> <span class="keyword1">sums</span> <span class="main">-</span><span class="skolem">r</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> sums_minus<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">g</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> ereal <span class="main">(</span><span class="main">-</span> <span class="skolem">g</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">sums</span> ereal <span class="main">(</span><span class="main">-</span><span class="skolem">r</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sums_ereal<span class="main">)</span> 
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">-</span> <span class="free">f</span> <span class="bound">n</span><span class="main">)</span> <span class="keyword1">sums</span> <span class="main">(</span>ereal <span class="main">(</span><span class="main">-</span><span class="skolem">r</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="main">-</span> <span class="free">f</span> <span class="bound">n</span> <span class="main">=</span> ereal <span class="main">(</span><span class="main">-</span><span class="skolem">g</span> <span class="bound">n</span><span class="main">)</span>›</span></span>
      sums_cong<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">f</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">n</span><span class="main">.</span> ereal <span class="main">(</span><span class="skolem">g</span> <span class="bound">n</span><span class="main">)</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">=</span> ereal <span class="skolem">r</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Extended_Reals_Sums_Compl-ereal_sums_minus"><span class="command">lemma</span></span> ereal_sums_minus<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span><span class="main">::</span><span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> ereal"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">sums</span> <span class="free">a</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">n</span><span class="main">¦</span> <span class="main">≠</span> <span class="main">∞</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">-</span> <span class="free">f</span> <span class="bound">n</span><span class="main">)</span> <span class="keyword1">sums</span> <span class="main">-</span><span class="free">a</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="free">a</span><span class="main">¦</span> <span class="main">=</span> <span class="main">∞</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms ereal_sums_not_infty_minus <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> <span class="main">∞</span> <span class="main">∨</span> <span class="free">a</span> <span class="main">=</span> <span class="main">-</span> <span class="main">∞</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms ereal_sums_Pinfty ereal_sums_Minfty <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Extended_Reals_Sums_Compl-sums_minus'"><span class="command">lemma</span></span> sums_minus'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span><span class="main">::</span><span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> ereal"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">∞</span> <span class="main">∉</span> range <span class="free">f</span> <span class="main">∨</span> <span class="main">∞</span> <span class="main">∉</span> range <span class="free">f</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">sums</span> <span class="free">a</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">-</span> <span class="free">f</span> <span class="bound">n</span><span class="main">)</span> <span class="keyword1">sums</span> <span class="main">(</span><span class="main">-</span> <span class="free">a</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">n</span><span class="main">¦</span> <span class="main">≠</span> <span class="main">∞</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> ereal_sums_minus assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">n</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">n</span><span class="main">¦</span> <span class="main">=</span> <span class="main">∞</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="free">f</span> <span class="skolem">n</span><span class="main">¦</span> <span class="main">=</span> <span class="main">∞</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">meson</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">∞</span> <span class="main">∈</span> range <span class="free">f</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">j</span><span class="main">.</span> <span class="free">f</span> <span class="bound">j</span> <span class="main">=</span> <span class="main">∞</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> image_iff<span class="main">)</span> 
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">j</span> <span class="main">=</span> <span class="main">∞</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> <span class="main">∞</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> mem_sums_Pinfty assms<span class="main">(</span>2<span class="main">)</span> sums_unique2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">∞</span> <span class="main">∉</span> range <span class="free">f</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms True <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> mem_sums_Minfty<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">-</span> <span class="free">f</span> <span class="bound">n</span>"</span></span><span class="main">]</span> assms <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="skolem">j</span> <span class="main">=</span> <span class="main">∞</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> ereal_uminus_eq_reorder <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">n</span> <span class="main">=</span> <span class="main">-</span><span class="main">∞</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¦</span><span class="free">f</span> <span class="skolem">n</span><span class="main">¦</span> <span class="main">=</span> <span class="main">∞</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ereal_infinity_cases range_eqI<span class="main">)</span> 
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> <span class="main">-</span><span class="main">∞</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> mem_sums_Minfty False sums_unique2 assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> mem_sums_Pinfty<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">-</span> <span class="free">f</span> <span class="bound">n</span>"</span></span><span class="main">]</span> assms
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> MInfty_eq_minfinity <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="skolem">n</span> <span class="main">=</span> <span class="main">-</span> <span class="main">∞</span>›</span></span> ereal_uminus_uminus uminus_ereal.simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="Hahn_Jordan_Prelims">
<div class="head">
<h1>Theory Hahn_Jordan_Prelims</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> Hahn_Jordan_Prelims <span class="keyword2"><span class="keyword">imports</span></span>  
  <span class="quoted">"<a href="https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL-Analysis/Analysis.html">HOL-Analysis.Analysis</a>"</span> 
  <a href="#Extended_Reals_Sums_Compl">Extended_Reals_Sums_Compl</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Preliminary results›</span></span>

<span class="keyword1" id="Hahn_Jordan_Prelims-diff_union"><span class="command">lemma</span></span> diff_union<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">-</span> <span class="main">(</span><span class="main">⋃</span> <span class="bound">i</span> <span class="main">≤</span> <span class="free">n</span><span class="main">.</span> <span class="free">B</span> <span class="bound">i</span><span class="main">)</span> <span class="main">-</span> <span class="free">B</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="free">A</span> <span class="main">-</span> <span class="main">(</span><span class="main">⋃</span> <span class="bound">i</span> <span class="main">≤</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span><span class="main">.</span> <span class="free">B</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> atMost_Suc <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Hahn_Jordan_Prelims-disj_subsets"><span class="command">lemma</span></span> disj_subsets<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">0</span> <span class="main">=</span> <span class="free">A</span> <span class="main">0</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="main">(</span><span class="bound">i</span><span class="main">::</span>nat<span class="main">)</span><span class="main">.</span> <span class="free">B</span> <span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="free">A</span> <span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="main">⋃</span> <span class="bound">j</span><span class="main">∈</span><span class="main">{..</span><span class="bound">i</span><span class="main">}</span><span class="main">.</span> <span class="free">A</span> <span class="bound">j</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋃</span><span class="bound">i</span><span class="main">.</span> <span class="free">B</span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">i</span><span class="main">.</span> <span class="free">A</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> 
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="skolem">i</span> <span class="main">⊆</span> <span class="free">A</span> <span class="skolem">i</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">j</span><span class="main">.</span> <span class="skolem">i</span> <span class="main">=</span> Suc <span class="bound">j</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> not0_implies_Suc<span class="main">)</span> 
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">=</span> Suc <span class="skolem">j</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="skolem">i</span> <span class="main">⊆</span> <span class="free">A</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋃</span> <span class="main">(</span>range <span class="free">B</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">⋃</span> <span class="main">(</span>range <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">have</span></span> ale<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="free">A</span> <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">B</span> <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span><span class="main">⋃</span> <span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="bound">n</span><span class="main">}</span><span class="main">.</span> <span class="free">A</span> <span class="bound">j</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>    
  <span class="keyword1"><span class="command">have</span></span> inc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="main">⋃</span> <span class="bound">i</span><span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="bound">n</span><span class="main">}</span><span class="main">.</span> <span class="free">A</span> <span class="bound">i</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">(</span><span class="main">⋃</span> <span class="bound">i</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="bound">n</span><span class="main">}</span><span class="main">.</span> <span class="free">B</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋃</span> <span class="bound">i</span><span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="skolem">n</span><span class="main">}</span><span class="main">.</span> <span class="free">A</span> <span class="bound">i</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">(</span><span class="main">⋃</span> <span class="bound">i</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="skolem">n</span><span class="main">}</span><span class="main">.</span> <span class="free">B</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">n</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> 0
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋃</span> <span class="main">(</span><span class="free">A</span> <span class="main">`</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span>Suc <span class="skolem">n</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span><span class="free">A</span> <span class="main">`</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span> <span class="skolem">n</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">∪</span> <span class="free">A</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Un_commute atLeast0_atMost_Suc<span class="main">)</span> 
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">⊆</span> <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span><span class="free">B</span> <span class="main">`</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span> <span class="skolem">n</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">∪</span> <span class="free">A</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Suc <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">⊆</span> <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span><span class="free">B</span> <span class="main">`</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span> <span class="skolem">n</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">∪</span> <span class="free">B</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span><span class="main">⋃</span> <span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="skolem">n</span><span class="main">}</span><span class="main">.</span> <span class="free">A</span> <span class="bound">j</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ale <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">⊆</span> <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span><span class="free">B</span> <span class="main">`</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span> <span class="skolem">n</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">∪</span> <span class="free">B</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span><span class="free">B</span> <span class="main">`</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span> <span class="skolem">n</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Suc <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span><span class="free">B</span> <span class="main">`</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span> <span class="skolem">n</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">∪</span> <span class="free">B</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span><span class="free">B</span> <span class="main">`</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span> Suc <span class="skolem">n</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Un_commute atLeast0_atMost_Suc<span class="main">)</span> 
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="main">⋃</span> <span class="bound">i</span><span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="bound">n</span><span class="main">}</span><span class="main">.</span> <span class="free">A</span> <span class="bound">i</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">(</span><span class="main">⋃</span> <span class="bound">i</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="bound">n</span><span class="main">}</span><span class="main">.</span> <span class="free">B</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋃</span> <span class="bound">i</span><span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="skolem">n</span><span class="main">}</span><span class="main">.</span> <span class="free">A</span> <span class="bound">i</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">(</span><span class="main">⋃</span> <span class="bound">i</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="skolem">n</span><span class="main">}</span><span class="main">.</span> <span class="free">B</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="skolem">n</span><span class="main">}</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">m</span><span class="main">.</span> <span class="skolem">n</span> <span class="main">=</span> Suc <span class="bound">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> not0_implies_Suc<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> Suc <span class="skolem">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="skolem">n</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="skolem">m</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋃</span> <span class="bound">i</span><span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="skolem">m</span><span class="main">}</span><span class="main">.</span> <span class="free">A</span> <span class="bound">i</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">(</span><span class="main">⋃</span> <span class="bound">i</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="skolem">m</span><span class="main">}</span><span class="main">.</span> <span class="free">B</span> <span class="bound">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> inc <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="skolem">n</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="skolem">m</span><span class="main">}</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋃</span> <span class="main">(</span>range <span class="free">A</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">⋃</span> <span class="main">(</span>range <span class="free">B</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> UN_finite2_subset<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="free">B</span></span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Hahn_Jordan_Prelims-disj_Union2"><span class="command">lemma</span></span> disj_Union2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="free">A</span> <span class="bound">i</span> <span class="main">∈</span> sets <span class="free">M</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">B</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"disjoint_family <span class="free">B</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋃</span><span class="main">(</span><span class="bound">i</span><span class="main">::</span>nat<span class="main">)</span><span class="main">.</span> <span class="free">B</span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span><span class="main">(</span><span class="bound">i</span><span class="main">::</span>nat<span class="main">)</span><span class="main">.</span> <span class="free">A</span> <span class="bound">i</span><span class="main">)</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="free">B</span> <span class="bound">i</span> <span class="main">∈</span> sets <span class="free">M</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="free">B</span> <span class="bound">i</span> <span class="main">⊆</span> <span class="free">A</span> <span class="bound">i</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">B</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">i</span><span class="main">::</span>nat<span class="main">)</span><span class="main">.</span> <span class="free">A</span> <span class="bound">i</span> <span class="main">-</span> <span class="main">(</span><span class="main">⋃</span> <span class="bound">j</span><span class="main">∈</span><span class="main">{..&lt;</span><span class="bound">i</span><span class="main">}</span><span class="main">.</span> <span class="free">A</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">B</span> <span class="bound">i</span> <span class="main">⊆</span> <span class="free">A</span> <span class="bound">i</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> 
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span> <span class="skolem">i</span> <span class="main">⊆</span> <span class="free">A</span> <span class="skolem">i</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> B_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">j</span><span class="main">.</span> <span class="skolem">i</span> <span class="main">=</span> Suc <span class="bound">j</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> not0_implies_Suc<span class="main">)</span> 
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">=</span> Suc <span class="skolem">j</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span> <span class="skolem">i</span> <span class="main">⊆</span> <span class="free">A</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> B_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"disjoint_family <span class="skolem">B</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> disjoint_family_on_def
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span> <span class="skolem">m</span><span class="main">::</span><span class="quoted">nat</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&lt;</span><span class="skolem">m</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span> <span class="skolem">n</span> <span class="main">⊆</span> <span class="main">(</span><span class="main">⋃</span> <span class="bound">j</span><span class="main">∈</span><span class="main">{..&lt;</span><span class="skolem">m</span><span class="main">}</span><span class="main">.</span> <span class="free">A</span> <span class="bound">j</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">B</span> <span class="bound">i</span> <span class="main">⊆</span> <span class="free">A</span> <span class="bound">i</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span> <span class="skolem">n</span> <span class="main">∩</span> <span class="skolem">B</span> <span class="skolem">m</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> B_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">m</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="main">∀</span><span class="bound">n</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="bound">m</span> <span class="main">≠</span> <span class="bound">n</span> <span class="main">⟶</span> <span class="skolem">B</span> <span class="bound">m</span> <span class="main">∩</span> <span class="skolem">B</span> <span class="bound">n</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Int_commute antisym_conv3<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋃</span><span class="main">(</span><span class="bound">i</span><span class="main">::</span>nat<span class="main">)</span><span class="main">.</span> <span class="skolem">B</span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span><span class="main">(</span><span class="bound">i</span><span class="main">::</span>nat<span class="main">)</span><span class="main">.</span> <span class="free">A</span> <span class="bound">i</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> disj_subsets<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span> <span class="main">0</span> <span class="main">=</span> <span class="free">A</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> B_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">B</span> <span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="free">A</span> <span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span> <span class="main">-</span> <span class="main">⋃</span> <span class="main">(</span><span class="free">A</span> <span class="main">`</span> <span class="main">{..</span><span class="bound">i</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> B_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">B</span> <span class="bound">i</span> <span class="main">∈</span> sets <span class="free">M</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> B_def <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Hahn_Jordan_Prelims-conv_0_half"><span class="command">lemma</span></span> conv_0_half<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">⇢</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span>real<span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="main">0</span> <span class="main">≤</span> <span class="free">f</span> <span class="bound">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">N</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">n</span></span> <span class="main">≥</span> <span class="bound">N</span><span class="main">.</span> <span class="free">f</span> <span class="bound">n</span> <span class="main">&lt;</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">r</span></span><span class="main">&gt;</span><span class="main">0</span><span class="main">.</span> <span class="main">∃</span><span class="bound">no</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">n</span></span><span class="main">≥</span><span class="bound">no</span><span class="main">.</span> dist <span class="main">(</span><span class="free">f</span> <span class="bound">n</span><span class="main">)</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">r</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lim_sequentially<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">no</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">n</span></span><span class="main">≥</span> <span class="bound">no</span><span class="main">.</span> dist <span class="main">(</span><span class="free">f</span> <span class="bound">n</span><span class="main">)</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> half_gt_zero_iff zero_less_one <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">N</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">n</span></span> <span class="main">≥</span> <span class="skolem">N</span><span class="main">.</span> dist <span class="main">(</span><span class="free">f</span> <span class="bound">n</span><span class="main">)</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> dist <span class="main">(</span><span class="free">f</span> <span class="bound">n</span><span class="main">)</span> <span class="main">0</span> <span class="main">=</span> <span class="free">f</span> <span class="bound">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"dist <span class="main">(</span><span class="free">f</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">0</span> <span class="main">=</span> <span class="main">¦</span><span class="free">f</span> <span class="skolem">n</span><span class="main">¦</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">f</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dist <span class="main">(</span><span class="free">f</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">0</span> <span class="main">=</span> <span class="free">f</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">n</span></span> <span class="main">≥</span> <span class="skolem">N</span><span class="main">.</span> <span class="free">f</span> <span class="bound">n</span> <span class="main">&lt;</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound"><span class="bound">n</span></span> <span class="main">≥</span> <span class="skolem">N</span><span class="main">.</span> dist <span class="main">(</span><span class="free">f</span> <span class="bound">n</span><span class="main">)</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Hahn_Jordan_Prelims-e2ennreal_add"><span class="command">lemma</span></span> e2ennreal_add<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span><span class="main">::</span><span class="quoted">ereal</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"e2ennreal <span class="main">(</span><span class="free">x</span><span class="main">+</span><span class="free">y</span><span class="main">)</span> <span class="main">=</span> e2ennreal <span class="free">x</span> <span class="main">+</span> e2ennreal <span class="free">y</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ereal_ennreal_cases<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">x</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">&lt;</span> <span class="main">0</span> <span class="main">⟹</span> e2ennreal <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> e2ennreal <span class="free">x</span> <span class="main">+</span> e2ennreal <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">b</span><span class="main">.</span> <span class="main">0</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">=</span> enn2ereal <span class="bound">b</span> <span class="main">⟹</span> e2ennreal <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> e2ennreal <span class="free">x</span> <span class="main">+</span> e2ennreal <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">b</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="free">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> enn2ereal <span class="skolem">b</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"e2ennreal <span class="free">x</span><span class="main">=</span> <span class="skolem">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"e2ennreal <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> e2ennreal <span class="free">x</span> <span class="main">+</span> e2ennreal <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ereal_ennreal_cases<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">y</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">&lt;</span> <span class="main">0</span> <span class="main">⟹</span> e2ennreal <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> e2ennreal <span class="free">x</span> <span class="main">+</span> e2ennreal <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">b</span><span class="main">.</span> <span class="main">0</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">y</span> <span class="main">=</span> enn2ereal <span class="bound">b</span> <span class="main">⟹</span> e2ennreal <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> e2ennreal <span class="free">x</span> <span class="main">+</span> e2ennreal <span class="free">y</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="free">y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">=</span> enn2ereal <span class="skolem">c</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"e2ennreal <span class="free">y</span> <span class="main">=</span> <span class="skolem">c</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"e2ennreal <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> e2ennreal <span class="free">x</span> <span class="main">+</span> e2ennreal <span class="free">y</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ereal_ennreal_cases<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free">x</span></span><span class="main"><span class="main">+</span></span><span class="free"><span class="free">y</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">+</span> <span class="free">y</span> <span class="main">&lt;</span> <span class="main">0</span> <span class="main">⟹</span> e2ennreal <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> e2ennreal <span class="free">x</span> <span class="main">+</span> e2ennreal <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> leD<span class="main">)</span> 
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">b</span><span class="main">.</span> <span class="main">0</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">+</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">+</span> <span class="free">y</span> <span class="main">=</span> enn2ereal <span class="bound">b</span> <span class="main">⟹</span> e2ennreal <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> 
            e2ennreal <span class="free">x</span> <span class="main">+</span> e2ennreal <span class="free">y</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
            <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">d</span>
            <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="free">x</span><span class="main">+</span><span class="free">y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">+</span><span class="free">y</span> <span class="main">=</span> enn2ereal <span class="skolem">d</span>"</span></span>
            <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"e2ennreal <span class="main">(</span><span class="free">x</span><span class="main">+</span><span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"e2ennreal <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> e2ennreal <span class="free">x</span> <span class="main">+</span> e2ennreal <span class="free">y</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹e2ennreal <span class="main">(</span><span class="free">x</span><span class="main">+</span><span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">d</span>›</span></span> <span class="quoted"><span class="quoted">‹e2ennreal <span class="free">x</span><span class="main">=</span> <span class="skolem">b</span>›</span></span> <span class="quoted"><span class="quoted">‹e2ennreal <span class="free">y</span><span class="main">=</span> <span class="skolem">c</span>›</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="free">x</span> <span class="main">=</span> enn2ereal <span class="skolem">b</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">y</span> <span class="main">=</span> enn2ereal <span class="skolem">c</span>›</span></span> e2ennreal_enn2ereal plus_ennreal.rep_eq<span class="main">)</span>
          <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Hahn_Jordan_Prelims-e2ennreal_finite_sum"><span class="command">lemma</span></span> e2ennreal_finite_sum<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">I</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span><span class="main">∈</span> <span class="free">I</span> <span class="main">⟹</span> <span class="main">0</span> <span class="main">≤</span> <span class="main">(</span><span class="main">(</span><span class="free">A</span> <span class="bound">i</span><span class="main">)</span><span class="main">::</span>ereal<span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> 
<span class="main">(</span><span class="main">∑</span> <span class="bound">i</span><span class="main">∈</span> <span class="free">I</span><span class="main">.</span> e2ennreal <span class="main">(</span><span class="free">A</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> e2ennreal <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span> <span class="free">I</span><span class="main">.</span> <span class="free">A</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> finite_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> empty
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> zero_ennreal.abs_eq<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>insert <span class="skolem">x</span> <span class="skolem">F</span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span> <span class="bound">i</span><span class="main">∈</span> <span class="main">(</span>insert <span class="skolem">x</span> <span class="skolem">F</span><span class="main">)</span><span class="main">.</span> e2ennreal <span class="main">(</span><span class="free">A</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> e2ennreal <span class="main">(</span><span class="free">A</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span> <span class="bound">i</span><span class="main">∈</span> <span class="skolem">F</span><span class="main">.</span> e2ennreal <span class="main">(</span><span class="free">A</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> e2ennreal <span class="main">(</span><span class="free">A</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">+</span> e2ennreal <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span> <span class="skolem">F</span><span class="main">.</span> <span class="free">A</span> <span class="bound">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> insert <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> e2ennreal <span class="main">(</span><span class="free">A</span> <span class="skolem">x</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span> <span class="skolem">F</span><span class="main">.</span> <span class="free">A</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> e2ennreal_add<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="free">A</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> insert <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> sum <span class="free">A</span> <span class="skolem">F</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> insert <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_nonneg<span class="main">)</span> 
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> e2ennreal <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span> insert <span class="skolem">x</span> <span class="skolem">F</span><span class="main">.</span> <span class="free">A</span> <span class="bound">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> insert <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Hahn_Jordan_Prelims-e2ennreal_less_top"><span class="command">lemma</span></span> e2ennreal_less_top<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span><span class="main">::</span><span class="quoted">ereal</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">&lt;</span> <span class="main">∞</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"e2ennreal <span class="free">x</span> <span class="main">&lt;</span> <span class="main">∞</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ereal_ennreal_cases<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">x</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"e2ennreal <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> e2ennreal_neg <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"e2ennreal <span class="free">x</span> <span class="main">&lt;</span> <span class="main">∞</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">b</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span>  <span class="free">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> enn2ereal <span class="skolem">b</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">=</span> e2ennreal <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">&lt;</span> <span class="main">∞</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">b</span> <span class="main">&lt;</span> <span class="main">∞</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">=</span> <span class="main">∞</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_ennreal.rep_eq<span class="main">)</span> 
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="main">∞</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> enn2ereal_eq_top_iff <span class="quoted"><span class="quoted">‹<span class="free">x</span> <span class="main">=</span> enn2ereal <span class="skolem">b</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"e2ennreal <span class="free">x</span> <span class="main">&lt;</span> <span class="main">∞</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="main">=</span> e2ennreal <span class="free">x</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Hahn_Jordan_Prelims-pos_e2ennreal_additive"><span class="command">lemma</span></span> pos_e2ennreal_additive<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"measure_space <span class="main">(</span>space <span class="free">M</span><span class="main">)</span> <span class="main">(</span>sets <span class="free">M</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> e2ennreal <span class="main">(</span><span class="free">m1</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span> sets <span class="free">M</span><span class="main">.</span> <span class="main">0</span> <span class="main">≤</span> <span class="free">m1</span> <span class="bound">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"additive <span class="main">(</span>sets <span class="free">M</span><span class="main">)</span> <span class="free">m1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> additive_def<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">A</span> <span class="skolem">B</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span><span class="main">∈</span> sets <span class="free">M</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span><span class="main">∈</span> sets <span class="free">M</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span><span class="main">∩</span> <span class="skolem">B</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">note</span></span> abprops <span class="main">=</span> this
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">M1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">M1</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> e2ennreal <span class="main">(</span><span class="free">m1</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"additive <span class="main">(</span>sets <span class="free">M</span><span class="main">)</span> <span class="skolem">M1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ring_of_sets.countably_additive_additive
      sets.ring_of_sets_axioms assms <span class="keyword1"><span class="command">unfolding</span></span> measure_space_def M1_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span><span class="main">∪</span><span class="skolem">B</span> <span class="main">∈</span> sets <span class="free">M</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> abprops <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">m1</span> <span class="main">(</span><span class="skolem">A</span><span class="main">∪</span> <span class="skolem">B</span><span class="main">)</span> <span class="main">=</span> enn2ereal <span class="main">(</span><span class="skolem">M1</span> <span class="main">(</span><span class="skolem">A</span><span class="main">∪</span> <span class="skolem">B</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> M1_def <span class="keyword1"><span class="command">using</span></span> assms enn2ereal_e2ennreal 
      abprops <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> enn2ereal <span class="main">(</span><span class="skolem">M1</span> <span class="skolem">A</span> <span class="main">+</span> <span class="skolem">M1</span> <span class="skolem">B</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹additive <span class="main">(</span>sets <span class="free">M</span><span class="main">)</span> <span class="skolem">M1</span>›</span></span> abprops 
    <span class="keyword1"><span class="command">unfolding</span></span> additive_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> enn2ereal <span class="main">(</span><span class="skolem">M1</span> <span class="skolem">A</span><span class="main">)</span> <span class="main">+</span> enn2ereal <span class="main">(</span><span class="skolem">M1</span> <span class="skolem">B</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> plus_ennreal.rep_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">m1</span> <span class="skolem">A</span> <span class="main">+</span> <span class="free">m1</span> <span class="skolem">B</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> M1_def <span class="keyword1"><span class="command">using</span></span> assms enn2ereal_e2ennreal 
      abprops <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">m1</span> <span class="main">(</span><span class="skolem">A</span><span class="main">∪</span> <span class="skolem">B</span><span class="main">)</span> <span class="main">=</span> <span class="free">m1</span> <span class="skolem">A</span> <span class="main">+</span> <span class="free">m1</span> <span class="skolem">B</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Some summability properties›</span></span>

<span class="keyword1" id="Hahn_Jordan_Prelims-shift_denum"><span class="command">lemma</span></span> shift_denum<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">/</span><span class="main">(</span><span class="free">x</span> <span class="free">i</span> <span class="main">-</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="numeral">2</span><span class="main">/</span><span class="free">x</span> <span class="free">i</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="free">i</span> <span class="main">≤</span> <span class="main">1</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="free">i</span> <span class="main">-</span> <span class="main">1</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">≤</span> <span class="free">x</span> <span class="free">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">x</span> <span class="free">i</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="free">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="free">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> <span class="free">x</span> <span class="free">i</span><span class="main">)</span><span class="main">/</span><span class="main">(</span><span class="free">x</span> <span class="free">i</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="free">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="numeral">2</span> <span class="main">≤</span> <span class="free">x</span> <span class="free">i</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span>real <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="free">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> real <span class="main">(</span><span class="free">x</span> <span class="free">i</span><span class="main">)</span><span class="main">)</span><span class="main">/</span><span class="main">(</span><span class="free">x</span> <span class="free">i</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="free">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> of_nat_diff <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="free">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">/</span><span class="main">(</span><span class="free">x</span> <span class="free">i</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="free">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="free">x</span> <span class="free">i</span><span class="main">/</span><span class="main">(</span><span class="free">x</span> <span class="free">i</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="free">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> diff_divide_distrib<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="free">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="free">i</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="free">i</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="free">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">/</span><span class="free">x</span> <span class="free">i</span> <span class="main">-</span> <span class="free">x</span> <span class="free">i</span><span class="main">/</span><span class="main">(</span><span class="free">x</span> <span class="free">i</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="free">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>  <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="numeral">2</span> <span class="main">≤</span> <span class="free">x</span> <span class="free">i</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">/</span><span class="free">x</span> <span class="free">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">/</span><span class="main">(</span><span class="free">x</span> <span class="free">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="numeral">2</span><span class="main">/</span><span class="free">x</span> <span class="free">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">/</span><span class="main">(</span><span class="free">x</span> <span class="free">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Hahn_Jordan_Prelims-shift_denum'"><span class="command">lemma</span></span> shift_denum'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="free">k</span> <span class="main">≤</span> <span class="free">x</span> <span class="bound">i</span> <span class="main">⟹</span> <span class="free">k</span> <span class="main">+</span><span class="free">e</span>  <span class="main">≤</span> <span class="main">(</span><span class="main">(</span><span class="free">x</span> <span class="bound">i</span><span class="main">)</span><span class="main">::</span>nat<span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">x</span> <span class="bound">i</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="free">x</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="free">p</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">e</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">c</span><span class="main">.</span> <span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="main">1</span><span class="main">/</span><span class="main">(</span><span class="free">x</span> <span class="bound">i</span> <span class="main">-</span> <span class="free">k</span><span class="main">)</span> <span class="main">≤</span> <span class="bound">c</span><span class="main">/</span><span class="main">(</span><span class="free">x</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> 
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="free">k</span> <span class="main">≤</span> <span class="free">x</span> <span class="bound">i</span> <span class="main">⟹</span> <span class="free">e</span> <span class="main">≤</span> <span class="free">x</span> <span class="bound">i</span> <span class="main">-</span> <span class="free">k</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">≤</span> <span class="free">x</span> <span class="skolem">i</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">+</span> <span class="free">e</span> <span class="main">≤</span> <span class="free">x</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">≤</span> <span class="free">x</span> <span class="skolem">i</span> <span class="main">-</span> <span class="free">k</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="free">k</span> <span class="main">≤</span> <span class="free">x</span> <span class="bound">i</span> <span class="main">⟹</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="main">(</span><span class="free">x</span> <span class="bound">i</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="free">x</span> <span class="bound">i</span> <span class="main">-</span> <span class="free">k</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">≤</span> <span class="free">x</span> <span class="skolem">i</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="main">(</span><span class="free">x</span> <span class="skolem">i</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="free">x</span> <span class="skolem">i</span> <span class="main">-</span> <span class="free">k</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">cw</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">cw</span> <span class="main">=</span> <span class="free">p</span><span class="main">/</span><span class="free">e</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms  <span class="keyword1"><span class="command">using</span></span> neq0_conv <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">cw</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> cw_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="free">x</span> <span class="bound">i</span> <span class="main">-</span> <span class="free">k</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">cw</span> <span class="main">/</span> <span class="free">x</span> <span class="bound">i</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="free">x</span> <span class="skolem">i</span> <span class="main">-</span> <span class="free">k</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">cw</span> <span class="main">/</span> <span class="free">x</span> <span class="skolem">i</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">≤</span> <span class="free">x</span> <span class="skolem">i</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="main">(</span><span class="free">p</span> <span class="main">-</span> <span class="free">x</span> <span class="skolem">i</span><span class="main">)</span><span class="main">/</span><span class="main">(</span><span class="main">(</span><span class="free">x</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="skolem">i</span> <span class="main">-</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="free">k</span> <span class="main">≤</span> <span class="free">x</span> <span class="bound">i</span> <span class="main">⟹</span><span class="main">0</span> <span class="main">&lt;</span> <span class="free">x</span> <span class="bound">i</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="bound">i</span> <span class="main">-</span> <span class="free">k</span><span class="main">)</span>›</span></span> assms<span class="main">(</span>3<span class="main">)</span> 
          divide_nonneg_pos<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">-</span> <span class="free">x</span> <span class="skolem">i</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="skolem">i</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="skolem">i</span> <span class="main">-</span> <span class="free">k</span><span class="main">)</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_eq_real_def<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">cw</span> <span class="main">*</span> <span class="free">e</span> <span class="main">-</span> <span class="free">x</span> <span class="skolem">i</span><span class="main">)</span><span class="main">/</span><span class="main">(</span><span class="main">(</span><span class="free">x</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="skolem">i</span> <span class="main">-</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> cw_def <span class="keyword1"><span class="command">using</span></span> assms True
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> divide_less_cancel division_ring_divide_zero eq_divide_imp nat_less_le 
            of_nat_0_less_iff of_nat_diff times_divide_eq_left<span class="main">)</span> 
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="skolem">cw</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="skolem">i</span> <span class="main">-</span> <span class="free">k</span><span class="main">)</span> <span class="main">-</span> <span class="free">x</span> <span class="skolem">i</span><span class="main">)</span><span class="main">/</span><span class="main">(</span><span class="main">(</span><span class="free">x</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="skolem">i</span> <span class="main">-</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">cw</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="skolem">i</span> <span class="main">-</span> <span class="free">k</span><span class="main">)</span> <span class="main">-</span> <span class="free">x</span> <span class="skolem">i</span> <span class="main">≥</span> <span class="skolem">cw</span> <span class="main">*</span> <span class="free">e</span> <span class="main">-</span> <span class="free">x</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">k</span> <span class="main">≤</span> <span class="free">x</span> <span class="skolem">i</span> <span class="main">⟹</span> <span class="free">e</span> <span class="main">≤</span> <span class="free">x</span> <span class="skolem">i</span> <span class="main">-</span> <span class="free">k</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">cw</span>›</span></span> True  
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">k</span> <span class="main">≤</span> <span class="free">x</span> <span class="skolem">i</span> <span class="main">⟹</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="main">(</span><span class="free">x</span> <span class="skolem">i</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="free">x</span> <span class="skolem">i</span> <span class="main">-</span> <span class="free">k</span><span class="main">)</span>›</span></span> 
            divide_right_mono<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">cw</span> <span class="main">*</span> <span class="free">e</span> <span class="main">-</span> <span class="free">x</span> <span class="skolem">i</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">cw</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="skolem">i</span> <span class="main">-</span> <span class="free">k</span><span class="main">)</span> <span class="main">-</span> <span class="free">x</span> <span class="skolem">i</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="skolem">i</span> <span class="main">-</span> <span class="free">k</span><span class="main">)</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">cw</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="skolem">i</span> <span class="main">-</span><span class="free">k</span><span class="main">)</span><span class="main">)</span><span class="main">/</span><span class="main">(</span><span class="main">(</span><span class="free">x</span> <span class="skolem">i</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="free">x</span> <span class="skolem">i</span> <span class="main">-</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="free">x</span> <span class="skolem">i</span><span class="main">/</span><span class="main">(</span><span class="main">(</span><span class="free">x</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="skolem">i</span> <span class="main">-</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> assms diff_divide_distrib <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="skolem">cw</span> <span class="main">/</span> <span class="free">x</span> <span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">/</span><span class="main">(</span><span class="free">x</span> <span class="skolem">i</span><span class="main">-</span><span class="free">k</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">/</span><span class="main">(</span><span class="free">x</span> <span class="skolem">i</span><span class="main">-</span><span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span> <span class="skolem">i</span><span class="main">/</span><span class="main">(</span><span class="main">(</span><span class="free">x</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="skolem">i</span> <span class="main">-</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> less_imp_neq <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="free">k</span> <span class="main">≤</span> <span class="free">x</span> <span class="bound">i</span> <span class="main">⟹</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">x</span> <span class="bound">i</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="bound">i</span> <span class="main">-</span> <span class="free">k</span><span class="main">)</span>›</span></span> assms<span class="main">(</span>2<span class="main">)</span> zero_less_mult_pos
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> f1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">r</span> <span class="bound">ra</span><span class="main">.</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span>real<span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="bound">ra</span> <span class="main">/</span> <span class="bound">r</span><span class="main">)</span> <span class="main">=</span> <span class="bound">r</span> <span class="main">/</span> <span class="bound">ra</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"real <span class="main">(</span><span class="free">x</span> <span class="skolem">i</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="skolem">i</span> <span class="main">-</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> True  <span class="quoted"><span class="quoted">‹<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="free">k</span> <span class="main">≤</span> <span class="free">x</span> <span class="bound">i</span> <span class="main">⟹</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">x</span> <span class="bound">i</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="bound">i</span> <span class="main">-</span> <span class="free">k</span><span class="main">)</span>›</span></span> neq0_conv of_nat_0 of_nat_le_0_iff<span class="main">)</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> f1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="main">1</span> <span class="main">/</span> real <span class="main">(</span><span class="free">x</span> <span class="skolem">i</span> <span class="main">-</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> real <span class="main">(</span><span class="free">x</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">/</span> real <span class="main">(</span><span class="free">x</span> <span class="skolem">i</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="skolem">i</span> <span class="main">-</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span>›</span></span> 
                div_by_1 divide_divide_eq_right nonzero_mult_div_cancel_left<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span> 
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="skolem">cw</span> <span class="main">/</span> <span class="free">x</span> <span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">/</span><span class="main">(</span><span class="free">x</span> <span class="skolem">i</span><span class="main">-</span><span class="free">k</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="free">x</span> <span class="skolem">i</span> <span class="main">-</span> <span class="free">k</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">cw</span> <span class="main">/</span> <span class="free">x</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"real <span class="main">(</span><span class="free">x</span> <span class="skolem">i</span> <span class="main">-</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">/</span> real <span class="main">(</span><span class="free">x</span> <span class="skolem">i</span> <span class="main">-</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">/</span> real <span class="main">(</span><span class="free">x</span> <span class="skolem">i</span> <span class="main">-</span> <span class="free">k</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">cw</span> <span class="main">/</span> real <span class="main">(</span><span class="free">x</span> <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cw_def<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Hahn_Jordan_Prelims-sum_le"><span class="command">lemma</span></span> sum_le<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="free">f</span> <span class="bound">i</span> <span class="main">≤</span> <span class="main">(</span><span class="main">(</span><span class="free">g</span> <span class="bound">i</span><span class="main">)</span> <span class="main">::</span> real<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"sum <span class="free">f</span> <span class="main">{..</span> <span class="main">(</span><span class="free">n</span><span class="main">::</span>nat<span class="main">)</span><span class="main">}</span> <span class="main">≤</span> sum <span class="free">g</span> <span class="main">{..</span> <span class="free">n</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum <span class="free">f</span> <span class="main">{..</span>Suc <span class="skolem">n</span><span class="main">}</span> <span class="main">=</span> sum <span class="free">f</span> <span class="main">{..</span> <span class="skolem">n</span><span class="main">}</span> <span class="main">+</span> <span class="free">f</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> sum <span class="free">g</span> <span class="main">{..</span> <span class="skolem">n</span><span class="main">}</span> <span class="main">+</span> <span class="free">f</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Suc <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> sum <span class="free">g</span> <span class="main">{..</span> <span class="skolem">n</span><span class="main">}</span> <span class="main">+</span> <span class="free">g</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> sum <span class="free">g</span> <span class="main">{..</span> Suc <span class="skolem">n</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Hahn_Jordan_Prelims-summable_bounded"><span class="command">lemma</span></span> summable_bounded<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="main">0</span> <span class="main">≤</span> <span class="main">(</span><span class="main">(</span><span class="free">f</span> <span class="bound">i</span><span class="main">)</span><span class="main">::</span>real<span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="free">f</span> <span class="bound">i</span> <span class="main">≤</span> <span class="free">g</span> <span class="bound">i</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"summable <span class="free">g</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"summable <span class="free">f</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> bounded_imp_summable<span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main">)</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="main">0</span> <span class="main">≤</span> <span class="free">g</span> <span class="bound">i</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms dual_order.trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum <span class="free">f</span> <span class="main">{..</span> <span class="skolem">n</span><span class="main">}</span> <span class="main">≤</span> sum <span class="free">g</span> <span class="main">{..</span> <span class="skolem">n</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms sum_le <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> suminf <span class="free">g</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum_le_suminf<span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms <span class="quoted"><span class="quoted">‹<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="main">0</span> <span class="main">≤</span> <span class="free">g</span> <span class="bound">i</span>›</span></span><span class="main">)</span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"sum <span class="free">f</span> <span class="main">{..</span> <span class="skolem">n</span><span class="main">}</span> <span class="main">≤</span> suminf <span class="free">g</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Hahn_Jordan_Prelims-sum_shift_denum"><span class="command">lemma</span></span> sum_shift_denum<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"summable <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="main">1</span><span class="main">/</span><span class="main">(</span><span class="main">(</span><span class="free">f</span> <span class="bound">i</span><span class="main">)</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"summable <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="main">1</span><span class="main">/</span><span class="main">(</span><span class="free">f</span> <span class="bound">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="main">1</span><span class="main">/</span><span class="main">(</span><span class="free">f</span> <span class="bound">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">≤</span> <span class="numeral">2</span> <span class="main">/</span> <span class="free">f</span> <span class="bound">i</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> shift_denum<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">f</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"summable <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="numeral">2</span><span class="main">/</span> <span class="free">f</span> <span class="bound">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms summable_mult<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">1</span><span class="main">/</span> <span class="free">f</span> <span class="bound">n</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> summable_bounded<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="main">1</span><span class="main">/</span><span class="main">(</span><span class="free">f</span> <span class="bound">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">1</span><span class="main">/</span><span class="free">f</span> <span class="bound">i</span>"</span></span><span class="main">]</span>
      <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> real <span class="main">(</span><span class="free">f</span> <span class="bound">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">≤</span> <span class="numeral">2</span> <span class="main">/</span> real <span class="main">(</span><span class="free">f</span> <span class="bound">i</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Hahn_Jordan_Prelims-sum_shift_denum'"><span class="command">lemma</span></span> sum_shift_denum'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"summable <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="main">1</span><span class="main">/</span><span class="main">(</span><span class="free">f</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">e</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="free">k</span> <span class="main">≤</span> <span class="free">f</span> <span class="bound">i</span> <span class="main">⟹</span> <span class="free">k</span> <span class="main">+</span> <span class="free">e</span> <span class="main">≤</span> <span class="main">(</span><span class="main">(</span><span class="free">f</span> <span class="bound">i</span><span class="main">)</span><span class="main">::</span>nat<span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">f</span> <span class="bound">i</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="free">f</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"summable <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="main">1</span><span class="main">/</span><span class="main">(</span><span class="free">f</span> <span class="bound">i</span> <span class="main">-</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="main">0</span> <span class="main">≤</span> <span class="main">1</span><span class="main">/</span><span class="main">(</span><span class="free">f</span> <span class="bound">i</span> <span class="main">-</span> <span class="free">k</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="free">f</span> <span class="skolem">i</span> <span class="main">-</span> <span class="free">k</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="main">1</span><span class="main">/</span><span class="main">(</span><span class="free">f</span> <span class="skolem">i</span> <span class="main">-</span> <span class="free">k</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">c</span><span class="main">.</span> <span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="main">1</span><span class="main">/</span><span class="main">(</span><span class="free">f</span> <span class="bound">i</span> <span class="main">-</span> <span class="free">k</span><span class="main">)</span> <span class="main">≤</span> <span class="bound">c</span> <span class="main">/</span> <span class="free">f</span> <span class="bound">i</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> shift_denum'<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">k</span></span> <span class="quoted"><span class="free">f</span></span> <span class="quoted"><span class="free">e</span></span> <span class="quoted"><span class="free">p</span></span><span class="main">]</span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="main">1</span><span class="main">/</span><span class="main">(</span><span class="free">f</span> <span class="bound">i</span> <span class="main">-</span> <span class="free">k</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">c</span> <span class="main">/</span> <span class="free">f</span> <span class="bound">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"summable <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">c</span> <span class="main">*</span> <span class="main">1</span><span class="main">/</span> <span class="free">f</span> <span class="bound">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms summable_mult<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">1</span><span class="main">/</span> <span class="free">f</span> <span class="bound">n</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> summable_bounded<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="main">1</span><span class="main">/</span><span class="main">(</span><span class="free">f</span> <span class="bound">i</span> <span class="main">-</span> <span class="free">k</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">c</span> <span class="main">*</span> <span class="main">1</span><span class="main">/</span><span class="free">f</span> <span class="bound">i</span>"</span></span><span class="main">]</span>
      <span class="quoted"><span class="quoted">‹<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="main">0</span> <span class="main">≤</span> <span class="main">1</span><span class="main">/</span><span class="main">(</span><span class="free">f</span> <span class="bound">i</span> <span class="main">-</span> <span class="free">k</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="free">f</span> <span class="bound">i</span> <span class="main">-</span> <span class="free">k</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">c</span> <span class="main">/</span> <span class="free">f</span> <span class="bound">i</span>›</span></span><span class="main">)</span> 
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="Hahn_Jordan_Decomposition">
<div class="head">
<h1>Theory Hahn_Jordan_Decomposition</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Signed measures›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹In this section we define signed measures. These are generalizations of measures that can also 
take negative values but cannot contain both $\infty$ and $-\infty$ in their range.›</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Basic definitions›</span></span>
<span class="keyword1"><span class="command">theory</span></span> Hahn_Jordan_Decomposition <span class="keyword2"><span class="keyword">imports</span></span> 
  <span class="quoted">"<a href="https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL-Probability/Probability.html">HOL-Probability.Probability</a>"</span> 
  <a href="#Hahn_Jordan_Prelims">Hahn_Jordan_Prelims</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">signed_measure</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span> measure <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> set <span class="main">⇒</span> ereal<span class="main">)</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">signed_measure</span> <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="free"><span class="bound"><span class="entity">μ</span></span></span> <span class="main">⟷</span> <span class="free"><span class="bound"><span class="entity">μ</span></span></span> <span class="main">{}</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">(</span><span class="main">-</span><span class="main">∞</span> <span class="main">∉</span> range <span class="free"><span class="bound"><span class="entity">μ</span></span></span> <span class="main">∨</span> <span class="main">∞</span> <span class="main">∉</span> range <span class="free"><span class="bound"><span class="entity">μ</span></span></span><span class="main">)</span> <span class="main">∧</span> 
  <span class="main">(</span><span class="main">∀</span><span class="bound">A</span><span class="main">.</span> range <span class="bound">A</span> <span class="main">⊆</span> sets <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="main">⟶</span> disjoint_family <span class="bound">A</span> <span class="main">⟶</span> <span class="main">⋃</span> <span class="main">(</span>range <span class="bound">A</span><span class="main">)</span> <span class="main">∈</span> sets <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="main">⟶</span> 
  <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">μ</span></span></span> <span class="main">(</span><span class="bound">A</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">sums</span> <span class="free"><span class="bound"><span class="entity">μ</span></span></span> <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span>range <span class="bound">A</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
  <span class="main">(</span><span class="main">∀</span><span class="bound">A</span><span class="main">.</span> range <span class="bound">A</span> <span class="main">⊆</span> sets <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="main">⟶</span> disjoint_family <span class="bound">A</span> <span class="main">⟶</span> <span class="main">⋃</span> <span class="main">(</span>range <span class="bound">A</span><span class="main">)</span> <span class="main">∈</span> sets <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="main">⟶</span> 
  <span class="main">¦</span><span class="free"><span class="bound"><span class="entity">μ</span></span></span> <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span>range <span class="bound">A</span><span class="main">)</span><span class="main">)</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="main">∞</span> <span class="main">⟶</span> summable <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> real_of_ereal <span class="main">¦</span><span class="free"><span class="bound"><span class="entity">μ</span></span></span> <span class="main">(</span><span class="bound">A</span> <span class="bound">i</span><span class="main">)</span><span class="main">¦</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Hahn_Jordan_Decomposition-signed_measure_empty"><span class="command">lemma</span></span> signed_measure_empty<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"signed_measure <span class="free">M</span> <span class="free">μ</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">μ</span> <span class="main">{}</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> signed_measure_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Hahn_Jordan_Decomposition-signed_measure_sums"><span class="command">lemma</span></span> signed_measure_sums<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"signed_measure <span class="free">M</span> <span class="free">μ</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"range <span class="free">A</span> <span class="main">⊆</span> <span class="free">M</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"disjoint_family <span class="free">A</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋃</span> <span class="main">(</span>range <span class="free">A</span><span class="main">)</span> <span class="main">∈</span> sets <span class="free">M</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="free">μ</span> <span class="main">(</span><span class="free">A</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">sums</span> <span class="free">μ</span> <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span>range <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> signed_measure_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Hahn_Jordan_Decomposition-signed_measure_summable"><span class="command">lemma</span></span> signed_measure_summable<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"signed_measure <span class="free">M</span> <span class="free">μ</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"range <span class="free">A</span> <span class="main">⊆</span> <span class="free">M</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"disjoint_family <span class="free">A</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋃</span> <span class="main">(</span>range <span class="free">A</span><span class="main">)</span> <span class="main">∈</span> sets <span class="free">M</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="free">μ</span> <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span>range <span class="free">A</span><span class="main">)</span><span class="main">)</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="main">∞</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"summable <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> real_of_ereal <span class="main">¦</span><span class="free">μ</span> <span class="main">(</span><span class="free">A</span> <span class="bound">i</span><span class="main">)</span><span class="main">¦</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> signed_measure_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Hahn_Jordan_Decomposition-signed_measure_inf_sum"><span class="command">lemma</span></span> signed_measure_inf_sum<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"signed_measure <span class="free">M</span> <span class="free">μ</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"range <span class="free">A</span> <span class="main">⊆</span> <span class="free">M</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"disjoint_family <span class="free">A</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋃</span> <span class="main">(</span>range <span class="free">A</span><span class="main">)</span> <span class="main">∈</span> sets <span class="free">M</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">.</span> <span class="free">μ</span> <span class="main">(</span><span class="free">A</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">μ</span> <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span>range <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> sums_unique assms 
    signed_measure_sums <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span><span class="main">)</span>

<span class="keyword1" id="Hahn_Jordan_Decomposition-signed_measure_abs_convergent"><span class="command">lemma</span></span> signed_measure_abs_convergent<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"signed_measure <span class="free">M</span> <span class="free">μ</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"range <span class="free">A</span> <span class="main">⊆</span> sets <span class="free">M</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"disjoint_family <span class="free">A</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋃</span> <span class="main">(</span>range <span class="free">A</span><span class="main">)</span> <span class="main">∈</span> sets <span class="free">M</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="free">μ</span> <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span>range <span class="free">A</span><span class="main">)</span><span class="main">)</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="main">∞</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"summable <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> real_of_ereal <span class="main">¦</span><span class="free">μ</span> <span class="main">(</span><span class="free">A</span> <span class="bound">i</span><span class="main">)</span><span class="main">¦</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms 
  <span class="keyword1"><span class="command">unfolding</span></span> signed_measure_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Hahn_Jordan_Decomposition-signed_measure_additive"><span class="command">lemma</span></span> signed_measure_additive<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"signed_measure <span class="free">M</span> <span class="free">μ</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"additive <span class="free">M</span> <span class="free">μ</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> additive_def<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
  <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">M</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="free">M</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∩</span> <span class="skolem">y</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"disjoint_family <span class="main">(</span>binaryset <span class="skolem">x</span> <span class="skolem">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> disjoint_family_on_def binaryset_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="free">μ</span> <span class="main">(</span><span class="main">(</span>binaryset <span class="skolem">x</span> <span class="skolem">y</span><span class="main">)</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">sums</span> <span class="main">(</span><span class="free">μ</span> <span class="skolem">x</span> <span class="main">+</span> <span class="free">μ</span> <span class="skolem">y</span><span class="main">)</span>"</span></span>  <span class="keyword1"><span class="command">using</span></span> binaryset_sums 
      signed_measure_empty<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">M</span></span> <span class="quoted"><span class="free">μ</span></span><span class="main">]</span> assms  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"range <span class="main">(</span>binaryset <span class="skolem">x</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">,</span> <span class="main">{}</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> range_binaryset_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">,</span> <span class="main">{}</span><span class="main">}</span> <span class="main">⊆</span> <span class="free">M</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> x y <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∪</span><span class="skolem">y</span> <span class="main">∈</span> sets <span class="free">M</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> x y <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋃</span> <span class="main">(</span>range <span class="main">(</span>binaryset <span class="skolem">x</span> <span class="skolem">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">x</span><span class="main">∪</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> calculation<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="free">μ</span> <span class="main">(</span><span class="main">(</span>binaryset <span class="skolem">x</span> <span class="skolem">y</span><span class="main">)</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">sums</span> <span class="free">μ</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">∪</span> <span class="skolem">y</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms x y
      signed_measure_empty<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">M</span></span> <span class="quoted"><span class="free">μ</span></span><span class="main">]</span> signed_measure_sums<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">M</span></span> <span class="quoted"><span class="free">μ</span></span><span class="main">]</span>
      <span class="quoted"><span class="quoted">‹disjoint_family <span class="main">(</span>binaryset <span class="skolem">x</span> <span class="skolem">y</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span><span class="main">)</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">μ</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">∪</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> <span class="free">μ</span> <span class="skolem">x</span> <span class="main">+</span> <span class="free">μ</span> <span class="skolem">y</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="free">μ</span> <span class="main">(</span><span class="main">(</span>binaryset <span class="skolem">x</span> <span class="skolem">y</span><span class="main">)</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">sums</span> <span class="main">(</span><span class="free">μ</span> <span class="skolem">x</span> <span class="main">+</span> <span class="free">μ</span> <span class="skolem">y</span><span class="main">)</span>›</span></span> sums_unique2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Hahn_Jordan_Decomposition-signed_measure_add"><span class="command">lemma</span></span> signed_measure_add<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"signed_measure <span class="free">M</span> <span class="free">μ</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">∈</span> sets <span class="free">M</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span><span class="main">∈</span> sets <span class="free">M</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">∩</span> <span class="free">b</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">μ</span> <span class="main">(</span><span class="free">a</span><span class="main">∪</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> <span class="free">μ</span> <span class="free">a</span> <span class="main">+</span> <span class="free">μ</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> additiveD<span class="main">[</span><span class="operator">OF</span> signed_measure_additive<span class="main">]</span> 
    assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Hahn_Jordan_Decomposition-signed_measure_disj_sum"><span class="command">lemma</span></span> signed_measure_disj_sum<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">I</span> <span class="main">⟹</span> signed_measure <span class="free">M</span> <span class="free">μ</span> <span class="main">⟹</span> disjoint_family_on <span class="free">A</span> <span class="free">I</span> <span class="main">⟹</span> 
    <span class="main">(</span><span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> <span class="free">I</span> <span class="main">⟹</span> <span class="free">A</span> <span class="bound">i</span> <span class="main">∈</span> sets <span class="free">M</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">μ</span> <span class="main">(</span><span class="main">⋃</span> <span class="bound">i</span><span class="main">∈</span> <span class="free">I</span><span class="main">.</span> <span class="free">A</span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span> <span class="bound">i</span><span class="main">∈</span> <span class="free">I</span><span class="main">.</span> <span class="free">μ</span> <span class="main">(</span><span class="free">A</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>finite_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> empty
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>  <span class="keyword1"><span class="command">unfolding</span></span> signed_measure_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>insert <span class="skolem">x</span> <span class="skolem">F</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">μ</span> <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span><span class="free">A</span> <span class="main">`</span> insert <span class="skolem">x</span> <span class="skolem">F</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">μ</span> <span class="main">(</span><span class="main">(</span><span class="main">⋃</span> <span class="main">(</span><span class="free">A</span> <span class="main">`</span><span class="skolem">F</span><span class="main">)</span><span class="main">)</span> <span class="main">∪</span> <span class="free">A</span> <span class="skolem">x</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Un_commute<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">μ</span> <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span><span class="free">A</span> <span class="main">`</span><span class="skolem">F</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="free">μ</span> <span class="main">(</span><span class="free">A</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋃</span> <span class="main">(</span><span class="free">A</span> <span class="main">`</span><span class="skolem">F</span><span class="main">)</span><span class="main">)</span> <span class="main">∩</span> <span class="main">(</span><span class="free">A</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> insert
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> disjoint_family_on_insert inf_commute<span class="main">)</span> 
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋃</span> <span class="main">(</span><span class="free">A</span> <span class="main">`</span><span class="skolem">F</span><span class="main">)</span> <span class="main">∈</span> sets <span class="free">M</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> insert <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="skolem">x</span> <span class="main">∈</span> sets <span class="free">M</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> insert <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> insert.prems<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> signed_measure_add<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span> <span class="bound">i</span><span class="main">∈</span> <span class="skolem">F</span><span class="main">.</span> <span class="free">μ</span> <span class="main">(</span><span class="free">A</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="free">μ</span> <span class="main">(</span><span class="free">A</span> <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> insert
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> disjoint_family_on_insert insert_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span>insert <span class="skolem">x</span> <span class="skolem">F</span><span class="main">.</span> <span class="free">μ</span> <span class="main">(</span><span class="free">A</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add.commute insert.hyps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> insert.hyps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span> 
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Hahn_Jordan_Decomposition-pos_signed_measure_count_additive"><span class="command">lemma</span></span> pos_signed_measure_count_additive<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"signed_measure <span class="free">M</span> <span class="free">μ</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">E</span> <span class="main">∈</span> sets <span class="free">M</span><span class="main">.</span> <span class="main">0</span> <span class="main">≤</span> <span class="free">μ</span> <span class="bound">E</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"countably_additive <span class="main">(</span>sets <span class="free">M</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">A</span><span class="main">.</span> e2ennreal <span class="main">(</span><span class="free">μ</span> <span class="bound">A</span><span class="main">)</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">unfolding</span></span> countably_additive_def
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> allI impI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'a</span> set"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"range <span class="skolem">A</span> <span class="main">⊆</span> sets <span class="free">M</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"disjoint_family <span class="skolem">A</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋃</span> <span class="main">(</span>range <span class="skolem">A</span><span class="main">)</span> <span class="main">∈</span> sets <span class="free">M</span>"</span></span> <span class="keyword1"><span class="command">note</span></span> Aprops <span class="main">=</span> this
  <span class="keyword1"><span class="command">have</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="free">μ</span> <span class="main">(</span><span class="skolem">A</span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> enn2ereal <span class="main">(</span>e2ennreal <span class="main">(</span><span class="free">μ</span> <span class="main">(</span><span class="skolem">A</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms enn2ereal_e2ennreal Aprops <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">∑</span><span class="bound">i</span><span class="main">≤</span><span class="bound">n</span><span class="main">.</span> <span class="free">μ</span> <span class="main">(</span><span class="skolem">A</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">⇢</span> <span class="free">μ</span> <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span>range <span class="skolem">A</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> 
      sums_def_le<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="free">μ</span> <span class="main">(</span><span class="skolem">A</span> <span class="bound">i</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">μ</span> <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span>range <span class="skolem">A</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">]</span> assms 
      signed_measure_sums<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">M</span></span><span class="main">]</span> Aprops <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> e2ennreal <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">≤</span><span class="bound">n</span><span class="main">.</span> <span class="free">μ</span> <span class="main">(</span><span class="skolem">A</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⤏</span> 
      e2ennreal <span class="main">(</span><span class="free">μ</span> <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span>range <span class="skolem">A</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> sequentially"</span></span>
    <span class="keyword1"><span class="command">using</span></span> tendsto_e2ennrealI<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">∑</span><span class="bound">i</span><span class="main">≤</span><span class="bound">n</span><span class="main">.</span> <span class="free">μ</span> <span class="main">(</span><span class="skolem">A</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">μ</span> <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span>range <span class="skolem">A</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">]</span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> e2ennreal <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">≤</span><span class="bound">n</span><span class="main">.</span> <span class="free">μ</span> <span class="main">(</span><span class="skolem">A</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">≤</span><span class="bound">n</span><span class="main">.</span> e2ennreal <span class="main">(</span><span class="free">μ</span> <span class="main">(</span><span class="skolem">A</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> e2ennreal_finite_sum <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> enn2ereal_nonneg eq finite_atMost<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">≤</span><span class="bound">n</span><span class="main">.</span> e2ennreal <span class="main">(</span><span class="free">μ</span> <span class="main">(</span><span class="skolem">A</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⤏</span> 
    e2ennreal <span class="main">(</span><span class="free">μ</span> <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span>range <span class="skolem">A</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> sequentially"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> e2ennreal <span class="main">(</span><span class="free">μ</span> <span class="main">(</span><span class="skolem">A</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">sums</span> e2ennreal <span class="main">(</span><span class="free">μ</span> <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span>range <span class="skolem">A</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> sums_def_le<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">i</span><span class="main">.</span> e2ennreal <span class="main">(</span><span class="free">μ</span> <span class="main">(</span><span class="skolem">A</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"e2ennreal <span class="main">(</span><span class="free">μ</span> <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span>range <span class="skolem">A</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">]</span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">.</span> e2ennreal <span class="main">(</span><span class="free">μ</span> <span class="main">(</span><span class="skolem">A</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> e2ennreal <span class="main">(</span><span class="free">μ</span> <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span>range <span class="skolem">A</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> sums_unique assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Hahn_Jordan_Decomposition-signed_measure_minus"><span class="command">lemma</span></span> signed_measure_minus<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"signed_measure <span class="free">M</span> <span class="free">μ</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"signed_measure <span class="free">M</span> <span class="main">(</span><span class="main">λ</span><span class="bound">A</span><span class="main">.</span> <span class="main">-</span> <span class="free">μ</span> <span class="bound">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> signed_measure_def
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> conjI<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="free">μ</span> <span class="main">{}</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> signed_measure_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="main">∞</span> <span class="main">∉</span> range <span class="main">(</span><span class="main">λ</span><span class="bound">A</span><span class="main">.</span> <span class="main">-</span> <span class="free">μ</span> <span class="bound">A</span><span class="main">)</span> <span class="main">∨</span> <span class="main">∞</span> <span class="main">∉</span> range <span class="main">(</span><span class="main">λ</span><span class="bound">A</span><span class="main">.</span> <span class="main">-</span> <span class="free">μ</span> <span class="bound">A</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">∞</span> <span class="main">∈</span> range <span class="free">μ</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">∞</span> <span class="main">∉</span> range <span class="free">μ</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> signed_measure_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∞</span> <span class="main">∉</span> range <span class="main">(</span><span class="main">λ</span><span class="bound">A</span><span class="main">.</span> <span class="main">-</span> <span class="free">μ</span> <span class="bound">A</span><span class="main">)</span>"</span></span>  <span class="keyword1"><span class="command">using</span></span> ereal_uminus_eq_reorder <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="main">∞</span> <span class="main">∉</span> range <span class="main">(</span><span class="main">λ</span><span class="bound">A</span><span class="main">.</span> <span class="main">-</span> <span class="free">μ</span> <span class="bound">A</span><span class="main">)</span> <span class="main">∨</span> <span class="main">∞</span> <span class="main">∉</span> range <span class="main">(</span><span class="main">λ</span><span class="bound">A</span><span class="main">.</span> <span class="main">-</span> <span class="free">μ</span> <span class="bound">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">∞</span> <span class="main">∉</span> range <span class="main">(</span><span class="main">λ</span><span class="bound">A</span><span class="main">.</span> <span class="main">-</span> <span class="free">μ</span> <span class="bound">A</span><span class="main">)</span>"</span></span>  <span class="keyword1"><span class="command">using</span></span> ereal_uminus_eq_reorder 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> image_iff<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="main">∞</span> <span class="main">∉</span> range <span class="main">(</span><span class="main">λ</span><span class="bound">A</span><span class="main">.</span> <span class="main">-</span> <span class="free">μ</span> <span class="bound">A</span><span class="main">)</span> <span class="main">∨</span> <span class="main">∞</span> <span class="main">∉</span> range <span class="main">(</span><span class="main">λ</span><span class="bound">A</span><span class="main">.</span> <span class="main">-</span> <span class="free">μ</span> <span class="bound">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">A</span><span class="main">.</span> range <span class="bound">A</span> <span class="main">⊆</span> sets <span class="free">M</span> <span class="main">⟶</span> disjoint_family <span class="bound">A</span> <span class="main">⟶</span> <span class="main">⋃</span> <span class="main">(</span>range <span class="bound">A</span><span class="main">)</span> <span class="main">∈</span> sets <span class="free">M</span> <span class="main">⟶</span> 
    <span class="main">¦</span><span class="main">-</span> <span class="free">μ</span> <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span>range <span class="bound">A</span><span class="main">)</span><span class="main">)</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="main">∞</span> <span class="main">⟶</span> summable <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> real_of_ereal <span class="main">¦</span><span class="main">-</span> <span class="free">μ</span> <span class="main">(</span><span class="bound">A</span> <span class="bound">i</span><span class="main">)</span><span class="main">¦</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> allI impI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'a</span> set"</span></span>
    <span class="keyword3"><span class="command">assume</span></span>  <span class="quoted"><span class="quoted">"range <span class="skolem">A</span> <span class="main">⊆</span> sets <span class="free">M</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"disjoint_family <span class="skolem">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋃</span> <span class="main">(</span>range <span class="skolem">A</span><span class="main">)</span> <span class="main">∈</span> sets <span class="free">M</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="main">-</span> <span class="free">μ</span> <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span>range <span class="skolem">A</span><span class="main">)</span><span class="main">)</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="main">∞</span>"</span></span> 
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"summable <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> real_of_ereal <span class="main">¦</span><span class="main">-</span> <span class="free">μ</span> <span class="main">(</span><span class="skolem">A</span> <span class="bound">i</span><span class="main">)</span><span class="main">¦</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms 
      <span class="keyword1"><span class="command">unfolding</span></span> signed_measure_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">A</span><span class="main">.</span> range <span class="bound">A</span> <span class="main">⊆</span> sets <span class="free">M</span> <span class="main">⟶</span> disjoint_family <span class="bound">A</span> <span class="main">⟶</span> <span class="main">⋃</span> <span class="main">(</span>range <span class="bound">A</span><span class="main">)</span> <span class="main">∈</span> sets <span class="free">M</span> <span class="main">⟶</span> 
    <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="main">-</span> <span class="free">μ</span> <span class="main">(</span><span class="bound">A</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">sums</span> <span class="main">-</span> <span class="free">μ</span> <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span>range <span class="bound">A</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'a</span> set"</span></span>
      <span class="keyword3"><span class="command">assume</span></span>  <span class="quoted"><span class="quoted">"range <span class="skolem">A</span> <span class="main">⊆</span> sets <span class="free">M</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"disjoint_family <span class="skolem">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
        <span class="quoted"><span class="quoted">"<span class="main">⋃</span> <span class="main">(</span>range <span class="skolem">A</span><span class="main">)</span> <span class="main">∈</span> sets <span class="free">M</span>"</span></span> <span class="keyword1"><span class="command">note</span></span> Aprops <span class="main">=</span> this
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="main">∞</span> <span class="main">∉</span> range <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="free">μ</span> <span class="main">(</span><span class="skolem">A</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span> <span class="main">∞</span> <span class="main">∉</span> range <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="free">μ</span> <span class="main">(</span><span class="skolem">A</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"range <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="free">μ</span> <span class="main">(</span><span class="skolem">A</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> range <span class="free">μ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> signed_measure_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="free">μ</span> <span class="main">(</span><span class="skolem">A</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">sums</span> <span class="free">μ</span> <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span>range <span class="skolem">A</span><span class="main">)</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> signed_measure_sums<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">M</span></span><span class="main">]</span> Aprops assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="main">-</span> <span class="free">μ</span> <span class="main">(</span><span class="skolem">A</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">sums</span> <span class="main">-</span> <span class="free">μ</span> <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span>range <span class="skolem">A</span><span class="main">)</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> sums_minus'<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="free">μ</span> <span class="main">(</span><span class="skolem">A</span> <span class="bound">i</span><span class="main">)</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">locale</span></span> near_finite_function <span class="main">=</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">μ</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'b</span> set <span class="main">⇒</span> ereal"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> inf_range<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="main">∞</span> <span class="main">∉</span> range <span class="free">μ</span> <span class="main">∨</span> <span class="main">∞</span> <span class="main">∉</span> range <span class="free">μ</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> near_finite_function<span class="main">)</span> finite_subset<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="free">μ</span> <span class="free">E</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="main">∞</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span><span class="main">⊆</span> <span class="free">E</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">μ</span> <span class="free">E</span> <span class="main">=</span> <span class="free">μ</span> <span class="free">A</span> <span class="main">+</span> <span class="free">μ</span> <span class="main">(</span><span class="free">E</span> <span class="main">-</span> <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="free">μ</span> <span class="free">A</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="main">∞</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">∞</span> <span class="main">∈</span> range <span class="free">μ</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">μ</span> <span class="free">A</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="free">μ</span> <span class="free">A</span><span class="main">¦</span> <span class="main">=</span> <span class="free">μ</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">&lt;</span> <span class="main">∞</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ereal_less_PInfty rangeI<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="free">μ</span> <span class="free">A</span><span class="main">¦</span> <span class="main">=</span> <span class="main">-</span><span class="free">μ</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> not_less_iff_gr_or_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span> 
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">μ</span> <span class="main">(</span><span class="free">E</span> <span class="main">-</span> <span class="free">A</span><span class="main">)</span> <span class="main">-</span> <span class="free">μ</span> <span class="free">E</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">μ</span> <span class="free">E</span> <span class="main">=</span> <span class="free">μ</span> <span class="free">A</span> <span class="main">+</span> <span class="free">μ</span> <span class="main">(</span><span class="free">E</span> <span class="main">-</span> <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">μ</span> <span class="free">E</span> <span class="main">-</span> <span class="free">μ</span> <span class="free">A</span> <span class="main">=</span> <span class="free">μ</span> <span class="main">(</span><span class="free">E</span> <span class="main">-</span> <span class="free">A</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> abs_ereal_uminus assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> calculation ereal_diff_add_inverse 
            ereal_infty_less<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span>  ereal_minus<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> ereal_minus_less_iff 
            ereal_minus_less_minus ereal_uminus_uminus less_ereal.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> 
            minus_ereal_def  plus_ereal.simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> ereal_add_uminus_conv_diff ereal_eq_minus 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">μ</span> <span class="main">(</span><span class="free">E</span> <span class="main">-</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> <span class="main">¦</span><span class="free">μ</span> <span class="free">E</span><span class="main">¦</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="main">-</span> <span class="free">μ</span> <span class="free">A</span> <span class="main">=</span> <span class="free">μ</span> <span class="main">(</span><span class="free">E</span> <span class="main">-</span> <span class="free">A</span><span class="main">)</span> <span class="main">-</span> <span class="free">μ</span> <span class="free">E</span>›</span></span> abs_ereal_less0 abs_ereal_pos 
          ereal_diff_le_self ereal_le_add_mono1 less_eq_ereal_def 
          minus_ereal_def not_le_imp_less<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">&lt;</span> <span class="main">∞</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="quoted"><span class="quoted">‹<span class="main">∞</span> <span class="main">∉</span> range <span class="free">μ</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> UNIV_I ereal_less_PInfty ereal_plus_eq_PInfty image_eqI<span class="main">)</span> 
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">∞</span> <span class="main">∉</span> range <span class="free">μ</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> inf_range <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">∞</span> <span class="main">&lt;</span> <span class="free">μ</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ereal_infty_less<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> rangeI<span class="main">)</span> 
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">μ</span> <span class="free">A</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="free">μ</span> <span class="free">A</span><span class="main">¦</span> <span class="main">=</span> <span class="main">-</span><span class="free">μ</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> not_less_iff_gr_or_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span> 
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">&lt;</span> <span class="main">∞</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">-</span><span class="main">∞</span> <span class="main">&lt;</span> <span class="free">μ</span> <span class="free">A</span>›</span></span> <span class="keyword1"><span class="command">using</span></span> ereal_uminus_less_reorder 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="free">μ</span> <span class="free">A</span><span class="main">¦</span> <span class="main">=</span> <span class="free">μ</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">μ</span> <span class="free">E</span> <span class="main">-</span> <span class="free">μ</span> <span class="main">(</span><span class="free">E</span> <span class="main">-</span> <span class="free">A</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">μ</span> <span class="free">E</span> <span class="main">=</span> <span class="free">μ</span> <span class="free">A</span> <span class="main">+</span> <span class="free">μ</span> <span class="main">(</span><span class="free">E</span> <span class="main">-</span> <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>  
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">μ</span> <span class="free">A</span> <span class="main">=</span> <span class="free">μ</span> <span class="free">E</span> <span class="main">-</span> <span class="free">μ</span> <span class="main">(</span><span class="free">E</span> <span class="main">-</span> <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add.right_neutral  assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span>
            add_diff_eq_ereal calculation ereal_diff_add_eq_diff_diff_swap 
            ereal_diff_add_inverse ereal_infty_less<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> ereal_plus_eq_PInfty 
            ereal_x_minus_x<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">¦</span><span class="free">μ</span> <span class="free">E</span><span class="main">¦</span> <span class="main">-</span> <span class="free">μ</span> <span class="main">(</span><span class="free">E</span> <span class="main">-</span> <span class="free">A</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="main">¦</span><span class="free">μ</span> <span class="free">A</span><span class="main">¦</span> <span class="main">=</span> <span class="free">μ</span> <span class="free">A</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">μ</span> <span class="free">A</span> <span class="main">=</span> <span class="free">μ</span> <span class="free">E</span> <span class="main">-</span> <span class="free">μ</span> <span class="main">(</span><span class="free">E</span> <span class="main">-</span> <span class="free">A</span><span class="main">)</span>›</span></span> abs_ereal_ge0 
          abs_ereal_pos abs_ereal_uminus antisym_conv ereal_0_le_uminus_iff 
          ereal_abs_diff ereal_diff_le_mono_left ereal_diff_le_self le_cases 
          less_eq_ereal_def minus_ereal_def<span class="main">)</span> 
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">&lt;</span> <span class="main">∞</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">∞</span> <span class="main">&lt;</span> <span class="free">μ</span> <span class="main">(</span><span class="free">E</span> <span class="main">-</span> <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">-</span><span class="main">∞</span> <span class="main">∉</span> range <span class="free">μ</span>›</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ereal_infty_less<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> rangeI<span class="main">)</span> 
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="free">μ</span> <span class="main">(</span><span class="free">E</span> <span class="main">-</span> <span class="free">A</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">∞</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ereal_uminus_less_reorder <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ereal_minus_eq_PInfty_iff 
            ereal_uminus_eq_reorder<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">locale</span></span> signed_measure_space<span class="main">=</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">M</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span> measure"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">μ</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> sgn_meas<span class="main">:</span> <span class="quoted"><span class="quoted">"signed_measure <span class="free">M</span> <span class="free">μ</span>"</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> signed_measure_space <span class="main">⊆</span> near_finite_function
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="main">∞</span> <span class="main">∉</span> range <span class="free">μ</span> <span class="main">∨</span> <span class="main">∞</span> <span class="main">∉</span> range <span class="free">μ</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> sgn_meas 
    <span class="keyword1"><span class="command">unfolding</span></span> signed_measure_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">context</span></span> signed_measure_space
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1" id="Hahn_Jordan_Decomposition-signed_measure_finite_subset"><span class="command">lemma</span></span> signed_measure_finite_subset<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">E</span> <span class="main">∈</span> sets <span class="free">M</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="free">μ</span> <span class="free">E</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="main">∞</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span><span class="main">∈</span> sets <span class="free">M</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span><span class="main">⊆</span> <span class="free">E</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="free">μ</span> <span class="free">A</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="main">∞</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> finite_subset<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="free">μ</span> <span class="free">E</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="main">∞</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span><span class="main">⊆</span> <span class="free">E</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">μ</span> <span class="free">E</span> <span class="main">=</span> <span class="free">μ</span> <span class="free">A</span> <span class="main">+</span> <span class="free">μ</span> <span class="main">(</span><span class="free">E</span> <span class="main">-</span> <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms 
      sgn_meas signed_measure_add<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">M</span></span> <span class="quoted"><span class="free">μ</span></span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="quoted">"<span class="free">E</span> <span class="main">-</span> <span class="free">A</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="free">A</span> <span class="main">∈</span> sets <span class="free">M</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">E</span> <span class="main">∈</span> sets <span class="free">M</span>›</span></span> sets.Diff sup.absorb_iff2<span class="main">)</span> 
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Hahn_Jordan_Decomposition-measure_space_e2ennreal"><span class="command">lemma</span></span> measure_space_e2ennreal <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"measure_space <span class="main">(</span>space <span class="free">M</span><span class="main">)</span> <span class="main">(</span>sets <span class="free">M</span><span class="main">)</span> <span class="free">m</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">E</span> <span class="main">∈</span> sets <span class="free">M</span><span class="main">.</span> <span class="free">m</span> <span class="bound">E</span> <span class="main">&lt;</span> <span class="main">∞</span><span class="main">)</span> <span class="main">∧</span> 
    <span class="main">(</span><span class="main">∀</span><span class="bound">E</span> <span class="main">∈</span> sets <span class="free">M</span><span class="main">.</span> <span class="free">m</span> <span class="bound">E</span> <span class="main">≥</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">E</span> <span class="main">∈</span> sets <span class="free">M</span><span class="main">.</span> e2ennreal <span class="main">(</span><span class="free">m</span> <span class="bound">E</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">∞</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> 
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">E</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">E</span> <span class="main">∈</span> sets <span class="free">M</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"e2ennreal <span class="main">(</span><span class="free">m</span> <span class="skolem">E</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">∞</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="skolem">E</span> <span class="main">&lt;</span> <span class="main">∞</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="quoted"><span class="quoted">‹<span class="skolem">E</span> <span class="main">∈</span> sets <span class="free">M</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"e2ennreal <span class="main">(</span><span class="free">m</span> <span class="skolem">E</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">∞</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> e2ennreal_less_top
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">m</span> <span class="skolem">E</span> <span class="main">&lt;</span> <span class="main">∞</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Positive and negative subsets›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The Hahn decomposition theorem is based on the notions of positive and negative measurable
sets. A measurable set is positive (resp. negative) if all its measurable subsets have a positive
(resp. negative) measure by $\mu$. The decomposition theorem states that any measure space for
a signed measure can be decomposed into a positive and a negative measurable set.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">pos_meas_set</span>  <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">pos_meas_set</span> <span class="free"><span class="bound"><span class="entity">E</span></span></span> <span class="main">⟷</span> <span class="free"><span class="bound"><span class="entity">E</span></span></span> <span class="main">∈</span> sets <span class="free">M</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">A</span> <span class="main">∈</span> sets <span class="free">M</span><span class="main">.</span> <span class="bound">A</span> <span class="main">⊆</span> <span class="free"><span class="bound"><span class="entity">E</span></span></span> <span class="main">⟶</span> <span class="main">0</span> <span class="main">≤</span> <span class="free">μ</span> <span class="bound">A</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">neg_meas_set</span>  <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">neg_meas_set</span> <span class="free"><span class="bound"><span class="entity">E</span></span></span> <span class="main">⟷</span> <span class="free"><span class="bound"><span class="entity">E</span></span></span> <span class="main">∈</span> sets <span class="free">M</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">A</span> <span class="main">∈</span> sets <span class="free">M</span><span class="main">.</span> <span class="bound">A</span> <span class="main">⊆</span> <span class="free"><span class="bound"><span class="entity">E</span></span></span> <span class="main">⟶</span> <span class="free">μ</span> <span class="bound">A</span> <span class="main">≤</span> <span class="main">0</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Hahn_Jordan_Decomposition-pos_meas_setI"><span class="command">lemma</span></span> pos_meas_setI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">E</span> <span class="main">∈</span> sets <span class="free">M</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">A</span><span class="main">.</span> <span class="bound">A</span> <span class="main">∈</span> sets <span class="free">M</span> <span class="main">⟹</span> <span class="bound">A</span> <span class="main">⊆</span> <span class="free">E</span> <span class="main">⟹</span> <span class="main">0</span> <span class="main">≤</span> <span class="free">μ</span> <span class="bound">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"pos_meas_set <span class="free">E</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> pos_meas_set_def <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Hahn_Jordan_Decomposition-pos_meas_setD1"><span class="command">lemma</span></span> pos_meas_setD1 <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"pos_meas_set <span class="free">E</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">E</span> <span class="main">∈</span> sets <span class="free">M</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> pos_meas_set_def
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Hahn_Jordan_Decomposition-neg_meas_setD1"><span class="command">lemma</span></span> neg_meas_setD1 <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"neg_meas_set <span class="free">E</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">E</span> <span class="main">∈</span> sets <span class="free">M</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> neg_meas_set_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Hahn_Jordan_Decomposition-neg_meas_setI"><span class="command">lemma</span></span> neg_meas_setI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">E</span> <span class="main">∈</span> sets <span class="free">M</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">A</span><span class="main">.</span> <span class="bound">A</span> <span class="main">∈</span> sets <span class="free">M</span> <span class="main">⟹</span> <span class="bound">A</span> <span class="main">⊆</span> <span class="free">E</span> <span class="main">⟹</span> <span class="free">μ</span> <span class="bound">A</span> <span class="main">≤</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"neg_meas_set <span class="free">E</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> neg_meas_set_def <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Hahn_Jordan_Decomposition-pos_meas_self"><span class="command">lemma</span></span> pos_meas_self<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"pos_meas_set <span class="free">E</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="free">μ</span> <span class="free">E</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> pos_meas_set_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Hahn_Jordan_Decomposition-empty_pos_meas_set"><span class="command">lemma</span></span> empty_pos_meas_set<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"pos_meas_set <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> bot.extremum_uniqueI eq_iff pos_meas_set_def sets.empty_sets 
      sgn_meas signed_measure_empty<span class="main">)</span>

<span class="keyword1" id="Hahn_Jordan_Decomposition-empty_neg_meas_set"><span class="command">lemma</span></span> empty_neg_meas_set<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"neg_meas_set <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> neg_meas_set_def order_refl sets.empty_sets sgn_meas 
      signed_measure_empty subset_empty<span class="main">)</span>

<span class="keyword1" id="Hahn_Jordan_Decomposition-pos_measure_meas"><span class="command">lemma</span></span> pos_measure_meas<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"pos_meas_set <span class="free">E</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span><span class="main">⊆</span> <span class="free">E</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span><span class="main">∈</span> sets <span class="free">M</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="free">μ</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> pos_meas_set_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Hahn_Jordan_Decomposition-pos_meas_subset"><span class="command">lemma</span></span> pos_meas_subset<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"pos_meas_set <span class="free">A</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span><span class="main">⊆</span> <span class="free">A</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span><span class="main">∈</span> sets <span class="free">M</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"pos_meas_set <span class="free">B</span>"</span></span> <span class="keyword1"><span class="command">using</span></span>  assms pos_meas_set_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 

<span class="keyword1" id="Hahn_Jordan_Decomposition-neg_meas_subset"><span class="command">lemma</span></span> neg_meas_subset<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"neg_meas_set <span class="free">A</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span><span class="main">⊆</span> <span class="free">A</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span><span class="main">∈</span> sets <span class="free">M</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"neg_meas_set <span class="free">B</span>"</span></span> <span class="keyword1"><span class="command">using</span></span>  assms neg_meas_set_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 

<span class="keyword1" id="Hahn_Jordan_Decomposition-pos_meas_set_Union"><span class="command">lemma</span></span> pos_meas_set_Union<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="main">(</span><span class="bound">i</span><span class="main">::</span>nat<span class="main">)</span><span class="main">.</span> pos_meas_set <span class="main">(</span><span class="free">A</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="free">A</span> <span class="bound">i</span> <span class="main">∈</span> sets <span class="free">M</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="free">μ</span> <span class="main">(</span><span class="main">⋃</span> <span class="bound">i</span><span class="main">.</span> <span class="free">A</span> <span class="bound">i</span><span class="main">)</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="main">∞</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"pos_meas_set <span class="main">(</span><span class="main">⋃</span> <span class="bound">i</span><span class="main">.</span> <span class="free">A</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> pos_meas_setI<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋃</span> <span class="main">(</span>range <span class="free">A</span><span class="main">)</span> <span class="main">∈</span> sets <span class="free">M</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> sigma_algebra.countable_UN assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">B</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"disjoint_family <span class="skolem">B</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋃</span><span class="main">(</span><span class="bound">i</span><span class="main">::</span>nat<span class="main">)</span><span class="main">.</span> <span class="skolem">B</span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span><span class="main">(</span><span class="bound">i</span><span class="main">::</span>nat<span class="main">)</span><span class="main">.</span> <span class="free">A</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">B</span> <span class="bound">i</span> <span class="main">∈</span> sets <span class="free">M</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">B</span> <span class="bound">i</span> <span class="main">⊆</span> <span class="free">A</span> <span class="bound">i</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> disj_Union2 assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">C</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span> <span class="main">∈</span> sets <span class="free">M</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span><span class="main">⊆</span> <span class="main">(</span><span class="main">⋃</span> <span class="bound">i</span><span class="main">.</span> <span class="free">A</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span> <span class="main">=</span> <span class="skolem">C</span> <span class="main">∩</span> <span class="main">(</span><span class="main">⋃</span> <span class="bound">i</span><span class="main">.</span> <span class="free">A</span> <span class="bound">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="skolem">C</span> <span class="main">∩</span> <span class="main">(</span><span class="main">⋃</span> <span class="bound">i</span><span class="main">.</span> <span class="skolem">B</span> <span class="bound">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main">⋃</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">B</span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">i</span><span class="main">.</span> <span class="free">A</span> <span class="bound">i</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span> <span class="bound">i</span><span class="main">.</span> <span class="skolem">C</span> <span class="main">∩</span> <span class="skolem">B</span> <span class="bound">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span> <span class="bound">i</span><span class="main">.</span> <span class="skolem">C</span> <span class="main">∩</span> <span class="skolem">B</span> <span class="bound">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">μ</span> <span class="skolem">C</span> <span class="main">=</span> <span class="free">μ</span> <span class="main">(</span><span class="main">⋃</span> <span class="bound">i</span><span class="main">.</span> <span class="skolem">C</span> <span class="main">∩</span> <span class="skolem">B</span> <span class="bound">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">.</span> <span class="free">μ</span> <span class="main">(</span><span class="skolem">C</span> <span class="main">∩</span> <span class="main">(</span><span class="skolem">B</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> signed_measure_inf_sum<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"signed_measure <span class="free">M</span> <span class="free">μ</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> sgn_meas <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"disjoint_family <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">C</span> <span class="main">∩</span> <span class="skolem">B</span> <span class="bound">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹disjoint_family <span class="skolem">B</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> Int_iff disjoint_family_subset subset_iff<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"range <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">C</span> <span class="main">∩</span> <span class="skolem">B</span> <span class="bound">i</span><span class="main">)</span> <span class="main">⊆</span> sets <span class="free">M</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">C</span><span class="main">∈</span> sets <span class="free">M</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">B</span> <span class="bound">i</span> <span class="main">∈</span> sets <span class="free">M</span>›</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋃</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">C</span> <span class="main">∩</span> <span class="skolem">B</span> <span class="bound">i</span><span class="main">)</span> <span class="main">∈</span> sets <span class="free">M</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">C</span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span> <span class="bound">i</span><span class="main">.</span> <span class="skolem">C</span> <span class="main">∩</span> <span class="skolem">B</span> <span class="bound">i</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">C</span><span class="main">∈</span> sets <span class="free">M</span>›</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> suminf_nonneg<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="main">0</span> <span class="main">≤</span> <span class="free">μ</span> <span class="main">(</span><span class="skolem">C</span> <span class="main">∩</span> <span class="skolem">B</span> <span class="bound">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span><span class="main">∩</span> <span class="skolem">B</span> <span class="skolem">n</span> <span class="main">⊆</span> <span class="free">A</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">B</span> <span class="bound">i</span> <span class="main">⊆</span> <span class="free">A</span> <span class="bound">i</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span> <span class="main">∩</span> <span class="skolem">B</span> <span class="skolem">n</span> <span class="main">∈</span> sets <span class="free">M</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">C</span><span class="main">∈</span> sets <span class="free">M</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">B</span> <span class="bound">i</span> <span class="main">∈</span> sets <span class="free">M</span>›</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="free">μ</span> <span class="main">(</span><span class="skolem">C</span> <span class="main">∩</span> <span class="skolem">B</span> <span class="skolem">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms pos_measure_meas<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="skolem">n</span>"</span></span><span class="main">]</span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"summable <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> real_of_ereal <span class="main">(</span><span class="free">μ</span> <span class="main">(</span><span class="skolem">C</span> <span class="main">∩</span> <span class="skolem">B</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> summable_norm_cancel<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> norm <span class="main">(</span>real_of_ereal <span class="main">(</span><span class="free">μ</span> <span class="main">(</span><span class="skolem">C</span> <span class="main">∩</span> <span class="skolem">B</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
        real_of_ereal <span class="main">¦</span><span class="free">μ</span> <span class="main">(</span><span class="skolem">C</span> <span class="main">∩</span> <span class="skolem">B</span> <span class="bound">n</span><span class="main">)</span><span class="main">¦</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"summable <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> real_of_ereal <span class="main">¦</span><span class="free">μ</span> <span class="main">(</span><span class="skolem">C</span> <span class="main">∩</span> <span class="skolem">B</span> <span class="bound">i</span><span class="main">)</span><span class="main">¦</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> signed_measure_abs_convergent<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"signed_measure <span class="free">M</span> <span class="free">μ</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> sgn_meas <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"range <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">C</span> <span class="main">∩</span> <span class="skolem">B</span> <span class="bound">i</span><span class="main">)</span> <span class="main">⊆</span> sets <span class="free">M</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">C</span><span class="main">∈</span> sets <span class="free">M</span>›</span></span> 
            <span class="quoted"><span class="quoted">‹<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">B</span> <span class="bound">i</span> <span class="main">∈</span> sets <span class="free">M</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"disjoint_family <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">C</span> <span class="main">∩</span> <span class="skolem">B</span> <span class="bound">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹disjoint_family <span class="skolem">B</span>›</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> Int_iff disjoint_family_subset subset_iff<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋃</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">C</span> <span class="main">∩</span> <span class="skolem">B</span> <span class="bound">i</span><span class="main">)</span> <span class="main">∈</span> sets <span class="free">M</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">C</span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span> <span class="bound">i</span><span class="main">.</span> <span class="skolem">C</span> <span class="main">∩</span> <span class="skolem">B</span> <span class="bound">i</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">C</span><span class="main">∈</span> sets <span class="free">M</span>›</span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="free">μ</span> <span class="skolem">C</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="main">∞</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> signed_measure_finite_subset<span class="main">)</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋃</span> <span class="bound">i</span><span class="main">.</span> <span class="free">A</span> <span class="bound">i</span><span class="main">)</span> <span class="main">∈</span> sets <span class="free">M</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="free">μ</span> <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span>range <span class="free">A</span><span class="main">)</span><span class="main">)</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="main">∞</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span> <span class="main">∈</span> sets <span class="free">M</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">C</span> <span class="main">∈</span> sets <span class="free">M</span>›</span></span> <span class="keyword1"><span class="command">.</span></span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span> <span class="main">⊆</span> <span class="main">⋃</span> <span class="main">(</span>range <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">C</span> <span class="main">⊆</span> <span class="main">⋃</span> <span class="main">(</span>range <span class="free">A</span><span class="main">)</span> ›</span></span> <span class="keyword1"><span class="command">.</span></span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="free">μ</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">C</span> <span class="main">∩</span> <span class="skolem">B</span> <span class="bound">i</span><span class="main">)</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="main">∞</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">C</span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span> <span class="bound">i</span><span class="main">.</span> <span class="skolem">C</span> <span class="main">∩</span> <span class="skolem">B</span> <span class="bound">i</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"summable <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> norm <span class="main">(</span>real_of_ereal <span class="main">(</span><span class="free">μ</span> <span class="main">(</span><span class="skolem">C</span> <span class="main">∩</span> <span class="skolem">B</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"summable <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="free">μ</span> <span class="main">(</span><span class="skolem">C</span> <span class="main">∩</span> <span class="skolem">B</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="main">0</span> <span class="main">≤</span> <span class="free">μ</span> <span class="main">(</span><span class="skolem">C</span> <span class="main">∩</span> <span class="skolem">B</span> <span class="bound">n</span><span class="main">)</span>›</span></span> 
          summable_ereal_pos<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="free">μ</span> <span class="skolem">C</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Hahn_Jordan_Decomposition-pos_meas_set_pos_lim"><span class="command">lemma</span></span> pos_meas_set_pos_lim<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="main">(</span><span class="bound">i</span><span class="main">::</span>nat<span class="main">)</span><span class="main">.</span> pos_meas_set <span class="main">(</span><span class="free">A</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="free">A</span> <span class="bound">i</span> <span class="main">∈</span> sets <span class="free">M</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="free">μ</span> <span class="main">(</span><span class="main">⋃</span> <span class="bound">i</span><span class="main">.</span> <span class="free">A</span> <span class="bound">i</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">B</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"disjoint_family <span class="skolem">B</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋃</span><span class="main">(</span><span class="bound">i</span><span class="main">::</span>nat<span class="main">)</span><span class="main">.</span> <span class="skolem">B</span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span><span class="main">(</span><span class="bound">i</span><span class="main">::</span>nat<span class="main">)</span><span class="main">.</span> <span class="free">A</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">B</span> <span class="bound">i</span> <span class="main">∈</span> sets <span class="free">M</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">B</span> <span class="bound">i</span> <span class="main">⊆</span> <span class="free">A</span> <span class="bound">i</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> disj_Union2 assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">note</span></span> Bprops <span class="main">=</span> this
  <span class="keyword1"><span class="command">have</span></span> sums<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">μ</span> <span class="main">(</span><span class="skolem">B</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">sums</span> <span class="free">μ</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">B</span> <span class="bound">i</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> signed_measure_sums<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"signed_measure <span class="free">M</span> <span class="free">μ</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> sgn_meas <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"range <span class="skolem">B</span> <span class="main">⊆</span> sets <span class="free">M</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Bprops <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"disjoint_family <span class="skolem">B</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Bprops <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋃</span> <span class="main">(</span>range <span class="skolem">B</span><span class="main">)</span> <span class="main">∈</span> sets <span class="free">M</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Bprops <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"summable <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">μ</span> <span class="main">(</span><span class="skolem">B</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> sums_summable<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">μ</span> <span class="main">(</span><span class="skolem">B</span> <span class="bound">n</span><span class="main">)</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"suminf <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">μ</span> <span class="main">(</span><span class="skolem">B</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">μ</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">B</span> <span class="bound">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> sums sums_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> suminf_nonneg
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Bprops<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> Bprops<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> Bprops<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹summable <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">μ</span> <span class="main">(</span><span class="skolem">B</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span>›</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> 
        pos_measure_meas<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Hahn_Jordan_Decomposition-pos_meas_disj_union"><span class="command">lemma</span></span> pos_meas_disj_union<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"pos_meas_set <span class="free">A</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"pos_meas_set <span class="free">B</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span><span class="main">∩</span> <span class="free">B</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"pos_meas_set <span class="main">(</span><span class="free">A</span> <span class="main">∪</span> <span class="free">B</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> pos_meas_set_def
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> conjI ballI impI<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span><span class="main">∪</span> <span class="free">B</span> <span class="main">∈</span> sets <span class="free">M</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> pos_meas_set_def sets.Un<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">C</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span><span class="main">∈</span> sets <span class="free">M</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span><span class="main">⊆</span> <span class="free">A</span><span class="main">∪</span> <span class="free">B</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">DA</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">DA</span> <span class="main">=</span> <span class="skolem">C</span><span class="main">∩</span> <span class="free">A</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">DB</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">DB</span> <span class="main">=</span> <span class="skolem">C</span><span class="main">∩</span> <span class="free">B</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">DA</span><span class="main">∈</span> sets <span class="free">M</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> DA_def <span class="quoted"><span class="quoted">‹<span class="skolem">C</span> <span class="main">∈</span> sets <span class="free">M</span>›</span></span> assms<span class="main">(</span>1<span class="main">)</span> pos_meas_set_def 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">DB</span><span class="main">∈</span> sets <span class="free">M</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> DB_def <span class="quoted"><span class="quoted">‹<span class="skolem">C</span> <span class="main">∈</span> sets <span class="free">M</span>›</span></span> assms<span class="main">(</span>2<span class="main">)</span> pos_meas_set_def 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">DA</span> <span class="main">∩</span> <span class="skolem">DB</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> DA_def DB_def <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span> <span class="main">=</span> <span class="skolem">DA</span> <span class="main">∪</span> <span class="skolem">DB</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> DA_def DB_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">C</span><span class="main">⊆</span> <span class="free">A</span><span class="main">∪</span> <span class="free">B</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="free">μ</span> <span class="skolem">DB</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> DB_def pos_meas_set_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span>  DB_def Int_lower2<span class="quoted"><span class="quoted">‹<span class="skolem">DB</span> <span class="main">∈</span> sets <span class="free">M</span>›</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">μ</span> <span class="skolem">DA</span> <span class="main">+</span> <span class="free">μ</span> <span class="skolem">DB</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span>  pos_meas_set_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> DA_def Diff_Diff_Int Diff_subset Int_commute <span class="quoted"><span class="quoted">‹<span class="skolem">DA</span> <span class="main">∈</span> sets <span class="free">M</span>›</span></span> 
        ereal_le_add_self2<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">μ</span> <span class="skolem">C</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> signed_measure_add sgn_meas <span class="quoted"><span class="quoted">‹<span class="skolem">DA</span> <span class="main">∈</span> sets <span class="free">M</span>›</span></span> 
      <span class="quoted"><span class="quoted">‹<span class="skolem">DB</span> <span class="main">∈</span> sets <span class="free">M</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">DA</span> <span class="main">∩</span> <span class="skolem">DB</span> <span class="main">=</span> <span class="main">{}</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">C</span> <span class="main">=</span> <span class="skolem">DA</span> <span class="main">∪</span> <span class="skolem">DB</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="free">μ</span> <span class="skolem">C</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Hahn_Jordan_Decomposition-pos_meas_set_union"><span class="command">lemma</span></span> pos_meas_set_union<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"pos_meas_set <span class="free">A</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"pos_meas_set <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"pos_meas_set <span class="main">(</span><span class="free">A</span> <span class="main">∪</span> <span class="free">B</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">C</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span> <span class="main">=</span> <span class="free">B</span> <span class="main">-</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span><span class="main">∪</span> <span class="skolem">C</span> <span class="main">=</span> <span class="free">A</span><span class="main">∪</span> <span class="free">B</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> C_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"pos_meas_set <span class="main">(</span><span class="free">A</span><span class="main">∪</span> <span class="skolem">C</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> pos_meas_disj_union<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"pos_meas_set <span class="skolem">C</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> C_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> Diff_subset assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> sets.Diff 
          signed_measure_space.pos_meas_set_def 
          signed_measure_space.pos_meas_subset signed_measure_space_axioms<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"pos_meas_set <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">∩</span> <span class="skolem">C</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> C_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Hahn_Jordan_Decomposition-neg_meas_disj_union"><span class="command">lemma</span></span> neg_meas_disj_union<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"neg_meas_set <span class="free">A</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"neg_meas_set <span class="free">B</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span><span class="main">∩</span> <span class="free">B</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"neg_meas_set <span class="main">(</span><span class="free">A</span> <span class="main">∪</span> <span class="free">B</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> neg_meas_set_def
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> conjI ballI impI<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span><span class="main">∪</span> <span class="free">B</span> <span class="main">∈</span> sets <span class="free">M</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> neg_meas_set_def sets.Un<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">C</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span><span class="main">∈</span> sets <span class="free">M</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span><span class="main">⊆</span> <span class="free">A</span><span class="main">∪</span> <span class="free">B</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">DA</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">DA</span> <span class="main">=</span> <span class="skolem">C</span><span class="main">∩</span> <span class="free">A</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">DB</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">DB</span> <span class="main">=</span> <span class="skolem">C</span><span class="main">∩</span> <span class="free">B</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">DA</span><span class="main">∈</span> sets <span class="free">M</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> DA_def <span class="quoted"><span class="quoted">‹<span class="skolem">C</span> <span class="main">∈</span> sets <span class="free">M</span>›</span></span> assms<span class="main">(</span>1<span class="main">)</span> neg_meas_set_def 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">DB</span><span class="main">∈</span> sets <span class="free">M</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> DB_def <span class="quoted"><span class="quoted">‹<span class="skolem">C</span> <span class="main">∈</span> sets <span class="free">M</span>›</span></span> assms<span class="main">(</span>2<span class="main">)</span> neg_meas_set_def 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">DA</span> <span class="main">∩</span> <span class="skolem">DB</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> DA_def DB_def <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span> <span class="main">=</span> <span class="skolem">DA</span> <span class="main">∪</span> <span class="skolem">DB</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> DA_def DB_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">C</span><span class="main">⊆</span> <span class="free">A</span><span class="main">∪</span> <span class="free">B</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">μ</span> <span class="skolem">C</span> <span class="main">=</span> <span class="free">μ</span> <span class="skolem">DA</span> <span class="main">+</span> <span class="free">μ</span> <span class="skolem">DB</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> signed_measure_add sgn_meas <span class="quoted"><span class="quoted">‹<span class="skolem">DA</span> <span class="main">∈</span> sets <span class="free">M</span>›</span></span> 
      <span class="quoted"><span class="quoted">‹<span class="skolem">DB</span> <span class="main">∈</span> sets <span class="free">M</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">DA</span> <span class="main">∩</span> <span class="skolem">DB</span> <span class="main">=</span> <span class="main">{}</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">C</span> <span class="main">=</span> <span class="skolem">DA</span> <span class="main">∪</span> <span class="skolem">DB</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">μ</span> <span class="skolem">DB</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span>  neg_meas_set_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> DA_def Int_lower2 <span class="quoted"><span class="quoted">‹<span class="skolem">DA</span> <span class="main">∈</span> sets <span class="free">M</span>›</span></span> add_decreasing dual_order.refl<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> DB_def neg_meas_set_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span>  DB_def Int_lower2<span class="quoted"><span class="quoted">‹<span class="skolem">DB</span> <span class="main">∈</span> sets <span class="free">M</span>›</span></span><span class="main">)</span> 
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">μ</span> <span class="skolem">C</span> <span class="main">≤</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Hahn_Jordan_Decomposition-neg_meas_set_union"><span class="command">lemma</span></span> neg_meas_set_union<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"neg_meas_set <span class="free">A</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"neg_meas_set <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"neg_meas_set <span class="main">(</span><span class="free">A</span> <span class="main">∪</span> <span class="free">B</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">C</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span> <span class="main">=</span> <span class="free">B</span> <span class="main">-</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span><span class="main">∪</span> <span class="skolem">C</span> <span class="main">=</span> <span class="free">A</span><span class="main">∪</span> <span class="free">B</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> C_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"neg_meas_set <span class="main">(</span><span class="free">A</span><span class="main">∪</span> <span class="skolem">C</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> neg_meas_disj_union<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"neg_meas_set <span class="skolem">C</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> C_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> Diff_subset assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> sets.Diff neg_meas_set_def 
          neg_meas_subset signed_measure_space_axioms<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"neg_meas_set <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">∩</span> <span class="skolem">C</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> C_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Hahn_Jordan_Decomposition-neg_meas_self"><span class="command">lemma</span></span> neg_meas_self <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"neg_meas_set <span class="free">E</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">μ</span> <span class="free">E</span> <span class="main">≤</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> neg_meas_set_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Hahn_Jordan_Decomposition-pos_meas_set_opp"><span class="command">lemma</span></span> pos_meas_set_opp<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"signed_measure_space.pos_meas_set  <span class="free">M</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">A</span><span class="main">.</span> <span class="main">-</span> <span class="free">μ</span> <span class="bound">A</span><span class="main">)</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"neg_meas_set <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
  <span class="keyword1"><span class="command">have</span></span> m_meas_pos <span class="main">:</span> <span class="quoted"><span class="quoted">"signed_measure <span class="free">M</span>  <span class="main">(</span><span class="main">λ</span> <span class="bound">A</span><span class="main">.</span> <span class="main">-</span> <span class="free">μ</span> <span class="bound">A</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms signed_measure_space_def 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sgn_meas signed_measure_minus<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms ereal_0_le_uminus_iff neg_meas_setI 
        signed_measure_space.intro signed_measure_space.pos_meas_set_def<span class="main">)</span> 
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Hahn_Jordan_Decomposition-neg_meas_set_opp"><span class="command">lemma</span></span> neg_meas_set_opp<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"signed_measure_space.neg_meas_set <span class="free">M</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">A</span><span class="main">.</span> <span class="main">-</span> <span class="free">μ</span> <span class="bound">A</span><span class="main">)</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"pos_meas_set <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> m_meas_neg <span class="main">:</span> <span class="quoted"><span class="quoted">"signed_measure <span class="free">M</span>  <span class="main">(</span><span class="main">λ</span> <span class="bound">A</span><span class="main">.</span> <span class="main">-</span> <span class="free">μ</span> <span class="bound">A</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms signed_measure_space_def 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sgn_meas signed_measure_minus<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms ereal_uminus_le_0_iff m_meas_neg pos_meas_setI 
        signed_measure_space.intro signed_measure_space.neg_meas_set_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1" id="Hahn_Jordan_Decomposition-signed_measure_inter"><span class="command">lemma</span></span> signed_measure_inter<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"signed_measure <span class="free">M</span> <span class="free">μ</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">∈</span> sets <span class="free">M</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"signed_measure <span class="free">M</span> <span class="main">(</span><span class="main">λ</span><span class="bound">E</span><span class="main">.</span> <span class="free">μ</span> <span class="main">(</span><span class="bound">E</span> <span class="main">∩</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> signed_measure_def
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> conjI<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">μ</span> <span class="main">(</span><span class="main">{}</span> <span class="main">∩</span> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> signed_measure_empty <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="main">∞</span> <span class="main">∉</span> range <span class="main">(</span><span class="main">λ</span><span class="bound">E</span><span class="main">.</span> <span class="free">μ</span> <span class="main">(</span><span class="bound">E</span> <span class="main">∩</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span> <span class="main">∞</span> <span class="main">∉</span> range <span class="main">(</span><span class="main">λ</span><span class="bound">E</span><span class="main">.</span> <span class="free">μ</span> <span class="main">(</span><span class="bound">E</span> <span class="main">∩</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">-</span> <span class="main">∞</span> <span class="main">∉</span> range <span class="main">(</span><span class="main">λ</span><span class="bound">E</span><span class="main">.</span> <span class="free">μ</span> <span class="main">(</span><span class="bound">E</span> <span class="main">∩</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span> <span class="main">∞</span> <span class="main">∉</span> range <span class="main">(</span><span class="main">λ</span><span class="bound">E</span><span class="main">.</span> <span class="free">μ</span> <span class="main">(</span><span class="bound">E</span> <span class="main">∩</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="main">∞</span> <span class="main">∈</span> range <span class="main">(</span><span class="main">λ</span><span class="bound">E</span><span class="main">.</span> <span class="free">μ</span> <span class="main">(</span><span class="bound">E</span> <span class="main">∩</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">∞</span> <span class="main">∈</span> range <span class="main">(</span><span class="main">λ</span><span class="bound">E</span><span class="main">.</span> <span class="free">μ</span> <span class="main">(</span><span class="bound">E</span> <span class="main">∩</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="main">∞</span> <span class="main">∈</span> range <span class="free">μ</span> <span class="main">∧</span> <span class="main">∞</span> <span class="main">∈</span> range <span class="free">μ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> signed_measure_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">E</span><span class="main">.</span> range <span class="bound">E</span> <span class="main">⊆</span> sets <span class="free">M</span> <span class="main">⟶</span> disjoint_family <span class="bound">E</span> <span class="main">⟶</span> <span class="main">⋃</span> <span class="main">(</span>range <span class="bound">E</span><span class="main">)</span> <span class="main">∈</span> sets <span class="free">M</span> <span class="main">⟶</span> 
    <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="free">μ</span> <span class="main">(</span><span class="bound">E</span> <span class="bound">i</span> <span class="main">∩</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">sums</span> <span class="free">μ</span> <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span>range <span class="bound">E</span><span class="main">)</span> <span class="main">∩</span> <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> allI impI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">E</span><span class="main">::</span><span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'a</span> set"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"range <span class="skolem">E</span> <span class="main">⊆</span> sets <span class="free">M</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"disjoint_family <span class="skolem">E</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋃</span> <span class="main">(</span>range <span class="skolem">E</span><span class="main">)</span> <span class="main">∈</span> sets <span class="free">M</span>"</span></span> 
    <span class="keyword1"><span class="command">note</span></span> Eprops <span class="main">=</span> this
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">F</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">E</span> <span class="bound">i</span> <span class="main">∩</span> <span class="free">A</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="free">μ</span> <span class="main">(</span><span class="skolem">F</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">sums</span> <span class="free">μ</span> <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span>range <span class="skolem">F</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> signed_measure_sums<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"signed_measure <span class="free">M</span> <span class="free">μ</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"range <span class="skolem">F</span> <span class="main">⊆</span> sets <span class="free">M</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Eprops F_def assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"disjoint_family <span class="skolem">F</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Eprops F_def assms
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> disjoint_family_subset inf.absorb_iff2 inf_commute 
            inf_right_idem<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋃</span> <span class="main">(</span>range <span class="skolem">F</span><span class="main">)</span> <span class="main">∈</span> sets <span class="free">M</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Eprops assms <span class="keyword1"><span class="command">unfolding</span></span> F_def
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Eprops assms countable_Un_Int<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> sets.Int<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋃</span> <span class="main">(</span>range <span class="skolem">F</span><span class="main">)</span> <span class="main">=</span> <span class="free">A</span> <span class="main">∩</span> <span class="main">⋃</span> <span class="main">(</span>range <span class="skolem">E</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> F_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>   
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="free">μ</span> <span class="main">(</span><span class="skolem">E</span> <span class="bound">i</span> <span class="main">∩</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">sums</span> <span class="free">μ</span> <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span>range <span class="skolem">E</span><span class="main">)</span> <span class="main">∩</span> <span class="free">A</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> F_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">E</span><span class="main">.</span> range <span class="bound">E</span> <span class="main">⊆</span> sets <span class="free">M</span> <span class="main">⟶</span>
         disjoint_family <span class="bound">E</span> <span class="main">⟶</span>
         <span class="main">⋃</span> <span class="main">(</span>range <span class="bound">E</span><span class="main">)</span> <span class="main">∈</span> sets <span class="free">M</span> <span class="main">⟶</span> <span class="main">¦</span><span class="free">μ</span> <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span>range <span class="bound">E</span><span class="main">)</span> <span class="main">∩</span> <span class="free">A</span><span class="main">)</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="main">∞</span> <span class="main">⟶</span> 
         summable <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> real_of_ereal <span class="main">¦</span><span class="free">μ</span> <span class="main">(</span><span class="bound">E</span> <span class="bound">i</span> <span class="main">∩</span> <span class="free">A</span><span class="main">)</span><span class="main">¦</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> allI impI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">E</span><span class="main">::</span><span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'a</span> set"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"range <span class="skolem">E</span> <span class="main">⊆</span> sets <span class="free">M</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"disjoint_family <span class="skolem">E</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
      <span class="quoted"><span class="quoted">"<span class="main">⋃</span> <span class="main">(</span>range <span class="skolem">E</span><span class="main">)</span> <span class="main">∈</span> sets <span class="free">M</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="free">μ</span> <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span>range <span class="skolem">E</span><span class="main">)</span> <span class="main">∩</span> <span class="free">A</span><span class="main">)</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="main">∞</span>"</span></span> <span class="keyword1"><span class="command">note</span></span> Eprops <span class="main">=</span> this
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"summable <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> real_of_ereal <span class="main">¦</span><span class="free">μ</span> <span class="main">(</span><span class="skolem">E</span> <span class="bound">i</span> <span class="main">∩</span> <span class="free">A</span><span class="main">)</span><span class="main">¦</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> signed_measure_summable<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"signed_measure <span class="free">M</span> <span class="free">μ</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"range <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">E</span> <span class="bound">i</span> <span class="main">∩</span> <span class="free">A</span><span class="main">)</span> <span class="main">⊆</span> sets <span class="free">M</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Eprops assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"disjoint_family <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">E</span> <span class="bound">i</span> <span class="main">∩</span> <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Eprops assms 
          disjoint_family_subset inf.absorb_iff2 inf_commute inf_right_idem 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋃</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">E</span> <span class="bound">i</span> <span class="main">∩</span> <span class="free">A</span><span class="main">)</span> <span class="main">∈</span> sets <span class="free">M</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Eprops assms 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Eprops assms countable_Un_Int<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> sets.Int<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="free">μ</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">E</span> <span class="bound">i</span> <span class="main">∩</span> <span class="free">A</span><span class="main">)</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="main">∞</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Eprops <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">context</span></span> signed_measure_space
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1" id="Hahn_Jordan_Decomposition-pos_signed_to_meas_space"><span class="command">lemma</span></span> pos_signed_to_meas_space <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"pos_meas_set <span class="free">M1</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">m1</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">A</span><span class="main">.</span> <span class="free">μ</span> <span class="main">(</span><span class="bound">A</span> <span class="main">∩</span> <span class="free">M1</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"measure_space <span class="main">(</span>space <span class="free">M</span><span class="main">)</span> <span class="main">(</span>sets <span class="free">M</span><span class="main">)</span> <span class="free">m1</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> measure_space_def
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> conjI<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"sigma_algebra <span class="main">(</span>space <span class="free">M</span><span class="main">)</span> <span class="main">(</span>sets <span class="free">M</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sets.sigma_algebra_axioms<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"positive <span class="main">(</span>sets <span class="free">M</span><span class="main">)</span> <span class="free">m1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> pos_meas_set_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Sigma_Algebra.positive_def Un_Int_eq<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> 
        e2ennreal_neg neg_meas_self sup_bot_right empty_neg_meas_set<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"countably_additive <span class="main">(</span>sets <span class="free">M</span><span class="main">)</span> <span class="free">m1</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> pos_signed_measure_count_additive<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">E</span><span class="main">∈</span>sets <span class="free">M</span><span class="main">.</span> <span class="main">0</span> <span class="main">≤</span> <span class="free">m1</span> <span class="bound">E</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms inf.cobounded2 
          pos_meas_set_def sets.Int<span class="main">)</span> 
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"signed_measure <span class="free">M</span> <span class="free">m1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms pos_meas_set_def 
        signed_measure_inter<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">M</span></span> <span class="quoted"><span class="free">μ</span></span> <span class="quoted"><span class="free">M1</span></span><span class="main">]</span> sgn_meas <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Hahn_Jordan_Decomposition-neg_signed_to_meas_space"><span class="command">lemma</span></span> neg_signed_to_meas_space <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"neg_meas_set <span class="free">M2</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">m2</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">A</span><span class="main">.</span> <span class="main">-</span><span class="free">μ</span> <span class="main">(</span><span class="bound">A</span> <span class="main">∩</span> <span class="free">M2</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"measure_space <span class="main">(</span>space <span class="free">M</span><span class="main">)</span> <span class="main">(</span>sets <span class="free">M</span><span class="main">)</span> <span class="free">m2</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> measure_space_def
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> conjI<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"sigma_algebra <span class="main">(</span>space <span class="free">M</span><span class="main">)</span> <span class="main">(</span>sets <span class="free">M</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sets.sigma_algebra_axioms<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"positive <span class="main">(</span>sets <span class="free">M</span><span class="main">)</span> <span class="free">m2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> neg_meas_set_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Sigma_Algebra.positive_def e2ennreal_neg ereal_uminus_zero 
        inf.absorb_iff2 inf.orderE inf_bot_right neg_meas_self pos_meas_self 
        empty_neg_meas_set empty_pos_meas_set<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"countably_additive <span class="main">(</span>sets <span class="free">M</span><span class="main">)</span> <span class="free">m2</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> pos_signed_measure_count_additive<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">E</span><span class="main">∈</span>sets <span class="free">M</span><span class="main">.</span> <span class="main">0</span> <span class="main">≤</span> <span class="free">m2</span> <span class="bound">E</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms ereal_uminus_eq_reorder ereal_uminus_le_0_iff 
          inf.cobounded2 neg_meas_set_def sets.Int<span class="main">)</span> 
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"signed_measure <span class="free">M</span> <span class="main">(</span><span class="main">λ</span><span class="bound">A</span><span class="main">.</span> <span class="free">μ</span> <span class="main">(</span><span class="bound">A</span> <span class="main">∩</span> <span class="free">M2</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms neg_meas_set_def
        signed_measure_inter<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">M</span></span> <span class="quoted"><span class="free">μ</span></span> <span class="quoted"><span class="free">M2</span></span><span class="main">]</span> sgn_meas <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"signed_measure <span class="free">M</span> <span class="free">m2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> signed_measure_minus assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Hahn_Jordan_Decomposition-pos_part_meas_nul_neg_set"><span class="command">lemma</span></span> pos_part_meas_nul_neg_set <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"pos_meas_set <span class="free">M1</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"neg_meas_set <span class="free">M2</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">m1</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">A</span><span class="main">.</span> <span class="free">μ</span> <span class="main">(</span><span class="bound">A</span> <span class="main">∩</span> <span class="free">M1</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">E</span> <span class="main">∈</span> sets <span class="free">M</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">E</span> <span class="main">⊆</span> <span class="free">M2</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">m1</span> <span class="free">E</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">m1</span> <span class="free">E</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> pos_meas_set_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="free">E</span> <span class="main">∈</span> sets <span class="free">M</span>›</span></span> sets.Int<span class="main">)</span> 
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">μ</span> <span class="free">E</span> <span class="main">≤</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">E</span> <span class="main">⊆</span> <span class="free">M2</span>›</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> neg_meas_set_def
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">E</span> <span class="main">∈</span> sets <span class="free">M</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">m1</span> <span class="free">E</span> <span class="main">≤</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">μ</span> <span class="free">E</span> <span class="main">≤</span> <span class="main">0</span>›</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Int_Un_eq<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> Un_subset_iff <span class="quoted"><span class="quoted">‹<span class="free">E</span> <span class="main">∈</span> sets <span class="free">M</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">E</span> <span class="main">⊆</span> <span class="free">M2</span>›</span></span> pos_meas_setD1 
        sets.Int signed_measure_space.neg_meas_set_def 
        signed_measure_space_axioms<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">m1</span> <span class="free">E</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">m1</span> <span class="free">E</span> <span class="main">≥</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">m1</span> <span class="free">E</span> <span class="main">≤</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Hahn_Jordan_Decomposition-neg_part_meas_nul_pos_set"><span class="command">lemma</span></span> neg_part_meas_nul_pos_set <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"pos_meas_set <span class="free">M1</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"neg_meas_set <span class="free">M2</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">m2</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">A</span><span class="main">.</span> <span class="main">-</span><span class="free">μ</span> <span class="main">(</span><span class="bound">A</span> <span class="main">∩</span> <span class="free">M2</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">E</span> <span class="main">∈</span> sets <span class="free">M</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">E</span> <span class="main">⊆</span> <span class="free">M1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">m2</span> <span class="free">E</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">m2</span> <span class="free">E</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> neg_meas_set_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="free">E</span> <span class="main">∈</span> sets <span class="free">M</span>›</span></span> sets.Int<span class="main">)</span> 
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">μ</span> <span class="free">E</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span>  assms <span class="keyword1"><span class="command">unfolding</span></span> pos_meas_set_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">m2</span> <span class="free">E</span> <span class="main">≤</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">μ</span> <span class="free">E</span> <span class="main">≥</span> <span class="main">0</span>›</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="free">E</span> <span class="main">∈</span> sets <span class="free">M</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">E</span> <span class="main">⊆</span> <span class="free">M1</span>›</span></span> ereal_0_le_uminus_iff ereal_uminus_uminus 
        inf_sup_ord<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> neg_meas_setD1 pos_meas_set_def pos_meas_subset 
        sets.Int<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">m2</span> <span class="free">E</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">m2</span> <span class="free">E</span> <span class="main">≥</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">m2</span> <span class="free">E</span> <span class="main">≤</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">pos_sets</span> <span class="keyword2"><span class="keyword">where</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free">pos_sets</span> <span class="main">=</span> <span class="main">{</span><span class="bound">A</span><span class="main">.</span> <span class="bound">A</span> <span class="main">∈</span> sets <span class="free">M</span>   <span class="main">∧</span> pos_meas_set <span class="bound">A</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">pos_img</span> <span class="keyword2"><span class="keyword">where</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free">pos_img</span> <span class="main">=</span> <span class="main">{</span><span class="free">μ</span> <span class="bound">A</span><span class="main">|</span><span class="bound">A</span><span class="main">.</span> <span class="bound">A</span><span class="main">∈</span> pos_sets<span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Essential uniqueness›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹In this part, under the assumption that a measure space for a signed measure admits a
decomposition into a positive and a negative set, we prove that this decomposition is
essentially unique; in other words, that if two such decompositions $(P,N)$ and $(X,Y)$ exist, 
then any measurable subset of $(P\triangle X) \cup (N \triangle Y)$ has a null measure.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">hahn_space_decomp</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">hahn_space_decomp</span> <span class="free"><span class="bound"><span class="entity">M1</span></span></span> <span class="free"><span class="bound"><span class="entity">M2</span></span></span> <span class="main">≡</span> <span class="main">(</span>pos_meas_set <span class="free"><span class="bound"><span class="entity">M1</span></span></span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>neg_meas_set <span class="free"><span class="bound"><span class="entity">M2</span></span></span><span class="main">)</span> <span class="main">∧</span> 
<span class="main">(</span>space <span class="free">M</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">M1</span></span></span> <span class="main">∪</span> <span class="free"><span class="bound"><span class="entity">M2</span></span></span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">M1</span></span></span> <span class="main">∩</span> <span class="free"><span class="bound"><span class="entity">M2</span></span></span> <span class="main">=</span> <span class="main">{}</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Hahn_Jordan_Decomposition-pos_neg_null_set"><span class="command">lemma</span></span> pos_neg_null_set<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"pos_meas_set <span class="free">A</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"neg_meas_set <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">μ</span> <span class="free">A</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms pos_meas_self<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span><span class="main">]</span> neg_meas_self<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Hahn_Jordan_Decomposition-pos_diff_neg_meas_set"><span class="command">lemma</span></span> pos_diff_neg_meas_set<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>pos_meas_set <span class="free">M1</span><span class="main">)</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>neg_meas_set <span class="free">N2</span><span class="main">)</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>space <span class="free">M</span> <span class="main">=</span> <span class="free">N1</span> <span class="main">∪</span> <span class="free">N2</span><span class="main">)</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">N1</span> <span class="main">∈</span> sets <span class="free">M</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"neg_meas_set <span class="main">(</span><span class="main">(</span><span class="free">M1</span> <span class="main">-</span> <span class="free">N1</span><span class="main">)</span> <span class="main">∩</span> space <span class="free">M</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms neg_meas_subset
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Diff_subset_conv Int_lower2 pos_meas_setD1 sets.Diff 
      sets.Int_space_eq2<span class="main">)</span>

<span class="keyword1" id="Hahn_Jordan_Decomposition-neg_diff_pos_meas_set"><span class="command">lemma</span></span> neg_diff_pos_meas_set<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>neg_meas_set <span class="free">M2</span><span class="main">)</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>pos_meas_set <span class="free">N1</span><span class="main">)</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>space <span class="free">M</span> <span class="main">=</span> <span class="free">N1</span> <span class="main">∪</span> <span class="free">N2</span><span class="main">)</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">N2</span> <span class="main">∈</span> sets <span class="free">M</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"pos_meas_set <span class="main">(</span><span class="main">(</span><span class="free">M2</span> <span class="main">-</span> <span class="free">N2</span><span class="main">)</span> <span class="main">∩</span> space <span class="free">M</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">M2</span> <span class="main">-</span> <span class="free">N2</span><span class="main">)</span> <span class="main">∩</span> space <span class="free">M</span> <span class="main">⊆</span> <span class="free">N1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms pos_meas_subset neg_meas_setD1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Hahn_Jordan_Decomposition-pos_sym_diff_neg_meas_set"><span class="command">lemma</span></span> pos_sym_diff_neg_meas_set<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"hahn_space_decomp <span class="free">M1</span> <span class="free">M2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"hahn_space_decomp <span class="free">N1</span> <span class="free">N2</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"neg_meas_set <span class="main">(</span><span class="main">(</span>sym_diff <span class="free">M1</span> <span class="free">N1</span><span class="main">)</span> <span class="main">∩</span> space <span class="free">M</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms 
  <span class="keyword1"><span class="command">unfolding</span></span> hahn_space_decomp_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Int_Un_distrib2 neg_meas_set_union pos_meas_setD1 
      pos_diff_neg_meas_set<span class="main">)</span> 

<span class="keyword1" id="Hahn_Jordan_Decomposition-neg_sym_diff_pos_meas_set"><span class="command">lemma</span></span> neg_sym_diff_pos_meas_set<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"hahn_space_decomp <span class="free">M1</span> <span class="free">M2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"hahn_space_decomp <span class="free">N1</span> <span class="free">N2</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"pos_meas_set <span class="main">(</span><span class="main">(</span>sym_diff <span class="free">M2</span> <span class="free">N2</span><span class="main">)</span> <span class="main">∩</span> space <span class="free">M</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms 
    neg_diff_pos_meas_set <span class="keyword1"><span class="command">unfolding</span></span> hahn_space_decomp_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Int_Un_distrib2 neg_meas_setD1 
      pos_meas_set_union<span class="main">)</span>

<span class="keyword1" id="Hahn_Jordan_Decomposition-pos_meas_set_diff"><span class="command">lemma</span></span> pos_meas_set_diff<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"pos_meas_set <span class="free">A</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span><span class="main">∈</span> sets <span class="free">M</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"pos_meas_set <span class="main">(</span><span class="main">(</span><span class="free">A</span> <span class="main">-</span> <span class="free">B</span><span class="main">)</span> <span class="main">∩</span> <span class="main">(</span>space <span class="free">M</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> pos_meas_subset
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Diff_subset assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> pos_meas_setD1 sets.Diff 
      sets.Int_space_eq2<span class="main">)</span>

<span class="keyword1" id="Hahn_Jordan_Decomposition-pos_meas_set_sym_diff"><span class="command">lemma</span></span> pos_meas_set_sym_diff<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"pos_meas_set <span class="free">A</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"pos_meas_set <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"pos_meas_set <span class="main">(</span><span class="main">(</span>sym_diff <span class="free">A</span> <span class="free">B</span><span class="main">)</span> <span class="main">∩</span> space <span class="free">M</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> pos_meas_set_diff
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Int_Un_distrib2 assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> pos_meas_setD1 
      pos_meas_set_union<span class="main">)</span>

<span class="keyword1" id="Hahn_Jordan_Decomposition-neg_meas_set_diff"><span class="command">lemma</span></span> neg_meas_set_diff<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"neg_meas_set <span class="free">A</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span><span class="main">∈</span> sets <span class="free">M</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"neg_meas_set <span class="main">(</span><span class="main">(</span><span class="free">A</span> <span class="main">-</span> <span class="free">B</span><span class="main">)</span> <span class="main">∩</span> <span class="main">(</span>space <span class="free">M</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> neg_meas_subset
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Diff_subset assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> neg_meas_setD1 sets.Diff 
      sets.Int_space_eq2<span class="main">)</span>

<span class="keyword1" id="Hahn_Jordan_Decomposition-neg_meas_set_sym_diff"><span class="command">lemma</span></span> neg_meas_set_sym_diff<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"neg_meas_set <span class="free">A</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"neg_meas_set <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"neg_meas_set <span class="main">(</span><span class="main">(</span>sym_diff <span class="free">A</span> <span class="free">B</span><span class="main">)</span> <span class="main">∩</span> space <span class="free">M</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> neg_meas_set_diff
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Int_Un_distrib2 assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> neg_meas_setD1 
      neg_meas_set_union<span class="main">)</span>

<span class="keyword1" id="Hahn_Jordan_Decomposition-hahn_decomp_space_diff"><span class="command">lemma</span></span> hahn_decomp_space_diff<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"hahn_space_decomp <span class="free">M1</span> <span class="free">M2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"hahn_space_decomp <span class="free">N1</span> <span class="free">N2</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"pos_meas_set <span class="main">(</span><span class="main">(</span>sym_diff <span class="free">M1</span> <span class="free">N1</span> <span class="main">∪</span> sym_diff <span class="free">M2</span> <span class="free">N2</span><span class="main">)</span> <span class="main">∩</span> space <span class="free">M</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"neg_meas_set <span class="main">(</span><span class="main">(</span>sym_diff <span class="free">M1</span> <span class="free">N1</span> <span class="main">∪</span> sym_diff <span class="free">M2</span> <span class="free">N2</span><span class="main">)</span> <span class="main">∩</span> space <span class="free">M</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"pos_meas_set <span class="main">(</span><span class="main">(</span>sym_diff <span class="free">M1</span> <span class="free">N1</span> <span class="main">∪</span> sym_diff <span class="free">M2</span> <span class="free">N2</span><span class="main">)</span> <span class="main">∩</span> space <span class="free">M</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Int_Un_distrib2 assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> hahn_space_decomp_def 
        neg_sym_diff_pos_meas_set pos_meas_set_sym_diff pos_meas_set_union<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"neg_meas_set <span class="main">(</span><span class="main">(</span>sym_diff <span class="free">M1</span> <span class="free">N1</span> <span class="main">∪</span> sym_diff <span class="free">M2</span> <span class="free">N2</span><span class="main">)</span> <span class="main">∩</span> space <span class="free">M</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Int_Un_distrib2 assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> hahn_space_decomp_def 
        neg_meas_set_sym_diff neg_meas_set_union pos_sym_diff_neg_meas_set<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Hahn_Jordan_Decomposition-hahn_decomp_ess_unique"><span class="command">lemma</span></span> hahn_decomp_ess_unique<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"hahn_space_decomp <span class="free">M1</span> <span class="free">M2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"hahn_space_decomp <span class="free">N1</span> <span class="free">N2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">C</span> <span class="main">⊆</span> sym_diff <span class="free">M1</span> <span class="free">N1</span> <span class="main">∪</span> sym_diff <span class="free">M2</span> <span class="free">N2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">C</span><span class="main">∈</span> sets <span class="free">M</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">μ</span> <span class="free">C</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">C</span><span class="main">⊆</span> <span class="main">(</span>sym_diff <span class="free">M1</span> <span class="free">N1</span> <span class="main">∪</span> sym_diff <span class="free">M2</span> <span class="free">N2</span><span class="main">)</span> <span class="main">∩</span> space <span class="free">M</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sets.sets_into_space<span class="main">)</span>     
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms hahn_decomp_space_diff pos_neg_null_set
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> neg_meas_subset pos_meas_subset<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Existence of a positive subset›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The goal of this part is to prove that any measurable set of finite and positive measure must 
contain a positive subset with a strictly positive measure.›</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹A sequence of negative subsets›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">inf_neg</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">inf_neg</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">∉</span> sets <span class="free">M</span> <span class="main">∨</span> pos_meas_set <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span> <span class="keyword1">then</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span>nat<span class="main">)</span> 
  <span class="keyword1">else</span> Inf <span class="main">{</span><span class="bound">n</span><span class="main">|</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">≤</span> <span class="bound">n</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">B</span> <span class="main">∈</span> sets <span class="free">M</span><span class="main">.</span> <span class="bound">B</span>  <span class="main">⊆</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">∧</span> <span class="free">μ</span> <span class="bound">B</span> <span class="main">&lt;</span> ereal<span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">/</span><span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Hahn_Jordan_Decomposition-inf_neg_ne"><span class="command">lemma</span></span> inf_neg_ne<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">∈</span> sets <span class="free">M</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> pos_meas_set <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">n</span><span class="main">::</span>nat<span class="main">|</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">≤</span> <span class="bound">n</span> <span class="main">∧</span> 
  <span class="main">(</span><span class="main">∃</span><span class="bound">B</span> <span class="main">∈</span> sets <span class="free">M</span><span class="main">.</span> <span class="bound">B</span>  <span class="main">⊆</span> <span class="free">A</span> <span class="main">∧</span> <span class="free">μ</span> <span class="bound">B</span> <span class="main">&lt;</span> ereal <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">/</span><span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">}</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>  
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">N</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">N</span> <span class="main">=</span> <span class="main">{</span><span class="bound">n</span><span class="main">::</span>nat<span class="main">|</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">≤</span> <span class="bound">n</span> <span class="main">∧</span> 
    <span class="main">(</span><span class="main">∃</span><span class="bound">B</span> <span class="main">∈</span> sets <span class="free">M</span><span class="main">.</span> <span class="bound">B</span>  <span class="main">⊆</span> <span class="free">A</span> <span class="main">∧</span> <span class="free">μ</span> <span class="bound">B</span> <span class="main">&lt;</span> ereal <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">/</span><span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">B</span> <span class="main">∈</span> sets <span class="free">M</span><span class="main">.</span> <span class="bound">B</span><span class="main">⊆</span> <span class="free">A</span> <span class="main">∧</span> <span class="free">μ</span> <span class="bound">B</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> pos_meas_set_def 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">B</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span><span class="main">∈</span> sets <span class="free">M</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span><span class="main">⊆</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">μ</span> <span class="skolem">B</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">n</span><span class="main">::</span>nat<span class="main">.</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">≤</span> <span class="bound">n</span> <span class="main">∧</span> <span class="free">μ</span> <span class="skolem">B</span> <span class="main">&lt;</span> ereal <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">/</span><span class="bound">n</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">μ</span> <span class="skolem">B</span> <span class="main">=</span> <span class="main">-</span><span class="main">∞</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">μ</span> <span class="skolem">B</span> <span class="main">&lt;</span> <span class="main">-</span><span class="main">1</span><span class="main">/</span><span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> numeral_le_real_of_nat_iff one_le_numeral <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"real_of_ereal <span class="main">(</span><span class="free">μ</span> <span class="skolem">B</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">μ</span> <span class="skolem">B</span> <span class="main">&lt;</span> <span class="main">0</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Infty_neq_0<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> ereal_mult_eq_MInfty ereal_zero_mult 
          less_eq_ereal_def less_eq_real_def less_ereal.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> 
          real_of_ereal_eq_0 real_of_ereal_le_0<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">n</span><span class="main">::</span>nat<span class="main">.</span> Suc <span class="main">0</span> <span class="main">≤</span> <span class="bound">n</span> <span class="main">∧</span> real_of_ereal <span class="main">(</span><span class="free">μ</span> <span class="skolem">B</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">-</span><span class="main">1</span><span class="main">/</span><span class="bound">n</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">nw</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">nw</span> <span class="main">=</span>  Suc <span class="main">(</span>nat <span class="main">(</span>floor <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">/</span> <span class="main">(</span>real_of_ereal <span class="main">(</span><span class="free">μ</span> <span class="skolem">B</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Suc <span class="main">0</span> <span class="main">≤</span> <span class="skolem">nw</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> nw_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="main">-</span><span class="main">1</span><span class="main">/</span> <span class="main">(</span>real_of_ereal <span class="main">(</span><span class="free">μ</span> <span class="skolem">B</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹real_of_ereal <span class="main">(</span><span class="free">μ</span> <span class="skolem">B</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">0</span>›</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">1</span><span class="main">/</span> <span class="main">(</span>real_of_ereal <span class="main">(</span><span class="free">μ</span> <span class="skolem">B</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">nw</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> nw_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">/</span><span class="skolem">nw</span> <span class="main">&lt;</span> <span class="main">1</span><span class="main">/</span><span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">/</span> <span class="main">(</span>real_of_ereal <span class="main">(</span><span class="free">μ</span> <span class="skolem">B</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> <span class="main">-</span><span class="main">1</span><span class="main">/</span> <span class="main">(</span>real_of_ereal <span class="main">(</span><span class="free">μ</span> <span class="skolem">B</span><span class="main">)</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> frac_less2 
            le_eq_less_or_eq of_nat_1 of_nat_le_iff zero_less_one<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">-</span> <span class="main">(</span>real_of_ereal <span class="main">(</span><span class="free">μ</span> <span class="skolem">B</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">/</span><span class="skolem">nw</span> <span class="main">&lt;</span> <span class="main">-</span> <span class="main">(</span>real_of_ereal <span class="main">(</span><span class="free">μ</span> <span class="skolem">B</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"real_of_ereal <span class="main">(</span><span class="free">μ</span> <span class="skolem">B</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">-</span><span class="main">1</span><span class="main">/</span><span class="skolem">nw</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Suc <span class="main">0</span> <span class="main">≤</span> <span class="skolem">nw</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n1</span></span><span class="main">::</span><span class="quoted">nat</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"Suc <span class="main">0</span> <span class="main">≤</span> <span class="skolem">n1</span>"</span></span> 
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"real_of_ereal <span class="main">(</span><span class="free">μ</span> <span class="skolem">B</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">-</span><span class="main">1</span><span class="main">/</span><span class="skolem">n1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"ereal <span class="main">(</span>real_of_ereal <span class="main">(</span><span class="free">μ</span> <span class="skolem">B</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">-</span><span class="main">1</span><span class="main">/</span><span class="skolem">n1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> real_ereal_leq<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">μ</span> <span class="skolem">B</span>"</span></span><span class="main">]</span> 
        <span class="quoted"><span class="quoted">‹<span class="free">μ</span> <span class="skolem">B</span> <span class="main">&lt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">μ</span> <span class="skolem">B</span> <span class="main">=</span> real_of_ereal <span class="main">(</span><span class="free">μ</span> <span class="skolem">B</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">μ</span> <span class="skolem">B</span> <span class="main">&lt;</span> <span class="main">0</span>›</span></span> False
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> less_ereal.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> real_of_ereal.elims zero_ereal_def<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>  <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Suc <span class="main">0</span> <span class="main">≤</span> <span class="skolem">n1</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n0</span></span><span class="main">::</span><span class="quoted">nat</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">≤</span> <span class="skolem">n0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">μ</span> <span class="skolem">B</span> <span class="main">&lt;</span> <span class="main">-</span><span class="main">1</span><span class="main">/</span><span class="skolem">n0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n0</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">n</span><span class="main">::</span>nat<span class="main">|</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">≤</span> <span class="bound">n</span> <span class="main">∧</span> 
    <span class="main">(</span><span class="main">∃</span><span class="bound">B</span> <span class="main">∈</span> sets <span class="free">M</span><span class="main">.</span> <span class="bound">B</span>  <span class="main">⊆</span> <span class="free">A</span> <span class="main">∧</span> <span class="free">μ</span> <span class="bound">B</span> <span class="main">&lt;</span>  ereal<span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">/</span><span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">}</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">B</span><span class="main">∈</span> sets <span class="free">M</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">B</span><span class="main">⊆</span> <span class="free">A</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Hahn_Jordan_Decomposition-inf_neg_ge_1"><span class="command">lemma</span></span> inf_neg_ge_1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">∈</span> sets <span class="free">M</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> pos_meas_set <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">≤</span> inf_neg <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">N</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">N</span> <span class="main">=</span> <span class="main">{</span><span class="bound">n</span><span class="main">::</span>nat<span class="main">|</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">≤</span> <span class="bound">n</span> <span class="main">∧</span> 
    <span class="main">(</span><span class="main">∃</span><span class="bound">B</span> <span class="main">∈</span> sets <span class="free">M</span><span class="main">.</span> <span class="bound">B</span>  <span class="main">⊆</span> <span class="free">A</span> <span class="main">∧</span> <span class="free">μ</span> <span class="bound">B</span> <span class="main">&lt;</span> ereal <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">/</span><span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">}</span>"</span></span>  
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">N</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> N_def <span class="keyword1"><span class="command">using</span></span> assms inf_neg_ne <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span><span class="main">∈</span> <span class="skolem">N</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">≤</span> <span class="bound">n</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> N_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">≤</span> inf_neg <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> inf_neg_def N_def
    <span class="keyword1"><span class="command">using</span></span> Inf_nat_def1 assms<span class="main">(</span>1<span class="main">)</span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Hahn_Jordan_Decomposition-inf_neg_pos"><span class="command">lemma</span></span> inf_neg_pos<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">∈</span> sets <span class="free">M</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> pos_meas_set <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">B</span> <span class="main">∈</span> sets <span class="free">M</span><span class="main">.</span> <span class="bound">B</span><span class="main">⊆</span> <span class="free">A</span> <span class="main">∧</span> <span class="free">μ</span> <span class="bound">B</span> <span class="main">&lt;</span> <span class="main">-</span><span class="main">1</span><span class="main">/</span><span class="main">(</span>inf_neg <span class="free">A</span><span class="main">)</span>"</span></span>  
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">N</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">N</span> <span class="main">=</span> <span class="main">{</span><span class="bound">n</span><span class="main">::</span>nat<span class="main">|</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">≤</span> <span class="bound">n</span> <span class="main">∧</span> 
    <span class="main">(</span><span class="main">∃</span><span class="bound">B</span> <span class="main">∈</span> sets <span class="free">M</span><span class="main">.</span> <span class="bound">B</span>  <span class="main">⊆</span> <span class="free">A</span> <span class="main">∧</span> <span class="free">μ</span> <span class="bound">B</span> <span class="main">&lt;</span> ereal <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">/</span><span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">}</span>"</span></span>  
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">N</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> N_def <span class="keyword1"><span class="command">using</span></span> assms inf_neg_ne <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Inf <span class="skolem">N</span> <span class="main">∈</span> <span class="skolem">N</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Inf_nat_def1<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">N</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"inf_neg <span class="free">A</span> <span class="main">∈</span> <span class="skolem">N</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> N_def inf_neg_def <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> N_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">rep_neg</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">rep_neg</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span>  <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">∉</span> sets <span class="free">M</span> <span class="main">∨</span> pos_meas_set <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span> <span class="keyword1">then</span> <span class="main">{}</span> <span class="keyword1">else</span> 
  <span class="keyword1">SOME</span> <span class="bound">B</span><span class="main">.</span> <span class="bound">B</span> <span class="main">∈</span> sets <span class="free">M</span> <span class="main">∧</span> <span class="bound">B</span> <span class="main">⊆</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">∧</span> <span class="free">μ</span> <span class="bound">B</span> <span class="main">≤</span> ereal <span class="main">(</span><span class="main">-</span><span class="main">1</span> <span class="main">/</span> <span class="main">(</span>inf_neg <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Hahn_Jordan_Decomposition-g_rep_neg"><span class="command">lemma</span></span> g_rep_neg<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span><span class="main">∈</span> sets <span class="free">M</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> pos_meas_set <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"rep_neg <span class="free">A</span> <span class="main">∈</span> sets <span class="free">M</span>"</span></span> <span class="quoted"><span class="quoted">"rep_neg <span class="free">A</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span>  
    <span class="quoted"><span class="quoted">"<span class="free">μ</span> <span class="main">(</span>rep_neg <span class="free">A</span><span class="main">)</span> <span class="main">≤</span> ereal <span class="main">(</span><span class="main">-</span><span class="main">1</span> <span class="main">/</span> <span class="main">(</span>inf_neg <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">B</span><span class="main">.</span> <span class="bound">B</span> <span class="main">∈</span> sets <span class="free">M</span> <span class="main">∧</span> <span class="bound">B</span><span class="main">⊆</span> <span class="free">A</span> <span class="main">∧</span> <span class="free">μ</span> <span class="bound">B</span> <span class="main">≤</span> <span class="main">-</span><span class="main">1</span> <span class="main">/</span> <span class="main">(</span>inf_neg <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms 
      inf_neg_pos<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> someI_ex<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"rep_neg <span class="free">A</span> <span class="main">∈</span> sets <span class="free">M</span>"</span></span> <span class="quoted"><span class="quoted">"rep_neg <span class="free">A</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span>  
    <span class="quoted"><span class="quoted">"<span class="free">μ</span> <span class="main">(</span>rep_neg <span class="free">A</span><span class="main">)</span> <span class="main">≤</span> <span class="main">-</span><span class="main">1</span> <span class="main">/</span> <span class="main">(</span>inf_neg <span class="free">A</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> rep_neg_def <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Hahn_Jordan_Decomposition-rep_neg_sets"><span class="command">lemma</span></span> rep_neg_sets<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"rep_neg <span class="free">A</span> <span class="main">∈</span> sets <span class="free">M</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">∉</span> sets <span class="free">M</span> <span class="main">∨</span> pos_meas_set <span class="free">A</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> rep_neg_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> g_rep_neg<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Hahn_Jordan_Decomposition-rep_neg_subset"><span class="command">lemma</span></span> rep_neg_subset<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"rep_neg <span class="free">A</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">∉</span> sets <span class="free">M</span> <span class="main">∨</span> pos_meas_set <span class="free">A</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> rep_neg_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> g_rep_neg<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Hahn_Jordan_Decomposition-rep_neg_less"><span class="command">lemma</span></span> rep_neg_less<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span><span class="main">∈</span> sets <span class="free">M</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> pos_meas_set <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">μ</span> <span class="main">(</span>rep_neg <span class="free">A</span><span class="main">)</span> <span class="main">≤</span> ereal <span class="main">(</span><span class="main">-</span><span class="main">1</span> <span class="main">/</span> <span class="main">(</span>inf_neg <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms g_rep_neg<span class="main">(</span>3<span class="main">)</span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Hahn_Jordan_Decomposition-rep_neg_leq"><span class="command">lemma</span></span> rep_neg_leq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">μ</span> <span class="main">(</span>rep_neg <span class="free">A</span><span class="main">)</span> <span class="main">≤</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">∉</span> sets <span class="free">M</span> <span class="main">∨</span> pos_meas_set <span class="free">A</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"rep_neg <span class="free">A</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> rep_neg_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> sgn_meas signed_measure_empty <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span> 
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> rep_neg_less <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> le_ereal_le minus_divide_left 
        neg_le_0_iff_le of_nat_0 of_nat_le_iff zero_ereal_def zero_le 
        zero_le_divide_1_iff<span class="main">)</span> 
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Construction of the positive subset›</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">pos_wtn</span>
  <span class="keyword2"><span class="keyword">where</span></span>
    pos_wtn_base<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">pos_wtn</span> <span class="free"><span class="bound"><span class="entity">E</span></span></span> <span class="main">0</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">E</span></span></span>"</span></span><span class="main">|</span>
    pos_wtn_step<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">pos_wtn</span> <span class="free"><span class="bound"><span class="entity">E</span></span></span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">pos_wtn</span> <span class="free"><span class="bound"><span class="entity">E</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">-</span> rep_neg <span class="main">(</span><span class="free">pos_wtn</span> <span class="free"><span class="bound"><span class="entity">E</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Hahn_Jordan_Decomposition-pos_wtn_subset"><span class="command">lemma</span></span> pos_wtn_subset<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"pos_wtn <span class="free">E</span> <span class="free">n</span> <span class="main">⊆</span> <span class="free">E</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> pos_wtn_base <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"rep_neg <span class="main">(</span>pos_wtn <span class="free">E</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">⊆</span> pos_wtn <span class="free">E</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> rep_neg_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> Suc <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Hahn_Jordan_Decomposition-pos_wtn_sets"><span class="command">lemma</span></span> pos_wtn_sets<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">E</span><span class="main">∈</span> sets <span class="free">M</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"pos_wtn <span class="free">E</span> <span class="free">n</span> <span class="main">∈</span> sets <span class="free">M</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> pos_wtn_step rep_neg_sets <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">neg_wtn</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">neg_wtn</span> <span class="free"><span class="bound"><span class="entity">E</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">::</span>nat<span class="main">)</span> <span class="main">=</span> rep_neg <span class="main">(</span>pos_wtn <span class="free"><span class="bound"><span class="entity">E</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Hahn_Jordan_Decomposition-neg_wtn_neg_meas"><span class="command">lemma</span></span> neg_wtn_neg_meas<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">μ</span> <span class="main">(</span>neg_wtn <span class="free">E</span> <span class="free">n</span><span class="main">)</span> <span class="main">≤</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> neg_wtn_def <span class="keyword1"><span class="command">using</span></span> rep_neg_leq <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Hahn_Jordan_Decomposition-neg_wtn_sets"><span class="command">lemma</span></span> neg_wtn_sets<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"neg_wtn <span class="free">E</span> <span class="free">n</span> <span class="main">∈</span> sets <span class="free">M</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> neg_wtn_def <span class="keyword1"><span class="command">using</span></span> rep_neg_sets <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Hahn_Jordan_Decomposition-neg_wtn_subset"><span class="command">lemma</span></span> neg_wtn_subset<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"neg_wtn <span class="free">E</span> <span class="free">n</span> <span class="main">⊆</span> <span class="free">E</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> neg_wtn_def  
  <span class="keyword1"><span class="command">using</span></span> pos_wtn_subset<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">E</span></span> <span class="quoted"><span class="free">n</span></span><span class="main">]</span> rep_neg_subset<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"pos_wtn <span class="free">E</span> <span class="free">n</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Hahn_Jordan_Decomposition-neg_wtn_union_subset"><span class="command">lemma</span></span> neg_wtn_union_subset<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋃</span> <span class="bound">i</span> <span class="main">≤</span> <span class="free">n</span><span class="main">.</span> neg_wtn <span class="free">E</span> <span class="bound">i</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">E</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> neg_wtn_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Hahn_Jordan_Decomposition-pos_wtn_Suc"><span class="command">lemma</span></span> pos_wtn_Suc<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"pos_wtn <span class="free">E</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="free">E</span> <span class="main">-</span> <span class="main">(</span><span class="main">⋃</span> <span class="bound">i</span> <span class="main">≤</span> <span class="free">n</span><span class="main">.</span> neg_wtn <span class="free">E</span> <span class="bound">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> neg_wtn_def
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> pos_wtn_base pos_wtn_step <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"pos_wtn <span class="free">E</span> <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> pos_wtn <span class="free">E</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">-</span> 
    rep_neg <span class="main">(</span>pos_wtn <span class="free">E</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> pos_wtn_step <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">E</span> <span class="main">-</span> <span class="main">(</span><span class="main">⋃</span> <span class="bound">i</span> <span class="main">≤</span> <span class="skolem">n</span><span class="main">.</span> rep_neg <span class="main">(</span>pos_wtn <span class="free">E</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> 
    rep_neg <span class="main">(</span>pos_wtn <span class="free">E</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Suc <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">E</span> <span class="main">-</span> <span class="main">(</span><span class="main">⋃</span> <span class="bound">i</span> <span class="main">≤</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">.</span> rep_neg <span class="main">(</span>pos_wtn <span class="free">E</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> diff_union<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">E</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">i</span><span class="main">.</span> rep_neg <span class="main">(</span>pos_wtn <span class="free">E</span> <span class="bound">i</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="skolem">n</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"pos_wtn <span class="free">E</span> <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
    <span class="free">E</span> <span class="main">-</span> <span class="main">(</span><span class="main">⋃</span> <span class="bound">i</span> <span class="main">≤</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">.</span> rep_neg <span class="main">(</span>pos_wtn <span class="free">E</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">pos_sub</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">pos_sub</span> <span class="free"><span class="bound"><span class="entity">E</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">⋂</span> <span class="bound">n</span><span class="main">.</span> pos_wtn <span class="free"><span class="bound"><span class="entity">E</span></span></span> <span class="bound">n</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Hahn_Jordan_Decomposition-pos_sub_sets"><span class="command">lemma</span></span> pos_sub_sets<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">E</span><span class="main">∈</span> sets <span class="free">M</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"pos_sub <span class="free">E</span> <span class="main">∈</span> sets <span class="free">M</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> pos_sub_def <span class="keyword1"><span class="command">using</span></span> pos_wtn_sets assms 
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Hahn_Jordan_Decomposition-pos_sub_subset"><span class="command">lemma</span></span> pos_sub_subset<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"pos_sub <span class="free">E</span> <span class="main">⊆</span> <span class="free">E</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> pos_sub_def <span class="keyword1"><span class="command">using</span></span> pos_wtn_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Hahn_Jordan_Decomposition-pos_sub_infty"><span class="command">lemma</span></span> pos_sub_infty<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">E</span> <span class="main">∈</span> sets <span class="free">M</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="free">μ</span> <span class="free">E</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="main">∞</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="free">μ</span> <span class="main">(</span>pos_sub <span class="free">E</span><span class="main">)</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="main">∞</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> signed_measure_finite_subset assms 
    pos_sub_sets pos_sub_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Hahn_Jordan_Decomposition-neg_wtn_djn"><span class="command">lemma</span></span> neg_wtn_djn<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"disjoint_family <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> neg_wtn <span class="free">E</span> <span class="bound">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> disjoint_family_on_def
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span> 
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">m</span><span class="main">::</span><span class="quoted">nat</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&lt;</span> <span class="skolem">m</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">p</span><span class="main">.</span> <span class="skolem">m</span> <span class="main">=</span> Suc <span class="bound">p</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> old.nat.exhaust <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">=</span> Suc <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"neg_wtn <span class="free">E</span> <span class="skolem">m</span> <span class="main">⊆</span> pos_wtn <span class="free">E</span> <span class="skolem">m</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> neg_wtn_def 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rep_neg_subset<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">E</span> <span class="main">-</span> <span class="main">(</span><span class="main">⋃</span> <span class="bound">i</span> <span class="main">≤</span> <span class="skolem">p</span><span class="main">.</span> neg_wtn <span class="free">E</span> <span class="bound">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> pos_wtn_Suc <span class="quoted"><span class="quoted">‹<span class="skolem">m</span> <span class="main">=</span> Suc <span class="skolem">p</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"neg_wtn <span class="free">E</span> <span class="skolem">m</span> <span class="main">⊆</span> <span class="free">E</span> <span class="main">-</span> <span class="main">(</span><span class="main">⋃</span> <span class="bound">i</span> <span class="main">≤</span> <span class="skolem">p</span><span class="main">.</span> neg_wtn <span class="free">E</span> <span class="bound">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"neg_wtn <span class="free">E</span> <span class="skolem">n</span> <span class="main">⊆</span> <span class="main">(</span><span class="main">⋃</span> <span class="bound">i</span> <span class="main">≤</span> <span class="skolem">p</span><span class="main">.</span> neg_wtn <span class="free">E</span> <span class="bound">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">&lt;</span> <span class="skolem">m</span>›</span></span> 
        <span class="quoted"><span class="quoted">‹<span class="skolem">m</span> <span class="main">=</span> Suc <span class="skolem">p</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> UN_upper<span class="main">)</span> 
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"neg_wtn <span class="free">E</span> <span class="skolem">n</span> <span class="main">∩</span> neg_wtn <span class="free">E</span> <span class="skolem">m</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">m</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="main">∀</span><span class="bound">n</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="bound">m</span> <span class="main">≠</span> <span class="bound">n</span> <span class="main">⟶</span> neg_wtn <span class="free">E</span> <span class="bound">m</span> <span class="main">∩</span> neg_wtn <span class="free">E</span> <span class="bound">n</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>  
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf_commute linorder_neqE_nat<span class="main">)</span> 
<span class="keyword1"><span class="command">qed</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1" id="Hahn_Jordan_Decomposition-disjoint_family_imp_on"><span class="command">lemma</span></span> disjoint_family_imp_on<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"disjoint_family <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"disjoint_family_on <span class="free">A</span> <span class="free">S</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> assms disjoint_family_on_mono subset_UNIV <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 

<span class="keyword1"><span class="command">context</span></span> signed_measure_space
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1" id="Hahn_Jordan_Decomposition-neg_wtn_union_neg_meas"><span class="command">lemma</span></span> neg_wtn_union_neg_meas<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">μ</span> <span class="main">(</span><span class="main">⋃</span> <span class="bound">i</span> <span class="main">≤</span> <span class="free">n</span><span class="main">.</span> neg_wtn <span class="free">E</span> <span class="bound">i</span><span class="main">)</span> <span class="main">≤</span> <span class="main">0</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">μ</span> <span class="main">(</span><span class="main">⋃</span> <span class="bound">i</span> <span class="main">≤</span> <span class="free">n</span><span class="main">.</span> neg_wtn <span class="free">E</span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="main">{..</span> <span class="free">n</span><span class="main">}</span><span class="main">.</span> <span class="free">μ</span> <span class="main">(</span>neg_wtn <span class="free">E</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> signed_measure_disj_sum<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"signed_measure <span class="free">M</span> <span class="free">μ</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> sgn_meas <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"disjoint_family_on <span class="main">(</span>neg_wtn <span class="free">E</span><span class="main">)</span> <span class="main">{..</span><span class="free">n</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> neg_wtn_djn 
        disjoint_family_imp_on<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"neg_wtn <span class="free">E</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> <span class="main">{..</span><span class="free">n</span><span class="main">}</span> <span class="main">⟹</span> neg_wtn <span class="free">E</span> <span class="bound">i</span> <span class="main">∈</span> sets <span class="free">M</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> neg_wtn_sets <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> neg_wtn_neg_meas <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_nonpos<span class="main">)</span> 
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Hahn_Jordan_Decomposition-pos_wtn_meas_gt"><span class="command">lemma</span></span> pos_wtn_meas_gt<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">μ</span> <span class="free">E</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">E</span><span class="main">∈</span> sets <span class="free">M</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">μ</span> <span class="main">(</span>pos_wtn <span class="free">E</span> <span class="free">n</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">m</span><span class="main">.</span> <span class="free">n</span> <span class="main">=</span> Suc <span class="bound">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> not0_implies_Suc<span class="main">)</span> 
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">=</span> Suc <span class="skolem">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"pos_wtn <span class="free">E</span> <span class="free">n</span> <span class="main">=</span> <span class="free">E</span> <span class="main">-</span> <span class="main">(</span><span class="main">⋃</span> <span class="bound">i</span> <span class="main">≤</span> <span class="skolem">m</span><span class="main">.</span> neg_wtn <span class="free">E</span> <span class="bound">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> pos_wtn_Suc 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"pos_wtn <span class="free">E</span> <span class="free">n</span> <span class="main">∩</span> <span class="main">(</span><span class="main">⋃</span> <span class="bound">i</span> <span class="main">≤</span> <span class="skolem">m</span><span class="main">.</span> neg_wtn <span class="free">E</span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">E</span> <span class="main">=</span> pos_wtn <span class="free">E</span> <span class="free">n</span> <span class="main">∪</span> <span class="main">(</span><span class="main">⋃</span> <span class="bound">i</span> <span class="main">≤</span> <span class="skolem">m</span><span class="main">.</span> neg_wtn <span class="free">E</span> <span class="bound">i</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> eq neg_wtn_union_subset<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">E</span></span> <span class="quoted"><span class="skolem">m</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">μ</span> <span class="free">E</span> <span class="main">=</span> <span class="free">μ</span> <span class="main">(</span>pos_wtn <span class="free">E</span> <span class="free">n</span><span class="main">)</span> <span class="main">+</span> <span class="free">μ</span> <span class="main">(</span><span class="main">⋃</span> <span class="bound">i</span> <span class="main">≤</span> <span class="skolem">m</span><span class="main">.</span> neg_wtn <span class="free">E</span> <span class="bound">i</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> signed_measure_add<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">M</span></span> <span class="quoted"><span class="free">μ</span></span> <span class="quoted"><span class="quoted">"pos_wtn <span class="free">E</span> <span class="free">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋃</span> <span class="bound">i</span> <span class="main">≤</span> <span class="skolem">m</span><span class="main">.</span> neg_wtn <span class="free">E</span> <span class="bound">i</span>"</span></span><span class="main">]</span> 
      pos_wtn_sets neg_wtn_sets assms sgn_meas <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">μ</span> <span class="main">(</span>pos_wtn <span class="free">E</span> <span class="free">n</span><span class="main">)</span> <span class="main">+</span> <span class="free">μ</span> <span class="main">(</span><span class="main">⋃</span> <span class="bound">i</span> <span class="main">≤</span> <span class="skolem">m</span><span class="main">.</span> neg_wtn <span class="free">E</span> <span class="bound">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> neg_wtn_union_neg_meas 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add.right_neutral add_mono not_le<span class="main">)</span> 
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">union_wit</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">union_wit</span> <span class="free"><span class="bound"><span class="entity">E</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span> <span class="bound">n</span><span class="main">.</span> neg_wtn <span class="free"><span class="bound"><span class="entity">E</span></span></span> <span class="bound">n</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Hahn_Jordan_Decomposition-union_wit_sets"><span class="command">lemma</span></span> union_wit_sets<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"union_wit <span class="free">E</span> <span class="main">∈</span> sets <span class="free">M</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> union_wit_def
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> sigma_algebra.countable_nat_UN<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"sigma_algebra <span class="main">(</span>space <span class="free">M</span><span class="main">)</span> <span class="main">(</span>sets <span class="free">M</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sets.sigma_algebra_axioms<span class="main">)</span> 
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"range <span class="main">(</span>neg_wtn <span class="free">E</span><span class="main">)</span> <span class="main">⊆</span> sets <span class="free">M</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"neg_wtn <span class="free">E</span> <span class="skolem">n</span> <span class="main">∈</span> sets <span class="free">M</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> neg_wtn_def 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rep_neg_sets<span class="main">)</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Hahn_Jordan_Decomposition-union_wit_subset"><span class="command">lemma</span></span> union_wit_subset<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"union_wit <span class="free">E</span> <span class="main">⊆</span> <span class="free">E</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"neg_wtn <span class="free">E</span> <span class="skolem">n</span> <span class="main">⊆</span> <span class="free">E</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> neg_wtn_def <span class="keyword1"><span class="command">using</span></span> pos_wtn_subset
        rep_neg_subset<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"pos_wtn <span class="free">E</span> <span class="skolem">n</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> union_wit_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Hahn_Jordan_Decomposition-pos_sub_diff"><span class="command">lemma</span></span> pos_sub_diff<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"pos_sub <span class="free">E</span> <span class="main">=</span> <span class="free">E</span> <span class="main">-</span> union_wit <span class="free">E</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"pos_sub <span class="free">E</span> <span class="main">⊆</span> <span class="free">E</span> <span class="main">-</span> union_wit <span class="free">E</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"pos_sub <span class="free">E</span> <span class="main">⊆</span> <span class="free">E</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> pos_sub_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"pos_sub <span class="free">E</span> <span class="main">∩</span> union_wit <span class="free">E</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"pos_sub <span class="free">E</span> <span class="main">∩</span> union_wit <span class="free">E</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">a</span><span class="main">.</span> <span class="bound">a</span><span class="main">∈</span> pos_sub <span class="free">E</span> <span class="main">∩</span> union_wit <span class="free">E</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">∈</span> pos_sub <span class="free">E</span> <span class="main">∩</span> union_wit <span class="free">E</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">∈</span> union_wit <span class="free">E</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">a</span> <span class="main">∈</span> rep_neg <span class="main">(</span>pos_wtn <span class="free">E</span> <span class="bound">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> union_wit_def neg_wtn_def
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> rep_neg <span class="main">(</span>pos_wtn <span class="free">E</span> <span class="skolem">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> pos_wtn <span class="free">E</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span><span class="main">∈</span> pos_sub <span class="free">E</span> <span class="main">∩</span> union_wit <span class="free">E</span>›</span></span> 
        <span class="keyword1"><span class="command">unfolding</span></span> pos_sub_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">∉</span> rep_neg <span class="main">(</span>pos_wtn <span class="free">E</span> <span class="skolem">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> pos_wtn_step <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">∈</span> rep_neg <span class="main">(</span>pos_wtn <span class="free">E</span> <span class="skolem">n</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">E</span> <span class="main">-</span> union_wit <span class="free">E</span> <span class="main">⊆</span> pos_sub <span class="free">E</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="free">E</span> <span class="main">-</span> union_wit <span class="free">E</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> pos_sub <span class="free">E</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> pos_sub_def
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> pos_wtn <span class="free">E</span> <span class="skolem">n</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> pos_wtn_base <span class="quoted"><span class="quoted">‹<span class="skolem">a</span><span class="main">∈</span> <span class="free">E</span> <span class="main">-</span> union_wit <span class="free">E</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">m</span><span class="main">.</span> <span class="skolem">n</span> <span class="main">=</span> Suc <span class="bound">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> not0_implies_Suc<span class="main">)</span> 
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> Suc <span class="skolem">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋃</span> <span class="bound">i</span> <span class="main">≤</span> <span class="skolem">m</span><span class="main">.</span> rep_neg <span class="main">(</span>pos_wtn <span class="free">E</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> 
          <span class="main">(</span><span class="main">⋃</span> <span class="bound">n</span><span class="main">.</span> <span class="main">(</span>rep_neg <span class="main">(</span>pos_wtn <span class="free">E</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="free">E</span> <span class="main">-</span> <span class="main">(</span><span class="main">⋃</span> <span class="bound">i</span> <span class="main">≤</span> <span class="skolem">m</span><span class="main">.</span> rep_neg <span class="main">(</span>pos_wtn <span class="free">E</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">∈</span> <span class="free">E</span> <span class="main">-</span> union_wit <span class="free">E</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> union_wit_def neg_wtn_def 
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">∈</span> pos_wtn <span class="free">E</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> pos_wtn_Suc <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">=</span> Suc <span class="skolem">m</span>›</span></span> 
          <span class="keyword1"><span class="command">unfolding</span></span> neg_wtn_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">num_wtn</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">num_wtn</span> <span class="free"><span class="bound"><span class="entity">E</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span> inf_neg <span class="main">(</span>pos_wtn <span class="free"><span class="bound"><span class="entity">E</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Hahn_Jordan_Decomposition-num_wtn_geq"><span class="command">lemma</span></span> num_wtn_geq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">μ</span> <span class="main">(</span>neg_wtn <span class="free">E</span> <span class="free">n</span><span class="main">)</span> <span class="main">≤</span> ereal <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">/</span><span class="main">(</span>num_wtn <span class="free">E</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>pos_wtn <span class="free">E</span> <span class="free">n</span><span class="main">)</span> <span class="main">∉</span> sets <span class="free">M</span> <span class="main">∨</span> pos_meas_set <span class="main">(</span>pos_wtn <span class="free">E</span> <span class="free">n</span><span class="main">)</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"neg_wtn <span class="free">E</span> <span class="free">n</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> neg_wtn_def rep_neg_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"num_wtn <span class="free">E</span> <span class="free">n</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">unfolding</span></span> num_wtn_def inf_neg_def 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> sgn_meas signed_measure_empty <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span> 
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> g_rep_neg<span class="main">(</span>3<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"pos_wtn <span class="free">E</span> <span class="free">n</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> neg_wtn_def 
      num_wtn_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Hahn_Jordan_Decomposition-neg_wtn_infty"><span class="command">lemma</span></span> neg_wtn_infty<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">E</span> <span class="main">∈</span> sets <span class="free">M</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="free">μ</span> <span class="free">E</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="main">∞</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="free">μ</span> <span class="main">(</span>neg_wtn <span class="free">E</span> <span class="free">i</span><span class="main">)</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="main">∞</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> signed_measure_finite_subset<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">E</span> <span class="main">∈</span> sets <span class="free">M</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="free">μ</span> <span class="free">E</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="main">∞</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"neg_wtn <span class="free">E</span> <span class="free">i</span> <span class="main">∈</span> sets <span class="free">M</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"pos_wtn <span class="free">E</span> <span class="free">i</span> <span class="main">∉</span> sets <span class="free">M</span> <span class="main">∨</span> pos_meas_set <span class="main">(</span>pos_wtn <span class="free">E</span> <span class="free">i</span><span class="main">)</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> neg_wtn_def rep_neg_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> neg_wtn_def 
      <span class="keyword1"><span class="command">using</span></span> g_rep_neg<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"pos_wtn <span class="free">E</span> <span class="free">i</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"neg_wtn <span class="free">E</span> <span class="free">i</span> <span class="main">⊆</span> <span class="free">E</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> neg_wtn_def <span class="keyword1"><span class="command">using</span></span> pos_wtn_subset<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">E</span></span><span class="main">]</span> 
      rep_neg_subset<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"pos_wtn <span class="free">E</span> <span class="free">i</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Hahn_Jordan_Decomposition-union_wit_infty"><span class="command">lemma</span></span> union_wit_infty<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">E</span> <span class="main">∈</span> sets <span class="free">M</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="free">μ</span> <span class="free">E</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="main">∞</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="free">μ</span> <span class="main">(</span>union_wit <span class="free">E</span><span class="main">)</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="main">∞</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> union_wit_subset union_wit_sets 
    signed_measure_finite_subset assms <span class="keyword1"><span class="command">unfolding</span></span> union_wit_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Hahn_Jordan_Decomposition-neg_wtn_summable"><span class="command">lemma</span></span> neg_wtn_summable<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">E</span> <span class="main">∈</span> sets <span class="free">M</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="free">μ</span> <span class="free">E</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="main">∞</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"summable <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="main">-</span> real_of_ereal <span class="main">(</span><span class="free">μ</span> <span class="main">(</span>neg_wtn <span class="free">E</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"signed_measure <span class="free">M</span> <span class="free">μ</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> sgn_meas <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"range <span class="main">(</span>neg_wtn <span class="free">E</span><span class="main">)</span> <span class="main">⊆</span> sets <span class="free">M</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> neg_wtn_def 
    <span class="keyword1"><span class="command">using</span></span> rep_neg_sets <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"disjoint_family <span class="main">(</span>neg_wtn <span class="free">E</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> neg_wtn_djn <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋃</span> <span class="main">(</span>range <span class="main">(</span>neg_wtn <span class="free">E</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> sets <span class="free">M</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> union_wit_sets 
    <span class="keyword1"><span class="command">unfolding</span></span> union_wit_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="free">μ</span> <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span>range <span class="main">(</span>neg_wtn <span class="free">E</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="main">∞</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> union_wit_subset signed_measure_finite_subset union_wit_sets assms
    <span class="keyword1"><span class="command">unfolding</span></span> union_wit_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"summable <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> real_of_ereal <span class="main">¦</span><span class="free">μ</span> <span class="main">(</span>neg_wtn <span class="free">E</span> <span class="bound">i</span><span class="main">)</span><span class="main">¦</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> signed_measure_abs_convergent<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">M</span></span> <span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="main">¦</span><span class="free">μ</span> <span class="main">(</span>neg_wtn <span class="free">E</span> <span class="bound">i</span><span class="main">)</span><span class="main">¦</span> <span class="main">=</span> <span class="main">-</span><span class="main">(</span><span class="free">μ</span> <span class="main">(</span>neg_wtn <span class="free">E</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">μ</span> <span class="main">(</span>neg_wtn <span class="free">E</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">≤</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> rep_neg_leq<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"pos_wtn <span class="free">E</span> <span class="skolem">i</span>"</span></span><span class="main">]</span> 
      <span class="keyword1"><span class="command">unfolding</span></span> neg_wtn_def <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="free">μ</span> <span class="main">(</span>neg_wtn <span class="free">E</span> <span class="skolem">i</span><span class="main">)</span><span class="main">¦</span> <span class="main">=</span> <span class="main">-</span><span class="free">μ</span> <span class="main">(</span>neg_wtn <span class="free">E</span> <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> less_eq_ereal_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Hahn_Jordan_Decomposition-inv_num_wtn_summable"><span class="command">lemma</span></span> inv_num_wtn_summable<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">E</span> <span class="main">∈</span> sets <span class="free">M</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="free">μ</span> <span class="free">E</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="main">∞</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"summable <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">1</span><span class="main">/</span><span class="main">(</span>num_wtn <span class="free">E</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> summable_bounded<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="main">0</span> <span class="main">≤</span> <span class="main">1</span> <span class="main">/</span> real <span class="main">(</span>num_wtn <span class="free">E</span> <span class="bound">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> real <span class="main">(</span>num_wtn <span class="free">E</span> <span class="bound">i</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">-</span>real_of_ereal <span class="main">(</span><span class="free">μ</span> <span class="main">(</span>neg_wtn <span class="free">E</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="bound">i</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="free">μ</span> <span class="main">(</span>neg_wtn <span class="free">E</span> <span class="skolem">i</span><span class="main">)</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="main">∞</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms neg_wtn_infty <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ereal <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="main">(</span>num_wtn <span class="free">E</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="main">-</span><span class="free">μ</span> <span class="main">(</span>neg_wtn <span class="free">E</span> <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> num_wtn_geq<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">E</span></span> <span class="quoted"><span class="skolem">i</span></span><span class="main">]</span> 
        ereal_minus_le_minus <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span> 
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> ereal<span class="main">(</span><span class="main">-</span> real_of_ereal <span class="main">(</span><span class="free">μ</span> <span class="main">(</span>neg_wtn <span class="free">E</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¦</span><span class="free">μ</span> <span class="main">(</span>neg_wtn <span class="free">E</span> <span class="skolem">i</span><span class="main">)</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="main">∞</span>›</span></span> ereal_real' <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ereal <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="main">(</span>num_wtn <span class="free">E</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> 
      ereal<span class="main">(</span><span class="main">-</span> real_of_ereal <span class="main">(</span><span class="free">μ</span> <span class="main">(</span>neg_wtn <span class="free">E</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">/</span> real <span class="main">(</span>num_wtn <span class="free">E</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">≤</span> <span class="main">-</span>real_of_ereal <span class="main">(</span><span class="free">μ</span> <span class="main">(</span>neg_wtn <span class="free">E</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"summable <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="main">-</span> real_of_ereal <span class="main">(</span><span class="free">μ</span> <span class="main">(</span>neg_wtn <span class="free">E</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms neg_wtn_summable <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Hahn_Jordan_Decomposition-inv_num_wtn_shift_summable"><span class="command">lemma</span></span> inv_num_wtn_shift_summable<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">E</span> <span class="main">∈</span> sets <span class="free">M</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="free">μ</span> <span class="free">E</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="main">∞</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"summable <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">1</span><span class="main">/</span><span class="main">(</span>num_wtn <span class="free">E</span> <span class="bound">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sum_shift_denum<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"summable <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> real <span class="main">(</span>num_wtn <span class="free">E</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms inv_num_wtn_summable
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Hahn_Jordan_Decomposition-neg_wtn_meas_sums"><span class="command">lemma</span></span> neg_wtn_meas_sums<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">E</span> <span class="main">∈</span> sets <span class="free">M</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="free">μ</span> <span class="free">E</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="main">∞</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="main">-</span> <span class="main">(</span><span class="free">μ</span> <span class="main">(</span>neg_wtn <span class="free">E</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">sums</span> 
  suminf <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="main">-</span> real_of_ereal <span class="main">(</span><span class="free">μ</span> <span class="main">(</span>neg_wtn <span class="free">E</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> ereal <span class="main">(</span><span class="main">-</span> real_of_ereal <span class="main">(</span><span class="free">μ</span> <span class="main">(</span>neg_wtn <span class="free">E</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">sums</span> 
    suminf <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="main">-</span> real_of_ereal <span class="main">(</span><span class="free">μ</span> <span class="main">(</span>neg_wtn <span class="free">E</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sums_ereal<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> iffD2<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"summable <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="main">-</span> real_of_ereal <span class="main">(</span><span class="free">μ</span> <span class="main">(</span>neg_wtn <span class="free">E</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> neg_wtn_summable assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">-</span> real_of_ereal <span class="main">(</span><span class="free">μ</span> <span class="main">(</span>neg_wtn <span class="free">E</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
      <span class="keyword1">sums</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">.</span> <span class="main">-</span> real_of_ereal <span class="main">(</span><span class="free">μ</span> <span class="main">(</span>neg_wtn <span class="free">E</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="free">μ</span> <span class="main">(</span>neg_wtn <span class="free">E</span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> ereal <span class="main">(</span>real_of_ereal <span class="main">(</span><span class="free">μ</span> <span class="main">(</span>neg_wtn <span class="free">E</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">μ</span> <span class="main">(</span>neg_wtn <span class="free">E</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">=</span> ereal <span class="main">(</span>real_of_ereal <span class="main">(</span><span class="free">μ</span> <span class="main">(</span>neg_wtn <span class="free">E</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> assms<span class="main">(</span>2<span class="main">)</span> ereal_real' neg_wtn_infty <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> sums_cong uminus_ereal.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span> 
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Hahn_Jordan_Decomposition-neg_wtn_meas_suminf_le"><span class="command">lemma</span></span> neg_wtn_meas_suminf_le<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">E</span> <span class="main">∈</span> sets <span class="free">M</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="free">μ</span> <span class="free">E</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="main">∞</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"suminf <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="free">μ</span> <span class="main">(</span>neg_wtn <span class="free">E</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="main">-</span> suminf <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">1</span><span class="main">/</span><span class="main">(</span>num_wtn <span class="free">E</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"suminf <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">1</span><span class="main">/</span><span class="main">(</span>num_wtn <span class="free">E</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> 
    suminf <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="main">-</span>real_of_ereal <span class="main">(</span><span class="free">μ</span> <span class="main">(</span>neg_wtn <span class="free">E</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> suminf_le<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"summable <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span>  <span class="main">1</span> <span class="main">/</span> real <span class="main">(</span>num_wtn <span class="free">E</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms 
        inv_num_wtn_summable<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">E</span></span><span class="main">]</span> 
        summable_minus<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> real <span class="main">(</span>num_wtn <span class="free">E</span> <span class="bound">n</span><span class="main">)</span>"</span></span><span class="main">]</span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"summable <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="main">-</span>real_of_ereal <span class="main">(</span><span class="free">μ</span> <span class="main">(</span>neg_wtn <span class="free">E</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> neg_wtn_summable assms
        summable_minus<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">i</span><span class="main">.</span> real_of_ereal <span class="main">(</span><span class="free">μ</span> <span class="main">(</span>neg_wtn <span class="free">E</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">]</span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> summable_minus_iff<span class="main">)</span> 
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> real <span class="main">(</span>num_wtn <span class="free">E</span> <span class="bound">n</span><span class="main">)</span> <span class="main">≤</span> <span class="main">-</span>real_of_ereal <span class="main">(</span><span class="free">μ</span> <span class="main">(</span>neg_wtn <span class="free">E</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">μ</span> <span class="main">(</span>neg_wtn <span class="free">E</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">≤</span> ereal <span class="main">(</span><span class="main">-</span> <span class="main">1</span> <span class="main">/</span> real <span class="main">(</span>num_wtn <span class="free">E</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> num_wtn_geq <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"ereal <span class="main">(</span><span class="main">1</span><span class="main">/</span> real <span class="main">(</span>num_wtn <span class="free">E</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="main">-</span> <span class="free">μ</span> <span class="main">(</span>neg_wtn <span class="free">E</span> <span class="skolem">n</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add.inverse_inverse eq_iff ereal_uminus_le_reorder linear 
            minus_divide_left uminus_ereal.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"real_of_ereal <span class="main">(</span>ereal <span class="main">(</span><span class="main">1</span> <span class="main">/</span> real <span class="main">(</span>num_wtn <span class="free">E</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> 
        real_of_ereal <span class="main">(</span><span class="main">-</span> <span class="free">μ</span> <span class="main">(</span>neg_wtn <span class="free">E</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> real_of_ereal_positive_mono<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> ereal <span class="main">(</span><span class="main">1</span> <span class="main">/</span> real <span class="main">(</span>num_wtn <span class="free">E</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"ereal <span class="main">(</span><span class="main">1</span> <span class="main">/</span> real <span class="main">(</span>num_wtn <span class="free">E</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="main">-</span> <span class="free">μ</span> <span class="main">(</span>neg_wtn <span class="free">E</span> <span class="skolem">n</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹ereal <span class="main">(</span><span class="main">1</span> <span class="main">/</span> real <span class="main">(</span>num_wtn <span class="free">E</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="main">-</span> <span class="free">μ</span> <span class="main">(</span>neg_wtn <span class="free">E</span> <span class="skolem">n</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">.</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="free">μ</span> <span class="main">(</span>neg_wtn <span class="free">E</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">≠</span> <span class="main">∞</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> neg_wtn_infty<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">E</span></span> <span class="quoted"><span class="skolem">n</span></span><span class="main">]</span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span> <span class="main">/</span> real <span class="main">(</span>num_wtn <span class="free">E</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="main">-</span>real_of_ereal <span class="main">(</span> <span class="free">μ</span> <span class="main">(</span>neg_wtn <span class="free">E</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">-</span> suminf <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> real_of_ereal <span class="main">(</span><span class="free">μ</span> <span class="main">(</span>neg_wtn <span class="free">E</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> suminf_minus<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"summable <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> real_of_ereal <span class="main">(</span><span class="free">μ</span> <span class="main">(</span>neg_wtn <span class="free">E</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> neg_wtn_summable assms
        summable_minus<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">i</span><span class="main">.</span> real_of_ereal <span class="main">(</span><span class="free">μ</span> <span class="main">(</span>neg_wtn <span class="free">E</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">]</span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> summable_minus_iff<span class="main">)</span> 
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"suminf <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">1</span><span class="main">/</span><span class="main">(</span>num_wtn <span class="free">E</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> 
    <span class="main">-</span> suminf <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> real_of_ereal <span class="main">(</span><span class="free">μ</span> <span class="main">(</span>neg_wtn <span class="free">E</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">hence</span></span> a<span class="main">:</span>  <span class="quoted"><span class="quoted">"suminf <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> real_of_ereal <span class="main">(</span><span class="free">μ</span> <span class="main">(</span>neg_wtn <span class="free">E</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> 
    <span class="main">-</span> suminf <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">1</span><span class="main">/</span><span class="main">(</span>num_wtn <span class="free">E</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"suminf <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="free">μ</span> <span class="main">(</span>neg_wtn <span class="free">E</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> ereal <span class="main">(</span><span class="main">-</span>suminf <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">1</span><span class="main">/</span><span class="main">(</span>num_wtn <span class="free">E</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> sumeq<span class="main">:</span> <span class="quoted"><span class="quoted">"suminf <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> ereal <span class="main">(</span>real_of_ereal <span class="main">(</span><span class="free">μ</span> <span class="main">(</span>neg_wtn <span class="free">E</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
      suminf <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="main">(</span>real_of_ereal <span class="main">(</span><span class="free">μ</span> <span class="main">(</span>neg_wtn <span class="free">E</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sums_suminf_ereal<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"summable <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="main">-</span>real_of_ereal <span class="main">(</span><span class="free">μ</span> <span class="main">(</span>neg_wtn <span class="free">E</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> neg_wtn_summable assms
          summable_minus<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">i</span><span class="main">.</span> real_of_ereal <span class="main">(</span><span class="free">μ</span> <span class="main">(</span>neg_wtn <span class="free">E</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">]</span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> summable_minus_iff<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> real_of_ereal <span class="main">(</span><span class="free">μ</span> <span class="main">(</span>neg_wtn <span class="free">E</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">sums</span> 
        <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">.</span> real_of_ereal <span class="main">(</span><span class="free">μ</span> <span class="main">(</span>neg_wtn <span class="free">E</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> neg_wtn_summable<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">E</span></span><span class="main">]</span> assms summable_minus_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"suminf <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="free">μ</span> <span class="main">(</span>neg_wtn <span class="free">E</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
      suminf <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="main">(</span>real_of_ereal <span class="main">(</span><span class="free">μ</span> <span class="main">(</span>neg_wtn <span class="free">E</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> ereal <span class="main">(</span>real_of_ereal <span class="main">(</span><span class="free">μ</span> <span class="main">(</span>neg_wtn <span class="free">E</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">μ</span> <span class="main">(</span>neg_wtn <span class="free">E</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"ereal <span class="main">(</span>real_of_ereal <span class="main">(</span><span class="free">μ</span> <span class="main">(</span>neg_wtn <span class="free">E</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">μ</span> <span class="main">(</span>neg_wtn <span class="free">E</span> <span class="skolem">i</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> neg_wtn_infty<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">E</span></span><span class="main">]</span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ereal_real'<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> sumeq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> a <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Hahn_Jordan_Decomposition-union_wit_meas_le"><span class="command">lemma</span></span> union_wit_meas_le<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">E</span> <span class="main">∈</span> sets <span class="free">M</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="free">μ</span> <span class="free">E</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="main">∞</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">μ</span> <span class="main">(</span>union_wit <span class="free">E</span><span class="main">)</span> <span class="main">≤</span> <span class="main">-</span> suminf <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> real <span class="main">(</span>num_wtn <span class="free">E</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">μ</span> <span class="main">(</span>union_wit <span class="free">E</span><span class="main">)</span> <span class="main">=</span> <span class="free">μ</span> <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span>range <span class="main">(</span>neg_wtn <span class="free">E</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> union_wit_def 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">.</span> <span class="free">μ</span> <span class="main">(</span>neg_wtn <span class="free">E</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> signed_measure_inf_sum<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"signed_measure <span class="free">M</span> <span class="free">μ</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> sgn_meas <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"range <span class="main">(</span>neg_wtn <span class="free">E</span><span class="main">)</span> <span class="main">⊆</span> sets <span class="free">M</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> image_subset_iff neg_wtn_def rep_neg_sets<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"disjoint_family <span class="main">(</span>neg_wtn <span class="free">E</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> neg_wtn_djn <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋃</span> <span class="main">(</span>range <span class="main">(</span>neg_wtn <span class="free">E</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> sets <span class="free">M</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> union_wit_sets 
      <span class="keyword1"><span class="command">unfolding</span></span> union_wit_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">-</span> suminf <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> real <span class="main">(</span>num_wtn <span class="free">E</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms neg_wtn_meas_suminf_le <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Hahn_Jordan_Decomposition-pos_sub_pos_meas"><span class="command">lemma</span></span> pos_sub_pos_meas<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">E</span> <span class="main">∈</span> sets <span class="free">M</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="free">μ</span> <span class="free">E</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="main">∞</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">μ</span> <span class="free">E</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> pos_meas_set <span class="free">E</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">μ</span> <span class="main">(</span>pos_sub <span class="free">E</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">μ</span> <span class="free">E</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">μ</span> <span class="main">(</span>pos_sub <span class="free">E</span><span class="main">)</span> <span class="main">+</span> <span class="free">μ</span> <span class="main">(</span>union_wit <span class="free">E</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">E</span> <span class="main">=</span> pos_sub <span class="free">E</span> <span class="main">∪</span> <span class="main">(</span>union_wit <span class="free">E</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> pos_sub_diff<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">E</span></span><span class="main">]</span> union_wit_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span> 
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"pos_sub <span class="free">E</span> <span class="main">∩</span> union_wit <span class="free">E</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> pos_sub_diff <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
      <span class="keyword1"><span class="command">using</span></span> signed_measure_add<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">M</span></span> <span class="quoted"><span class="free">μ</span></span> <span class="quoted"><span class="quoted">"pos_sub <span class="free">E</span>"</span></span> <span class="quoted"><span class="quoted">"union_wit <span class="free">E</span>"</span></span><span class="main">]</span> 
        pos_sub_sets union_wit_sets assms sgn_meas <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">μ</span> <span class="main">(</span>pos_sub <span class="free">E</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">-</span> suminf <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> real <span class="main">(</span>num_wtn <span class="free">E</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">μ</span> <span class="main">(</span>union_wit <span class="free">E</span><span class="main">)</span> <span class="main">≤</span> <span class="main">-</span> suminf <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> real <span class="main">(</span>num_wtn <span class="free">E</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> union_wit_meas_le<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">E</span></span><span class="main">]</span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> union_wit_infty assms <span class="keyword1"><span class="command">using</span></span> add_left_mono <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">μ</span> <span class="main">(</span>pos_sub <span class="free">E</span><span class="main">)</span> <span class="main">-</span> suminf <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> real <span class="main">(</span>num_wtn <span class="free">E</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> minus_ereal_def<span class="main">)</span> 
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">μ</span> <span class="main">(</span>pos_sub <span class="free">E</span><span class="main">)</span> <span class="main">-</span> suminf <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> real <span class="main">(</span>num_wtn <span class="free">E</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> suminf <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> real <span class="main">(</span>num_wtn <span class="free">E</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> suminf_pos2<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="main">1</span> <span class="main">/</span> real <span class="main">(</span>num_wtn <span class="free">E</span> <span class="main">0</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> inf_neg_ge_1<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">E</span></span><span class="main">]</span> assms pos_wtn_base <span class="keyword1"><span class="command">unfolding</span></span> num_wtn_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="main">0</span> <span class="main">≤</span> <span class="main">1</span> <span class="main">/</span> real <span class="main">(</span>num_wtn <span class="free">E</span> <span class="bound">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"summable <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> real <span class="main">(</span>num_wtn <span class="free">E</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> assms inv_num_wtn_summable <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>  <span class="keyword1"><span class="command">using</span></span> pos_sub_infty assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Hahn_Jordan_Decomposition-num_wtn_conv"><span class="command">lemma</span></span> num_wtn_conv<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">E</span> <span class="main">∈</span> sets <span class="free">M</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="free">μ</span> <span class="free">E</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="main">∞</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">1</span><span class="main">/</span><span class="main">(</span>num_wtn <span class="free">E</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">⇢</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> summable_LIMSEQ_zero<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"summable <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> real <span class="main">(</span>num_wtn <span class="free">E</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms inv_num_wtn_summable <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Hahn_Jordan_Decomposition-num_wtn_shift_conv"><span class="command">lemma</span></span> num_wtn_shift_conv<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">E</span> <span class="main">∈</span> sets <span class="free">M</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="free">μ</span> <span class="free">E</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="main">∞</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">1</span><span class="main">/</span><span class="main">(</span>num_wtn <span class="free">E</span> <span class="bound">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">⇢</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> summable_LIMSEQ_zero<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"summable <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> real <span class="main">(</span>num_wtn <span class="free">E</span> <span class="bound">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms inv_num_wtn_shift_summable <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Hahn_Jordan_Decomposition-inf_neg_E_set"><span class="command">lemma</span></span> inf_neg_E_set<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> inf_neg <span class="free">E</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">E</span> <span class="main">∈</span> sets <span class="free">M</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> inf_neg_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>

<span class="keyword1" id="Hahn_Jordan_Decomposition-inf_neg_pos_meas"><span class="command">lemma</span></span> inf_neg_pos_meas<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> inf_neg <span class="free">E</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> pos_meas_set <span class="free">E</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> inf_neg_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>

<span class="keyword1" id="Hahn_Jordan_Decomposition-inf_neg_mem"><span class="command">lemma</span></span> inf_neg_mem<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> inf_neg <span class="free">E</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"inf_neg <span class="free">E</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">n</span><span class="main">::</span>nat<span class="main">|</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">≤</span> <span class="bound">n</span> <span class="main">∧</span> 
    <span class="main">(</span><span class="main">∃</span><span class="bound">B</span> <span class="main">∈</span> sets <span class="free">M</span><span class="main">.</span> <span class="bound">B</span>  <span class="main">⊆</span> <span class="free">E</span> <span class="main">∧</span> <span class="free">μ</span> <span class="bound">B</span> <span class="main">&lt;</span> ereal <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">/</span><span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">E</span> <span class="main">∈</span> sets <span class="free">M</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> inf_neg_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> pos_meas_set <span class="free">E</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> inf_neg_def 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">n</span><span class="main">::</span>nat<span class="main">|</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">≤</span> <span class="bound">n</span> <span class="main">∧</span> 
    <span class="main">(</span><span class="main">∃</span><span class="bound">B</span> <span class="main">∈</span> sets <span class="free">M</span><span class="main">.</span> <span class="bound">B</span>  <span class="main">⊆</span> <span class="free">E</span> <span class="main">∧</span> <span class="free">μ</span> <span class="bound">B</span> <span class="main">&lt;</span> ereal <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">/</span><span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">}</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> inf_neg_ne<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">E</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> inf_neg_def 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> Inf_nat_def1 <span class="quoted"><span class="quoted">‹<span class="free">E</span> <span class="main">∈</span> sets <span class="free">M</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> pos_meas_set <span class="free">E</span>›</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Hahn_Jordan_Decomposition-prec_inf_neg_pos"><span class="command">lemma</span></span> prec_inf_neg_pos<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> inf_neg <span class="free">E</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">∈</span> sets <span class="free">M</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span><span class="main">⊆</span> <span class="free">E</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">1</span><span class="main">/</span><span class="main">(</span>inf_neg <span class="free">E</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">≤</span> <span class="free">μ</span> <span class="free">B</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">S</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span> <span class="main">=</span> <span class="main">{</span><span class="bound">p</span><span class="main">::</span>nat<span class="main">|</span><span class="bound">p</span><span class="main">.</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">≤</span> <span class="bound">p</span> <span class="main">∧</span> 
    <span class="main">(</span><span class="main">∃</span><span class="bound">B</span> <span class="main">∈</span> sets <span class="free">M</span><span class="main">.</span> <span class="bound">B</span>  <span class="main">⊆</span> <span class="free">E</span> <span class="main">∧</span> <span class="free">μ</span> <span class="bound">B</span> <span class="main">&lt;</span> ereal <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">/</span><span class="bound">p</span><span class="main">)</span><span class="main">)</span><span class="main">}</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> ereal <span class="main">(</span><span class="main">-</span> <span class="main">1</span> <span class="main">/</span> real <span class="main">(</span>inf_neg <span class="free">E</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="free">μ</span> <span class="free">B</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">μ</span> <span class="free">B</span> <span class="main">&lt;</span> <span class="main">-</span><span class="main">1</span><span class="main">/</span><span class="main">(</span>inf_neg <span class="free">E</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"inf_neg <span class="free">E</span> <span class="main">-</span> <span class="main">1</span><span class="main">∈</span> <span class="skolem">S</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> S_def <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Suc <span class="main">0</span> <span class="main">&lt;</span> inf_neg <span class="free">E</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"inf_neg <span class="free">E</span> <span class="main">∈</span> <span class="skolem">S</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span>  S_def <span class="keyword1"><span class="command">using</span></span> inf_neg_mem<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">E</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inf_neg <span class="free">E</span> <span class="main">=</span> Inf <span class="skolem">S</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> S_def inf_neg_def 
    <span class="keyword1"><span class="command">using</span></span> assms inf_neg_E_set inf_neg_pos_meas <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span>  <span class="quoted"><span class="quoted">"inf_neg <span class="free">E</span> <span class="main">-</span> <span class="main">1</span> <span class="main">&lt;</span> inf_neg <span class="free">E</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"inf_neg <span class="free">E</span> <span class="main">-</span><span class="main">1</span> <span class="main">∉</span> <span class="skolem">S</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> cInf_less_iff<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">S</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="skolem">S</span> <span class="main">≠</span> <span class="main">{}</span>›</span></span> <span class="quoted"><span class="quoted">‹inf_neg <span class="free">E</span> <span class="main">=</span> Inf <span class="skolem">S</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹inf_neg <span class="free">E</span> <span class="main">-</span> <span class="main">1</span> <span class="main">∈</span> <span class="skolem">S</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Hahn_Jordan_Decomposition-pos_wtn_meas_ge"><span class="command">lemma</span></span> pos_wtn_meas_ge<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">E</span> <span class="main">∈</span> sets <span class="free">M</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="free">μ</span> <span class="free">E</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="main">∞</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">C</span><span class="main">∈</span> sets <span class="free">M</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="free">C</span><span class="main">⊆</span> pos_wtn <span class="free">E</span> <span class="bound">n</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> num_wtn <span class="free">E</span> <span class="bound">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">N</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">n</span></span><span class="main">≥</span> <span class="bound">N</span><span class="main">.</span> <span class="main">-</span> <span class="main">1</span><span class="main">/</span> <span class="main">(</span>num_wtn <span class="free">E</span> <span class="bound">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">≤</span> <span class="free">μ</span> <span class="free">C</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">N</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">n</span></span><span class="main">≥</span> <span class="bound">N</span><span class="main">.</span> <span class="main">1</span><span class="main">/</span><span class="main">(</span>num_wtn <span class="free">E</span> <span class="bound">n</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> num_wtn_conv<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">E</span></span><span class="main">]</span> 
      conv_0_half<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> real <span class="main">(</span>num_wtn <span class="free">E</span> <span class="bound">n</span><span class="main">)</span>"</span></span><span class="main">]</span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">N</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">n</span></span><span class="main">≥</span> <span class="skolem">N</span><span class="main">.</span> <span class="main">1</span><span class="main">/</span><span class="main">(</span>num_wtn <span class="free">E</span> <span class="bound">n</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">N</span> <span class="main">≤</span> <span class="skolem">n</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">/</span><span class="main">(</span>num_wtn <span class="free">E</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound"><span class="bound">n</span></span><span class="main">≥</span> <span class="skolem">N</span><span class="main">.</span> <span class="main">1</span><span class="main">/</span><span class="main">(</span>num_wtn <span class="free">E</span> <span class="bound">n</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">/</span><span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">1</span><span class="main">/</span><span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="main">(</span>num_wtn <span class="free">E</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> frac_less2<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">/</span> real <span class="main">(</span>num_wtn <span class="free">E</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">1</span><span class="main">/</span><span class="main">(</span>num_wtn <span class="free">E</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span>›</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> num_wtn <span class="free">E</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> num_wtn_def <span class="keyword1"><span class="command">using</span></span> inf_neg_ge_1 assms
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> num_wtn_def<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">&lt;</span> <span class="main">(</span>num_wtn <span class="free">E</span> <span class="skolem">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Suc <span class="main">0</span> <span class="main">&lt;</span> num_wtn <span class="free">E</span> <span class="skolem">n</span> <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> num_wtn_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="main">1</span><span class="main">/</span> <span class="main">(</span>num_wtn <span class="free">E</span> <span class="skolem">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">≤</span> <span class="free">μ</span> <span class="free">C</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms prec_inf_neg_pos 
      <span class="keyword1"><span class="command">unfolding</span></span> num_wtn_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Hahn_Jordan_Decomposition-pos_sub_pos_meas_subset"><span class="command">lemma</span></span> pos_sub_pos_meas_subset<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">E</span> <span class="main">∈</span> sets <span class="free">M</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="free">μ</span> <span class="free">E</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="main">∞</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">C</span><span class="main">∈</span> sets <span class="free">M</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">C</span><span class="main">⊆</span> <span class="main">(</span>pos_sub <span class="free">E</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> num_wtn <span class="free">E</span> <span class="bound">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="free">μ</span> <span class="free">C</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="free">C</span> <span class="main">⊆</span> pos_wtn <span class="free">E</span> <span class="bound">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> pos_sub_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">N</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">n</span></span><span class="main">≥</span> <span class="bound">N</span><span class="main">.</span> <span class="main">-</span> <span class="main">1</span><span class="main">/</span> <span class="main">(</span>num_wtn <span class="free">E</span> <span class="bound">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">≤</span> <span class="free">μ</span> <span class="free">C</span>"</span></span> <span class="keyword1"><span class="command">using</span></span>  assms  
      pos_wtn_meas_ge<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">E</span></span> <span class="quoted"><span class="free">C</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">N</span></span> <span class="keyword2"><span class="keyword">where</span></span> Nprop<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">n</span></span><span class="main">≥</span> <span class="skolem">N</span><span class="main">.</span> <span class="main">-</span> <span class="main">1</span><span class="main">/</span> <span class="main">(</span>num_wtn <span class="free">E</span> <span class="bound">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">≤</span> <span class="free">μ</span> <span class="free">C</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="free">μ</span> <span class="free">C</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> lim_mono<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">N</span> <span class="main">≤</span> <span class="bound">n</span> <span class="main">⟹</span> <span class="main">-</span> <span class="main">1</span><span class="main">/</span> <span class="main">(</span>num_wtn <span class="free">E</span> <span class="bound">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">μ</span> <span class="free">C</span><span class="main">)</span> <span class="bound">n</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> Nprop <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span>  <span class="main">(</span> <span class="main">1</span> <span class="main">/</span> real <span class="main">(</span>num_wtn <span class="free">E</span> <span class="bound">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⇢</span> <span class="main">0</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> assms num_wtn_shift_conv<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">E</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span>  <span class="main">(</span><span class="main">-</span> <span class="main">1</span> <span class="main">/</span> real <span class="main">(</span>num_wtn <span class="free">E</span> <span class="bound">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⇢</span> <span class="main">0</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> tendsto_minus<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> real <span class="main">(</span>num_wtn <span class="free">E</span> <span class="bound">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> ereal <span class="main">(</span><span class="main">-</span> <span class="main">1</span> <span class="main">/</span> real <span class="main">(</span>num_wtn <span class="free">E</span> <span class="bound">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⇢</span> <span class="main">0</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> zero_ereal_def<span class="main">)</span> 
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">μ</span> <span class="free">C</span><span class="main">)</span> <span class="main">⇢</span> <span class="free">μ</span> <span class="free">C</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Hahn_Jordan_Decomposition-pos_sub_pos_meas'"><span class="command">lemma</span></span> pos_sub_pos_meas'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">E</span> <span class="main">∈</span> sets <span class="free">M</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="free">μ</span> <span class="free">E</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="main">∞</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">μ</span> <span class="free">E</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> num_wtn <span class="free">E</span> <span class="bound">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">μ</span> <span class="main">(</span>pos_sub <span class="free">E</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">μ</span> <span class="free">E</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">μ</span> <span class="main">(</span>pos_sub <span class="free">E</span><span class="main">)</span> <span class="main">+</span> <span class="free">μ</span> <span class="main">(</span>union_wit <span class="free">E</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">E</span> <span class="main">=</span> pos_sub <span class="free">E</span> <span class="main">∪</span> <span class="main">(</span>union_wit <span class="free">E</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> pos_sub_diff<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">E</span></span><span class="main">]</span> union_wit_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span> 
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"pos_sub <span class="free">E</span> <span class="main">∩</span> union_wit <span class="free">E</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> pos_sub_diff <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
      <span class="keyword1"><span class="command">using</span></span> signed_measure_add<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">M</span></span> <span class="quoted"><span class="free">μ</span></span> <span class="quoted"><span class="quoted">"pos_sub <span class="free">E</span>"</span></span> <span class="quoted"><span class="quoted">"union_wit <span class="free">E</span>"</span></span><span class="main">]</span> 
        pos_sub_sets union_wit_sets assms sgn_meas <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">μ</span> <span class="main">(</span>pos_sub <span class="free">E</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">-</span> suminf <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> real <span class="main">(</span>num_wtn <span class="free">E</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">μ</span> <span class="main">(</span>union_wit <span class="free">E</span><span class="main">)</span> <span class="main">≤</span> <span class="main">-</span> suminf <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> real <span class="main">(</span>num_wtn <span class="free">E</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> union_wit_meas_le<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">E</span></span><span class="main">]</span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> union_wit_infty assms <span class="keyword1"><span class="command">using</span></span> add_left_mono <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">μ</span> <span class="main">(</span>pos_sub <span class="free">E</span><span class="main">)</span> <span class="main">-</span> suminf <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> real <span class="main">(</span>num_wtn <span class="free">E</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> minus_ereal_def<span class="main">)</span> 
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">μ</span> <span class="main">(</span>pos_sub <span class="free">E</span><span class="main">)</span> <span class="main">-</span> suminf <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> real <span class="main">(</span>num_wtn <span class="free">E</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> suminf <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> real <span class="main">(</span>num_wtn <span class="free">E</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> suminf_pos2<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="main">1</span> <span class="main">/</span> real <span class="main">(</span>num_wtn <span class="free">E</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="main">0</span> <span class="main">≤</span> <span class="main">1</span> <span class="main">/</span> real <span class="main">(</span>num_wtn <span class="free">E</span> <span class="bound">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"summable <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> real <span class="main">(</span>num_wtn <span class="free">E</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> assms inv_num_wtn_summable <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>  <span class="keyword1"><span class="command">using</span></span> pos_sub_infty assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We obtain the main result of this part on the existence of a positive subset.›</span></span>

<span class="keyword1" id="Hahn_Jordan_Decomposition-exists_pos_meas_subset"><span class="command">lemma</span></span> exists_pos_meas_subset<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">E</span> <span class="main">∈</span> sets <span class="free">M</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="free">μ</span> <span class="free">E</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="main">∞</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">μ</span> <span class="free">E</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">A</span><span class="main">.</span> <span class="bound">A</span> <span class="main">⊆</span> <span class="free">E</span> <span class="main">∧</span> pos_meas_set <span class="bound">A</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">μ</span> <span class="bound">A</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> num_wtn <span class="free">E</span> <span class="bound">n</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"pos_meas_set <span class="main">(</span>pos_sub <span class="free">E</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> pos_meas_setI<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"pos_sub <span class="free">E</span> <span class="main">∈</span> sets <span class="free">M</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> pos_sub_sets<span class="main">)</span> 
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">A</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">∈</span> sets <span class="free">M</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span><span class="main">⊆</span> pos_sub <span class="free">E</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="free">μ</span> <span class="skolem">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms True pos_sub_pos_meas_subset<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">E</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">μ</span> <span class="main">(</span>pos_sub <span class="free">E</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> pos_sub_pos_meas'<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">E</span></span><span class="main">]</span> True assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> pos_meas_set_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> pos_sub_subset<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">n</span><span class="main">.</span> num_wtn <span class="free">E</span> <span class="bound">n</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"num_wtn <span class="free">E</span> <span class="skolem">n</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"pos_wtn <span class="free">E</span> <span class="skolem">n</span> <span class="main">∉</span> sets <span class="free">M</span> <span class="main">∨</span> pos_meas_set <span class="main">(</span>pos_wtn <span class="free">E</span> <span class="skolem">n</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> inf_neg_ge_1 <span class="keyword1"><span class="command">unfolding</span></span> num_wtn_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"pos_meas_set <span class="main">(</span>pos_wtn <span class="free">E</span> <span class="skolem">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="free">E</span> <span class="main">∈</span> sets <span class="free">M</span>›</span></span> pos_wtn_sets<span class="main">)</span> 
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">μ</span> <span class="main">(</span>pos_wtn <span class="free">E</span> <span class="skolem">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> pos_wtn_meas_gt assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> pos_meas_set_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> pos_wtn_subset<span class="main">)</span>   
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹The Hahn decomposition theorem›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">seq_meas</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">seq_meas</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">f</span><span class="main">.</span> incseq <span class="bound">f</span> <span class="main">∧</span> range <span class="bound">f</span> <span class="main">⊆</span> pos_img  <span class="main">∧</span> <span class="main">⨆</span> pos_img <span class="main">=</span> <span class="main">⨆</span> range <span class="bound">f</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Hahn_Jordan_Decomposition-seq_meas_props"><span class="command">lemma</span></span> seq_meas_props<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"incseq seq_meas <span class="main">∧</span> range seq_meas <span class="main">⊆</span> pos_img <span class="main">∧</span> 
    <span class="main">⨆</span> pos_img <span class="main">=</span> <span class="main">⨆</span> range seq_meas"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> ex<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">f</span><span class="main">.</span> incseq <span class="bound">f</span> <span class="main">∧</span> range <span class="bound">f</span> <span class="main">⊆</span> pos_img  <span class="main">∧</span> <span class="main">⨆</span> pos_img <span class="main">=</span> <span class="main">⨆</span> range <span class="bound">f</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Extended_Real.Sup_countable_SUP<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"pos_img <span class="main">≠</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{}</span> <span class="main">∈</span> pos_sets"</span></span> <span class="keyword1"><span class="command">using</span></span> empty_pos_meas_set <span class="keyword1"><span class="command">unfolding</span></span> pos_sets_def 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">μ</span> <span class="main">{}</span> <span class="main">∈</span> pos_img"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> pos_img_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span> 
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?V</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="keyword1">SOME</span> <span class="bound">f</span><span class="main">.</span> incseq <span class="bound">f</span> <span class="main">∧</span> range <span class="bound">f</span> <span class="main">⊆</span> pos_img  <span class="main">∧</span> <span class="main">⨆</span> pos_img <span class="main">=</span> <span class="main">⨆</span> range <span class="bound">f</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> vprop<span class="main">:</span> <span class="quoted"><span class="quoted">"incseq <span class="var">?V</span> <span class="main">∧</span> range <span class="var">?V</span> <span class="main">⊆</span> pos_img <span class="main">∧</span> <span class="main">⨆</span> pos_img <span class="main">=</span> <span class="main">⨆</span> range <span class="var">?V</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> someI_ex<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">f</span><span class="main">.</span> incseq <span class="bound">f</span> <span class="main">∧</span> range <span class="bound">f</span> <span class="main">⊆</span> pos_img  <span class="main">∧</span> 
      <span class="main">⨆</span> pos_img <span class="main">=</span> <span class="main">⨆</span> range <span class="bound">f</span>"</span></span><span class="main">]</span> ex <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> seq_meas_def vprop <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">seq_meas_rep</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">seq_meas_rep</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">A</span><span class="main">.</span> <span class="bound">A</span><span class="main">∈</span> pos_sets <span class="main">∧</span> seq_meas <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span> <span class="free">μ</span> <span class="bound">A</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Hahn_Jordan_Decomposition-seq_meas_rep_ex"><span class="command">lemma</span></span> seq_meas_rep_ex<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"seq_meas_rep <span class="free">n</span> <span class="main">∈</span> pos_sets <span class="main">∧</span> <span class="free">μ</span> <span class="main">(</span>seq_meas_rep <span class="free">n</span><span class="main">)</span> <span class="main">=</span> seq_meas <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> ex<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">A</span><span class="main">.</span> <span class="bound">A</span> <span class="main">∈</span> pos_sets <span class="main">∧</span> seq_meas <span class="free">n</span> <span class="main">=</span> <span class="free">μ</span> <span class="bound">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> seq_meas_props
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>z3<span class="main"><span class="main">)</span></span> UNIV_I image_subset_iff mem_Collect_eq pos_img_def<span class="main">)</span> 
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?V</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="keyword1">SOME</span> <span class="bound">A</span><span class="main">.</span> <span class="bound">A</span><span class="main">∈</span> pos_sets <span class="main">∧</span> seq_meas <span class="free">n</span> <span class="main">=</span> <span class="free">μ</span> <span class="bound">A</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> vprop<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?V</span><span class="main">∈</span> pos_sets <span class="main">∧</span> seq_meas <span class="free">n</span> <span class="main">=</span> <span class="free">μ</span> <span class="var">?V</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> 
      someI_ex<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">A</span><span class="main">.</span> <span class="bound">A</span><span class="main">∈</span> pos_sets <span class="main">∧</span> seq_meas <span class="free">n</span> <span class="main">=</span> <span class="free">μ</span> <span class="bound">A</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">using</span></span> ex <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> seq_meas_rep_def vprop <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span> 
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Hahn_Jordan_Decomposition-seq_meas_rep_pos"><span class="command">lemma</span></span> seq_meas_rep_pos<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">E</span> <span class="main">∈</span> sets <span class="free">M</span><span class="main">.</span> <span class="free">μ</span> <span class="bound">E</span> <span class="main">&lt;</span> <span class="main">∞</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"pos_meas_set <span class="main">(</span><span class="main">⋃</span> <span class="bound">i</span><span class="main">.</span> seq_meas_rep <span class="bound">i</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> pos_meas_set_Union<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">" <span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> pos_meas_set <span class="main">(</span>seq_meas_rep <span class="bound">i</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> seq_meas_rep_ex signed_measure_space.pos_sets_def 
      signed_measure_space_axioms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> seq_meas_rep <span class="bound">i</span> <span class="main">∈</span> sets <span class="free">M</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pos_meas_setD1<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="free">μ</span> <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span>range seq_meas_rep<span class="main">)</span><span class="main">)</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="main">∞</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋃</span> <span class="main">(</span>range seq_meas_rep<span class="main">)</span><span class="main">)</span> <span class="main">∈</span> sets <span class="free">M</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sigma_algebra.countable_Union<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"sigma_algebra <span class="main">(</span>space <span class="free">M</span><span class="main">)</span> <span class="main">(</span>sets <span class="free">M</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sets.sigma_algebra_axioms<span class="main">)</span> 
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"countable <span class="main">(</span>range seq_meas_rep<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"range seq_meas_rep <span class="main">⊆</span> sets <span class="free">M</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> seq_meas_rep <span class="bound">i</span> <span class="main">∈</span> sets <span class="free">M</span>›</span></span> image_subset_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">μ</span> <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span>range seq_meas_rep<span class="main">)</span><span class="main">)</span> <span class="main">≥</span> <span class="main">0</span> "</span></span> 
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> pos_meas_set <span class="main">(</span>seq_meas_rep <span class="bound">i</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> seq_meas_rep <span class="bound">i</span> <span class="main">∈</span> sets <span class="free">M</span>›</span></span> 
        signed_measure_space.pos_meas_set_pos_lim signed_measure_space_axioms 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="quoted"><span class="quoted">‹<span class="main">⋃</span> <span class="main">(</span>range seq_meas_rep<span class="main">)</span> <span class="main">∈</span> sets <span class="free">M</span>›</span></span> abs_ereal_ge0  
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>   
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Hahn_Jordan_Decomposition-sup_seq_meas_rep"><span class="command">lemma</span></span> sup_seq_meas_rep<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">E</span> <span class="main">∈</span> sets <span class="free">M</span><span class="main">.</span> <span class="free">μ</span> <span class="bound">E</span> <span class="main">&lt;</span> <span class="main">∞</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨆</span> pos_img<span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span> <span class="bound">i</span><span class="main">.</span> seq_meas_rep <span class="bound">i</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">μ</span> <span class="free">A</span> <span class="main">=</span> <span class="free">S</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> pms<span class="main">:</span> <span class="quoted"><span class="quoted">"pos_meas_set <span class="main">(</span><span class="main">⋃</span> <span class="bound">i</span><span class="main">.</span> seq_meas_rep <span class="bound">i</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms seq_meas_rep_pos <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">μ</span> <span class="free">A</span> <span class="main">≤</span> <span class="free">S</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Sup_upper <span class="quoted"><span class="quoted">‹<span class="free">S</span> <span class="main">=</span> <span class="main">⨆</span> pos_img›</span></span> mem_Collect_eq 
        pos_img_def pos_meas_setD1 pos_sets_def assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>  
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="free">μ</span> <span class="free">A</span> <span class="main">=</span> <span class="free">μ</span> <span class="main">(</span><span class="free">A</span> <span class="main">-</span> seq_meas_rep <span class="bound">n</span><span class="main">)</span> <span class="main">+</span> <span class="free">μ</span> <span class="main">(</span>seq_meas_rep <span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">=</span> <span class="main">(</span><span class="free">A</span> <span class="main">-</span> seq_meas_rep <span class="skolem">n</span><span class="main">)</span> <span class="main">∪</span> seq_meas_rep <span class="skolem">n</span> "</span></span> 
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">A</span> <span class="main">=</span> <span class="main">⋃</span> <span class="main">(</span>range seq_meas_rep<span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">μ</span> <span class="free">A</span> <span class="main">=</span> <span class="free">μ</span> <span class="main">(</span><span class="main">(</span><span class="free">A</span> <span class="main">-</span> seq_meas_rep <span class="skolem">n</span><span class="main">)</span> <span class="main">∪</span> seq_meas_rep <span class="skolem">n</span><span class="main">)</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">μ</span> <span class="main">(</span><span class="free">A</span> <span class="main">-</span> seq_meas_rep <span class="skolem">n</span><span class="main">)</span> <span class="main">+</span> <span class="free">μ</span> <span class="main">(</span>seq_meas_rep <span class="skolem">n</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> signed_measure_add<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"signed_measure <span class="free">M</span> <span class="free">μ</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> sgn_meas <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"seq_meas_rep <span class="skolem">n</span> <span class="main">∈</span> sets <span class="free">M</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> pos_sets_def seq_meas_rep_ex <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">-</span> seq_meas_rep <span class="skolem">n</span> <span class="main">∈</span> sets <span class="free">M</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms pms pos_meas_setD1 sets.Diff<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">A</span> <span class="main">-</span> seq_meas_rep <span class="skolem">n</span><span class="main">)</span> <span class="main">∩</span> seq_meas_rep <span class="skolem">n</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">μ</span> <span class="free">A</span> <span class="main">=</span> <span class="free">μ</span> <span class="main">(</span><span class="free">A</span> <span class="main">-</span> seq_meas_rep <span class="skolem">n</span><span class="main">)</span> <span class="main">+</span> <span class="free">μ</span> <span class="main">(</span>seq_meas_rep <span class="skolem">n</span><span class="main">)</span>"</span></span><span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="free">μ</span> <span class="free">A</span> <span class="main">≥</span> <span class="free">μ</span> <span class="main">(</span>seq_meas_rep <span class="bound">n</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> 
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">μ</span> <span class="free">A</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> pms assms <span class="keyword1"><span class="command">unfolding</span></span> pos_meas_set_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">A</span> <span class="main">-</span> seq_meas_rep <span class="skolem">n</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"pos_meas_set <span class="main">(</span><span class="free">A</span> <span class="main">-</span> seq_meas_rep <span class="skolem">n</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">A</span> <span class="main">-</span> seq_meas_rep <span class="skolem">n</span><span class="main">)</span> <span class="main">∈</span> sets <span class="free">M</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> pms assms pos_meas_setD1 pos_sets_def seq_meas_rep_ex <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> pms assms <span class="keyword1"><span class="command">unfolding</span></span> pos_meas_set_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">μ</span> <span class="main">(</span><span class="free">A</span> <span class="main">-</span> seq_meas_rep <span class="skolem">n</span><span class="main">)</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> pos_meas_set_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">μ</span> <span class="main">(</span>seq_meas_rep <span class="skolem">n</span><span class="main">)</span> <span class="main">≤</span> <span class="free">μ</span> <span class="free">A</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="free">μ</span> <span class="free">A</span> <span class="main">=</span> <span class="free">μ</span> <span class="main">(</span><span class="free">A</span> <span class="main">-</span> seq_meas_rep <span class="bound">n</span><span class="main">)</span> <span class="main">+</span> <span class="free">μ</span> <span class="main">(</span>seq_meas_rep <span class="bound">n</span><span class="main">)</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ereal_le_add_self2<span class="main">)</span> 
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">μ</span> <span class="free">A</span> <span class="main">≥</span> <span class="main">(</span><span class="main">⨆</span> range seq_meas<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Sup_le_iff seq_meas_rep_ex<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨆</span> range seq_meas<span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> seq_meas_props <span class="quoted"><span class="quoted">‹<span class="free">S</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨆</span> pos_img<span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">μ</span> <span class="free">A</span> <span class="main">≥</span> <span class="free">S</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">μ</span> <span class="free">A</span> <span class="main">=</span> <span class="free">S</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">μ</span> <span class="free">A</span> <span class="main">≤</span> <span class="free">S</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Hahn_Jordan_Decomposition-seq_meas_rep_compl"><span class="command">lemma</span></span> seq_meas_rep_compl<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">E</span> <span class="main">∈</span> sets <span class="free">M</span><span class="main">.</span> <span class="free">μ</span> <span class="bound">E</span> <span class="main">&lt;</span> <span class="main">∞</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span> <span class="bound">i</span><span class="main">.</span> seq_meas_rep <span class="bound">i</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"neg_meas_set <span class="main">(</span><span class="main">(</span>space <span class="free">M</span><span class="main">)</span> <span class="main">-</span> <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> neg_meas_set_def
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> asm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span>space <span class="free">M</span> <span class="main">-</span> <span class="free">A</span> <span class="main">∈</span> sets <span class="free">M</span> <span class="main">∧</span> 
    <span class="main">(</span><span class="main">∀</span><span class="bound">Aa</span><span class="main">∈</span>sets <span class="free">M</span><span class="main">.</span> <span class="bound">Aa</span> <span class="main">⊆</span> space <span class="free">M</span> <span class="main">-</span> <span class="free">A</span> <span class="main">⟶</span> <span class="free">μ</span> <span class="bound">Aa</span> <span class="main">≤</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span> 
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">S</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨆</span> pos_img<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"pos_meas_set <span class="free">A</span>"</span></span>  <span class="keyword1"><span class="command">using</span></span> assms seq_meas_rep_pos <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">μ</span> <span class="free">A</span> <span class="main">=</span> <span class="skolem">S</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> sup_seq_meas_rep assms  S_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span> <span class="main">&lt;</span> <span class="main">∞</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="quoted"><span class="quoted">‹pos_meas_set <span class="free">A</span>›</span></span> pos_meas_setD1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>space <span class="free">M</span> <span class="main">-</span> <span class="free">A</span> <span class="main">∈</span> sets <span class="free">M</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹pos_meas_set <span class="free">A</span>›</span></span> pos_meas_setD1 sets.compl_sets<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">" <span class="main">¬</span><span class="main">(</span><span class="main">∀</span><span class="bound">Aa</span><span class="main">∈</span>sets <span class="free">M</span><span class="main">.</span> <span class="bound">Aa</span> <span class="main">⊆</span> space <span class="free">M</span> <span class="main">-</span> <span class="free">A</span> <span class="main">⟶</span> <span class="free">μ</span> <span class="bound">Aa</span> <span class="main">≤</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> asm <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">E</span> <span class="main">∈</span> sets <span class="free">M</span><span class="main">.</span> <span class="bound">E</span> <span class="main">⊆</span> <span class="main">(</span><span class="main">(</span>space <span class="free">M</span><span class="main">)</span> <span class="main">-</span> <span class="free">A</span><span class="main">)</span> <span class="main">∧</span> <span class="free">μ</span> <span class="bound">E</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> less_eq_ereal_def linear<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">E</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">E</span> <span class="main">∈</span> sets <span class="free">M</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">E</span> <span class="main">⊆</span> <span class="main">(</span><span class="main">(</span>space <span class="free">M</span><span class="main">)</span> <span class="main">-</span> <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
    <span class="quoted"><span class="quoted">"<span class="free">μ</span> <span class="skolem">E</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound"><span class="bound">A0</span></span> <span class="main">⊆</span> <span class="skolem">E</span><span class="main">.</span> pos_meas_set <span class="bound">A0</span> <span class="main">∧</span> <span class="free">μ</span> <span class="bound">A0</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> exists_pos_meas_subset<span class="main">)</span> 
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">E</span> <span class="main">∈</span> sets <span class="free">M</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">E</span> <span class="main">∈</span> sets <span class="free">M</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">μ</span> <span class="skolem">E</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">μ</span> <span class="skolem">E</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="free">μ</span> <span class="skolem">E</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="main">∞</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">μ</span> <span class="skolem">E</span> <span class="main">&lt;</span> <span class="main">∞</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="quoted"><span class="quoted">‹<span class="skolem">E</span> <span class="main">∈</span> sets <span class="free">M</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="main">∞</span> <span class="main">&lt;</span> <span class="free">μ</span> <span class="skolem">E</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> <span class="free">μ</span> <span class="skolem">E</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> ereal_infty_less<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> not_inftyI<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">A0</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A0</span> <span class="main">⊆</span> <span class="skolem">E</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"pos_meas_set <span class="skolem">A0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">" <span class="free">μ</span> <span class="skolem">A0</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"pos_meas_set <span class="main">(</span><span class="free">A</span> <span class="main">∪</span> <span class="skolem">A0</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> pos_meas_set_union <span class="quoted"><span class="quoted">‹pos_meas_set <span class="skolem">A0</span>›</span></span> <span class="quoted"><span class="quoted">‹pos_meas_set <span class="free">A</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">μ</span> <span class="main">(</span><span class="free">A</span> <span class="main">∪</span> <span class="skolem">A0</span><span class="main">)</span> <span class="main">=</span> <span class="free">μ</span> <span class="free">A</span> <span class="main">+</span> <span class="free">μ</span> <span class="skolem">A0</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> signed_measure_add<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"signed_measure <span class="free">M</span> <span class="free">μ</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> sgn_meas <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">∈</span> sets <span class="free">M</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹pos_meas_set <span class="free">A</span>›</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> pos_meas_set_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A0</span> <span class="main">∈</span> sets <span class="free">M</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹pos_meas_set <span class="skolem">A0</span>›</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> pos_meas_set_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">A</span> <span class="main">∩</span> <span class="skolem">A0</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">A0</span> <span class="main">⊆</span> <span class="skolem">E</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">E</span> <span class="main">⊆</span> <span class="main">(</span><span class="main">(</span>space <span class="free">M</span><span class="main">)</span> <span class="main">-</span> <span class="free">A</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">μ</span> <span class="main">(</span><span class="free">A</span> <span class="main">∪</span> <span class="skolem">A0</span><span class="main">)</span> <span class="main">&gt;</span> <span class="skolem">S</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">μ</span> <span class="free">A</span> <span class="main">=</span> <span class="skolem">S</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">μ</span> <span class="skolem">A0</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="skolem">S</span> <span class="main">&lt;</span> <span class="main">∞</span>›</span></span> <span class="quoted"><span class="quoted">‹pos_meas_set <span class="main">(</span><span class="free">A</span> <span class="main">∪</span> <span class="skolem">A0</span><span class="main">)</span>›</span></span> abs_ereal_ge0 ereal_between<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> 
        not_inftyI not_less_iff_gr_or_eq pos_meas_self<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">A</span> <span class="main">∪</span> <span class="skolem">A0</span><span class="main">)</span> <span class="main">∈</span> pos_sets"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" <span class="main">(</span><span class="free">A</span> <span class="main">∪</span> <span class="skolem">A0</span><span class="main">)</span> <span class="main">∈</span> sets <span class="free">M</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> sigma_algebra.countable_Union
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹pos_meas_set <span class="main">(</span><span class="free">A</span> <span class="main">∪</span> <span class="skolem">A0</span><span class="main">)</span>›</span></span> pos_meas_setD1<span class="main">)</span> 
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"pos_meas_set <span class="main">(</span><span class="free">A</span> <span class="main">∪</span> <span class="skolem">A0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹pos_meas_set <span class="main">(</span><span class="free">A</span> <span class="main">∪</span> <span class="skolem">A0</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> pos_sets_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">μ</span> <span class="main">(</span><span class="free">A</span> <span class="main">∪</span> <span class="skolem">A0</span><span class="main">)</span> <span class="main">∈</span> pos_img"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> pos_img_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">μ</span> <span class="main">(</span><span class="free">A</span> <span class="main">∪</span> <span class="skolem">A0</span><span class="main">)</span> <span class="main">&gt;</span> <span class="skolem">S</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">μ</span> <span class="main">(</span><span class="free">A</span> <span class="main">∪</span> <span class="skolem">A0</span><span class="main">)</span> <span class="main">∈</span> pos_img›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">S</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨆</span> pos_img<span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Sup_upper sup.absorb_iff2 sup.strict_order_iff<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Hahn_Jordan_Decomposition-hahn_decomp_finite"><span class="command">lemma</span></span> hahn_decomp_finite<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">E</span> <span class="main">∈</span> sets <span class="free">M</span><span class="main">.</span> <span class="free">μ</span> <span class="bound">E</span> <span class="main">&lt;</span> <span class="main">∞</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">M1</span> <span class="bound">M2</span><span class="main">.</span> hahn_space_decomp <span class="bound">M1</span> <span class="bound">M2</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> hahn_space_decomp_def
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">S</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨆</span> pos_img<span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">A</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span> <span class="bound">i</span><span class="main">.</span> seq_meas_rep <span class="bound">i</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"pos_meas_set <span class="skolem">A</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> A_def <span class="keyword1"><span class="command">using</span></span> assms seq_meas_rep_pos <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"neg_meas_set <span class="main">(</span><span class="main">(</span>space <span class="free">M</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">A</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> seq_meas_rep_compl assms <span class="keyword1"><span class="command">unfolding</span></span> A_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">M1</span> <span class="bound">M2</span><span class="main">.</span> pos_meas_set <span class="bound">M1</span> <span class="main">∧</span> neg_meas_set <span class="bound">M2</span> <span class="main">∧</span> space <span class="free">M</span> <span class="main">=</span> <span class="bound">M1</span> <span class="main">∪</span> <span class="bound">M2</span> <span class="main">∧</span> 
    <span class="bound">M1</span> <span class="main">∩</span> <span class="bound">M2</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> exI conjI<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"pos_meas_set <span class="skolem">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹pos_meas_set <span class="skolem">A</span>›</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"neg_meas_set <span class="main">(</span>space <span class="free">M</span> <span class="main">-</span> <span class="skolem">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹neg_meas_set <span class="main">(</span>space <span class="free">M</span> <span class="main">-</span> <span class="skolem">A</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"space <span class="free">M</span> <span class="main">=</span> <span class="skolem">A</span> <span class="main">∪</span> <span class="main">(</span>space <span class="free">M</span> <span class="main">-</span> <span class="skolem">A</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Diff_partition <span class="quoted"><span class="quoted">‹pos_meas_set <span class="skolem">A</span>›</span></span> inf.absorb_iff2 pos_meas_setD1 
          sets.Int_space_eq1<span class="main">)</span> 
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">∩</span> <span class="main">(</span>space <span class="free">M</span> <span class="main">-</span> <span class="skolem">A</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> hahn_decomposition<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">M1</span> <span class="bound">M2</span><span class="main">.</span> hahn_space_decomp <span class="bound">M1</span> <span class="bound">M2</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">E</span> <span class="main">∈</span> sets <span class="free">M</span><span class="main">.</span> <span class="free">μ</span> <span class="bound">E</span> <span class="main">&lt;</span> <span class="main">∞</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> hahn_decomp_finite <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">A</span> <span class="main">.</span> <span class="main">-</span> <span class="free">μ</span> <span class="bound">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">M1</span> <span class="bound">M2</span><span class="main">.</span> signed_measure_space.hahn_space_decomp <span class="free">M</span> <span class="skolem">m</span> <span class="bound">M1</span> <span class="bound">M2</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> signed_measure_space.hahn_decomp_finite<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"signed_measure_space <span class="free">M</span> <span class="skolem">m</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> signed_measure_minus sgn_meas <span class="quoted"><span class="quoted">‹<span class="skolem">m</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">A</span> <span class="main">.</span> <span class="main">-</span> <span class="free">μ</span> <span class="bound">A</span><span class="main">)</span>›</span></span>  
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">E</span><span class="main">∈</span>sets <span class="free">M</span><span class="main">.</span> <span class="skolem">m</span> <span class="bound">E</span> <span class="main">&lt;</span> <span class="main">∞</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">E</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">E</span> <span class="main">∈</span> sets <span class="free">M</span>"</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="skolem">E</span> <span class="main">&lt;</span> <span class="main">∞</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="skolem">E</span> <span class="main">≠</span> <span class="main">∞</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">m</span> <span class="skolem">E</span> <span class="main">≠</span> <span class="main">∞</span>"</span></span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="skolem">E</span> <span class="main">=</span> <span class="main">∞</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="skolem">m</span> <span class="skolem">E</span> <span class="main">≠</span> <span class="main">∞</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"signed_measure <span class="free">M</span> <span class="skolem">m</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹signed_measure_space <span class="free">M</span> <span class="skolem">m</span>›</span></span> signed_measure_space_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="skolem">E</span> <span class="main">=</span> <span class="main">-</span> <span class="free">μ</span> <span class="skolem">E</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">m</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">A</span> <span class="main">.</span> <span class="main">-</span> <span class="free">μ</span> <span class="bound">A</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∞</span> <span class="main">∉</span> range <span class="skolem">m</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹signed_measure <span class="free">M</span> <span class="skolem">m</span>›</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> False ereal_less_PInfty 
                ereal_uminus_eq_reorder image_iff inf_range m_def rangeI<span class="main">)</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">m</span> <span class="skolem">E</span> <span class="main">=</span> <span class="main">∞</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∞</span> <span class="main">∉</span> range <span class="skolem">m</span>›</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> rangeI<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">M1</span> <span class="bound">M2</span><span class="main">.</span> <span class="main">(</span>neg_meas_set <span class="bound">M1</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>pos_meas_set <span class="bound">M2</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>space <span class="free">M</span> <span class="main">=</span> <span class="bound">M1</span> <span class="main">∪</span> <span class="bound">M2</span><span class="main">)</span> <span class="main">∧</span>
    <span class="main">(</span><span class="bound">M1</span> <span class="main">∩</span> <span class="bound">M2</span> <span class="main">=</span> <span class="main">{}</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> pos_meas_set_opp neg_meas_set_opp <span class="keyword1"><span class="command">unfolding</span></span> m_def 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> sgn_meas signed_measure_minus signed_measure_space_def 
        signed_measure_space.hahn_space_decomp_def<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> hahn_space_decomp_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf_commute sup_commute<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹The Jordan decomposition theorem›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">jordan_decomp</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">jordan_decomp</span> <span class="free"><span class="bound"><span class="entity">m1</span></span></span> <span class="free"><span class="bound"><span class="entity">m2</span></span></span> <span class="main">⟷</span> <span class="main">(</span><span class="main">(</span>measure_space <span class="main">(</span>space <span class="free">M</span><span class="main">)</span> <span class="main">(</span>sets <span class="free">M</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">m1</span></span></span><span class="main">)</span> <span class="main">∧</span> 
    <span class="main">(</span>measure_space <span class="main">(</span>space <span class="free">M</span><span class="main">)</span> <span class="main">(</span>sets <span class="free">M</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">m2</span></span></span><span class="main">)</span> <span class="main">∧</span> 
    <span class="main">(</span><span class="main">∀</span><span class="bound">A</span><span class="main">∈</span> sets <span class="free">M</span><span class="main">.</span> <span class="main">0</span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">m1</span></span></span> <span class="bound">A</span><span class="main">)</span> <span class="main">∧</span>
    <span class="main">(</span><span class="main">∀</span> <span class="bound">A</span><span class="main">∈</span> sets <span class="free">M</span><span class="main">.</span> <span class="main">0</span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">m2</span></span></span> <span class="bound">A</span><span class="main">)</span> <span class="main">∧</span>
    <span class="main">(</span><span class="main">∀</span><span class="bound">A</span> <span class="main">∈</span> sets <span class="free">M</span><span class="main">.</span> <span class="free">μ</span> <span class="bound">A</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">m1</span></span></span> <span class="bound">A</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">m2</span></span></span> <span class="bound">A</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
    <span class="main">(</span><span class="main">∀</span> <span class="bound">P</span> <span class="bound">N</span> <span class="bound">A</span><span class="main">.</span> hahn_space_decomp <span class="bound">P</span> <span class="bound">N</span> <span class="main">⟶</span> 
      <span class="main">(</span><span class="bound">A</span> <span class="main">∈</span> sets <span class="free">M</span> <span class="main">⟶</span> <span class="bound">A</span> <span class="main">⊆</span> <span class="bound">P</span> <span class="main">⟶</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">m2</span></span></span> <span class="bound">A</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">∧</span> 
      <span class="main">(</span><span class="bound">A</span> <span class="main">∈</span> sets <span class="free">M</span> <span class="main">⟶</span> <span class="bound">A</span> <span class="main">⊆</span> <span class="bound">N</span> <span class="main">⟶</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">m1</span></span></span> <span class="bound">A</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
    <span class="main">(</span><span class="main">(</span><span class="main">∀</span><span class="bound">A</span> <span class="main">∈</span> sets <span class="free">M</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">m1</span></span></span> <span class="bound">A</span> <span class="main">&lt;</span> <span class="main">∞</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∀</span><span class="bound">A</span> <span class="main">∈</span> sets <span class="free">M</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">m2</span></span></span> <span class="bound">A</span> <span class="main">&lt;</span> <span class="main">∞</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Hahn_Jordan_Decomposition-jordan_decomp_pos_meas"><span class="command">lemma</span></span> jordan_decomp_pos_meas<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"jordan_decomp <span class="free">m1</span> <span class="free">m2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"hahn_space_decomp <span class="free">P</span> <span class="free">N</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">∈</span> sets <span class="free">M</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">m1</span> <span class="free">A</span> <span class="main">=</span> <span class="free">μ</span> <span class="main">(</span><span class="free">A</span> <span class="main">∩</span> <span class="free">P</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span><span class="main">∩</span><span class="free">P</span> <span class="main">∈</span> sets <span class="free">M</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> hahn_space_decomp_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pos_meas_setD1 sets.Int<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span><span class="main">∩</span> <span class="free">N</span> <span class="main">∈</span> sets <span class="free">M</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> hahn_space_decomp_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> neg_meas_setD1 sets.Int<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">A</span> <span class="main">∩</span> <span class="free">P</span><span class="main">)</span> <span class="main">∩</span> <span class="main">(</span><span class="free">A</span><span class="main">∩</span> <span class="free">N</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> hahn_space_decomp_def 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">=</span> <span class="main">(</span><span class="free">A</span> <span class="main">∩</span> <span class="free">P</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span><span class="free">A</span><span class="main">∩</span> <span class="free">N</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> hahn_space_decomp_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Int_Un_distrib sets.Int_space_eq2<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">m1</span> <span class="free">A</span> <span class="main">=</span> <span class="free">m1</span> <span class="main">(</span><span class="main">(</span><span class="free">A</span> <span class="main">∩</span> <span class="free">P</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span><span class="free">A</span><span class="main">∩</span> <span class="free">N</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">m1</span> <span class="main">(</span><span class="free">A</span> <span class="main">∩</span> <span class="free">P</span><span class="main">)</span> <span class="main">+</span> <span class="free">m1</span> <span class="main">(</span><span class="free">A</span> <span class="main">∩</span> <span class="free">N</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms pos_e2ennreal_additive<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">M</span></span> <span class="quoted"><span class="free">m1</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="free">A</span><span class="main">∩</span><span class="free">P</span> <span class="main">∈</span> sets <span class="free">M</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">A</span><span class="main">∩</span><span class="free">N</span> <span class="main">∈</span> sets <span class="free">M</span>›</span></span> 
      <span class="quoted"><span class="quoted">‹<span class="free">A</span> <span class="main">∩</span> <span class="free">P</span> <span class="main">∩</span> <span class="main">(</span><span class="free">A</span> <span class="main">∩</span> <span class="free">N</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>›</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> jordan_decomp_def additive_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">m1</span> <span class="main">(</span><span class="free">A</span> <span class="main">∩</span> <span class="free">P</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> jordan_decomp_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Int_lower2 <span class="quoted"><span class="quoted">‹<span class="free">A</span> <span class="main">∩</span> <span class="free">N</span> <span class="main">∈</span> sets <span class="free">M</span>›</span></span> add.right_neutral<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">m1</span> <span class="main">(</span><span class="free">A</span> <span class="main">∩</span> <span class="free">P</span><span class="main">)</span> <span class="main">-</span> <span class="free">m2</span> <span class="main">(</span><span class="free">A</span> <span class="main">∩</span> <span class="free">P</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> jordan_decomp_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Int_subset_iff <span class="quoted"><span class="quoted">‹<span class="free">A</span> <span class="main">∩</span> <span class="free">P</span> <span class="main">∈</span> sets <span class="free">M</span>›</span></span> ereal_minus<span class="main"><span class="main">(</span></span>7<span class="main"><span class="main">)</span></span> 
        local.pos_wtn_base pos_wtn_subset<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">μ</span> <span class="main">(</span><span class="free">A</span> <span class="main">∩</span> <span class="free">P</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="quoted"><span class="quoted">‹<span class="free">A</span> <span class="main">∩</span> <span class="free">P</span> <span class="main">∈</span> sets <span class="free">M</span>›</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> jordan_decomp_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Hahn_Jordan_Decomposition-jordan_decomp_neg_meas"><span class="command">lemma</span></span> jordan_decomp_neg_meas<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"jordan_decomp <span class="free">m1</span> <span class="free">m2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"hahn_space_decomp <span class="free">P</span> <span class="free">N</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">∈</span> sets <span class="free">M</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">m2</span> <span class="free">A</span> <span class="main">=</span> <span class="main">-</span><span class="free">μ</span> <span class="main">(</span><span class="free">A</span> <span class="main">∩</span> <span class="free">N</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span><span class="main">∩</span><span class="free">P</span> <span class="main">∈</span> sets <span class="free">M</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> hahn_space_decomp_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pos_meas_setD1 sets.Int<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span><span class="main">∩</span> <span class="free">N</span> <span class="main">∈</span> sets <span class="free">M</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> hahn_space_decomp_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> neg_meas_setD1 sets.Int<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">A</span> <span class="main">∩</span> <span class="free">P</span><span class="main">)</span> <span class="main">∩</span> <span class="main">(</span><span class="free">A</span><span class="main">∩</span> <span class="free">N</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> hahn_space_decomp_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">=</span> <span class="main">(</span><span class="free">A</span> <span class="main">∩</span> <span class="free">P</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span><span class="free">A</span><span class="main">∩</span> <span class="free">N</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> hahn_space_decomp_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Int_Un_distrib sets.Int_space_eq2<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">m2</span> <span class="free">A</span> <span class="main">=</span> <span class="free">m2</span> <span class="main">(</span><span class="main">(</span><span class="free">A</span> <span class="main">∩</span> <span class="free">P</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span><span class="free">A</span><span class="main">∩</span> <span class="free">N</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">m2</span> <span class="main">(</span><span class="free">A</span> <span class="main">∩</span> <span class="free">P</span><span class="main">)</span> <span class="main">+</span> <span class="free">m2</span> <span class="main">(</span><span class="free">A</span> <span class="main">∩</span> <span class="free">N</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> pos_e2ennreal_additive<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">M</span></span> <span class="quoted"><span class="free">m2</span></span><span class="main">]</span> assms
      <span class="quoted"><span class="quoted">‹<span class="free">A</span><span class="main">∩</span><span class="free">P</span> <span class="main">∈</span> sets <span class="free">M</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">A</span><span class="main">∩</span><span class="free">N</span> <span class="main">∈</span> sets <span class="free">M</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">A</span> <span class="main">∩</span> <span class="free">P</span> <span class="main">∩</span> <span class="main">(</span><span class="free">A</span> <span class="main">∩</span> <span class="free">N</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>›</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> jordan_decomp_def additive_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">m2</span> <span class="main">(</span><span class="free">A</span> <span class="main">∩</span> <span class="free">N</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> jordan_decomp_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Int_lower2 <span class="quoted"><span class="quoted">‹<span class="free">A</span> <span class="main">∩</span> <span class="free">P</span> <span class="main">∈</span> sets <span class="free">M</span>›</span></span> add.commute add.right_neutral<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">m2</span> <span class="main">(</span><span class="free">A</span> <span class="main">∩</span> <span class="free">N</span><span class="main">)</span> <span class="main">-</span> <span class="free">m1</span> <span class="main">(</span><span class="free">A</span> <span class="main">∩</span> <span class="free">N</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> jordan_decomp_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Int_lower2 <span class="quoted"><span class="quoted">‹<span class="free">A</span> <span class="main">∩</span> <span class="free">N</span> <span class="main">∈</span> sets <span class="free">M</span>›</span></span> ereal_minus<span class="main"><span class="main">(</span></span>7<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">-</span><span class="free">μ</span> <span class="main">(</span><span class="free">A</span> <span class="main">∩</span> <span class="free">N</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="quoted"><span class="quoted">‹<span class="free">A</span> <span class="main">∩</span> <span class="free">P</span> <span class="main">∈</span> sets <span class="free">M</span>›</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> jordan_decomp_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Diff_cancel Diff_eq_empty_iff Int_Un_eq<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹<span class="free">A</span> <span class="main">∩</span> <span class="free">N</span> <span class="main">∈</span> sets <span class="free">M</span>›</span></span> 
        <span class="quoted"><span class="quoted">‹<span class="free">m2</span> <span class="main">(</span><span class="free">A</span> <span class="main">∩</span> <span class="free">N</span><span class="main">)</span> <span class="main">=</span> <span class="free">m2</span> <span class="main">(</span><span class="free">A</span> <span class="main">∩</span> <span class="free">N</span><span class="main">)</span> <span class="main">-</span> <span class="free">m1</span> <span class="main">(</span><span class="free">A</span> <span class="main">∩</span> <span class="free">N</span><span class="main">)</span>›</span></span> ereal_minus<span class="main"><span class="main">(</span></span>8<span class="main"><span class="main">)</span></span> 
        ereal_uminus_eq_reorder sup.bounded_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Hahn_Jordan_Decomposition-pos_inter_neg_0"><span class="command">lemma</span></span> pos_inter_neg_0<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"hahn_space_decomp <span class="free">M1</span> <span class="free">M2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"hahn_space_decomp <span class="free">P</span> <span class="free">N</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">∈</span> sets <span class="free">M</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">⊆</span> <span class="free">N</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">μ</span> <span class="main">(</span><span class="free">A</span> <span class="main">∩</span> <span class="free">M1</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">μ</span> <span class="main">(</span><span class="free">A</span> <span class="main">∩</span> <span class="free">M1</span><span class="main">)</span> <span class="main">=</span> <span class="free">μ</span> <span class="main">(</span><span class="free">A</span> <span class="main">∩</span> <span class="main">(</span><span class="main">(</span><span class="free">M1</span> <span class="main">∩</span> <span class="free">P</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span><span class="free">M1</span> <span class="main">∩</span> <span class="main">(</span>sym_diff <span class="free">M1</span> <span class="free">P</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Diff_subset_conv Int_Un_distrib Un_upper1 inf.orderE<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">μ</span> <span class="main">(</span><span class="main">(</span><span class="free">A</span> <span class="main">∩</span> <span class="main">(</span><span class="free">M1</span> <span class="main">∩</span> <span class="free">P</span><span class="main">)</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span><span class="free">A</span> <span class="main">∩</span> <span class="main">(</span><span class="free">M1</span> <span class="main">∩</span> <span class="main">(</span>sym_diff <span class="free">M1</span> <span class="free">P</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Int_Un_distrib<span class="main">)</span> 
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">μ</span> <span class="main">(</span><span class="free">A</span> <span class="main">∩</span> <span class="main">(</span><span class="free">M1</span> <span class="main">∩</span> <span class="free">P</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="free">μ</span> <span class="main">(</span><span class="free">A</span> <span class="main">∩</span> <span class="main">(</span><span class="free">M1</span> <span class="main">∩</span> <span class="main">(</span>sym_diff <span class="free">M1</span> <span class="free">P</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> signed_measure_add<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"signed_measure <span class="free">M</span> <span class="free">μ</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> sgn_meas <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">∩</span> <span class="main">(</span><span class="free">M1</span> <span class="main">∩</span> <span class="free">P</span><span class="main">)</span> <span class="main">∈</span> sets <span class="free">M</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> hahn_space_decomp_def sets.Int 
          signed_measure_space.pos_meas_setD1 signed_measure_space_axioms<span class="main">)</span> 
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">∩</span> <span class="main">(</span><span class="free">M1</span> <span class="main">∩</span> sym_diff <span class="free">M1</span> <span class="free">P</span><span class="main">)</span> <span class="main">∈</span> sets <span class="free">M</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> Diff_subset assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> hahn_space_decomp_def 
          pos_meas_setD1 pos_meas_set_union pos_meas_subset sets.Diff sets.Int<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">∩</span> <span class="main">(</span><span class="free">M1</span> <span class="main">∩</span> <span class="free">P</span><span class="main">)</span> <span class="main">∩</span> <span class="main">(</span><span class="free">A</span> <span class="main">∩</span> <span class="main">(</span><span class="free">M1</span> <span class="main">∩</span> sym_diff <span class="free">M1</span> <span class="free">P</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">μ</span> <span class="main">(</span><span class="free">A</span> <span class="main">∩</span> <span class="main">(</span><span class="free">M1</span> <span class="main">∩</span> <span class="main">(</span>sym_diff <span class="free">M1</span> <span class="free">P</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">∩</span> <span class="main">(</span><span class="free">M1</span> <span class="main">∩</span> <span class="free">P</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms hahn_space_decomp_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> signed_measure_empty<span class="main">[</span><span class="operator">OF</span> sgn_meas<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> hahn_decomp_ess_unique<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> 
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">∩</span> <span class="main">(</span><span class="free">M1</span> <span class="main">∩</span> sym_diff <span class="free">M1</span> <span class="free">P</span><span class="main">)</span> <span class="main">⊆</span> sym_diff <span class="free">M1</span> <span class="free">P</span> <span class="main">∪</span> sym_diff <span class="free">M2</span> <span class="free">N</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">∩</span> <span class="main">(</span><span class="free">M1</span> <span class="main">∩</span> sym_diff <span class="free">M1</span> <span class="free">P</span><span class="main">)</span> <span class="main">∈</span> sets <span class="free">M</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sym_diff <span class="free">M1</span> <span class="free">P</span> <span class="main">∈</span> sets <span class="free">M</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> hahn_space_decomp_def sets.Diff sets.Un 
            signed_measure_space.pos_meas_setD1 signed_measure_space_axioms<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">M1</span> <span class="main">∩</span> sym_diff <span class="free">M1</span> <span class="free">P</span> <span class="main">∈</span> sets <span class="free">M</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> hahn_space_decomp_def pos_meas_setD1 sets.Int<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms sets.Int<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Hahn_Jordan_Decomposition-neg_inter_pos_0"><span class="command">lemma</span></span> neg_inter_pos_0<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"hahn_space_decomp <span class="free">M1</span> <span class="free">M2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"hahn_space_decomp <span class="free">P</span> <span class="free">N</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">∈</span> sets <span class="free">M</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">⊆</span> <span class="free">P</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">μ</span> <span class="main">(</span><span class="free">A</span> <span class="main">∩</span> <span class="free">M2</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">μ</span> <span class="main">(</span><span class="free">A</span> <span class="main">∩</span> <span class="free">M2</span><span class="main">)</span> <span class="main">=</span> <span class="free">μ</span> <span class="main">(</span><span class="free">A</span> <span class="main">∩</span> <span class="main">(</span><span class="main">(</span><span class="free">M2</span> <span class="main">∩</span> <span class="free">N</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span><span class="free">M2</span> <span class="main">∩</span> <span class="main">(</span>sym_diff <span class="free">M2</span> <span class="free">N</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Diff_subset_conv Int_Un_distrib Un_upper1 inf.orderE<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">μ</span> <span class="main">(</span><span class="main">(</span><span class="free">A</span> <span class="main">∩</span> <span class="main">(</span><span class="free">M2</span> <span class="main">∩</span> <span class="free">N</span><span class="main">)</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span><span class="free">A</span> <span class="main">∩</span> <span class="main">(</span><span class="free">M2</span> <span class="main">∩</span> <span class="main">(</span>sym_diff <span class="free">M2</span> <span class="free">N</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Int_Un_distrib<span class="main">)</span> 
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">μ</span> <span class="main">(</span><span class="free">A</span> <span class="main">∩</span> <span class="main">(</span><span class="free">M2</span> <span class="main">∩</span> <span class="free">N</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="free">μ</span> <span class="main">(</span><span class="free">A</span> <span class="main">∩</span> <span class="main">(</span><span class="free">M2</span> <span class="main">∩</span> <span class="main">(</span>sym_diff <span class="free">M2</span> <span class="free">N</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> signed_measure_add<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"signed_measure <span class="free">M</span> <span class="free">μ</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> sgn_meas <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">∩</span> <span class="main">(</span><span class="free">M2</span> <span class="main">∩</span> <span class="free">N</span><span class="main">)</span> <span class="main">∈</span> sets <span class="free">M</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> hahn_space_decomp_def sets.Int 
          signed_measure_space.neg_meas_setD1 signed_measure_space_axioms<span class="main">)</span> 
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">∩</span> <span class="main">(</span><span class="free">M2</span> <span class="main">∩</span> sym_diff <span class="free">M2</span> <span class="free">N</span><span class="main">)</span> <span class="main">∈</span> sets <span class="free">M</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> Diff_subset assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> hahn_space_decomp_def 
          neg_meas_setD1 neg_meas_set_union neg_meas_subset sets.Diff sets.Int<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">∩</span> <span class="main">(</span><span class="free">M2</span> <span class="main">∩</span> <span class="free">N</span><span class="main">)</span> <span class="main">∩</span> <span class="main">(</span><span class="free">A</span> <span class="main">∩</span> <span class="main">(</span><span class="free">M2</span> <span class="main">∩</span> sym_diff <span class="free">M2</span> <span class="free">N</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">μ</span> <span class="main">(</span><span class="free">A</span> <span class="main">∩</span> <span class="main">(</span><span class="free">M2</span> <span class="main">∩</span> <span class="main">(</span>sym_diff <span class="free">M2</span> <span class="free">N</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">∩</span> <span class="main">(</span><span class="free">M2</span> <span class="main">∩</span> <span class="free">N</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms hahn_space_decomp_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> signed_measure_empty<span class="main">[</span><span class="operator">OF</span> sgn_meas<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> hahn_decomp_ess_unique<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> 
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">∩</span> <span class="main">(</span><span class="free">M2</span> <span class="main">∩</span> sym_diff <span class="free">M2</span> <span class="free">N</span><span class="main">)</span> <span class="main">⊆</span> sym_diff <span class="free">M1</span> <span class="free">P</span> <span class="main">∪</span> sym_diff <span class="free">M2</span> <span class="free">N</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">∩</span> <span class="main">(</span><span class="free">M2</span> <span class="main">∩</span> sym_diff <span class="free">M2</span> <span class="free">N</span><span class="main">)</span> <span class="main">∈</span> sets <span class="free">M</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sym_diff <span class="free">M2</span> <span class="free">N</span> <span class="main">∈</span> sets <span class="free">M</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> hahn_space_decomp_def sets.Diff sets.Un 
            signed_measure_space.neg_meas_setD1 signed_measure_space_axioms<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">M2</span> <span class="main">∩</span> sym_diff <span class="free">M2</span> <span class="free">N</span> <span class="main">∈</span> sets <span class="free">M</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> hahn_space_decomp_def neg_meas_setD1 sets.Int<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms sets.Int<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Hahn_Jordan_Decomposition-jordan_decomposition"><span class="command">lemma</span></span> jordan_decomposition <span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">m1</span> <span class="bound">m2</span><span class="main">.</span> jordan_decomp <span class="bound">m1</span> <span class="bound">m2</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">M1</span> <span class="bound">M2</span><span class="main">.</span> hahn_space_decomp <span class="bound">M1</span> <span class="bound">M2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> hahn_decomposition 
    <span class="keyword1"><span class="command">unfolding</span></span> hahn_space_decomp_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">M1</span></span> <span class="skolem"><span class="skolem">M2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"hahn_space_decomp <span class="skolem">M1</span> <span class="skolem">M2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">note</span></span> Mprops <span class="main">=</span> this
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">m1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m1</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">A</span><span class="main">.</span> <span class="free">μ</span> <span class="main">(</span><span class="bound">A</span> <span class="main">∩</span> <span class="skolem">M1</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">m2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m2</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">A</span><span class="main">.</span> <span class="main">-</span><span class="free">μ</span> <span class="main">(</span><span class="bound">A</span> <span class="main">∩</span> <span class="skolem">M2</span><span class="main">)</span><span class="main">)</span>"</span></span>  
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> jordan_decomp_def
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> exI allI impI conjI ballI<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"measure_space <span class="main">(</span>space <span class="free">M</span><span class="main">)</span> <span class="main">(</span>sets <span class="free">M</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> e2ennreal <span class="main">(</span><span class="skolem">m1</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> pos_signed_to_meas_space Mprops m1_def 
      <span class="keyword1"><span class="command">unfolding</span></span> hahn_space_decomp_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"measure_space <span class="main">(</span>space <span class="free">M</span><span class="main">)</span> <span class="main">(</span>sets <span class="free">M</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> e2ennreal <span class="main">(</span><span class="skolem">m2</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> neg_signed_to_meas_space Mprops m2_def 
      <span class="keyword1"><span class="command">unfolding</span></span> hahn_space_decomp_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">A</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span><span class="main">∈</span> sets <span class="free">M</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="skolem">m1</span> <span class="skolem">A</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> m1_def <span class="keyword1"><span class="command">using</span></span> Mprops 
      <span class="keyword1"><span class="command">unfolding</span></span> hahn_space_decomp_def 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> inf_sup_ord<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> pos_meas_setD1 sets.Int 
          signed_measure_space.pos_measure_meas signed_measure_space_axioms<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">A</span> 
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span><span class="main">∈</span> sets <span class="free">M</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="skolem">m2</span> <span class="skolem">A</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> m2_def <span class="keyword1"><span class="command">using</span></span> Mprops 
      <span class="keyword1"><span class="command">unfolding</span></span> hahn_space_decomp_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ereal_0_le_uminus_iff inf_sup_ord<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> neg_meas_self 
          neg_meas_setD1 neg_meas_subset sets.Int<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">A</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">∈</span> sets <span class="free">M</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">μ</span> <span class="skolem">A</span> <span class="main">=</span> <span class="free">μ</span> <span class="main">(</span><span class="main">(</span><span class="skolem">A</span> <span class="main">∩</span> <span class="skolem">M1</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span><span class="skolem">A</span> <span class="main">∩</span> <span class="skolem">M2</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Mprops 
      <span class="keyword1"><span class="command">unfolding</span></span> hahn_space_decomp_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Int_Un_distrib <span class="quoted"><span class="quoted">‹<span class="skolem">A</span> <span class="main">∈</span> sets <span class="free">M</span>›</span></span> sets.Int_space_eq2<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">μ</span> <span class="main">(</span><span class="skolem">A</span> <span class="main">∩</span> <span class="skolem">M1</span><span class="main">)</span> <span class="main">+</span> <span class="free">μ</span> <span class="main">(</span><span class="skolem">A</span> <span class="main">∩</span> <span class="skolem">M2</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> signed_measure_add<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"signed_measure <span class="free">M</span> <span class="free">μ</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> sgn_meas <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">∩</span> <span class="skolem">M1</span> <span class="main">∈</span> sets <span class="free">M</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Mprops  <span class="quoted"><span class="quoted">‹<span class="skolem">A</span> <span class="main">∈</span> sets <span class="free">M</span>›</span></span> 
        <span class="keyword1"><span class="command">unfolding</span></span> hahn_space_decomp_def 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pos_meas_setD1 sets.Int<span class="main">)</span> 
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">∩</span> <span class="skolem">M2</span> <span class="main">∈</span> sets <span class="free">M</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Mprops <span class="quoted"><span class="quoted">‹<span class="skolem">A</span> <span class="main">∈</span> sets <span class="free">M</span>›</span></span> 
        <span class="keyword1"><span class="command">unfolding</span></span> hahn_space_decomp_def
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> neg_meas_setD1 sets.Int<span class="main">)</span> 
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">∩</span> <span class="skolem">M1</span> <span class="main">∩</span> <span class="main">(</span><span class="skolem">A</span> <span class="main">∩</span> <span class="skolem">M2</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Mprops 
        <span class="keyword1"><span class="command">unfolding</span></span> hahn_space_decomp_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="skolem">m1</span> <span class="skolem">A</span> <span class="main">-</span> <span class="skolem">m2</span> <span class="skolem">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> m1_def m2_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">μ</span> <span class="skolem">A</span> <span class="main">=</span> <span class="skolem">m1</span> <span class="skolem">A</span> <span class="main">-</span> <span class="skolem">m2</span> <span class="skolem">A</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>    
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">P</span> <span class="skolem">N</span> <span class="skolem">A</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"hahn_space_decomp <span class="skolem">P</span> <span class="skolem">N</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">∈</span> sets <span class="free">M</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">⊆</span> <span class="skolem">N</span>"</span></span> 
    <span class="keyword1"><span class="command">note</span></span> hn <span class="main">=</span> this
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">μ</span> <span class="main">(</span><span class="skolem">A</span> <span class="main">∩</span> <span class="skolem">M1</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> pos_inter_neg_0<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ hn<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"hahn_space_decomp <span class="skolem">M1</span> <span class="skolem">M2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Mprops 
        <span class="keyword1"><span class="command">unfolding</span></span> hahn_space_decomp_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m1</span> <span class="skolem">A</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> m1_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">P</span> <span class="skolem">N</span> <span class="skolem">A</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"hahn_space_decomp <span class="skolem">P</span> <span class="skolem">N</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">∈</span> sets <span class="free">M</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">⊆</span> <span class="skolem">P</span>"</span></span> 
    <span class="keyword1"><span class="command">note</span></span> hp <span class="main">=</span> this
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">μ</span> <span class="main">(</span><span class="skolem">A</span> <span class="main">∩</span> <span class="skolem">M2</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> neg_inter_pos_0<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ hp<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"hahn_space_decomp <span class="skolem">M1</span> <span class="skolem">M2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Mprops 
        <span class="keyword1"><span class="command">unfolding</span></span> hahn_space_decomp_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m2</span> <span class="skolem">A</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> m2_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">E</span><span class="main">∈</span>sets <span class="free">M</span><span class="main">.</span> <span class="skolem">m1</span> <span class="bound">E</span> <span class="main">&lt;</span> <span class="main">∞</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∀</span><span class="bound">E</span><span class="main">∈</span>sets <span class="free">M</span><span class="main">.</span> <span class="skolem">m2</span> <span class="bound">E</span> <span class="main">&lt;</span> <span class="main">∞</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">E</span> <span class="main">∈</span> sets <span class="free">M</span><span class="main">.</span> <span class="skolem">m1</span> <span class="bound">E</span> <span class="main">&lt;</span> <span class="main">∞</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">E</span> <span class="main">∈</span> sets <span class="free">M</span><span class="main">.</span> <span class="skolem">m2</span> <span class="bound">E</span> <span class="main">&lt;</span> <span class="main">∞</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">E</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">E</span> <span class="main">∈</span> sets <span class="free">M</span>"</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m2</span> <span class="skolem">E</span> <span class="main">&lt;</span> <span class="main">∞</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">m2</span> <span class="skolem">E</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span><span class="free">μ</span> <span class="main">(</span><span class="skolem">E</span> <span class="main">∩</span> <span class="skolem">M2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> m2_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>        
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≠</span> <span class="main">∞</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> False sgn_meas inf_range
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ereal_less_PInfty ereal_uminus_uminus m1_def rangeI<span class="main">)</span>
          <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m2</span> <span class="skolem">E</span> <span class="main">≠</span> <span class="main">∞</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> top.not_eq_extremum<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Hahn_Jordan_Decomposition-jordan_decomposition_unique"><span class="command">lemma</span></span> jordan_decomposition_unique <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"jordan_decomp <span class="free">m1</span> <span class="free">m2</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"jordan_decomp <span class="free">n1</span> <span class="free">n2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">∈</span> sets <span class="free">M</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">m1</span> <span class="free">A</span> <span class="main">=</span> <span class="free">n1</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">m2</span> <span class="free">A</span> <span class="main">=</span> <span class="free">n2</span> <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">M1</span> <span class="bound">M2</span><span class="main">.</span> hahn_space_decomp <span class="bound">M1</span> <span class="bound">M2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> hahn_decomposition <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">M1</span></span> <span class="skolem"><span class="skolem">M2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"hahn_space_decomp <span class="skolem">M1</span> <span class="skolem">M2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">note</span></span> mprop <span class="main">=</span> this
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">m1</span> <span class="free">A</span> <span class="main">=</span> <span class="free">μ</span> <span class="main">(</span><span class="free">A</span> <span class="main">∩</span> <span class="skolem">M1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms jordan_decomp_pos_meas mprop <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">n1</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms jordan_decomp_pos_meas<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">n1</span></span><span class="main">]</span> mprop 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">m1</span> <span class="free">A</span> <span class="main">=</span> <span class="free">n1</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">m2</span> <span class="free">A</span> <span class="main">=</span> <span class="main">-</span><span class="free">μ</span> <span class="main">(</span><span class="free">A</span> <span class="main">∩</span> <span class="skolem">M2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms jordan_decomp_neg_meas mprop <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">n2</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms jordan_decomp_neg_meas<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">n1</span></span><span class="main">]</span> mprop 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">m2</span> <span class="free">A</span> <span class="main">=</span> <span class="free">n2</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>
<span class="keyword2"><span class="keyword">end</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

</pre>
</div>