<div id="Residuated_Lattices">
<div class="head">
<h1>Theory Residuated_Lattices</h1>
</div>
<pre class="source"><span class="comment1">(* Title:      Residuated Lattices
   Author:     Victor Gomes &lt;vborgesferreiragomes1 at sheffield.ac.uk&gt;
   Maintainer: Georg Struth &lt;g.struth@sheffield.ac.uk&gt; 
*)</span>

<span class="keyword1"><span class="command">theory</span></span> Residuated_Lattices
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="../../kleene_algebra/theories/#Signatures">Kleene_Algebra.Signatures</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">notation</span></span>
  times <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">⋅</span>"</span> 70<span class="main">)</span>
  
<span class="keyword1"><span class="command">notation</span></span>
  bot <span class="main">(</span><span class="quoted">"<span class="keyword1">⊥</span>"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span>
  top <span class="main">(</span><span class="quoted">"<span class="keyword1">⊤</span>"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span>
  inf <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">⊓</span>"</span> 65<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span>
  sup <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">⊔</span>"</span> 65<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span>
  Inf <span class="main">(</span><span class="quoted">"<span class="keyword1">⨅</span>_"</span> <span class="main">[</span>900<span class="main">]</span> 900<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span>
  Sup <span class="main">(</span><span class="quoted">"<span class="keyword1">⨆</span>_"</span> <span class="main">[</span>900<span class="main">]</span> 900<span class="main">)</span>

<span class="keyword1"><span class="command">syntax</span></span>
  <span class="quoted">"_INF1"</span>     <span class="main">::</span> <span class="quoted"><span class="quoted">"pttrns <span class="main">⇒</span> <span class="tfree">'b</span> <span class="main">⇒</span> <span class="tfree">'b</span>"</span></span>           <span class="main">(</span><span class="quoted">"<span class="keyword3">(3</span><span class="keyword1">⨅</span>_<span class="keyword1">.</span><span class="keyword3">/ </span>_<span class="keyword3">)</span>"</span> <span class="main">[</span>0<span class="main">,</span> 10<span class="main">]</span> 10<span class="main">)</span>
  <span class="quoted">"_INF"</span>      <span class="main">::</span> <span class="quoted"><span class="quoted">"pttrn <span class="main">⇒</span> <span class="tfree">'a</span> set <span class="main">⇒</span> <span class="tfree">'b</span> <span class="main">⇒</span> <span class="tfree">'b</span>"</span></span>  <span class="main">(</span><span class="quoted">"<span class="keyword3">(3</span><span class="keyword1">⨅</span>_<span class="keyword1">∈</span>_<span class="keyword1">.</span><span class="keyword3">/ </span>_<span class="keyword3">)</span>"</span> <span class="main">[</span>0<span class="main">,</span> 0<span class="main">,</span> 10<span class="main">]</span> 10<span class="main">)</span>
  <span class="quoted">"_SUP1"</span>     <span class="main">::</span> <span class="quoted"><span class="quoted">"pttrns <span class="main">⇒</span> <span class="tfree">'b</span> <span class="main">⇒</span> <span class="tfree">'b</span>"</span></span>           <span class="main">(</span><span class="quoted">"<span class="keyword3">(3</span><span class="keyword1">⨆</span>_<span class="keyword1">.</span><span class="keyword3">/ </span>_<span class="keyword3">)</span>"</span> <span class="main">[</span>0<span class="main">,</span> 10<span class="main">]</span> 10<span class="main">)</span>
  <span class="quoted">"_SUP"</span>      <span class="main">::</span> <span class="quoted"><span class="quoted">"pttrn <span class="main">⇒</span> <span class="tfree">'a</span> set <span class="main">⇒</span> <span class="tfree">'b</span> <span class="main">⇒</span> <span class="tfree">'b</span>"</span></span>  <span class="main">(</span><span class="quoted">"<span class="keyword3">(3</span><span class="keyword1">⨆</span>_<span class="keyword1">∈</span>_<span class="keyword1">.</span><span class="keyword3">/ </span>_<span class="keyword3">)</span>"</span> <span class="main">[</span>0<span class="main">,</span> 0<span class="main">,</span> 10<span class="main">]</span> 10<span class="main">)</span>
  
<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Residuated Lattices›</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Residuated Functions on a Partial Order›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  We follow Galatos and \emph{al.} to define residuated funtions on
  partial orders. Material from articles by Maddux, and J{\'o}sson and Tsinakis are also considered.
  
  This development should in the future be expanded to functions or categories where the sources and targets have
  different type.

  Let $P$ be a partial order, or a poset.
  A map $f : P \to P$ is residuated if there exists a map
  $g: P \to P$ such that $f(x) \le y \Leftrightarrow x \le g(y)$
  for all $x, y \in P$.
  That is, they are adjoints of a Galois connection.
›</span></span>

<span class="keyword1"><span class="command">context</span></span> order <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">residuated_pair</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">residuated_pair</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">≡</span> <span class="main">∀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">(</span><span class="bound">x</span><span class="main">)</span> <span class="main">≤</span> <span class="bound">y</span> <span class="main">⟷</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span><span class="main">(</span><span class="bound">y</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">theorem</span></span> residuated_pairI <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≤</span> <span class="bound">y</span> <span class="main">⟶</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">f</span> <span class="bound">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≤</span> <span class="bound">y</span> <span class="main">⟶</span> <span class="free">g</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">g</span> <span class="bound">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≤</span> <span class="main">(</span><span class="free">g</span> <span class="keyword1">o</span> <span class="free">f</span><span class="main">)</span> <span class="bound">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">f</span> <span class="keyword1">o</span> <span class="free">g</span><span class="main">)</span> <span class="bound">x</span> <span class="main">≤</span> <span class="bound">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"residuated_pair <span class="free">f</span> <span class="free">g</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms comp_apply local.order_trans residuated_pair_def antisym<span class="main">)</span>
  
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">residuated</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">residuated</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">≡</span> <span class="main">∃</span><span class="bound">g</span><span class="main">.</span> residuated_pair <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">g</span>"</span></span>
  
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  If a map $f$ is residuated, then its residual $g$ is unique. 
›</span></span>

<span class="keyword1" id="Residuated_Lattices-residual_unique"><span class="command">lemma</span></span> residual_unique<span class="main">:</span> <span class="quoted"><span class="quoted">"residuated <span class="free">f</span> <span class="main">⟹</span> <span class="main">∃!</span><span class="bound">g</span><span class="main">.</span> residuated_pair <span class="free">f</span> <span class="bound">g</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> residuated_def residuated_pair_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ext eq_refl order.antisym<span class="main">)</span>
  
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Since the residual of a map $f$ is unique, it makes sense to 
  define a residual operator. 
›</span></span>
  
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">residual</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">residual</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">≡</span> <span class="keyword1">THE</span> <span class="bound">g</span><span class="main">.</span> residuated_pair <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">g</span>"</span></span>

<span class="keyword1" id="Residuated_Lattices-residual_galois"><span class="command">lemma</span></span> residual_galois<span class="main">:</span> <span class="quoted"><span class="quoted">"residuated <span class="free">f</span> <span class="main">⟹</span> <span class="free">f</span><span class="main">(</span><span class="free">x</span><span class="main">)</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">≤</span> residual <span class="free">f</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> residuated_def residuated_pair_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"residual <span class="free">f</span> <span class="main">=</span> <span class="improper">g</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> residual_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> the1_equality<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> residuated_def residuated_pair_def residual_unique<span class="main">)</span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> residuated_pair_def<span class="main">)</span>

<span class="keyword1" id="Residuated_Lattices-residual_galoisI1"><span class="command">lemma</span></span> residual_galoisI1<span class="main">:</span> <span class="quoted"><span class="quoted">"residuated <span class="free">f</span> <span class="main">⟹</span> <span class="free">f</span><span class="main">(</span><span class="free">x</span><span class="main">)</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">≤</span> residual <span class="free">f</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> residual_galois<span class="main">)</span>

<span class="keyword1" id="Residuated_Lattices-residual_galoisI2"><span class="command">lemma</span></span> residual_galoisI2<span class="main">:</span> <span class="quoted"><span class="quoted">"residuated <span class="free">f</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">≤</span> residual <span class="free">f</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">f</span><span class="main">(</span><span class="free">x</span><span class="main">)</span> <span class="main">≤</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> residual_galois<span class="main">)</span>
  
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  A closure operator on a poset is a map that is expansive, isotone and
  idempotent.
  The composition of the residual of a function $f$ with $f$ is a closure operator.
›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">closure</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">closure</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">x</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≤</span> <span class="bound">y</span> <span class="main">⟶</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">x</span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">y</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  
<span class="keyword1" id="Residuated_Lattices-res_c1"><span class="command">lemma</span></span> res_c1<span class="main">:</span> <span class="quoted"><span class="quoted">"residuated <span class="free">f</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">≤</span> residual <span class="free">f</span> <span class="main">(</span><span class="free">f</span> <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.order.refl residual_galois<span class="main">)</span>

<span class="keyword1" id="Residuated_Lattices-res_c2"><span class="command">lemma</span></span> res_c2<span class="main">:</span> <span class="quoted"><span class="quoted">"residuated <span class="free">f</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟹</span> residual <span class="free">f</span> <span class="main">(</span><span class="free">f</span> <span class="free">x</span><span class="main">)</span> <span class="main">≤</span> residual <span class="free">f</span> <span class="main">(</span><span class="free">f</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.order.refl local.order_trans residual_galois<span class="main">)</span>
  
<span class="keyword1" id="Residuated_Lattices-res_c3"><span class="command">lemma</span></span> res_c3<span class="main">:</span> <span class="quoted"><span class="quoted">"residuated <span class="free">f</span> <span class="main">⟹</span> residual <span class="free">f</span> <span class="main">(</span><span class="free">f</span> <span class="main">(</span>residual <span class="free">f</span> <span class="main">(</span><span class="free">f</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> residual <span class="free">f</span> <span class="main">(</span><span class="free">f</span> <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> order.eq_iff local.order_trans res_c1 residual_galois<span class="main">)</span>

<span class="keyword1" id="Residuated_Lattices-res_closure"><span class="command">lemma</span></span> res_closure<span class="main">:</span> <span class="quoted"><span class="quoted">"residuated <span class="free">f</span> <span class="main">⟹</span> closure <span class="main">(</span>residual <span class="free">f</span> <span class="keyword1">o</span> <span class="free">f</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> closure_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> res_c1 res_c2 res_c3<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Dually, an interior operator on a poset is a map that is contractive, isotone and
  idempotent.
  The composition of $f$ with its residual is an interior operator.
›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">interior</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">interior</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">x</span> <span class="main">≤</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≤</span> <span class="bound">y</span> <span class="main">⟶</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">x</span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">y</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">x</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Residuated_Lattices-res_i1"><span class="command">lemma</span></span> res_i1<span class="main">:</span> <span class="quoted"><span class="quoted">"residuated <span class="free">f</span> <span class="main">⟹</span> <span class="free">f</span> <span class="main">(</span>residual <span class="free">f</span> <span class="free">x</span><span class="main">)</span> <span class="main">≤</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.order.refl residual_galois<span class="main">)</span>
  
<span class="keyword1" id="Residuated_Lattices-res_i2"><span class="command">lemma</span></span> res_i2<span class="main">:</span> <span class="quoted"><span class="quoted">"residuated <span class="free">f</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">f</span> <span class="main">(</span>residual <span class="free">f</span> <span class="free">x</span><span class="main">)</span> <span class="main">≤</span> <span class="free">f</span> <span class="main">(</span>residual <span class="free">f</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.order.refl local.order_trans residual_galois<span class="main">)</span>
  
<span class="keyword1" id="Residuated_Lattices-res_i3"><span class="command">lemma</span></span> res_i3<span class="main">:</span> <span class="quoted"><span class="quoted">"residuated <span class="free">f</span> <span class="main">⟹</span> <span class="free">f</span> <span class="main">(</span>residual <span class="free">f</span> <span class="main">(</span><span class="free">f</span> <span class="main">(</span>residual <span class="free">f</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="main">(</span>residual <span class="free">f</span> <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.antisym_conv res_c1 res_c3 res_i1 residual_galois<span class="main">)</span>
  
<span class="keyword1" id="Residuated_Lattices-res_interior"><span class="command">lemma</span></span> res_interior<span class="main">:</span> <span class="quoted"><span class="quoted">"residuated <span class="free">f</span> <span class="main">⟹</span> interior <span class="main">(</span><span class="free">f</span> <span class="keyword1">o</span> residual <span class="free">f</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> interior_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> res_i1 res_i2 res_i3<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Next we show a few basic lemmas about residuated maps.›</span></span>

<span class="keyword1" id="Residuated_Lattices-res_iso"><span class="command">lemma</span></span> res_iso<span class="main">:</span> <span class="quoted"><span class="quoted">"residuated <span class="free">f</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">f</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">f</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.order.trans res_c1 residual_galois<span class="main">)</span>
  
<span class="keyword1" id="Residuated_Lattices-res_residual_iso"><span class="command">lemma</span></span> res_residual_iso<span class="main">:</span> <span class="quoted"><span class="quoted">"residuated <span class="free">f</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟹</span> residual <span class="free">f</span> <span class="free">x</span> <span class="main">≤</span> residual <span class="free">f</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.order.trans res_i1 residual_galois<span class="main">)</span>

<span class="keyword1" id="Residuated_Lattices-res_comp1"><span class="command">lemma</span></span> res_comp1 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"residuated <span class="free">f</span> <span class="main">⟹</span> <span class="free">f</span> <span class="keyword1">o</span> residual <span class="free">f</span> <span class="keyword1">o</span> <span class="free">f</span> <span class="main">=</span> <span class="free">f</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> resf<span class="main">:</span> <span class="quoted"><span class="quoted">"residuated <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">{</span></span> 
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="keyword1">o</span> residual <span class="free">f</span> <span class="keyword1">o</span> <span class="free">f</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">=</span> <span class="free">f</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> resf comp_apply order.eq_iff res_c1 res_i1 res_iso<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ext<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Residuated_Lattices-res_comp2"><span class="command">lemma</span></span> res_comp2 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"residuated <span class="free">f</span> <span class="main">⟹</span> residual <span class="free">f</span> <span class="keyword1">o</span> <span class="free">f</span> <span class="keyword1">o</span> residual <span class="free">f</span> <span class="main">=</span> residual <span class="free">f</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> resf<span class="main">:</span> <span class="quoted"><span class="quoted">"residuated <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">{</span></span> 
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>residual <span class="free">f</span> <span class="keyword1">o</span> <span class="free">f</span> <span class="keyword1">o</span> residual <span class="free">f</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">=</span> residual <span class="free">f</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> resf comp_apply order.eq_iff res_c1 res_i1 res_residual_iso<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ext<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* order *)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  A residuated function $f$ preserves all existing joins.
  Dually, its residual preserves all existing meets.
  We restrict our attention to semilattices, where binary joins or meets exist, and to
  complete lattices, where arbitrary joins and meets exist.
›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> semilattice_sup<span class="main">)</span> residuated_sup<span class="main">:</span> <span class="quoted"><span class="quoted">"residuated <span class="free">f</span> <span class="main">⟹</span> <span class="free">f</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="free">x</span> <span class="main">⊔</span> <span class="free">f</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> order.antisym<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> assm<span class="main">:</span> <span class="quoted"><span class="quoted">"residuated <span class="free">f</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span><span class="main">)</span> <span class="main">≤</span> <span class="free">f</span> <span class="free">x</span> <span class="main">⊔</span> <span class="free">f</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.residual_galoisI1 local.residual_galoisI2 local.sup.bounded_iff local.sup_ge1 local.sup_ge2<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">x</span> <span class="main">⊔</span> <span class="free">f</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">f</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assm local.res_iso local.sup.bounded_iff local.sup_ge1 local.sup_ge2<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> semilattice_inf<span class="main">)</span> residuated_inf<span class="main">:</span> <span class="quoted"><span class="quoted">"residuated <span class="free">f</span> <span class="main">⟹</span> residual <span class="free">f</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> residual <span class="free">f</span> <span class="free">x</span> <span class="main">⊓</span> residual <span class="free">f</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> order.antisym<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> assm<span class="main">:</span> <span class="quoted"><span class="quoted">"residuated <span class="free">f</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"residual <span class="free">f</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span><span class="main">)</span> <span class="main">≤</span> residual <span class="free">f</span> <span class="free">x</span> <span class="main">⊓</span> residual <span class="free">f</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.inf.boundedI local.inf.cobounded1 local.inf.cobounded2 local.res_residual_iso<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"residual <span class="free">f</span> <span class="free">x</span> <span class="main">⊓</span> residual <span class="free">f</span> <span class="free">y</span> <span class="main">≤</span> residual <span class="free">f</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assm local.inf.bounded_iff local.inf.cobounded1 local.inf.cobounded2 local.residual_galoisI1 local.residual_galoisI2<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">context</span></span> bounded_lattice <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Residuated_Lattices-residuated_strict"><span class="command">lemma</span></span> residuated_strict<span class="main">:</span> <span class="quoted"><span class="quoted">"residuated <span class="free">f</span> <span class="main">⟹</span> <span class="free">f</span> <span class="main">⊥</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.bot_least local.bot_unique local.res_i1 local.res_iso<span class="main">)</span>
  
<span class="keyword1" id="Residuated_Lattices-res_top"><span class="command">lemma</span></span> res_top<span class="main">:</span> <span class="quoted"><span class="quoted">"residuated <span class="free">f</span> <span class="main">⟹</span> residual <span class="free">f</span> <span class="main">⊤</span> <span class="main">=</span> <span class="main">⊤</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.residual_galoisI1 local.top_greatest local.top_unique<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">context</span></span> complete_lattice <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  On a complete lattice, a function $f$ is residuated if and only if
  it preserves arbitrary (possibly infinite) joins.
  Dually, a function $g$ is a residual of a residuated funtion $f$
  if and only if $g$ preserver arbitrary meets. 
›</span></span>

<span class="keyword1" id="Residuated_Lattices-residual_eq1"><span class="command">lemma</span></span> residual_eq1<span class="main">:</span> <span class="quoted"><span class="quoted">"residuated <span class="free">f</span> <span class="main">⟹</span> residual <span class="free">f</span> <span class="free">y</span> <span class="main">=</span> <span class="main">⨆</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">y</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> order.antisym<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> assm<span class="main">:</span> <span class="quoted"><span class="quoted">"residuated <span class="free">f</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"residual <span class="free">f</span> <span class="free">y</span> <span class="main">≤</span> <span class="main">⨆</span><span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">y</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> res_i1 <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> Sup_upper<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⨆</span><span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">y</span><span class="main">}</span> <span class="main">≤</span> residual <span class="free">f</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> assm <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> Sup_least residual_galoisI1<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Residuated_Lattices-residual_eq2"><span class="command">lemma</span></span> residual_eq2<span class="main">:</span> <span class="quoted"><span class="quoted">"residuated <span class="free">f</span> <span class="main">⟹</span> <span class="free">f</span> <span class="free">x</span> <span class="main">=</span> <span class="main">⨅</span> <span class="main">{</span><span class="bound">y</span><span class="main">.</span> <span class="free">x</span> <span class="main">≤</span> residual <span class="free">f</span> <span class="bound">y</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> order.antisym<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> assm<span class="main">:</span> <span class="quoted"><span class="quoted">"residuated <span class="free">f</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">x</span> <span class="main">≤</span> <span class="main">⨅</span><span class="main">{</span><span class="bound">y</span><span class="main">.</span> <span class="free">x</span> <span class="main">≤</span> residual <span class="free">f</span> <span class="bound">y</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> Inf_greatest residual_galoisI2<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⨅</span><span class="main">{</span><span class="bound">y</span><span class="main">.</span> <span class="free">x</span> <span class="main">≤</span> residual <span class="free">f</span> <span class="bound">y</span><span class="main">}</span> <span class="main">≤</span> <span class="free">f</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assm <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> res_c1 <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> Inf_lower<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Residuated_Lattices-residuated_Sup"><span class="command">lemma</span></span> residuated_Sup<span class="main">:</span> <span class="quoted"><span class="quoted">"residuated <span class="free">f</span> <span class="main">⟹</span> <span class="free">f</span><span class="main">(</span><span class="main">⨆</span> <span class="free">X</span><span class="main">)</span> <span class="main">=</span> <span class="main">⨆</span><span class="main">{</span><span class="free">f</span> <span class="bound">x</span> <span class="main">|</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">X</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> order.antisym<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> assm<span class="main">:</span> <span class="quoted"><span class="quoted">"residuated <span class="free">f</span>"</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> y_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">=</span> <span class="main">⨆</span><span class="main">{</span><span class="free">f</span> <span class="bound">x</span> <span class="main">|</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">X</span><span class="main">}</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="free">X</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">≤</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> y_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> Sup_upper<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="free">X</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≤</span> residual <span class="free">f</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> assm <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> residual_galoisI1<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">⨆</span><span class="free">X</span> <span class="main">≤</span> residual <span class="free">f</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> Sup_least<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span><span class="main">(</span><span class="main">⨆</span> <span class="free">X</span><span class="main">)</span> <span class="main">≤</span> <span class="main">⨆</span><span class="main">{</span><span class="free">f</span> <span class="bound">x</span> <span class="main">|</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">X</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> y_def assm residual_galoisI2<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> Sup_least res_iso Sup_upper<span class="main">)</span>

<span class="keyword1" id="Residuated_Lattices-residuated_Inf"><span class="command">lemma</span></span> residuated_Inf<span class="main">:</span> <span class="quoted"><span class="quoted">"residuated <span class="free">f</span> <span class="main">⟹</span> residual <span class="free">f</span><span class="main">(</span><span class="main">⨅</span> <span class="free">X</span><span class="main">)</span> <span class="main">=</span> <span class="main">⨅</span><span class="main">{</span>residual <span class="free">f</span> <span class="bound">x</span> <span class="main">|</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">X</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> order.antisym<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarsimp</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> Inf_greatest res_residual_iso Inf_lower<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> assm<span class="main">:</span> <span class="quoted"><span class="quoted">"residuated <span class="free">f</span>"</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> y_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">=</span> <span class="main">⨅</span><span class="main">{</span>residual <span class="free">f</span> <span class="bound">x</span> <span class="main">|</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">X</span><span class="main">}</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="free">X</span><span class="main">.</span> <span class="skolem">y</span> <span class="main">≤</span> residual <span class="free">f</span> <span class="bound">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> y_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> Inf_lower<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="free">X</span><span class="main">.</span> <span class="free">f</span> <span class="skolem">y</span> <span class="main">≤</span> <span class="bound">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assm residual_galoisI2<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">y</span> <span class="main">≤</span> <span class="main">⨅</span> <span class="free">X</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> Inf_greatest<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">⨅</span><span class="main">{</span>residual <span class="free">f</span> <span class="bound">x</span> <span class="main">|</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">X</span><span class="main">}</span> <span class="main">≤</span> residual <span class="free">f</span> <span class="main">(</span><span class="main">⨅</span><span class="free">X</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> assm y_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> residual_galoisI1<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Residuated_Lattices-Sup_sup"><span class="command">lemma</span></span> Sup_sup<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">X</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="main">⨆</span> <span class="bound">X</span><span class="main">)</span> <span class="main">=</span> <span class="main">⨆</span><span class="main">{</span><span class="free">f</span> <span class="bound">x</span> <span class="main">|</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="bound">X</span><span class="main">}</span> <span class="main">⟹</span> <span class="free">f</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="free">x</span> <span class="main">⊔</span> <span class="free">f</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> Sup_eqI<span class="main">)</span>

<span class="keyword1" id="Residuated_Lattices-Sup_residuatedI"><span class="command">lemma</span></span> Sup_residuatedI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">X</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="main">⨆</span> <span class="bound">X</span><span class="main">)</span> <span class="main">=</span> <span class="main">⨆</span><span class="main">{</span><span class="free">f</span> <span class="bound">x</span> <span class="main">|</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="bound">X</span><span class="main">}</span> <span class="main">⟹</span> residuated <span class="free">f</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> residuated_def residuated_pair_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">standard</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">y</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="main">⨆</span><span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">≤</span> <span class="skolem">y</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> Sup_upper<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
  <span class="keyword3"><span class="command">assume</span></span> assm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">X</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="main">⨆</span><span class="bound">X</span><span class="main">)</span> <span class="main">=</span> <span class="main">⨆</span><span class="main">{</span><span class="free">f</span> <span class="bound">x</span> <span class="main">|</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="bound">X</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> f_iso<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≤</span> <span class="bound">y</span> <span class="main">⟶</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">f</span> <span class="bound">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Sup_sup <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> le_iff_sup<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="main">⨆</span><span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">≤</span> <span class="skolem">y</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="free">f</span><span class="main">(</span><span class="main">⨆</span><span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">≤</span> <span class="skolem">y</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> f_iso<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">⨆</span><span class="main">{</span><span class="free">f</span> <span class="bound">x</span> <span class="main">|</span> <span class="bound">x</span> <span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">≤</span> <span class="skolem">y</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assm <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> order_trans<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> Sup_least<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Residuated_Lattices-Inf_inf"><span class="command">lemma</span></span> Inf_inf<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">X</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="main">⨅</span> <span class="bound">X</span><span class="main">)</span> <span class="main">=</span> <span class="main">⨅</span><span class="main">{</span><span class="free">f</span> <span class="bound">x</span> <span class="main">|</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="bound">X</span><span class="main">}</span> <span class="main">⟹</span> <span class="free">f</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="free">x</span> <span class="main">⊓</span> <span class="free">f</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> Inf_eqI<span class="main">)</span>

<span class="keyword1" id="Residuated_Lattices-Inf_residuatedI"><span class="command">lemma</span></span> Inf_residuatedI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">X</span><span class="main">.</span> <span class="main">⨅</span><span class="main">{</span><span class="free">g</span> <span class="bound">x</span> <span class="main">|</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="bound">X</span><span class="main">}</span> <span class="main">=</span> <span class="free">g</span> <span class="main">(</span><span class="main">⨅</span> <span class="bound">X</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">f</span><span class="main">.</span> residuated_pair <span class="bound">f</span> <span class="free">g</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> residuated_pair_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">standard</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="free">g</span> <span class="skolem">y</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">⨅</span><span class="main">{</span><span class="bound">y</span><span class="main">.</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="free">g</span> <span class="bound">y</span><span class="main">}</span> <span class="main">≤</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> Inf_lower<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
  <span class="keyword3"><span class="command">assume</span></span> assm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">X</span><span class="main">.</span> <span class="main">⨅</span><span class="main">{</span><span class="free">g</span> <span class="bound">x</span> <span class="main">|</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="bound">X</span><span class="main">}</span> <span class="main">=</span> <span class="free">g</span> <span class="main">(</span><span class="main">⨅</span> <span class="bound">X</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> g_iso<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≤</span> <span class="bound">y</span> <span class="main">⟶</span> <span class="free">g</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">g</span> <span class="bound">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Inf_inf <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> le_iff_inf<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">⨅</span><span class="main">{</span><span class="bound">y</span><span class="main">.</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="free">g</span> <span class="bound">y</span><span class="main">}</span> <span class="main">≤</span> <span class="skolem">y</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">(</span><span class="main">⨅</span><span class="main">{</span><span class="bound">y</span><span class="main">.</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="free">g</span> <span class="bound">y</span><span class="main">}</span><span class="main">)</span> <span class="main">≤</span> <span class="free">g</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> g_iso<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⨅</span><span class="main">{</span><span class="free">g</span> <span class="bound">y</span> <span class="main">|</span> <span class="bound">y</span><span class="main">.</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="free">g</span> <span class="bound">y</span><span class="main">}</span><span class="main">)</span> <span class="main">≤</span> <span class="free">g</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assm <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">y</span><span class="main">.</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="free">g</span> <span class="bound">y</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> Inf_lower<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="free">g</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> local.dual_order.trans<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> Inf_greatest<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* complete lattices *)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Residuated Structures›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  In this section, we define residuated algebraic structures, starting from the simplest of all,
  a \emph{residuated partial ordered groupoid}, to 
  \emph{residuated l-monoids}, which are residuated 
  lattices where the multiplicative operator forms a monoid.
›</span></span>

<span class="keyword1"><span class="command">class</span></span> pogroupoid <span class="main">=</span> order <span class="main">+</span> times <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> mult_isor<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">z</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⋅</span> <span class="free">z</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> mult_isol<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">z</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">z</span> <span class="main">⋅</span> <span class="free">y</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  A residuated partial ordered groupoid is simply a partial order and a multiplicative groupoid with 
  two extra operators satisfying the residuation laws.
  It is straighforward to prove that multiplication is compatible with the order,
  that is, multiplication is isotone.
  
  Most of the lemmas below come in pairs; they are related by opposition duality.
  Formalising this duality is left for future work.
›</span></span>

<span class="keyword1"><span class="command">class</span></span> residual_r_op <span class="main">=</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free"><span class="free"><span class="free">residual_r</span></span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1"><span class="keyword1"><span class="keyword1">→</span></span></span>"</span> 60<span class="main">)</span>

<span class="keyword1"><span class="command">class</span></span> residual_l_op <span class="main">=</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free"><span class="free"><span class="free">residual_l</span></span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1"><span class="keyword1"><span class="keyword1">←</span></span></span>"</span> 60<span class="main">)</span>
  
<span class="keyword1"><span class="command">class</span></span> residuated_pogroupoid <span class="main">=</span> order <span class="main">+</span> times <span class="main">+</span> residual_l_op <span class="main">+</span> residual_r_op <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> resl_galois<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">z</span> <span class="main">←</span> <span class="free">y</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">z</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> resr_galois<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">z</span> <span class="main">⟷</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">→</span> <span class="free">z</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Residuated_Lattices-reslI"><span class="command">lemma</span></span> reslI <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">z</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">z</span> <span class="main">←</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> resl_galois<span class="main">)</span>

<span class="keyword1" id="Residuated_Lattices-resrI"><span class="command">lemma</span></span> resrI <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">z</span> <span class="main">⟹</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">→</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> resr_galois<span class="main">)</span>

<span class="keyword1" id="Residuated_Lattices-residuated_pair_multl"><span class="command">lemma</span></span> residuated_pair_multl <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"residuated_pair <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">←</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> residuated_pair_def resl_galois<span class="main">)</span>
  
<span class="keyword1" id="Residuated_Lattices-residuated_pair_multr"><span class="command">lemma</span></span> residuated_pair_multr <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"residuated_pair <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">x</span> <span class="main">⋅</span> <span class="bound">y</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">x</span> <span class="main">→</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> residuated_pair_def resr_galois<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Multiplication is then obviously residuated.
›</span></span>
  
<span class="keyword1" id="Residuated_Lattices-residuated_multl"><span class="command">lemma</span></span> residuated_multl <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"residuated <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> residuated_def residuated_pair_multl<span class="main">)</span>

<span class="keyword1" id="Residuated_Lattices-residuated_multr"><span class="command">lemma</span></span> residuated_multr <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"residuated <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">x</span> <span class="main">⋅</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> residuated_def residuated_pair_multr<span class="main">)</span>
  
<span class="keyword1" id="Residuated_Lattices-resl_eq"><span class="command">lemma</span></span> resl_eq <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"residual <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">←</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> residual_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> the1_equality<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> residual_unique<span class="main">)</span>
  
<span class="keyword1" id="Residuated_Lattices-resr_eq"><span class="command">lemma</span></span> resr_eq <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"residual <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">x</span> <span class="main">⋅</span> <span class="bound">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">x</span> <span class="main">→</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> residual_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> the1_equality<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> residual_unique<span class="main">)</span>
  
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Next we prove a few lemmas, all of which are instantiation of more general facts about residuated functions.
›</span></span>
  
<span class="keyword1" id="Residuated_Lattices-res_lc1"><span class="command">lemma</span></span> res_lc1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">←</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  
<span class="keyword1" id="Residuated_Lattices-res_lc2"><span class="command">lemma</span></span> res_lc2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">z</span> <span class="main">←</span> <span class="free">z</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⋅</span> <span class="free">z</span> <span class="main">←</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.res_c2 resl_eq residuated_multl<span class="main">)</span>

<span class="keyword1" id="Residuated_Lattices-res_lc3"><span class="command">lemma</span></span> res_lc3 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">←</span> <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">←</span> <span class="free">y</span> <span class="main">=</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">←</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.res_c3 resl_eq residuated_multl<span class="main">)</span>
  
<span class="keyword1" id="Residuated_Lattices-res_rc1"><span class="command">lemma</span></span> res_rc1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">→</span> <span class="free">y</span> <span class="main">⋅</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Residuated_Lattices-res_rc2"><span class="command">lemma</span></span> res_rc2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">z</span> <span class="main">→</span> <span class="free">z</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">z</span> <span class="main">→</span> <span class="free">z</span> <span class="main">⋅</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.res_c2 resr_eq residuated_multr<span class="main">)</span>

<span class="keyword1" id="Residuated_Lattices-res_rc3"><span class="command">lemma</span></span> res_rc3 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">→</span> <span class="free">y</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">y</span> <span class="main">→</span> <span class="free">y</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">y</span> <span class="main">→</span> <span class="free">y</span> <span class="main">⋅</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.res_c3 resr_eq residuated_multr<span class="main">)</span>
  
<span class="keyword1" id="Residuated_Lattices-res_li1"><span class="command">lemma</span></span> res_li1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">←</span> <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.res_i1 resl_eq residuated_multl<span class="main">)</span>
  
<span class="keyword1" id="Residuated_Lattices-res_li2"><span class="command">lemma</span></span> res_li2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">x</span> <span class="main">←</span> <span class="free">z</span><span class="main">)</span> <span class="main">⋅</span> <span class="free">z</span> <span class="main">≤</span> <span class="main">(</span><span class="free">y</span> <span class="main">←</span> <span class="free">z</span><span class="main">)</span> <span class="main">⋅</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.res_i2 resl_eq residuated_multl<span class="main">)</span>
  
<span class="keyword1" id="Residuated_Lattices-res_li3"><span class="command">lemma</span></span> res_li3 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">x</span> <span class="main">←</span> <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">←</span> <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">←</span> <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.res_i3 resl_eq residuated_multl<span class="main">)</span>
  
<span class="keyword1" id="Residuated_Lattices-res_ri1"><span class="command">lemma</span></span> res_ri1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">y</span> <span class="main">→</span> <span class="free">x</span><span class="main">)</span> <span class="main">≤</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.res_i1 resr_eq residuated_multr<span class="main">)</span>
  
<span class="keyword1" id="Residuated_Lattices-res_ri2"><span class="command">lemma</span></span> res_ri2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">z</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">z</span> <span class="main">→</span> <span class="free">x</span><span class="main">)</span> <span class="main">≤</span> <span class="free">z</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">z</span> <span class="main">→</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.res_i2 resr_eq residuated_multr<span class="main">)</span>
  
<span class="keyword1" id="Residuated_Lattices-res_ri3"><span class="command">lemma</span></span> res_ri3 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">y</span> <span class="main">→</span> <span class="free">y</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">y</span> <span class="main">→</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">y</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">y</span> <span class="main">→</span> <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.res_i3 resr_eq residuated_multr<span class="main">)</span>
  
<span class="keyword1"><span class="command">subclass</span></span> pogroupoid
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">z</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">y</span> <span class="main">⟹</span> <span class="skolem">x</span> <span class="main">⋅</span> <span class="skolem">z</span> <span class="main">≤</span> <span class="skolem">y</span> <span class="main">⋅</span> <span class="skolem">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.res_iso residuated_multl<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">y</span> <span class="main">⟹</span> <span class="skolem">z</span> <span class="main">⋅</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">z</span> <span class="main">⋅</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.res_iso residuated_multr<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Residuated_Lattices-resl_iso"><span class="command">lemma</span></span> resl_iso<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">←</span> <span class="free">z</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">←</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> res_residual_iso resl_eq residuated_multl<span class="main">)</span>
  
<span class="keyword1" id="Residuated_Lattices-resr_iso"><span class="command">lemma</span></span> resr_iso<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">z</span> <span class="main">→</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">z</span> <span class="main">→</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> res_residual_iso resr_eq residuated_multr<span class="main">)</span>

<span class="keyword1" id="Residuated_Lattices-resl_comp1"><span class="command">lemma</span></span> resl_comp1 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">←</span> <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">=</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> order.antisym local.mult_isor res_lc1 res_li1<span class="main">)</span>
  
<span class="keyword1" id="Residuated_Lattices-resl_comp2"><span class="command">lemma</span></span> resl_comp2 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">←</span> <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">←</span> <span class="free">y</span> <span class="main">=</span> <span class="free">x</span> <span class="main">←</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> order.eq_iff res_lc1 res_li1 resl_iso<span class="main">)</span>
  
<span class="keyword1" id="Residuated_Lattices-resr_comp1"><span class="command">lemma</span></span> resr_comp1 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">y</span> <span class="main">→</span> <span class="free">y</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">y</span> <span class="main">⋅</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> order.antisym local.mult_isol res_rc1 res_ri1<span class="main">)</span>
  
<span class="keyword1" id="Residuated_Lattices-resr_comp2"><span class="command">lemma</span></span> resr_comp2 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">→</span> <span class="free">y</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">y</span> <span class="main">→</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">y</span> <span class="main">→</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> order.eq_iff res_rc1 res_ri1 resr_iso<span class="main">)</span>
  
<span class="keyword1" id="Residuated_Lattices-resl_antitoner"><span class="command">lemma</span></span> resl_antitoner<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟶</span> <span class="free">z</span> <span class="main">←</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">z</span> <span class="main">←</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.dual_order.trans local.mult_isol res_li1 reslI<span class="main">)</span>

<span class="keyword1" id="Residuated_Lattices-resr_antitonel"><span class="command">lemma</span></span> resr_antitonel<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟶</span> <span class="free">y</span> <span class="main">→</span> <span class="free">z</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">→</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.dual_order.trans local.resl_galois res_ri1 resrI<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The following lemmas are taken from Galatos and \emph{al.}›</span></span>

<span class="keyword1" id="Residuated_Lattices-jipsen1l"><span class="command">lemma</span></span> jipsen1l<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">←</span> <span class="main">(</span><span class="free">x</span> <span class="main">→</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> res_ri1 reslI<span class="main">)</span>
  
<span class="keyword1" id="Residuated_Lattices-jipsen1r"><span class="command">lemma</span></span> jipsen1r<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="main">(</span><span class="free">y</span> <span class="main">←</span> <span class="free">x</span><span class="main">)</span> <span class="main">→</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> res_li1 resrI<span class="main">)</span>
  
<span class="keyword1" id="Residuated_Lattices-jipsen2l"><span class="command">lemma</span></span> jipsen2l<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">y</span> <span class="main">←</span> <span class="main">(</span><span class="free">x</span> <span class="main">→</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="main">→</span> <span class="free">y</span> <span class="main">=</span> <span class="free">x</span> <span class="main">→</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> jipsen1l jipsen1r order.eq_iff local.resr_antitonel<span class="main">)</span>
  
<span class="keyword1" id="Residuated_Lattices-jipsen2r"><span class="command">lemma</span></span> jipsen2r<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">←</span> <span class="main">(</span><span class="main">(</span><span class="free">y</span> <span class="main">←</span> <span class="free">x</span><span class="main">)</span> <span class="main">→</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="free">y</span> <span class="main">←</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> jipsen1l jipsen1r order.eq_iff local.resl_antitoner<span class="main">)</span>
  
<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* residuated_pogroupoid *)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  In a residuated partial ordered semigroup, the multiplicative operator is associative.
›</span></span>
  
<span class="keyword1"><span class="command">class</span></span> residuated_posemigroup <span class="main">=</span> semigroup_mult <span class="main">+</span> residuated_pogroupoid 
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Residuated_Lattices-resl_trans"><span class="command">lemma</span></span> resl_trans<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">←</span> <span class="free">y</span><span class="main">)</span>  <span class="main">⋅</span>  <span class="main">(</span><span class="free">y</span> <span class="main">←</span> <span class="free">z</span><span class="main">)</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">←</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.res_li1 local.resl_antitoner local.resl_galois mult_assoc<span class="main">)</span>
  
<span class="keyword1" id="Residuated_Lattices-resr_trans"><span class="command">lemma</span></span> resr_trans<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">→</span> <span class="free">y</span><span class="main">)</span>  <span class="main">⋅</span>  <span class="main">(</span><span class="free">y</span> <span class="main">→</span> <span class="free">z</span><span class="main">)</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">→</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.res_ri1 local.resr_antitonel local.resr_galois mult_assoc<span class="main">)</span>
  
<span class="keyword1" id="Residuated_Lattices-resr1"><span class="command">lemma</span></span> resr1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">→</span> <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="free">z</span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span> <span class="main">→</span> <span class="free">y</span> <span class="main">⋅</span> <span class="free">z</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.mult_isor local.res_ri1 local.resrI mult_assoc<span class="main">)</span>
  
<span class="keyword1" id="Residuated_Lattices-resr2"><span class="command">lemma</span></span> resr2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">→</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">z</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">→</span> <span class="free">z</span> <span class="main">⋅</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.mult_isol local.res_ri1 local.resrI mult_assoc<span class="main">)</span>
  
<span class="keyword1" id="Residuated_Lattices-resr3"><span class="command">lemma</span></span> resr3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">→</span> <span class="free">z</span> <span class="main">=</span> <span class="free">y</span> <span class="main">→</span> <span class="main">(</span><span class="free">x</span> <span class="main">→</span> <span class="free">z</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> order.eq_iff local.resr_galois mult_assoc<span class="main">)</span>
  
<span class="keyword1" id="Residuated_Lattices-resl1"><span class="command">lemma</span></span> resl1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">x</span> <span class="main">←</span> <span class="free">y</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="free">z</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">←</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.mult_isol local.res_li1 local.reslI mult_assoc<span class="main">)</span>

<span class="keyword1" id="Residuated_Lattices-resl2"><span class="command">lemma</span></span> resl2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">←</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">z</span> <span class="main">←</span> <span class="free">y</span> <span class="main">⋅</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.mult_isor local.res_li1 local.reslI mult_assoc<span class="main">)</span>

<span class="keyword1" id="Residuated_Lattices-resl3"><span class="command">lemma</span></span> resl3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">←</span> <span class="free">y</span> <span class="main">⋅</span> <span class="free">z</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">←</span> <span class="free">z</span><span class="main">)</span> <span class="main">←</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> order.eq_iff local.resl_galois mult_assoc<span class="main">)</span>
  
<span class="keyword1" id="Residuated_Lattices-residual_assoc"><span class="command">lemma</span></span> residual_assoc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">→</span> <span class="main">(</span><span class="free">y</span> <span class="main">←</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">→</span> <span class="free">y</span><span class="main">)</span> <span class="main">←</span> <span class="free">z</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> order.antisym<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">→</span> <span class="main">(</span><span class="free">y</span> <span class="main">←</span> <span class="free">z</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span> <span class="main">→</span> <span class="free">y</span><span class="main">)</span> <span class="main">←</span> <span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.res_ri1 local.resl_galois local.resr_galois mult_assoc<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">→</span> <span class="free">y</span><span class="main">)</span> <span class="main">←</span> <span class="free">z</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">→</span> <span class="main">(</span><span class="free">y</span> <span class="main">←</span> <span class="free">z</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.res_li1 local.resl_galois local.resr_galois mult_assoc<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* residuated_posemigroup *)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  In a residuated partially ordered monoid, the multiplicative operator has a unit $1$; that is,
  its reduct forms a monoid.
›</span></span>

<span class="keyword1"><span class="command">class</span></span> residuated_pomonoid <span class="main">=</span> monoid_mult <span class="main">+</span> residuated_pogroupoid 
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subclass</span></span> residuated_posemigroup <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1" id="Residuated_Lattices-resl_unit"><span class="command">lemma</span></span> resl_unit<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">←</span> <span class="main">1</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.mult_1_right local.resl_comp1<span class="main">)</span>

<span class="keyword1" id="Residuated_Lattices-resr_unit"><span class="command">lemma</span></span> resr_unit<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">→</span> <span class="free">x</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.mult_1_left local.resr_comp1<span class="main">)</span>
  
<span class="keyword1" id="Residuated_Lattices-mult_one_resl"><span class="command">lemma</span></span> mult_one_resl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="main">1</span> <span class="main">←</span> <span class="free">y</span><span class="main">)</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">←</span> <span class="free">y</span>"</span></span>  
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.mult_1_right local.resl1<span class="main">)</span>

<span class="keyword1" id="Residuated_Lattices-mult_one_resr"><span class="command">lemma</span></span> mult_one_resr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">→</span> <span class="main">1</span><span class="main">)</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">→</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.mult_1_left local.resr1<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹More lemmas from Galatos and \emph{al.} follow.›</span></span>

<span class="keyword1" id="Residuated_Lattices-jipsen3l"><span class="command">lemma</span></span> jipsen3l<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">←</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.jipsen1l resr_unit<span class="main">)</span>

<span class="keyword1" id="Residuated_Lattices-jipsen3r"><span class="command">lemma</span></span> jipsen3r<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">→</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.jipsen1r resl_unit<span class="main">)</span>
  
<span class="keyword1" id="Residuated_Lattices-jipsen4l"><span class="command">lemma</span></span> jipsen4l <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">←</span> <span class="free">x</span><span class="main">)</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.mult_1_left local.resl_comp1<span class="main">)</span>
  
<span class="keyword1" id="Residuated_Lattices-jipsen4r"><span class="command">lemma</span></span> jipsen4r <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">x</span> <span class="main">→</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.mult_1_right local.resr_comp1<span class="main">)</span>
  
<span class="keyword1" id="Residuated_Lattices-jipsen5l"><span class="command">lemma</span></span> jipsen5l <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">←</span> <span class="free">x</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">x</span> <span class="main">←</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span> <span class="main">←</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> jipsen4l local.resl3<span class="main">)</span>
  
<span class="keyword1" id="Residuated_Lattices-jipsen5r"><span class="command">lemma</span></span> jipsen5r <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">→</span> <span class="free">x</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">x</span> <span class="main">→</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span> <span class="main">→</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> jipsen4r local.resr3<span class="main">)</span>
  
<span class="keyword1" id="Residuated_Lattices-jipsen6l"><span class="command">lemma</span></span> jipsen6l<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">←</span> <span class="free">x</span> <span class="main">≤</span> <span class="main">(</span><span class="free">y</span> <span class="main">←</span> <span class="free">z</span><span class="main">)</span> <span class="main">←</span> <span class="main">(</span><span class="free">x</span> <span class="main">←</span> <span class="free">z</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.resl_galois local.resl_trans<span class="main">)</span>
  
<span class="keyword1" id="Residuated_Lattices-jipsen6r"><span class="command">lemma</span></span> jipsen6r<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">→</span> <span class="free">y</span> <span class="main">≤</span> <span class="main">(</span><span class="free">z</span> <span class="main">→</span> <span class="free">x</span><span class="main">)</span> <span class="main">→</span> <span class="main">(</span><span class="free">z</span> <span class="main">→</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.resr_galois local.resr_trans<span class="main">)</span>
  
<span class="keyword1" id="Residuated_Lattices-jipsen7l"><span class="command">lemma</span></span> jipsen7l<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">←</span> <span class="free">x</span> <span class="main">≤</span> <span class="main">(</span><span class="free">z</span> <span class="main">←</span> <span class="free">y</span><span class="main">)</span> <span class="main">→</span> <span class="main">(</span><span class="free">z</span> <span class="main">←</span> <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.resr_galois local.resl_trans<span class="main">)</span>
  
<span class="keyword1" id="Residuated_Lattices-jipsen7r"><span class="command">lemma</span></span> jipsen7r<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">→</span> <span class="free">y</span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span> <span class="main">→</span> <span class="free">z</span><span class="main">)</span> <span class="main">←</span> <span class="main">(</span><span class="free">y</span> <span class="main">→</span> <span class="free">z</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.resl_galois local.resr_trans<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* residuated_pomonoid *)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Residuated partially ordered groupoids can be expanded residuated join semilattice ordered groupoids.
  They are used as a base for action algebras, which are expansions 
  of Kleene algebras by operations of residuation.
  Action algebras can be found in the AFP entry for Kleene algebras.
›</span></span>

<span class="keyword1"><span class="command">class</span></span> residuated_sup_lgroupoid <span class="main">=</span> semilattice_sup <span class="main">+</span> residuated_pogroupoid
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Residuated_Lattices-distl"><span class="command">lemma</span></span> distl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">y</span> <span class="main">⊔</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">⊔</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.residuated_multr local.residuated_sup<span class="main">)</span>
  
<span class="keyword1" id="Residuated_Lattices-distr"><span class="command">lemma</span></span> distr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="free">z</span> <span class="main">=</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">z</span> <span class="main">⊔</span> <span class="free">y</span> <span class="main">⋅</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.residuated_multl local.residuated_sup<span class="main">)</span>
  
<span class="keyword1" id="Residuated_Lattices-resl_subdist_var"><span class="command">lemma</span></span> resl_subdist_var<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">←</span> <span class="free">z</span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span><span class="main">)</span> <span class="main">←</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.resl_iso local.sup_ge1<span class="main">)</span>
 
<span class="keyword1" id="Residuated_Lattices-resl_subdist"><span class="command">lemma</span></span> resl_subdist<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">←</span> <span class="free">z</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="free">y</span> <span class="main">←</span> <span class="free">z</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span><span class="main">)</span> <span class="main">←</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.le_sup_iff local.sup_commute resl_subdist_var<span class="main">)</span>
  
<span class="keyword1" id="Residuated_Lattices-resr_subdist_var"><span class="command">lemma</span></span> resr_subdist_var<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">→</span> <span class="free">y</span><span class="main">)</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">→</span> <span class="main">(</span><span class="free">y</span> <span class="main">⊔</span> <span class="free">z</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.resr_iso local.sup_ge1<span class="main">)</span>
  
<span class="keyword1" id="Residuated_Lattices-resr_subdist"><span class="command">lemma</span></span> resr_subdist<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">→</span> <span class="free">y</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="free">x</span> <span class="main">→</span> <span class="free">z</span><span class="main">)</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">→</span> <span class="main">(</span><span class="free">y</span> <span class="main">⊔</span> <span class="free">z</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> sup_commute sup_least resr_subdist_var<span class="main">)</span>
  
<span class="keyword1" id="Residuated_Lattices-resl_superdist_var"><span class="command">lemma</span></span> resl_superdist_var<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">←</span> <span class="main">(</span><span class="free">y</span> <span class="main">⊔</span> <span class="free">z</span><span class="main">)</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">←</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.le_sup_iff local.res_li1 local.reslI local.resr_galois<span class="main">)</span>
  
<span class="keyword1" id="Residuated_Lattices-resr_superdist_var"><span class="command">lemma</span></span> resr_superdist_var<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span><span class="main">)</span> <span class="main">→</span> <span class="free">z</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">→</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.le_sup_iff local.res_ri1 local.resl_galois local.resrI<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* residuated_sup_lgroupoid *)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Similarly, semigroup and monoid variants can be defined.
›</span></span>

<span class="keyword1"><span class="command">class</span></span> residuated_sup_lsemigroup <span class="main">=</span> semilattice_sup <span class="main">+</span> residuated_posemigroup
<span class="keyword1"><span class="command">subclass</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> residuated_sup_lsemigroup<span class="main">)</span> residuated_sup_lgroupoid <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">class</span></span> residuated_sup_lmonoid <span class="main">=</span> semilattice_sup <span class="main">+</span> residuated_posemigroup
<span class="keyword1"><span class="command">subclass</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> residuated_sup_lmonoid<span class="main">)</span> residuated_sup_lsemigroup <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  By lattice duality, we define residuated meet semillatice ordered groupoid.
›</span></span>

<span class="keyword1"><span class="command">class</span></span> residuated_inf_lgroupoid <span class="main">=</span> semilattice_inf <span class="main">+</span> residuated_pogroupoid
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Residuated_Lattices-resl_dist"><span class="command">lemma</span></span> resl_dist<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span><span class="main">)</span> <span class="main">←</span> <span class="free">z</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">←</span> <span class="free">z</span><span class="main">)</span> <span class="main">⊓</span> <span class="main">(</span><span class="free">y</span> <span class="main">←</span> <span class="free">z</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.resl_eq local.residuated_inf local.residuated_multl<span class="main">)</span>

<span class="keyword1" id="Residuated_Lattices-resr_dist"><span class="command">lemma</span></span> resr_dist<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">→</span> <span class="main">(</span><span class="free">y</span> <span class="main">⊓</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">→</span> <span class="free">y</span><span class="main">)</span> <span class="main">⊓</span> <span class="main">(</span><span class="free">x</span> <span class="main">→</span> <span class="free">z</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.resr_eq local.residuated_inf local.residuated_multr<span class="main">)</span>

<span class="keyword1" id="Residuated_Lattices-resl_inf_superdist"><span class="command">lemma</span></span> resl_inf_superdist<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">←</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">←</span> <span class="main">(</span><span class="free">y</span> <span class="main">⊓</span> <span class="free">z</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.inf_le1 local.resl_antitoner<span class="main">)</span>

<span class="keyword1" id="Residuated_Lattices-resr_inf_superdist_var"><span class="command">lemma</span></span> resr_inf_superdist_var<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">→</span> <span class="free">y</span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">z</span><span class="main">)</span> <span class="main">→</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.inf_le1 local.resr_antitonel<span class="main">)</span>
  
<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* residuated_inf_lgroupoid *)</span>

<span class="keyword1"><span class="command">class</span></span> residuated_inf_lsemigroup <span class="main">=</span> semilattice_inf <span class="main">+</span> residuated_posemigroup
<span class="keyword1"><span class="command">subclass</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> residuated_inf_lsemigroup<span class="main">)</span> residuated_inf_lgroupoid <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">class</span></span> residuated_inf_lmonoid <span class="main">=</span> semilattice_inf <span class="main">+</span> residuated_posemigroup
<span class="keyword1"><span class="command">subclass</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> residuated_inf_lmonoid<span class="main">)</span> residuated_inf_lsemigroup <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Finally, we obtain residuated lattice groupoids. 
›</span></span>

<span class="keyword1"><span class="command">class</span></span> residuated_lgroupoid <span class="main">=</span> lattice <span class="main">+</span> residuated_pogroupoid
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subclass</span></span> residuated_sup_lgroupoid <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1" id="Residuated_Lattices-resl_distr"><span class="command">lemma</span></span> resl_distr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">←</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">z</span> <span class="main">←</span> <span class="free">x</span><span class="main">)</span> <span class="main">⊓</span> <span class="main">(</span><span class="free">z</span> <span class="main">←</span> <span class="free">y</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> order.antisym<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">←</span> <span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span> <span class="main">≤</span> <span class="main">(</span><span class="free">z</span> <span class="main">←</span> <span class="free">x</span><span class="main">)</span> <span class="main">⊓</span> <span class="main">(</span><span class="free">z</span> <span class="main">←</span> <span class="free">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.inf.bounded_iff local.resl_superdist_var local.sup_commute<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">z</span> <span class="main">←</span> <span class="free">x</span><span class="main">)</span> <span class="main">⊓</span> <span class="main">(</span><span class="free">z</span> <span class="main">←</span> <span class="free">y</span><span class="main">)</span> <span class="main">≤</span> <span class="free">z</span> <span class="main">←</span> <span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.inf.cobounded1 local.inf.cobounded2 local.resl_galois local.resr_galois local.sup.bounded_iff<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Residuated_Lattices-resr_distl"><span class="command">lemma</span></span> resr_distl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span><span class="main">)</span> <span class="main">→</span> <span class="free">z</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">→</span> <span class="free">z</span><span class="main">)</span> <span class="main">⊓</span> <span class="main">(</span><span class="free">y</span> <span class="main">→</span> <span class="free">z</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> order.antisym<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span> <span class="main">→</span> <span class="free">z</span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span> <span class="main">→</span> <span class="free">z</span><span class="main">)</span> <span class="main">⊓</span> <span class="main">(</span><span class="free">y</span> <span class="main">→</span> <span class="free">z</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.inf.bounded_iff local.resr_antitonel local.resr_superdist_var local.sup_ge2<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">→</span> <span class="free">z</span><span class="main">)</span> <span class="main">⊓</span> <span class="main">(</span><span class="free">y</span> <span class="main">→</span> <span class="free">z</span><span class="main">)</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span> <span class="main">→</span> <span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.inf.cobounded1 local.inf.cobounded2 local.resl_galois local.resr_galois local.sup_least<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> 

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* residuated_lgroupoid *)</span>

<span class="keyword1"><span class="command">class</span></span> residuated_lsemigroup <span class="main">=</span> lattice <span class="main">+</span> residuated_sup_lsemigroup
<span class="keyword1"><span class="command">subclass</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> residuated_lsemigroup<span class="main">)</span> residuated_lgroupoid <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">class</span></span> residuated_lmonoid <span class="main">=</span> lattice <span class="main">+</span> residuated_sup_lmonoid
<span class="keyword1"><span class="command">subclass</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> residuated_lmonoid<span class="main">)</span> residuated_lsemigroup <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">class</span></span> residuated_blgroupoid <span class="main">=</span> bounded_lattice <span class="main">+</span> residuated_pogroupoid
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Residuated_Lattices-multl_strict"><span class="command">lemma</span></span> multl_strict <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⋅</span> <span class="main">⊥</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.residuated_multr local.residuated_strict<span class="main">)</span>

<span class="keyword1" id="Residuated_Lattices-multr_strict"><span class="command">lemma</span></span> multr_strict <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊥</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.residuated_multl local.residuated_strict<span class="main">)</span>

<span class="keyword1" id="Residuated_Lattices-resl_top"><span class="command">lemma</span></span> resl_top <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊤</span> <span class="main">←</span> <span class="free">x</span> <span class="main">=</span> <span class="main">⊤</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.res_top local.residuated_multl local.resl_eq<span class="main">)</span>

<span class="keyword1" id="Residuated_Lattices-resl_impl"><span class="command">lemma</span></span> resl_impl <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">←</span> <span class="main">⊥</span> <span class="main">=</span> <span class="main">⊤</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.resl_comp2 multl_strict resl_top<span class="main">)</span>

<span class="keyword1" id="Residuated_Lattices-resr_top"><span class="command">lemma</span></span> resr_top <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">→</span> <span class="main">⊤</span> <span class="main">=</span> <span class="main">⊤</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.resrI local.top_greatest local.top_unique<span class="main">)</span>

<span class="keyword1" id="Residuated_Lattices-resr_impl"><span class="command">lemma</span></span> resr_impl <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊥</span> <span class="main">→</span> <span class="free">x</span> <span class="main">=</span> <span class="main">⊤</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.resr_comp2 multr_strict resr_top<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* residuated_blgroupoid *)</span>

<span class="keyword1"><span class="command">class</span></span> residuated_blsemigroup <span class="main">=</span> bounded_lattice <span class="main">+</span> residuated_sup_lsemigroup
<span class="keyword1"><span class="command">subclass</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> residuated_blsemigroup<span class="main">)</span> residuated_blgroupoid <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">class</span></span> residuated_blmonoid <span class="main">=</span> bounded_lattice <span class="main">+</span> residuated_sup_lmonoid
<span class="keyword1"><span class="command">subclass</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> residuated_blmonoid<span class="main">)</span> residuated_blsemigroup <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">class</span></span> residuated_clgroupoid <span class="main">=</span> complete_lattice <span class="main">+</span> residuated_pogroupoid
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Residuated_Lattices-resl_eq_def"><span class="command">lemma</span></span> resl_eq_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">←</span> <span class="free">x</span> <span class="main">=</span> <span class="main">⨆</span> <span class="main">{</span><span class="bound">z</span><span class="main">.</span> <span class="bound">z</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">y</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.residual_eq1 local.residuated_multl local.resl_eq<span class="main">)</span>

<span class="keyword1" id="Residuated_Lattices-resr_eq_def"><span class="command">lemma</span></span> resr_eq_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">→</span> <span class="free">y</span> <span class="main">=</span> <span class="main">⨆</span> <span class="main">{</span><span class="bound">z</span><span class="main">.</span> <span class="free">x</span> <span class="main">⋅</span> <span class="bound">z</span> <span class="main">≤</span> <span class="free">y</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.residual_eq1 local.residuated_multr local.resr_eq<span class="main">)</span>

<span class="keyword1" id="Residuated_Lattices-multl_def"><span class="command">lemma</span></span> multl_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">=</span> <span class="main">⨅</span> <span class="main">{</span><span class="bound">z</span><span class="main">.</span> <span class="free">x</span> <span class="main">≤</span> <span class="bound">z</span> <span class="main">←</span> <span class="free">y</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⨅</span><span class="main">{</span><span class="bound">ya</span><span class="main">.</span> <span class="free">x</span> <span class="main">≤</span> residual <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="bound">a</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span> <span class="bound">ya</span><span class="main">}</span> <span class="main">=</span> <span class="main">⨅</span><span class="main">{</span><span class="bound">z</span><span class="main">.</span> <span class="free">x</span> <span class="main">≤</span> <span class="bound">z</span> <span class="main">←</span> <span class="free">y</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> residuated_multl residual_eq2<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Residuated_Lattices-multr_def"><span class="command">lemma</span></span> multr_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">=</span> <span class="main">⨅</span> <span class="main">{</span><span class="bound">z</span><span class="main">.</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">→</span> <span class="bound">z</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⨅</span><span class="main">{</span><span class="bound">ya</span><span class="main">.</span> <span class="free">y</span> <span class="main">≤</span> residual <span class="main">(</span><span class="main">(⋅)</span> <span class="free">x</span><span class="main">)</span> <span class="bound">ya</span><span class="main">}</span> <span class="main">=</span> <span class="main">⨅</span><span class="main">{</span><span class="bound">z</span><span class="main">.</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">→</span> <span class="bound">z</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> residuated_multr residual_eq2<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* residuated_clgroupoid *)</span>

<span class="keyword1"><span class="command">class</span></span> residuated_clsemigroup <span class="main">=</span> complete_lattice <span class="main">+</span> residuated_sup_lsemigroup
<span class="keyword1"><span class="command">subclass</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> residuated_clsemigroup<span class="main">)</span> residuated_clgroupoid <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">class</span></span> residuated_clmonoid <span class="main">=</span> complete_lattice <span class="main">+</span> residuated_sup_lmonoid
<span class="keyword1"><span class="command">subclass</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> residuated_clmonoid<span class="main">)</span> residuated_clsemigroup <span class="keyword1"><span class="command">..</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Residuated_Boolean_Algebras">
<div class="head">
<h1>Theory Residuated_Boolean_Algebras</h1>
</div>
<pre class="source"><span class="comment1">(* Title:      Residuated Boolean Algebras
   Author:     Victor Gomes &lt;vborgesferreiragomes1 at sheffield.ac.uk&gt;
   Maintainer: Georg Struth &lt;g.struth@sheffield.ac.uk&gt; 
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Residuated Boolean Algebras›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Residuated_Boolean_Algebras
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="#Residuated_Lattices">Residuated_Lattices</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Conjugation on Boolean Algebras›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Similarly, as in the previous section, we define the conjugation for
  arbitrary residuated functions on boolean algebras.
›</span></span>

<span class="keyword1"><span class="command">context</span></span> boolean_algebra
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Residuated_Boolean_Algebras-inf_bot_iff_le"><span class="command">lemma</span></span> inf_bot_iff_le<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span> <span class="main">=</span> <span class="main">⊥</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">≤</span> <span class="main">-</span><span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> le_iff_inf inf_sup_distrib1 inf_top_right sup_bot.left_neutral sup_compl_top compl_inf_bot inf.assoc inf_bot_right<span class="main">)</span>

<span class="keyword1" id="Residuated_Boolean_Algebras-le_iff_inf_bot"><span class="command">lemma</span></span> le_iff_inf_bot<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">y</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf_bot_iff_le compl_le_compl_iff inf_commute<span class="main">)</span>
  
<span class="keyword1" id="Residuated_Boolean_Algebras-indirect_eq"><span class="command">lemma</span></span> indirect_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">z</span><span class="main">.</span> <span class="free">x</span> <span class="main">≤</span> <span class="bound">z</span> <span class="main">⟷</span> <span class="free">y</span> <span class="main">≤</span> <span class="bound">z</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> order.eq_iff<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Let $B$ be a boolean algebra. The maps $f$ and $g$ on $B$ are
  a pair of conjugates if and only if for all $x, y \in B$,
  $f(x) \sqcap y = \bot \Leftrightarrow x \sqcap g(t) = \bot$.
›</span></span>
  
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">conjugation_pair</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">conjugation_pair</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">≡</span> <span class="main">∀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">(</span><span class="bound">x</span><span class="main">)</span> <span class="main">⊓</span> <span class="bound">y</span> <span class="main">=</span> <span class="main">⊥</span> <span class="main">⟷</span> <span class="bound">x</span> <span class="main">⊓</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span><span class="main">(</span><span class="bound">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span>

<span class="keyword1" id="Residuated_Boolean_Algebras-conjugation_pair_commute"><span class="command">lemma</span></span> conjugation_pair_commute<span class="main">:</span> <span class="quoted"><span class="quoted">"conjugation_pair <span class="free">f</span> <span class="free">g</span> <span class="main">⟹</span> conjugation_pair <span class="free">g</span> <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> conjugation_pair_def inf_commute<span class="main">)</span>
  
<span class="keyword1" id="Residuated_Boolean_Algebras-conjugate_iff_residuated"><span class="command">lemma</span></span> conjugate_iff_residuated<span class="main">:</span> <span class="quoted"><span class="quoted">"conjugation_pair <span class="free">f</span> <span class="free">g</span> <span class="main">=</span> residuated_pair <span class="free">f</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">-</span><span class="free">g</span><span class="main">(</span><span class="main">-</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> conjugation_pair_def residuated_pair_def inf_bot_iff_le<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> double_compl<span class="main">)</span>

<span class="keyword1" id="Residuated_Boolean_Algebras-conjugate_residuated"><span class="command">lemma</span></span> conjugate_residuated<span class="main">:</span> <span class="quoted"><span class="quoted">"conjugation_pair <span class="free">f</span> <span class="free">g</span> <span class="main">⟹</span> residuated_pair <span class="free">f</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">-</span><span class="free">g</span><span class="main">(</span><span class="main">-</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conjugate_iff_residuated<span class="main">)</span>
  
<span class="keyword1" id="Residuated_Boolean_Algebras-residuated_iff_conjugate"><span class="command">lemma</span></span> residuated_iff_conjugate<span class="main">:</span> <span class="quoted"><span class="quoted">"residuated_pair <span class="free">f</span> <span class="free">g</span> <span class="main">=</span> conjugation_pair <span class="free">f</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">-</span><span class="free">g</span><span class="main">(</span><span class="main">-</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> conjugation_pair_def residuated_pair_def inf_bot_iff_le<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> double_compl<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  A map $f$ has a conjugate pair if and only if it is residuated.
›</span></span>
  
<span class="keyword1" id="Residuated_Boolean_Algebras-conj_residuatedI1"><span class="command">lemma</span></span> conj_residuatedI1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">g</span><span class="main">.</span> conjugation_pair <span class="free">f</span> <span class="bound">g</span> <span class="main">⟹</span> residuated <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conjugate_iff_residuated residuated_def<span class="main">)</span>
  
<span class="keyword1" id="Residuated_Boolean_Algebras-conj_residuatedI2"><span class="command">lemma</span></span> conj_residuatedI2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">g</span><span class="main">.</span> conjugation_pair <span class="bound">g</span> <span class="free">f</span> <span class="main">⟹</span> residuated <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conj_residuatedI1 conjugation_pair_commute<span class="main">)</span>
  
<span class="keyword1" id="Residuated_Boolean_Algebras-exist_conjugateI"><span class="command">lemma</span></span> exist_conjugateI<span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"residuated <span class="free">f</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">g</span><span class="main">.</span> conjugation_pair <span class="free">f</span> <span class="bound">g</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> residuated_def residuated_iff_conjugate<span class="main">)</span>
  
<span class="keyword1" id="Residuated_Boolean_Algebras-exist_conjugateI2"><span class="command">lemma</span></span> exist_conjugateI2<span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"residuated <span class="free">f</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">g</span><span class="main">.</span> conjugation_pair <span class="bound">g</span> <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> exist_conjugateI conjugation_pair_commute<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The conjugate of a residuated function $f$ is unique.
›</span></span>

<span class="keyword1" id="Residuated_Boolean_Algebras-unique_conjugate"><span class="command">lemma</span></span> unique_conjugate<span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"residuated <span class="free">f</span> <span class="main">⟹</span> <span class="main">∃!</span><span class="bound">g</span><span class="main">.</span> conjugation_pair <span class="free">f</span> <span class="bound">g</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">g</span> <span class="skolem">h</span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"conjugation_pair <span class="free">f</span> <span class="skolem">g</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"conjugation_pair <span class="free">f</span> <span class="skolem">h</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">=</span> <span class="skolem">h</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> conjugation_pair_def<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> order.antisym<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> le_iff_inf_bot inf_commute inf_compl_bot<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">}</span></span> 
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"residuated <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1" id="Residuated_Boolean_Algebras-unique_conjugate2"><span class="command">lemma</span></span> unique_conjugate2<span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"residuated <span class="free">f</span> <span class="main">⟹</span> <span class="main">∃!</span><span class="bound">g</span><span class="main">.</span> conjugation_pair <span class="bound">g</span> <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> unique_conjugate conjugation_pair_commute<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Since the conjugate of a residuated map is unique, we define a
  conjugate operation.
›</span></span>
  
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">conjugate</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">conjugate</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">≡</span> <span class="keyword1">THE</span> <span class="bound">g</span><span class="main">.</span> conjugation_pair <span class="bound">g</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span>"</span></span>

<span class="keyword1" id="Residuated_Boolean_Algebras-conjugate_iff_def"><span class="command">lemma</span></span> conjugate_iff_def<span class="main">:</span> <span class="quoted"><span class="quoted">"residuated <span class="free">f</span> <span class="main">⟹</span> <span class="free">f</span><span class="main">(</span><span class="free">x</span><span class="main">)</span> <span class="main">⊓</span> <span class="free">y</span> <span class="main">=</span> <span class="main">⊥</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">⊓</span> conjugate <span class="free">f</span> <span class="free">y</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> conjugate_def <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> unique_conjugate<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">THE</span> <span class="bound">g</span><span class="main">.</span> conjugation_pair <span class="bound">g</span> <span class="free">f</span><span class="main">)</span> <span class="main">=</span> <span class="improper">g</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> conjugation_pair_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> the1_equality<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> conjugation_pair_commute<span class="main">)</span>
    
<span class="keyword1" id="Residuated_Boolean_Algebras-conjugateI1"><span class="command">lemma</span></span> conjugateI1<span class="main">:</span> <span class="quoted"><span class="quoted">"residuated <span class="free">f</span> <span class="main">⟹</span> <span class="free">f</span><span class="main">(</span><span class="free">x</span><span class="main">)</span> <span class="main">⊓</span> <span class="free">y</span> <span class="main">=</span> <span class="main">⊥</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">⊓</span> conjugate <span class="free">f</span> <span class="free">y</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conjugate_iff_def<span class="main">)</span>
  
<span class="keyword1" id="Residuated_Boolean_Algebras-conjugateI2"><span class="command">lemma</span></span> conjugateI2<span class="main">:</span> <span class="quoted"><span class="quoted">"residuated <span class="free">f</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">⊓</span> conjugate <span class="free">f</span> <span class="free">y</span> <span class="main">=</span> <span class="main">⊥</span> <span class="main">⟹</span> <span class="free">f</span><span class="main">(</span><span class="free">x</span><span class="main">)</span> <span class="main">⊓</span> <span class="free">y</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conjugate_iff_def<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Few more lemmas about conjugation follow.
›</span></span>
  
<span class="keyword1" id="Residuated_Boolean_Algebras-residuated_conj1"><span class="command">lemma</span></span> residuated_conj1<span class="main">:</span> <span class="quoted"><span class="quoted">"residuated <span class="free">f</span> <span class="main">⟹</span> conjugation_pair <span class="free">f</span> <span class="main">(</span>conjugate <span class="free">f</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> conjugateI1 conjugateI2 conjugation_pair_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  
<span class="keyword1" id="Residuated_Boolean_Algebras-residuated_conj2"><span class="command">lemma</span></span> residuated_conj2<span class="main">:</span> <span class="quoted"><span class="quoted">"residuated <span class="free">f</span> <span class="main">⟹</span> conjugation_pair <span class="main">(</span>conjugate <span class="free">f</span><span class="main">)</span> <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> conjugateI1 conjugateI2 conjugation_pair_def inf_commute <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  
<span class="keyword1" id="Residuated_Boolean_Algebras-conj_residuated"><span class="command">lemma</span></span> conj_residuated<span class="main">:</span> <span class="quoted"><span class="quoted">"residuated <span class="free">f</span> <span class="main">⟹</span> residuated <span class="main">(</span>conjugate <span class="free">f</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> residuated_conj2 <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> conj_residuatedI1<span class="main">)</span>
  
<span class="keyword1" id="Residuated_Boolean_Algebras-conj_involution"><span class="command">lemma</span></span> conj_involution<span class="main">:</span> <span class="quoted"><span class="quoted">"residuated <span class="free">f</span> <span class="main">⟹</span> conjugate <span class="main">(</span>conjugate <span class="free">f</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conj_residuated residuated_conj1 residuated_conj2 unique_conjugate<span class="main">)</span>
  
<span class="keyword1" id="Residuated_Boolean_Algebras-residual_conj_eq"><span class="command">lemma</span></span> residual_conj_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"residuated <span class="free">f</span> <span class="main">⟹</span> residual <span class="main">(</span>conjugate <span class="free">f</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">-</span><span class="free">f</span><span class="main">(</span><span class="main">-</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> residual_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> the1_equality<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> residual_unique<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> conj_residuated conjugate_residuated residuated_conj2<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  
<span class="keyword1" id="Residuated_Boolean_Algebras-residual_conj_eq_ext"><span class="command">lemma</span></span> residual_conj_eq_ext<span class="main">:</span> <span class="quoted"><span class="quoted">"residuated <span class="free">f</span> <span class="main">⟹</span> residual <span class="main">(</span>conjugate <span class="free">f</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> <span class="main">-</span><span class="free">f</span><span class="main">(</span><span class="main">-</span><span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> residual_conj_eq<span class="main">)</span>
  
<span class="keyword1" id="Residuated_Boolean_Algebras-conj_iso"><span class="command">lemma</span></span> conj_iso<span class="main">:</span> <span class="quoted"><span class="quoted">"residuated <span class="free">f</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟹</span> conjugate <span class="free">f</span> <span class="free">x</span> <span class="main">≤</span> conjugate <span class="free">f</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conj_residuated res_iso<span class="main">)</span>
  
<span class="keyword1" id="Residuated_Boolean_Algebras-conjugate_strict"><span class="command">lemma</span></span> conjugate_strict<span class="main">:</span> <span class="quoted"><span class="quoted">"residuated <span class="free">f</span> <span class="main">⟹</span> conjugate <span class="free">f</span> <span class="main">⊥</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conj_residuated residuated_strict<span class="main">)</span>

<span class="keyword1" id="Residuated_Boolean_Algebras-conjugate_sup"><span class="command">lemma</span></span> conjugate_sup<span class="main">:</span> <span class="quoted"><span class="quoted">"residuated <span class="free">f</span> <span class="main">⟹</span> conjugate <span class="free">f</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> conjugate <span class="free">f</span> <span class="free">x</span> <span class="main">⊔</span> conjugate <span class="free">f</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conj_residuated residuated_sup<span class="main">)</span>

<span class="keyword1" id="Residuated_Boolean_Algebras-conjugate_subinf"><span class="command">lemma</span></span> conjugate_subinf<span class="main">:</span> <span class="quoted"><span class="quoted">"residuated <span class="free">f</span> <span class="main">⟹</span> conjugate <span class="free">f</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span><span class="main">)</span> <span class="main">≤</span> conjugate <span class="free">f</span> <span class="free">x</span> <span class="main">⊓</span> conjugate <span class="free">f</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> conj_iso<span class="main">)</span>
 
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Next we prove some lemmas from Maddux's article. Similar lemmas have been proved in AFP entry
  for relation algebras. They should be consolidated in the future.
›</span></span>

<span class="keyword1" id="Residuated_Boolean_Algebras-maddux1"><span class="command">lemma</span></span> maddux1<span class="main">:</span> <span class="quoted"><span class="quoted">"residuated <span class="free">f</span> <span class="main">⟹</span> <span class="free">f</span><span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="main">-</span> conjugate <span class="free">f</span><span class="main">(</span><span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="free">f</span><span class="main">(</span><span class="free">x</span><span class="main">)</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> assm<span class="main">:</span> <span class="quoted"><span class="quoted">"residuated <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span><span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="main">-</span> conjugate <span class="free">f</span><span class="main">(</span><span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="free">f</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf_le1 res_iso<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span><span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="main">-</span> conjugate <span class="free">f</span> <span class="main">(</span><span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="main">⊓</span> <span class="free">y</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assm conjugateI2 inf_bot_iff_le inf_le2<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf_bot_iff_le le_inf_iff<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Residuated_Boolean_Algebras-maddux1'"><span class="command">lemma</span></span> maddux1'<span class="main">:</span> <span class="quoted"><span class="quoted">"residuated <span class="free">f</span> <span class="main">⟹</span> conjugate <span class="free">f</span><span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">f</span><span class="main">(</span><span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> conjugate <span class="free">f</span><span class="main">(</span><span class="free">x</span><span class="main">)</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conj_involution conj_residuated maddux1<span class="main">)</span>
  
<span class="keyword1" id="Residuated_Boolean_Algebras-maddux2"><span class="command">lemma</span></span> maddux2<span class="main">:</span> <span class="quoted"><span class="quoted">"residuated <span class="free">f</span> <span class="main">⟹</span> <span class="free">f</span><span class="main">(</span><span class="free">x</span><span class="main">)</span> <span class="main">⊓</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">f</span><span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> conjugate <span class="free">f</span> <span class="free">y</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> resf<span class="main">:</span> <span class="quoted"><span class="quoted">"residuated <span class="free">f</span>"</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">z</span></span> <span class="keyword2"><span class="keyword">where</span></span> z_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">=</span> <span class="free">f</span><span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> conjugate <span class="free">f</span> <span class="free">y</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span><span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> conjugate <span class="free">f</span> <span class="free">y</span><span class="main">)</span> <span class="main">⊓</span> <span class="main">-</span><span class="skolem">z</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf_compl_bot<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⊓</span> conjugate <span class="free">f</span> <span class="free">y</span> <span class="main">⊓</span> conjugate <span class="free">f</span> <span class="main">(</span><span class="main">-</span><span class="skolem">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conjugate_iff_def resf<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⊓</span> conjugate <span class="free">f</span> <span class="main">(</span><span class="free">y</span> <span class="main">⊓</span> <span class="main">-</span><span class="skolem">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"conjugate <span class="free">f</span> <span class="main">(</span><span class="free">y</span> <span class="main">⊓</span> <span class="main">-</span><span class="skolem">z</span><span class="main">)</span> <span class="main">≤</span> conjugate <span class="free">f</span> <span class="free">y</span> <span class="main">⊓</span> conjugate <span class="free">f</span> <span class="main">(</span><span class="main">-</span><span class="skolem">z</span><span class="main">)</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> dual_order.trans inf.commute inf_bot_iff_le inf_left_commute<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conj_iso inf_le2 inf_top.left_neutral le_inf_iff resf<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span><span class="main">(</span><span class="free">x</span><span class="main">)</span> <span class="main">⊓</span> <span class="free">y</span> <span class="main">⊓</span> <span class="main">-</span><span class="skolem">z</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conjugateI2 inf.assoc resf<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> double_compl inf_bot_iff_le z_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Residuated_Boolean_Algebras-maddux2'"><span class="command">lemma</span></span> maddux2'<span class="main">:</span> <span class="quoted"><span class="quoted">"residuated <span class="free">f</span> <span class="main">⟹</span> conjugate <span class="free">f</span><span class="main">(</span><span class="free">x</span><span class="main">)</span> <span class="main">⊓</span> <span class="free">y</span> <span class="main">≤</span> conjugate <span class="free">f</span><span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">f</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conj_involution conj_residuated maddux2<span class="main">)</span>
  
<span class="keyword1" id="Residuated_Boolean_Algebras-residuated_conjugate_ineq"><span class="command">lemma</span></span> residuated_conjugate_ineq<span class="main">:</span> <span class="quoted"><span class="quoted">"residuated <span class="free">f</span> <span class="main">⟹</span> conjugate <span class="free">f</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">≤</span> <span class="main">-</span><span class="free">f</span><span class="main">(</span><span class="main">-</span><span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conj_residuated residual_galois residual_conj_eq<span class="main">)</span>

<span class="keyword1" id="Residuated_Boolean_Algebras-residuated_comp_closed"><span class="command">lemma</span></span> residuated_comp_closed<span class="main">:</span> <span class="quoted"><span class="quoted">"residuated <span class="free">f</span> <span class="main">⟹</span> residuated <span class="free">g</span> <span class="main">⟹</span> residuated <span class="main">(</span><span class="free">f</span> <span class="keyword1">o</span> <span class="free">g</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> residuated_def residuated_pair_def<span class="main">)</span>
  
<span class="keyword1" id="Residuated_Boolean_Algebras-conjugate_comp"><span class="command">lemma</span></span> conjugate_comp<span class="main">:</span> <span class="quoted"><span class="quoted">"residuated <span class="free">f</span> <span class="main">⟹</span> residuated <span class="free">g</span> <span class="main">⟹</span> conjugate <span class="main">(</span><span class="free">f</span> <span class="keyword1">o</span> <span class="free">g</span><span class="main">)</span> <span class="main">=</span> conjugate <span class="free">g</span> <span class="keyword1">o</span> conjugate <span class="free">f</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> indirect_eq<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
  <span class="keyword3"><span class="command">assume</span></span> assms<span class="main">:</span> <span class="quoted"><span class="quoted">"residuated <span class="free">f</span>"</span></span> <span class="quoted"><span class="quoted">"residuated <span class="free">g</span>"</span></span> 
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"conjugate <span class="main">(</span><span class="free">f</span> <span class="keyword1">o</span> <span class="free">g</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">y</span> <span class="main">⟷</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="main">-</span><span class="free">f</span><span class="main">(</span><span class="free">g</span><span class="main">(</span><span class="main">-</span><span class="skolem">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> residuated_conjugate_ineq<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> residuated_comp_closed<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">⟷</span> conjugate <span class="free">g</span> <span class="main">(</span>conjugate <span class="free">f</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> residuated_conjugate_ineq<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>conjugate <span class="main">(</span><span class="free">f</span> <span class="main">∘</span> <span class="free">g</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>conjugate <span class="free">g</span> <span class="main">∘</span> conjugate <span class="free">f</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">y</span><span class="main">)</span>"</span></span>   
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span> 

<span class="keyword1" id="Residuated_Boolean_Algebras-conjugate_comp_ext"><span class="command">lemma</span></span> conjugate_comp_ext<span class="main">:</span> <span class="quoted"><span class="quoted">"residuated <span class="free">f</span> <span class="main">⟹</span> residuated <span class="free">g</span> <span class="main">⟹</span> conjugate <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="free">g</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> conjugate <span class="free">g</span> <span class="main">(</span>conjugate <span class="free">f</span> <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> conjugate_comp <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_def<span class="main">)</span>
  
<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* boolean_algebra *)</span>

<span class="keyword1"><span class="command">context</span></span> complete_boolean_algebra <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  On a complete boolean algebra, it is possible to give an explicit
  definition of conjugation.
›</span></span>

<span class="keyword1" id="Residuated_Boolean_Algebras-conjugate_eq"><span class="command">lemma</span></span> conjugate_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"residuated <span class="free">f</span> <span class="main">⟹</span> conjugate <span class="free">f</span> <span class="free">y</span> <span class="main">=</span> <span class="main">⨅</span><span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">y</span> <span class="main">≤</span> <span class="main">-</span><span class="free">f</span><span class="main">(</span><span class="main">-</span><span class="bound">x</span><span class="main">)</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> assm<span class="main">:</span> <span class="quoted"><span class="quoted">"residuated <span class="free">f</span>"</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> g_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">=</span> conjugate <span class="free">f</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="free">y</span> <span class="main">=</span> <span class="main">⨅</span><span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≥</span> <span class="skolem">g</span> <span class="free">y</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> order.antisym Inf_lower Inf_greatest<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">⨅</span><span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">-</span><span class="bound">x</span> <span class="main">⊓</span> <span class="skolem">g</span> <span class="free">y</span> <span class="main">=</span> <span class="main">⊥</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inf_bot_iff_le<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">⨅</span><span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="main">-</span><span class="bound">x</span><span class="main">)</span> <span class="main">⊓</span> <span class="free">y</span> <span class="main">=</span> <span class="main">⊥</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conjugate_iff_def assm g_def<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> g_def le_iff_inf_bot inf_commute<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* complete_boolean_algebra *)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Residuated Boolean Structures›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  In this section, we present various residuated structures based on
  boolean algebras.
  The left and right conjugation of the multiplicative operation is
  defined, and a number of facts is derived.
›</span></span>

<span class="keyword1"><span class="command">class</span></span> residuated_boolean_algebra <span class="main">=</span> boolean_algebra <span class="main">+</span> residuated_pogroupoid
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subclass</span></span> residuated_lgroupoid <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">conjugate_l</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">⊲</span>"</span> 60<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main"><span class="free">⊲</span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">≡</span> <span class="main">-</span><span class="main">(</span><span class="main">-</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">←</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">conjugate_r</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">⊳</span>"</span> 60<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main"><span class="free">⊳</span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">≡</span> <span class="main">-</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">→</span> <span class="main">-</span><span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span>"</span></span>
  
<span class="keyword1" id="Residuated_Boolean_Algebras-residual_conjugate_r"><span class="command">lemma</span></span> residual_conjugate_r<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">→</span> <span class="free">y</span> <span class="main">=</span> <span class="main">-</span><span class="main">(</span><span class="free">x</span> <span class="main">⊳</span> <span class="main">-</span><span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conjugate_r_def double_compl<span class="main">)</span>
  
<span class="keyword1" id="Residuated_Boolean_Algebras-residual_conjugate_l"><span class="command">lemma</span></span> residual_conjugate_l<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">←</span> <span class="free">y</span> <span class="main">=</span> <span class="main">-</span><span class="main">(</span><span class="main">-</span><span class="free">x</span> <span class="main">⊲</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conjugate_l_def double_compl<span class="main">)</span>
  
<span class="keyword1" id="Residuated_Boolean_Algebras-conjugation_multl"><span class="command">lemma</span></span> conjugation_multl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">⋅</span><span class="free">y</span> <span class="main">⊓</span> <span class="free">z</span> <span class="main">=</span> <span class="main">⊥</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">⊓</span> <span class="main">(</span><span class="free">z</span> <span class="main">⊲</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conjugate_l_def double_compl le_iff_inf_bot resl_galois<span class="main">)</span>

<span class="keyword1" id="Residuated_Boolean_Algebras-conjugation_multr"><span class="command">lemma</span></span> conjugation_multr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">⋅</span><span class="free">y</span> <span class="main">⊓</span> <span class="free">z</span> <span class="main">=</span> <span class="main">⊥</span> <span class="main">⟷</span> <span class="free">y</span> <span class="main">⊓</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊳</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conjugate_r_def inf_bot_iff_le le_iff_inf_bot resr_galois<span class="main">)</span>
  
<span class="keyword1" id="Residuated_Boolean_Algebras-conjugation_conj"><span class="command">lemma</span></span> conjugation_conj<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">⊲</span> <span class="free">y</span><span class="main">)</span> <span class="main">⊓</span> <span class="free">z</span> <span class="main">=</span> <span class="main">⊥</span> <span class="main">⟷</span> <span class="free">y</span> <span class="main">⊓</span> <span class="main">(</span><span class="free">z</span> <span class="main">⊳</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf_commute conjugation_multr conjugation_multl<span class="main">)</span>

<span class="keyword1" id="Residuated_Boolean_Algebras-conjugation_pair_multl"><span class="command">lemma</span></span> conjugation_pair_multl <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"conjugation_pair <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">⋅</span><span class="free">y</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">⊲</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> conjugation_pair_def conjugation_multl<span class="main">)</span>
  
<span class="keyword1" id="Residuated_Boolean_Algebras-conjugation_pair_multr"><span class="command">lemma</span></span> conjugation_pair_multr <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"conjugation_pair <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">y</span><span class="main">⋅</span><span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">y</span> <span class="main">⊳</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> conjugation_pair_def conjugation_multr<span class="main">)</span>
  
<span class="keyword1" id="Residuated_Boolean_Algebras-conjugation_pair_conj"><span class="command">lemma</span></span> conjugation_pair_conj <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"conjugation_pair <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">y</span> <span class="main">⊲</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">⊳</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> conjugation_pair_def conjugation_conj<span class="main">)</span>
  
<span class="keyword1" id="Residuated_Boolean_Algebras-residuated_conjl1"><span class="command">lemma</span></span> residuated_conjl1 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"residuated <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">⊲</span> <span class="free">y</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conj_residuatedI2 conjugation_pair_multl<span class="main">)</span>
  
<span class="keyword1" id="Residuated_Boolean_Algebras-residuated_conjl2"><span class="command">lemma</span></span> residuated_conjl2 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"residuated <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">y</span> <span class="main">⊲</span> <span class="bound">x</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conj_residuatedI1 conjugation_pair_conj<span class="main">)</span>
  
<span class="keyword1" id="Residuated_Boolean_Algebras-residuated_conjr1"><span class="command">lemma</span></span> residuated_conjr1 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"residuated <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">y</span> <span class="main">⊳</span> <span class="bound">x</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conj_residuatedI2 conjugation_pair_multr<span class="main">)</span>
  
<span class="keyword1" id="Residuated_Boolean_Algebras-residuated_conjr2"><span class="command">lemma</span></span> residuated_conjr2 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"residuated <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">⊳</span> <span class="free">y</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conj_residuatedI2 conjugation_pair_conj<span class="main">)</span>
  
<span class="keyword1" id="Residuated_Boolean_Algebras-conjugate_multr"><span class="command">lemma</span></span> conjugate_multr <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"conjugate <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">y</span><span class="main">⋅</span><span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">y</span> <span class="main">⊳</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conjugation_pair_multr residuated_conj1 residuated_multr unique_conjugate<span class="main">)</span>
  
<span class="keyword1" id="Residuated_Boolean_Algebras-conjugate_conjr1"><span class="command">lemma</span></span> conjugate_conjr1 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"conjugate <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">y</span> <span class="main">⊳</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">y</span><span class="main">⋅</span><span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conjugate_multr conj_involution residuated_multr<span class="main">)</span>
  
<span class="keyword1" id="Residuated_Boolean_Algebras-conjugate_multl"><span class="command">lemma</span></span> conjugate_multl <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"conjugate <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">⋅</span><span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">⊲</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conjugation_pair_multl residuated_conj1 residuated_multl unique_conjugate<span class="main">)</span>
 
<span class="keyword1" id="Residuated_Boolean_Algebras-conjugate_conjl1"><span class="command">lemma</span></span> conjugate_conjl1 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"conjugate <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">⊲</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">⋅</span><span class="free">y</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"conjugate <span class="main">(</span>conjugate <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">⋅</span><span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> conjugate <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">⊲</span> <span class="free">y</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conj_involution<span class="main"><span class="main">[</span></span><span class="operator">OF</span> residuated_multl<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Residuated_Boolean_Algebras-conjugate_conjl2"><span class="command">lemma</span></span> conjugate_conjl2<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"conjugate <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">y</span> <span class="main">⊲</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">⊳</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conjugation_pair_conj unique_conjugate residuated_conj1 residuated_conjl2<span class="main">)</span>

<span class="keyword1" id="Residuated_Boolean_Algebras-conjugate_conjr2"><span class="command">lemma</span></span> conjugate_conjr2<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"conjugate <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">⊳</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">y</span> <span class="main">⊲</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"conjugate <span class="main">(</span>conjugate <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">y</span> <span class="main">⊲</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> conjugate <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">⊳</span> <span class="free">y</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conj_involution<span class="main"><span class="main">[</span></span><span class="operator">OF</span> residuated_conjl2<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Residuated_Boolean_Algebras-conjl1_iso"><span class="command">lemma</span></span> conjl1_iso<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">⊲</span> <span class="free">z</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⊲</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conjugate_l_def compl_mono resl_iso<span class="main">)</span>

<span class="keyword1" id="Residuated_Boolean_Algebras-conjl2_iso"><span class="command">lemma</span></span> conjl2_iso<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">z</span> <span class="main">⊲</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">z</span> <span class="main">⊲</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> res_iso residuated_conjl2<span class="main">)</span>

<span class="keyword1" id="Residuated_Boolean_Algebras-conjr1_iso"><span class="command">lemma</span></span> conjr1_iso<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">z</span> <span class="main">⊳</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">z</span> <span class="main">⊳</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> res_iso residuated_conjr1<span class="main">)</span>

<span class="keyword1" id="Residuated_Boolean_Algebras-conjr2_iso"><span class="command">lemma</span></span> conjr2_iso<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">⊳</span> <span class="free">z</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⊳</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conjugate_r_def compl_mono resr_antitonel<span class="main">)</span>

<span class="keyword1" id="Residuated_Boolean_Algebras-conjl1_sup"><span class="command">lemma</span></span> conjl1_sup<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">⊲</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">z</span> <span class="main">⊲</span> <span class="free">x</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="free">z</span> <span class="main">⊲</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conjugate_l_def compl_inf resl_distr<span class="main">)</span>

<span class="keyword1" id="Residuated_Boolean_Algebras-conjl2_sup"><span class="command">lemma</span></span> conjl2_sup<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span><span class="main">)</span> <span class="main">⊲</span> <span class="free">z</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊲</span> <span class="free">z</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="free">y</span> <span class="main">⊲</span> <span class="free">z</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>poly_guards_query<span class="main"><span class="main">)</span></span> residuated_sup residuated_conjl1<span class="main">)</span>

<span class="keyword1" id="Residuated_Boolean_Algebras-conjr1_sup"><span class="command">lemma</span></span> conjr1_sup<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">⊳</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">z</span> <span class="main">⊳</span> <span class="free">x</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="free">z</span> <span class="main">⊳</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> residuated_sup residuated_conjr1<span class="main">)</span>

<span class="keyword1" id="Residuated_Boolean_Algebras-conjr2_sup"><span class="command">lemma</span></span> conjr2_sup<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span><span class="main">)</span> <span class="main">⊳</span> <span class="free">z</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊳</span> <span class="free">z</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="free">y</span> <span class="main">⊳</span> <span class="free">z</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conjugate_r_def compl_inf resr_distl<span class="main">)</span>

<span class="keyword1" id="Residuated_Boolean_Algebras-conjl1_strict"><span class="command">lemma</span></span> conjl1_strict<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊥</span> <span class="main">⊲</span> <span class="free">x</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> residuated_strict residuated_conjl1<span class="main">)</span>

<span class="keyword1" id="Residuated_Boolean_Algebras-conjl2_strict"><span class="command">lemma</span></span> conjl2_strict<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⊲</span> <span class="main">⊥</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> residuated_strict residuated_conjl2<span class="main">)</span>

<span class="keyword1" id="Residuated_Boolean_Algebras-conjr1_strict"><span class="command">lemma</span></span> conjr1_strict<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊥</span> <span class="main">⊳</span> <span class="free">x</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> residuated_strict residuated_conjr2<span class="main">)</span>

<span class="keyword1" id="Residuated_Boolean_Algebras-conjr2_strict"><span class="command">lemma</span></span> conjr2_strict<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⊳</span> <span class="main">⊥</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> residuated_strict residuated_conjr1<span class="main">)</span>

<span class="keyword1" id="Residuated_Boolean_Algebras-conjl1_iff"><span class="command">lemma</span></span> conjl1_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⊲</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">z</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">≤</span> <span class="main">-</span><span class="main">(</span><span class="main">-</span><span class="free">z</span><span class="main">⋅</span><span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conjugate_l_def compl_le_swap1 compl_le_swap2 resl_galois<span class="main">)</span>

<span class="keyword1" id="Residuated_Boolean_Algebras-conjl2_iff"><span class="command">lemma</span></span> conjl2_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⊲</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">z</span> <span class="main">⟷</span> <span class="free">y</span> <span class="main">≤</span> <span class="main">-</span><span class="main">(</span><span class="main">-</span><span class="free">z</span> <span class="main">⊳</span> <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conjl1_iff conjugate_r_def compl_le_swap2 double_compl resr_galois<span class="main">)</span>

<span class="keyword1" id="Residuated_Boolean_Algebras-conjr1_iff"><span class="command">lemma</span></span> conjr1_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⊳</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">z</span> <span class="main">⟷</span> <span class="free">y</span> <span class="main">≤</span> <span class="main">-</span><span class="main">(</span><span class="free">x</span><span class="main">⋅</span><span class="main">-</span><span class="free">z</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conjugate_r_def compl_le_swap1 double_compl resr_galois<span class="main">)</span>

<span class="keyword1" id="Residuated_Boolean_Algebras-conjr2_iff"><span class="command">lemma</span></span> conjr2_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⊳</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">z</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">≤</span> <span class="main">-</span><span class="main">(</span><span class="free">y</span> <span class="main">⊲</span> <span class="main">-</span><span class="free">z</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conjugation_conj double_compl inf.commute le_iff_inf_bot<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  We apply Maddux's lemmas regarding conjugation of an arbitrary residuated function 
  for each of the 6 functions.
›</span></span>
  
<span class="keyword1" id="Residuated_Boolean_Algebras-maddux1a"><span class="command">lemma</span></span> maddux1a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">⋅</span><span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span><span class="free">a</span> <span class="main">⊳</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="free">a</span><span class="main">⋅</span><span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">insert</span> maddux1 <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">λ</span></span></span><span class="bound"><span class="bound"><span class="bound">x</span></span></span><span class="main"><span class="main"><span class="main">.</span></span></span> <span class="free"><span class="free"><span class="free">a</span></span></span><span class="main"><span class="main"><span class="main">⋅</span></span></span><span class="bound"><span class="bound"><span class="bound">x</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">simp</span>
  
<span class="keyword1" id="Residuated_Boolean_Algebras-maddux1a'"><span class="command">lemma</span></span> maddux1a'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">⋅</span><span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span><span class="free">a</span> <span class="main">⊳</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="main">-</span><span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">insert</span> maddux1 <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">λ</span></span></span><span class="bound"><span class="bound"><span class="bound">x</span></span></span><span class="main"><span class="main"><span class="main">.</span></span></span> <span class="free"><span class="free"><span class="free">a</span></span></span><span class="main"><span class="main"><span class="main">⋅</span></span></span><span class="bound"><span class="bound"><span class="bound">x</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">simp</span>
  
<span class="keyword1" id="Residuated_Boolean_Algebras-maddux1b"><span class="command">lemma</span></span> maddux1b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span><span class="free">y</span> <span class="main">⊲</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span><span class="main">⋅</span><span class="free">a</span> <span class="main">≤</span> <span class="free">x</span><span class="main">⋅</span><span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">insert</span> maddux1 <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">λ</span></span></span><span class="bound"><span class="bound"><span class="bound">x</span></span></span><span class="main"><span class="main"><span class="main">.</span></span></span> <span class="bound"><span class="bound"><span class="bound">x</span></span></span><span class="main"><span class="main"><span class="main">⋅</span></span></span><span class="free"><span class="free"><span class="free">a</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">simp</span>
  
<span class="keyword1" id="Residuated_Boolean_Algebras-maddux1b'"><span class="command">lemma</span></span> maddux1b'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span><span class="free">y</span> <span class="main">⊲</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span><span class="main">⋅</span><span class="free">a</span> <span class="main">≤</span> <span class="main">-</span><span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">insert</span> maddux1 <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">λ</span></span></span><span class="bound"><span class="bound"><span class="bound">x</span></span></span><span class="main"><span class="main"><span class="main">.</span></span></span> <span class="bound"><span class="bound"><span class="bound">x</span></span></span><span class="main"><span class="main"><span class="main">⋅</span></span></span><span class="free"><span class="free"><span class="free">a</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">simp</span>
  
<span class="keyword1" id="Residuated_Boolean_Algebras-maddux1c"><span class="command">lemma</span></span> maddux1c<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="free">a</span> <span class="main">⊲</span> <span class="free">x</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span><span class="free">y</span> <span class="main">⊳</span> <span class="free">a</span><span class="main">)</span> <span class="main">≤</span> <span class="free">a</span> <span class="main">⊲</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">insert</span> maddux1 <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">λ</span></span></span><span class="bound"><span class="bound"><span class="bound">x</span></span></span><span class="main"><span class="main"><span class="main">.</span></span></span> <span class="free"><span class="free"><span class="free">a</span></span></span> <span class="main"><span class="main"><span class="main">⊲</span></span></span> <span class="bound"><span class="bound"><span class="bound">x</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">simp</span>
  
<span class="keyword1" id="Residuated_Boolean_Algebras-maddux1c'"><span class="command">lemma</span></span> maddux1c'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">⊲</span> <span class="free">x</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span><span class="free">y</span> <span class="main">⊳</span> <span class="free">a</span><span class="main">)</span> <span class="main">≤</span> <span class="main">-</span><span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">insert</span> maddux1 <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">λ</span></span></span><span class="bound"><span class="bound"><span class="bound">x</span></span></span><span class="main"><span class="main"><span class="main">.</span></span></span> <span class="free"><span class="free"><span class="free">a</span></span></span> <span class="main"><span class="main"><span class="main">⊲</span></span></span> <span class="bound"><span class="bound"><span class="bound">x</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">simp</span>
  
<span class="keyword1" id="Residuated_Boolean_Algebras-maddux1d"><span class="command">lemma</span></span> maddux1d<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">⊳</span> <span class="free">x</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span><span class="free">a</span><span class="main">⋅</span><span class="free">y</span><span class="main">)</span> <span class="main">≤</span> <span class="free">a</span> <span class="main">⊳</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">insert</span> maddux1 <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">λ</span></span></span><span class="bound"><span class="bound"><span class="bound">x</span></span></span><span class="main"><span class="main"><span class="main">.</span></span></span> <span class="free"><span class="free"><span class="free">a</span></span></span> <span class="main"><span class="main"><span class="main">⊳</span></span></span> <span class="bound"><span class="bound"><span class="bound">x</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">simp</span>
  
<span class="keyword1" id="Residuated_Boolean_Algebras-maddux1d'"><span class="command">lemma</span></span> maddux1d'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">⊳</span> <span class="free">x</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span><span class="free">a</span><span class="main">⋅</span><span class="free">y</span><span class="main">)</span> <span class="main">≤</span> <span class="main">-</span><span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">insert</span> maddux1 <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">λ</span></span></span><span class="bound"><span class="bound"><span class="bound">x</span></span></span><span class="main"><span class="main"><span class="main">.</span></span></span> <span class="free"><span class="free"><span class="free">a</span></span></span> <span class="main"><span class="main"><span class="main">⊳</span></span></span> <span class="bound"><span class="bound"><span class="bound">x</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">simp</span>

<span class="keyword1" id="Residuated_Boolean_Algebras-maddux1e"><span class="command">lemma</span></span> maddux1e<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span><span class="free">y</span><span class="main">⋅</span><span class="free">a</span><span class="main">)</span> <span class="main">⊲</span> <span class="free">a</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">⊲</span> <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">insert</span> maddux1 <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">λ</span></span></span><span class="bound"><span class="bound"><span class="bound">x</span></span></span><span class="main"><span class="main"><span class="main">.</span></span></span> <span class="bound"><span class="bound"><span class="bound">x</span></span></span> <span class="main"><span class="main"><span class="main">⊲</span></span></span> <span class="free"><span class="free"><span class="free">a</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">simp</span>
  
<span class="keyword1" id="Residuated_Boolean_Algebras-maddux1e'"><span class="command">lemma</span></span> maddux1e'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span><span class="free">y</span><span class="main">⋅</span><span class="free">a</span><span class="main">)</span> <span class="main">⊲</span> <span class="free">a</span> <span class="main">≤</span> <span class="main">-</span><span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">insert</span> maddux1 <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">λ</span></span></span><span class="bound"><span class="bound"><span class="bound">x</span></span></span><span class="main"><span class="main"><span class="main">.</span></span></span> <span class="bound"><span class="bound"><span class="bound">x</span></span></span> <span class="main"><span class="main"><span class="main">⊲</span></span></span> <span class="free"><span class="free"><span class="free">a</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">simp</span>
  
<span class="keyword1" id="Residuated_Boolean_Algebras-maddux1f"><span class="command">lemma</span></span> maddux1f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span><span class="free">a</span> <span class="main">⊲</span> <span class="free">y</span><span class="main">)</span> <span class="main">⊳</span> <span class="free">a</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">⊳</span> <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">insert</span> maddux1 <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">λ</span></span></span><span class="bound"><span class="bound"><span class="bound">x</span></span></span><span class="main"><span class="main"><span class="main">.</span></span></span> <span class="bound"><span class="bound"><span class="bound">x</span></span></span> <span class="main"><span class="main"><span class="main">⊳</span></span></span> <span class="free"><span class="free"><span class="free">a</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">simp</span>
  
<span class="keyword1" id="Residuated_Boolean_Algebras-maddux1f'"><span class="command">lemma</span></span> maddux1f'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span><span class="free">a</span> <span class="main">⊲</span> <span class="free">y</span><span class="main">)</span> <span class="main">⊳</span> <span class="free">a</span> <span class="main">≤</span> <span class="main">-</span><span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">insert</span> maddux1 <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">λ</span></span></span><span class="bound"><span class="bound"><span class="bound">x</span></span></span><span class="main"><span class="main"><span class="main">.</span></span></span> <span class="bound"><span class="bound"><span class="bound">x</span></span></span> <span class="main"><span class="main"><span class="main">⊳</span></span></span> <span class="free"><span class="free"><span class="free">a</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">simp</span>

<span class="keyword1" id="Residuated_Boolean_Algebras-maddux2a"><span class="command">lemma</span></span> maddux2a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">⋅</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">a</span><span class="main">⋅</span><span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="main">(</span><span class="free">a</span> <span class="main">⊳</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">insert</span> maddux2 <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">λ</span></span></span><span class="bound"><span class="bound"><span class="bound">x</span></span></span><span class="main"><span class="main"><span class="main">.</span></span></span> <span class="free"><span class="free"><span class="free">a</span></span></span><span class="main"><span class="main"><span class="main">⋅</span></span></span><span class="bound"><span class="bound"><span class="bound">x</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">simp</span>
  
<span class="keyword1" id="Residuated_Boolean_Algebras-maddux2b"><span class="command">lemma</span></span> maddux2b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">⋅</span><span class="free">a</span> <span class="main">⊓</span> <span class="free">y</span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="main">(</span><span class="free">y</span> <span class="main">⊲</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span><span class="main">⋅</span><span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">insert</span> maddux2 <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">λ</span></span></span><span class="bound"><span class="bound"><span class="bound">x</span></span></span><span class="main"><span class="main"><span class="main">.</span></span></span> <span class="bound"><span class="bound"><span class="bound">x</span></span></span><span class="main"><span class="main"><span class="main">⋅</span></span></span><span class="free"><span class="free"><span class="free">a</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">simp</span>
  
<span class="keyword1" id="Residuated_Boolean_Algebras-maddux2c"><span class="command">lemma</span></span> maddux2c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span> <span class="main">⊲</span> <span class="free">x</span><span class="main">)</span> <span class="main">⊓</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">a</span> <span class="main">⊲</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="main">(</span><span class="free">y</span> <span class="main">⊳</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">insert</span> maddux2 <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">λ</span></span></span><span class="bound"><span class="bound"><span class="bound">x</span></span></span><span class="main"><span class="main"><span class="main">.</span></span></span> <span class="free"><span class="free"><span class="free">a</span></span></span> <span class="main"><span class="main"><span class="main">⊲</span></span></span> <span class="bound"><span class="bound"><span class="bound">x</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">simp</span>
  
<span class="keyword1" id="Residuated_Boolean_Algebras-maddux2d"><span class="command">lemma</span></span> maddux2d<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span> <span class="main">⊳</span> <span class="free">x</span><span class="main">)</span> <span class="main">⊓</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">a</span> <span class="main">⊳</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">a</span><span class="main">⋅</span><span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">insert</span> maddux2 <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">λ</span></span></span><span class="bound"><span class="bound"><span class="bound">x</span></span></span><span class="main"><span class="main"><span class="main">.</span></span></span> <span class="free"><span class="free"><span class="free">a</span></span></span> <span class="main"><span class="main"><span class="main">⊳</span></span></span> <span class="bound"><span class="bound"><span class="bound">x</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">simp</span>

<span class="keyword1" id="Residuated_Boolean_Algebras-maddux2e"><span class="command">lemma</span></span> maddux2e<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">⊲</span> <span class="free">a</span><span class="main">)</span> <span class="main">⊓</span> <span class="free">y</span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span><span class="main">⋅</span><span class="free">a</span><span class="main">)</span> <span class="main">⊲</span> <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">insert</span> maddux2 <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">λ</span></span></span><span class="bound"><span class="bound"><span class="bound">x</span></span></span><span class="main"><span class="main"><span class="main">.</span></span></span> <span class="bound"><span class="bound"><span class="bound">x</span></span></span> <span class="main"><span class="main"><span class="main">⊲</span></span></span> <span class="free"><span class="free"><span class="free">a</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">simp</span>
  
<span class="keyword1" id="Residuated_Boolean_Algebras-maddux2f"><span class="command">lemma</span></span> maddux2f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">⊳</span> <span class="free">a</span><span class="main">)</span> <span class="main">⊓</span> <span class="free">y</span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="main">(</span><span class="free">a</span> <span class="main">⊲</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="main">⊳</span> <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">insert</span> maddux2 <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">λ</span></span></span><span class="bound"><span class="bound"><span class="bound">x</span></span></span><span class="main"><span class="main"><span class="main">.</span></span></span> <span class="bound"><span class="bound"><span class="bound">x</span></span></span> <span class="main"><span class="main"><span class="main">⊳</span></span></span> <span class="free"><span class="free"><span class="free">a</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">simp</span>
  
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The multiplicative operation $\cdot$ on a residuated boolean algebra is generally not
  associative. We prove some equivalences related to associativity.
›</span></span>

<span class="keyword1" id="Residuated_Boolean_Algebras-res_assoc_iff1"><span class="command">lemma</span></span> res_assoc_iff1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="bound">y</span> <span class="bound">z</span><span class="main">.</span> <span class="bound">x</span><span class="main">⋅</span><span class="main">(</span><span class="bound">y</span><span class="main">⋅</span><span class="bound">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">x</span><span class="main">⋅</span><span class="bound">y</span><span class="main">)</span><span class="main">⋅</span><span class="bound">z</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="bound">y</span> <span class="bound">z</span><span class="main">.</span> <span class="bound">x</span> <span class="main">⊳</span> <span class="main">(</span><span class="bound">y</span> <span class="main">⊳</span> <span class="bound">z</span><span class="main">)</span> <span class="main">=</span> <span class="bound">y</span><span class="main">⋅</span><span class="bound">x</span> <span class="main">⊳</span> <span class="bound">z</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">z</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="bound">y</span> <span class="bound">z</span><span class="main">.</span> <span class="bound">x</span><span class="main">⋅</span><span class="main">(</span><span class="bound">y</span><span class="main">⋅</span><span class="bound">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">x</span><span class="main">⋅</span><span class="bound">y</span><span class="main">)</span><span class="main">⋅</span><span class="bound">z</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">⊳</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">⊳</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">y</span> <span class="main">⋅</span> <span class="skolem">x</span> <span class="main">⊳</span> <span class="skolem">z</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> conjugate_comp_ext<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">z</span><span class="main">.</span> <span class="skolem">y</span><span class="main">⋅</span><span class="bound">z</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">z</span><span class="main">.</span> <span class="skolem">x</span><span class="main">⋅</span><span class="bound">z</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">z</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="bound">y</span> <span class="bound">z</span><span class="main">.</span> <span class="bound">x</span> <span class="main">⊳</span> <span class="main">(</span><span class="bound">y</span> <span class="main">⊳</span> <span class="bound">z</span><span class="main">)</span> <span class="main">=</span> <span class="bound">y</span><span class="main">⋅</span><span class="bound">x</span> <span class="main">⊳</span> <span class="bound">z</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">⋅</span><span class="main">(</span><span class="skolem">y</span><span class="main">⋅</span><span class="skolem">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">x</span><span class="main">⋅</span><span class="skolem">y</span><span class="main">)</span><span class="main">⋅</span><span class="skolem">z</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> conjugate_comp_ext<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">z</span><span class="main">.</span> <span class="skolem">y</span> <span class="main">⊳</span> <span class="bound">z</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">z</span><span class="main">.</span> <span class="skolem">x</span> <span class="main">⊳</span> <span class="bound">z</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Residuated_Boolean_Algebras-res_assoc_iff2"><span class="command">lemma</span></span> res_assoc_iff2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="bound">y</span> <span class="bound">z</span><span class="main">.</span> <span class="bound">x</span><span class="main">⋅</span><span class="main">(</span><span class="bound">y</span><span class="main">⋅</span><span class="bound">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">x</span><span class="main">⋅</span><span class="bound">y</span><span class="main">)</span><span class="main">⋅</span><span class="bound">z</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="bound">y</span> <span class="bound">z</span><span class="main">.</span> <span class="bound">x</span> <span class="main">⊲</span> <span class="main">(</span><span class="bound">y</span> <span class="main">⋅</span> <span class="bound">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">x</span> <span class="main">⊲</span> <span class="bound">z</span><span class="main">)</span> <span class="main">⊲</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">z</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="bound">y</span> <span class="bound">z</span><span class="main">.</span> <span class="bound">x</span><span class="main">⋅</span><span class="main">(</span><span class="bound">y</span><span class="main">⋅</span><span class="bound">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">x</span><span class="main">⋅</span><span class="bound">y</span><span class="main">)</span><span class="main">⋅</span><span class="bound">z</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="bound">y</span> <span class="bound">z</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">⋅</span><span class="bound">y</span><span class="main">)</span><span class="main">⋅</span><span class="bound">z</span> <span class="main">=</span> <span class="bound">x</span><span class="main">⋅</span><span class="main">(</span><span class="bound">y</span><span class="main">⋅</span><span class="bound">z</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">⊲</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">⋅</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">⊲</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">⊲</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> conjugate_comp_ext<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">⋅</span><span class="skolem">z</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">⋅</span><span class="skolem">y</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">z</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="bound">y</span> <span class="bound">z</span><span class="main">.</span> <span class="bound">x</span> <span class="main">⊲</span> <span class="main">(</span><span class="bound">y</span> <span class="main">⋅</span> <span class="bound">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">x</span> <span class="main">⊲</span> <span class="bound">z</span><span class="main">)</span> <span class="main">⊲</span> <span class="bound">y</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="bound">y</span> <span class="bound">z</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span> <span class="main">⊲</span> <span class="bound">z</span><span class="main">)</span> <span class="main">⊲</span> <span class="bound">y</span> <span class="main">=</span> <span class="bound">x</span> <span class="main">⊲</span> <span class="main">(</span><span class="bound">y</span> <span class="main">⋅</span> <span class="bound">z</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">⋅</span><span class="main">(</span><span class="skolem">y</span><span class="main">⋅</span><span class="skolem">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">x</span><span class="main">⋅</span><span class="skolem">y</span><span class="main">)</span><span class="main">⋅</span><span class="skolem">z</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> conjugate_comp_ext<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">z</span><span class="main">.</span> <span class="bound">z</span> <span class="main">⊲</span> <span class="skolem">y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">⊲</span> <span class="skolem">z</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1" id="Residuated_Boolean_Algebras-res_assoc_iff3"><span class="command">lemma</span></span> res_assoc_iff3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="bound">y</span> <span class="bound">z</span><span class="main">.</span> <span class="bound">x</span><span class="main">⋅</span><span class="main">(</span><span class="bound">y</span><span class="main">⋅</span><span class="bound">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">x</span><span class="main">⋅</span><span class="bound">y</span><span class="main">)</span><span class="main">⋅</span><span class="bound">z</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="bound">y</span> <span class="bound">z</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span> <span class="main">⊳</span> <span class="bound">y</span><span class="main">)</span> <span class="main">⊲</span> <span class="bound">z</span> <span class="main">=</span> <span class="bound">x</span> <span class="main">⊳</span> <span class="main">(</span><span class="bound">y</span> <span class="main">⊲</span> <span class="bound">z</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">z</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="bound">y</span> <span class="bound">z</span><span class="main">.</span> <span class="bound">x</span><span class="main">⋅</span><span class="main">(</span><span class="bound">y</span><span class="main">⋅</span><span class="bound">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">x</span><span class="main">⋅</span><span class="bound">y</span><span class="main">)</span><span class="main">⋅</span><span class="bound">z</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span> <span class="main">⊳</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">⊲</span> <span class="skolem">z</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">⊳</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">⊲</span> <span class="skolem">z</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> conjugate_comp_ext<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">u</span><span class="main">.</span> <span class="skolem">x</span><span class="main">⋅</span><span class="bound">u</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">u</span><span class="main">.</span> <span class="bound">u</span><span class="main">⋅</span><span class="skolem">z</span>"</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span>
    conjugate_comp_ext<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">u</span><span class="main">.</span> <span class="bound">u</span><span class="main">⋅</span><span class="skolem">z</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">u</span><span class="main">.</span> <span class="skolem">x</span><span class="main">⋅</span><span class="bound">u</span>"</span></span><span class="main">,</span> <span class="operator">symmetric</span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">z</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="bound">y</span> <span class="bound">z</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span> <span class="main">⊳</span> <span class="bound">y</span><span class="main">)</span> <span class="main">⊲</span> <span class="bound">z</span> <span class="main">=</span> <span class="bound">x</span> <span class="main">⊳</span> <span class="main">(</span><span class="bound">y</span> <span class="main">⊲</span> <span class="bound">z</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">⋅</span><span class="main">(</span><span class="skolem">y</span><span class="main">⋅</span><span class="skolem">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">x</span><span class="main">⋅</span><span class="skolem">y</span><span class="main">)</span><span class="main">⋅</span><span class="skolem">z</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> conjugate_comp_ext<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">u</span><span class="main">.</span> <span class="skolem">x</span> <span class="main">⊳</span> <span class="bound">u</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">u</span><span class="main">.</span> <span class="bound">u</span> <span class="main">⊲</span> <span class="skolem">z</span>"</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span>
    conjugate_comp_ext<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">u</span><span class="main">.</span> <span class="bound">u</span> <span class="main">⊲</span> <span class="skolem">z</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">u</span><span class="main">.</span> <span class="skolem">x</span> <span class="main">⊳</span> <span class="bound">u</span>"</span></span><span class="main">,</span> <span class="operator">symmetric</span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* residuated_boolean_algebra *)</span>

<span class="keyword1"><span class="command">class</span></span> unital_residuated_boolean <span class="main">=</span> residuated_boolean_algebra <span class="main">+</span> one <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> mult_onel <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">⋅</span><span class="main">1</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> mult_oner <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">⋅</span><span class="free">x</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The following equivalences are taken from J{\'o}sson and Tsinakis.
›</span></span>

<span class="keyword1" id="Residuated_Boolean_Algebras-jonsson1a"><span class="command">lemma</span></span> jonsson1a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">f</span><span class="main">.</span> <span class="main">∀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">x</span> <span class="main">⊳</span> <span class="bound">y</span> <span class="main">=</span> <span class="bound">f</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">⋅</span><span class="bound">y</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">x</span> <span class="main">⊳</span> <span class="bound">y</span> <span class="main">=</span> <span class="main">(</span><span class="bound">x</span> <span class="main">⊳</span> <span class="main">1</span><span class="main">)</span><span class="main">⋅</span><span class="bound">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">standard</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">⊳</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  
<span class="keyword1" id="Residuated_Boolean_Algebras-jonsson1b"><span class="command">lemma</span></span> jonsson1b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">x</span> <span class="main">⊳</span> <span class="bound">y</span> <span class="main">=</span> <span class="main">(</span><span class="bound">x</span> <span class="main">⊳</span> <span class="main">1</span><span class="main">)</span><span class="main">⋅</span><span class="bound">y</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">x</span><span class="main">⋅</span><span class="bound">y</span> <span class="main">=</span> <span class="main">(</span><span class="bound">x</span> <span class="main">⊳</span> <span class="main">1</span><span class="main">)</span> <span class="main">⊳</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">x</span> <span class="main">⊳</span> <span class="bound">y</span> <span class="main">=</span> <span class="main">(</span><span class="bound">x</span> <span class="main">⊳</span> <span class="main">1</span><span class="main">)</span><span class="main">⋅</span><span class="bound">y</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"conjugate <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="skolem">x</span> <span class="main">⊳</span> <span class="bound">y</span><span class="main">)</span> <span class="main">=</span> conjugate <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">⊳</span> <span class="main">1</span><span class="main">)</span><span class="main">⋅</span><span class="bound">y</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">⋅</span><span class="skolem">y</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">⊳</span> <span class="main">1</span><span class="main">)</span> <span class="main">⊳</span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">x</span> <span class="main">⋅</span> <span class="bound">y</span> <span class="main">=</span> <span class="bound">x</span> <span class="main">⊳</span> <span class="main">1</span> <span class="main">⊳</span> <span class="bound">y</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">⊳</span> <span class="skolem">y</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">⊳</span> <span class="main">1</span><span class="main">)</span> <span class="main">⋅</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult_onel<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Residuated_Boolean_Algebras-jonsson1c"><span class="command">lemma</span></span> jonsson1c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">x</span> <span class="main">⊳</span> <span class="bound">y</span> <span class="main">=</span> <span class="main">(</span><span class="bound">x</span> <span class="main">⊳</span> <span class="main">1</span><span class="main">)</span><span class="main">⋅</span><span class="bound">y</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">⊲</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">1</span> <span class="main">⊲</span> <span class="main">(</span><span class="bound">x</span> <span class="main">⊲</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">x</span> <span class="main">⊳</span> <span class="bound">y</span> <span class="main">=</span> <span class="main">(</span><span class="bound">x</span> <span class="main">⊳</span> <span class="main">1</span><span class="main">)</span><span class="main">⋅</span><span class="bound">y</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">⊳</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span> <span class="main">⊳</span> <span class="main">1</span><span class="main">)</span><span class="main">⋅</span><span class="skolem">y</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">⊳</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">⋅</span><span class="skolem">y</span><span class="main">)</span> <span class="keyword1">o</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">⊳</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"conjugate <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">y</span> <span class="main">⊲</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">⋅</span><span class="skolem">y</span><span class="main">)</span> <span class="keyword1">o</span> conjugate <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">1</span> <span class="main">⊲</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"conjugate <span class="main">(</span>conjugate <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">y</span> <span class="main">⊲</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> conjugate <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">⋅</span><span class="skolem">y</span><span class="main">)</span> <span class="keyword1">o</span> conjugate <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">1</span> <span class="main">⊲</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">y</span> <span class="main">⊲</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> conjugate <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">⋅</span><span class="skolem">y</span><span class="main">)</span> <span class="keyword1">o</span> conjugate <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">1</span> <span class="main">⊲</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> conjugate <span class="main">(</span>conjugate <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">1</span> <span class="main">⊲</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">o</span> conjugate <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">⋅</span><span class="skolem">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> conjugate_comp<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">⊲</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">1</span> <span class="main">⊲</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">⊲</span> <span class="skolem">y</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">⊲</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">1</span> <span class="main">⊲</span> <span class="main">(</span><span class="bound">x</span> <span class="main">⊲</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">y</span> <span class="main">⊲</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">1</span> <span class="main">⊲</span> <span class="main">(</span><span class="bound">x</span> <span class="main">⊲</span> <span class="skolem">y</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">y</span> <span class="main">⊲</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">1</span> <span class="main">⊲</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">o</span> conjugate <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">⋅</span><span class="skolem">y</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"conjugate <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">y</span> <span class="main">⊲</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> conjugate <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">1</span> <span class="main">⊲</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">o</span> conjugate <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">⋅</span><span class="skolem">y</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> conjugate <span class="main">(</span>conjugate <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">⋅</span><span class="skolem">y</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">o</span> conjugate <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">1</span> <span class="main">⊲</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> conjugate_comp<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">⊳</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">⋅</span><span class="skolem">y</span><span class="main">)</span> <span class="keyword1">o</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">⊳</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">⊳</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span> <span class="main">⊳</span> <span class="main">1</span><span class="main">)</span> <span class="main">⋅</span> <span class="skolem">y</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_def<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">⊳</span> <span class="skolem">y</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">⊳</span> <span class="main">1</span><span class="main">)</span> <span class="main">⋅</span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Residuated_Boolean_Algebras-jonsson2a"><span class="command">lemma</span></span> jonsson2a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">g</span><span class="main">.</span> <span class="main">∀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">x</span> <span class="main">⊲</span> <span class="bound">y</span> <span class="main">=</span> <span class="bound">x</span><span class="main">⋅</span><span class="bound">g</span><span class="main">(</span><span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">x</span> <span class="main">⊲</span> <span class="bound">y</span> <span class="main">=</span> <span class="bound">x</span><span class="main">⋅</span><span class="main">(</span><span class="main">1</span> <span class="main">⊲</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">standard</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">1</span> <span class="main">⊲</span> <span class="bound">x</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  
<span class="keyword1" id="Residuated_Boolean_Algebras-jonsson2b"><span class="command">lemma</span></span> jonsson2b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">x</span> <span class="main">⊲</span> <span class="bound">y</span> <span class="main">=</span> <span class="bound">x</span><span class="main">⋅</span><span class="main">(</span><span class="main">1</span> <span class="main">⊲</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">x</span><span class="main">⋅</span><span class="bound">y</span> <span class="main">=</span> <span class="bound">x</span> <span class="main">⊲</span> <span class="main">(</span><span class="main">1</span> <span class="main">⊲</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">x</span> <span class="main">⊲</span> <span class="bound">y</span> <span class="main">=</span> <span class="bound">x</span><span class="main">⋅</span><span class="main">(</span><span class="main">1</span> <span class="main">⊲</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"conjugate <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">⊲</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> conjugate <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">⋅</span><span class="main">(</span><span class="main">1</span> <span class="main">⊲</span> <span class="skolem">y</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">⋅</span><span class="skolem">y</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">⊲</span> <span class="main">(</span><span class="main">1</span> <span class="main">⊲</span> <span class="skolem">y</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="operator">metis</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">x</span><span class="main">⋅</span><span class="bound">y</span> <span class="main">=</span> <span class="bound">x</span> <span class="main">⊲</span> <span class="main">(</span><span class="main">1</span> <span class="main">⊲</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">⋅</span><span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">⊲</span> <span class="main">(</span><span class="main">1</span> <span class="main">⊲</span> <span class="skolem">y</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"conjugate <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">⋅</span><span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> conjugate <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">⊲</span> <span class="main">(</span><span class="main">1</span> <span class="main">⊲</span> <span class="skolem">y</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">⊲</span> <span class="skolem">y</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="main">1</span> <span class="main">⊲</span> <span class="skolem">y</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="operator">metis</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Residuated_Boolean_Algebras-jonsson2c"><span class="command">lemma</span></span> jonsson2c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">x</span> <span class="main">⊲</span> <span class="bound">y</span> <span class="main">=</span> <span class="bound">x</span><span class="main">⋅</span><span class="main">(</span><span class="main">1</span> <span class="main">⊲</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">⊳</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">(</span><span class="bound">x</span> <span class="main">⊳</span> <span class="bound">y</span><span class="main">)</span> <span class="main">⊳</span> <span class="main">1</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">x</span> <span class="main">⊲</span> <span class="bound">y</span> <span class="main">=</span> <span class="bound">x</span><span class="main">⋅</span><span class="main">(</span><span class="main">1</span> <span class="main">⊲</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="skolem">x</span> <span class="main">⊲</span> <span class="bound">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="skolem">x</span><span class="main">⋅</span><span class="main">(</span><span class="main">1</span> <span class="main">⊲</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="skolem">x</span> <span class="main">⊲</span> <span class="bound">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="skolem">x</span><span class="main">⋅</span><span class="bound">y</span><span class="main">)</span> <span class="keyword1">o</span> <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="main">1</span> <span class="main">⊲</span> <span class="bound">y</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"conjugate <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">⊳</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="skolem">x</span><span class="main">⋅</span><span class="bound">y</span><span class="main">)</span> <span class="keyword1">o</span> conjugate <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">⊳</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"conjugate <span class="main">(</span>conjugate <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">⊳</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> conjugate <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="skolem">x</span><span class="main">⋅</span><span class="bound">y</span><span class="main">)</span> <span class="keyword1">o</span> conjugate <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">⊳</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">⊳</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> conjugate <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="skolem">x</span><span class="main">⋅</span><span class="bound">y</span><span class="main">)</span> <span class="keyword1">o</span> conjugate <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">⊳</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> conjugate <span class="main">(</span>conjugate <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">⊳</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">o</span> conjugate <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="skolem">x</span><span class="main">⋅</span><span class="bound">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> conjugate_comp<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">⊳</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="skolem">x</span> <span class="main">⊳</span> <span class="bound">y</span> <span class="main">⊳</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_def<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">⊳</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">⊳</span> <span class="skolem">y</span> <span class="main">⊳</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span> 
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">⊳</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">x</span> <span class="main">⊳</span> <span class="bound">y</span> <span class="main">⊳</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">⊳</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="skolem">x</span> <span class="main">⊳</span> <span class="bound">y</span> <span class="main">⊳</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">⊳</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">⊳</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">o</span> conjugate <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="skolem">x</span><span class="main">⋅</span><span class="bound">y</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"conjugate <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">⊳</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> conjugate <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">⊳</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">o</span> conjugate <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="skolem">x</span><span class="main">⋅</span><span class="bound">y</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> conjugate <span class="main">(</span>conjugate <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="skolem">x</span><span class="main">⋅</span><span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">o</span> conjugate <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">⊳</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> conjugate_comp<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="skolem">x</span> <span class="main">⊲</span> <span class="bound">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="skolem">x</span><span class="main">⋅</span><span class="bound">y</span><span class="main">)</span> <span class="keyword1">o</span> <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="main">1</span> <span class="main">⊲</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conjugate_conjr1 conjugate_conjr2 conjugate_multr<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">⊲</span> <span class="skolem">y</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="main">1</span> <span class="main">⊲</span> <span class="skolem">y</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Residuated_Boolean_Algebras-jonsson3a"><span class="command">lemma</span></span> jonsson3a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span> <span class="main">⊳</span> <span class="main">1</span><span class="main">)</span> <span class="main">⊳</span> <span class="main">1</span> <span class="main">=</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="main">1</span> <span class="main">⊲</span> <span class="main">(</span><span class="main">1</span> <span class="main">⊲</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">⊳</span> <span class="main">1</span> <span class="main">⊳</span> <span class="main">1</span> <span class="main">=</span> <span class="bound">x</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">⊲</span> <span class="main">(</span><span class="main">1</span> <span class="main">⊲</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> compl_le_swap1 compl_le_swap2 conjr2_iff order.eq_iff<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="main">1</span> <span class="main">⊲</span> <span class="main">(</span><span class="main">1</span> <span class="main">⊲</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="bound">x</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">⊳</span> <span class="main">1</span> <span class="main">⊳</span> <span class="main">1</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conjugate_l_def conjugate_r_def double_compl jipsen2r<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Residuated_Boolean_Algebras-jonsson3b"><span class="command">lemma</span></span> jonsson3b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span> <span class="main">⊳</span> <span class="main">1</span><span class="main">)</span> <span class="main">⊳</span> <span class="main">1</span> <span class="main">=</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span><span class="main">)</span> <span class="main">⊳</span> <span class="main">1</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊳</span> <span class="main">1</span><span class="main">)</span> <span class="main">⊓</span> <span class="main">(</span><span class="free">y</span> <span class="main">⊳</span> <span class="main">1</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> order.antisym<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> conjr2_iso<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> assm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span> <span class="main">⊳</span> <span class="main">1</span><span class="main">)</span> <span class="main">⊳</span> <span class="main">1</span> <span class="main">=</span> <span class="bound">x</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">⊳</span> <span class="main">1</span><span class="main">)</span> <span class="main">⊓</span> <span class="main">(</span><span class="free">y</span> <span class="main">⊳</span> <span class="main">1</span><span class="main">)</span> <span class="main">⊳</span> <span class="main">1</span> <span class="main">=</span> <span class="free">x</span> <span class="main">⊓</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free">x</span> <span class="main">⊳</span> <span class="main">1</span><span class="main">)</span> <span class="main">⊓</span> <span class="main">(</span><span class="free">y</span> <span class="main">⊳</span> <span class="main">1</span><span class="main">)</span> <span class="main">⊳</span> <span class="main">1</span><span class="main">)</span> <span class="main">⊓</span> <span class="free">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> conjr2_iso inf.cobounded2 inf.commute inf.orderE<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">⊳</span> <span class="main">1</span><span class="main">)</span> <span class="main">⊓</span> <span class="main">(</span><span class="free">y</span> <span class="main">⊳</span> <span class="main">1</span><span class="main">)</span> <span class="main">⊳</span> <span class="main">1</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> inf.orderI inf_left_commute <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">⊳</span> <span class="main">1</span><span class="main">)</span> <span class="main">⊓</span> <span class="main">(</span><span class="free">y</span> <span class="main">⊳</span> <span class="main">1</span><span class="main">)</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span> <span class="main">⊳</span> <span class="main">1</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assm <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> conjr2_iso<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Residuated_Boolean_Algebras-jonsson3c"><span class="command">lemma</span></span> jonsson3c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span> <span class="main">⊳</span> <span class="main">1</span><span class="main">)</span> <span class="main">⊳</span> <span class="main">1</span> <span class="main">=</span> <span class="bound">x</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">⊳</span> <span class="main">1</span> <span class="main">=</span> <span class="main">1</span> <span class="main">⊲</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> indirect_eq<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">z</span>
  <span class="keyword3"><span class="command">assume</span></span> assms<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span> <span class="main">⊳</span> <span class="main">1</span><span class="main">)</span> <span class="main">⊳</span> <span class="main">1</span> <span class="main">=</span> <span class="bound">x</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">⊳</span> <span class="main">1</span><span class="main">)</span> <span class="main">⊓</span> <span class="main">-</span><span class="skolem">z</span> <span class="main">=</span> <span class="main">⊥</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">(</span><span class="free">x</span> <span class="main">⊳</span> <span class="main">1</span><span class="main">)</span> <span class="main">⊓</span> <span class="main">-</span><span class="skolem">z</span><span class="main">)</span> <span class="main">⊳</span> <span class="main">1</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> compl_sup conjugation_conj double_compl inf_bot_right sup_bot.left_neutral<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">⟷</span> <span class="main">-</span><span class="skolem">z</span><span class="main">⋅</span><span class="free">x</span> <span class="main">⊓</span> <span class="main">1</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms jonsson3b conjugation_multr<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">⊳</span> <span class="main">1</span><span class="main">)</span> <span class="main">⊓</span> <span class="main">-</span><span class="skolem">z</span> <span class="main">=</span> <span class="main">⊥</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">1</span> <span class="main">⊲</span> <span class="free">x</span><span class="main">)</span> <span class="main">⊓</span> <span class="main">-</span><span class="skolem">z</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conjugation_multl inf.commute<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">⊳</span> <span class="main">1</span> <span class="main">≤</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">1</span> <span class="main">⊲</span> <span class="free">x</span> <span class="main">≤</span> <span class="skolem">z</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> le_iff_inf_bot<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> 

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* unital_residuated_boolean *)</span>

<span class="keyword1"><span class="command">class</span></span> residuated_boolean_semigroup <span class="main">=</span> residuated_boolean_algebra <span class="main">+</span> semigroup_mult
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subclass</span></span> residuated_boolean_algebra <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The following lemmas hold trivially, since they are equivalent to associativity.
›</span></span>

<span class="keyword1" id="Residuated_Boolean_Algebras-res_assoc1"><span class="command">lemma</span></span> res_assoc1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⊳</span> <span class="main">(</span><span class="free">y</span> <span class="main">⊳</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="free">y</span><span class="main">⋅</span><span class="free">x</span> <span class="main">⊳</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> res_assoc_iff1 mult_assoc<span class="main">)</span>

<span class="keyword1" id="Residuated_Boolean_Algebras-res_assoc2"><span class="command">lemma</span></span> res_assoc2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⊲</span> <span class="main">(</span><span class="free">y</span> <span class="main">⋅</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊲</span> <span class="free">z</span><span class="main">)</span> <span class="main">⊲</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> res_assoc_iff2 mult_assoc<span class="main">)</span>

<span class="keyword1" id="Residuated_Boolean_Algebras-res_assoc3"><span class="command">lemma</span></span> res_assoc3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">⊳</span> <span class="free">y</span><span class="main">)</span> <span class="main">⊲</span> <span class="free">z</span> <span class="main">=</span> <span class="free">x</span> <span class="main">⊳</span> <span class="main">(</span><span class="free">y</span> <span class="main">⊲</span> <span class="free">z</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> res_assoc_iff3 mult_assoc<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(*residuated_boolean_semigroup *)</span>

<span class="keyword1"><span class="command">class</span></span> residuated_boolean_monoid <span class="main">=</span> residuated_boolean_algebra <span class="main">+</span> monoid_mult
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subclass</span></span> unital_residuated_boolean
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">standard</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">subclass</span></span> residuated_lmonoid <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1" id="Residuated_Boolean_Algebras-jonsson4"><span class="command">lemma</span></span> jonsson4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">x</span> <span class="main">⊲</span> <span class="bound">y</span> <span class="main">=</span> <span class="bound">x</span><span class="main">⋅</span><span class="main">(</span><span class="main">1</span> <span class="main">⊲</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">x</span> <span class="main">⊳</span> <span class="bound">y</span> <span class="main">=</span> <span class="main">(</span><span class="bound">x</span> <span class="main">⊳</span> <span class="main">1</span><span class="main">)</span><span class="main">⋅</span><span class="bound">y</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="keyword3"><span class="command">assume</span></span> assms<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">x</span> <span class="main">⊲</span> <span class="bound">y</span> <span class="main">=</span> <span class="bound">x</span><span class="main">⋅</span><span class="main">(</span><span class="main">1</span> <span class="main">⊲</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">⊳</span> <span class="skolem">y</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">⊳</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">⊳</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms jonsson2c<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">⊳</span> <span class="main">(</span><span class="main">(</span><span class="skolem">x</span> <span class="main">⊳</span> <span class="main">1</span><span class="main">)</span> <span class="main">⊳</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">⊳</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms jonsson2b jonsson3a mult_oner<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="skolem">x</span> <span class="main">⊳</span> <span class="main">1</span><span class="main">)</span><span class="main">⋅</span><span class="skolem">y</span><span class="main">)</span> <span class="main">⊳</span> <span class="main">1</span><span class="main">)</span> <span class="main">⊳</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conjugate_r_def double_compl resr3<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">⊳</span> <span class="main">1</span><span class="main">)</span><span class="main">⋅</span><span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms jonsson2b jonsson3a mult_oner<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">⊳</span> <span class="skolem">y</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">⊳</span> <span class="main">1</span><span class="main">)</span><span class="main">⋅</span><span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="keyword3"><span class="command">assume</span></span> assms<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">x</span> <span class="main">⊳</span> <span class="bound">y</span> <span class="main">=</span> <span class="main">(</span><span class="bound">x</span> <span class="main">⊳</span> <span class="main">1</span><span class="main">)</span><span class="main">⋅</span><span class="bound">y</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">⊲</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">1</span> <span class="main">⊲</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">⊲</span> <span class="skolem">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms jonsson1c<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">1</span> <span class="main">⊲</span> <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">⊲</span> <span class="main">(</span><span class="main">1</span> <span class="main">⊲</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">⊲</span> <span class="skolem">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms conjugate_l_def double_compl jonsson1c mult_1_right resl3<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">1</span> <span class="main">⊲</span> <span class="main">(</span><span class="main">1</span> <span class="main">⊲</span> <span class="main">(</span><span class="skolem">y</span><span class="main">⋅</span><span class="main">(</span><span class="main">1</span> <span class="main">⊲</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conjugate_l_def double_compl resl3<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="skolem">y</span><span class="main">⋅</span><span class="main">(</span><span class="main">1</span> <span class="main">⊲</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms jonsson1b jonsson1c jonsson3c mult_onel<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">⊲</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">y</span><span class="main">⋅</span><span class="main">(</span><span class="main">1</span> <span class="main">⊲</span> <span class="skolem">x</span><span class="main">)</span>"</span></span><span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* residuated_boolean_monoid *)</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Involutive_Residuated">
<div class="head">
<h1>Theory Involutive_Residuated</h1>
</div>
<pre class="source"><span class="comment1">(* Title:      Involutive Residuated Structures
   Author:     Victor Gomes
   Maintainer: Victor Gomes &lt;vborgesferreiragomes1 at sheffield.ac.uk&gt;
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Involutive Residuated Structures›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Involutive_Residuated
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="#Residuated_Lattices">Residuated_Lattices</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">class</span></span> uminus' <span class="main">=</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free"><span class="free"><span class="free">uminus'</span></span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1"><span class="keyword1"><span class="keyword1">-''</span></span></span> _"</span> <span class="main">[</span>81<span class="main">]</span> 80<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Involutive posets is a structure where the double negation property holds for the 
  negation operations, and a Galois connection for negations exists.
›</span></span>
<span class="keyword1"><span class="command">class</span></span> involutive_order <span class="main">=</span> order <span class="main">+</span> uminus <span class="main">+</span> uminus' <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> gn<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="main">-'</span><span class="free">y</span> <span class="main">⟷</span> <span class="free">y</span> <span class="main">≤</span> <span class="main">-</span><span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> dn1<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">-'</span><span class="main">(</span><span class="main">-</span><span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> dn2<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">(</span><span class="main">-'</span><span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
<span class="comment1">(* The involutive pair (-', -) is compatible with multiplication *)</span>
<span class="keyword1"><span class="command">class</span></span> involutive_pogroupoid <span class="main">=</span> order <span class="main">+</span> times <span class="main">+</span> involutive_order <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> ipg1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">⋅</span><span class="free">y</span> <span class="main">≤</span> <span class="free">z</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">-</span><span class="free">z</span><span class="main">)</span><span class="main">⋅</span><span class="free">x</span> <span class="main">≤</span> <span class="main">-</span><span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> ipg2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">⋅</span><span class="free">y</span> <span class="main">≤</span> <span class="free">z</span> <span class="main">⟷</span> <span class="free">y</span><span class="main">⋅</span><span class="main">(</span><span class="main">-'</span><span class="free">z</span><span class="main">)</span> <span class="main">≤</span> <span class="main">-'</span><span class="free">x</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Involutive_Residuated-neg_antitone"><span class="command">lemma</span></span> neg_antitone<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟹</span> <span class="main">-</span><span class="free">y</span> <span class="main">≤</span> <span class="main">-</span><span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.dn1 local.gn<span class="main">)</span>

<span class="keyword1" id="Involutive_Residuated-neg'_antitone"><span class="command">lemma</span></span> neg'_antitone<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟹</span> <span class="main">-'</span><span class="free">y</span> <span class="main">≤</span> <span class="main">-'</span><span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.dn2 local.gn<span class="main">)</span>
  
<span class="keyword1"><span class="command">subclass</span></span> pogroupoid
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">z</span> <span class="keyword3"><span class="command">assume</span></span> assm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">y</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">⋅</span> <span class="skolem">z</span> <span class="main">≤</span> <span class="skolem">y</span> <span class="main">⋅</span> <span class="skolem">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assm local.ipg2 local.order_refl local.order_trans neg'_antitone<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">⋅</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">z</span> <span class="main">⋅</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assm local.dual_order.trans local.ipg1 local.order_refl neg_antitone<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">inv_resl</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">inv_resl</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≡</span> <span class="main">-</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">⋅</span><span class="main">(</span><span class="main">-'</span><span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
  
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">inv_resr</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">inv_resr</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">≡</span> <span class="main">-'</span><span class="main">(</span><span class="main">(</span><span class="main">-</span><span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> residuated_pogroupoid _ _ _ <span class="quoted">inv_resl</span> <span class="quoted">inv_resr</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">z</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span> <span class="main">≤</span> <span class="main">-</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">⋅</span> <span class="main">-'</span> <span class="skolem">z</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">⋅</span> <span class="skolem">y</span> <span class="main">≤</span> <span class="skolem">z</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.gn local.ipg2<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span> <span class="main">⋅</span> <span class="skolem">y</span> <span class="main">≤</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">≤</span> <span class="main">-'</span> <span class="main">(</span><span class="main">-</span> <span class="skolem">z</span> <span class="main">⋅</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.gn local.ipg1<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">class</span></span> division_order <span class="main">=</span> order <span class="main">+</span> residual_l_op <span class="main">+</span> residual_r_op <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> div_galois<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">z</span> <span class="main">←</span> <span class="free">y</span> <span class="main">⟷</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">→</span> <span class="free">z</span>"</span></span>
  
<span class="keyword1"><span class="command">class</span></span> involutive_division_order <span class="main">=</span> division_order <span class="main">+</span> involutive_order <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> contraposition<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">→</span> <span class="main">-</span><span class="free">x</span> <span class="main">=</span> <span class="main">-'</span><span class="free">y</span> <span class="main">←</span> <span class="free">x</span>"</span></span>
  
<span class="keyword1"><span class="command">context</span></span> involutive_pogroupoid <span class="keyword2"><span class="keyword">begin</span></span>
  
<span class="keyword1"><span class="command">sublocale</span></span> involutive_division_order _ _ <span class="quoted">inv_resl</span> <span class="quoted">inv_resr</span> 
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">z</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span> <span class="main">≤</span> <span class="main">-</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">⋅</span> <span class="main">-'</span> <span class="skolem">z</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">≤</span> <span class="main">-'</span> <span class="main">(</span><span class="main">-</span> <span class="skolem">z</span> <span class="main">⋅</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.gn local.ipg1 local.ipg2<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">-'</span> <span class="main">(</span><span class="main">-</span> <span class="main">(</span><span class="main">-</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">⋅</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">⋅</span> <span class="main">-'</span> <span class="main">(</span><span class="main">-'</span> <span class="skolem">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.dn1 local.dn2 order.eq_iff local.gn local.jipsen1l local.jipsen1r local.resl_galois local.resr_galois<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Involutive_Residuated-inv_resr_neg"><span class="command">lemma</span></span> inv_resr_neg <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"inv_resr <span class="main">(</span><span class="main">-</span><span class="free">x</span><span class="main">)</span> <span class="main">(</span><span class="main">-</span><span class="free">y</span><span class="main">)</span> <span class="main">=</span> inv_resl <span class="free">x</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.contraposition local.dn1<span class="main">)</span>

<span class="keyword1" id="Involutive_Residuated-inv_resl_neg'"><span class="command">lemma</span></span> inv_resl_neg' <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"inv_resl <span class="main">(</span><span class="main">-'</span><span class="free">x</span><span class="main">)</span> <span class="main">(</span><span class="main">-'</span><span class="free">y</span><span class="main">)</span> <span class="main">=</span> inv_resr <span class="free">x</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.contraposition local.dn2<span class="main">)</span>
  
<span class="keyword1" id="Involutive_Residuated-neg'_mult_resl"><span class="command">lemma</span></span> neg'_mult_resl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">-'</span><span class="main">(</span><span class="main">(</span><span class="main">-</span><span class="free">y</span><span class="main">)</span><span class="main">⋅</span><span class="main">(</span><span class="main">-</span><span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> inv_resl <span class="free">x</span> <span class="main">(</span><span class="main">-'</span><span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inv_resr_neg local.dn2<span class="main">)</span>
  
<span class="keyword1" id="Involutive_Residuated-neg_mult_resr"><span class="command">lemma</span></span> neg_mult_resr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">(</span><span class="main">(</span><span class="main">-'</span><span class="free">y</span><span class="main">)</span><span class="main">⋅</span><span class="main">(</span><span class="main">-'</span><span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> inv_resr <span class="main">(</span><span class="main">-</span><span class="free">x</span><span class="main">)</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> neg'_mult_resl<span class="main">)</span>
  
<span class="keyword1" id="Involutive_Residuated-resr_de_morgan1"><span class="command">lemma</span></span> resr_de_morgan1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">-'</span><span class="main">(</span>inv_resr <span class="main">(</span><span class="main">-</span><span class="free">y</span><span class="main">)</span> <span class="main">(</span><span class="main">-</span><span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">-'</span><span class="main">(</span>inv_resl <span class="free">y</span> <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.dn1 neg_mult_resr<span class="main">)</span>

<span class="keyword1" id="Involutive_Residuated-resr_de_morgan2"><span class="command">lemma</span></span> resr_de_morgan2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">(</span>inv_resl <span class="main">(</span><span class="main">-'</span><span class="free">x</span><span class="main">)</span> <span class="main">(</span><span class="main">-'</span><span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span><span class="main">(</span>inv_resr <span class="free">x</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inv_resl_neg'<span class="main">)</span>
  
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  We prove that an involutive division poset is equivalent to an involutive po-groupoid
  by a lemma to avoid cyclic definitions
›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> involutive_division_order<span class="main">)</span> inv_pogroupoid<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"class.involutive_pogroupoid <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="main">-</span><span class="main">(</span><span class="bound">y</span> <span class="main">→</span> <span class="main">-'</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span> uminus uminus' <span class="main">(≤)</span> <span class="main">(&lt;)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">z</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">-</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">→</span> <span class="main">-'</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span><span class="skolem">z</span> <span class="main">≤</span> <span class="main">-</span><span class="skolem">y</span> <span class="main">←</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.contraposition local.dn1 local.dn2 local.gn local.div_galois<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">-</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">→</span> <span class="main">-'</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">→</span> <span class="main">-'</span> <span class="main">(</span><span class="main">-</span> <span class="skolem">z</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="main">-</span> <span class="skolem">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.contraposition local.div_galois local.dn1 local.dn2 local.gn<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">-</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">→</span> <span class="main">-'</span> <span class="main">(</span><span class="main">-</span> <span class="skolem">z</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="main">-</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span> <span class="main">(</span><span class="main">-'</span> <span class="skolem">z</span> <span class="main">→</span> <span class="main">-'</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">≤</span> <span class="main">-'</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> local.contraposition local.div_galois local.dn1 local.dn2 local.gn<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.contraposition local.div_galois local.dn1 local.dn2 local.gn<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">-</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">→</span> <span class="main">-'</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span> <span class="main">(</span><span class="main">-'</span> <span class="skolem">z</span> <span class="main">→</span> <span class="main">-'</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">≤</span> <span class="main">-'</span> <span class="skolem">x</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">context</span></span> involutive_pogroupoid <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">negation_constant</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">negation_constant</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">≡</span> <span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="main">-'</span><span class="bound">x</span> <span class="main">=</span> inv_resr <span class="bound">x</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">∧</span> <span class="main">-</span><span class="bound">x</span> <span class="main">=</span> inv_resl <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="bound">x</span>"</span></span>   
  
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">division_unit</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">division_unit</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">≡</span> <span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">=</span> inv_resr <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">=</span> inv_resl <span class="bound">x</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span>"</span></span>
  
<span class="keyword1" id="Involutive_Residuated-neg_iff_div_unit"><span class="command">lemma</span></span> neg_iff_div_unit<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">a</span><span class="main">.</span> negation_constant <span class="bound">a</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound">b</span><span class="main">.</span> division_unit <span class="bound">b</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> negation_constant_def division_unit_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">safe</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">-</span><span class="improper">a</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> local.dn1 local.dn2<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> local.dn2<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">-</span><span class="improper">b</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> local.contraposition<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> local.dn2<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Action_Algebra">
<div class="head">
<h1>Theory Action_Algebra</h1>
</div>
<pre class="source"><span class="comment1">(* Title:      Action Algebra
   Author:     Alasdair Armstrong, Georg Struth, Tjark Weber
   Maintainer: Georg Struth &lt;g.struth at sheffield.ac.uk&gt;
               Tjark Weber &lt;tjark.weber at it.uu.se&gt;
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Action Algebras›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Action_Algebra
<span class="keyword2"><span class="keyword">imports</span></span> <span class="quoted">"<a href="#Residuated_Lattices">../Residuated_Lattices/Residuated_Lattices</a>"</span> <a href="../../kleene_algebra/theories/#Kleene_Algebra">Kleene_Algebra.Kleene_Algebra</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Action algebras have been defined and discussed in œ
Pratt's paper on \emph{Action Logic and Pure
Induction}~\cite{pratt90action}. They are expansions of Kleene
algebras by operations of left and right residuation. They are
interesting, first because most models of Kleene algebras, e.g.
relations, traces, paths and languages, possess the residuated
structure, and second because, in this setting, the Kleene star can be
defined equationally.

Action algebras can be based on residuated
semilattices. Many important properties of action
algebras already arise at this level.›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We can define an action algebra as a residuated join
semilattice that is also a dioid. Following Pratt, we also add a star
operation that is axiomatised as a reflexive transitive closure
operation.
›</span></span>

<span class="keyword1"><span class="command">class</span></span> action_algebra <span class="main">=</span> residuated_sup_lgroupoid <span class="main">+</span> dioid_one_zero <span class="main">+</span> star_op <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> star_rtc1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">+</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">+</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> star_rtc2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">+</span> <span class="free">y</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">+</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="free">y</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Action_Algebra-plus_sup"><span class="command">lemma</span></span> plus_sup<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(+)</span> <span class="main">=</span> <span class="main">(⊔)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span><span class="main"><span class="keyword3">+</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> local.join.sup_unique<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We first prove a reflexivity property for residuals.›</span></span>

<span class="keyword1" id="Action_Algebra-residual_r_refl"><span class="command">lemma</span></span> residual_r_refl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">→</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> local.resrI<span class="main">)</span>

<span class="keyword1" id="Action_Algebra-residual_l_refl"><span class="command">lemma</span></span> residual_l_refl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">←</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> local.reslI<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We now derive pure induction laws for residuals.›</span></span>


<span class="keyword1" id="Action_Algebra-residual_l_pure_induction"><span class="command">lemma</span></span> residual_l_pure_induction<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">←</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="free">x</span> <span class="main">←</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">+</span> <span class="main">(</span><span class="free">x</span> <span class="main">←</span> <span class="free">x</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">x</span> <span class="main">←</span> <span class="free">x</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="free">x</span> <span class="main">←</span> <span class="free">x</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span> <span class="main">←</span> <span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> local.resl_antitoner local.resl_galois mult_assoc <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> star_rtc2<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Action_Algebra-residual_r_pure_induction"><span class="command">lemma</span></span> residual_r_pure_induction<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">→</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="free">x</span> <span class="main">→</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">+</span> <span class="main">(</span><span class="free">x</span> <span class="main">→</span> <span class="free">x</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">x</span> <span class="main">→</span> <span class="free">x</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="free">x</span> <span class="main">→</span> <span class="free">x</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span> <span class="main">→</span> <span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> local.resr_antitonel local.resr_galois mult_assoc <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.mult_oner residual_r_refl<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> star_rtc2<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Next we show that every action algebra is a Kleene
algebra. First, we derive the star unfold law and the star induction
laws in action algebra. Then we prove a subclass statement.›</span></span>

<span class="keyword1" id="Action_Algebra-star_unfoldl"><span class="command">lemma</span></span> star_unfoldl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">+</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⋅</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> local.dual_order.trans local.join.le_sup_iff local.mult_isor local.star_rtc1<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> local.star_rtc1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Action_Algebra-star_mon"><span class="command">lemma</span></span> star_mon <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> local.dual_order.trans local.join.le_supE local.star_rtc1<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">+</span> <span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> local.star_rtc1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> local.star_rtc2<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Action_Algebra-star_subdist'"><span class="command">lemma</span></span> star_subdist'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

<span class="keyword1" id="Action_Algebra-star_inductl"><span class="command">lemma</span></span> star_inductl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">+</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">z</span> <span class="main">≤</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> hyp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">+</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">←</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> local.resl_galois<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="main">(</span><span class="free">y</span> <span class="main">←</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> star_mon<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="free">y</span> <span class="main">←</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> local.order_trans residual_l_pure_induction <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> local.resl_galois<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">z</span> <span class="main">≤</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> hyp local.dual_order.trans local.join.le_supE local.mult_isol<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Action_Algebra-star_inductr"><span class="command">lemma</span></span> star_inductr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">+</span> <span class="free">y</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">z</span> <span class="main">⋅</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> hyp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">+</span> <span class="free">y</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">→</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> resr_galois<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="main">(</span><span class="free">y</span> <span class="main">→</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> star_mon<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="free">y</span> <span class="main">→</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> order_trans residual_r_pure_induction<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">⋅</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> local.resr_galois<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">⋅</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> hyp local.join.le_supE local.order_trans local.resl_galois<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subclass</span></span> kleene_algebra
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">z</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">+</span> <span class="skolem">x</span> <span class="main">⋅</span> <span class="skolem">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="skolem">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> local.star_unfoldl <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">+</span> <span class="skolem">x</span> <span class="main">⋅</span> <span class="skolem">y</span> <span class="main">≤</span> <span class="skolem">y</span> <span class="main">⟹</span> <span class="skolem">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="skolem">z</span> <span class="main">≤</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> local.star_inductl<span class="main">)</span>    
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">+</span> <span class="skolem">y</span> <span class="main">⋅</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">y</span> <span class="main">⟹</span> <span class="skolem">z</span> <span class="main">⋅</span> <span class="skolem">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> star_inductr<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>
    
<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* action_algebra *)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Equational Action Algebras›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The induction axioms of Kleene algebras are universal Horn
formulas. This is unavoidable, because due to a well known result of
Redko, there is no finite equational axiomatisation for the equational
theory of regular expressions.

Action algebras, in contrast, admit a finite equational
axiomatization, as Pratt has shown. We now formalise this
result. Consequently, the equational action algebra axioms, which
imply those based on Galois connections, which in turn imply those of
Kleene algebras, are complete with respect to the equational theory of
regular expressions. However, this completeness result does not
account for residuation.›</span></span>

<span class="keyword1"><span class="command">class</span></span> equational_action_algebra <span class="main">=</span> residuated_sup_lgroupoid <span class="main">+</span> dioid_one_zero <span class="main">+</span> star_op <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> star_ax<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">+</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">+</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> star_subdist<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> right_pure_induction<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">→</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="free">x</span> <span class="main">→</span> <span class="free">x</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We now show that the equational axioms of action algebra
satisfy those based on the Galois connections. Since we can use our
correspondence between the two variants of residuated semilattice, it
remains to derive the second reflexive transitive closure axiom for
the star, essentially copying Pratt's proof step by step. We then
prove a subclass statement.›</span></span>

<span class="keyword1" id="Action_Algebra-star_rtc_2"><span class="command">lemma</span></span> star_rtc_2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">+</span> <span class="free">y</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">+</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">+</span> <span class="free">y</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">+</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">≤</span> <span class="free">y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">→</span> <span class="free">y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">→</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> local.order_trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="main">(</span><span class="free">y</span> <span class="main">→</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.join.sup.absorb2 local.star_subdist<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="free">y</span> <span class="main">→</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> order_trans right_pure_induction<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">⋅</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> local.resr_galois<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="main">1</span> <span class="main">≤</span> <span class="free">y</span>›</span></span> local.dual_order.trans local.mult_onel local.resl_galois<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subclass</span></span> action_algebra
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> star_ax<span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> star_rtc_2<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* equational_action_algebra *)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
Conversely, every action algebra satisfies the equational axioms of
equational action algebras.

Because the subclass relation must be acyclic in Isabelle, we can only
establish this for the corresponding locales. Again this proof is
based on the residuated semilattice result.
›</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> action_algebra <span class="main">⊆</span> equational_action_algebra
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> star_rtc1<span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> star_subdist<span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> residual_r_pure_induction<span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Another Variant›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Finally we show that Pratt and Kozen's star axioms generate
precisely the same theory.›</span></span>

<span class="keyword1"><span class="command">class</span></span> action_algebra_var <span class="main">=</span> residuated_sup_lgroupoid <span class="main">+</span> dioid_one_zero <span class="main">+</span> star_op <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> star_unfold'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">+</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> star_inductl'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">+</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">z</span> <span class="main">≤</span> <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> star_inductr'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">+</span> <span class="free">y</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">z</span> <span class="main">⋅</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>  <span class="main">≤</span> <span class="free">y</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subclass</span></span> kleene_algebra
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> star_unfold'<span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> star_inductl'<span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> star_inductr'<span class="main">)</span>

<span class="keyword1"><span class="command">subclass</span></span> action_algebra
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> add.commute less_eq_def order_refl star_ext star_plus_one star_trans_eq<span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> add.assoc add.commute star_rtc_least<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> action_algebra <span class="main">⊆</span> action_algebra_var
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> star_unfoldl<span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> star_inductl<span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> star_inductr<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Action_Algebra_Models">
<div class="head">
<h1>Theory Action_Algebra_Models</h1>
</div>
<pre class="source"><span class="comment1">(* Title:      Models of Action Algebra
   Author:     Alasdair Armstrong, Georg Struth, Tjark Weber
   Maintainer: Georg Struth &lt;g.struth at sheffield.ac.uk&gt;
               Tjark Weber &lt;tjark.weber at it.uu.se&gt;
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Models of Action Algebras›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Action_Algebra_Models
<span class="keyword2"><span class="keyword">imports</span></span> <a href="#Action_Algebra">Action_Algebra</a> <a href="../../kleene_algebra/theories/#Kleene_Algebra_Models">Kleene_Algebra.Kleene_Algebra_Models</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹The Powerset Action Algebra over a Monoid›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Here we show that various models of Kleene algebras are also
residuated; hence they form action algebras. In each case the main
work is to establish the residuated lattice structure.›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The interpretation proofs for some of the following models are
quite similar. One could, perhaps, abstract out common reasoning.›</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹The Powerset Action Algebra over a Monoid›</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> set <span class="main">::</span> <span class="main">(</span><span class="quoted">monoid_mult</span><span class="main">)</span> <span class="quoted">residuated_sup_lgroupoid</span>
<span class="keyword2"><span class="keyword">begin</span></span>

  <span class="keyword1"><span class="command">definition</span></span> <span class="entity"><span class="class_parameter">residual_r_set</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="main">→</span> <span class="free"><span class="bound"><span class="entity">Z</span></span></span> <span class="main">=</span> <span class="main">⋃</span> <span class="main">{</span><span class="bound">Y</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="main">⋅</span> <span class="bound">Y</span> <span class="main">⊆</span> <span class="free"><span class="bound"><span class="entity">Z</span></span></span><span class="main">}</span>"</span></span>

  <span class="keyword1"><span class="command">definition</span></span> <span class="entity"><span class="class_parameter">residual_l_set</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">Z</span></span></span> <span class="main">←</span> <span class="free"><span class="bound"><span class="entity">Y</span></span></span> <span class="main">=</span> <span class="main">⋃</span> <span class="main">{</span><span class="bound">X</span><span class="main">.</span> <span class="bound">X</span> <span class="main">⋅</span> <span class="free"><span class="bound"><span class="entity">Y</span></span></span> <span class="main">⊆</span> <span class="free"><span class="bound"><span class="entity">Z</span></span></span><span class="main">}</span>"</span></span>

  <span class="keyword1"><span class="command">instance</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">X</span> <span class="skolem">Y</span> <span class="skolem">Z</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">⊆</span> <span class="main">(</span><span class="skolem">Z</span> <span class="main">←</span> <span class="skolem">Y</span><span class="main">)</span> <span class="main">⟷</span> <span class="skolem">X</span> <span class="main">⋅</span> <span class="skolem">Y</span> <span class="main">⊆</span> <span class="skolem">Z</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">⊆</span> <span class="skolem">Z</span> <span class="main">←</span> <span class="skolem">Y</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">⋅</span> <span class="skolem">Y</span> <span class="main">⊆</span> <span class="main">(</span><span class="skolem">Z</span> <span class="main">←</span> <span class="skolem">Y</span><span class="main">)</span> <span class="main">⋅</span> <span class="skolem">Y</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> near_dioid_class.mult_isor<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⊆</span> <span class="main">⋃</span> <span class="main">{</span><span class="bound">X</span><span class="main">.</span> <span class="bound">X</span> <span class="main">⋅</span> <span class="skolem">Y</span> <span class="main">⊆</span> <span class="skolem">Z</span><span class="main">}</span> <span class="main">⋅</span> <span class="skolem">Y</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> residual_l_set_def<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">⋃</span> <span class="main">{</span><span class="bound">X</span> <span class="main">⋅</span> <span class="skolem">Y</span> <span class="main">|</span> <span class="bound">X</span><span class="main">.</span> <span class="bound">X</span> <span class="main">⋅</span> <span class="skolem">Y</span> <span class="main">⊆</span> <span class="skolem">Z</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> c_prod_def<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">⋅</span> <span class="skolem">Y</span> <span class="main">⊆</span> <span class="skolem">Z</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">⋅</span> <span class="skolem">Y</span> <span class="main">⊆</span> <span class="skolem">Z</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">⊆</span> <span class="main">⋃</span> <span class="main">{</span><span class="bound">X</span><span class="main">.</span> <span class="bound">X</span> <span class="main">⋅</span> <span class="skolem">Y</span> <span class="main">⊆</span> <span class="skolem">Z</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Sup_upper mem_Collect_eq<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">⊆</span> <span class="skolem">Z</span> <span class="main">←</span> <span class="skolem">Y</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> residual_l_set_def<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">⋅</span> <span class="skolem">Y</span> <span class="main">⊆</span> <span class="skolem">Z</span> <span class="main">⟷</span> <span class="skolem">Y</span> <span class="main">⊆</span> <span class="main">(</span><span class="skolem">X</span> <span class="main">→</span> <span class="skolem">Z</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Y</span> <span class="main">⊆</span> <span class="skolem">X</span> <span class="main">→</span> <span class="skolem">Z</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">⋅</span> <span class="skolem">Y</span> <span class="main">⊆</span> <span class="skolem">X</span> <span class="main">⋅</span> <span class="main">(</span><span class="skolem">X</span> <span class="main">→</span> <span class="skolem">Z</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> pre_dioid_class.mult_isol<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⊆</span> <span class="skolem">X</span> <span class="main">⋅</span> <span class="main">⋃</span> <span class="main">{</span><span class="bound">Y</span><span class="main">.</span> <span class="skolem">X</span> <span class="main">⋅</span> <span class="bound">Y</span> <span class="main">⊆</span> <span class="skolem">Z</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> residual_r_set_def<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">⋃</span> <span class="main">{</span><span class="skolem">X</span> <span class="main">⋅</span> <span class="bound">Y</span> <span class="main">|</span> <span class="bound">Y</span><span class="main">.</span> <span class="skolem">X</span> <span class="main">⋅</span> <span class="bound">Y</span> <span class="main">⊆</span> <span class="skolem">Z</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> c_prod_def<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">⋅</span> <span class="skolem">Y</span> <span class="main">⊆</span> <span class="skolem">Z</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">⋅</span> <span class="skolem">Y</span> <span class="main">⊆</span> <span class="skolem">Z</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Y</span> <span class="main">⊆</span> <span class="main">⋃</span> <span class="main">{</span><span class="bound">Y</span><span class="main">.</span> <span class="skolem">X</span> <span class="main">⋅</span> <span class="bound">Y</span> <span class="main">⊆</span> <span class="skolem">Z</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Sup_upper mem_Collect_eq<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Y</span> <span class="main">⊆</span> <span class="skolem">X</span> <span class="main">→</span> <span class="skolem">Z</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> residual_r_set_def<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* instantiation *)</span>

<span class="keyword1"><span class="command">instantiation</span></span> set <span class="main">::</span> <span class="main">(</span><span class="quoted">monoid_mult</span><span class="main">)</span> <span class="quoted">action_algebra</span>
<span class="keyword2"><span class="keyword">begin</span></span>

  <span class="keyword1"><span class="command">instance</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">+</span> <span class="skolem">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="skolem">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">+</span> <span class="skolem">x</span> <span class="main">⊆</span> <span class="skolem">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">show</span></span>  <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">+</span> <span class="skolem">y</span> <span class="main">⋅</span> <span class="skolem">y</span> <span class="main">+</span> <span class="skolem">x</span> <span class="main">⊆</span> <span class="skolem">y</span> <span class="main">⟹</span> <span class="skolem">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊆</span> <span class="skolem">y</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> left_pre_kleene_algebra_class.star_rtc_least<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* instantiation *)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Language Action Algebras›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">limp_lan</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> lan <span class="main">⇒</span> <span class="tfree">'a</span> lan <span class="main">⇒</span> <span class="tfree">'a</span> lan"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">limp_lan</span> <span class="free"><span class="bound"><span class="entity">Z</span></span></span> <span class="free"><span class="bound"><span class="entity">Y</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">∀</span><span class="bound">y</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">Y</span></span></span><span class="main">.</span> <span class="bound">x</span> <span class="main">@</span> <span class="bound">y</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">Z</span></span></span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">rimp_lan</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> lan <span class="main">⇒</span> <span class="tfree">'a</span> lan <span class="main">⇒</span> <span class="tfree">'a</span> lan"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">rimp_lan</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="free"><span class="bound"><span class="entity">Z</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="bound">y</span><span class="main">.</span> <span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="main">.</span> <span class="bound">x</span> <span class="main">@</span> <span class="bound">y</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">Z</span></span></span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> lan_residuated_join_semilattice<span class="main">:</span> residuated_sup_lgroupoid <span class="quoted"><span class="quoted">"<span class="main">(+)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(⊆)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(⊂)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(⋅)</span>"</span></span> <span class="quoted">limp_lan</span> <span class="quoted">rimp_lan</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">z</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> lan"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">⊆</span> limp_lan <span class="skolem">z</span> <span class="skolem">y</span> <span class="main">⟷</span> <span class="skolem">x</span> <span class="main">⋅</span> <span class="skolem">y</span> <span class="main">⊆</span> <span class="skolem">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> c_prod_def limp_lan_def times_list_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">⋅</span> <span class="skolem">y</span> <span class="main">⊆</span> <span class="skolem">z</span> <span class="main">⟷</span> <span class="skolem">y</span> <span class="main">⊆</span> rimp_lan <span class="skolem">x</span> <span class="skolem">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> c_prod_def rimp_lan_def times_list_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> lan_action_algebra<span class="main">:</span> action_algebra <span class="quoted"><span class="quoted">"<span class="main">(+)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(⋅)</span>"</span></span> <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="main">0</span></span> <span class="quoted"><span class="quoted">"<span class="main">(⊆)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(⊂)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(+)</span>"</span></span> <span class="quoted">limp_lan</span> <span class="quoted">rimp_lan</span> <span class="quoted">star</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> lan"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">+</span> <span class="skolem">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="skolem">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">+</span> <span class="skolem">x</span> <span class="main">⊆</span> <span class="skolem">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">+</span> <span class="skolem">y</span> <span class="main">⋅</span> <span class="skolem">y</span> <span class="main">+</span> <span class="skolem">x</span> <span class="main">⊆</span> <span class="skolem">y</span> <span class="main">⟹</span> <span class="skolem">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊆</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> action_algebra_class.star_rtc_2<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Relation Action Algebras›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">limp_rel</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> rel <span class="main">⇒</span> <span class="tfree">'a</span> rel <span class="main">⇒</span> <span class="tfree">'a</span> rel"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">limp_rel</span> <span class="free"><span class="bound"><span class="entity">T</span></span></span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span><span class="bound">x</span><span class="main">)</span> <span class="main">|</span> <span class="bound">y</span> <span class="bound">x</span><span class="main">.</span> <span class="main">∀</span><span class="bound">z</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">z</span><span class="main">)</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">⟶</span> <span class="main">(</span><span class="bound">y</span><span class="main">,</span><span class="bound">z</span><span class="main">)</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">T</span></span></span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">rimp_rel</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> rel <span class="main">⇒</span> <span class="tfree">'a</span> rel <span class="main">⇒</span> <span class="tfree">'a</span> rel"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">rimp_rel</span> <span class="free"><span class="bound"><span class="entity">R</span></span></span> <span class="free"><span class="bound"><span class="entity">T</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span><span class="bound">z</span><span class="main">)</span> <span class="main">|</span> <span class="bound">y</span> <span class="bound">z</span><span class="main">.</span> <span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">R</span></span></span> <span class="main">⟶</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">z</span><span class="main">)</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">T</span></span></span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> rel_residuated_join_semilattice<span class="main">:</span> residuated_sup_lgroupoid <span class="quoted"><span class="quoted">"<span class="main">(∪)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(⊆)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(⊂)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">(O)</span>"</span></span> <span class="quoted">limp_rel</span> <span class="quoted">rimp_rel</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">z</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> rel"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">⊆</span> limp_rel <span class="skolem">z</span> <span class="skolem">y</span> <span class="main">⟷</span> <span class="skolem">x</span> <span class="keyword1">O</span> <span class="skolem">y</span> <span class="main">⊆</span> <span class="skolem">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> limp_rel_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="keyword1">O</span> <span class="skolem">y</span> <span class="main">⊆</span> <span class="skolem">z</span> <span class="main">⟷</span> <span class="skolem">y</span> <span class="main">⊆</span> rimp_rel <span class="skolem">x</span> <span class="skolem">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rimp_rel_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> rel_action_algebra<span class="main">:</span> action_algebra <span class="quoted"><span class="quoted">"<span class="main">(∪)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">(O)</span>"</span></span> <span class="quoted">Id</span> <span class="quoted"><span class="quoted">"<span class="main">{}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(⊆)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(⊂)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(∪)</span>"</span></span> <span class="quoted">limp_rel</span> <span class="quoted">rimp_rel</span> <span class="quoted">rtrancl</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> rel"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Id <span class="main">∪</span> <span class="skolem">x</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span> <span class="keyword1">O</span> <span class="skolem">x</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span> <span class="main">∪</span> <span class="skolem">x</span> <span class="main">⊆</span> <span class="skolem">x</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Id <span class="main">∪</span> <span class="skolem">y</span> <span class="keyword1">O</span> <span class="skolem">y</span> <span class="main">∪</span> <span class="skolem">x</span> <span class="main">⊆</span> <span class="skolem">y</span> <span class="main">⟹</span> <span class="skolem">x</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span> <span class="main">⊆</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rel_kleene_algebra.star_rtc_least<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Trace Action Algebras›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">limp_trace</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'p</span><span class="main">,</span> <span class="tfree">'a</span><span class="main">)</span> trace set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'p</span><span class="main">,</span> <span class="tfree">'a</span><span class="main">)</span> trace set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'p</span><span class="main">,</span> <span class="tfree">'a</span><span class="main">)</span> trace set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">limp_trace</span> <span class="free"><span class="bound"><span class="entity">Z</span></span></span> <span class="free"><span class="bound"><span class="entity">Y</span></span></span> <span class="main">=</span> <span class="main">⋃</span> <span class="main">{</span><span class="bound">X</span><span class="main">.</span> t_prod <span class="bound">X</span> <span class="free"><span class="bound"><span class="entity">Y</span></span></span> <span class="main">⊆</span> <span class="free"><span class="bound"><span class="entity">Z</span></span></span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">rimp_trace</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'p</span><span class="main">,</span> <span class="tfree">'a</span><span class="main">)</span> trace set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'p</span><span class="main">,</span> <span class="tfree">'a</span><span class="main">)</span> trace set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'p</span><span class="main">,</span> <span class="tfree">'a</span><span class="main">)</span> trace set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">rimp_trace</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="free"><span class="bound"><span class="entity">Z</span></span></span> <span class="main">=</span> <span class="main">⋃</span> <span class="main">{</span><span class="bound">Y</span><span class="main">.</span> t_prod <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="bound">Y</span> <span class="main">⊆</span> <span class="free"><span class="bound"><span class="entity">Z</span></span></span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> trace_residuated_join_semilattice<span class="main">:</span> residuated_sup_lgroupoid <span class="quoted"><span class="quoted">"<span class="main">(∪)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(⊆)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(⊂)</span>"</span></span> <span class="quoted">t_prod</span> <span class="quoted">limp_trace</span> <span class="quoted">rimp_trace</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">X</span> <span class="skolem">Y</span> <span class="skolem">Z</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> trace set"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">⊆</span> limp_trace <span class="skolem">Z</span> <span class="skolem">Y</span> <span class="main">⟷</span> t_prod <span class="skolem">X</span> <span class="skolem">Y</span> <span class="main">⊆</span> <span class="skolem">Z</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">⊆</span> limp_trace <span class="skolem">Z</span> <span class="skolem">Y</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"t_prod <span class="skolem">X</span> <span class="skolem">Y</span> <span class="main">⊆</span> t_prod <span class="main">(</span>limp_trace <span class="skolem">Z</span> <span class="skolem">Y</span><span class="main">)</span> <span class="skolem">Y</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> trace_dioid.mult_isor<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⊆</span> t_prod <span class="main">(</span><span class="main">⋃</span> <span class="main">{</span><span class="bound">X</span><span class="main">.</span> t_prod <span class="bound">X</span> <span class="skolem">Y</span> <span class="main">⊆</span> <span class="skolem">Z</span><span class="main">}</span><span class="main">)</span> <span class="skolem">Y</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> limp_trace_def<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">⋃</span> <span class="main">{</span>t_prod <span class="bound">X</span> <span class="skolem">Y</span> <span class="main">|</span> <span class="bound">X</span><span class="main">.</span> t_prod <span class="bound">X</span> <span class="skolem">Y</span> <span class="main">⊆</span> <span class="skolem">Z</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> t_prod_def<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"t_prod <span class="skolem">X</span> <span class="skolem">Y</span> <span class="main">⊆</span> <span class="skolem">Z</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"t_prod <span class="skolem">X</span> <span class="skolem">Y</span> <span class="main">⊆</span> <span class="skolem">Z</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">⊆</span> <span class="main">⋃</span> <span class="main">{</span><span class="bound">X</span><span class="main">.</span> t_prod <span class="bound">X</span> <span class="skolem">Y</span> <span class="main">⊆</span> <span class="skolem">Z</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Sup_upper mem_Collect_eq<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">⊆</span> limp_trace <span class="skolem">Z</span> <span class="skolem">Y</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> limp_trace_def<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"t_prod <span class="skolem">X</span> <span class="skolem">Y</span> <span class="main">⊆</span> <span class="skolem">Z</span> <span class="main">⟷</span> <span class="skolem">Y</span> <span class="main">⊆</span> rimp_trace <span class="skolem">X</span> <span class="skolem">Z</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"t_prod <span class="skolem">X</span> <span class="skolem">Y</span> <span class="main">⊆</span> <span class="skolem">Z</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Y</span> <span class="main">⊆</span> <span class="main">⋃</span> <span class="main">{</span><span class="bound">Y</span><span class="main">.</span> t_prod <span class="skolem">X</span> <span class="bound">Y</span> <span class="main">⊆</span> <span class="skolem">Z</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Sup_upper mem_Collect_eq<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Y</span> <span class="main">⊆</span> rimp_trace <span class="skolem">X</span> <span class="skolem">Z</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rimp_trace_def<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Y</span> <span class="main">⊆</span> rimp_trace <span class="skolem">X</span> <span class="skolem">Z</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"t_prod <span class="skolem">X</span> <span class="skolem">Y</span> <span class="main">⊆</span> t_prod <span class="skolem">X</span> <span class="main">(</span>rimp_trace <span class="skolem">X</span> <span class="skolem">Z</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> trace_dioid.mult_isol<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⊆</span> t_prod <span class="skolem">X</span> <span class="main">(</span><span class="main">⋃</span> <span class="main">{</span><span class="bound">Y</span><span class="main">.</span> t_prod <span class="skolem">X</span> <span class="bound">Y</span> <span class="main">⊆</span> <span class="skolem">Z</span><span class="main">}</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rimp_trace_def<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">⋃</span> <span class="main">{</span>t_prod <span class="skolem">X</span> <span class="bound">Y</span> <span class="main">|</span> <span class="bound">Y</span><span class="main">.</span> t_prod <span class="skolem">X</span> <span class="bound">Y</span> <span class="main">⊆</span> <span class="skolem">Z</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> t_prod_def<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"t_prod <span class="skolem">X</span> <span class="skolem">Y</span> <span class="main">⊆</span> <span class="skolem">Z</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> trace_action_algebra<span class="main">:</span> action_algebra <span class="quoted"><span class="quoted">"<span class="main">(∪)</span>"</span></span> <span class="quoted">t_prod</span> <span class="quoted">t_one</span> <span class="quoted">t_zero</span> <span class="quoted"><span class="quoted">"<span class="main">(⊆)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(⊂)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(∪)</span>"</span></span> <span class="quoted">limp_trace</span> <span class="quoted">rimp_trace</span> <span class="quoted">t_star</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">X</span> <span class="skolem">Y</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> trace set"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"t_one <span class="main">∪</span> t_prod <span class="main">(</span>t_star <span class="skolem">X</span><span class="main">)</span> <span class="main">(</span>t_star <span class="skolem">X</span><span class="main">)</span> <span class="main">∪</span> <span class="skolem">X</span> <span class="main">⊆</span> t_star <span class="skolem">X</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"t_one <span class="main">∪</span> t_prod <span class="skolem">Y</span> <span class="skolem">Y</span> <span class="main">∪</span> <span class="skolem">X</span> <span class="main">⊆</span> <span class="skolem">Y</span> <span class="main">⟹</span> t_star <span class="skolem">X</span> <span class="main">⊆</span> <span class="skolem">Y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> trace_kleene_algebra.star_rtc_least<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Path Action Algebras›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We start with paths that include the empty path.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">limp_path</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> path set <span class="main">⇒</span> <span class="tfree">'a</span> path set <span class="main">⇒</span> <span class="tfree">'a</span> path set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">limp_path</span> <span class="free"><span class="bound"><span class="entity">Z</span></span></span> <span class="free"><span class="bound"><span class="entity">Y</span></span></span> <span class="main">=</span> <span class="main">⋃</span> <span class="main">{</span><span class="bound">X</span><span class="main">.</span> p_prod <span class="bound">X</span> <span class="free"><span class="bound"><span class="entity">Y</span></span></span> <span class="main">⊆</span> <span class="free"><span class="bound"><span class="entity">Z</span></span></span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">rimp_path</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> path set <span class="main">⇒</span> <span class="tfree">'a</span> path set <span class="main">⇒</span> <span class="tfree">'a</span> path set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">rimp_path</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="free"><span class="bound"><span class="entity">Z</span></span></span> <span class="main">=</span> <span class="main">⋃</span> <span class="main">{</span><span class="bound">Y</span><span class="main">.</span> p_prod <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="bound">Y</span> <span class="main">⊆</span> <span class="free"><span class="bound"><span class="entity">Z</span></span></span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> path_residuated_join_semilattice<span class="main">:</span> residuated_sup_lgroupoid <span class="quoted"><span class="quoted">"<span class="main">(∪)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(⊆)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(⊂)</span>"</span></span> <span class="quoted">p_prod</span> <span class="quoted">limp_path</span> <span class="quoted">rimp_path</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">X</span> <span class="skolem">Y</span> <span class="skolem">Z</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> path set"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">⊆</span> limp_path <span class="skolem">Z</span> <span class="skolem">Y</span> <span class="main">⟷</span> p_prod <span class="skolem">X</span> <span class="skolem">Y</span> <span class="main">⊆</span> <span class="skolem">Z</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">⊆</span> limp_path <span class="skolem">Z</span> <span class="skolem">Y</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"p_prod <span class="skolem">X</span> <span class="skolem">Y</span> <span class="main">⊆</span> p_prod <span class="main">(</span>limp_path <span class="skolem">Z</span> <span class="skolem">Y</span><span class="main">)</span> <span class="skolem">Y</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> path_dioid.mult_isor<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⊆</span> p_prod <span class="main">(</span><span class="main">⋃</span> <span class="main">{</span><span class="bound">X</span><span class="main">.</span> p_prod <span class="bound">X</span> <span class="skolem">Y</span> <span class="main">⊆</span> <span class="skolem">Z</span><span class="main">}</span><span class="main">)</span> <span class="skolem">Y</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> limp_path_def<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">⋃</span> <span class="main">{</span>p_prod <span class="bound">X</span> <span class="skolem">Y</span> <span class="main">|</span> <span class="bound">X</span><span class="main">.</span> p_prod <span class="bound">X</span> <span class="skolem">Y</span> <span class="main">⊆</span> <span class="skolem">Z</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> p_prod_def<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"p_prod <span class="skolem">X</span> <span class="skolem">Y</span> <span class="main">⊆</span> <span class="skolem">Z</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"p_prod <span class="skolem">X</span> <span class="skolem">Y</span> <span class="main">⊆</span> <span class="skolem">Z</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">⊆</span> <span class="main">⋃</span> <span class="main">{</span><span class="bound">X</span><span class="main">.</span> p_prod <span class="bound">X</span> <span class="skolem">Y</span> <span class="main">⊆</span> <span class="skolem">Z</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Sup_upper mem_Collect_eq<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">⊆</span> limp_path <span class="skolem">Z</span> <span class="skolem">Y</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> limp_path_def<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"p_prod <span class="skolem">X</span> <span class="skolem">Y</span> <span class="main">⊆</span> <span class="skolem">Z</span> <span class="main">⟷</span> <span class="skolem">Y</span> <span class="main">⊆</span> rimp_path <span class="skolem">X</span> <span class="skolem">Z</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"p_prod <span class="skolem">X</span> <span class="skolem">Y</span> <span class="main">⊆</span> <span class="skolem">Z</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Y</span> <span class="main">⊆</span> <span class="main">⋃</span> <span class="main">{</span><span class="bound">Y</span><span class="main">.</span> p_prod <span class="skolem">X</span> <span class="bound">Y</span> <span class="main">⊆</span> <span class="skolem">Z</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Sup_upper mem_Collect_eq<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Y</span> <span class="main">⊆</span> rimp_path <span class="skolem">X</span> <span class="skolem">Z</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rimp_path_def<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Y</span> <span class="main">⊆</span> rimp_path <span class="skolem">X</span> <span class="skolem">Z</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"p_prod <span class="skolem">X</span> <span class="skolem">Y</span> <span class="main">⊆</span> p_prod <span class="skolem">X</span> <span class="main">(</span>rimp_path <span class="skolem">X</span> <span class="skolem">Z</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> path_dioid.mult_isol<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⊆</span> p_prod <span class="skolem">X</span> <span class="main">(</span><span class="main">⋃</span> <span class="main">{</span><span class="bound">Y</span><span class="main">.</span> p_prod <span class="skolem">X</span> <span class="bound">Y</span> <span class="main">⊆</span> <span class="skolem">Z</span><span class="main">}</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rimp_path_def<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">⋃</span> <span class="main">{</span>p_prod <span class="skolem">X</span> <span class="bound">Y</span> <span class="main">|</span> <span class="bound">Y</span><span class="main">.</span> p_prod <span class="skolem">X</span> <span class="bound">Y</span> <span class="main">⊆</span> <span class="skolem">Z</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> p_prod_def<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"p_prod <span class="skolem">X</span> <span class="skolem">Y</span> <span class="main">⊆</span> <span class="skolem">Z</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> path_action_algebra<span class="main">:</span> action_algebra <span class="quoted"><span class="quoted">"<span class="main">(∪)</span>"</span></span> <span class="quoted">p_prod</span> <span class="quoted">p_one</span> <span class="quoted"><span class="quoted">"<span class="main">{}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(⊆)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(⊂)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(∪)</span>"</span></span> <span class="quoted">limp_path</span> <span class="quoted">rimp_path</span>  <span class="quoted">p_star</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">X</span> <span class="skolem">Y</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> path set"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"p_one <span class="main">∪</span> p_prod <span class="main">(</span>p_star <span class="skolem">X</span><span class="main">)</span> <span class="main">(</span>p_star <span class="skolem">X</span><span class="main">)</span> <span class="main">∪</span> <span class="skolem">X</span> <span class="main">⊆</span> p_star <span class="skolem">X</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"p_one <span class="main">∪</span> p_prod <span class="skolem">Y</span> <span class="skolem">Y</span> <span class="main">∪</span> <span class="skolem">X</span> <span class="main">⊆</span> <span class="skolem">Y</span> <span class="main">⟹</span> p_star <span class="skolem">X</span> <span class="main">⊆</span> <span class="skolem">Y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> path_kleene_algebra.star_rtc_least<span class="main">)</span>    
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We now consider a notion of paths that does not include the
empty path.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">limp_ppath</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ppath set <span class="main">⇒</span> <span class="tfree">'a</span> ppath set <span class="main">⇒</span> <span class="tfree">'a</span> ppath set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">limp_ppath</span> <span class="free"><span class="bound"><span class="entity">Z</span></span></span> <span class="free"><span class="bound"><span class="entity">Y</span></span></span> <span class="main">=</span> <span class="main">⋃</span> <span class="main">{</span><span class="bound">X</span><span class="main">.</span> pp_prod <span class="bound">X</span> <span class="free"><span class="bound"><span class="entity">Y</span></span></span> <span class="main">⊆</span> <span class="free"><span class="bound"><span class="entity">Z</span></span></span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">rimp_ppath</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ppath set <span class="main">⇒</span> <span class="tfree">'a</span> ppath set <span class="main">⇒</span> <span class="tfree">'a</span> ppath set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">rimp_ppath</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="free"><span class="bound"><span class="entity">Z</span></span></span> <span class="main">=</span> <span class="main">⋃</span> <span class="main">{</span><span class="bound">Y</span><span class="main">.</span> pp_prod <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="bound">Y</span> <span class="main">⊆</span> <span class="free"><span class="bound"><span class="entity">Z</span></span></span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> ppath_residuated_join_semilattice<span class="main">:</span> residuated_sup_lgroupoid <span class="quoted"><span class="quoted">"<span class="main">(∪)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(⊆)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(⊂)</span>"</span></span> <span class="quoted">pp_prod</span> <span class="quoted">limp_ppath</span> <span class="quoted">rimp_ppath</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">X</span> <span class="skolem">Y</span> <span class="skolem">Z</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ppath set"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">⊆</span> limp_ppath <span class="skolem">Z</span> <span class="skolem">Y</span> <span class="main">⟷</span> pp_prod <span class="skolem">X</span> <span class="skolem">Y</span> <span class="main">⊆</span> <span class="skolem">Z</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">⊆</span> limp_ppath <span class="skolem">Z</span> <span class="skolem">Y</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"pp_prod <span class="skolem">X</span> <span class="skolem">Y</span> <span class="main">⊆</span> pp_prod <span class="main">(</span>limp_ppath <span class="skolem">Z</span> <span class="skolem">Y</span><span class="main">)</span> <span class="skolem">Y</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ppath_dioid.mult_isor<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⊆</span> pp_prod <span class="main">(</span><span class="main">⋃</span> <span class="main">{</span><span class="bound">X</span><span class="main">.</span> pp_prod <span class="bound">X</span> <span class="skolem">Y</span> <span class="main">⊆</span> <span class="skolem">Z</span><span class="main">}</span><span class="main">)</span> <span class="skolem">Y</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> limp_ppath_def<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">⋃</span> <span class="main">{</span>pp_prod <span class="bound">X</span> <span class="skolem">Y</span> <span class="main">|</span> <span class="bound">X</span><span class="main">.</span> pp_prod <span class="bound">X</span> <span class="skolem">Y</span> <span class="main">⊆</span> <span class="skolem">Z</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> pp_prod_def<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"pp_prod <span class="skolem">X</span> <span class="skolem">Y</span> <span class="main">⊆</span> <span class="skolem">Z</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"pp_prod <span class="skolem">X</span> <span class="skolem">Y</span> <span class="main">⊆</span> <span class="skolem">Z</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">⊆</span> <span class="main">⋃</span> <span class="main">{</span><span class="bound">X</span><span class="main">.</span> pp_prod <span class="bound">X</span> <span class="skolem">Y</span> <span class="main">⊆</span> <span class="skolem">Z</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Sup_upper mem_Collect_eq<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">⊆</span> limp_ppath <span class="skolem">Z</span> <span class="skolem">Y</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> limp_ppath_def<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"pp_prod <span class="skolem">X</span> <span class="skolem">Y</span> <span class="main">⊆</span> <span class="skolem">Z</span> <span class="main">⟷</span> <span class="skolem">Y</span> <span class="main">⊆</span> rimp_ppath <span class="skolem">X</span> <span class="skolem">Z</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"pp_prod <span class="skolem">X</span> <span class="skolem">Y</span> <span class="main">⊆</span> <span class="skolem">Z</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Y</span> <span class="main">⊆</span> <span class="main">⋃</span> <span class="main">{</span><span class="bound">Y</span><span class="main">.</span> pp_prod <span class="skolem">X</span> <span class="bound">Y</span> <span class="main">⊆</span> <span class="skolem">Z</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Sup_upper mem_Collect_eq<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Y</span> <span class="main">⊆</span> rimp_ppath <span class="skolem">X</span> <span class="skolem">Z</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rimp_ppath_def<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Y</span> <span class="main">⊆</span> rimp_ppath <span class="skolem">X</span> <span class="skolem">Z</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"pp_prod <span class="skolem">X</span> <span class="skolem">Y</span> <span class="main">⊆</span> pp_prod <span class="skolem">X</span> <span class="main">(</span>rimp_ppath <span class="skolem">X</span> <span class="skolem">Z</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ppath_dioid.mult_isol<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⊆</span> pp_prod <span class="skolem">X</span> <span class="main">(</span><span class="main">⋃</span> <span class="main">{</span><span class="bound">Y</span><span class="main">.</span> pp_prod <span class="skolem">X</span> <span class="bound">Y</span> <span class="main">⊆</span> <span class="skolem">Z</span><span class="main">}</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rimp_ppath_def<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">⋃</span> <span class="main">{</span>pp_prod <span class="skolem">X</span> <span class="bound">Y</span> <span class="main">|</span> <span class="bound">Y</span><span class="main">.</span> pp_prod <span class="skolem">X</span> <span class="bound">Y</span> <span class="main">⊆</span> <span class="skolem">Z</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> pp_prod_def<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"pp_prod <span class="skolem">X</span> <span class="skolem">Y</span> <span class="main">⊆</span> <span class="skolem">Z</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> ppath_action_algebra<span class="main">:</span> action_algebra <span class="quoted"><span class="quoted">"<span class="main">(∪)</span>"</span></span> <span class="quoted">pp_prod</span> <span class="quoted">pp_one</span> <span class="quoted"><span class="quoted">"<span class="main">{}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(⊆)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(⊂)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(∪)</span>"</span></span> <span class="quoted">limp_ppath</span> <span class="quoted">rimp_ppath</span> <span class="quoted">pp_star</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">X</span> <span class="skolem">Y</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ppath set"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"pp_one <span class="main">∪</span> pp_prod <span class="main">(</span>pp_star <span class="skolem">X</span><span class="main">)</span> <span class="main">(</span>pp_star <span class="skolem">X</span><span class="main">)</span> <span class="main">∪</span> <span class="skolem">X</span> <span class="main">⊆</span> pp_star <span class="skolem">X</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"pp_one <span class="main">∪</span> pp_prod <span class="skolem">Y</span> <span class="skolem">Y</span> <span class="main">∪</span> <span class="skolem">X</span> <span class="main">⊆</span> <span class="skolem">Y</span> <span class="main">⟹</span> pp_star <span class="skolem">X</span> <span class="main">⊆</span> <span class="skolem">Y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ppath_kleene_algebra.star_rtc_least<span class="main">)</span>   
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹The Min-Plus Action Algebra›</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> pnat <span class="main">::</span> <span class="quoted">minus</span>
<span class="keyword2"><span class="keyword">begin</span></span>

  <span class="keyword1"><span class="command">fun</span></span> <span class="entity"><span class="class_parameter">minus_pnat</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span>pnat <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span>pnat <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">=</span> pnat <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span>"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">-</span> PInfty <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"PInfty <span class="main">-</span> <span class="main">(</span>pnat <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>

  <span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">..</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> pnat <span class="main">::</span> <span class="quoted">semilattice_sup</span>
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">definition</span></span> sup_pnat<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="class_parameter">sup_pnat</span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">≡</span> pnat_min <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span>"</span></span> 
  <span class="keyword1"><span class="command">instance</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">z</span> <span class="main">::</span> <span class="quoted">pnat</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">x</span> <span class="main">⊔</span> <span class="skolem">y</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> sup_pnat join_semilattice_class.order_prop plus_pnat_def<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">≤</span> <span class="skolem">x</span> <span class="main">⊔</span> <span class="skolem">y</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add.left_commute less_eq_pnat_def linear plus_pnat_def sup_pnat<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">≤</span> <span class="skolem">x</span> <span class="main">⟹</span> <span class="skolem">z</span> <span class="main">≤</span> <span class="skolem">x</span> <span class="main">⟹</span> <span class="skolem">y</span> <span class="main">⊔</span> <span class="skolem">z</span> <span class="main">≤</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add.commute add.left_commute less_eq_pnat_def plus_pnat_def sup_pnat<span class="main">)</span>  
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>


<span class="keyword1"><span class="command">instantiation</span></span> pnat <span class="main">::</span> <span class="quoted">residuated_sup_lgroupoid</span>
<span class="keyword2"><span class="keyword">begin</span></span>

  <span class="keyword1"><span class="command">definition</span></span> <span class="entity"><span class="class_parameter">residual_r_pnat</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">::</span>pnat<span class="main">)</span> <span class="main">→</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>

  <span class="keyword1"><span class="command">definition</span></span> <span class="entity"><span class="class_parameter">residual_l_pnat</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">::</span>pnat<span class="main">)</span> <span class="main">←</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>

  <span class="keyword1"><span class="command">instance</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">z</span> <span class="main">::</span> <span class="quoted">pnat</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="main">(</span><span class="skolem">z</span> <span class="main">←</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">⟷</span> <span class="skolem">x</span> <span class="main">⋅</span> <span class="skolem">y</span> <span class="main">≤</span> <span class="skolem">z</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">z</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> plus_pnat_def times_pnat_def residual_l_pnat_def less_eq_pnat_def zero_pnat_def one_pnat_def<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">⋅</span> <span class="skolem">y</span> <span class="main">≤</span> <span class="skolem">z</span> <span class="main">⟷</span> <span class="skolem">y</span> <span class="main">≤</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">→</span> <span class="skolem">z</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">z</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> plus_pnat_def times_pnat_def residual_r_pnat_def less_eq_pnat_def zero_pnat_def one_pnat_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* instantiation *)</span>

<span class="keyword1"><span class="command">instantiation</span></span> pnat <span class="main">::</span> <span class="quoted">action_algebra</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The Kleene star for type~<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">typ</span></span> <span class="quoted"><span class="quoted">pnat</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> has already been defined in theory
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">theory</span></span> <a href="../Kleene_Algebra/Kleene_Algebra_Models.html"></a><a href="../Kleene_Algebra/Kleene_Algebra_Models.html">Kleene_Algebra.Kleene_Algebra_Models</a><span class="antiquote"><span class="antiquote">}</span></span></span></span>.›</span></span>

  <span class="keyword1"><span class="command">instance</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="main">::</span> <span class="quoted">pnat</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">+</span> <span class="skolem">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="skolem">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">+</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">+</span> <span class="skolem">y</span> <span class="main">⋅</span> <span class="skolem">y</span> <span class="main">+</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">y</span> <span class="main">⟹</span> <span class="skolem">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="skolem">y</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> star_pnat_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* instantiation *)</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Residuated_Relation_Algebra">
<div class="head">
<h1>Theory Residuated_Relation_Algebra</h1>
</div>
<pre class="source"><span class="comment1">(* Title:      Residuated Relation Algebras
   Author:     Victor Gomes &lt;vborgesferreiragomes1 at sheffield.ac.uk&gt;
   Maintainer: Georg Struth &lt;g.struth@sheffield.ac.uk&gt; 
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Residuated Relation Algebras›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Residuated_Relation_Algebra
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="#Residuated_Boolean_Algebras">Residuated_Boolean_Algebras</a> <a href="../../relation_algebra/theories/#Relation_Algebra">Relation_Algebra.Relation_Algebra</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">context</span></span> boolean_algebra <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The notation used in the relation algebra AFP entry differs a little from ours.
›</span></span>

<span class="keyword1"><span class="command">notation</span></span>
  times <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">⋅</span>"</span> 70<span class="main">)</span>
  <span class="keyword2"><span class="keyword">and</span></span> plus <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">+</span>"</span> 65<span class="main">)</span>
  <span class="keyword2"><span class="keyword">and</span></span> Groups.zero_class.zero <span class="main">(</span><span class="quoted">"<span class="keyword1">0</span>"</span><span class="main">)</span>
  <span class="keyword2"><span class="keyword">and</span></span> Groups.one_class.one <span class="main">(</span><span class="quoted">"<span class="keyword1">1</span>"</span><span class="main">)</span>

<span class="keyword1"><span class="command">no_notation</span></span>
  inf <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">⋅</span>"</span> 70<span class="main">)</span>
  <span class="keyword2"><span class="keyword">and</span></span> sup <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">+</span>"</span> 65<span class="main">)</span>
  <span class="keyword2"><span class="keyword">and</span></span> bot <span class="main">(</span><span class="quoted">"<span class="keyword1">0</span>"</span><span class="main">)</span>
  <span class="keyword2"><span class="keyword">and</span></span> top <span class="main">(</span><span class="quoted">"<span class="keyword1">1</span>"</span><span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  We prove that a unital residuated boolean algebra enriched with two simple
  equalities form a non-associative relation algebra, that is, a relation
  algebra where the associativity law does not hold.
›</span></span>

<span class="keyword1"><span class="command">class</span></span> nra <span class="main">=</span> unital_residuated_boolean <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> conv1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⊳</span> <span class="free">y</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊳</span> <span class="main">1</span><span class="main">)</span><span class="main">⋅</span><span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> conv2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⊲</span> <span class="free">y</span> <span class="main">=</span> <span class="free">x</span><span class="main">⋅</span><span class="main">(</span><span class="main">1</span> <span class="main">⊲</span> <span class="free">y</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  When the converse operation is set to be $\lambda x.\  x \rhd 1$,
  a unital residuated boolean algebra forms a non associative relation algebra.
›</span></span>
  
<span class="keyword1" id="Residuated_Relation_Algebra-conv_invol"><span class="command">lemma</span></span> conv_invol<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⊳</span> <span class="main">1</span> <span class="main">⊳</span> <span class="main">1</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.conv1 local.jonsson1b local.mult_onel<span class="main">)</span>

<span class="keyword1" id="Residuated_Relation_Algebra-conv_add"><span class="command">lemma</span></span> conv_add<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span> <span class="main">⊳</span> <span class="main">1</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊳</span> <span class="main">1</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="free">y</span> <span class="main">⊳</span> <span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.conjr2_sup<span class="main">)</span>

<span class="keyword1" id="Residuated_Relation_Algebra-conv_contrav"><span class="command">lemma</span></span> conv_contrav<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">⋅</span><span class="free">y</span> <span class="main">⊳</span> <span class="main">1</span> <span class="main">=</span> <span class="main">(</span><span class="free">y</span> <span class="main">⊳</span> <span class="main">1</span><span class="main">)</span><span class="main">⋅</span><span class="main">(</span><span class="free">x</span> <span class="main">⊳</span> <span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.conv1 local.conv2 local.jonsson1b local.jonsson2c<span class="main">)</span>

<span class="keyword1" id="Residuated_Relation_Algebra-conv_res"><span class="command">lemma</span></span> conv_res<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">⊳</span> <span class="main">1</span><span class="main">)</span><span class="main">⋅</span><span class="main">-</span> <span class="main">(</span><span class="free">x</span><span class="main">⋅</span><span class="free">y</span><span class="main">)</span> <span class="main">≤</span> <span class="main">-</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.comp_anti local.conjugate_r_def local.conv1 local.double_compl local.res_rc1<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Similarly, for $x^\smile = 1 \lhd x$, since $x \rhd 1 = 1 \lhd x$ when
  $x \rhd 1 \rhd 1 = x$ holds.
›</span></span>

<span class="keyword1" id="Residuated_Relation_Algebra-conv_invol'"><span class="command">lemma</span></span> conv_invol'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">⊲</span> <span class="main">(</span><span class="main">1</span> <span class="main">⊲</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.conv_invol local.jonsson3c<span class="main">)</span>

<span class="keyword1" id="Residuated_Relation_Algebra-conv_add'"><span class="command">lemma</span></span> conv_add'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">⊲</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span> <span class="main">⊲</span> <span class="free">x</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="main">1</span> <span class="main">⊲</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.conjl1_sup<span class="main">)</span>

<span class="keyword1" id="Residuated_Relation_Algebra-conv_contrav'"><span class="command">lemma</span></span> conv_contrav'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">⊲</span> <span class="free">x</span><span class="main">⋅</span><span class="free">y</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span> <span class="main">⊲</span> <span class="free">y</span><span class="main">)</span><span class="main">⋅</span><span class="main">(</span><span class="main">1</span> <span class="main">⊲</span> <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.conv_contrav local.conv_invol local.jonsson3c<span class="main">)</span>

<span class="keyword1" id="Residuated_Relation_Algebra-conv_res'"><span class="command">lemma</span></span> conv_res'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span> <span class="main">⊲</span> <span class="free">x</span><span class="main">)</span><span class="main">⋅</span><span class="main">-</span> <span class="main">(</span><span class="free">x</span><span class="main">⋅</span><span class="free">y</span><span class="main">)</span> <span class="main">≤</span> <span class="main">-</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conv_res local.conv_invol local.jonsson3c<span class="main">)</span>
  
<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* nra *)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Since the previous axioms are equivalent when multiplication is associative
  in a residuated boolean monoid, one of them are sufficient to
  derive a relation algebra.
›</span></span>

<span class="keyword1"><span class="command">class</span></span> residuated_ra <span class="main">=</span> residuated_boolean_monoid <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> conv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⊳</span> <span class="free">y</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊳</span> <span class="main">1</span><span class="main">)</span><span class="main">⋅</span><span class="free">y</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subclass</span></span> nra
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">standard</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">fact</span> conv<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">⊲</span> <span class="skolem">y</span> <span class="main">=</span> <span class="skolem">x</span><span class="main">⋅</span><span class="main">(</span><span class="main">1</span> <span class="main">⊲</span> <span class="skolem">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conv jonsson4<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> relation_algebra <span class="keyword2"><span class="keyword">where</span></span>
  composition <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(⋅)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> unit <span class="main">=</span> <span class="quoted"><span class="main">1</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  converse <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">⊳</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">z</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">⋅</span><span class="skolem">y</span><span class="main">⋅</span><span class="skolem">z</span> <span class="main">=</span> <span class="skolem">x</span><span class="main">⋅</span><span class="main">(</span><span class="skolem">y</span><span class="main">⋅</span><span class="skolem">z</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.mult_assoc<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">⋅</span><span class="main">1</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.mult_onel<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span> <span class="main">⊔</span> <span class="skolem">y</span><span class="main">)</span><span class="main">⋅</span><span class="skolem">z</span> <span class="main">=</span> <span class="skolem">x</span><span class="main">⋅</span><span class="skolem">z</span> <span class="main">⊔</span> <span class="skolem">y</span><span class="main">⋅</span><span class="skolem">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.distr<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">⊳</span> <span class="main">1</span> <span class="main">⊳</span> <span class="main">1</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.conv_invol<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">⊔</span> <span class="skolem">y</span> <span class="main">⊳</span> <span class="main">1</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">⊳</span> <span class="main">1</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">⊳</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.conv_add<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">⋅</span><span class="skolem">y</span> <span class="main">⊳</span> <span class="main">1</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">⊳</span> <span class="main">1</span><span class="main">)</span><span class="main">⋅</span><span class="main">(</span><span class="skolem">x</span> <span class="main">⊳</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.conv_contrav<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span> <span class="main">⊳</span> <span class="main">1</span><span class="main">)</span><span class="main">⋅</span><span class="main">-</span> <span class="main">(</span><span class="skolem">x</span><span class="main">⋅</span><span class="skolem">y</span><span class="main">)</span> <span class="main">≤</span> <span class="main">-</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.conv_res<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* residuated_ra *)</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div>