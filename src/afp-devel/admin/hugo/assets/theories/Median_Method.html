<div id='Median'>iv class="head">
<h1>Theory Median</h1>
</div>

<pre class="source"><span class="keyword1"><span class="command"><span>section</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>â¹</span><span>Intervals are Borel measurable</span><span>âº</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>theory</span></span></span><span> </span><span>Median</span><span>
  </span><span class="keyword2"><span class="keyword"><span>imports</span></span></span><span> </span><span class="quoted"><span>"</span><a href="../../HOL/HOL-Probability/Hoeffding.html"><span>HOL-Probability.Hoeffding</span></a><span>"</span></span><span> </span><span class="quoted"><span>"</span><a href="../../HOL/HOL-Library/Multiset.html"><span>HOL-Library.Multiset</span></a><span>"</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>begin</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>text</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>â¹</span><span>This section contains a proof that intervals are Borel measurable, where an interval is
</span><span>defined as a convex subset of linearly ordered space, more precisely, a set is an interval, if 
</span><span>for each triple of points $x &lt; y &lt; z$: If $x$ and $z$ are in the set so is $y$.
</span><span>This includes ordinary intervals like </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>term</span></span><span> </span><span class="quoted"><span>"</span><span class="main"><span>{</span></span><span class="free"><span>a</span></span><span class="main"><span>..</span></span><span class="free"><span>b</span></span><span class="main"><span>}</span></span><span>"</span></span><span class="antiquote"><span>}</span></span></span><span>, </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>term</span></span><span> </span><span class="quoted"><span>"</span><span class="main"><span>{</span></span><span class="free"><span>a</span></span><span class="main"><span>&lt;..&lt;</span></span><span class="free"><span>b</span></span><span class="main"><span>}</span></span><span>"</span></span><span class="antiquote"><span>}</span></span></span><span> but also for example
</span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>term</span></span><span> [</span><span>show_types</span><span>] </span><span class="quoted"><span>"</span><span class="main"><span>{</span></span><span class="main"><span>(</span></span><span class="bound"><span>x</span></span><span class="main"><span>::</span></span><span>rat</span><span class="main"><span>)</span></span><span class="main"><span>.</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="main"><span>*</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="main"><span>&lt;</span></span><span> </span><span class="numeral"><span>2</span></span><span class="main"><span>}</span></span><span>"</span></span><span class="antiquote"><span>}</span></span></span><span> which cannot be expressed in the standard notation.
</span><span>
</span><span>In the </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>theory</span></span><span> "</span><a href="../../HOL/HOL-Analysis/Borel_Space.html"><span>HOL-Analysis.Borel_Space</span></a><span>"</span><span class="antiquote"><span>}</span></span></span><span> there are proofs for the measurability of each specific
</span><span>type of interval, but those unfortunately do not help if we want to express the result about the
</span><span>median bound for arbitrary types of intervals.</span><span>âº</span></span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="Median.interval_def|fact"><span class="entity_def" id="Median.interval_def|thm"><span class="entity_def" id="Median.interval_def_raw|axiom"><span>definition</span></span></span></span></span></span><span> </span><span class="entity"><span class="entity_def" id="Median.interval|const"><span>interval</span></span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="tfree"><span>'a</span></span><span> </span><span class="main"><span>::</span></span><span> </span><span>linorder</span><span class="main"><span>)</span></span><span> </span><span>set</span><span> </span><span class="main"><span>â</span></span><span> </span><span>bool</span><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span>
  </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>interval</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>I</span></span></span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>â</span></span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>y</span></span><span> </span><span class="bound"><span>z</span></span><span class="main"><span>.</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="main"><span>â</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>I</span></span></span></span><span> </span><span class="main"><span>â¶</span></span><span> </span><span class="bound"><span>z</span></span><span> </span><span class="main"><span>â</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>I</span></span></span></span><span> </span><span class="main"><span>â¶</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="main"><span>â¤</span></span><span> </span><span class="bound"><span>y</span></span><span> </span><span class="main"><span>â¶</span></span><span> </span><span class="bound"><span>y</span></span><span> </span><span class="main"><span>â¤</span></span><span> </span><span class="bound"><span>z</span></span><span> </span><span class="main"><span>â¶</span></span><span> </span><span class="bound"><span>y</span></span><span> </span><span class="main"><span>â</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>I</span></span></span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="Median.up_ray_def|fact"><span class="entity_def" id="Median.up_ray_def|thm"><span class="entity_def" id="Median.up_ray_def_raw|axiom"><span>definition</span></span></span></span></span></span><span> </span><span class="entity"><span class="entity_def" id="Median.up_ray|const"><span>up_ray</span></span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="tfree"><span>'a</span></span><span> </span><span class="main"><span>::</span></span><span> </span><span>linorder</span><span class="main"><span>)</span></span><span> </span><span>set</span><span> </span><span class="main"><span>â</span></span><span> </span><span>bool</span><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span>
  </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>up_ray</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>I</span></span></span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>â</span></span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>y</span></span><span class="main"><span>.</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="main"><span>â</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>I</span></span></span></span><span> </span><span class="main"><span>â¶</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="main"><span>â¤</span></span><span> </span><span class="bound"><span>y</span></span><span> </span><span class="main"><span>â¶</span></span><span> </span><span class="bound"><span>y</span></span><span> </span><span class="main"><span>â</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>I</span></span></span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_1063..1068">lemma</span></span></span><span> </span><span class="entity_def" id="Median.up_ray_borel|fact"><span class="entity_def" id="Median.up_ray_borel|thm"><span>up_ray_borel</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Median.html#Median.up_ray|const"><span>up_ray</span></a><span> </span><span class="main"><span>(</span></span><span class="free"><span>I</span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="tfree"><span>'a</span></span><span> </span><span class="main"><span>::</span></span><span> </span><span>linorder_topology</span><span class="main"><span>)</span></span><span> </span><span>set</span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>I</span></span><span> </span><span class="main"><span>â</span></span><span> </span><span>borel</span><span>"</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>cases</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span>closed</span><span> </span><span class="free"><span>I</span></span><span>"</span></span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span>True</span><span>
  </span><span class="keyword1"><span class="command"><span>then</span></span></span><span> </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?thesis</span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><span>borel_closed</span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>blast</span></span><span>
</span><span class="keyword1"><span class="command"><span>next</span></span></span><span>
  </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span>False</span><span>
  </span><span class="keyword1"><span class="command"><span>hence</span></span></span><span> </span><span class="entity_def" id="offset_1272..1273">b</span><span class="main"><span>:</span></span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>Â¬</span></span><span> </span><span>closed</span><span> </span><span class="free"><span>I</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>blast</span></span><span>

  </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span>open</span><span> </span><span class="free"><span>I</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>rule</span></span><span> </span><span>Topological_Spaces.openI</span><span class="main"><span>)</span></span><span>
    </span><span class="keyword3"><span class="command"><span>fix</span></span></span><span> </span><span class="skolem"><span>x</span></span><span>
    </span><span class="keyword3"><span class="command"><span>assume</span></span></span><span> </span><span class="entity_def" id="offset_1374..1375">c</span><span class="main"><span>:</span></span><span class="quoted"><span class="quoted"><span>"</span><span class="skolem"><span>x</span></span><span> </span><span class="main"><span>â</span></span><span> </span><span class="free"><span>I</span></span><span>"</span></span></span><span>
    </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>â</span></span><span class="bound"><span>T</span></span><span class="main"><span>.</span></span><span> </span><span>open</span><span> </span><span class="bound"><span>T</span></span><span> </span><span class="main"><span>â§</span></span><span> </span><span class="skolem"><span>x</span></span><span> </span><span class="main"><span>â</span></span><span> </span><span class="bound"><span>T</span></span><span> </span><span class="main"><span>â§</span></span><span> </span><span class="bound"><span>T</span></span><span> </span><span class="main"><span>â</span></span><span> </span><span class="free"><span>I</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>cases</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>â</span></span><span class="bound"><span>y</span></span><span class="main"><span>.</span></span><span> </span><span class="bound"><span>y</span></span><span> </span><span class="main"><span>&lt;</span></span><span> </span><span class="skolem"><span>x</span></span><span> </span><span class="main"><span>â§</span></span><span> </span><span class="bound"><span>y</span></span><span> </span><span class="main"><span>â</span></span><span> </span><span class="free"><span>I</span></span><span>"</span></span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span>True</span><span>
      </span><span class="keyword1"><span class="command"><span>then</span></span></span><span> </span><span class="keyword3"><span class="command"><span>obtain</span></span></span><span> </span><span class="skolem"><span class="skolem"><span>y</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span> </span><span class="entity_def" id="offset_1502..1503">a</span><span class="main"><span>:</span></span><span class="quoted"><span class="quoted"><span>"</span><span class="skolem"><span>y</span></span><span> </span><span class="main"><span>&lt;</span></span><span> </span><span class="skolem"><span>x</span></span><span> </span><span class="main"><span>â§</span></span><span> </span><span class="skolem"><span>y</span></span><span> </span><span class="main"><span>â</span></span><span> </span><span class="free"><span>I</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>blast</span></span><span>
      </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span>open</span><span> </span><span class="main"><span>{</span></span><span class="skolem"><span>y</span></span><span class="main"><span>&lt;..}</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp</span></span><span>
      </span><span class="keyword1"><span class="command"><span>moreover</span></span></span><span> </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="skolem"><span>x</span></span><span> </span><span class="main"><span>â</span></span><span> </span><span class="main"><span>{</span></span><span class="skolem"><span>y</span></span><span class="main"><span>&lt;..}</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Median.html#offset_1502..1503"><span>a</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp</span></span><span>
      </span><span class="keyword1"><span class="command"><span>moreover</span></span></span><span> </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>{</span></span><span class="skolem"><span>y</span></span><span class="main"><span>&lt;..}</span></span><span> </span><span class="main"><span>â</span></span><span> </span><span class="free"><span>I</span></span><span>"</span></span></span><span>
        </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>rule</span></span><span> </span><span>subsetI</span><span class="main"><span>)</span></span><span>
        </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Median.html#offset_1502..1503"><span>a</span></a><span> </span><a class="entity_ref" href="Median.html#offset_1063..1068"><span>assms</span></a><span class="main"><span>(</span></span><span>1</span><span class="main"><span>)</span></span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Median.html#Median.up_ray_def|fact"><span>up_ray_def</span></a><span class="main"><span>)</span></span><span> 
        </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>metis</span></span><span> </span><span>less_le_not_le</span><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span>ultimately</span></span></span><span> </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?thesis</span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>blast</span></span><span>
    </span><span class="keyword1"><span class="command"><span>next</span></span></span><span>
      </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span>False</span><span>
      </span><span class="keyword1"><span class="command"><span>hence</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>I</span></span><span> </span><span class="main"><span>â</span></span><span> </span><span class="main"><span>{</span></span><span class="skolem"><span>x</span></span><span class="main"><span>..}</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><span>linorder_not_less</span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>auto</span></span><span>
      </span><span class="keyword1"><span class="command"><span>moreover</span></span></span><span> </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>{</span></span><span class="skolem"><span>x</span></span><span class="main"><span>..}</span></span><span> </span><span class="main"><span>â</span></span><span> </span><span class="free"><span>I</span></span><span>"</span></span></span><span>
        </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Median.html#offset_1374..1375"><span>c</span></a><span> </span><a class="entity_ref" href="Median.html#offset_1063..1068"><span>assms</span></a><span class="main"><span>(</span></span><span>1</span><span class="main"><span>)</span></span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Median.html#Median.up_ray_def|fact"><span>up_ray_def</span></a><span class="main"><span>)</span></span><span> 
        </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>blast</span></span><span>
      </span><span class="keyword1"><span class="command"><span>ultimately</span></span></span><span> </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>I</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>{</span></span><span class="skolem"><span>x</span></span><span class="main"><span>..}</span></span><span>"</span></span></span><span> 
        </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>rule</span></span><span> </span><span>order_antisym</span><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span>moreover</span></span></span><span> </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span>closed</span><span> </span><span class="main"><span>{</span></span><span class="skolem"><span>x</span></span><span class="main"><span>..}</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp</span></span><span>
      </span><span class="keyword1"><span class="command"><span>ultimately</span></span></span><span> </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span>False</span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Median.html#offset_1272..1273"><span>b</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>auto</span></span><span>
      </span><span class="keyword1"><span class="command"><span>then</span></span></span><span> </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?thesis</span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp</span></span><span>
    </span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>then</span></span></span><span> </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?thesis</span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp</span></span><span>
</span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="Median.down_ray_def|fact"><span class="entity_def" id="Median.down_ray_def|thm"><span class="entity_def" id="Median.down_ray_def_raw|axiom"><span>definition</span></span></span></span></span></span><span> </span><span class="entity"><span class="entity_def" id="Median.down_ray|const"><span>down_ray</span></span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="tfree"><span>'a</span></span><span> </span><span class="main"><span>::</span></span><span> </span><span>linorder</span><span class="main"><span>)</span></span><span> </span><span>set</span><span> </span><span class="main"><span>â</span></span><span> </span><span>bool</span><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span>
  </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>down_ray</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>I</span></span></span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>â</span></span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>y</span></span><span class="main"><span>.</span></span><span> </span><span class="bound"><span>y</span></span><span> </span><span class="main"><span>â</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>I</span></span></span></span><span> </span><span class="main"><span>â¶</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="main"><span>â¤</span></span><span> </span><span class="bound"><span>y</span></span><span> </span><span class="main"><span>â¶</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="main"><span>â</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>I</span></span></span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_2330..2335">lemma</span></span></span><span> </span><span class="entity_def" id="Median.down_ray_borel|fact"><span class="entity_def" id="Median.down_ray_borel|thm"><span>down_ray_borel</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Median.html#Median.down_ray|const"><span>down_ray</span></a><span> </span><span class="main"><span>(</span></span><span class="free"><span>I</span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="tfree"><span>'a</span></span><span> </span><span class="main"><span>::</span></span><span> </span><span>linorder_topology</span><span class="main"><span>)</span></span><span> </span><span>set</span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>I</span></span><span> </span><span class="main"><span>â</span></span><span> </span><span>borel</span><span>"</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="operator"><span>-</span></span><span>
  </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Median.html#Median.up_ray|const"><span>up_ray</span></a><span> </span><span class="main"><span>(</span></span><span class="main"><span>-</span></span><span class="free"><span>I</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Median.html#offset_2330..2335"><span>assms</span></a><span> 
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Median.html#Median.up_ray_def|fact"><span>up_ray_def</span></a><span> </span><a class="entity_ref" href="Median.html#Median.down_ray_def|fact"><span>down_ray_def</span></a><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><span class="operator"><span>blast</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>hence</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="main"><span>-</span></span><span class="free"><span>I</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>â</span></span><span> </span><span>borel</span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Median.html#Median.up_ray_borel|fact"><span>up_ray_borel</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>blast</span></span><span>
  </span><span class="keyword3"><span class="command"><span>thus</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>I</span></span><span> </span><span class="main"><span>â</span></span><span> </span><span>borel</span><span>"</span></span></span><span> 
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>metis</span></span><span> </span><span>borel_comp</span><span> </span><span>double_complement</span><span class="main"><span>)</span></span><span>
</span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>text</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>â¹</span><span>Main result of this section:</span><span>âº</span></span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_2681..2686">lemma</span></span></span><span> </span><span class="entity_def" id="Median.interval_borel|fact"><span class="entity_def" id="Median.interval_borel|thm"><span>interval_borel</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Median.html#Median.interval|const"><span>interval</span></a><span> </span><span class="main"><span>(</span></span><span class="free"><span>I</span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="tfree"><span>'a</span></span><span> </span><span class="main"><span>::</span></span><span> </span><span>linorder_topology</span><span class="main"><span>)</span></span><span> </span><span>set</span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>I</span></span><span> </span><span class="main"><span>â</span></span><span> </span><span>borel</span><span>"</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>cases</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>I</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>{}</span></span><span>"</span></span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span>True</span><span>
  </span><span class="keyword1"><span class="command"><span>then</span></span></span><span> </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?thesis</span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp</span></span><span>
</span><span class="keyword1"><span class="command"><span>next</span></span></span><span>
  </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span>False</span><span>
  </span><span class="keyword1"><span class="command"><span>then</span></span></span><span> </span><span class="keyword3"><span class="command"><span>obtain</span></span></span><span> </span><span class="skolem"><span class="skolem"><span>x</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span> </span><span class="entity_def" id="offset_2886..2887">a</span><span class="main"><span>:</span></span><span class="quoted"><span class="quoted"><span>"</span><span class="skolem"><span>x</span></span><span> </span><span class="main"><span>â</span></span><span> </span><span class="free"><span>I</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>blast</span></span><span>
  </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>â</span></span><span class="bound"><span>y</span></span><span> </span><span class="bound"><span>z</span></span><span class="main"><span>.</span></span><span> </span><span class="bound"><span>y</span></span><span> </span><span class="main"><span>â</span></span><span> </span><span class="free"><span>I</span></span><span> </span><span class="main"><span>âª</span></span><span> </span><span class="main"><span>{</span></span><span class="skolem"><span>x</span></span><span class="main"><span>..}</span></span><span> </span><span class="main"><span>â¹</span></span><span> </span><span class="bound"><span>y</span></span><span> </span><span class="main"><span>â¤</span></span><span> </span><span class="bound"><span>z</span></span><span> </span><span class="main"><span>â¹</span></span><span> </span><span class="bound"><span>z</span></span><span> </span><span class="main"><span>â</span></span><span> </span><span class="free"><span>I</span></span><span> </span><span class="main"><span>âª</span></span><span> </span><span class="main"><span>{</span></span><span class="skolem"><span>x</span></span><span class="main"><span>..}</span></span><span>"</span></span></span><span> 
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>metis</span></span><span> </span><a class="entity_ref" href="Median.html#offset_2681..2686"><span>assms</span></a><span> </span><a class="entity_ref" href="Median.html#offset_2886..2887"><span>a</span></a><span> </span><a class="entity_ref" href="Median.html#Median.interval_def|fact"><span>interval_def</span></a><span>  </span><span>IntE</span><span> </span><span>UnE</span><span> </span><span>Un_Int_eq</span><span class="main"><span class="main"><span>(</span></span></span><span>1</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><span>Un_Int_eq</span><span class="main"><span class="main"><span>(</span></span></span><span>2</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><span>atLeast_iff</span><span> </span><span>nle_le</span><span> </span><span>order.trans</span><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>hence</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Median.html#Median.up_ray|const"><span>up_ray</span></a><span> </span><span class="main"><span>(</span></span><span class="free"><span>I</span></span><span> </span><span class="main"><span>âª</span></span><span> </span><span class="main"><span>{</span></span><span class="skolem"><span>x</span></span><span class="main"><span>..}</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Median.html#Median.up_ray_def|fact"><span>up_ray_def</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>blast</span></span><span>
  </span><span class="keyword1"><span class="command"><span>hence</span></span></span><span> </span><span class="entity_def" id="offset_3129..3130">b</span><span class="main"><span>:</span></span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>I</span></span><span> </span><span class="main"><span>âª</span></span><span> </span><span class="main"><span>{</span></span><span class="skolem"><span>x</span></span><span class="main"><span>..}</span></span><span> </span><span class="main"><span>â</span></span><span> </span><span>borel</span><span>"</span></span></span><span> 
    </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Median.html#Median.up_ray_borel|fact"><span>up_ray_borel</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>blast</span></span><span>

  </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>â</span></span><span class="bound"><span>y</span></span><span> </span><span class="bound"><span>z</span></span><span class="main"><span>.</span></span><span> </span><span class="bound"><span>y</span></span><span> </span><span class="main"><span>â</span></span><span> </span><span class="free"><span>I</span></span><span> </span><span class="main"><span>âª</span></span><span> </span><span class="main"><span>{..</span></span><span class="skolem"><span>x</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>â¹</span></span><span> </span><span class="bound"><span>z</span></span><span> </span><span class="main"><span>â¤</span></span><span> </span><span class="bound"><span>y</span></span><span> </span><span class="main"><span>â¹</span></span><span> </span><span class="bound"><span>z</span></span><span> </span><span class="main"><span>â</span></span><span> </span><span class="free"><span>I</span></span><span> </span><span class="main"><span>âª</span></span><span> </span><span class="main"><span>{..</span></span><span class="skolem"><span>x</span></span><span class="main"><span>}</span></span><span>"</span></span></span><span> 
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>metis</span></span><span> </span><a class="entity_ref" href="Median.html#offset_2681..2686"><span>assms</span></a><span> </span><a class="entity_ref" href="Median.html#offset_2886..2887"><span>a</span></a><span> </span><a class="entity_ref" href="Median.html#Median.interval_def|fact"><span>interval_def</span></a><span> </span><span>UnE</span><span> </span><span>UnI1</span><span> </span><span>UnI2</span><span> </span><span>atMost_iff</span><span> </span><span>dual_order.trans</span><span> </span><span>linorder_le_cases</span><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>hence</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Median.html#Median.down_ray|const"><span>down_ray</span></a><span> </span><span class="main"><span>(</span></span><span class="free"><span>I</span></span><span> </span><span class="main"><span>âª</span></span><span> </span><span class="main"><span>{..</span></span><span class="skolem"><span>x</span></span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Median.html#Median.down_ray_def|fact"><span>down_ray_def</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>blast</span></span><span>
  </span><span class="keyword1"><span class="command"><span>hence</span></span></span><span> </span><span class="entity_def" id="offset_3406..3407">c</span><span class="main"><span>:</span></span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>I</span></span><span> </span><span class="main"><span>âª</span></span><span> </span><span class="main"><span>{..</span></span><span class="skolem"><span>x</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>â</span></span><span> </span><span>borel</span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Median.html#Median.down_ray_borel|fact"><span>down_ray_borel</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>blast</span></span><span>

  </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>I</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>I</span></span><span> </span><span class="main"><span>âª</span></span><span> </span><span class="main"><span>{</span></span><span class="skolem"><span>x</span></span><span class="main"><span>..}</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>â©</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>I</span></span><span> </span><span class="main"><span>âª</span></span><span> </span><span class="main"><span>{..</span></span><span class="skolem"><span>x</span></span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Median.html#offset_2886..2887"><span>a</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>fastforce</span></span><span>    

  </span><span class="keyword1"><span class="command"><span>then</span></span></span><span> </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?thesis</span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Median.html#offset_3129..3130"><span>b</span></a><span> </span><a class="entity_ref" href="Median.html#offset_3406..3407"><span>c</span></a><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>metis</span></span><span> </span><span>sets.Int</span><span class="main"><span>)</span></span><span>
</span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>section</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>â¹</span><span>Order statistics are Borel measurable</span><span>âº</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>text</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>â¹</span><span>This section contains a proof that order statistics of Borel measurable random variables are
</span><span>themselves Borel measurable.
</span><span>
</span><span>The proof relies on the existence of branch-free comparison-sort algorithms. Given a sequence length
</span><span>these algorithms perform compare-swap operations on predefined pairs of positions. In particular the
</span><span>result of a comparison does not affect future operations. An example for a branch-free comparison
</span><span>sort algorithm is shell-sort and also bubble-sort without the early exit.
</span><span>
</span><span>The advantage of using such a comparison-sort algorithm is that it can be lifted to work on random
</span><span>variables, where the result of a comparison-swap operation on two random variables </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>term</span></span><span class="quoted"><span>"</span><span class="free"><span>X</span></span><span>"</span></span><span class="antiquote"><span>}</span></span></span><span> and
</span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>term</span></span><span class="quoted"><span>"</span><span class="free"><span>Y</span></span><span>"</span></span><span class="antiquote"><span>}</span></span></span><span> can be represented as the expressions </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>term</span></span><span> </span><span class="quoted"><span>"</span><span class="main"><span>Î»</span></span><span class="bound"><span>Ï</span></span><span class="main"><span>.</span></span><span> </span><span>min</span><span> </span><span class="main"><span>(</span></span><span class="free"><span>X</span></span><span> </span><span class="bound"><span>Ï</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>Y</span></span><span> </span><span class="bound"><span>Ï</span></span><span class="main"><span>)</span></span><span>"</span></span><span class="antiquote"><span>}</span></span></span><span> and
</span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>term</span></span><span> </span><span class="quoted"><span>"</span><span class="main"><span>Î»</span></span><span class="bound"><span>Ï</span></span><span class="main"><span>.</span></span><span> </span><span>max</span><span> </span><span class="main"><span>(</span></span><span class="free"><span>X</span></span><span> </span><span class="bound"><span>Ï</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>Y</span></span><span> </span><span class="bound"><span>Ï</span></span><span class="main"><span>)</span></span><span>"</span></span><span class="antiquote"><span>}</span></span></span><span>.
</span><span>
</span><span>Because taking the point-wise minimum (resp. maximum) of two random variables is still
</span><span>Borel measurable, and because the entire sorting operation can be represented using such
</span><span>compare-swap operations, we can show that all order statistics are Borel measuable.</span><span>âº</span></span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="Median.sort_primitive.elims|fact"><span class="entity_def" id="Median.sort_primitive.induct|fact"><span class="entity_def" id="Median.sort_primitive.simps|fact"><span class="entity_def" id="Median.sort_primitive.pelims|fact"><span class="entity_def" id="Median.sort_primitive.cases|fact"><span class="entity_def" id="Median.sort_primitive.termination|fact"><span class="entity_def" id="Median.sort_primitive.pinduct|fact"><span class="entity_def" id="Median.sort_primitive.psimps|fact"><span class="entity_def" id="Median.sort_primitive_rel.inducts|fact"><span class="entity_def" id="Median.sort_primitive_rel.simps|fact"><span class="entity_def" id="Median.sort_primitive_rel.induct|fact"><span class="entity_def" id="Median.sort_primitive_rel.cases|fact"><span class="entity_def" id="Median.sort_primitive_rel.intros|fact"><span class="entity_def" id="Median.sort_primitive_graph.inducts|fact"><span class="entity_def" id="Median.sort_primitive_graph.simps|fact"><span class="entity_def" id="Median.sort_primitive_graph.induct|fact"><span class="entity_def" id="Median.sort_primitive_graph.cases|fact"><span class="entity_def" id="Median.sort_primitive_graph.intros|fact"><span class="entity_def" id="Median.sort_primitive.elims|thm"><span class="entity_def" id="Median.sort_primitive.induct|thm"><span class="entity_def" id="Median.sort_primitive.simps|thm"><span class="entity_def" id="Median.sort_primitive.pelims|thm"><span class="entity_def" id="Median.sort_primitive.cases|thm"><span class="entity_def" id="Median.sort_primitive.termination|thm"><span class="entity_def" id="Median.sort_primitive.pinduct|thm"><span class="entity_def" id="Median.sort_primitive.psimps|thm"><span class="entity_def" id="Median.sort_primitive_rel.inducts|thm"><span class="entity_def" id="Median.sort_primitive_rel.simps|thm"><span class="entity_def" id="Median.sort_primitive_rel.induct|thm"><span class="entity_def" id="Median.sort_primitive_rel.cases|thm"><span class="entity_def" id="Median.sort_primitive_graph.inducts|thm"><span class="entity_def" id="Median.sort_primitive_graph.simps|thm"><span class="entity_def" id="Median.sort_primitive_graph.induct|thm"><span class="entity_def" id="Median.sort_primitive_graph.cases|thm"><span class="entity_def" id="Median.sort_primitive_graph.intros|thm"><span class="entity_def" id="Median.sort_primitive_def|axiom"><span class="entity_def" id="Median.sort_primitive_rel_def|axiom"><span class="entity_def" id="Median.sort_primitive_sumC_def|axiom"><span class="entity_def" id="Median.sort_primitive_graph_def|axiom"><span class="entity_def" id="Median.sort_primitive_dom|const"><span class="entity_def" id="Median.sort_primitive_rel|const"><span class="entity_def" id="Median.sort_primitive_sumC|const"><span class="entity_def" id="Median.sort_primitive_graph|const"><span>fun</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span> </span><span class="entity"><span class="entity_def" id="Median.sort_primitive|const"><span>sort_primitive</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span>
  </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>sort_primitive</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>i</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>j</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>f</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>k</span></span></span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span>if</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>k</span></span></span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>i</span></span></span></span><span> </span><span class="keyword1"><span>then</span></span><span> </span><span>min</span><span> </span><span class="main"><span>(</span></span><span class="free"><span class="bound"><span class="entity"><span>f</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>i</span></span></span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span class="bound"><span class="entity"><span>f</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>j</span></span></span></span><span class="main"><span>)</span></span><span> </span><span class="keyword1"><span>else</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span>if</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>k</span></span></span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>j</span></span></span></span><span> </span><span class="keyword1"><span>then</span></span><span> </span><span>max</span><span> </span><span class="main"><span>(</span></span><span class="free"><span class="bound"><span class="entity"><span>f</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>i</span></span></span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span class="bound"><span class="entity"><span>f</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>j</span></span></span></span><span class="main"><span>)</span></span><span> </span><span class="keyword1"><span>else</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>f</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>k</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="Median.sort_map.elims|fact"><span class="entity_def" id="Median.sort_map.induct|fact"><span class="entity_def" id="Median.sort_map.simps|fact"><span class="entity_def" id="Median.sort_map.pelims|fact"><span class="entity_def" id="Median.sort_map.cases|fact"><span class="entity_def" id="Median.sort_map.termination|fact"><span class="entity_def" id="Median.sort_map.pinduct|fact"><span class="entity_def" id="Median.sort_map.psimps|fact"><span class="entity_def" id="Median.sort_map_rel.inducts|fact"><span class="entity_def" id="Median.sort_map_rel.simps|fact"><span class="entity_def" id="Median.sort_map_rel.induct|fact"><span class="entity_def" id="Median.sort_map_rel.cases|fact"><span class="entity_def" id="Median.sort_map_rel.intros|fact"><span class="entity_def" id="Median.sort_map_graph.inducts|fact"><span class="entity_def" id="Median.sort_map_graph.simps|fact"><span class="entity_def" id="Median.sort_map_graph.induct|fact"><span class="entity_def" id="Median.sort_map_graph.cases|fact"><span class="entity_def" id="Median.sort_map_graph.intros|fact"><span class="entity_def" id="Median.sort_map.elims|thm"><span class="entity_def" id="Median.sort_map.induct|thm"><span class="entity_def" id="Median.sort_map.simps|thm"><span class="entity_def" id="Median.sort_map.pelims|thm"><span class="entity_def" id="Median.sort_map.cases|thm"><span class="entity_def" id="Median.sort_map.termination|thm"><span class="entity_def" id="Median.sort_map.pinduct|thm"><span class="entity_def" id="Median.sort_map.psimps|thm"><span class="entity_def" id="Median.sort_map_rel.inducts|thm"><span class="entity_def" id="Median.sort_map_rel.simps|thm"><span class="entity_def" id="Median.sort_map_rel.induct|thm"><span class="entity_def" id="Median.sort_map_rel.cases|thm"><span class="entity_def" id="Median.sort_map_graph.inducts|thm"><span class="entity_def" id="Median.sort_map_graph.simps|thm"><span class="entity_def" id="Median.sort_map_graph.induct|thm"><span class="entity_def" id="Median.sort_map_graph.cases|thm"><span class="entity_def" id="Median.sort_map_graph.intros|thm"><span class="entity_def" id="Median.sort_map_def|axiom"><span class="entity_def" id="Median.sort_map_rel_def|axiom"><span class="entity_def" id="Median.sort_map_sumC_def|axiom"><span class="entity_def" id="Median.sort_map_graph_def|axiom"><span class="entity_def" id="Median.sort_map_dom|const"><span class="entity_def" id="Median.sort_map_rel|const"><span class="entity_def" id="Median.sort_map_sumC|const"><span class="entity_def" id="Median.sort_map_graph|const"><span>fun</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span> </span><span class="entity"><span class="entity_def" id="Median.sort_map|const"><span>sort_map</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span>
  </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>sort_map</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>f</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>n</span></span></span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fold</span><span> </span><span>id</span><span> </span><span class="main"><span>[</span></span><a class="entity_ref" href="Median.html#Median.sort_primitive|const"><span>sort_primitive</span></a><span> </span><span class="bound"><span>j</span></span><span> </span><span class="bound"><span>i</span></span><span class="main"><span>.</span></span><span> i </span><span class="main"><span>&lt;-</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>0</span></span><span class="main"><span>..&lt;</span></span><span class="free"><span class="bound"><span class="entity"><span>n</span></span></span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> j </span><span class="main"><span>&lt;-</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>0</span></span><span class="main"><span>..&lt;</span></span><span class="bound"><span>i</span></span><span class="main"><span>]</span></span><span class="main"><span>]</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>f</span></span></span></span><span>"</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Median.sort_map_ind|fact"><span class="entity_def" id="Median.sort_map_ind|thm"><span>sort_map_ind</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Median.html#Median.sort_map|const"><span>sort_map</span></a><span> </span><span class="free"><span>f</span></span><span> </span><span class="main"><span>(</span></span><span>Suc</span><span> </span><span class="free"><span>n</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>fold</span><span> </span><span>id</span><span> </span><span class="main"><span>[</span></span><a class="entity_ref" href="Median.html#Median.sort_primitive|const"><span>sort_primitive</span></a><span> </span><span class="bound"><span>j</span></span><span> </span><span class="free"><span>n</span></span><span class="main"><span>.</span></span><span> j </span><span class="main"><span>&lt;-</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>0</span></span><span class="main"><span>..&lt;</span></span><span class="free"><span>n</span></span><span class="main"><span>]</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Median.html#Median.sort_map|const"><span>sort_map</span></a><span> </span><span class="free"><span>f</span></span><span> </span><span class="free"><span>n</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp</span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Median.sort_map_strict_mono|fact"><span class="entity_def" id="Median.sort_map_strict_mono|thm"><span>sort_map_strict_mono</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>fixes</span></span></span><span> </span><span class="free"><span>f</span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span>nat</span><span> </span><span class="main"><span>â</span></span><span> </span><span class="tfree"><span>'b</span></span><span> </span><span class="main"><span>::</span></span><span> </span><span>linorder</span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>j</span></span><span> </span><span class="main"><span>&lt;</span></span><span> </span><span class="free"><span>n</span></span><span> </span><span class="main"><span>â¹</span></span><span> </span><span class="free"><span>i</span></span><span> </span><span class="main"><span>&lt;</span></span><span> </span><span class="free"><span>j</span></span><span> </span><span class="main"><span>â¹</span></span><span> </span><a class="entity_ref" href="Median.html#Median.sort_map|const"><span>sort_map</span></a><span> </span><span class="free"><span>f</span></span><span> </span><span class="free"><span>n</span></span><span> </span><span class="free"><span>i</span></span><span> </span><span class="main"><span>â¤</span></span><span> </span><a class="entity_ref" href="Median.html#Median.sort_map|const"><span>sort_map</span></a><span> </span><span class="free"><span>f</span></span><span> </span><span class="free"><span>n</span></span><span> </span><span class="free"><span>j</span></span><span>"</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>induction</span></span><span> </span><span class="quoted"><span class="free"><span>n</span></span></span><span> </span><span class="quasi_keyword"><span>arbitrary</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><span class="quoted"><span class="free"><span>i</span></span></span><span> </span><span class="quoted"><span class="free"><span>j</span></span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span>0</span><span>
  </span><span class="keyword1"><span class="command"><span>then</span></span></span><span> </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?case</span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp</span></span><span>
</span><span class="keyword1"><span class="command"><span>next</span></span></span><span>
  </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity_def" id="offset_5268..5271">Suc</span><span> </span><span class="skolem"><span>n</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword3"><span class="command"><span class="entity_def" id="offset_5277..5283">define</span></span></span><span> </span><span class="skolem"><span class="skolem"><span>g</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="skolem"><span>g</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>Î»</span></span><span class="bound"><span>k</span></span><span class="main"><span>.</span></span><span> </span><span>fold</span><span> </span><span>id</span><span> </span><span class="main"><span>[</span></span><a class="entity_ref" href="Median.html#Median.sort_primitive|const"><span>sort_primitive</span></a><span> </span><span class="bound"><span>j</span></span><span> </span><span class="skolem"><span>n</span></span><span class="main"><span>.</span></span><span> j </span><span class="main"><span>&lt;-</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>0</span></span><span class="main"><span>..&lt;</span></span><span class="bound"><span>k</span></span><span class="main"><span>]</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Median.html#Median.sort_map|const"><span>sort_map</span></a><span> </span><span class="free"><span>f</span></span><span> </span><span class="skolem"><span>n</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword3"><span class="command"><span class="entity_def" id="offset_5364..5370">define</span></span></span><span> </span><span class="skolem"><span class="skolem"><span>k</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="skolem"><span>k</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="skolem"><span>n</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span>a</span><span class="main"><span>:</span></span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="main"><span>â</span></span><span class="bound"><span>i</span></span><span> </span><span class="bound"><span>j</span></span><span class="main"><span>.</span></span><span> </span><span class="bound"><span>j</span></span><span> </span><span class="main"><span>&lt;</span></span><span> </span><span class="skolem"><span>n</span></span><span> </span><span class="main"><span>â¶</span></span><span> </span><span class="bound"><span>i</span></span><span> </span><span class="main"><span>&lt;</span></span><span> </span><span class="bound"><span>j</span></span><span> </span><span class="main"><span>â¶</span></span><span> </span><span class="skolem"><span>g</span></span><span> </span><span class="skolem"><span>k</span></span><span> </span><span class="bound"><span>i</span></span><span> </span><span class="main"><span>â¤</span></span><span> </span><span class="skolem"><span>g</span></span><span> </span><span class="skolem"><span>k</span></span><span> </span><span class="bound"><span>j</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>â§</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>â</span></span><span class="bound"><span>l</span></span><span class="main"><span>.</span></span><span> </span><span class="bound"><span>l</span></span><span> </span><span class="main"><span>&lt;</span></span><span> </span><span class="skolem"><span>k</span></span><span> </span><span class="main"><span>â¶</span></span><span> </span><span class="skolem"><span>g</span></span><span> </span><span class="skolem"><span>k</span></span><span> </span><span class="bound"><span>l</span></span><span> </span><span class="main"><span>â¤</span></span><span> </span><span class="skolem"><span>g</span></span><span> </span><span class="skolem"><span>k</span></span><span> </span><span class="skolem"><span>n</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>induction</span></span><span> </span><span class="quoted"><span class="skolem"><span>k</span></span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span>0</span><span>
    </span><span class="keyword1"><span class="command"><span>then</span></span></span><span> </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?case</span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Median.html#offset_5268..5271"><span>Suc</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><a class="entity_ref" href="Median.html#offset_5277..5283"><span>g_def</span></a><span> </span><span class="quasi_keyword"><span>del</span></span><span class="main"><span class="main"><span>:</span></span></span><a class="entity_ref" href="Median.html#Median.sort_map.simps|fact"><span>sort_map.simps</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>next</span></span></span><span>
    </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity_def" id="offset_5585..5588">Suc</span><span> </span><span class="skolem"><span>k</span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="skolem"><span>g</span></span><span> </span><span class="main"><span>(</span></span><span>Suc</span><span> </span><span class="skolem"><span>k</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><a class="entity_ref" href="Median.html#Median.sort_primitive|const"><span>sort_primitive</span></a><span> </span><span class="skolem"><span>k</span></span><span> </span><span class="skolem"><span>n</span></span><span> </span><span class="main"><span>(</span></span><span class="skolem"><span>g</span></span><span> </span><span class="skolem"><span>k</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span> 
      </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><a class="entity_ref" href="Median.html#offset_5277..5283"><span>g_def</span></a><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span>then</span></span></span><span> </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?case</span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Median.html#offset_5585..5588"><span>Suc</span></a><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>cases</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="skolem"><span>g</span></span><span> </span><span class="skolem"><span>k</span></span><span> </span><span class="skolem"><span>k</span></span><span> </span><span class="main"><span>â¤</span></span><span> </span><span class="skolem"><span>g</span></span><span> </span><span class="skolem"><span>k</span></span><span> </span><span class="skolem"><span>n</span></span><span>"</span></span></span><span class="main"><span>)</span></span><span>
       </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span>min_def</span><span> </span><span>max_def</span><span class="main"><span>)</span></span><span>
       </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><span>less_antisym</span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="operator"><span>blast</span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>cases</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="skolem"><span>g</span></span><span> </span><span class="skolem"><span>k</span></span><span> </span><span class="skolem"><span>n</span></span><span> </span><span class="main"><span>â¤</span></span><span> </span><span class="skolem"><span>g</span></span><span> </span><span class="skolem"><span>k</span></span><span> </span><span class="skolem"><span>k</span></span><span>"</span></span></span><span class="main"><span>)</span></span><span>
       </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span>min_def</span><span> </span><span>max_def</span><span class="main"><span>)</span></span><span>
       </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>metis</span></span><span> </span><span>less_antisym</span><span> </span><span>max.coboundedI2</span><span> </span><span>max.orderE</span><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp</span></span><span>
  </span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>

  </span><span class="keyword1"><span class="command"><span>hence</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>â</span></span><span class="bound"><span>i</span></span><span> </span><span class="bound"><span>j</span></span><span class="main"><span>.</span></span><span> </span><span class="bound"><span>j</span></span><span> </span><span class="main"><span>&lt;</span></span><span> </span><span>Suc</span><span> </span><span class="skolem"><span>n</span></span><span> </span><span class="main"><span>â¹</span></span><span> </span><span class="bound"><span>i</span></span><span> </span><span class="main"><span>&lt;</span></span><span> </span><span class="bound"><span>j</span></span><span> </span><span class="main"><span>â¹</span></span><span> </span><span class="skolem"><span>g</span></span><span> </span><span class="skolem"><span>n</span></span><span> </span><span class="bound"><span>i</span></span><span> </span><span class="main"><span>â¤</span></span><span> </span><span class="skolem"><span>g</span></span><span> </span><span class="skolem"><span>n</span></span><span> </span><span class="bound"><span>j</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><a class="entity_ref" href="Median.html#offset_5364..5370"><span>k_def</span></a><span class="main"><span>)</span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><span>less_antisym</span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>blast</span></span><span>
  </span><span class="keyword1"><span class="command"><span>moreover</span></span></span><span> </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Median.html#Median.sort_map|const"><span>sort_map</span></a><span> </span><span class="free"><span>f</span></span><span> </span><span class="main"><span>(</span></span><span>Suc</span><span> </span><span class="skolem"><span>n</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="skolem"><span>g</span></span><span> </span><span class="skolem"><span>n</span></span><span>"</span></span></span><span> 
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><a class="entity_ref" href="Median.html#Median.sort_map_ind|fact"><span>sort_map_ind</span></a><span> </span><a class="entity_ref" href="Median.html#offset_5277..5283"><span>g_def</span></a><span> </span><span class="quasi_keyword"><span>del</span></span><span class="main"><span class="main"><span>:</span></span></span><a class="entity_ref" href="Median.html#Median.sort_map.simps|fact"><span>sort_map.simps</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>ultimately</span></span></span><span> </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?case</span></span></span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>del</span></span><span class="main"><span class="main"><span>:</span></span></span><a class="entity_ref" href="Median.html#Median.sort_map.simps|fact"><span>sort_map.simps</span></a><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Median.html#offset_5268..5271"><span>Suc</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>blast</span></span><span>
</span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Median.sort_map_mono|fact"><span class="entity_def" id="Median.sort_map_mono|thm"><span>sort_map_mono</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>fixes</span></span></span><span> </span><span class="free"><span>f</span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span>nat</span><span> </span><span class="main"><span>â</span></span><span> </span><span class="tfree"><span>'b</span></span><span> </span><span class="main"><span>::</span></span><span> </span><span>linorder</span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>j</span></span><span> </span><span class="main"><span>&lt;</span></span><span> </span><span class="free"><span>n</span></span><span> </span><span class="main"><span>â¹</span></span><span> </span><span class="free"><span>i</span></span><span> </span><span class="main"><span>â¤</span></span><span> </span><span class="free"><span>j</span></span><span> </span><span class="main"><span>â¹</span></span><span> </span><a class="entity_ref" href="Median.html#Median.sort_map|const"><span>sort_map</span></a><span> </span><span class="free"><span>f</span></span><span> </span><span class="free"><span>n</span></span><span> </span><span class="free"><span>i</span></span><span> </span><span class="main"><span>â¤</span></span><span> </span><a class="entity_ref" href="Median.html#Median.sort_map|const"><span>sort_map</span></a><span> </span><span class="free"><span>f</span></span><span> </span><span class="free"><span>n</span></span><span> </span><span class="free"><span>j</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>metis</span></span><span> </span><a class="entity_ref" href="Median.html#Median.sort_map_strict_mono|fact"><span>sort_map_strict_mono</span></a><span> </span><span>eq_iff</span><span> </span><span>le_imp_less_or_eq</span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Median.sort_map_perm|fact"><span class="entity_def" id="Median.sort_map_perm|thm"><span>sort_map_perm</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>fixes</span></span></span><span> </span><span class="free"><span>f</span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span>nat</span><span> </span><span class="main"><span>â</span></span><span> </span><span class="tfree"><span>'b</span></span><span> </span><span class="main"><span>::</span></span><span> </span><span>linorder</span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span>image_mset</span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Median.html#Median.sort_map|const"><span>sort_map</span></a><span> </span><span class="free"><span>f</span></span><span> </span><span class="free"><span>n</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>mset</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>0</span></span><span class="main"><span>..&lt;</span></span><span class="free"><span>n</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>image_mset</span><span> </span><span class="free"><span>f</span></span><span> </span><span class="main"><span>(</span></span><span>mset</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>0</span></span><span class="main"><span>..&lt;</span></span><span class="free"><span>n</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="operator"><span>-</span></span><span>
  </span><span class="keyword3"><span class="command"><span class="entity_def" id="offset_6585..6591">define</span></span></span><span> </span><span class="skolem"><span class="skolem"><span>is_swap</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="skolem"><span>is_swap</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>Î»</span></span><span class="main"><span>(</span></span><span class="bound"><span>ts</span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span>nat</span><span> </span><span class="main"><span>â</span></span><span> </span><span class="tfree"><span>'b</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>â</span></span><span> </span><span>nat</span><span> </span><span class="main"><span>â</span></span><span> </span><span class="tfree"><span>'b</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>â</span></span><span class="bound"><span class="bound"><span>i</span></span></span><span> </span><span class="main"><span>&lt;</span></span><span> </span><span class="free"><span>n</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>â</span></span><span class="bound"><span class="bound"><span>j</span></span></span><span> </span><span class="main"><span>&lt;</span></span><span> </span><span class="free"><span>n</span></span><span class="main"><span>.</span></span><span> </span><span class="bound"><span>ts</span></span><span> </span><span class="main"><span>=</span></span><span> </span><a class="entity_ref" href="Median.html#Median.sort_primitive|const"><span>sort_primitive</span></a><span> </span><span class="bound"><span>i</span></span><span> </span><span class="bound"><span>j</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword3"><span class="command"><span class="entity_def" id="offset_6696..6702">define</span></span></span><span> </span><span class="skolem"><span class="skolem"><span>t</span></span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span>nat</span><span> </span><span class="main"><span>â</span></span><span> </span><span class="tfree"><span>'b</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>â</span></span><span> </span><span>nat</span><span> </span><span class="main"><span>â</span></span><span> </span><span class="tfree"><span>'b</span></span><span class="main"><span>)</span></span><span> </span><span>list</span><span>"</span></span></span><span> 
    </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="skolem"><span>t</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>[</span></span><a class="entity_ref" href="Median.html#Median.sort_primitive|const"><span>sort_primitive</span></a><span> </span><span class="bound"><span>j</span></span><span> </span><span class="bound"><span>i</span></span><span class="main"><span>.</span></span><span> i </span><span class="main"><span>&lt;-</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>0</span></span><span class="main"><span>..&lt;</span></span><span class="free"><span>n</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> j </span><span class="main"><span>&lt;-</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>0</span></span><span class="main"><span>..&lt;</span></span><span class="bound"><span>i</span></span><span class="main"><span>]</span></span><span class="main"><span>]</span></span><span>"</span></span></span><span>

  </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="entity_def" id="offset_6813..6814">a</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>â</span></span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>f</span></span><span class="main"><span>.</span></span><span> </span><span class="skolem"><span>is_swap</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="main"><span>â¹</span></span><span> </span><span>image_mset</span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>f</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>mset_set</span><span> </span><span class="main"><span>{</span></span><span class="main"><span>0</span></span><span class="main"><span>..&lt;</span></span><span class="free"><span>n</span></span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>image_mset</span><span> </span><span class="bound"><span>f</span></span><span> </span><span class="main"><span>(</span></span><span>mset_set</span><span> </span><span class="main"><span>{</span></span><span class="main"><span>0</span></span><span class="main"><span>..&lt;</span></span><span class="free"><span>n</span></span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="operator"><span>-</span></span><span>
    </span><span class="keyword3"><span class="command"><span>fix</span></span></span><span> </span><span class="skolem"><span>x</span></span><span>
    </span><span class="keyword3"><span class="command"><span>fix</span></span></span><span> </span><span class="skolem"><span>f</span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span>nat</span><span> </span><span class="main"><span>â</span></span><span> </span><span class="tfree"><span>'b</span></span><span> </span><span class="main"><span>::</span></span><span> </span><span>linorder</span><span>"</span></span></span><span>
    </span><span class="keyword3"><span class="command"><span>assume</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="skolem"><span>is_swap</span></span><span> </span><span class="skolem"><span>x</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>then</span></span></span><span> </span><span class="keyword3"><span class="command"><span>obtain</span></span></span><span> </span><span class="skolem"><span class="skolem"><span>i</span></span></span><span> </span><span class="skolem"><span class="skolem"><span>j</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span> </span><span class="entity_def" id="offset_7011..7016">x_def</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="skolem"><span>x</span></span><span> </span><span class="main"><span>=</span></span><span> </span><a class="entity_ref" href="Median.html#Median.sort_primitive|const"><span>sort_primitive</span></a><span> </span><span class="skolem"><span>i</span></span><span> </span><span class="skolem"><span>j</span></span><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity_def" id="offset_7047..7054">i_bound</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="skolem"><span>i</span></span><span> </span><span class="main"><span>&lt;</span></span><span> </span><span class="free"><span>n</span></span><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity_def" id="offset_7068..7075">j_bound</span><span class="main"><span>:</span></span><span class="quoted"><span class="quoted"><span>"</span><span class="skolem"><span>j</span></span><span> </span><span class="main"><span>&lt;</span></span><span> </span><span class="free"><span>n</span></span><span>"</span></span></span><span> 
      </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Median.html#offset_6585..6591"><span>is_swap_def</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>blast</span></span><span>
    </span><span class="keyword3"><span class="command"><span class="entity_def" id="offset_7122..7128">define</span></span></span><span> </span><span class="skolem"><span class="skolem"><span>inv</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="skolem"><span>inv</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>mset_set</span><span> </span><span class="main"><span>{</span></span><span class="bound"><span>k</span></span><span class="main"><span>.</span></span><span> </span><span class="bound"><span>k</span></span><span> </span><span class="main"><span>&lt;</span></span><span> </span><span class="free"><span>n</span></span><span> </span><span class="main"><span>â§</span></span><span> </span><span class="bound"><span>k</span></span><span> </span><span class="main"><span>â </span></span><span> </span><span class="skolem"><span>i</span></span><span> </span><span class="main"><span>â§</span></span><span> </span><span class="bound"><span>k</span></span><span> </span><span class="main"><span>â </span></span><span> </span><span class="skolem"><span>j</span></span><span class="main"><span>}</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="entity_def" id="offset_7192..7193">b</span><span class="main"><span>:</span></span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>{</span></span><span class="main"><span>0</span></span><span class="main"><span>..&lt;</span></span><span class="free"><span>n</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>{</span></span><span class="bound"><span>k</span></span><span class="main"><span>.</span></span><span> </span><span class="bound"><span>k</span></span><span> </span><span class="main"><span>&lt;</span></span><span> </span><span class="free"><span>n</span></span><span> </span><span class="main"><span>â§</span></span><span> </span><span class="bound"><span>k</span></span><span> </span><span class="main"><span>â </span></span><span> </span><span class="skolem"><span>i</span></span><span> </span><span class="main"><span>â§</span></span><span> </span><span class="bound"><span>k</span></span><span> </span><span class="main"><span>â </span></span><span> </span><span class="skolem"><span>j</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>âª</span></span><span> </span><span class="main"><span>{</span></span><span class="skolem"><span>i</span></span><span class="main"><span>,</span></span><span class="skolem"><span>j</span></span><span class="main"><span>}</span></span><span>"</span></span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>rule</span></span><span> </span><span>order_antisym</span><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><span class="operator"><span>rule</span></span><span> </span><span>subsetI</span><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><span class="operator"><span>simp</span></span><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><span class="operator"><span>blast</span></span><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><span class="operator"><span>rule</span></span><span> </span><span>subsetI</span><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><span class="operator"><span>simp</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Median.html#offset_7047..7054"><span>i_bound</span></a><span> </span><a class="entity_ref" href="Median.html#offset_7068..7075"><span>j_bound</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>meson</span></span><span>
    </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="entity_def" id="offset_7367..7368">c</span><span class="main"><span>:</span></span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>â</span></span><span class="bound"><span>k</span></span><span class="main"><span>.</span></span><span> </span><span class="bound"><span>k</span></span><span> </span><span class="main"><span>â#</span></span><span> </span><span class="skolem"><span>inv</span></span><span> </span><span class="main"><span>â¹</span></span><span> </span><span class="main"><span>(</span></span><span class="skolem"><span>x</span></span><span> </span><span class="skolem"><span>f</span></span><span class="main"><span>)</span></span><span> </span><span class="bound"><span>k</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="skolem"><span>f</span></span><span> </span><span class="bound"><span>k</span></span><span>"</span></span></span><span> 
      </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><a class="entity_ref" href="Median.html#offset_7011..7016"><span>x_def</span></a><span> </span><a class="entity_ref" href="Median.html#offset_7122..7128"><span>inv_def</span></a><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span>image_mset</span><span> </span><span class="main"><span>(</span></span><span class="skolem"><span>x</span></span><span> </span><span class="skolem"><span>f</span></span><span class="main"><span>)</span></span><span> </span><span class="skolem"><span>inv</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>image_mset</span><span> </span><span class="skolem"><span>f</span></span><span> </span><span class="skolem"><span>inv</span></span><span>"</span></span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>rule</span></span><span> </span><span>multiset_eqI</span><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Median.html#offset_7367..7368"><span>c</span></a><span> </span><span>multiset.map_cong0</span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>force</span></span><span>
    </span><span class="keyword1"><span class="command"><span>moreover</span></span></span><span> </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span>image_mset</span><span> </span><span class="main"><span>(</span></span><span class="skolem"><span>x</span></span><span> </span><span class="skolem"><span>f</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>mset_set</span><span> </span><span class="main"><span>{</span></span><span class="skolem"><span>i</span></span><span class="main"><span>,</span></span><span class="skolem"><span>j</span></span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>image_mset</span><span> </span><span class="skolem"><span>f</span></span><span> </span><span class="main"><span>(</span></span><span>mset_set</span><span> </span><span class="main"><span>{</span></span><span class="skolem"><span>i</span></span><span class="main"><span>,</span></span><span class="skolem"><span>j</span></span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>cases</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="skolem"><span>i</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="skolem"><span>j</span></span><span>"</span></span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><a class="entity_ref" href="Median.html#offset_7011..7016"><span>x_def</span></a><span> </span><span>max_def</span><span> </span><span>min_def</span><span class="main"><span>)</span></span><span class="main"><span class="keyword3"><span>+</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>moreover</span></span></span><span> </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span>mset_set</span><span> </span><span class="main"><span>{</span></span><span class="main"><span>0</span></span><span class="main"><span>..&lt;</span></span><span class="free"><span>n</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="skolem"><span>inv</span></span><span> </span><span class="main"><span>+</span></span><span> </span><span>mset_set</span><span> </span><span class="main"><span>{</span></span><span class="skolem"><span>i</span></span><span class="main"><span>,</span></span><span class="skolem"><span>j</span></span><span class="main"><span>}</span></span><span>"</span></span></span><span>
      </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>only</span></span><span class="main"><span class="main"><span>:</span></span></span><a class="entity_ref" href="Median.html#offset_7122..7128"><span>inv_def</span></a><span> </span><a class="entity_ref" href="Median.html#offset_7192..7193"><span>b</span></a><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><span class="operator"><span>rule</span></span><span> </span><span>mset_set_Union</span><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><span class="operator"><span>simp</span></span><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><span class="operator"><span>simp</span></span><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><span class="operator"><span>simp</span></span><span class="main"><span>)</span></span><span> 
    </span><span class="keyword1"><span class="command"><span>ultimately</span></span></span><span> </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span>image_mset</span><span> </span><span class="main"><span>(</span></span><span class="skolem"><span>x</span></span><span> </span><span class="skolem"><span>f</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>mset_set</span><span> </span><span class="main"><span>{</span></span><span class="main"><span>0</span></span><span class="main"><span>..&lt;</span></span><span class="free"><span>n</span></span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>image_mset</span><span> </span><span class="skolem"><span>f</span></span><span> </span><span class="main"><span>(</span></span><span>mset_set</span><span> </span><span class="main"><span>{</span></span><span class="main"><span>0</span></span><span class="main"><span>..&lt;</span></span><span class="free"><span>n</span></span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
      </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp</span></span><span>
  </span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>

  </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="main"><span>â</span></span><span class="bound"><span>x</span></span><span> </span><span class="main"><span>â</span></span><span> </span><span>set</span><span> </span><span class="skolem"><span>t</span></span><span class="main"><span>.</span></span><span> </span><span class="skolem"><span>is_swap</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>â¹</span></span><span> </span><span>image_mset</span><span> </span><span class="main"><span>(</span></span><span>fold</span><span> </span><span>id</span><span> </span><span class="skolem"><span>t</span></span><span> </span><span class="free"><span>f</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>mset</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>0</span></span><span class="main"><span>..&lt;</span></span><span class="free"><span>n</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>image_mset</span><span> </span><span class="free"><span>f</span></span><span> </span><span class="main"><span>(</span></span><span>mset</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>0</span></span><span class="main"><span>..&lt;</span></span><span class="free"><span>n</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>induction</span></span><span> </span><span class="quoted"><span class="skolem"><span>t</span></span></span><span> </span><span class="quasi_keyword"><span>arbitrary</span></span><span class="main"><span class="main"><span>:</span></span></span><span class="quoted"><span class="free"><span>f</span></span></span><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><span class="operator"><span>simp</span></span><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><a class="entity_ref" href="Median.html#offset_6813..6814"><span>a</span></a><span class="main"><span>)</span></span><span> 
  </span><span class="keyword1"><span class="command"><span>moreover</span></span></span><span> </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>â</span></span><span class="bound"><span>x</span></span><span class="main"><span>.</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="main"><span>â</span></span><span> </span><span>set</span><span> </span><span class="skolem"><span>t</span></span><span> </span><span class="main"><span>â¹</span></span><span> </span><span class="skolem"><span>is_swap</span></span><span> </span><span class="bound"><span>x</span></span><span>"</span></span></span><span> 
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><a class="entity_ref" href="Median.html#offset_6696..6702"><span>t_def</span></a><span> </span><a class="entity_ref" href="Median.html#offset_6585..6591"><span>is_swap_def</span></a><span class="main"><span>)</span></span><span> 
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>meson</span></span><span> </span><span>atLeastLessThan_iff</span><span> </span><span>imageE</span><span> </span><span>less_imp_le</span><span> </span><span>less_le_trans</span><span class="main"><span>)</span></span><span>  
  </span><span class="keyword1"><span class="command"><span>ultimately</span></span></span><span> </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span>image_mset</span><span> </span><span class="main"><span>(</span></span><span>fold</span><span> </span><span>id</span><span> </span><span class="skolem"><span>t</span></span><span> </span><span class="free"><span>f</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>mset</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>0</span></span><span class="main"><span>..&lt;</span></span><span class="free"><span>n</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>image_mset</span><span> </span><span class="free"><span>f</span></span><span> </span><span class="main"><span>(</span></span><span>mset</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>0</span></span><span class="main"><span>..&lt;</span></span><span class="free"><span>n</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>blast</span></span><span>
  </span><span class="keyword1"><span class="command"><span>then</span></span></span><span> </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?thesis</span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><a class="entity_ref" href="Median.html#offset_6696..6702"><span>t_def</span></a><span class="main"><span>)</span></span><span>
</span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_8417..8422">lemma</span></span></span><span> </span><span class="entity_def" id="Median.list_eq_iff|fact"><span class="entity_def" id="Median.list_eq_iff|thm"><span>list_eq_iff</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span>mset</span><span> </span><span class="free"><span>xs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>mset</span><span> </span><span class="free"><span>ys</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span>sorted</span><span> </span><span class="free"><span>xs</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span>sorted</span><span> </span><span class="free"><span>ys</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>xs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="free"><span>ys</span></span><span>"</span></span></span><span> 
  </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Median.html#offset_8417..8422"><span>assms</span></a><span> </span><span>properties_for_sort</span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>blast</span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Median.sort_map_eq_sort|fact"><span class="entity_def" id="Median.sort_map_eq_sort|thm"><span>sort_map_eq_sort</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>fixes</span></span></span><span> </span><span class="free"><span>f</span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span>nat</span><span> </span><span class="main"><span>â</span></span><span> </span><span class="main"><span>(</span></span><span class="tfree"><span>'b</span></span><span> </span><span class="main"><span>::</span></span><span> </span><span>linorder</span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span>map</span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Median.html#Median.sort_map|const"><span>sort_map</span></a><span> </span><span class="free"><span>f</span></span><span> </span><span class="free"><span>n</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>0</span></span><span class="main"><span>..&lt;</span></span><span class="free"><span>n</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>sort</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="free"><span>f</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>0</span></span><span class="main"><span>..&lt;</span></span><span class="free"><span>n</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>is</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="var"><span>?A</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="var"><span>?B</span></span><span>"</span></span></span><span class="main"><span>)</span></span><span>
</span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="operator"><span>-</span></span><span>
  </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span>mset</span><span> </span><span class="var"><span>?A</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>mset</span><span> </span><span class="var"><span>?B</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Median.html#Median.sort_map_perm|fact"><span>sort_map_perm</span></a><span class="main"><span>[</span></span><span class="keyword2"><span class="keyword"><span class="operator"><span>where</span></span></span></span><span> f</span><span class="main"><span class="main"><span>=</span></span></span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>f</span></span><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span>and</span></span></span></span><span> n</span><span class="main"><span class="main"><span>=</span></span></span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>n</span></span><span>"</span></span></span><span class="main"><span>]</span></span><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>del</span></span><span class="main"><span class="main"><span>:</span></span></span><a class="entity_ref" href="Median.html#Median.sort_map.simps|fact"><span>sort_map.simps</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>moreover</span></span></span><span> </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span>sorted</span><span> </span><span class="var"><span>?B</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp</span></span><span>
  </span><span class="keyword1"><span class="command"><span>moreover</span></span></span><span> </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span>sorted</span><span> </span><span class="var"><span>?A</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>subst</span></span><span> </span><span>sorted_wrt_iff_nth_less</span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>del</span></span><span class="main"><span class="main"><span>:</span></span></span><a class="entity_ref" href="Median.html#Median.sort_map.simps|fact"><span>sort_map.simps</span></a><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>metis</span></span><span> </span><a class="entity_ref" href="Median.html#Median.sort_map_mono|fact"><span>sort_map_mono</span></a><span> </span><span>nat_less_le</span><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>ultimately</span></span></span><span> </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="var"><span>?A</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="var"><span>?B</span></span><span>"</span></span></span><span> 
    </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Median.html#Median.list_eq_iff|fact"><span>list_eq_iff</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>blast</span></span><span>
</span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_9077..9082">lemma</span></span></span><span> </span><span class="entity_def" id="Median.order_statistics_measurable_aux|fact"><span class="entity_def" id="Median.order_statistics_measurable_aux|thm"><span>order_statistics_measurable_aux</span></span></span><span class="main"><span>:</span></span><span> 
  </span><span class="keyword2"><span class="keyword"><span>fixes</span></span></span><span> </span><span class="free"><span>X</span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span>nat</span><span> </span><span class="main"><span>â</span></span><span> </span><span class="tfree"><span>'a</span></span><span> </span><span class="main"><span>â</span></span><span> </span><span class="main"><span>(</span></span><span class="tfree"><span>'b</span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="main"><span>{</span></span><span>linorder_topology</span><span class="main"><span>,</span></span><span> </span><span>second_countable_topology</span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>n</span></span><span> </span><span class="main"><span>â¥</span></span><span> </span><span class="main"><span>1</span></span><span>"</span></span></span><span> 
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>j</span></span><span> </span><span class="main"><span>&lt;</span></span><span> </span><span class="free"><span>n</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>â</span></span><span class="bound"><span>i</span></span><span class="main"><span>.</span></span><span> </span><span class="bound"><span>i</span></span><span> </span><span class="main"><span>&lt;</span></span><span> </span><span class="free"><span>n</span></span><span> </span><span class="main"><span>â¹</span></span><span> </span><span class="free"><span>X</span></span><span> </span><span class="bound"><span>i</span></span><span> </span><span class="main"><span>â</span></span><span> </span><span>measurable</span><span> </span><span class="free"><span>M</span></span><span> </span><span>borel</span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="main"><span>Î»</span></span><span class="bound"><span>x</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Median.html#Median.sort_map|const"><span>sort_map</span></a><span> </span><span class="main"><span>(</span></span><span class="main"><span>Î»</span></span><span class="bound"><span>i</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>X</span></span><span> </span><span class="bound"><span>i</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span class="free"><span>n</span></span><span class="main"><span>)</span></span><span> </span><span class="free"><span>j</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>â</span></span><span> </span><span>measurable</span><span> </span><span class="free"><span>M</span></span><span> </span><span>borel</span><span>"</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="operator"><span>-</span></span><span>
  </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span>n_ge_0</span><span class="main"><span>:</span></span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>n</span></span><span> </span><span class="main"><span>&gt;</span></span><span> </span><span class="main"><span>0</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Median.html#offset_9077..9082"><span>assms</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp</span></span><span>
  </span><span class="keyword3"><span class="command"><span class="entity_def" id="offset_9400..9406">define</span></span></span><span> </span><span class="skolem"><span class="skolem"><span>is_swap</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="skolem"><span>is_swap</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>Î»</span></span><span class="main"><span>(</span></span><span class="bound"><span>ts</span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span>nat</span><span> </span><span class="main"><span>â</span></span><span> </span><span class="tfree"><span>'b</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>â</span></span><span> </span><span>nat</span><span> </span><span class="main"><span>â</span></span><span> </span><span class="tfree"><span>'b</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>â</span></span><span class="bound"><span class="bound"><span>i</span></span></span><span> </span><span class="main"><span>&lt;</span></span><span> </span><span class="free"><span>n</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>â</span></span><span class="bound"><span class="bound"><span>j</span></span></span><span> </span><span class="main"><span>&lt;</span></span><span> </span><span class="free"><span>n</span></span><span class="main"><span>.</span></span><span> </span><span class="bound"><span>ts</span></span><span> </span><span class="main"><span>=</span></span><span> </span><a class="entity_ref" href="Median.html#Median.sort_primitive|const"><span>sort_primitive</span></a><span> </span><span class="bound"><span>i</span></span><span> </span><span class="bound"><span>j</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword3"><span class="command"><span class="entity_def" id="offset_9511..9517">define</span></span></span><span> </span><span class="skolem"><span class="skolem"><span>t</span></span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span>nat</span><span> </span><span class="main"><span>â</span></span><span> </span><span class="tfree"><span>'b</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>â</span></span><span> </span><span>nat</span><span> </span><span class="main"><span>â</span></span><span> </span><span class="tfree"><span>'b</span></span><span class="main"><span>)</span></span><span> </span><span>list</span><span>"</span></span></span><span> 
    </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="skolem"><span>t</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>[</span></span><a class="entity_ref" href="Median.html#Median.sort_primitive|const"><span>sort_primitive</span></a><span> </span><span class="bound"><span>j</span></span><span> </span><span class="bound"><span>i</span></span><span class="main"><span>.</span></span><span> i </span><span class="main"><span>&lt;-</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>0</span></span><span class="main"><span>..&lt;</span></span><span class="free"><span>n</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> j </span><span class="main"><span>&lt;-</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>0</span></span><span class="main"><span>..&lt;</span></span><span class="bound"><span>i</span></span><span class="main"><span>]</span></span><span class="main"><span>]</span></span><span>"</span></span></span><span>

  </span><span class="keyword3"><span class="command"><span class="entity_def" id="offset_9623..9629">define</span></span></span><span> </span><span class="skolem"><span class="skolem"><span>meas_ptw</span></span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span>nat</span><span> </span><span class="main"><span>â</span></span><span> </span><span class="tfree"><span>'a</span></span><span> </span><span class="main"><span>â</span></span><span> </span><span class="tfree"><span>'b</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>â</span></span><span> </span><span>bool</span><span>"</span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="skolem"><span>meas_ptw</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>Î»</span></span><span class="bound"><span>f</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>â</span></span><span class="bound"><span>k</span></span><span class="main"><span>.</span></span><span> </span><span class="bound"><span>k</span></span><span> </span><span class="main"><span>&lt;</span></span><span> </span><span class="free"><span>n</span></span><span> </span><span class="main"><span>â¶</span></span><span> </span><span class="bound"><span>f</span></span><span> </span><span class="bound"><span>k</span></span><span> </span><span class="main"><span>â</span></span><span> </span><span>borel_measurable</span><span> </span><span class="free"><span>M</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>

  </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="entity_def" id="offset_9743..9751">ind_step</span><span class="main"><span>:</span></span><span>
    </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>â</span></span><span class="bound"><span>x</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>g</span></span><span> </span><span class="main"><span>::</span></span><span> </span><span>nat</span><span> </span><span class="main"><span>â</span></span><span> </span><span class="tfree"><span>'a</span></span><span> </span><span class="main"><span>â</span></span><span> </span><span class="tfree"><span>'b</span></span><span class="main"><span>)</span></span><span class="main"><span>.</span></span><span> </span><span class="skolem"><span>meas_ptw</span></span><span> </span><span class="bound"><span>g</span></span><span> </span><span class="main"><span>â¹</span></span><span> </span><span class="skolem"><span>is_swap</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="main"><span>â¹</span></span><span> </span><span class="skolem"><span>meas_ptw</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>Î»</span></span><span class="bound"><span>k</span></span><span> </span><span class="bound"><span>Ï</span></span><span class="main"><span>.</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>Î»</span></span><span class="bound"><span>i</span></span><span class="main"><span>.</span></span><span> </span><span class="bound"><span>g</span></span><span> </span><span class="bound"><span>i</span></span><span> </span><span class="bound"><span>Ï</span></span><span class="main"><span>)</span></span><span> </span><span class="bound"><span>k</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="operator"><span>-</span></span><span>
    </span><span class="keyword3"><span class="command"><span>fix</span></span></span><span> </span><span class="skolem"><span>x</span></span><span> </span><span class="skolem"><span>g</span></span><span>
    </span><span class="keyword3"><span class="command"><span>assume</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="skolem"><span>meas_ptw</span></span><span> </span><span class="skolem"><span>g</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>hence</span></span></span><span> </span><span class="entity_def" id="offset_9898..9899">a</span><span class="main"><span>:</span></span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>â</span></span><span class="bound"><span>k</span></span><span class="main"><span>.</span></span><span> </span><span class="bound"><span>k</span></span><span> </span><span class="main"><span>&lt;</span></span><span> </span><span class="free"><span>n</span></span><span> </span><span class="main"><span>â¹</span></span><span> </span><span class="skolem"><span>g</span></span><span> </span><span class="bound"><span>k</span></span><span> </span><span class="main"><span>â</span></span><span> </span><span>borel_measurable</span><span> </span><span class="free"><span>M</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><a class="entity_ref" href="Median.html#offset_9623..9629"><span>meas_ptw_def</span></a><span class="main"><span>)</span></span><span>
    </span><span class="keyword3"><span class="command"><span>assume</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="skolem"><span>is_swap</span></span><span> </span><span class="skolem"><span>x</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>then</span></span></span><span> </span><span class="keyword3"><span class="command"><span>obtain</span></span></span><span> </span><span class="skolem"><span class="skolem"><span>i</span></span></span><span> </span><span class="skolem"><span class="skolem"><span>j</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span> </span><span class="entity_def" id="offset_10015..10020">x_def</span><span class="main"><span>:</span></span><span class="quoted"><span class="quoted"><span>"</span><span class="skolem"><span>x</span></span><span class="main"><span>=</span></span><a class="entity_ref" href="Median.html#Median.sort_primitive|const"><span>sort_primitive</span></a><span> </span><span class="skolem"><span>i</span></span><span> </span><span class="skolem"><span>j</span></span><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity_def" id="offset_10048..10052">i_le</span><span class="main"><span>:</span></span><span class="quoted"><span class="quoted"><span>"</span><span class="skolem"><span>i</span></span><span> </span><span class="main"><span>&lt;</span></span><span> </span><span class="free"><span>n</span></span><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity_def" id="offset_10065..10069">j_le</span><span class="main"><span>:</span></span><span class="quoted"><span class="quoted"><span>"</span><span class="skolem"><span>j</span></span><span> </span><span class="main"><span>&lt;</span></span><span> </span><span class="free"><span>n</span></span><span>"</span></span></span><span>
      </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><a class="entity_ref" href="Median.html#offset_9400..9406"><span>is_swap_def</span></a><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><span class="operator"><span>blast</span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>â</span></span><span class="bound"><span>k</span></span><span class="main"><span>.</span></span><span> </span><span class="bound"><span>k</span></span><span> </span><span class="main"><span>&lt;</span></span><span> </span><span class="free"><span>n</span></span><span> </span><span class="main"><span>â¹</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>Î»</span></span><span class="bound"><span>Ï</span></span><span class="main"><span>.</span></span><span> </span><span class="skolem"><span>x</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>Î»</span></span><span class="bound"><span>i</span></span><span class="main"><span>.</span></span><span> </span><span class="skolem"><span>g</span></span><span> </span><span class="bound"><span>i</span></span><span> </span><span class="bound"><span>Ï</span></span><span class="main"><span>)</span></span><span> </span><span class="bound"><span>k</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>â</span></span><span> </span><span>borel_measurable</span><span> </span><span class="free"><span>M</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="operator"><span>-</span></span><span>
      </span><span class="keyword3"><span class="command"><span>fix</span></span></span><span> </span><span class="skolem"><span>k</span></span><span>
      </span><span class="keyword3"><span class="command"><span>assume</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="skolem"><span>k</span></span><span> </span><span class="main"><span>&lt;</span></span><span> </span><span class="free"><span>n</span></span><span>"</span></span></span><span>
      </span><span class="keyword3"><span class="command"><span>thus</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>Î»</span></span><span class="bound"><span>Ï</span></span><span class="main"><span>.</span></span><span> </span><span class="skolem"><span>x</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>Î»</span></span><span class="bound"><span>i</span></span><span class="main"><span>.</span></span><span> </span><span class="skolem"><span>g</span></span><span> </span><span class="bound"><span>i</span></span><span> </span><span class="bound"><span>Ï</span></span><span class="main"><span>)</span></span><span> </span><span class="skolem"><span>k</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>â</span></span><span> </span><span>borel_measurable</span><span> </span><span class="free"><span>M</span></span><span>"</span></span></span><span>
        </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><a class="entity_ref" href="Median.html#offset_10015..10020"><span>x_def</span></a><span class="main"><span>)</span></span><span>
        </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>cases</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="skolem"><span>k</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="skolem"><span>i</span></span><span>"</span></span></span><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><span class="operator"><span>simp</span></span><span class="main"><span>)</span></span><span>
        </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Median.html#offset_9898..9899"><span>a</span></a><span> </span><a class="entity_ref" href="Median.html#offset_10048..10052"><span>i_le</span></a><span> </span><a class="entity_ref" href="Median.html#offset_10065..10069"><span>j_le</span></a><span> </span><span>borel_measurable_min</span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="operator"><span>blast</span></span><span>
        </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>cases</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="skolem"><span>k</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="skolem"><span>j</span></span><span>"</span></span></span><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><span class="operator"><span>simp</span></span><span class="main"><span>)</span></span><span>
        </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Median.html#offset_9898..9899"><span>a</span></a><span> </span><a class="entity_ref" href="Median.html#offset_10048..10052"><span>i_le</span></a><span> </span><a class="entity_ref" href="Median.html#offset_10065..10069"><span>j_le</span></a><span> </span><span>borel_measurable_max</span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="operator"><span>blast</span></span><span>
        </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Median.html#offset_9898..9899"><span>a</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp</span></span><span>
    </span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>
    </span><span class="keyword3"><span class="command"><span>thus</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="skolem"><span>meas_ptw</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>Î»</span></span><span class="bound"><span>k</span></span><span> </span><span class="bound"><span>Ï</span></span><span class="main"><span>.</span></span><span> </span><span class="skolem"><span>x</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>Î»</span></span><span class="bound"><span>i</span></span><span class="main"><span>.</span></span><span> </span><span class="skolem"><span>g</span></span><span> </span><span class="bound"><span>i</span></span><span> </span><span class="bound"><span>Ï</span></span><span class="main"><span>)</span></span><span> </span><span class="bound"><span>k</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span> 
      </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><a class="entity_ref" href="Median.html#offset_9623..9629"><span>meas_ptw_def</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>

  </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="main"><span>â</span></span><span class="bound"><span>x</span></span><span> </span><span class="main"><span>â</span></span><span> </span><span>set</span><span> </span><span class="skolem"><span>t</span></span><span class="main"><span>.</span></span><span> </span><span class="skolem"><span>is_swap</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>â¹</span></span><span> </span><span class="skolem"><span>meas_ptw</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>Î»</span></span><span> </span><span class="bound"><span>k</span></span><span> </span><span class="bound"><span>Ï</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>(</span></span><span>fold</span><span> </span><span>id</span><span> </span><span class="skolem"><span>t</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>Î»</span></span><span class="bound"><span>k</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>X</span></span><span> </span><span class="bound"><span>k</span></span><span> </span><span class="bound"><span>Ï</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="bound"><span>k</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>induction</span></span><span> </span><span class="quoted"><span class="skolem"><span>t</span></span></span><span> </span><span class="quasi_keyword"><span>rule</span></span><span class="main"><span class="main"><span>:</span></span></span><span>rev_induct</span><span class="main"><span>)</span></span><span>
    </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span>Nil</span><span>
    </span><span class="keyword1"><span class="command"><span>then</span></span></span><span> </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?case</span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Median.html#offset_9077..9082"><span>assms</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><a class="entity_ref" href="Median.html#offset_9623..9629"><span>meas_ptw_def</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>next</span></span></span><span>
    </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity_def" id="offset_10829..10833">snoc</span><span> </span><span class="skolem"><span>x</span></span><span> </span><span class="skolem"><span>xs</span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="entity_def" id="offset_10849..10850">a</span><span class="main"><span>:</span></span><span class="quoted"><span class="quoted"><span>"</span><span class="skolem"><span>meas_ptw</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>Î»</span></span><span class="bound"><span>k</span></span><span> </span><span class="bound"><span>Ï</span></span><span class="main"><span>.</span></span><span> </span><span>fold</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>Î»</span></span><span class="bound"><span>a</span></span><span class="main"><span>.</span></span><span> </span><span class="bound"><span>a</span></span><span class="main"><span>)</span></span><span> </span><span class="skolem"><span>xs</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>Î»</span></span><span class="bound"><span>k</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>X</span></span><span> </span><span class="bound"><span>k</span></span><span> </span><span class="bound"><span>Ï</span></span><span class="main"><span>)</span></span><span> </span><span class="bound"><span>k</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Median.html#offset_10829..10833"><span>snoc</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp</span></span><span>
    </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="entity_def" id="offset_10928..10929">b</span><span class="main"><span>:</span></span><span class="quoted"><span class="quoted"><span>"</span><span class="skolem"><span>is_swap</span></span><span> </span><span class="skolem"><span>x</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Median.html#offset_10829..10833"><span>snoc</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp</span></span><span>
    </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?case</span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Median.html#offset_9743..9751"><span>ind_step</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="Median.html#offset_10849..10850"><span>a</span></a><span> </span><a class="entity_ref" href="Median.html#offset_10928..10929"><span>b</span></a><span class="main"><span>]</span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp</span></span><span>
  </span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>moreover</span></span></span><span> </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>â</span></span><span class="bound"><span>x</span></span><span class="main"><span>.</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="main"><span>â</span></span><span> </span><span>set</span><span> </span><span class="skolem"><span>t</span></span><span> </span><span class="main"><span>â¹</span></span><span> </span><span class="skolem"><span>is_swap</span></span><span> </span><span class="bound"><span>x</span></span><span>"</span></span></span><span> 
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><a class="entity_ref" href="Median.html#offset_9511..9517"><span>t_def</span></a><span> </span><a class="entity_ref" href="Median.html#offset_9400..9406"><span>is_swap_def</span></a><span class="main"><span>)</span></span><span> 
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>meson</span></span><span> </span><span>atLeastLessThan_iff</span><span> </span><span>imageE</span><span> </span><span>less_imp_le</span><span> </span><span>less_le_trans</span><span class="main"><span>)</span></span><span>  
  </span><span class="keyword1"><span class="command"><span>ultimately</span></span></span><span> </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?thesis</span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Median.html#offset_9077..9082"><span>assms</span></a><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><a class="entity_ref" href="Median.html#offset_9511..9517"><span>t_def</span></a><span class="main"><span class="main"><span>[</span></span></span><span class="operator"><span>symmetric</span></span><span class="main"><span class="main"><span>]</span></span></span><span> </span><a class="entity_ref" href="Median.html#offset_9623..9629"><span>meas_ptw_def</span></a><span class="main"><span>)</span></span><span>
</span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>text</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>â¹</span><span>Main results of this section:</span><span>âº</span></span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_11297..11302">lemma</span></span></span><span> </span><span class="entity_def" id="Median.order_statistics_measurable|fact"><span class="entity_def" id="Median.order_statistics_measurable|thm"><span>order_statistics_measurable</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>fixes</span></span></span><span> </span><span class="free"><span>X</span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span>nat</span><span> </span><span class="main"><span>â</span></span><span> </span><span class="tfree"><span>'a</span></span><span> </span><span class="main"><span>â</span></span><span> </span><span class="main"><span>(</span></span><span class="tfree"><span>'b</span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="main"><span>{</span></span><span>linorder_topology</span><span class="main"><span>,</span></span><span> </span><span>second_countable_topology</span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>n</span></span><span> </span><span class="main"><span>â¥</span></span><span> </span><span class="main"><span>1</span></span><span>"</span></span></span><span> 
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>j</span></span><span> </span><span class="main"><span>&lt;</span></span><span> </span><span class="free"><span>n</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>â</span></span><span class="bound"><span>i</span></span><span class="main"><span>.</span></span><span> </span><span class="bound"><span>i</span></span><span> </span><span class="main"><span>&lt;</span></span><span> </span><span class="free"><span>n</span></span><span> </span><span class="main"><span>â¹</span></span><span> </span><span class="free"><span>X</span></span><span> </span><span class="bound"><span>i</span></span><span> </span><span class="main"><span>â</span></span><span> </span><span>measurable</span><span> </span><span class="free"><span>M</span></span><span> </span><span>borel</span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="main"><span>Î»</span></span><span class="bound"><span>x</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>(</span></span><span>sort</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>Î»</span></span><span class="bound"><span>i</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>X</span></span><span> </span><span class="bound"><span>i</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>0</span></span><span class="main"><span>..&lt;</span></span><span class="free"><span>n</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>!</span></span><span> </span><span class="free"><span>j</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>â</span></span><span> </span><span>measurable</span><span> </span><span class="free"><span>M</span></span><span> </span><span>borel</span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>subst</span></span><span> </span><a class="entity_ref" href="Median.html#Median.sort_map_eq_sort|fact"><span>sort_map_eq_sort</span></a><span class="main"><span class="main"><span>[</span></span></span><span class="operator"><span>symmetric</span></span><span class="main"><span class="main"><span>]</span></span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Median.html#offset_11297..11302"><span>assms</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><a class="entity_ref" href="Median.html#Median.order_statistics_measurable_aux|fact"><span>order_statistics_measurable_aux</span></a><span> </span><span class="quasi_keyword"><span>del</span></span><span class="main"><span class="main"><span>:</span></span></span><a class="entity_ref" href="Median.html#Median.sort_map.simps|fact"><span>sort_map.simps</span></a><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="Median.median_def|fact"><span class="entity_def" id="Median.median_def|thm"><span class="entity_def" id="Median.median_def_raw|axiom"><span>definition</span></span></span></span></span></span><span> </span><span class="entity"><span class="entity_def" id="Median.median|const"><span>median</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span>
  </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>median</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>n</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>f</span></span></span></span><span> </span><span class="main"><span>=</span></span><span>  </span><span>sort</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="free"><span class="bound"><span class="entity"><span>f</span></span></span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>0</span></span><span class="main"><span>..&lt;</span></span><span class="free"><span class="bound"><span class="entity"><span>n</span></span></span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>!</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span class="bound"><span class="entity"><span>n</span></span></span></span><span> </span><span class="keyword1"><span>div</span></span><span> </span><span class="numeral"><span>2</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_11773..11778">lemma</span></span></span><span> </span><span class="entity_def" id="Median.median_measurable|fact"><span class="entity_def" id="Median.median_measurable|thm"><span>median_measurable</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>fixes</span></span></span><span> </span><span class="free"><span>X</span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span>nat</span><span> </span><span class="main"><span>â</span></span><span> </span><span class="tfree"><span>'a</span></span><span> </span><span class="main"><span>â</span></span><span> </span><span class="main"><span>(</span></span><span class="tfree"><span>'b</span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="main"><span>{</span></span><span>linorder_topology</span><span class="main"><span>,</span></span><span> </span><span>second_countable_topology</span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>n</span></span><span> </span><span class="main"><span>â¥</span></span><span> </span><span class="main"><span>1</span></span><span>"</span></span></span><span> 
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>â</span></span><span class="bound"><span>i</span></span><span class="main"><span>.</span></span><span> </span><span class="bound"><span>i</span></span><span> </span><span class="main"><span>&lt;</span></span><span> </span><span class="free"><span>n</span></span><span> </span><span class="main"><span>â¹</span></span><span> </span><span class="free"><span>X</span></span><span> </span><span class="bound"><span>i</span></span><span> </span><span class="main"><span>â</span></span><span> </span><span>measurable</span><span> </span><span class="free"><span>M</span></span><span> </span><span>borel</span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="main"><span>Î»</span></span><span class="bound"><span>x</span></span><span class="main"><span>.</span></span><span> </span><a class="entity_ref" href="Median.html#Median.median|const"><span>median</span></a><span> </span><span class="free"><span>n</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>Î»</span></span><span class="bound"><span>i</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>X</span></span><span> </span><span class="bound"><span>i</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>â</span></span><span> </span><span>measurable</span><span> </span><span class="free"><span>M</span></span><span> </span><span>borel</span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><a class="entity_ref" href="Median.html#Median.median_def|fact"><span>median_def</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>rule</span></span><span> </span><a class="entity_ref" href="Median.html#Median.order_statistics_measurable|fact"><span>order_statistics_measurable</span></a><span class="main"><span class="main"><span>[</span></span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="Median.html#offset_11773..11778"><span>assms</span></a><span class="main"><span class="main"><span>(</span></span></span><span>1</span><span class="main"><span class="main"><span>)</span></span></span><span> _ </span><a class="entity_ref" href="Median.html#offset_11773..11778"><span>assms</span></a><span class="main"><span class="main"><span>(</span></span></span><span>2</span><span class="main"><span class="main"><span>)</span></span></span><span class="main"><span class="main"><span>]</span></span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Median.html#offset_11773..11778"><span>assms</span></a><span class="main"><span>(</span></span><span>1</span><span class="main"><span>)</span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>force</span></span><span class="main"><span class="keyword3"><span>+</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>section</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>â¹</span><span>The Median Method</span><span>âº</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>text</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>â¹</span><span>This section contains the proof for the probability that the median of independent random
</span><span>variables will be in an interval with high probability if the individual variables are in the
</span><span>same interval with probability larger than $\frac{1}{2}$.
</span><span>
</span><span>The proof starts with the elementary observation that the median of a seqeuence with $n$ elements
</span><span>is in an interval $I$ if at least half of them are in $I$. This works because after sorting the
</span><span>sequence the elements that will be in the interval must necessarily form a consecutive subsequence,
</span><span>if its length is larger than $\frac{n}{2}$ the median must be in it.
</span><span>
</span><span>The remainder follows the proof in \cite[\textsection 2.1]{alon1999} using the Hoeffding inequality
</span><span>to estimate the probability that at least half of the sequence elements will be in the interval $I$.</span><span>âº</span></span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_12975..12980">lemma</span></span></span><span> </span><span class="entity_def" id="Median.interval_rule|fact"><span class="entity_def" id="Median.interval_rule|thm"><span>interval_rule</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Median.html#Median.interval|const"><span>interval</span></a><span> </span><span class="free"><span>I</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>a</span></span><span> </span><span class="main"><span>â¤</span></span><span> </span><span class="free"><span>x</span></span><span>"</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>x</span></span><span> </span><span class="main"><span>â¤</span></span><span> </span><span class="free"><span>b</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>a</span></span><span> </span><span class="main"><span>â</span></span><span> </span><span class="free"><span>I</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>b</span></span><span> </span><span class="main"><span>â</span></span><span> </span><span class="free"><span>I</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>x</span></span><span> </span><span class="main"><span>â</span></span><span> </span><span class="free"><span>I</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Median.html#offset_12975..12980"><span>assms</span></a><span class="main"><span>(</span></span><span>1</span><span class="main"><span>)</span></span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><a class="entity_ref" href="Median.html#Median.interval_def|fact"><span>interval_def</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Median.html#offset_12975..12980"><span>assms</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>blast</span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_13168..13173">lemma</span></span></span><span> </span><span class="entity_def" id="Median.sorted_int|fact"><span class="entity_def" id="Median.sorted_int|thm"><span>sorted_int</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Median.html#Median.interval|const"><span>interval</span></a><span> </span><span class="free"><span>I</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span>sorted</span><span> </span><span class="free"><span>xs</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>k</span></span><span> </span><span class="main"><span>&lt;</span></span><span> </span><span>length</span><span> </span><span class="free"><span>xs</span></span><span>"</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>i</span></span><span> </span><span class="main"><span>â¤</span></span><span> </span><span class="free"><span>j</span></span><span>"</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>j</span></span><span> </span><span class="main"><span>â¤</span></span><span> </span><span class="free"><span>k</span></span><span> </span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>xs</span></span><span> </span><span class="main"><span>!</span></span><span> </span><span class="free"><span>i</span></span><span> </span><span class="main"><span>â</span></span><span> </span><span class="free"><span>I</span></span><span>"</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>xs</span></span><span> </span><span class="main"><span>!</span></span><span> </span><span class="free"><span>k</span></span><span> </span><span class="main"><span>â</span></span><span> </span><span class="free"><span>I</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>xs</span></span><span> </span><span class="main"><span>!</span></span><span> </span><span class="free"><span>j</span></span><span> </span><span class="main"><span>â</span></span><span> </span><span class="free"><span>I</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>rule</span></span><span> </span><a class="entity_ref" href="Median.html#Median.interval_rule|fact"><span>interval_rule</span></a><span class="main"><span class="main"><span>[</span></span></span><span class="keyword2"><span class="keyword"><span class="operator"><span>where</span></span></span></span><span> a</span><span class="main"><span class="main"><span class="main"><span>=</span></span></span></span><span class="quoted"><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span class="free"><span>xs</span></span></span><span> </span><span class="main"><span class="main"><span>!</span></span></span><span> </span><span class="free"><span class="free"><span>i</span></span></span><span>"</span></span></span></span><span> </span><span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword"><span>and</span></span></span></span></span><span> b</span><span class="main"><span class="main"><span class="main"><span>=</span></span></span></span><span class="quoted"><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span class="free"><span>xs</span></span></span><span> </span><span class="main"><span class="main"><span>!</span></span></span><span> </span><span class="free"><span class="free"><span>k</span></span></span><span>"</span></span></span></span><span class="main"><span class="main"><span>]</span></span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Median.html#offset_13168..13173"><span>assms</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><span>sorted_nth_mono</span><span class="main"><span>)</span></span><span class="main"><span class="keyword3"><span>+</span></span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_13440..13445">lemma</span></span></span><span> </span><span class="entity_def" id="Median.mid_in_interval|fact"><span class="entity_def" id="Median.mid_in_interval|thm"><span>mid_in_interval</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="numeral"><span>2</span></span><span class="main"><span>*</span></span><span>length</span><span> </span><span class="main"><span>(</span></span><span>filter</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>Î»</span></span><span class="bound"><span>x</span></span><span class="main"><span>.</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="main"><span>â</span></span><span> </span><span class="free"><span>I</span></span><span class="main"><span>)</span></span><span> </span><span class="free"><span>xs</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>&gt;</span></span><span> </span><span>length</span><span> </span><span class="free"><span>xs</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Median.html#Median.interval|const"><span>interval</span></a><span> </span><span class="free"><span>I</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span>sorted</span><span> </span><span class="free"><span>xs</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>xs</span></span><span> </span><span class="main"><span>!</span></span><span> </span><span class="main"><span>(</span></span><span>length</span><span> </span><span class="free"><span>xs</span></span><span> </span><span class="keyword1"><span>div</span></span><span> </span><span class="numeral"><span>2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>â</span></span><span> </span><span class="free"><span>I</span></span><span>"</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="operator"><span>-</span></span><span>
  </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span>length</span><span> </span><span class="main"><span>(</span></span><span>filter</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>Î»</span></span><span class="bound"><span>x</span></span><span class="main"><span>.</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="main"><span>â</span></span><span> </span><span class="free"><span>I</span></span><span class="main"><span>)</span></span><span> </span><span class="free"><span>xs</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>&gt;</span></span><span> </span><span class="main"><span>0</span></span><span>"</span></span></span><span>  </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Median.html#offset_13440..13445"><span>assms</span></a><span class="main"><span>(</span></span><span>1</span><span class="main"><span>)</span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>linarith</span></span><span>
  </span><span class="keyword1"><span class="command"><span>then</span></span></span><span> </span><span class="keyword3"><span class="command"><span>obtain</span></span></span><span> </span><span class="skolem"><span class="skolem"><span>v</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span> </span><span class="entity_def" id="offset_13704..13707">v_1</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="skolem"><span>v</span></span><span> </span><span class="main"><span>&lt;</span></span><span> </span><span>length</span><span> </span><span class="free"><span>xs</span></span><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity_def" id="offset_13729..13732">v_2</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>xs</span></span><span> </span><span class="main"><span>!</span></span><span> </span><span class="skolem"><span>v</span></span><span> </span><span class="main"><span>â</span></span><span> </span><span class="free"><span>I</span></span><span>"</span></span></span><span> 
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>metis</span></span><span> </span><span>filter_False</span><span> </span><span>in_set_conv_nth</span><span> </span><span>length_greater_0_conv</span><span class="main"><span>)</span></span><span>

  </span><span class="keyword3"><span class="command"><span class="entity_def" id="offset_13817..13823">define</span></span></span><span> </span><span class="skolem"><span class="skolem"><span>J</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="skolem"><span>J</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>{</span></span><span class="bound"><span>k</span></span><span class="main"><span>.</span></span><span> </span><span class="bound"><span>k</span></span><span> </span><span class="main"><span>&lt;</span></span><span> </span><span>length</span><span> </span><span class="free"><span>xs</span></span><span> </span><span class="main"><span>â§</span></span><span> </span><span class="free"><span>xs</span></span><span> </span><span class="main"><span>!</span></span><span> </span><span class="bound"><span>k</span></span><span> </span><span class="main"><span>â</span></span><span> </span><span class="free"><span>I</span></span><span class="main"><span>}</span></span><span>"</span></span></span><span>

  </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="entity_def" id="offset_13878..13888">card_J_min</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="numeral"><span>2</span></span><span class="main"><span>*</span></span><span>card</span><span> </span><span class="skolem"><span>J</span></span><span> </span><span class="main"><span>&gt;</span></span><span> </span><span>length</span><span> </span><span class="free"><span>xs</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Median.html#offset_13440..13445"><span>assms</span></a><span class="main"><span>(</span></span><span>1</span><span class="main"><span>)</span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><a class="entity_ref" href="Median.html#offset_13817..13823"><span>J_def</span></a><span> </span><span>length_filter_conv_card</span><span class="main"><span>)</span></span><span>

  </span><span class="keyword1"><span class="command"><span>consider</span></span></span><span>
    </span><span class="main"><span>(</span></span><span>a</span><span class="main"><span>)</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>xs</span></span><span> </span><span class="main"><span>!</span></span><span> </span><span class="main"><span>(</span></span><span>length</span><span> </span><span class="free"><span>xs</span></span><span> </span><span class="keyword1"><span>div</span></span><span> </span><span class="numeral"><span>2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>â</span></span><span> </span><span class="free"><span>I</span></span><span>"</span></span></span><span> </span><span class="main"><span>|</span></span><span>
    </span><span class="main"><span>(</span></span><span>b</span><span class="main"><span>)</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>xs</span></span><span> </span><span class="main"><span>!</span></span><span> </span><span class="main"><span>(</span></span><span>length</span><span> </span><span class="free"><span>xs</span></span><span> </span><span class="keyword1"><span>div</span></span><span> </span><span class="numeral"><span>2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>â</span></span><span> </span><span class="free"><span>I</span></span><span> </span><span class="main"><span>â§</span></span><span> </span><span class="skolem"><span>v</span></span><span> </span><span class="main"><span>&gt;</span></span><span> </span><span class="main"><span>(</span></span><span>length</span><span> </span><span class="free"><span>xs</span></span><span> </span><span class="keyword1"><span>div</span></span><span> </span><span class="numeral"><span>2</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span> </span><span class="main"><span>|</span></span><span>
    </span><span class="main"><span>(</span></span><span>c</span><span class="main"><span>)</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>xs</span></span><span> </span><span class="main"><span>!</span></span><span> </span><span class="main"><span>(</span></span><span>length</span><span> </span><span class="free"><span>xs</span></span><span> </span><span class="keyword1"><span>div</span></span><span> </span><span class="numeral"><span>2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>â</span></span><span> </span><span class="free"><span>I</span></span><span> </span><span class="main"><span>â§</span></span><span> </span><span class="skolem"><span>v</span></span><span> </span><span class="main"><span>&lt;</span></span><span> </span><span class="main"><span>(</span></span><span>length</span><span> </span><span class="free"><span>xs</span></span><span> </span><span class="keyword1"><span>div</span></span><span> </span><span class="numeral"><span>2</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>metis</span></span><span> </span><span>linorder_cases</span><span> </span><a class="entity_ref" href="Median.html#offset_13729..13732"><span>v_2</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword3"><span class="command"><span>thus</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?thesis</span></span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>cases</span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span>a</span><span>
    </span><span class="keyword1"><span class="command"><span>then</span></span></span><span> </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?thesis</span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp</span></span><span>
  </span><span class="keyword1"><span class="command"><span>next</span></span></span><span>
    </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span class="entity_def" id="offset_14273..14274">b</span><span>
    </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="entity_def" id="offset_14284..14285">p</span><span class="main"><span>:</span></span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>â</span></span><span class="bound"><span>k</span></span><span class="main"><span>.</span></span><span> </span><span class="bound"><span>k</span></span><span> </span><span class="main"><span>â¤</span></span><span> </span><span>length</span><span> </span><span class="free"><span>xs</span></span><span> </span><span class="keyword1"><span>div</span></span><span> </span><span class="numeral"><span>2</span></span><span> </span><span class="main"><span>â¹</span></span><span> </span><span class="free"><span>xs</span></span><span> </span><span class="main"><span>!</span></span><span> </span><span class="bound"><span>k</span></span><span> </span><span class="main"><span>â</span></span><span> </span><span class="free"><span>I</span></span><span>"</span></span></span><span>
      </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Median.html#offset_14273..14274"><span>b</span></a><span> </span><a class="entity_ref" href="Median.html#offset_13729..13732"><span>v_2</span></a><span> </span><a class="entity_ref" href="Median.html#Median.sorted_int|fact"><span>sorted_int</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="Median.html#offset_13440..13445"><span>assms</span></a><span class="main"><span class="main"><span>(</span></span></span><span>2</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="Median.html#offset_13440..13445"><span>assms</span></a><span class="main"><span class="main"><span>(</span></span></span><span>3</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="Median.html#offset_13704..13707"><span>v_1</span></a><span class="main"><span>,</span></span><span> </span><span class="keyword2"><span class="keyword"><span class="operator"><span>where</span></span></span></span><span> j</span><span class="main"><span class="main"><span>=</span></span></span><span class="quoted"><span class="quoted"><span>"</span><span>length</span><span> </span><span class="free"><span>xs</span></span><span> </span><span class="keyword1"><span>div</span></span><span> </span><span class="numeral"><span>2</span></span><span>"</span></span></span><span class="main"><span>]</span></span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="operator"><span>simp</span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>blast</span></span><span>
    </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span>card</span><span> </span><span class="skolem"><span>J</span></span><span> </span><span class="main"><span>â¤</span></span><span> </span><span>card</span><span> </span><span class="main"><span>{</span></span><span>Suc</span><span> </span><span class="main"><span>(</span></span><span>length</span><span> </span><span class="free"><span>xs</span></span><span> </span><span class="keyword1"><span>div</span></span><span> </span><span class="numeral"><span>2</span></span><span class="main"><span>)</span></span><span class="main"><span>..&lt;</span></span><span>length</span><span> </span><span class="free"><span>xs</span></span><span class="main"><span>}</span></span><span>"</span></span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>rule</span></span><span> </span><span>card_mono</span><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><span class="operator"><span>simp</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>rule</span></span><span> </span><span>subsetI</span><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><a class="entity_ref" href="Median.html#offset_13817..13823"><span>J_def</span></a><span> </span><span>not_less_eq_eq</span><span class="main"><span class="main"><span>[</span></span></span><span class="operator"><span>symmetric</span></span><span class="main"><span class="main"><span>]</span></span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Median.html#offset_14284..14285"><span>p</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>metis</span></span><span>
    </span><span class="keyword1"><span class="command"><span>hence</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span>card</span><span> </span><span class="skolem"><span>J</span></span><span> </span><span class="main"><span>â¤</span></span><span> </span><span>length</span><span> </span><span class="free"><span>xs</span></span><span> </span><span class="main"><span>-</span></span><span> </span><span class="main"><span>(</span></span><span>Suc</span><span> </span><span class="main"><span>(</span></span><span>length</span><span> </span><span class="free"><span>xs</span></span><span> </span><span class="keyword1"><span>div</span></span><span> </span><span class="numeral"><span>2</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
      </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><span>card_atLeastLessThan</span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>metis</span></span><span>
    </span><span class="keyword1"><span class="command"><span>hence</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span>length</span><span> </span><span class="free"><span>xs</span></span><span> </span><span class="main"><span>â¤</span></span><span> </span><span class="numeral"><span>2</span></span><span class="main"><span>*</span></span><span class="main"><span>(</span></span><span> </span><span>length</span><span> </span><span class="free"><span>xs</span></span><span> </span><span class="main"><span>-</span></span><span> </span><span class="main"><span>(</span></span><span>Suc</span><span> </span><span class="main"><span>(</span></span><span>length</span><span> </span><span class="free"><span>xs</span></span><span> </span><span class="keyword1"><span>div</span></span><span> </span><span class="numeral"><span>2</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
      </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Median.html#offset_13878..13888"><span>card_J_min</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>linarith</span></span><span>
    </span><span class="keyword1"><span class="command"><span>hence</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span>False</span><span>"</span></span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span>nat_distrib</span><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>subst</span></span><span> </span><span class="main"><span class="main"><span>(</span></span></span><span class="quasi_keyword"><span>asm</span></span><span class="main"><span class="main"><span>)</span></span></span><span> </span><span>le_diff_conv2</span><span class="main"><span>)</span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Median.html#offset_14273..14274"><span>b</span></a><span> </span><a class="entity_ref" href="Median.html#offset_13704..13707"><span>v_1</span></a><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="operator"><span>linarith</span></span><span>
      </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp</span></span><span>
    </span><span class="keyword1"><span class="command"><span>then</span></span></span><span> </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?thesis</span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp</span></span><span>
  </span><span class="keyword1"><span class="command"><span>next</span></span></span><span>
    </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span class="entity_def" id="offset_14994..14995">c</span><span>
    </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="entity_def" id="offset_15005..15006">p</span><span class="main"><span>:</span></span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>â</span></span><span class="bound"><span>k</span></span><span class="main"><span>.</span></span><span> </span><span class="bound"><span>k</span></span><span> </span><span class="main"><span>â¥</span></span><span> </span><span>length</span><span> </span><span class="free"><span>xs</span></span><span> </span><span class="keyword1"><span>div</span></span><span> </span><span class="numeral"><span>2</span></span><span> </span><span class="main"><span>â¹</span></span><span> </span><span class="bound"><span>k</span></span><span> </span><span class="main"><span>&lt;</span></span><span> </span><span>length</span><span> </span><span class="free"><span>xs</span></span><span> </span><span class="main"><span>â¹</span></span><span> </span><span class="free"><span>xs</span></span><span> </span><span class="main"><span>!</span></span><span> </span><span class="bound"><span>k</span></span><span> </span><span class="main"><span>â</span></span><span> </span><span class="free"><span>I</span></span><span>"</span></span></span><span>
      </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Median.html#offset_14994..14995"><span>c</span></a><span> </span><a class="entity_ref" href="Median.html#offset_13704..13707"><span>v_1</span></a><span> </span><a class="entity_ref" href="Median.html#offset_13729..13732"><span>v_2</span></a><span> </span><a class="entity_ref" href="Median.html#Median.sorted_int|fact"><span>sorted_int</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="Median.html#offset_13440..13445"><span>assms</span></a><span class="main"><span class="main"><span>(</span></span></span><span>2</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="Median.html#offset_13440..13445"><span>assms</span></a><span class="main"><span class="main"><span>(</span></span></span><span>3</span><span class="main"><span class="main"><span>)</span></span></span><span class="main"><span>,</span></span><span> </span><span class="keyword2"><span class="keyword"><span class="operator"><span>where</span></span></span></span><span> i </span><span class="main"><span class="main"><span>=</span></span></span><span class="quoted"><span class="quoted"><span>"</span><span class="skolem"><span>v</span></span><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span>and</span></span></span></span><span> j</span><span class="main"><span class="main"><span>=</span></span></span><span class="quoted"><span class="quoted"><span>"</span><span>length</span><span> </span><span class="free"><span>xs</span></span><span> </span><span class="keyword1"><span>div</span></span><span> </span><span class="numeral"><span>2</span></span><span>"</span></span></span><span class="main"><span>]</span></span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="operator"><span>simp</span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>blast</span></span><span>
    </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span>card</span><span> </span><span class="skolem"><span>J</span></span><span> </span><span class="main"><span>â¤</span></span><span> </span><span>card</span><span> </span><span class="main"><span>{</span></span><span class="main"><span>0</span></span><span class="main"><span>..&lt;</span></span><span class="main"><span>(</span></span><span>length</span><span> </span><span class="free"><span>xs</span></span><span> </span><span class="keyword1"><span>div</span></span><span> </span><span class="numeral"><span>2</span></span><span class="main"><span>)</span></span><span class="main"><span>}</span></span><span>"</span></span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>rule</span></span><span> </span><span>card_mono</span><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><span class="operator"><span>simp</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>rule</span></span><span> </span><span>subsetI</span><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><a class="entity_ref" href="Median.html#offset_13817..13823"><span>J_def</span></a><span> </span><span>not_less_eq_eq</span><span class="main"><span class="main"><span>[</span></span></span><span class="operator"><span>symmetric</span></span><span class="main"><span class="main"><span>]</span></span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Median.html#offset_15005..15006"><span>p</span></a><span> </span><span>linorder_le_less_linear</span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>blast</span></span><span>
    </span><span class="keyword1"><span class="command"><span>hence</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span>card</span><span> </span><span class="skolem"><span>J</span></span><span> </span><span class="main"><span>â¤</span></span><span> </span><span class="main"><span>(</span></span><span>length</span><span> </span><span class="free"><span>xs</span></span><span> </span><span class="keyword1"><span>div</span></span><span> </span><span class="numeral"><span>2</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
      </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><span>card_atLeastLessThan</span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp</span></span><span>
    </span><span class="keyword1"><span class="command"><span>then</span></span></span><span> </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?thesis</span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Median.html#offset_13878..13888"><span>card_J_min</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>linarith</span></span><span>
  </span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_15517..15522">lemma</span></span></span><span> </span><span class="entity_def" id="Median.median_est|fact"><span class="entity_def" id="Median.median_est|thm"><span>median_est</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Median.html#Median.interval|const"><span>interval</span></a><span> </span><span class="free"><span>I</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="numeral"><span>2</span></span><span class="main"><span>*</span></span><span>card</span><span> </span><span class="main"><span>{</span></span><span class="bound"><span>k</span></span><span class="main"><span>.</span></span><span> </span><span class="bound"><span>k</span></span><span> </span><span class="main"><span>&lt;</span></span><span> </span><span class="free"><span>n</span></span><span> </span><span class="main"><span>â§</span></span><span> </span><span class="free"><span>f</span></span><span> </span><span class="bound"><span>k</span></span><span> </span><span class="main"><span>â</span></span><span> </span><span class="free"><span>I</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>&gt;</span></span><span> </span><span class="free"><span>n</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Median.html#Median.median|const"><span>median</span></a><span> </span><span class="free"><span>n</span></span><span> </span><span class="free"><span>f</span></span><span> </span><span class="main"><span>â</span></span><span> </span><span class="free"><span>I</span></span><span>"</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="operator"><span>-</span></span><span>
  </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="entity_def" id="offset_15642..15643">a</span><span class="main"><span>:</span></span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>{</span></span><span class="bound"><span>k</span></span><span class="main"><span>.</span></span><span> </span><span class="bound"><span>k</span></span><span> </span><span class="main"><span>&lt;</span></span><span> </span><span class="free"><span>n</span></span><span> </span><span class="main"><span>â§</span></span><span> </span><span class="free"><span>f</span></span><span> </span><span class="bound"><span>k</span></span><span> </span><span class="main"><span>â</span></span><span> </span><span class="free"><span>I</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>{</span></span><span class="bound"><span>i</span></span><span class="main"><span>.</span></span><span> </span><span class="bound"><span>i</span></span><span> </span><span class="main"><span>&lt;</span></span><span> </span><span class="free"><span>n</span></span><span> </span><span class="main"><span>â§</span></span><span> </span><span>map</span><span> </span><span class="free"><span>f</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>0</span></span><span class="main"><span>..&lt;</span></span><span class="free"><span>n</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>!</span></span><span> </span><span class="bound"><span>i</span></span><span> </span><span class="main"><span>â</span></span><span> </span><span class="free"><span>I</span></span><span class="main"><span>}</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>rule</span></span><span> </span><span>order_antisym</span><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><span class="operator"><span>rule</span></span><span> </span><span>subsetI</span><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><span class="operator"><span>simp</span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>rule</span></span><span> </span><span>subsetI</span><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><span class="operator"><span>simp</span></span><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><span class="operator"><span>metis</span></span><span> </span><span>add_0</span><span> </span><span>diff_zero</span><span> </span><span>nth_map_upt</span><span class="main"><span>)</span></span><span>

  </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?thesis</span></span></span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><a class="entity_ref" href="Median.html#Median.median_def|fact"><span>median_def</span></a><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>rule</span></span><span> </span><a class="entity_ref" href="Median.html#Median.mid_in_interval|fact"><span>mid_in_interval</span></a><span class="main"><span class="main"><span>[</span></span></span><span class="keyword2"><span class="keyword"><span class="operator"><span>where</span></span></span></span><span> I</span><span class="main"><span class="main"><span class="main"><span>=</span></span></span></span><span class="quoted"><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span class="free"><span>I</span></span></span><span>"</span></span></span></span><span> </span><span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword"><span>and</span></span></span></span></span><span> xs</span><span class="main"><span class="main"><span class="main"><span>=</span></span></span></span><span class="quoted"><span class="quoted"><span class="quoted"><span>"</span><span>sort</span><span> </span><span class="main"><span class="main"><span>(</span></span></span><span>map</span><span> </span><span class="free"><span class="free"><span>f</span></span></span><span> </span><span class="main"><span class="main"><span>[</span></span></span><span class="main"><span class="main"><span>0</span></span></span><span class="main"><span class="main"><span>..&lt;</span></span></span><span class="free"><span class="free"><span>n</span></span></span><span class="main"><span class="main"><span>]</span></span></span><span class="main"><span class="main"><span>)</span></span></span><span>"</span></span></span></span><span class="main"><span class="main"><span>,</span></span></span><span> </span><span class="operator"><span>simplified</span></span><span class="main"><span class="main"><span>]</span></span></span><span class="main"><span>)</span></span><span>
     </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Median.html#offset_15517..15522"><span>assms</span></a><span> </span><a class="entity_ref" href="Median.html#offset_15642..15643"><span>a</span></a><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span>filter_sort</span><span> </span><span>comp_def</span><span> </span><span>length_filter_conv_card</span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><a class="entity_ref" href="Median.html#offset_15517..15522"><span>assms</span></a><span class="main"><span>)</span></span><span>
</span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>text</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>â¹</span><span>Main results of this section:</span><span>âº</span></span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_16102..16109">theorem</span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span>prob_space</span><span class="main"><span>)</span></span><span> </span><span class="entity_def" id="Median.measure_pmf.median_bound|fact"><span class="entity_def" id="Median.prob_space.median_bound|fact"><span class="entity_def" id="Median.measure_pmf.median_bound|thm"><span class="entity_def" id="Median.prob_space.median_bound|thm"><span class="entity_def" id="offset_16126..16138">median_bound</span></span></span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>fixes</span></span></span><span> </span><span class="free"><span>n</span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span>nat</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>fixes</span></span></span><span> </span><span class="free"><span>I</span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="tfree"><span>'b</span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="main"><span>{</span></span><span>linorder_topology</span><span class="main"><span>,</span></span><span> </span><span>second_countable_topology</span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span> </span><span>set</span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Median.html#Median.interval|const"><span>interval</span></a><span> </span><span class="free"><span>I</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>Î±</span></span><span> </span><span class="main"><span>&gt;</span></span><span> </span><span class="main"><span>0</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>Îµ</span></span><span> </span><span class="main"><span>â</span></span><span> </span><span class="main"><span>{</span></span><span class="main"><span>0</span></span><span class="main"><span>&lt;..&lt;</span></span><span class="main"><span>1</span></span><span class="main"><span>}</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span>indep_vars</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>Î»</span></span><span class="main"><span class="bound"><span>_</span></span></span><span class="main"><span>.</span></span><span> </span><span>borel</span><span class="main"><span>)</span></span><span> </span><span class="free"><span>X</span></span><span> </span><span class="main"><span>{</span></span><span class="main"><span>0</span></span><span class="main"><span>..&lt;</span></span><span class="free"><span>n</span></span><span class="main"><span>}</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>n</span></span><span> </span><span class="main"><span>â¥</span></span><span> </span><span class="main"><span>-</span></span><span> </span><span>ln</span><span> </span><span class="free"><span>Îµ</span></span><span> </span><span class="main"><span>/</span></span><span> </span><span class="main"><span>(</span></span><span class="numeral"><span>2</span></span><span> </span><span class="main"><span>*</span></span><span> </span><span class="free"><span>Î±</span></span><span class="main"><span><span class="hidden">â§</span><sup>2</sup></span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>â</span></span><span class="bound"><span>i</span></span><span class="main"><span>.</span></span><span> </span><span class="bound"><span>i</span></span><span> </span><span class="main"><span>&lt;</span></span><span> </span><span class="free"><span>n</span></span><span> </span><span class="main"><span>â¹</span></span><span> </span><span class="keyword1"><span>ð«(</span></span><span class="bound"><span class="bound"><span>Ï</span></span></span><span> </span><span class="keyword1"><span>in</span></span><span> </span><span class="free"><span class="free"><span>M</span></span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>X</span></span><span> </span><span class="bound"><span>i</span></span><span> </span><span class="bound"><span>Ï</span></span><span> </span><span class="main"><span>â</span></span><span> </span><span class="free"><span>I</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>â¥</span></span><span> </span><span class="main"><span>1</span></span><span class="main"><span>/</span></span><span class="numeral"><span>2</span></span><span class="main"><span>+</span></span><span class="free"><span>Î±</span></span><span>"</span></span></span><span> 
  </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="keyword1"><span>ð«(</span></span><span class="bound"><span class="bound"><span>Ï</span></span></span><span> </span><span class="keyword1"><span>in</span></span><span> </span><span class="free"><span class="free"><span>M</span></span></span><span class="main"><span>.</span></span><span> </span><a class="entity_ref" href="Median.html#Median.median|const"><span>median</span></a><span> </span><span class="free"><span>n</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>Î»</span></span><span class="bound"><span>i</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>X</span></span><span> </span><span class="bound"><span>i</span></span><span> </span><span class="bound"><span>Ï</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>â</span></span><span> </span><span class="free"><span>I</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>â¥</span></span><span> </span><span class="main"><span>1</span></span><span class="main"><span>-</span></span><span class="free"><span>Îµ</span></span><span>"</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="operator"><span>-</span></span><span>
  </span><span class="keyword3"><span class="command"><span class="entity_def" id="offset_16493..16499">define</span></span></span><span> </span><span class="skolem"><span class="skolem"><span>Y</span></span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span>nat</span><span> </span><span class="main"><span>â</span></span><span> </span><span class="tfree"><span>'a</span></span><span> </span><span class="main"><span>â</span></span><span> </span><span>real</span><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="skolem"><span>Y</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>Î»</span></span><span class="bound"><span>i</span></span><span class="main"><span>.</span></span><span> </span><span>indicator</span><span> </span><span class="free"><span>I</span></span><span> </span><span class="main"><span>â</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>X</span></span><span> </span><span class="bound"><span>i</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>

  </span><span class="keyword3"><span class="command"><span class="entity_def" id="offset_16564..16570">define</span></span></span><span> </span><span class="skolem"><span class="skolem"><span>t</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="skolem"><span>t</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>â</span></span><span class="bound"><span>i</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>0</span></span><span class="main"><span>..&lt;</span></span><span class="free"><span>n</span></span><span class="main"><span>.</span></span><span> </span><span>expectation</span><span> </span><span class="main"><span>(</span></span><span class="skolem"><span>Y</span></span><span> </span><span class="bound"><span>i</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>-</span></span><span> </span><span class="free"><span>n</span></span><span class="main"><span>/</span></span><span class="numeral"><span>2</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>0</span></span><span> </span><span class="main"><span>&lt;</span></span><span> </span><span class="main"><span>-</span></span><span>ln</span><span> </span><span class="free"><span>Îµ</span></span><span> </span><span class="main"><span>/</span></span><span> </span><span class="main"><span>(</span></span><span class="numeral"><span>2</span></span><span> </span><span class="main"><span>*</span></span><span> </span><span class="free"><span>Î±</span></span><span class="main"><span><span class="hidden">â§</span><sup>2</sup></span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>  
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>rule</span></span><span> </span><span>divide_pos_pos</span><span class="main"><span>)</span></span><span>
     </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><span class="operator"><span>subst</span></span><span> </span><span>ln_less_zero_iff</span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Median.html#offset_16102..16109"><span>assms</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>auto</span></span><span>
  </span><span class="keyword1"><span class="command"><span>also</span></span></span><span> </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>...</span></span><span> </span><span class="main"><span>â¤</span></span><span> </span><span>real</span><span> </span><span class="free"><span>n</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Median.html#offset_16102..16109"><span>assms</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp</span></span><span>
  </span><span class="keyword1"><span class="command"><span>finally</span></span></span><span> </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span>real</span><span> </span><span class="free"><span>n</span></span><span> </span><span class="main"><span>&gt;</span></span><span> </span><span class="main"><span>0</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp</span></span><span>
  </span><span class="keyword1"><span class="command"><span>hence</span></span></span><span> </span><span class="entity_def" id="offset_16845..16851">n_ge_1</span><span class="main"><span>:</span></span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>n</span></span><span> </span><span class="main"><span>â¥</span></span><span> </span><span class="main"><span>1</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>linarith</span></span><span>
  </span><span class="keyword1"><span class="command"><span>hence</span></span></span><span> </span><span class="entity_def" id="offset_16880..16886">n_ge_0</span><span class="main"><span>:</span></span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>n</span></span><span> </span><span class="main"><span>&gt;</span></span><span> </span><span class="main"><span>0</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp</span></span><span>

  </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="entity_def" id="offset_16911..16919">ind_comp</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>â</span></span><span class="bound"><span>i</span></span><span class="main"><span>.</span></span><span> </span><span>indicator</span><span> </span><span class="free"><span>I</span></span><span> </span><span class="main"><span>â</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>X</span></span><span> </span><span class="bound"><span>i</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>indicator</span><span> </span><span class="main"><span>{</span></span><span class="bound"><span>Ï</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>X</span></span><span> </span><span class="bound"><span>i</span></span><span> </span><span class="bound"><span>Ï</span></span><span> </span><span class="main"><span>â</span></span><span> </span><span class="free"><span>I</span></span><span class="main"><span>}</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>rule</span></span><span> </span><span>ext</span><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span>indicator_def</span><span> </span><span>comp_def</span><span class="main"><span>)</span></span><span>

  </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>Î±</span></span><span> </span><span class="main"><span>*</span></span><span> </span><span class="free"><span>n</span></span><span> </span><span class="main"><span>â¤</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>â</span></span><span> </span><span class="bound"><span>i</span></span><span> </span><span class="main"><span>=</span></span><span class="main"><span>0</span></span><span class="main"><span>..&lt;</span></span><span class="free"><span>n</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>1</span></span><span class="main"><span>/</span></span><span class="numeral"><span>2</span></span><span> </span><span class="main"><span>+</span></span><span> </span><span class="free"><span>Î±</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>-</span></span><span> </span><span class="free"><span>n</span></span><span class="main"><span>/</span></span><span class="numeral"><span>2</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span class="dynamic"><span class="dynamic"><span>algebra_simps</span></span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>also</span></span></span><span> </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>...</span></span><span> </span><span class="main"><span>â¤</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>â</span></span><span> </span><span class="bound"><span>i</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>0</span></span><span class="main"><span>..&lt;</span></span><span class="free"><span>n</span></span><span class="main"><span>.</span></span><span> </span><span>expectation</span><span> </span><span class="main"><span>(</span></span><span class="skolem"><span>Y</span></span><span> </span><span class="bound"><span>i</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>-</span></span><span> </span><span class="free"><span>n</span></span><span class="main"><span>/</span></span><span class="numeral"><span>2</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>rule</span></span><span> </span><span>diff_right_mono</span><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><span class="operator"><span>rule</span></span><span> </span><span>sum_mono</span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Median.html#offset_16102..16109"><span>assms</span></a><span class="main"><span>(</span></span><span>6</span><span class="main"><span>)</span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><a class="entity_ref" href="Median.html#offset_16493..16499"><span>Y_def</span></a><span> </span><a class="entity_ref" href="Median.html#offset_16911..16919"><span>ind_comp</span></a><span> </span><span>Collect_conj_eq</span><span> </span><span>inf_commute</span><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>also</span></span></span><span> </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>...</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="skolem"><span>t</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><a class="entity_ref" href="Median.html#offset_16564..16570"><span>t_def</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>finally</span></span></span><span> </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="entity_def" id="offset_17343..17349">t_ge_a</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="skolem"><span>t</span></span><span> </span><span class="main"><span>â¥</span></span><span> </span><span class="free"><span>Î±</span></span><span> </span><span class="main"><span>*</span></span><span> </span><span class="free"><span>n</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp</span></span><span>

  </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="entity_def" id="offset_17379..17380">d</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>0</span></span><span> </span><span class="main"><span>â¤</span></span><span> </span><span class="free"><span>Î±</span></span><span> </span><span class="main"><span>*</span></span><span> </span><span class="free"><span>n</span></span><span>"</span></span></span><span> 
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>rule</span></span><span> </span><span>mult_nonneg_nonneg</span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Median.html#offset_16102..16109"><span>assms</span></a><span class="main"><span>(</span></span><span>2</span><span class="main"><span>)</span></span><span> </span><a class="entity_ref" href="Median.html#offset_16880..16886"><span>n_ge_0</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp</span></span><span class="main"><span class="keyword3"><span>+</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>also</span></span></span><span> </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>...</span></span><span> </span><span class="main"><span>â¤</span></span><span> </span><span class="skolem"><span>t</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Median.html#offset_17343..17349"><span>t_ge_a</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp</span></span><span>
  </span><span class="keyword1"><span class="command"><span>finally</span></span></span><span> </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="entity_def" id="offset_17524..17530">t_ge_0</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="skolem"><span>t</span></span><span> </span><span class="main"><span>â¥</span></span><span> </span><span class="main"><span>0</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp</span></span><span>

  </span><span class="keyword1"><span class="command"><span>have</span></span></span><span>  </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="free"><span>Î±</span></span><span> </span><span class="main"><span>*</span></span><span> </span><span class="free"><span>n</span></span><span class="main"><span>)</span></span><span class="main"><span><span class="hidden">â§</span><sup>2</sup></span></span><span> </span><span class="main"><span>â¤</span></span><span> </span><span class="skolem"><span>t</span></span><span class="main"><span><span class="hidden">â§</span><sup>2</sup></span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Median.html#offset_17343..17349"><span>t_ge_a</span></a><span> </span><a class="entity_ref" href="Median.html#offset_17379..17380"><span>d</span></a><span> </span><span>power_mono</span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>blast</span></span><span>
  </span><span class="keyword1"><span class="command"><span>hence</span></span></span><span> </span><span class="entity_def" id="offset_17618..17627">t_ge_a_sq</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>Î±</span></span><span class="main"><span><span class="hidden">â§</span><sup>2</sup></span></span><span> </span><span class="main"><span>*</span></span><span> </span><span>real</span><span> </span><span class="free"><span>n</span></span><span> </span><span class="main"><span>*</span></span><span> </span><span>real</span><span> </span><span class="free"><span>n</span></span><span> </span><span class="main"><span>â¤</span></span><span> </span><span class="skolem"><span>t</span></span><span class="main"><span><span class="hidden">â§</span><sup>2</sup></span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span class="dynamic"><span class="dynamic"><span>algebra_simps</span></span></span><span> </span><span>power2_eq_square</span><span class="main"><span>)</span></span><span>

  </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="entity_def" id="offset_17716..17723">Y_indep</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span>indep_vars</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>Î»</span></span><span class="main"><span class="bound"><span>_</span></span></span><span class="main"><span>.</span></span><span> </span><span>borel</span><span class="main"><span>)</span></span><span> </span><span class="skolem"><span>Y</span></span><span> </span><span class="main"><span>{</span></span><span class="main"><span>0</span></span><span class="main"><span>..&lt;</span></span><span class="free"><span>n</span></span><span class="main"><span>}</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>subst</span></span><span> </span><a class="entity_ref" href="Median.html#offset_16493..16499"><span>Y_def</span></a><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>rule</span></span><span> </span><span>indep_vars_compose</span><span class="main"><span class="main"><span>[</span></span></span><span class="keyword2"><span class="keyword"><span class="operator"><span>where</span></span></span></span><span> M'</span><span class="main"><span class="main"><span class="main"><span>=</span></span></span></span><span class="quoted"><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span class="main"><span>(</span></span></span><span class="main"><span class="main"><span>Î»</span></span></span><span class="main"><span class="bound"><span class="main"><span class="bound"><span>_</span></span></span></span></span><span class="main"><span class="main"><span>.</span></span></span><span> </span><span>borel</span><span class="main"><span class="main"><span>)</span></span></span><span>"</span></span></span></span><span class="main"><span class="main"><span>,</span></span></span><span> </span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="Median.html#offset_16102..16109"><span>assms</span></a><span class="main"><span class="main"><span>(</span></span></span><span>4</span><span class="main"><span class="main"><span>)</span></span></span><span class="main"><span class="main"><span>]</span></span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Median.html#Median.interval_borel|fact"><span>interval_borel</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="Median.html#offset_16102..16109"><span>assms</span></a><span class="main"><span class="main"><span>(</span></span></span><span>1</span><span class="main"><span class="main"><span>)</span></span></span><span class="main"><span>]</span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp</span></span><span>
 
  </span><span class="keyword1"><span class="command"><span>hence</span></span></span><span> </span><span class="entity_def" id="offset_17913..17914">b</span><span class="main"><span>:</span></span><span class="quoted"><span class="quoted"><span>"</span><span>Hoeffding_ineq</span><span> </span><span class="free"><span>M</span></span><span> </span><span class="main"><span>{</span></span><span class="main"><span>0</span></span><span class="main"><span>..&lt;</span></span><span class="free"><span>n</span></span><span class="main"><span>}</span></span><span> </span><span class="skolem"><span>Y</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>Î»</span></span><span class="bound"><span>i</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>0</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>Î»</span></span><span class="bound"><span>i</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>1</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span> 
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span>Hoeffding_ineq_def</span><span> </span><span>indep_interval_bounded_random_variables_def</span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span>prob_space_axioms</span><span> </span><span>indep_interval_bounded_random_variables_axioms_def</span><span> </span><a class="entity_ref" href="Median.html#offset_16493..16499"><span>Y_def</span></a><span> </span><a class="entity_ref" href="Median.html#offset_17716..17723"><span>Y_indep</span></a><span class="main"><span>)</span></span><span>

  </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="entity_def" id="offset_18154..18155">c</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>â</span></span><span class="bound"><span>Ï</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>â</span></span><span class="bound"><span>i</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>0</span></span><span class="main"><span>..&lt;</span></span><span class="free"><span>n</span></span><span class="main"><span>.</span></span><span> </span><span class="skolem"><span>Y</span></span><span> </span><span class="bound"><span>i</span></span><span> </span><span class="bound"><span>Ï</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>&gt;</span></span><span> </span><span class="free"><span>n</span></span><span class="main"><span>/</span></span><span class="numeral"><span>2</span></span><span> </span><span class="main"><span>â¹</span></span><span> </span><a class="entity_ref" href="Median.html#Median.median|const"><span>median</span></a><span> </span><span class="free"><span>n</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>Î»</span></span><span class="bound"><span>i</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>X</span></span><span> </span><span class="bound"><span>i</span></span><span> </span><span class="bound"><span>Ï</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>â</span></span><span> </span><span class="free"><span>I</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="operator"><span>-</span></span><span>
    </span><span class="keyword3"><span class="command"><span>fix</span></span></span><span> </span><span class="skolem"><span>Ï</span></span><span>
    </span><span class="keyword3"><span class="command"><span>assume</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="main"><span>â</span></span><span class="bound"><span>i</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>0</span></span><span class="main"><span>..&lt;</span></span><span class="free"><span>n</span></span><span class="main"><span>.</span></span><span> </span><span class="skolem"><span>Y</span></span><span> </span><span class="bound"><span>i</span></span><span> </span><span class="skolem"><span>Ï</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>&gt;</span></span><span> </span><span class="free"><span>n</span></span><span class="main"><span>/</span></span><span class="numeral"><span>2</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>hence</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>n</span></span><span> </span><span class="main"><span>&lt;</span></span><span> </span><span class="numeral"><span>2</span></span><span> </span><span class="main"><span>*</span></span><span> </span><span>card</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>{</span></span><span class="main"><span>0</span></span><span class="main"><span>..&lt;</span></span><span class="free"><span>n</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>â©</span></span><span> </span><span class="main"><span>{</span></span><span class="bound"><span>i</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>X</span></span><span> </span><span class="bound"><span>i</span></span><span> </span><span class="skolem"><span>Ï</span></span><span> </span><span class="main"><span>â</span></span><span> </span><span class="free"><span>I</span></span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span> 
      </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><a class="entity_ref" href="Median.html#offset_16493..16499"><span>Y_def</span></a><span> </span><span>indicator_def</span><span class="main"><span>)</span></span><span> 
    </span><span class="keyword1"><span class="command"><span>also</span></span></span><span> </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>...</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="numeral"><span>2</span></span><span> </span><span class="main"><span>*</span></span><span> </span><span>card</span><span> </span><span class="main"><span>{</span></span><span class="bound"><span>i</span></span><span class="main"><span>.</span></span><span> </span><span class="bound"><span>i</span></span><span> </span><span class="main"><span>&lt;</span></span><span> </span><span class="free"><span>n</span></span><span> </span><span class="main"><span>â§</span></span><span> </span><span class="free"><span>X</span></span><span> </span><span class="bound"><span>i</span></span><span> </span><span class="skolem"><span>Ï</span></span><span> </span><span class="main"><span>â</span></span><span> </span><span class="free"><span>I</span></span><span class="main"><span>}</span></span><span>"</span></span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><span class="operator"><span>rule</span></span><span> </span><span>arg_cong</span><span class="main"><span class="main"><span>[</span></span></span><span class="keyword2"><span class="keyword"><span class="operator"><span>where</span></span></span></span><span> f</span><span class="main"><span class="main"><span class="main"><span>=</span></span></span></span><span class="quoted"><span class="quoted"><span class="quoted"><span>"</span><span>card</span><span>"</span></span></span></span><span class="main"><span class="main"><span>]</span></span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>rule</span></span><span> </span><span>order_antisym</span><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><span class="operator"><span>rule</span></span><span> </span><span>subsetI</span><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><span class="operator"><span>simp</span></span><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><span class="operator"><span>rule</span></span><span> </span><span>subsetI</span><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><span class="operator"><span>simp</span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span>finally</span></span></span><span> </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="numeral"><span>2</span></span><span> </span><span class="main"><span>*</span></span><span> </span><span>card</span><span> </span><span class="main"><span>{</span></span><span class="bound"><span>i</span></span><span class="main"><span>.</span></span><span> </span><span class="bound"><span>i</span></span><span> </span><span class="main"><span>&lt;</span></span><span> </span><span class="free"><span>n</span></span><span> </span><span class="main"><span>â§</span></span><span> </span><span class="free"><span>X</span></span><span> </span><span class="bound"><span>i</span></span><span> </span><span class="skolem"><span>Ï</span></span><span> </span><span class="main"><span>â</span></span><span> </span><span class="free"><span>I</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>&gt;</span></span><span> </span><span class="free"><span>n</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp</span></span><span>
    </span><span class="keyword3"><span class="command"><span>thus</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Median.html#Median.median|const"><span>median</span></a><span> </span><span class="free"><span>n</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>Î»</span></span><span class="bound"><span>i</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>X</span></span><span> </span><span class="bound"><span>i</span></span><span> </span><span class="skolem"><span>Ï</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>â</span></span><span> </span><span class="free"><span>I</span></span><span>"</span></span></span><span>
      </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Median.html#Median.median_est|fact"><span>median_est</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="Median.html#offset_16102..16109"><span>assms</span></a><span class="main"><span class="main"><span>(</span></span></span><span>1</span><span class="main"><span class="main"><span>)</span></span></span><span class="main"><span>]</span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp</span></span><span>
  </span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>

  </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>1</span></span><span> </span><span class="main"><span>-</span></span><span> </span><span class="free"><span>Îµ</span></span><span> </span><span class="main"><span>â¤</span></span><span> </span><span class="main"><span>1</span></span><span class="main"><span>-</span></span><span> </span><span>exp</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>-</span></span><span> </span><span class="main"><span>(</span></span><span class="numeral"><span>2</span></span><span> </span><span class="main"><span>*</span></span><span> </span><span class="free"><span>Î±</span></span><span class="main"><span><span class="hidden">â§</span><sup>2</sup></span></span><span> </span><span class="main"><span>*</span></span><span> </span><span>real</span><span> </span><span class="free"><span>n</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span> 
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><span class="operator"><span>subst</span></span><span> </span><span>ln_ge_iff</span><span class="main"><span class="main"><span>[</span></span></span><span class="operator"><span>symmetric</span></span><span class="main"><span class="main"><span>]</span></span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Median.html#offset_16102..16109"><span>assms</span></a><span class="main"><span>(</span></span><span>3</span><span class="main"><span>)</span></span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="operator"><span>simp</span></span><span>
    </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Median.html#offset_16102..16109"><span>assms</span></a><span class="main"><span>(</span></span><span>5</span><span class="main"><span>)</span></span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>subst</span></span><span> </span><span class="main"><span class="main"><span>(</span></span></span><span class="quasi_keyword"><span>asm</span></span><span class="main"><span class="main"><span>)</span></span></span><span> </span><span>pos_divide_le_eq</span><span class="main"><span>)</span></span><span> 
     </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Median.html#offset_16102..16109"><span>assms</span></a><span class="main"><span class="main"><span>(</span></span></span><span>2</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><span>power2_eq_square</span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><span>mult_of_nat_commute</span><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>also</span></span></span><span> </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>...</span></span><span> </span><span class="main"><span>â¤</span></span><span> </span><span class="main"><span>1</span></span><span class="main"><span>-</span></span><span> </span><span>exp</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>-</span></span><span> </span><span class="main"><span>(</span></span><span class="numeral"><span>2</span></span><span> </span><span class="main"><span>*</span></span><span> </span><span class="skolem"><span>t</span></span><span class="main"><span><span class="hidden">â§</span><sup>2</sup></span></span><span> </span><span class="main"><span>/</span></span><span> </span><span>real</span><span> </span><span class="free"><span>n</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span> 
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="operator"><span>simp</span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>subst</span></span><span> </span><span>pos_le_divide_eq</span><span class="main"><span>)</span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Median.html#offset_16880..16886"><span>n_ge_0</span></a><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="operator"><span>simp</span></span><span>
    </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Median.html#offset_17618..17627"><span>t_ge_a_sq</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>linarith</span></span><span>
  </span><span class="keyword1"><span class="command"><span>also</span></span></span><span> </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>...</span></span><span> </span><span class="main"><span>â¤</span></span><span> </span><span class="main"><span>1</span></span><span> </span><span class="main"><span>-</span></span><span> </span><span class="keyword1"><span>ð«(</span></span><span class="bound"><span class="bound"><span>Ï</span></span></span><span> </span><span class="keyword1"><span>in</span></span><span> </span><span class="free"><span class="free"><span>M</span></span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>â</span></span><span class="bound"><span>i</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>0</span></span><span class="main"><span>..&lt;</span></span><span class="free"><span>n</span></span><span class="main"><span>.</span></span><span> </span><span class="skolem"><span>Y</span></span><span> </span><span class="bound"><span>i</span></span><span> </span><span class="bound"><span>Ï</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>â¤</span></span><span> </span><span class="free"><span>n</span></span><span class="main"><span>/</span></span><span class="numeral"><span>2</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span> 
    </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><span>Hoeffding_ineq.Hoeffding_ineq_le</span><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="Median.html#offset_17913..17914"><span>b</span></a><span class="main"><span>,</span></span><span> </span><span class="keyword2"><span class="keyword"><span class="operator"><span>where</span></span></span></span><span> Îµ</span><span class="main"><span class="main"><span>=</span></span></span><span class="quoted"><span class="quoted"><span>"</span><span class="skolem"><span>t</span></span><span>"</span></span></span><span class="main"><span>,</span></span><span> </span><span class="operator"><span>simplified</span></span><span class="main"><span>]</span></span><span> </span><a class="entity_ref" href="Median.html#offset_16880..16886"><span>n_ge_0</span></a><span> </span><a class="entity_ref" href="Median.html#offset_17524..17530"><span>t_ge_0</span></a><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><a class="entity_ref" href="Median.html#offset_16564..16570"><span>t_def</span></a><span class="main"><span>)</span></span><span> 
  </span><span class="keyword1"><span class="command"><span>also</span></span></span><span> </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>...</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword1"><span>ð«(</span></span><span class="bound"><span class="bound"><span>Ï</span></span></span><span> </span><span class="keyword1"><span>in</span></span><span> </span><span class="free"><span class="free"><span>M</span></span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>â</span></span><span class="bound"><span>i</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>0</span></span><span class="main"><span>..&lt;</span></span><span class="free"><span>n</span></span><span class="main"><span>.</span></span><span> </span><span class="skolem"><span>Y</span></span><span> </span><span class="bound"><span>i</span></span><span> </span><span class="bound"><span>Ï</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>&gt;</span></span><span> </span><span class="free"><span>n</span></span><span class="main"><span>/</span></span><span class="numeral"><span>2</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span> 
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>subst</span></span><span> </span><span>prob_compl</span><span class="main"><span class="main"><span>[</span></span></span><span class="operator"><span>symmetric</span></span><span class="main"><span class="main"><span>]</span></span></span><span class="main"><span>)</span></span><span>
     </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="operator"><span>measurable</span></span><span>
     </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Median.html#offset_17716..17723"><span>Y_indep</span></a><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span>indep_vars_def</span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>rule</span></span><span> </span><span>arg_cong2</span><span class="main"><span class="main"><span>[</span></span></span><span class="keyword2"><span class="keyword"><span class="operator"><span>where</span></span></span></span><span> f</span><span class="main"><span class="main"><span class="main"><span>=</span></span></span></span><span class="quoted"><span class="quoted"><span class="quoted"><span>"</span><span>measure</span><span>"</span></span></span></span><span class="main"><span class="main"><span>]</span></span></span><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><span class="operator"><span>simp</span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>rule</span></span><span> </span><span>order_antisym</span><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><span class="operator"><span>rule</span></span><span> </span><span>subsetI</span><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span>not_le</span><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><span class="operator"><span>rule</span></span><span> </span><span>subsetI</span><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span>not_le</span><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>also</span></span></span><span> </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>...</span></span><span> </span><span class="main"><span>â¤</span></span><span> </span><span class="keyword1"><span>ð«(</span></span><span class="bound"><span class="bound"><span>Ï</span></span></span><span> </span><span class="keyword1"><span>in</span></span><span> </span><span class="free"><span class="free"><span>M</span></span></span><span class="main"><span>.</span></span><span> </span><a class="entity_ref" href="Median.html#Median.median|const"><span>median</span></a><span> </span><span class="free"><span>n</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>Î»</span></span><span class="bound"><span>i</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>X</span></span><span> </span><span class="bound"><span>i</span></span><span> </span><span class="bound"><span>Ï</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>â</span></span><span> </span><span class="free"><span>I</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>rule</span></span><span> </span><span>finite_measure_mono</span><span class="main"><span>)</span></span><span>
     </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>rule</span></span><span> </span><span>subsetI</span><span class="main"><span>)</span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Median.html#offset_18154..18155"><span>c</span></a><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="operator"><span>simp</span></span><span> 
    </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Median.html#Median.interval_borel|fact"><span>interval_borel</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="Median.html#offset_16102..16109"><span>assms</span></a><span class="main"><span class="main"><span>(</span></span></span><span>1</span><span class="main"><span class="main"><span>)</span></span></span><span class="main"><span>]</span></span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="operator"><span>measurable</span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>rule</span></span><span> </span><a class="entity_ref" href="Median.html#Median.median_measurable|fact"><span>median_measurable</span></a><span class="main"><span class="main"><span>[</span></span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="Median.html#offset_16845..16851"><span>n_ge_1</span></a><span class="main"><span class="main"><span>]</span></span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Median.html#offset_16102..16109"><span>assms</span></a><span class="main"><span>(</span></span><span>4</span><span class="main"><span>)</span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span>indep_vars_def</span><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>finally</span></span></span><span> </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?thesis</span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp</span></span><span>
</span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>text</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>â¹</span><span>This is a specialization of the above to closed real intervals.</span><span>âº</span></span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_20002..20011">corollary</span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span>prob_space</span><span class="main"><span>)</span></span><span> </span><span class="entity_def" id="Median.measure_pmf.median_bound_1|fact"><span class="entity_def" id="Median.prob_space.median_bound_1|fact"><span class="entity_def" id="Median.measure_pmf.median_bound_1|thm"><span class="entity_def" id="Median.prob_space.median_bound_1|thm"><span class="entity_def" id="offset_20028..20042">median_bound_1</span></span></span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>Î±</span></span><span> </span><span class="main"><span>&gt;</span></span><span> </span><span class="main"><span>0</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>Îµ</span></span><span> </span><span class="main"><span>â</span></span><span> </span><span class="main"><span>{</span></span><span class="main"><span>0</span></span><span class="main"><span>&lt;..&lt;</span></span><span class="main"><span>1</span></span><span class="main"><span>}</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span>indep_vars</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>Î»</span></span><span class="main"><span class="bound"><span>_</span></span></span><span class="main"><span>.</span></span><span> </span><span>borel</span><span class="main"><span>)</span></span><span> </span><span class="free"><span>X</span></span><span> </span><span class="main"><span>{</span></span><span class="main"><span>0</span></span><span class="main"><span>..&lt;</span></span><span class="free"><span>n</span></span><span class="main"><span>}</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>n</span></span><span> </span><span class="main"><span>â¥</span></span><span> </span><span class="main"><span>-</span></span><span> </span><span>ln</span><span> </span><span class="free"><span>Îµ</span></span><span> </span><span class="main"><span>/</span></span><span> </span><span class="main"><span>(</span></span><span class="numeral"><span>2</span></span><span> </span><span class="main"><span>*</span></span><span> </span><span class="free"><span>Î±</span></span><span class="main"><span><span class="hidden">â§</span><sup>2</sup></span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>â</span></span><span class="bound"><span>i</span></span><span> </span><span class="main"><span>â</span></span><span> </span><span class="main"><span>{</span></span><span class="main"><span>0</span></span><span class="main"><span>..&lt;</span></span><span class="free"><span>n</span></span><span class="main"><span>}</span></span><span class="main"><span>.</span></span><span> </span><span class="keyword1"><span>ð«(</span></span><span class="bound"><span class="bound"><span>Ï</span></span></span><span> </span><span class="keyword1"><span>in</span></span><span> </span><span class="free"><span class="free"><span>M</span></span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>X</span></span><span> </span><span class="bound"><span>i</span></span><span> </span><span class="bound"><span>Ï</span></span><span> </span><span class="main"><span>â</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>{</span></span><span class="free"><span>a</span></span><span class="main"><span>..</span></span><span class="free"><span>b</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>::</span></span><span> </span><span>real</span><span> </span><span>set</span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>â¥</span></span><span> </span><span class="main"><span>1</span></span><span class="main"><span>/</span></span><span class="numeral"><span>2</span></span><span class="main"><span>+</span></span><span class="free"><span>Î±</span></span><span>"</span></span></span><span> 
  </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="keyword1"><span>ð«(</span></span><span class="bound"><span class="bound"><span>Ï</span></span></span><span> </span><span class="keyword1"><span>in</span></span><span> </span><span class="free"><span class="free"><span>M</span></span></span><span class="main"><span>.</span></span><span> </span><a class="entity_ref" href="Median.html#Median.median|const"><span>median</span></a><span> </span><span class="free"><span>n</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>Î»</span></span><span class="bound"><span>i</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>X</span></span><span> </span><span class="bound"><span>i</span></span><span> </span><span class="bound"><span>Ï</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>â</span></span><span> </span><span class="main"><span>{</span></span><span class="free"><span>a</span></span><span class="main"><span>..</span></span><span class="free"><span>b</span></span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>â¥</span></span><span> </span><span class="main"><span>1</span></span><span class="main"><span>-</span></span><span class="free"><span>Îµ</span></span><span>"</span></span></span><span> 
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>rule</span></span><span> </span><a class="entity_ref" href="Median.html#offset_16126..16138"><span>median_bound</span></a><span class="main"><span class="main"><span>[</span></span></span><span class="operator"><span>OF</span></span><span> _ </span><a class="entity_ref" href="Median.html#offset_20002..20011"><span>assms</span></a><span class="main"><span class="main"><span>(</span></span></span><span>1</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="Median.html#offset_20002..20011"><span>assms</span></a><span class="main"><span class="main"><span>(</span></span></span><span>2</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="Median.html#offset_20002..20011"><span>assms</span></a><span class="main"><span class="main"><span>(</span></span></span><span>3</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="Median.html#offset_20002..20011"><span>assms</span></a><span class="main"><span class="main"><span>(</span></span></span><span>4</span><span class="main"><span class="main"><span>)</span></span></span><span class="main"><span class="main"><span>]</span></span></span><span class="main"><span>)</span></span><span>
   </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><a class="entity_ref" href="Median.html#Median.interval_def|fact"><span>interval_def</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Median.html#offset_20002..20011"><span>assms</span></a><span class="main"><span>(</span></span><span>5</span><span class="main"><span>)</span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>auto</span></span><span>

</span><span class="keyword1"><span class="command"><span>text</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>â¹</span><span>This is a specialization of the above, where $\alpha = \frac{1}{6}$ and the interval is described
</span><span>using a mid point </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>term</span></span><span> </span><span class="quoted"><span>"</span><span class="free"><span>Î¼</span></span><span>"</span></span><span class="antiquote"><span>}</span></span></span><span> and radius </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>term</span></span><span> </span><span class="quoted"><span>"</span><span class="free"><span>Î´</span></span><span>"</span></span><span class="antiquote"><span>}</span></span></span><span>. The choice of $\alpha = \frac{1}{6}$ implies
</span><span>a success probability per random variable of $\frac{2}{3}$. It is a commonly chosen success
</span><span>probability for Monte-Carlo algorithms (cf. \cite[\textsection 4]{baryossef2002} or
</span><span>\cite[\textsection 1]{kane2010}).</span><span>âº</span></span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_20844..20853">corollary</span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span>prob_space</span><span class="main"><span>)</span></span><span> </span><span class="entity_def" id="Median.measure_pmf.median_bound_2|fact"><span class="entity_def" id="Median.prob_space.median_bound_2|fact"><span class="entity_def" id="Median.measure_pmf.median_bound_2|thm"><span class="entity_def" id="Median.prob_space.median_bound_2|thm"><span>median_bound_2</span></span></span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>fixes</span></span></span><span> </span><span class="free"><span>Î¼</span></span><span> </span><span class="free"><span>Î´</span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span>real</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>Îµ</span></span><span> </span><span class="main"><span>â</span></span><span> </span><span class="main"><span>{</span></span><span class="main"><span>0</span></span><span class="main"><span>&lt;..&lt;</span></span><span class="main"><span>1</span></span><span class="main"><span>}</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span>indep_vars</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>Î»</span></span><span class="main"><span class="bound"><span>_</span></span></span><span class="main"><span>.</span></span><span> </span><span>borel</span><span class="main"><span>)</span></span><span> </span><span class="free"><span>X</span></span><span> </span><span class="main"><span>{</span></span><span class="main"><span>0</span></span><span class="main"><span>..&lt;</span></span><span class="free"><span>n</span></span><span class="main"><span>}</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>n</span></span><span> </span><span class="main"><span>â¥</span></span><span> </span><span class="main"><span>-</span></span><span class="numeral"><span>18</span></span><span> </span><span class="main"><span>*</span></span><span> </span><span>ln</span><span> </span><span class="free"><span>Îµ</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>â</span></span><span class="bound"><span>i</span></span><span class="main"><span>.</span></span><span> </span><span class="bound"><span>i</span></span><span> </span><span class="main"><span>&lt;</span></span><span> </span><span class="free"><span>n</span></span><span> </span><span class="main"><span>â¹</span></span><span> </span><span class="keyword1"><span>ð«(</span></span><span class="bound"><span class="bound"><span>Ï</span></span></span><span> </span><span class="keyword1"><span>in</span></span><span> </span><span class="free"><span class="free"><span>M</span></span></span><span class="main"><span>.</span></span><span> </span><span>abs</span><span> </span><span class="main"><span>(</span></span><span class="free"><span>X</span></span><span> </span><span class="bound"><span>i</span></span><span> </span><span class="bound"><span>Ï</span></span><span> </span><span class="main"><span>-</span></span><span> </span><span class="free"><span>Î¼</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>&gt;</span></span><span> </span><span class="free"><span>Î´</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>â¤</span></span><span> </span><span class="main"><span>1</span></span><span class="main"><span>/</span></span><span class="numeral"><span>3</span></span><span>"</span></span></span><span> 
  </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="keyword1"><span>ð«(</span></span><span class="bound"><span class="bound"><span>Ï</span></span></span><span> </span><span class="keyword1"><span>in</span></span><span> </span><span class="free"><span class="free"><span>M</span></span></span><span class="main"><span>.</span></span><span> </span><span>abs</span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Median.html#Median.median|const"><span>median</span></a><span> </span><span class="free"><span>n</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>Î»</span></span><span class="bound"><span>i</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>X</span></span><span> </span><span class="bound"><span>i</span></span><span> </span><span class="bound"><span>Ï</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>-</span></span><span> </span><span class="free"><span>Î¼</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>â¤</span></span><span> </span><span class="free"><span>Î´</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>â¥</span></span><span> </span><span class="main"><span>1</span></span><span class="main"><span>-</span></span><span class="free"><span>Îµ</span></span><span>"</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="operator"><span>-</span></span><span>
  </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="entity_def" id="offset_21142..21143">b</span><span class="main"><span>:</span></span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>â</span></span><span class="bound"><span>i</span></span><span class="main"><span>.</span></span><span> </span><span class="bound"><span>i</span></span><span> </span><span class="main"><span>&lt;</span></span><span> </span><span class="free"><span>n</span></span><span> </span><span class="main"><span>â¹</span></span><span> </span><span>space</span><span> </span><span class="free"><span>M</span></span><span> </span><span class="main"><span>-</span></span><span> </span><span class="main"><span>{</span></span><span class="bound"><span class="bound"><span>Ï</span></span></span><span> </span><span class="main"><span>â</span></span><span> </span><span>space</span><span> </span><span class="free"><span>M</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>X</span></span><span> </span><span class="bound"><span>i</span></span><span> </span><span class="bound"><span>Ï</span></span><span> </span><span class="main"><span>â</span></span><span> </span><span class="main"><span>{</span></span><span class="free"><span>Î¼</span></span><span> </span><span class="main"><span>-</span></span><span> </span><span class="free"><span>Î´</span></span><span class="main"><span>..</span></span><span class="free"><span>Î¼</span></span><span> </span><span class="main"><span>+</span></span><span> </span><span class="free"><span>Î´</span></span><span class="main"><span>}</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>=</span></span><span>  </span><span class="main"><span>{</span></span><span class="bound"><span class="bound"><span>Ï</span></span></span><span> </span><span class="main"><span>â</span></span><span> </span><span>space</span><span> </span><span class="free"><span>M</span></span><span class="main"><span>.</span></span><span> </span><span>abs</span><span> </span><span class="main"><span>(</span></span><span class="free"><span>X</span></span><span> </span><span class="bound"><span>i</span></span><span> </span><span class="bound"><span>Ï</span></span><span> </span><span class="main"><span>-</span></span><span> </span><span class="free"><span>Î¼</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>&gt;</span></span><span> </span><span class="free"><span>Î´</span></span><span class="main"><span>}</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>rule</span></span><span> </span><span>order_antisym</span><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><span class="operator"><span>rule</span></span><span> </span><span>subsetI</span><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><span class="operator"><span>simp</span></span><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><span class="operator"><span>linarith</span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>rule</span></span><span> </span><span>subsetI</span><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><span class="operator"><span>simp</span></span><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><span class="operator"><span>linarith</span></span><span class="main"><span>)</span></span><span>

  </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>â</span></span><span class="bound"><span>i</span></span><span class="main"><span>.</span></span><span> </span><span class="bound"><span>i</span></span><span> </span><span class="main"><span>&lt;</span></span><span> </span><span class="free"><span>n</span></span><span> </span><span class="main"><span>â¹</span></span><span> </span><span class="main"><span>1</span></span><span> </span><span class="main"><span>-</span></span><span> </span><span class="keyword1"><span>ð«(</span></span><span class="bound"><span class="bound"><span>Ï</span></span></span><span> </span><span class="keyword1"><span>in</span></span><span> </span><span class="free"><span class="free"><span>M</span></span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>X</span></span><span> </span><span class="bound"><span>i</span></span><span> </span><span class="bound"><span>Ï</span></span><span> </span><span class="main"><span>â</span></span><span> </span><span class="main"><span>{</span></span><span class="free"><span>Î¼</span></span><span class="main"><span>-</span></span><span> </span><span class="free"><span>Î´</span></span><span class="main"><span>..</span></span><span class="free"><span>Î¼</span></span><span class="main"><span>+</span></span><span class="free"><span>Î´</span></span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>â¤</span></span><span> </span><span class="main"><span>1</span></span><span class="main"><span>/</span></span><span class="numeral"><span>3</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>subst</span></span><span> </span><span>prob_compl</span><span class="main"><span class="main"><span>[</span></span></span><span class="operator"><span>symmetric</span></span><span class="main"><span class="main"><span>]</span></span></span><span class="main"><span>)</span></span><span>
     </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>measurable</span></span><span class="main"><span>)</span></span><span>
     </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Median.html#offset_20844..20853"><span>assms</span></a><span class="main"><span>(</span></span><span>2</span><span class="main"><span>)</span></span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span>indep_vars_def</span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>subst</span></span><span> </span><a class="entity_ref" href="Median.html#offset_21142..21143"><span>b</span></a><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><span class="operator"><span>simp</span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Median.html#offset_20844..20853"><span>assms</span></a><span class="main"><span>(</span></span><span>4</span><span class="main"><span>)</span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp</span></span><span>

  </span><span class="keyword1"><span class="command"><span>hence</span></span></span><span> </span><span class="entity_def" id="offset_21584..21585">a</span><span class="main"><span>:</span></span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>â</span></span><span class="bound"><span>i</span></span><span class="main"><span>.</span></span><span> </span><span class="bound"><span>i</span></span><span> </span><span class="main"><span>&lt;</span></span><span> </span><span class="free"><span>n</span></span><span> </span><span class="main"><span>â¹</span></span><span> </span><span class="keyword1"><span>ð«(</span></span><span class="bound"><span class="bound"><span>Ï</span></span></span><span> </span><span class="keyword1"><span>in</span></span><span> </span><span class="free"><span class="free"><span>M</span></span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>X</span></span><span> </span><span class="bound"><span>i</span></span><span> </span><span class="bound"><span>Ï</span></span><span> </span><span class="main"><span>â</span></span><span> </span><span class="main"><span>{</span></span><span class="free"><span>Î¼</span></span><span class="main"><span>-</span></span><span> </span><span class="free"><span>Î´</span></span><span class="main"><span>..</span></span><span class="free"><span>Î¼</span></span><span class="main"><span>+</span></span><span class="free"><span>Î´</span></span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>â¥</span></span><span> </span><span class="numeral"><span>2</span></span><span class="main"><span>/</span></span><span class="numeral"><span>3</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp</span></span><span>
  
  </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>1</span></span><span class="main"><span>-</span></span><span class="free"><span>Îµ</span></span><span> </span><span class="main"><span>â¤</span></span><span> </span><span class="keyword1"><span>ð«(</span></span><span class="bound"><span class="bound"><span>Ï</span></span></span><span> </span><span class="keyword1"><span>in</span></span><span> </span><span class="free"><span class="free"><span>M</span></span></span><span class="main"><span>.</span></span><span> </span><a class="entity_ref" href="Median.html#Median.median|const"><span>median</span></a><span> </span><span class="free"><span>n</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>Î»</span></span><span class="bound"><span>i</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>X</span></span><span> </span><span class="bound"><span>i</span></span><span> </span><span class="bound"><span>Ï</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>â</span></span><span> </span><span class="main"><span>{</span></span><span class="free"><span>Î¼</span></span><span class="main"><span>-</span></span><span class="free"><span>Î´</span></span><span class="main"><span>..</span></span><span class="free"><span>Î¼</span></span><span class="main"><span>+</span></span><span class="free"><span>Î´</span></span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>rule</span></span><span> </span><a class="entity_ref" href="Median.html#offset_20028..20042"><span>median_bound_1</span></a><span class="main"><span class="main"><span>[</span></span></span><span class="operator"><span>OF</span></span><span> _ </span><a class="entity_ref" href="Median.html#offset_20844..20853"><span>assms</span></a><span class="main"><span class="main"><span>(</span></span></span><span>1</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="Median.html#offset_20844..20853"><span>assms</span></a><span class="main"><span class="main"><span>(</span></span></span><span>2</span><span class="main"><span class="main"><span>)</span></span></span><span class="main"><span class="main"><span>,</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span class="operator"><span>where</span></span></span></span><span> Î±</span><span class="main"><span class="main"><span class="main"><span>=</span></span></span></span><span class="quoted"><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span class="main"><span>1</span></span></span><span class="main"><span class="main"><span>/</span></span></span><span class="numeral"><span class="numeral"><span>6</span></span></span><span>"</span></span></span></span><span class="main"><span class="main"><span>]</span></span></span><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><span class="operator"><span>simp</span></span><span class="main"><span>)</span></span><span> 
     </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Median.html#offset_20844..20853"><span>assms</span></a><span class="main"><span>(</span></span><span>3</span><span class="main"><span>)</span></span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span>power2_eq_square</span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Median.html#offset_21584..21585"><span>a</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp</span></span><span>
  </span><span class="keyword1"><span class="command"><span>also</span></span></span><span> </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>...</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword1"><span>ð«(</span></span><span class="bound"><span class="bound"><span>Ï</span></span></span><span> </span><span class="keyword1"><span>in</span></span><span> </span><span class="free"><span class="free"><span>M</span></span></span><span class="main"><span>.</span></span><span> </span><span>abs</span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Median.html#Median.median|const"><span>median</span></a><span> </span><span class="free"><span>n</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>Î»</span></span><span class="bound"><span>i</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>X</span></span><span> </span><span class="bound"><span>i</span></span><span> </span><span class="bound"><span>Ï</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>-</span></span><span> </span><span class="free"><span>Î¼</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>â¤</span></span><span> </span><span class="free"><span>Î´</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>rule</span></span><span> </span><span>arg_cong2</span><span class="main"><span class="main"><span>[</span></span></span><span class="keyword2"><span class="keyword"><span class="operator"><span>where</span></span></span></span><span> f</span><span class="main"><span class="main"><span class="main"><span>=</span></span></span></span><span class="quoted"><span class="quoted"><span class="quoted"><span>"</span><span>measure</span><span>"</span></span></span></span><span class="main"><span class="main"><span>]</span></span></span><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><span class="operator"><span>simp</span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>rule</span></span><span> </span><span>order_antisym</span><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><span class="operator"><span>rule</span></span><span> </span><span>subsetI</span><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><span class="operator"><span>simp</span></span><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><span class="operator"><span>linarith</span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>rule</span></span><span> </span><span>subsetI</span><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><span class="operator"><span>simp</span></span><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><span class="operator"><span>linarith</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>finally</span></span></span><span> </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?thesis</span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp</span></span><span>
</span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>section</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>â¹</span><span>Some additional results about the median</span><span>âº</span></span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_22165..22170">lemma</span></span></span><span> </span><span class="entity_def" id="Median.sorted_mono_map|fact"><span class="entity_def" id="Median.sorted_mono_map|thm"><span>sorted_mono_map</span></span></span><span class="main"><span>:</span></span><span> 
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span>sorted</span><span> </span><span class="free"><span>xs</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span>mono</span><span> </span><span class="free"><span>f</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span>sorted</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="free"><span>f</span></span><span> </span><span class="free"><span>xs</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Median.html#offset_22165..22170"><span>assms</span></a><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span>sorted_wrt_map</span><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>rule</span></span><span> </span><span>sorted_wrt_mono_rel</span><span class="main"><span class="main"><span>[</span></span></span><span class="keyword2"><span class="keyword"><span class="operator"><span>where</span></span></span></span><span> P</span><span class="main"><span class="main"><span class="main"><span>=</span></span></span></span><span class="quoted"><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span class="main"><span>(â¤)</span></span></span><span>"</span></span></span></span><span class="main"><span class="main"><span>]</span></span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span>mono_def</span><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><span class="operator"><span>simp</span></span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="command"><span>text</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>â¹</span><span>This could be added to </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>theory</span></span><span> "</span><a href="../../HOL/HOL/List.html"><span>HOL.List</span></a><span>"</span><span class="antiquote"><span>}</span></span></span><span>:</span><span>âº</span></span></span><span>
</span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_22438..22443">lemma</span></span></span><span> </span><span class="entity_def" id="Median.map_sort|fact"><span class="entity_def" id="Median.map_sort|thm"><span>map_sort</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span>mono</span><span> </span><span class="free"><span>f</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span>sort</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="free"><span>f</span></span><span> </span><span class="free"><span>xs</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="free"><span>f</span></span><span> </span><span class="main"><span>(</span></span><span>sort</span><span> </span><span class="free"><span>xs</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>rule</span></span><span> </span><span>properties_for_sort</span><span class="main"><span>)</span></span><span>
   </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="operator"><span>simp</span></span><span>
  </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>rule</span></span><span> </span><a class="entity_ref" href="Median.html#Median.sorted_mono_map|fact"><span>sorted_mono_map</span></a><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><span class="operator"><span>simp</span></span><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><a class="entity_ref" href="Median.html#offset_22438..22443"><span>assms</span></a><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_22617..22622">lemma</span></span></span><span> </span><span class="entity_def" id="Median.median_cong|fact"><span class="entity_def" id="Median.median_cong|thm"><span>median_cong</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>â</span></span><span class="bound"><span>i</span></span><span class="main"><span>.</span></span><span> </span><span class="bound"><span>i</span></span><span> </span><span class="main"><span>&lt;</span></span><span> </span><span class="free"><span>n</span></span><span> </span><span class="main"><span>â¹</span></span><span> </span><span class="free"><span>f</span></span><span> </span><span class="bound"><span>i</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="free"><span>g</span></span><span> </span><span class="bound"><span>i</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Median.html#Median.median|const"><span>median</span></a><span> </span><span class="free"><span>n</span></span><span> </span><span class="free"><span>f</span></span><span> </span><span class="main"><span>=</span></span><span> </span><a class="entity_ref" href="Median.html#Median.median|const"><span>median</span></a><span> </span><span class="free"><span>n</span></span><span> </span><span class="free"><span>g</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>cases</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>n</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>0</span></span><span>"</span></span></span><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><a class="entity_ref" href="Median.html#Median.median_def|fact"><span>median_def</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><a class="entity_ref" href="Median.html#Median.median_def|fact"><span>median_def</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>rule</span></span><span> </span><span>arg_cong2</span><span class="main"><span class="main"><span>[</span></span></span><span class="keyword2"><span class="keyword"><span class="operator"><span>where</span></span></span></span><span> f</span><span class="main"><span class="main"><span class="main"><span>=</span></span></span></span><span class="quoted"><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span class="main"><span>(!)</span></span></span><span>"</span></span></span></span><span class="main"><span class="main"><span>]</span></span></span><span class="main"><span>)</span></span><span>
   </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>rule</span></span><span> </span><span>arg_cong</span><span class="main"><span class="main"><span>[</span></span></span><span class="keyword2"><span class="keyword"><span class="operator"><span>where</span></span></span></span><span> f</span><span class="main"><span class="main"><span class="main"><span>=</span></span></span></span><span class="quoted"><span class="quoted"><span class="quoted"><span>"</span><span>sort</span><span>"</span></span></span></span><span class="main"><span class="main"><span>]</span></span></span><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><span class="operator"><span>rule</span></span><span> </span><span>map_cong</span><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><span class="operator"><span>simp</span></span><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><a class="entity_ref" href="Median.html#offset_22617..22622"><span>assms</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp</span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Median.median_restrict|fact"><span class="entity_def" id="Median.median_restrict|thm"><span>median_restrict</span></span></span><span class="main"><span>:</span></span><span> 
  </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Median.html#Median.median|const"><span>median</span></a><span> </span><span class="free"><span>n</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>Î»</span></span><span class="bound"><span>i</span></span><span> </span><span class="main"><span>â</span></span><span> </span><span class="main"><span>{</span></span><span class="main"><span>0</span></span><span class="main"><span>..&lt;</span></span><span class="free"><span>n</span></span><span class="main"><span>}</span></span><span class="main"><span>.</span></span><span class="free"><span>f</span></span><span> </span><span class="bound"><span>i</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><a class="entity_ref" href="Median.html#Median.median|const"><span>median</span></a><span> </span><span class="free"><span>n</span></span><span> </span><span class="free"><span>f</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>rule</span></span><span> </span><a class="entity_ref" href="Median.html#Median.median_cong|fact"><span>median_cong</span></a><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><span class="operator"><span>simp</span></span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_23008..23013">lemma</span></span></span><span> </span><span class="entity_def" id="Median.median_commute_mono|fact"><span class="entity_def" id="Median.median_commute_mono|thm"><span>median_commute_mono</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>n</span></span><span> </span><span class="main"><span>&gt;</span></span><span> </span><span class="main"><span>0</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span>mono</span><span> </span><span class="free"><span>g</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>g</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Median.html#Median.median|const"><span>median</span></a><span> </span><span class="free"><span>n</span></span><span> </span><span class="free"><span>f</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><a class="entity_ref" href="Median.html#Median.median|const"><span>median</span></a><span> </span><span class="free"><span>n</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>g</span></span><span> </span><span class="main"><span>â</span></span><span> </span><span class="free"><span>f</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Median.html#Median.median_def|fact"><span>median_def</span></a><span> </span><span class="quasi_keyword"><span>del</span></span><span class="main"><span class="main"><span>:</span></span></span><span>map_map</span><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>subst</span></span><span> </span><span>map_map</span><span class="main"><span class="main"><span>[</span></span></span><span class="operator"><span>symmetric</span></span><span class="main"><span class="main"><span>]</span></span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>subst</span></span><span> </span><a class="entity_ref" href="Median.html#Median.map_sort|fact"><span>map_sort</span></a><span class="main"><span class="main"><span>[</span></span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="Median.html#offset_23008..23013"><span>assms</span></a><span class="main"><span class="main"><span>(</span></span></span><span>2</span><span class="main"><span class="main"><span>)</span></span></span><span class="main"><span class="main"><span>]</span></span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>subst</span></span><span> </span><span>nth_map</span><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><span class="operator"><span>simp</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Median.html#offset_23008..23013"><span>assms</span></a><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="operator"><span>fastforce</span></span><span>
  </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp</span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_23301..23306">lemma</span></span></span><span> </span><span class="entity_def" id="Median.median_rat|fact"><span class="entity_def" id="Median.median_rat|thm"><span>median_rat</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>n</span></span><span> </span><span class="main"><span>&gt;</span></span><span> </span><span class="main"><span>0</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span>real_of_rat</span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Median.html#Median.median|const"><span>median</span></a><span> </span><span class="free"><span>n</span></span><span> </span><span class="free"><span>f</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><a class="entity_ref" href="Median.html#Median.median|const"><span>median</span></a><span> </span><span class="free"><span>n</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>Î»</span></span><span class="bound"><span>i</span></span><span class="main"><span>.</span></span><span> </span><span>real_of_rat</span><span> </span><span class="main"><span>(</span></span><span class="free"><span>f</span></span><span> </span><span class="bound"><span>i</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>subst</span></span><span> </span><span class="main"><span class="main"><span>(</span></span></span><span>2</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><span>comp_def</span><span class="main"><span class="main"><span>[</span></span></span><span class="keyword2"><span class="keyword"><span class="operator"><span>where</span></span></span></span><span> g</span><span class="main"><span class="main"><span class="main"><span>=</span></span></span></span><span class="quoted"><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span class="free"><span>f</span></span></span><span>"</span></span></span></span><span class="main"><span class="main"><span>,</span></span></span><span> </span><span class="operator"><span>symmetric</span></span><span class="main"><span class="main"><span>]</span></span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>rule</span></span><span> </span><a class="entity_ref" href="Median.html#Median.median_commute_mono|fact"><span>median_commute_mono</span></a><span class="main"><span class="main"><span>[</span></span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="Median.html#offset_23301..23306"><span>assms</span></a><span class="main"><span class="main"><span>(</span></span></span><span>1</span><span class="main"><span class="main"><span>)</span></span></span><span class="main"><span class="main"><span>]</span></span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><span>mono_def</span><span> </span><span>of_rat_less_eq</span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_23550..23555">lemma</span></span></span><span> </span><span class="entity_def" id="Median.median_const|fact"><span class="entity_def" id="Median.median_const|thm"><span>median_const</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>k</span></span><span> </span><span class="main"><span>&gt;</span></span><span> </span><span class="main"><span>0</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Median.html#Median.median|const"><span>median</span></a><span> </span><span class="free"><span>k</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>Î»</span></span><span class="bound"><span>i</span></span><span> </span><span class="main"><span>â</span></span><span> </span><span class="main"><span>{</span></span><span class="main"><span>0</span></span><span class="main"><span>..&lt;</span></span><span class="free"><span>k</span></span><span class="main"><span>}</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>a</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="free"><span>a</span></span><span>"</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="operator"><span>-</span></span><span>
  </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="entity_def" id="offset_23644..23645">b</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span>sorted</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>Î»</span></span><span class="main"><span class="bound"><span>_</span></span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>a</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>0</span></span><span class="main"><span>..&lt;</span></span><span class="free"><span>k</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span> 
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>subst</span></span><span> </span><span>sorted_wrt_map</span><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><span class="operator"><span>simp</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="entity_def" id="offset_23722..23723">a</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span>sort</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>Î»</span></span><span class="main"><span class="bound"><span>_</span></span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>a</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>0</span></span><span class="main"><span>..&lt;</span></span><span class="free"><span>k</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>Î»</span></span><span class="main"><span class="bound"><span>_</span></span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>a</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>0</span></span><span class="main"><span>..&lt;</span></span><span class="free"><span>k</span></span><span class="main"><span>]</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>subst</span></span><span> </span><span>sorted_sort_id</span><span class="main"><span class="main"><span>[</span></span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="Median.html#offset_23644..23645"><span>b</span></a><span class="main"><span class="main"><span>]</span></span></span><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><span class="operator"><span>simp</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Median.html#Median.median|const"><span>median</span></a><span> </span><span class="free"><span>k</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>Î»</span></span><span class="bound"><span>i</span></span><span> </span><span class="main"><span>â</span></span><span> </span><span class="main"><span>{</span></span><span class="main"><span>0</span></span><span class="main"><span>..&lt;</span></span><span class="free"><span>k</span></span><span class="main"><span>}</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>a</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><a class="entity_ref" href="Median.html#Median.median|const"><span>median</span></a><span> </span><span class="free"><span>k</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>Î»</span></span><span class="main"><span class="bound"><span>_</span></span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>a</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>subst</span></span><span> </span><a class="entity_ref" href="Median.html#Median.median_restrict|fact"><span>median_restrict</span></a><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><span class="operator"><span>simp</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>also</span></span></span><span> </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>...</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="free"><span>a</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><a class="entity_ref" href="Median.html#Median.median_def|fact"><span>median_def</span></a><span> </span><a class="entity_ref" href="Median.html#offset_23722..23723"><span>a</span></a><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>subst</span></span><span> </span><span>nth_map</span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Median.html#offset_23550..23555"><span>assms</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp</span></span><span class="main"><span class="keyword3"><span>+</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>finally</span></span></span><span> </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?thesis</span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp</span></span><span>
</span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>

</span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
</span></pre></div>