<div id="Is_Rat_To_Rat">
<div class="head">
<h1>Theory Is_Rat_To_Rat</h1>
</div>
<pre class="source"><span class="comment1">(*  
    Author:      René Thiemann 
                 Akihisa Yamada
    License:     BSD
*)</span>
<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Conversions to Rational Numbers›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We define a class which provides tests whether a number is rational, and
  a conversion from to rational numbers. 
  These conversion functions are principle the inverse functions of \emph{of-rat}, but
  they can be implemented for individual types more efficiently.
  
  Similarly, we define tests and conversions between integer and rational numbers.›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Is_Rat_To_Rat
<span class="keyword2"><span class="keyword">imports</span></span> 
  <a href="../../sqrt_babylonian/theories/#Sqrt_Babylonian_Auxiliary">Sqrt_Babylonian.Sqrt_Babylonian_Auxiliary</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">class</span></span> is_rat <span class="main">=</span> field_char_0 <span class="main">+</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free"><span class="free"><span class="free">is_rat</span></span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free"><span class="free"><span class="free">to_rat</span></span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> rat"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> is_rat<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">is_rat</span> <span class="free">x</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">∈</span> <span class="main">ℚ</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> to_rat<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">to_rat</span> <span class="free">x</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">x</span> <span class="main">∈</span> <span class="main">ℚ</span> <span class="keyword1">then</span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">y</span><span class="main">.</span> <span class="free">x</span> <span class="main">=</span> of_rat <span class="bound">y</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Is_Rat_To_Rat-of_rat_to_rat"><span class="command">lemma</span></span> of_rat_to_rat<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="main">ℚ</span> <span class="main">⟹</span> of_rat <span class="main">(</span>to_rat <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> to_rat Rats_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Is_Rat_To_Rat-to_rat_of_rat"><span class="command">lemma</span></span> to_rat_of_rat<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"to_rat <span class="main">(</span>of_rat <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> to_rat <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">instantiation</span></span> rat <span class="main">::</span> <span class="quoted">is_rat</span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="class_parameter">is_rat_rat</span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">::</span> rat<span class="main">)</span> <span class="main">=</span> True"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="class_parameter">to_rat_rat</span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">::</span> rat<span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>
  <span class="keyword1"><span class="command">instance</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro_classes</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> is_rat_rat_def to_rat_rat_def Rats_def<span class="main">)</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The definition for reals at the moment is not executable, but it will become
  executable after loading the real algebraic numbers theory.›</span></span>
<span class="keyword1"><span class="command">instantiation</span></span> real <span class="main">::</span> <span class="quoted">is_rat</span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="class_parameter">is_rat_real</span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">::</span> real<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∈</span> <span class="main">ℚ</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="class_parameter">to_rat_real</span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">::</span> real<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∈</span> <span class="main">ℚ</span> <span class="keyword1">then</span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">y</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> of_rat <span class="bound">y</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro_classes</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> is_rat_real_def to_rat_real_def<span class="main">)</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1" id="Is_Rat_To_Rat-of_nat_complex"><span class="command">lemma</span></span> of_nat_complex<span class="main">:</span> <span class="quoted"><span class="quoted">"of_nat <span class="free">n</span> <span class="main">=</span> Complex <span class="main">(</span>of_nat <span class="free">n</span><span class="main">)</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> complex_eqI<span class="main">)</span>

<span class="keyword1" id="Is_Rat_To_Rat-of_int_complex"><span class="command">lemma</span></span> of_int_complex<span class="main">:</span> <span class="quoted"><span class="quoted">"of_int <span class="free">z</span> <span class="main">=</span> Complex <span class="main">(</span>of_int <span class="free">z</span><span class="main">)</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> complex_eq_iff<span class="main">)</span>

<span class="keyword1" id="Is_Rat_To_Rat-of_rat_complex"><span class="command">lemma</span></span> of_rat_complex<span class="main">:</span> <span class="quoted"><span class="quoted">"of_rat <span class="free">q</span> <span class="main">=</span> Complex <span class="main">(</span>of_rat <span class="free">q</span><span class="main">)</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">d</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> dn<span class="main">:</span> <span class="quoted"><span class="quoted">"quotient_of <span class="free">q</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">d</span><span class="main">,</span><span class="skolem">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">from</span></span> quotient_of_div<span class="main">[</span><span class="operator">OF</span> dn<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">=</span> of_int <span class="skolem">d</span> <span class="main">/</span> of_int <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"of_rat <span class="free">q</span> <span class="main">=</span> complex_of_real <span class="main">(</span>real_of_rat <span class="free">q</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span>complex<span class="main">)</span> <span class="main">=</span> of_int <span class="skolem">n</span> <span class="main">∨</span> <span class="main">0</span> <span class="main">=</span> real_of_int <span class="skolem">n</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> of_rat_divide q<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> Complex_eq_0 complex_of_real_def q <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Is_Rat_To_Rat-complex_of_real_of_rat"><span class="command">lemma</span></span> complex_of_real_of_rat<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"complex_of_real <span class="main">(</span>real_of_rat <span class="free">q</span><span class="main">)</span> <span class="main">=</span> of_rat <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> complex_of_real_def of_rat_complex <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Is_Rat_To_Rat-is_rat_complex_iff"><span class="command">lemma</span></span> is_rat_complex_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="main">ℚ</span> <span class="main">⟷</span> Re <span class="free">x</span> <span class="main">∈</span> <span class="main">ℚ</span> <span class="main">∧</span> Im <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="main">ℚ</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> of_rat <span class="skolem">q</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> Rats_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?y</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Complex <span class="main">(</span>of_rat <span class="skolem">q</span><span class="main">)</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">-</span> <span class="var">?y</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> x <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Complex_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="var">?y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Re <span class="free">x</span> <span class="main">∈</span> <span class="main">ℚ</span> <span class="main">∧</span> Im <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> x complex.sel <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Re <span class="free">x</span> <span class="main">∈</span> <span class="main">ℚ</span> <span class="main">∧</span> Im <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"Re <span class="free">x</span> <span class="main">=</span> of_rat <span class="skolem">q</span>"</span></span> <span class="quoted"><span class="quoted">"Im <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> Rats_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> Complex <span class="main">(</span>of_rat <span class="skolem">q</span><span class="main">)</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> complex_surj<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="main">ℚ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Complex_eq<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1"><span class="command">instantiation</span></span> complex <span class="main">::</span> <span class="quoted">is_rat</span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="class_parameter">is_rat_complex</span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">::</span> complex<span class="main">)</span> <span class="main">=</span> <span class="main">(</span>is_rat <span class="main">(</span>Re <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">∧</span> Im <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="class_parameter">to_rat_complex</span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">::</span> complex<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> is_rat <span class="main">(</span>Re <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">∧</span> Im <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> to_rat <span class="main">(</span>Re <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro_classes</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> is_rat_complex_def to_rat_complex_def is_rat_complex_iff<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
  <span class="keyword3"><span class="command">assume</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"Re <span class="skolem">x</span> <span class="main">∈</span> <span class="main">ℚ</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"Im <span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">ℚ</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> is_rat_complex_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> of_rat <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> Rats_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> this<span class="main">[</span><span class="operator">unfolded</span> of_rat_complex<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> Complex <span class="main">(</span>real_of_rat <span class="skolem">y</span><span class="main">)</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"to_rat <span class="main">(</span>Re <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">y</span><span class="main">.</span> <span class="skolem">x</span> <span class="main">=</span> of_rat <span class="bound">y</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> of_rat_eq_iff<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">,</span></span> <span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="tfree">'a</span> <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">real</span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> of_rat_to_rat<span class="main"><span class="main">[</span></span><span class="operator">OF</span> r<span class="main"><span class="main">]</span></span> of_rat_complex<span class="main"><span class="keyword3">,</span></span>
    <span class="operator">unfold</span> x complex.sel<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">code_unfold</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">∈</span> <span class="main">ℚ</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>is_rat <span class="free">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">is_int_rat</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"rat <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">is_int_rat</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≡</span> snd <span class="main">(</span>quotient_of <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">int_of_rat</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"rat <span class="main">⇒</span> int"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">int_of_rat</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≡</span> fst <span class="main">(</span>quotient_of <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Is_Rat_To_Rat-is_int_rat"><span class="command">lemma</span></span> is_int_rat<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"is_int_rat <span class="free">x</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">∈</span> <span class="main">ℤ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> is_int_rat_def Ints_def 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Ints_def Ints_induct 
    quotient_of_int is_int_rat_def old.prod.exhaust quotient_of_inject rangeI snd_conv<span class="main">)</span>

<span class="keyword1" id="Is_Rat_To_Rat-int_of_rat"><span class="command">lemma</span></span> int_of_rat<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"int_of_rat <span class="main">(</span>rat_of_int <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">∈</span> <span class="main">ℤ</span> <span class="main">⟹</span> rat_of_int <span class="main">(</span>int_of_rat <span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="free">z</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> int_of_rat_def<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">∈</span> <span class="main">ℤ</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"rat_of_int <span class="main">(</span>int_of_rat <span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="free">z</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> int_of_rat_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Ints_cases Pair_inject quotient_of_int surjective_pairing<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Is_Rat_To_Rat-int_of_rat_0"><span class="command">lemma</span></span> int_of_rat_0<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>int_of_rat <span class="free">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> int_of_rat_def
  <span class="keyword1"><span class="command">using</span></span> quotient_of_div<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"quotient_of <span class="free">x</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Divmod_Int">
<div class="head">
<h1>Theory Divmod_Int</h1>
</div>
<pre class="source"><span class="comment1">(*  
    Author:      René Thiemann 
                 Akihisa Yamada
    License:     BSD
*)</span>
<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Divmod-Int›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We provide the divmod-operation on type int for efficiency reasons.›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Divmod_Int
<span class="keyword2"><span class="keyword">imports</span></span> <a href="https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL/Main.html">Main</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">divmod_int</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"int <span class="main">⇒</span> int <span class="main">⇒</span> int <span class="main">×</span> int"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">divmod_int</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="keyword1">div</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="keyword1">mod</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We implement <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> divmod_int<span class="antiquote"><span class="antiquote">}</span></span></span></span> via <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> divmod_integer<span class="antiquote"><span class="antiquote">}</span></span></span></span>
  instead of invoking both division and modulo separately.›</span></span>

<span class="keyword1"><span class="command">context</span></span>
<span class="keyword2"><span class="keyword">includes</span></span> integer.lifting
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Divmod_Int-divmod_int_code"><span class="command">lemma</span></span> divmod_int_code<span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"divmod_int <span class="free">m</span> <span class="free">n</span> <span class="main">=</span> map_prod int_of_integer int_of_integer 
  <span class="main">(</span>divmod_integer <span class="main">(</span>integer_of_int <span class="free">m</span><span class="main">)</span> <span class="main">(</span>integer_of_int <span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> divmod_int_def divmod_integer_def map_prod_def split prod.simps
<span class="keyword1"><span class="command">proof</span></span> 
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="keyword1">div</span> <span class="free">n</span> <span class="main">=</span> int_of_integer
     <span class="main">(</span>integer_of_int <span class="free">m</span> <span class="keyword1">div</span> integer_of_int <span class="free">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="keyword1">mod</span> <span class="free">n</span> <span class="main">=</span> int_of_integer
     <span class="main">(</span>integer_of_int <span class="free">m</span> <span class="keyword1">mod</span> integer_of_int <span class="free">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Improved_Code_Equations">
<div class="head">
<h1>Theory Improved_Code_Equations</h1>
</div>
<pre class="source"><span class="comment1">(*  
    Author:      René Thiemann 
                 Akihisa Yamada
    License:     BSD
*)</span>
<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Improved Code Equations›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹This theory contains improved code equations for certain algorithms.›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Improved_Code_Equations
<span class="keyword2"><span class="keyword">imports</span></span> 
  <span class="quoted">"<a href="https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL-Computational_Algebra/Polynomial.html">HOL-Computational_Algebra.Polynomial</a>"</span>
  <span class="quoted">"<a href="https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL-Library/Code_Target_Nat.html">HOL-Library.Code_Target_Nat</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> divmod_integer<span class="antiquote"><span class="antiquote">}</span></span></span></span>.›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We improve <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> divmod_integer_code<span class="antiquote"><span class="antiquote">}</span></span></span></span> by deleting <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> sgn<span class="antiquote"><span class="antiquote">}</span></span></span></span>-expressions.›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We guard the application of divmod-abs' with the condition <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">x</span></span> <span class="main"><span class="main">≥</span></span> <span class="main"><span class="main">0</span></span> <span class="main"><span class="main">∧</span></span> <span class="free"><span class="free">y</span></span> <span class="main"><span class="main">≥</span></span> <span class="main"><span class="main">0</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, 
  so that application can be ensured on non-negative values. Hence, one can drop "abs" in 
   target language setup.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">divmod_abs'</span> <span class="keyword2"><span class="keyword">where</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≥</span> <span class="main">0</span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">≥</span> <span class="main">0</span> <span class="main">⟹</span> <span class="free">divmod_abs'</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">=</span> Code_Numeral.divmod_abs <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span>"</span></span> 

<span class="comment1">(* led to an another 10 % improvement on factorization example *)</span>

<span class="keyword1" id="Improved_Code_Equations-divmod_integer_code''"><span class="command">lemma</span></span> divmod_integer_code''<span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"divmod_integer <span class="free">k</span> <span class="free">l</span> <span class="main">=</span>
  <span class="main">(</span><span class="keyword1">if</span> <span class="free">k</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span>
    <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free">l</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="keyword1">then</span>
            <span class="main">(</span><span class="keyword1">if</span> <span class="free">k</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="keyword1">then</span> divmod_abs' <span class="free">k</span> <span class="free">l</span>
             <span class="keyword1">else</span> <span class="keyword1">case</span> divmod_abs' <span class="main">(</span><span class="main">-</span> <span class="free">k</span><span class="main">)</span> <span class="free">l</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">r</span><span class="main">,</span> <span class="bound">s</span><span class="main">)</span> <span class="main">⇒</span>
                  <span class="keyword1">if</span> <span class="bound">s</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">(</span><span class="main">-</span> <span class="bound">r</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">-</span> <span class="bound">r</span> <span class="main">-</span> <span class="main">1</span><span class="main">,</span> <span class="free">l</span> <span class="main">-</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span>
    <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free">l</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="free">k</span><span class="main">)</span>
    <span class="keyword1">else</span> apsnd uminus
            <span class="main">(</span><span class="keyword1">if</span> <span class="free">k</span> <span class="main">&lt;</span> <span class="main">0</span> <span class="keyword1">then</span> divmod_abs' <span class="main">(</span><span class="main">-</span><span class="free">k</span><span class="main">)</span> <span class="main">(</span><span class="main">-</span><span class="free">l</span><span class="main">)</span>
             <span class="keyword1">else</span> <span class="keyword1">case</span> divmod_abs' <span class="free">k</span> <span class="main">(</span><span class="main">-</span><span class="free">l</span><span class="main">)</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">r</span><span class="main">,</span> <span class="bound">s</span><span class="main">)</span> <span class="main">⇒</span>
                  <span class="keyword1">if</span> <span class="bound">s</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">(</span><span class="main">-</span> <span class="bound">r</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">-</span> <span class="bound">r</span> <span class="main">-</span> <span class="main">1</span><span class="main">,</span> <span class="main">-</span> <span class="free">l</span> <span class="main">-</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">unfolding</span></span> divmod_integer_code
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> prod.splits <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> divmod_abs'_def divmod_abs_def<span class="main">)</span>

<span class="keyword1"><span class="command">code_printing</span></span> <span class="comment1">― ‹FIXME illusion of partiality›</span>
  <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted">divmod_abs'</span> <span class="main">⇀</span>
    <span class="main">(</span>SML<span class="main">)</span> <span class="quoted">"IntInf.divMod/ ( _,/ _ )"</span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">(</span>Eval<span class="main">)</span> <span class="quoted">"Integer.div'_mod/ ( _ )/ ( _ )"</span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">(</span>OCaml<span class="main">)</span> <span class="quoted">"Z.div'_rem"</span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">(</span>Haskell<span class="main">)</span> <span class="quoted">"divMod/ ( _ )/ ( _ )"</span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">(</span>Scala<span class="main">)</span> <span class="quoted">"!((k: BigInt) =&gt; (l: BigInt) =&gt;/ if (l == 0)/ (BigInt(0), k) else/ (k '/% l))"</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> Divides.divmod_nat<span class="antiquote"><span class="antiquote">}</span></span></span></span>.›</span></span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We implement <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> Divides.divmod_nat<span class="antiquote"><span class="antiquote">}</span></span></span></span> via <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> divmod_integer<span class="antiquote"><span class="antiquote">}</span></span></span></span>
  instead of invoking both division and modulo separately, 
  and we further simplify the case-analysis which is
  performed in <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> divmod_integer_code''<span class="antiquote"><span class="antiquote">}</span></span></span></span>.›</span></span>

<span class="keyword1" id="Improved_Code_Equations-divmod_nat_code'"><span class="command">lemma</span></span> divmod_nat_code'<span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Divides.divmod_nat <span class="free">m</span> <span class="free">n</span> <span class="main">=</span> <span class="main">(</span>
  <span class="keyword1">let</span> <span class="bound">k</span> <span class="main">=</span> integer_of_nat <span class="free">m</span><span class="main">;</span> <span class="bound">l</span> <span class="main">=</span> integer_of_nat <span class="free">n</span>
  <span class="keyword1">in</span> map_prod nat_of_integer nat_of_integer
  <span class="main">(</span><span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span>
    <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="bound">l</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span> <span class="keyword1">else</span>
            divmod_abs' <span class="bound">k</span> <span class="bound">l</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> divmod_nat_code <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">m</span></span> <span class="quoted"><span class="free">n</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> divmod_abs'_def integer_of_nat_eq_of_nat Let_def<span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> binomial<span class="antiquote"><span class="antiquote">}</span></span></span></span>›</span></span>

<span class="keyword1" id="Improved_Code_Equations-binomial_code"><span class="command">lemma</span></span> binomial_code<span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="keyword1">choose</span> <span class="free">k</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">k</span> <span class="main">≤</span> <span class="free">n</span> <span class="keyword1">then</span> fact <span class="free">n</span> <span class="keyword1">div</span> <span class="main">(</span>fact <span class="free">k</span> <span class="main">*</span> fact <span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> binomial_eq_0<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">n</span></span> <span class="quoted"><span class="free">k</span></span><span class="main">]</span> binomial_altdef_nat<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">k</span></span> <span class="quoted"><span class="free">n</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Ring_Hom">
<div class="head">
<h1>Theory Ring_Hom</h1>
</div>
<pre class="source"><span class="comment1">(*  
    Author:      René Thiemann 
                 Akihisa Yamada
    License:     BSD
*)</span>
<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Several Locales for Homomorphisms Between Types.›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Ring_Hom
<span class="keyword2"><span class="keyword">imports</span></span> 
  <a href="https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL/Complex.html">HOL.Complex</a>
  <a href="https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL/Main.html">Main</a>
  <span class="quoted">"<a href="https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL-Library/Multiset.html">HOL-Library.Multiset</a>"</span>
  <span class="quoted">"<a href="https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL-Computational_Algebra/Factorial_Ring.html">HOL-Computational_Algebra.Factorial_Ring</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">hide_const</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">open</span></span><span class="main">)</span> mult

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
Many standard operations can be interpreted as homomorphisms in some sense.
Since declaring some lemmas as [simp] will interfere with existing simplification rules,
we introduce named theorems that would be added to the simp set when necessary.

The following collects distribution lemmas for homomorphisms.
Its symmetric version can often be useful.›</span></span>
<span class="keyword1"><span class="command">named_theorems</span></span> hom_distribs

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Basic Homomorphism Locales›</span></span>

<span class="keyword1"><span class="command">locale</span></span> zero_hom <span class="main">=</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">hom</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> zero <span class="main">⇒</span> <span class="tfree">'b</span> <span class="main">::</span> zero"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> hom_zero<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">hom</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>

<span class="keyword1"><span class="command">locale</span></span> one_hom <span class="main">=</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">hom</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> one <span class="main">⇒</span> <span class="tfree">'b</span> <span class="main">::</span> one"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> hom_one<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">hom</span> <span class="main">1</span> <span class="main">=</span> <span class="main">1</span>"</span></span>

<span class="keyword1"><span class="command">locale</span></span> times_hom <span class="main">=</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">hom</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> times <span class="main">⇒</span> <span class="tfree">'b</span> <span class="main">::</span> times"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> hom_mult<span class="main">[</span><span class="operator">hom_distribs</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">hom</span> <span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="free">hom</span> <span class="free">x</span> <span class="main">*</span> <span class="free">hom</span> <span class="free">y</span>"</span></span>

<span class="keyword1"><span class="command">locale</span></span> plus_hom <span class="main">=</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">hom</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> plus <span class="main">⇒</span> <span class="tfree">'b</span> <span class="main">::</span> plus"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> hom_add<span class="main">[</span><span class="operator">hom_distribs</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">hom</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="free">hom</span> <span class="free">x</span> <span class="main">+</span> <span class="free">hom</span> <span class="free">y</span>"</span></span>

<span class="keyword1"><span class="command">locale</span></span> semigroup_mult_hom <span class="main">=</span>
  times_hom <span class="quoted"><span class="free">hom</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="free">hom</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> semigroup_mult <span class="main">⇒</span> <span class="tfree">'b</span> <span class="main">::</span> semigroup_mult"</span></span>

<span class="keyword1"><span class="command">locale</span></span> semigroup_add_hom <span class="main">=</span>
  plus_hom <span class="quoted"><span class="free">hom</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="free">hom</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> semigroup_add <span class="main">⇒</span> <span class="tfree">'b</span> <span class="main">::</span> semigroup_add"</span></span>

<span class="keyword1"><span class="command">locale</span></span> monoid_mult_hom <span class="main">=</span> one_hom <span class="quoted"><span class="free">hom</span></span> <span class="main">+</span> semigroup_mult_hom <span class="quoted"><span class="free">hom</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">hom</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> monoid_mult <span class="main">⇒</span> <span class="tfree">'b</span> <span class="main">::</span> monoid_mult"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Homomorphism distributes over product:›</span></span>
  <span class="keyword1" id="Ring_Hom-hom_prod_list"><span class="command">lemma</span></span> hom_prod_list<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">hom</span> <span class="main">(</span>prod_list <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> prod_list <span class="main">(</span>map <span class="free">hom</span> <span class="free">xs</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">hom_distribs</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹but since it introduces unapplied <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">hom</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, the reverse direction would be simp.›</span></span>
  <span class="keyword1"><span class="command">lemmas</span></span> prod_list_map_hom<span class="main">[</span><span class="operator">simp</span><span class="main">]</span> <span class="main">=</span> hom_prod_list<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
  <span class="keyword1" id="Ring_Hom-hom_power"><span class="command">lemma</span></span> hom_power<span class="main">[</span><span class="operator">hom_distribs</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">hom</span> <span class="main">(</span><span class="free">x</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="free">hom</span> <span class="free">x</span> <span class="main">^</span> <span class="free">n</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">hom_distribs</span></span><span class="main">)</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">locale</span></span> monoid_add_hom <span class="main">=</span> zero_hom <span class="quoted"><span class="free">hom</span></span> <span class="main">+</span> semigroup_add_hom <span class="quoted"><span class="free">hom</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">hom</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> monoid_add <span class="main">⇒</span> <span class="tfree">'b</span> <span class="main">::</span> monoid_add"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1" id="Ring_Hom-hom_sum_list"><span class="command">lemma</span></span> hom_sum_list<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">hom</span> <span class="main">(</span>sum_list <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> sum_list <span class="main">(</span>map <span class="free">hom</span> <span class="free">xs</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">hom_distribs</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">lemmas</span></span> sum_list_map_hom<span class="main">[</span><span class="operator">simp</span><span class="main">]</span> <span class="main">=</span> hom_sum_list<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
  <span class="keyword1" id="Ring_Hom-hom_add_eq_zero"><span class="command">lemma</span></span> hom_add_eq_zero<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">+</span> <span class="free">y</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">hom</span> <span class="free">x</span> <span class="main">+</span> <span class="free">hom</span> <span class="free">y</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">=</span> <span class="free">x</span> <span class="main">+</span> <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">hom</span> <span class="main">0</span> <span class="main">=</span> <span class="free">hom</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">hom_distribs</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">locale</span></span> group_add_hom <span class="main">=</span> monoid_add_hom <span class="quoted"><span class="free">hom</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">hom</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> group_add <span class="main">⇒</span> <span class="tfree">'b</span> <span class="main">::</span> group_add"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1" id="Ring_Hom-hom_uminus"><span class="command">lemma</span></span> hom_uminus<span class="main">[</span><span class="operator">hom_distribs</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">hom</span> <span class="main">(</span><span class="main">-</span><span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span> <span class="free">hom</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq_neg_iff_add_eq_0 hom_add_eq_zero<span class="main">)</span>
  <span class="keyword1" id="Ring_Hom-hom_minus"><span class="command">lemma</span></span> hom_minus <span class="main">[</span><span class="operator">hom_distribs</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">hom</span> <span class="main">(</span><span class="free">x</span> <span class="main">-</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="free">hom</span> <span class="free">x</span> <span class="main">-</span> <span class="free">hom</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> diff_conv_add_uminus <span class="dynamic"><span class="dynamic">hom_distribs</span></span><span class="keyword1"><span class="command">..</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Commutativity›</span></span>

<span class="keyword1"><span class="command">locale</span></span> ab_semigroup_mult_hom <span class="main">=</span> semigroup_mult_hom <span class="quoted"><span class="free">hom</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">hom</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> ab_semigroup_mult <span class="main">⇒</span> <span class="tfree">'b</span> <span class="main">::</span> ab_semigroup_mult"</span></span>

<span class="keyword1"><span class="command">locale</span></span> ab_semigroup_add_hom <span class="main">=</span> semigroup_add_hom <span class="quoted"><span class="free">hom</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">hom</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> ab_semigroup_add <span class="main">⇒</span> <span class="tfree">'b</span> <span class="main">::</span> ab_semigroup_add"</span></span>

<span class="keyword1"><span class="command">locale</span></span> comm_monoid_mult_hom <span class="main">=</span> monoid_mult_hom <span class="quoted"><span class="free">hom</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">hom</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> comm_monoid_mult <span class="main">⇒</span> <span class="tfree">'b</span> <span class="main">::</span> comm_monoid_mult"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">sublocale</span></span> ab_semigroup_mult_hom<span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1" id="Ring_Hom-hom_prod"><span class="command">lemma</span></span> hom_prod<span class="main">[</span><span class="operator">hom_distribs</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">hom</span> <span class="main">(</span>prod <span class="free">f</span> <span class="free">X</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">x</span> <span class="main">∈</span> <span class="free">X</span><span class="main">.</span> <span class="free">hom</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"finite <span class="free">X</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>finite_induct<span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">hom_distribs</span></span><span class="main">)</span>
  <span class="keyword1" id="Ring_Hom-hom_prod_mset"><span class="command">lemma</span></span> hom_prod_mset<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">hom</span> <span class="main">(</span>prod_mset <span class="free">X</span><span class="main">)</span> <span class="main">=</span> prod_mset <span class="main">(</span>image_mset <span class="free">hom</span> <span class="free">X</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">X</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">hom_distribs</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">lemmas</span></span> prod_mset_image<span class="main">[</span><span class="operator">simp</span><span class="main">]</span> <span class="main">=</span> hom_prod_mset<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
  <span class="keyword1" id="Ring_Hom-hom_dvd"><span class="command">lemma</span></span> hom_dvd<span class="main">[</span><span class="operator">intro</span><span class="main">,</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="keyword1">dvd</span> <span class="free">q</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">hom</span> <span class="free">p</span> <span class="keyword1">dvd</span> <span class="free">hom</span> <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">=</span> <span class="free">p</span> <span class="main">*</span> <span class="skolem">r</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> dvd_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> arg_cong<span class="main">[</span><span class="operator">OF</span> this<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">hom</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> dvd_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">hom_distribs</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1" id="Ring_Hom-hom_dvd_1"><span class="command">lemma</span></span> hom_dvd_1<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">dvd</span> <span class="main">1</span> <span class="main">⟹</span> <span class="free">hom</span> <span class="free">x</span> <span class="keyword1">dvd</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> hom_dvd<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">locale</span></span> comm_monoid_add_hom <span class="main">=</span> monoid_add_hom <span class="quoted"><span class="free">hom</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">hom</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> comm_monoid_add <span class="main">⇒</span> <span class="tfree">'b</span> <span class="main">::</span> comm_monoid_add"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">sublocale</span></span> ab_semigroup_add_hom<span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1" id="Ring_Hom-hom_sum"><span class="command">lemma</span></span> hom_sum<span class="main">[</span><span class="operator">hom_distribs</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">hom</span> <span class="main">(</span>sum <span class="free">f</span> <span class="free">X</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span> <span class="main">∈</span> <span class="free">X</span><span class="main">.</span> <span class="free">hom</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"finite <span class="free">X</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>finite_induct<span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">hom_distribs</span></span><span class="main">)</span>
  <span class="keyword1" id="Ring_Hom-hom_sum_mset"><span class="command">lemma</span></span> hom_sum_mset<span class="main">[</span><span class="operator">hom_distribs</span><span class="main">,</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">hom</span> <span class="main">(</span>sum_mset <span class="free">X</span><span class="main">)</span> <span class="main">=</span> sum_mset <span class="main">(</span>image_mset <span class="free">hom</span> <span class="free">X</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">X</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">hom_distribs</span></span><span class="main">)</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">locale</span></span> ab_group_add_hom <span class="main">=</span> group_add_hom <span class="quoted"><span class="free">hom</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">hom</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> ab_group_add <span class="main">⇒</span> <span class="tfree">'b</span> <span class="main">::</span> ab_group_add"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">sublocale</span></span> comm_monoid_add_hom<span class="keyword1"><span class="command">..</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">locale</span></span> semiring_hom <span class="main">=</span> comm_monoid_add_hom <span class="quoted"><span class="free">hom</span></span> <span class="main">+</span> monoid_mult_hom <span class="quoted"><span class="free">hom</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">hom</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> semiring_1 <span class="main">⇒</span> <span class="tfree">'b</span> <span class="main">::</span> semiring_1"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1" id="Ring_Hom-hom_mult_eq_zero"><span class="command">lemma</span></span> hom_mult_eq_zero<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="free">y</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">hom</span> <span class="free">x</span> <span class="main">*</span> <span class="free">hom</span> <span class="free">y</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">=</span> <span class="free">x</span> <span class="main">*</span> <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">hom</span> <span class="main">0</span> <span class="main">=</span> <span class="free">hom</span> <span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="free">y</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">hom_distribs</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">locale</span></span> ring_hom <span class="main">=</span> semiring_hom <span class="quoted"><span class="free">hom</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">hom</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> ring_1 <span class="main">⇒</span> <span class="tfree">'b</span> <span class="main">::</span> ring_1"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">sublocale</span></span> ab_group_add_hom <span class="quoted"><span class="free">hom</span></span><span class="keyword1"><span class="command">..</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">locale</span></span> comm_semiring_hom <span class="main">=</span> semiring_hom <span class="quoted"><span class="free">hom</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">hom</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> comm_semiring_1 <span class="main">⇒</span> <span class="tfree">'b</span> <span class="main">::</span> comm_semiring_1"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">sublocale</span></span> comm_monoid_mult_hom<span class="keyword1"><span class="command">..</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">locale</span></span> comm_ring_hom <span class="main">=</span> ring_hom <span class="quoted"><span class="free">hom</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">hom</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> comm_ring_1 <span class="main">⇒</span> <span class="tfree">'b</span> <span class="main">::</span> comm_ring_1"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">sublocale</span></span> comm_semiring_hom<span class="keyword1"><span class="command">..</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">locale</span></span> idom_hom <span class="main">=</span> comm_ring_hom <span class="quoted"><span class="free">hom</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">hom</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> idom <span class="main">⇒</span> <span class="tfree">'b</span> <span class="main">::</span> idom"</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Division›</span></span>

<span class="keyword1"><span class="command">locale</span></span> idom_divide_hom <span class="main">=</span> idom_hom <span class="quoted"><span class="free">hom</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">hom</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> idom_divide <span class="main">⇒</span> <span class="tfree">'b</span> <span class="main">::</span> idom_divide"</span></span> <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> hom_div<span class="main">[</span><span class="operator">hom_distribs</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">hom</span> <span class="main">(</span><span class="free">x</span> <span class="keyword1">div</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="free">hom</span> <span class="free">x</span> <span class="keyword1">div</span> <span class="free">hom</span> <span class="free">y</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">locale</span></span> field_hom <span class="main">=</span> idom_hom <span class="quoted"><span class="free">hom</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">hom</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> field <span class="main">⇒</span> <span class="tfree">'b</span> <span class="main">::</span> field"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

  <span class="keyword1" id="Ring_Hom-hom_inverse"><span class="command">lemma</span></span> hom_inverse<span class="main">[</span><span class="operator">hom_distribs</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">hom</span> <span class="main">(</span>inverse <span class="free">x</span><span class="main">)</span> <span class="main">=</span> inverse <span class="main">(</span><span class="free">hom</span> <span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> hom_mult hom_one hom_zero inverse_unique inverse_zero right_inverse<span class="main">)</span>

  <span class="keyword1"><span class="command">sublocale</span></span> idom_divide_hom <span class="quoted"><span class="free">hom</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">hom</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">/</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> <span class="free">hom</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">*</span> inverse <span class="skolem">y</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">hom</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">/</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> <span class="free">hom</span> <span class="skolem">x</span> <span class="main">/</span> <span class="free">hom</span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> <span class="dynamic"><span class="dynamic">hom_distribs</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">locale</span></span> field_char_0_hom <span class="main">=</span> field_hom <span class="quoted"><span class="free">hom</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">hom</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> field_char_0 <span class="main">⇒</span> <span class="tfree">'b</span> <span class="main">::</span> field_char_0"</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹(Partial) Injectivitiy›</span></span>

<span class="keyword1"><span class="command">locale</span></span> zero_hom_0 <span class="main">=</span> zero_hom <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> hom_0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="free">hom</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟹</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1" id="Ring_Hom-hom_0_iff"><span class="command">lemma</span></span> hom_0_iff<span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">hom</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> hom_0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">locale</span></span> one_hom_1 <span class="main">=</span> one_hom <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> hom_1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="free">hom</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">1</span> <span class="main">⟹</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1" id="Ring_Hom-hom_1_iff"><span class="command">lemma</span></span> hom_1_iff<span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">hom</span> <span class="free">x</span> <span class="main">=</span> <span class="main">1</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> hom_1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Next locales are at this point not interesting.
  They will retain some results when we think of polynomials.
›</span></span>
<span class="keyword1"><span class="command">locale</span></span> monoid_mult_hom_1 <span class="main">=</span> monoid_mult_hom <span class="main">+</span> one_hom_1

<span class="keyword1"><span class="command">locale</span></span> monoid_add_hom_0 <span class="main">=</span> monoid_add_hom <span class="main">+</span> zero_hom_0

<span class="keyword1"><span class="command">locale</span></span> comm_monoid_mult_hom_1 <span class="main">=</span> monoid_mult_hom_1 <span class="quoted"><span class="free">hom</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">hom</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> comm_monoid_mult <span class="main">⇒</span> <span class="tfree">'b</span> <span class="main">::</span> comm_monoid_mult"</span></span>

<span class="keyword1"><span class="command">locale</span></span> comm_monoid_add_hom_0 <span class="main">=</span> monoid_add_hom_0 <span class="quoted"><span class="free">hom</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">hom</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> comm_monoid_add <span class="main">⇒</span> <span class="tfree">'b</span> <span class="main">::</span> comm_monoid_add"</span></span>


<span class="keyword1"><span class="command">locale</span></span> injective <span class="main">=</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span>"</span></span> <span class="keyword2"><span class="keyword">assumes</span></span> injectivity<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">f</span> <span class="bound">y</span> <span class="main">⟹</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">y</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1" id="Ring_Hom-eq_iff"><span class="command">lemma</span></span> eq_iff<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">x</span> <span class="main">=</span> <span class="free">f</span> <span class="free">y</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">=</span> <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> injectivity <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1" id="Ring_Hom-inj_f"><span class="command">lemma</span></span> inj_f<span class="main">:</span> <span class="quoted"><span class="quoted">"inj <span class="free">f</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> injI<span class="main">)</span>
  <span class="keyword1" id="Ring_Hom-inv_f_f"><span class="command">lemma</span></span> inv_f_f<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"inv <span class="free">f</span> <span class="main">(</span><span class="free">f</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> inv_f_f<span class="main"><span class="main">[</span></span><span class="operator">OF</span> inj_f<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">locale</span></span> inj_zero_hom <span class="main">=</span> zero_hom <span class="main">+</span> injective <span class="quoted"><span class="free">hom</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">sublocale</span></span> zero_hom_0 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> injectivity<span class="main">)</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">locale</span></span> inj_one_hom <span class="main">=</span> one_hom <span class="main">+</span> injective <span class="quoted"><span class="free">hom</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">sublocale</span></span> one_hom_1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> injectivity<span class="main">)</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">locale</span></span> inj_semigroup_mult_hom <span class="main">=</span> semigroup_mult_hom <span class="main">+</span> injective <span class="quoted"><span class="free">hom</span></span>

<span class="keyword1"><span class="command">locale</span></span> inj_semigroup_add_hom <span class="main">=</span> semigroup_add_hom <span class="main">+</span> injective <span class="quoted"><span class="free">hom</span></span>

<span class="keyword1"><span class="command">locale</span></span> inj_monoid_mult_hom <span class="main">=</span> monoid_mult_hom <span class="main">+</span> inj_semigroup_mult_hom
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">sublocale</span></span> inj_one_hom<span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">sublocale</span></span> monoid_mult_hom_1<span class="keyword1"><span class="command">..</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">locale</span></span> inj_monoid_add_hom <span class="main">=</span> monoid_add_hom <span class="main">+</span> inj_semigroup_add_hom
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">sublocale</span></span> inj_zero_hom<span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">sublocale</span></span> monoid_add_hom_0<span class="keyword1"><span class="command">..</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">locale</span></span> inj_comm_monoid_mult_hom <span class="main">=</span> comm_monoid_mult_hom <span class="main">+</span> inj_monoid_mult_hom
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">sublocale</span></span> comm_monoid_mult_hom_1<span class="keyword1"><span class="command">..</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">locale</span></span> inj_comm_monoid_add_hom <span class="main">=</span> comm_monoid_add_hom <span class="main">+</span> inj_monoid_add_hom
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">sublocale</span></span> comm_monoid_add_hom_0<span class="keyword1"><span class="command">..</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">locale</span></span> inj_semiring_hom <span class="main">=</span> semiring_hom <span class="main">+</span> injective <span class="quoted"><span class="free">hom</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">sublocale</span></span> inj_comm_monoid_add_hom <span class="main">+</span> inj_monoid_mult_hom<span class="keyword1"><span class="command">..</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">locale</span></span> inj_comm_semiring_hom <span class="main">=</span> comm_semiring_hom <span class="main">+</span> inj_semiring_hom
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">sublocale</span></span> inj_comm_monoid_mult_hom<span class="keyword1"><span class="command">..</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹For groups, injectivity is easily ensured.›</span></span>
<span class="keyword1"><span class="command">locale</span></span> inj_group_add_hom <span class="main">=</span> group_add_hom <span class="main">+</span> zero_hom_0
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">sublocale</span></span> injective <span class="quoted"><span class="free">hom</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">hom</span> <span class="skolem">x</span> <span class="main">=</span> <span class="free">hom</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">hom</span> <span class="main">(</span><span class="skolem">x</span><span class="main">-</span><span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">hom_distribs</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">sublocale</span></span> inj_monoid_add_hom<span class="keyword1"><span class="command">..</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">locale</span></span> inj_ab_group_add_hom <span class="main">=</span> ab_group_add_hom <span class="main">+</span> inj_group_add_hom
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">sublocale</span></span> inj_comm_monoid_add_hom<span class="keyword1"><span class="command">..</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">locale</span></span> inj_ring_hom <span class="main">=</span> ring_hom <span class="main">+</span> zero_hom_0
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">sublocale</span></span> inj_ab_group_add_hom<span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">sublocale</span></span> inj_semiring_hom<span class="keyword1"><span class="command">..</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">locale</span></span> inj_comm_ring_hom <span class="main">=</span> comm_ring_hom <span class="main">+</span> zero_hom_0
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">sublocale</span></span> inj_ring_hom<span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">sublocale</span></span> inj_comm_semiring_hom<span class="keyword1"><span class="command">..</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">locale</span></span> inj_idom_hom <span class="main">=</span> idom_hom <span class="main">+</span> zero_hom_0
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">sublocale</span></span> inj_comm_ring_hom<span class="keyword1"><span class="command">..</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Field homomorphism is always injective.›</span></span>
<span class="keyword1"><span class="command">context</span></span> field_hom <span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">sublocale</span></span> zero_hom_0
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">hom</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> x0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inverse <span class="main">(</span><span class="free">hom</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">hom</span> <span class="main">(</span>inverse <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">hom_distribs</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">hom</span> <span class="main">(</span>inverse <span class="skolem">x</span> <span class="main">*</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">hom_distribs</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> x0 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">hom</span> <span class="main">1</span> <span class="main">=</span> <span class="free">hom</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span> <span class="main">::</span> <span class="tfree">'b</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">sublocale</span></span> inj_idom_hom<span class="keyword1"><span class="command">..</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Surjectivity and Isomorphisms›</span></span>

<span class="keyword1"><span class="command">locale</span></span> surjective <span class="main">=</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> surj<span class="main">:</span> <span class="quoted"><span class="quoted">"surj <span class="free">f</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1" id="Ring_Hom-f_inv_f"><span class="command">lemma</span></span> f_inv_f<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span>inv <span class="free">f</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> cong<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> surj<span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> surj_iff o_def id_def<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">locale</span></span> bijective <span class="main">=</span> injective <span class="main">+</span> surjective

<span class="keyword1" id="Ring_Hom-bijective_eq_bij"><span class="command">lemma</span></span> bijective_eq_bij<span class="main">:</span> <span class="quoted"><span class="quoted">"bijective <span class="free">f</span> <span class="main">=</span> bij <span class="free">f</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">intro</span> iffI<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"bijective <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">interpret</span></span> bijective <span class="quoted"><span class="free">f</span></span><span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"bij <span class="free">f</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> injectivity surj <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> bijI injI<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"bij <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> this<span class="main">[</span><span class="operator">unfolded</span> bij_def<span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"bijective <span class="free">f</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> injD<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">context</span></span> bijective
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">lemmas</span></span> bij <span class="main">=</span> bijective_axioms<span class="main">[</span><span class="operator">unfolded</span> bijective_eq_bij<span class="main">]</span>
  <span class="keyword1"><span class="command">interpretation</span></span> inv<span class="main">:</span> bijective <span class="quoted"><span class="quoted">"inv <span class="free">f</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> bijective_axioms bij_imp_bij_inv <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> bijective_eq_bij<span class="main">)</span>
  <span class="keyword1"><span class="command">sublocale</span></span> inv<span class="main">:</span> surjective <span class="quoted"><span class="quoted">"inv <span class="free">f</span>"</span></span><span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">sublocale</span></span> inv<span class="main">:</span> injective <span class="quoted"><span class="quoted">"inv <span class="free">f</span>"</span></span><span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1" id="Ring_Hom-inv_inv_f_eq"><span class="command">lemma</span></span> inv_inv_f_eq<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"inv <span class="main">(</span>inv <span class="free">f</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> inv_inv_eq<span class="main">[</span><span class="operator">OF</span> bij<span class="main">]</span><span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1" id="Ring_Hom-f_eq_iff"><span class="command">lemma</span></span> f_eq_iff<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">x</span> <span class="main">=</span> <span class="free">y</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">=</span> inv <span class="free">f</span> <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1" id="Ring_Hom-inv_f_eq_iff"><span class="command">lemma</span></span> inv_f_eq_iff<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"inv <span class="free">f</span> <span class="free">x</span> <span class="main">=</span> <span class="free">y</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">=</span> <span class="free">f</span> <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">locale</span></span> monoid_mult_isom <span class="main">=</span> inj_monoid_mult_hom <span class="main">+</span> bijective <span class="quoted"><span class="free">hom</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">sublocale</span></span> inv<span class="main">:</span> bijective <span class="quoted"><span class="quoted">"inv <span class="free">hom</span>"</span></span><span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">sublocale</span></span> inv<span class="main">:</span> inj_monoid_mult_hom <span class="quoted"><span class="quoted">"inv <span class="free">hom</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">hx</span> <span class="skolem">hy</span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'b</span></span></span>
    <span class="keyword1"><span class="command">from</span></span> bij <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> hx<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">hx</span> <span class="main">=</span> <span class="free">hom</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> hy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">hy</span> <span class="main">=</span> <span class="free">hom</span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> bij_pointE<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"inv <span class="free">hom</span> <span class="main">(</span><span class="skolem">hx</span><span class="main">*</span><span class="skolem">hy</span><span class="main">)</span> <span class="main">=</span> inv <span class="free">hom</span> <span class="skolem">hx</span> <span class="main">*</span> inv <span class="free">hom</span> <span class="skolem">hy</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> hx hy<span class="main"><span class="keyword3">,</span></span> <span class="operator">fold</span> hom_mult<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inv <span class="free">hom</span> <span class="main">(</span><span class="free">hom</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> inv_f_f<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"inv <span class="free">hom</span> <span class="main">1</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">locale</span></span> monoid_add_isom <span class="main">=</span> inj_monoid_add_hom <span class="main">+</span> bijective <span class="quoted"><span class="free">hom</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">sublocale</span></span> inv<span class="main">:</span> bijective <span class="quoted"><span class="quoted">"inv <span class="free">hom</span>"</span></span><span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">sublocale</span></span> inv<span class="main">:</span> inj_monoid_add_hom <span class="quoted"><span class="quoted">"inv <span class="free">hom</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">hx</span> <span class="skolem">hy</span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'b</span></span></span>
    <span class="keyword1"><span class="command">from</span></span> bij <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> hx<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">hx</span> <span class="main">=</span> <span class="free">hom</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> hy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">hy</span> <span class="main">=</span> <span class="free">hom</span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> bij_pointE<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"inv <span class="free">hom</span> <span class="main">(</span><span class="skolem">hx</span><span class="main">+</span><span class="skolem">hy</span><span class="main">)</span> <span class="main">=</span> inv <span class="free">hom</span> <span class="skolem">hx</span> <span class="main">+</span> inv <span class="free">hom</span> <span class="skolem">hy</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> hx hy<span class="main"><span class="keyword3">,</span></span> <span class="operator">fold</span> hom_add<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inv <span class="free">hom</span> <span class="main">(</span><span class="free">hom</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> inv_f_f<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"inv <span class="free">hom</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">locale</span></span> comm_monoid_mult_isom <span class="main">=</span> monoid_mult_isom <span class="quoted"><span class="free">hom</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">hom</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> comm_monoid_mult <span class="main">⇒</span> <span class="tfree">'b</span> <span class="main">::</span> comm_monoid_mult"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">sublocale</span></span> inv<span class="main">:</span> monoid_mult_isom <span class="quoted"><span class="quoted">"inv <span class="free">hom</span>"</span></span><span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">sublocale</span></span> inj_comm_monoid_mult_hom<span class="keyword1"><span class="command">..</span></span>

  <span class="keyword1" id="Ring_Hom-hom_dvd_hom"><span class="command">lemma</span></span> hom_dvd_hom<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">hom</span> <span class="free">x</span> <span class="keyword1">dvd</span> <span class="free">hom</span> <span class="free">y</span> <span class="main">⟷</span> <span class="free">x</span> <span class="keyword1">dvd</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">hom</span> <span class="free">x</span> <span class="keyword1">dvd</span> <span class="free">hom</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">hz</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">hom</span> <span class="free">y</span> <span class="main">=</span> <span class="free">hom</span> <span class="free">x</span> <span class="main">*</span> <span class="skolem">hz</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">elim</span> dvdE<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">z</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">hz</span> <span class="main">=</span> <span class="free">hom</span> <span class="skolem">z</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> bij <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">elim</span> bij_pointE<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">hom</span> <span class="free">y</span> <span class="main">=</span> <span class="free">hom</span> <span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="skolem">z</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">hom_distribs</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> this<span class="main">[</span><span class="operator">unfolded</span> eq_iff<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">=</span> <span class="free">x</span> <span class="main">*</span> <span class="skolem">z</span>"</span></span><span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">dvd</span> <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> dvdI<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">rule</span> hom_dvd<span class="main">)</span>

  <span class="keyword1" id="Ring_Hom-hom_dvd_simp"><span class="command">lemma</span></span> hom_dvd_simp<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">hom</span> <span class="free">x</span> <span class="keyword1">dvd</span> <span class="free">y'</span> <span class="main">⟷</span> <span class="free">x</span> <span class="keyword1">dvd</span> inv <span class="free">hom</span> <span class="free">y'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> hom_dvd_hom<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="quoted">"inv <span class="free">hom</span> <span class="free">y'</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">locale</span></span> comm_monoid_add_isom <span class="main">=</span> monoid_add_isom <span class="quoted"><span class="free">hom</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">hom</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> comm_monoid_add <span class="main">⇒</span> <span class="tfree">'b</span> <span class="main">::</span> comm_monoid_add"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">sublocale</span></span> inv<span class="main">:</span> monoid_add_isom <span class="quoted"><span class="quoted">"inv <span class="free">hom</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">hom_distribs</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">sublocale</span></span> inj_comm_monoid_add_hom<span class="keyword1"><span class="command">..</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">locale</span></span> semiring_isom <span class="main">=</span> inj_semiring_hom <span class="quoted"><span class="free">hom</span></span> <span class="main">+</span> bijective <span class="quoted"><span class="free">hom</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="free">hom</span>
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">sublocale</span></span> inv<span class="main">:</span> inj_semiring_hom <span class="quoted"><span class="quoted">"inv <span class="free">hom</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">hom_distribs</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">sublocale</span></span> inv<span class="main">:</span> bijective <span class="quoted"><span class="quoted">"inv <span class="free">hom</span>"</span></span><span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">sublocale</span></span> monoid_mult_isom<span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">sublocale</span></span> comm_monoid_add_isom<span class="keyword1"><span class="command">..</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">locale</span></span> comm_semiring_isom <span class="main">=</span> semiring_isom <span class="quoted"><span class="free">hom</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">hom</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> comm_semiring_1 <span class="main">⇒</span> <span class="tfree">'b</span> <span class="main">::</span> comm_semiring_1"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">sublocale</span></span> inv<span class="main">:</span> semiring_isom <span class="quoted"><span class="quoted">"inv <span class="free">hom</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">hom_distribs</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">sublocale</span></span> comm_monoid_mult_isom<span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">sublocale</span></span> inj_comm_semiring_hom<span class="keyword1"><span class="command">..</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">locale</span></span> ring_isom <span class="main">=</span> inj_ring_hom <span class="main">+</span> surjective <span class="quoted"><span class="free">hom</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">sublocale</span></span> semiring_isom<span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">sublocale</span></span> inv<span class="main">:</span> inj_ring_hom <span class="quoted"><span class="quoted">"inv <span class="free">hom</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">hom_distribs</span></span><span class="main">)</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">locale</span></span> comm_ring_isom <span class="main">=</span> ring_isom <span class="quoted"><span class="free">hom</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">hom</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> comm_ring_1 <span class="main">⇒</span> <span class="tfree">'b</span> <span class="main">::</span> comm_ring_1"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">sublocale</span></span> comm_semiring_isom<span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">sublocale</span></span> inj_comm_ring_hom<span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">sublocale</span></span> inv<span class="main">:</span> ring_isom <span class="quoted"><span class="quoted">"inv <span class="free">hom</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">hom_distribs</span></span><span class="main">)</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">locale</span></span> idom_isom <span class="main">=</span> comm_ring_isom <span class="main">+</span> inj_idom_hom
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">sublocale</span></span> inv<span class="main">:</span> comm_ring_isom <span class="quoted"><span class="quoted">"inv <span class="free">hom</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">hom_distribs</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">sublocale</span></span> inv<span class="main">:</span> inj_idom_hom <span class="quoted"><span class="quoted">"inv <span class="free">hom</span>"</span></span><span class="keyword1"><span class="command">..</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">locale</span></span> field_isom <span class="main">=</span> field_hom <span class="main">+</span> surjective <span class="quoted"><span class="free">hom</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">sublocale</span></span> idom_isom<span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">sublocale</span></span> inv<span class="main">:</span> field_hom <span class="quoted"><span class="quoted">"inv <span class="free">hom</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">hom_distribs</span></span><span class="main">)</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">locale</span></span> inj_idom_divide_hom <span class="main">=</span> idom_divide_hom <span class="quoted"><span class="free">hom</span></span> <span class="main">+</span> inj_idom_hom <span class="quoted"><span class="free">hom</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">hom</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> idom_divide <span class="main">⇒</span> <span class="tfree">'b</span> <span class="main">::</span> idom_divide"</span></span> 
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1" id="Ring_Hom-hom_dvd_iff"><span class="command">lemma</span></span> hom_dvd_iff<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">hom</span> <span class="free">p</span> <span class="keyword1">dvd</span> <span class="free">hom</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">p</span> <span class="keyword1">dvd</span> <span class="free">q</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">hom</span> <span class="free">p</span> <span class="keyword1">dvd</span> <span class="free">hom</span> <span class="free">q</span>"</span></span> <span class="keyword1"><span class="command">from</span></span> this<span class="main">[</span><span class="operator">unfolded</span> dvd_def<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
      id<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">hom</span> <span class="free">q</span> <span class="main">=</span> <span class="free">hom</span> <span class="free">p</span> <span class="main">*</span> <span class="skolem">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">hom</span> <span class="free">q</span> <span class="keyword1">div</span> <span class="free">hom</span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">hom</span> <span class="free">p</span> <span class="main">*</span> <span class="skolem">k</span><span class="main">)</span> <span class="keyword1">div</span> <span class="free">hom</span> <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> nonzero_mult_div_cancel_left<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> False<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">hom</span> <span class="free">q</span> <span class="keyword1">div</span> <span class="free">hom</span> <span class="free">p</span> <span class="main">=</span> <span class="free">hom</span> <span class="main">(</span><span class="free">q</span> <span class="keyword1">div</span> <span class="free">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> hom_div<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">=</span> <span class="free">hom</span> <span class="main">(</span><span class="free">q</span> <span class="keyword1">div</span> <span class="free">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> id<span class="main">[</span><span class="operator">unfolded</span> this<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">hom</span> <span class="free">q</span> <span class="main">=</span> <span class="free">hom</span> <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="main">(</span><span class="free">q</span> <span class="keyword1">div</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> hom_mult<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">=</span> <span class="free">p</span> <span class="main">*</span> <span class="main">(</span><span class="free">q</span> <span class="keyword1">div</span> <span class="free">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="keyword1">dvd</span> <span class="free">q</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> dvd_def <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">context</span></span> field_hom
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">sublocale</span></span> inj_idom_divide_hom <span class="keyword1"><span class="command">..</span></span>
<span class="keyword2"><span class="keyword">end</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Example Interpretations›</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> of_int_hom<span class="main">:</span> ring_hom <span class="quoted">of_int</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">interpretation</span></span> of_int_hom<span class="main">:</span> comm_ring_hom <span class="quoted">of_int</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">interpretation</span></span> of_int_hom<span class="main">:</span> idom_hom <span class="quoted">of_int</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">interpretation</span></span> of_int_hom<span class="main">:</span> inj_ring_hom <span class="quoted"><span class="quoted">"of_int <span class="main">::</span> int <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>ring_1<span class="main">,</span>ring_char_0<span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">interpretation</span></span> of_int_hom<span class="main">:</span> inj_comm_ring_hom <span class="quoted"><span class="quoted">"of_int <span class="main">::</span> int <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>comm_ring_1<span class="main">,</span>ring_char_0<span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">interpretation</span></span> of_int_hom<span class="main">:</span> inj_idom_hom <span class="quoted"><span class="quoted">"of_int <span class="main">::</span> int <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>idom<span class="main">,</span>ring_char_0<span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Somehow <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> of_rat<span class="antiquote"><span class="antiquote">}</span></span></span></span> is defined only on <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>char_0›</span></span></span></span>.›</span></span>
<span class="keyword1"><span class="command">interpretation</span></span> of_rat_hom<span class="main">:</span> field_char_0_hom <span class="quoted"><span class="quoted">"of_rat"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> of_rat_add of_rat_mult of_rat_inverse of_rat_minus<span class="main">)</span>

<span class="keyword1"><span class="command">interpretation</span></span> of_real_hom<span class="main">:</span> inj_ring_hom <span class="quoted">of_real</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">interpretation</span></span> of_real_hom<span class="main">:</span> inj_comm_ring_hom <span class="quoted">of_real</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">interpretation</span></span> of_real_hom<span class="main">:</span> inj_idom_hom <span class="quoted">of_real</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">interpretation</span></span> of_real_hom<span class="main">:</span> field_hom <span class="quoted">of_real</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">interpretation</span></span> of_real_hom<span class="main">:</span> field_char_0_hom <span class="quoted"><span class="quoted">"of_real"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Constant multiplication in a semiring is only a monoid homomorphism.›</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> mult_hom<span class="main">:</span> comm_monoid_add_hom <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">c</span> <span class="main">*</span> <span class="bound">x</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="free">c</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> semiring_1"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Missing_Unsorted">
<div class="head">
<h1>Theory Missing_Unsorted</h1>
</div>
<pre class="source"><span class="comment1">(*  
    Author:      René Thiemann 
                 Akihisa Yamada
                 Jose Divason
    License:     BSD
*)</span>
<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Missing Unsorted›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹This theory contains several lemmas which might be of interest to the Isabelle distribution.
  For instance, we prove that $b^n \cdot n^k$ is bounded by a constant whenever $0 &lt; b &lt; 1$.›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Missing_Unsorted
<span class="keyword2"><span class="keyword">imports</span></span>
  <a href="https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL/Complex.html">HOL.Complex</a> <span class="quoted">"<a href="https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL-Computational_Algebra/Factorial_Ring.html">HOL-Computational_Algebra.Factorial_Ring</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Missing_Unsorted-bernoulli_inequality"><span class="command">lemma</span></span> bernoulli_inequality<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">1</span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> linordered_field<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">+</span> of_nat <span class="free">n</span> <span class="main">*</span> <span class="free">x</span> <span class="main">≤</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">x</span><span class="main">)</span> <span class="main">^</span> <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">+</span> of_nat <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">*</span> <span class="free">x</span> <span class="main">=</span> <span class="main">1</span> <span class="main">+</span> <span class="free">x</span> <span class="main">+</span> of_nat <span class="skolem">n</span> <span class="main">*</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="main">…</span> <span class="main">+</span> of_nat <span class="skolem">n</span> <span class="main">*</span> <span class="free">x</span> <span class="main">^</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> of_nat <span class="skolem">n</span> <span class="main">*</span> <span class="free">x</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span> power2_eq_square<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">x</span><span class="main">)</span> <span class="main">^</span> <span class="skolem">n</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> mult_right_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> Suc<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> x<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">x</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">context</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">b</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> archimedean_field"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1" id="Missing_Unsorted-pow_one"><span class="command">lemma</span></span> pow_one<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">^</span> <span class="free">x</span> <span class="main">≤</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> power_Suc_less_one<span class="main">[</span><span class="operator">OF</span> b<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">-</span> <span class="main">1</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1" id="Missing_Unsorted-pow_zero"><span class="command">lemma</span></span> pow_zero<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">b</span> <span class="main">^</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> b<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Missing_Unsorted-exp_tends_to_zero"><span class="command">lemma</span></span> exp_tends_to_zero<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">x</span><span class="main">.</span> <span class="free">b</span> <span class="main">^</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">c</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> not<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="var">?thesis</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">bb</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">bb</span> <span class="main">=</span> inverse <span class="free">b</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">cc</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">cc</span> <span class="main">=</span> inverse <span class="free">c</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> b <span class="keyword1"><span class="command">have</span></span> bb<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">bb</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> bb_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> one_less_inverse<span class="main">)</span>  
  <span class="keyword1"><span class="command">from</span></span> c <span class="keyword1"><span class="command">have</span></span> cc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">cc</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> cc_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">bbb</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">bbb</span> <span class="main">=</span> <span class="skolem">bb</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">bb</span> <span class="main">=</span> <span class="main">1</span> <span class="main">+</span> <span class="skolem">bbb</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> bbb<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">bbb</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> bm1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">bbb</span> <span class="main">≥</span> <span class="main">-</span><span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> bbb_def <span class="keyword1"><span class="command">using</span></span> bb <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">n</span><span class="main">.</span> <span class="skolem">cc</span> <span class="main">/</span> <span class="skolem">bbb</span> <span class="main">&lt;</span> of_nat <span class="bound">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> reals_Archimedean2<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> lt<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">cc</span> <span class="main">/</span> <span class="skolem">bbb</span> <span class="main">&lt;</span> of_nat <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> not <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">b</span> <span class="main">^</span> <span class="skolem">n</span> <span class="main">≤</span> <span class="free">c</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> bnc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">^</span> <span class="skolem">n</span> <span class="main">&gt;</span> <span class="free">c</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">bb</span> <span class="main">^</span> <span class="skolem">n</span> <span class="main">=</span> inverse <span class="main">(</span><span class="free">b</span> <span class="main">^</span> <span class="skolem">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> bb_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> power_inverse<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">&lt;</span> <span class="skolem">cc</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> cc_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> less_imp_inverse_less<span class="main"><span class="main">[</span></span><span class="operator">OF</span> bnc c<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">&lt;</span> <span class="skolem">bbb</span> <span class="main">*</span> of_nat <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> lt bbb <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult.commute pos_divide_less_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="skolem">bb</span> <span class="main">^</span> <span class="skolem">n</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> bernoulli_inequality<span class="main">[</span><span class="operator">OF</span> bm1<span class="main">,</span> <span class="operator">folded</span> id<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">n</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Missing_Unsorted-linear_exp_bound"><span class="command">lemma</span></span> linear_exp_bound<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">p</span><span class="main">.</span> <span class="main">∀</span> <span class="bound">x</span><span class="main">.</span> <span class="free">b</span> <span class="main">^</span> <span class="bound">x</span> <span class="main">*</span> of_nat <span class="bound">x</span> <span class="main">≤</span> <span class="bound">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> b <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">-</span> <span class="free">b</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> exp_tends_to_zero<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x0</span></span> <span class="keyword2"><span class="keyword">where</span></span> x0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">^</span> <span class="skolem">x0</span> <span class="main">≤</span> <span class="main">1</span> <span class="main">-</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≥</span> <span class="skolem">x0</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">y</span><span class="main">.</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">x0</span> <span class="main">+</span> <span class="bound">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">x0</span> <span class="main">+</span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">^</span> <span class="skolem">x</span> <span class="main">=</span> <span class="free">b</span> <span class="main">^</span> <span class="skolem">x0</span> <span class="main">*</span> <span class="free">b</span> <span class="main">^</span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> x <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power_add<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">^</span> <span class="skolem">x0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> pow_one<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">y</span></span><span class="main">]</span> pow_zero<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x0</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="main">1</span> <span class="main">-</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> x0<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">^</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="main">1</span> <span class="main">-</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> x0 <span class="main">=</span> this
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">bs</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">bs</span> <span class="main">=</span> insert <span class="main">1</span> <span class="main">{</span> <span class="free">b</span> <span class="main">^</span> Suc <span class="bound">x</span> <span class="main">*</span> of_nat <span class="main">(</span>Suc <span class="bound">x</span><span class="main">)</span> <span class="main">|</span> <span class="bound">x</span> <span class="main">.</span> <span class="bound">x</span> <span class="main">≤</span> <span class="skolem">x0</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> bs<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="skolem">bs</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> bs_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> Max <span class="skolem">bs</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> bs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">b</span><span class="main">.</span> <span class="bound">b</span> <span class="main">∈</span> <span class="skolem">bs</span> <span class="main">⟹</span> <span class="bound">b</span> <span class="main">≤</span> <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> p_def <span class="keyword1"><span class="command">using</span></span> bs <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> p1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">≥</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> bs_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">p</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> allI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">^</span> <span class="skolem">x</span> <span class="main">*</span> of_nat <span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">p</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">x</span><span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">x0</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> bs<span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> bs_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> True<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?x</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"of_nat <span class="skolem">x</span> <span class="main">::</span> <span class="tfree">'a</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">^</span> <span class="main">(</span>Suc <span class="skolem">x</span><span class="main">)</span> <span class="main">*</span> of_nat <span class="main">(</span>Suc <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">b</span> <span class="main">*</span> <span class="main">(</span><span class="free">b</span> <span class="main">^</span> <span class="skolem">x</span> <span class="main">*</span> <span class="var">?x</span><span class="main">)</span> <span class="main">+</span> <span class="free">b</span> <span class="main">^</span> Suc <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">*</span> <span class="skolem">p</span> <span class="main">+</span> <span class="free">b</span> <span class="main">^</span> Suc <span class="skolem">x</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> add_right_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> mult_left_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> Suc<span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> b<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">p</span> <span class="main">-</span> <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">b</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">p</span> <span class="main">-</span> <span class="free">b</span> <span class="main">^</span> <span class="main">(</span>Suc <span class="skolem">x</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="skolem">p</span> <span class="main">-</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">^</span> Suc <span class="skolem">x</span> <span class="main">≤</span> <span class="main">1</span> <span class="main">-</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> x0<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">x</span>"</span></span><span class="main">]</span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">b</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> b p1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> diff_left_mono<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">insert</span> p1<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Missing_Unsorted-poly_exp_bound"><span class="command">lemma</span></span> poly_exp_bound<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">p</span><span class="main">.</span> <span class="main">∀</span> <span class="bound">x</span><span class="main">.</span> <span class="free">b</span> <span class="main">^</span> <span class="bound">x</span> <span class="main">*</span> of_nat <span class="bound">x</span> <span class="main">^</span> <span class="free">deg</span> <span class="main">≤</span> <span class="bound">p</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">deg</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 0
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="main"><span class="quoted"><span class="main"><span class="quoted"><span class="main">1</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> allI<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> pow_one<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">deg</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> IH<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">x</span><span class="main">.</span> <span class="free">b</span> <span class="main">^</span> <span class="bound">x</span> <span class="main">*</span> <span class="main">(</span>of_nat <span class="bound">x</span><span class="main">)</span> <span class="main">^</span> <span class="skolem">deg</span> <span class="main">≤</span> <span class="skolem">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> max <span class="main">0</span> <span class="skolem">q</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> IH <span class="keyword1"><span class="command">have</span></span> IH<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">x</span><span class="main">.</span> <span class="free">b</span> <span class="main">^</span> <span class="bound">x</span> <span class="main">*</span> <span class="main">(</span>of_nat <span class="bound">x</span><span class="main">)</span> <span class="main">^</span> <span class="skolem">deg</span> <span class="main">≤</span> <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> p_def <span class="keyword1"><span class="command">using</span></span> le_max_iff_disj <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> p_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">deg</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> linear_exp_bound <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False <span class="keyword1"><span class="command">note</span></span> deg <span class="main">=</span> this
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">p'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p'</span> <span class="main">=</span> <span class="skolem">p</span><span class="main">*</span><span class="skolem">p</span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">^</span> Suc <span class="skolem">deg</span> <span class="main">*</span> inverse <span class="free">b</span>"</span></span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">x</span><span class="main">.</span> <span class="free">b</span> <span class="main">^</span> <span class="bound">x</span> <span class="main">*</span> <span class="main">(</span>of_nat <span class="bound">x</span><span class="main">)</span> <span class="main">^</span> Suc <span class="skolem">deg</span>"</span></span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">=</span> <span class="var">?f</span>"</span></span>
      <span class="keyword1"><span class="command">{</span></span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
        <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?x</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"of_nat <span class="skolem">x</span> <span class="main">::</span> <span class="tfree">'a</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> Suc <span class="skolem">deg</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">p</span> <span class="main">*</span> <span class="skolem">p</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> False
          <span class="keyword1"><span class="command">hence</span></span> x1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?x</span> <span class="main">≥</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
          <span class="keyword1"><span class="command">from</span></span> x1 <span class="keyword1"><span class="command">have</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?x</span> <span class="main">^</span> <span class="main">(</span><span class="skolem">deg</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">≥</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">from</span></span> x1 <span class="keyword1"><span class="command">have</span></span> xx<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?x</span> <span class="main">^</span> Suc <span class="skolem">deg</span> <span class="main">≥</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> one_le_power<span class="main">)</span>
          <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">=</span> <span class="free">b</span> <span class="main">^</span> <span class="skolem">x</span> <span class="main">*</span> <span class="free">b</span> <span class="main">^</span> <span class="skolem">x</span> <span class="main">*</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> Suc <span class="skolem">deg</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">have</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> c_def <span class="keyword1"><span class="command">using</span></span> b <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="var">?f</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> f_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">^</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">b</span> <span class="main">^</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">b</span> <span class="main">^</span> <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power2_eq_square power_even_eq<span class="main">)</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"of_nat <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">*</span> <span class="var">?x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="var">?x</span><span class="main">)</span> <span class="main">^</span> Suc <span class="skolem">deg</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">^</span> Suc <span class="skolem">deg</span> <span class="main">*</span> <span class="var">?x</span> <span class="main">^</span> Suc <span class="skolem">deg</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">c</span> <span class="main">*</span> <span class="var">?x</span> <span class="main">^</span> Suc <span class="skolem">deg</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> c_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="skolem">c</span> <span class="main">*</span> <span class="var">?x</span> <span class="main">^</span> Suc <span class="skolem">deg</span> <span class="main">*</span> <span class="var">?x</span> <span class="main">^</span> <span class="main">(</span><span class="skolem">deg</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">*</span> <span class="var">?x</span> <span class="main">^</span> Suc <span class="skolem">deg</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> c xx <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> mult_le_cancel_left1 <span class="keyword1"><span class="command">using</span></span> x <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">c</span> <span class="main">*</span> <span class="var">?x</span> <span class="main">^</span> <span class="main">(</span>Suc <span class="skolem">deg</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">deg</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power_add<span class="main">)</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">deg</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">deg</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">deg</span> <span class="main">+</span> <span class="skolem">deg</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> deg <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?x</span> <span class="main">^</span> <span class="main">(</span><span class="skolem">deg</span> <span class="main">+</span> <span class="skolem">deg</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="var">?x</span> <span class="main">^</span> <span class="skolem">deg</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="var">?x</span> <span class="main">^</span> <span class="skolem">deg</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power_add<span class="main">)</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">*</span> <span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> Suc <span class="skolem">deg</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="free">b</span> <span class="main">^</span> <span class="skolem">x</span> <span class="main">*</span> <span class="var">?x</span> <span class="main">^</span> <span class="skolem">deg</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">b</span> <span class="main">^</span> <span class="skolem">x</span> <span class="main">*</span> <span class="var">?x</span> <span class="main">^</span> <span class="skolem">deg</span><span class="main">)</span><span class="main">)</span>"</span></span> 
            <span class="keyword1"><span class="command">unfolding</span></span> c_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>  
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> Suc <span class="skolem">deg</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">p</span> <span class="main">*</span> <span class="skolem">p</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> mult_left_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> mult_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> IH IH p<span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> pow_zero<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">x</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
          <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> Suc <span class="skolem">deg</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">p</span> <span class="main">*</span> <span class="skolem">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
        <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> f_def<span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?f</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> Suc <span class="skolem">deg</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">p</span> <span class="main">*</span> <span class="skolem">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> f_def <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> even <span class="main">=</span> this
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">p'</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> allI<span class="main">)</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">y</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?f</span> <span class="skolem">y</span> <span class="main">≤</span> <span class="skolem">p'</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"even <span class="skolem">y</span>"</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> True
          <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">y</span> <span class="keyword1">div</span> <span class="numeral">2</span>"</span></span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">*</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> x_def <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">from</span></span> even<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">,</span> <span class="operator">folded</span> this<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?f</span> <span class="skolem">y</span> <span class="main">≤</span> <span class="numeral">2</span> <span class="main">^</span> Suc <span class="skolem">deg</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">p</span> <span class="main">*</span> <span class="skolem">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="main">…</span> <span class="main">*</span> inverse <span class="free">b</span>"</span></span>
            <span class="keyword1"><span class="command">unfolding</span></span> mult_le_cancel_left1 <span class="keyword1"><span class="command">using</span></span> b p
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_split_simps</span></span> one_le_inverse<span class="main">)</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">p'</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> p'_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?f</span> <span class="skolem">y</span> <span class="main">≤</span> <span class="skolem">p'</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> False
          <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">y</span> <span class="keyword1">div</span> <span class="numeral">2</span>"</span></span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">*</span> <span class="skolem">x</span> <span class="main">+</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> x_def <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?f</span> <span class="skolem">y</span> <span class="main">=</span> <span class="var">?f</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="skolem">x</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">^</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="skolem">x</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> of_nat <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="skolem">x</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">^</span> Suc <span class="skolem">deg</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> mult_left_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> power_mono<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> b<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span> 
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">^</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="skolem">x</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="free">b</span> <span class="main">^</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="skolem">x</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> inverse <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> b <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">^</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="skolem">x</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> inverse <span class="free">b</span> <span class="main">*</span> of_nat <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="skolem">x</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">^</span> Suc <span class="skolem">deg</span> <span class="main">=</span> 
            inverse <span class="free">b</span> <span class="main">*</span> <span class="var">?f</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> inverse <span class="free">b</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> Suc <span class="skolem">deg</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">p</span> <span class="main">*</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> mult_left_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> even<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> b<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">p'</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> p'_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?f</span> <span class="skolem">y</span> <span class="main">≤</span> <span class="skolem">p'</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1" id="Missing_Unsorted-prod_list_replicate"><span class="command">lemma</span></span> prod_list_replicate<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"prod_list <span class="main">(</span>replicate <span class="free">n</span> <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="free">a</span> <span class="main">^</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="Missing_Unsorted-prod_list_power"><span class="command">lemma</span></span> prod_list_power<span class="main">:</span> <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">xs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> comm_monoid_mult list"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"prod_list <span class="free">xs</span> <span class="main">^</span> <span class="free">n</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">x</span><span class="main">←</span><span class="free">xs</span><span class="main">.</span> <span class="bound">x</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> power_mult_distrib<span class="main">)</span>

<span class="keyword1" id="Missing_Unsorted-set_upt_Suc"><span class="command">lemma</span></span> set_upt_Suc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">0</span> <span class="main">..&lt;</span> Suc <span class="free">i</span><span class="main">}</span> <span class="main">=</span> insert <span class="free">i</span> <span class="main">{</span><span class="main">0</span> <span class="main">..&lt;</span> <span class="free">i</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> atLeast0_lessThan_Suc<span class="main">)</span>

<span class="keyword1" id="Missing_Unsorted-prod_pow"><span class="command">lemma</span></span> prod_pow<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∏</span><span class="bound">i</span> <span class="main">=</span> <span class="main">0</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">.</span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">p</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> comm_monoid_mult<span class="main">)</span> <span class="main">^</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> set_upt_Suc<span class="main">)</span>


<span class="comment1">(* GCD and LCM part *)</span>

<span class="keyword1" id="Missing_Unsorted-dvd_abs_mult_left_int"><span class="command">lemma</span></span> dvd_abs_mult_left_int <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="free">a</span><span class="main">¦</span> <span class="main">*</span> <span class="free">y</span> <span class="keyword1">dvd</span> <span class="free">x</span> <span class="main">⟷</span> <span class="free">a</span> <span class="main">*</span> <span class="free">y</span> <span class="keyword1">dvd</span> <span class="free">x</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="free">x</span> <span class="free">y</span> <span class="free">a</span> <span class="main">::</span> <span class="quoted">int</span>
  <span class="keyword1"><span class="command">using</span></span> abs_dvd_iff <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">*</span> <span class="free">y</span>"</span></span><span class="main">]</span> abs_dvd_iff <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="free">a</span><span class="main">¦</span> <span class="main">*</span> <span class="free">y</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> abs_mult<span class="main">)</span>
  
<span class="keyword1" id="Missing_Unsorted-gcd_abs_mult_right_int"><span class="command">lemma</span></span> gcd_abs_mult_right_int <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"gcd <span class="free">x</span> <span class="main">(</span><span class="main">¦</span><span class="free">a</span><span class="main">¦</span> <span class="main">*</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> gcd <span class="free">x</span> <span class="main">(</span><span class="free">a</span> <span class="main">*</span> <span class="free">y</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="free">x</span> <span class="free">y</span> <span class="free">a</span> <span class="main">::</span> <span class="quoted">int</span>
  <span class="keyword1"><span class="command">using</span></span> gcd_abs2_int <span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">*</span> <span class="free">y</span>"</span></span><span class="main">]</span> gcd_abs2_int <span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="free">a</span><span class="main">¦</span> <span class="main">*</span> <span class="free">y</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> abs_mult<span class="main">)</span>

<span class="keyword1" id="Missing_Unsorted-lcm_abs_mult_right_int"><span class="command">lemma</span></span> lcm_abs_mult_right_int <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"lcm <span class="free">x</span> <span class="main">(</span><span class="main">¦</span><span class="free">a</span><span class="main">¦</span> <span class="main">*</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> lcm <span class="free">x</span> <span class="main">(</span><span class="free">a</span> <span class="main">*</span> <span class="free">y</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="free">x</span> <span class="free">y</span> <span class="free">a</span> <span class="main">::</span> <span class="quoted">int</span>
  <span class="keyword1"><span class="command">using</span></span> lcm_abs2_int <span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">*</span> <span class="free">y</span>"</span></span><span class="main">]</span> lcm_abs2_int <span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="free">a</span><span class="main">¦</span> <span class="main">*</span> <span class="free">y</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> abs_mult<span class="main">)</span>

<span class="keyword1" id="Missing_Unsorted-gcd_abs_mult_left_int"><span class="command">lemma</span></span> gcd_abs_mult_left_int <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"gcd <span class="free">x</span> <span class="main">(</span><span class="free">a</span> <span class="main">*</span> <span class="main">¦</span><span class="free">y</span><span class="main">¦</span><span class="main">)</span> <span class="main">=</span> gcd <span class="free">x</span> <span class="main">(</span><span class="free">a</span> <span class="main">*</span> <span class="free">y</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="free">x</span> <span class="free">y</span> <span class="free">a</span> <span class="main">::</span> <span class="quoted">int</span>
  <span class="keyword1"><span class="command">using</span></span> gcd_abs2_int <span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">*</span> <span class="main">¦</span><span class="free">y</span><span class="main">¦</span>"</span></span><span class="main">]</span> gcd_abs2_int <span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">*</span> <span class="free">y</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> abs_mult<span class="main">)</span>

<span class="keyword1" id="Missing_Unsorted-lcm_abs_mult_left_int"><span class="command">lemma</span></span> lcm_abs_mult_left_int <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"lcm <span class="free">x</span> <span class="main">(</span><span class="free">a</span> <span class="main">*</span> <span class="main">¦</span><span class="free">y</span><span class="main">¦</span><span class="main">)</span> <span class="main">=</span> lcm <span class="free">x</span> <span class="main">(</span><span class="free">a</span> <span class="main">*</span> <span class="free">y</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="free">x</span> <span class="free">y</span> <span class="free">a</span> <span class="main">::</span> <span class="quoted">int</span>
  <span class="keyword1"><span class="command">using</span></span> lcm_abs2_int <span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">*</span> <span class="main">¦</span><span class="free">y</span><span class="main">¦</span>"</span></span><span class="main">]</span> lcm_abs2_int <span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">*</span> <span class="free">y</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> abs_mult<span class="main">)</span>


<span class="keyword1"><span class="command">abbreviation</span></span> <span class="main">(</span>input<span class="main">)</span> <span class="entity">list_gcd</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> semiring_gcd list <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">list_gcd</span> <span class="main">≡</span> gcd_list"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="main">(</span>input<span class="main">)</span> <span class="entity">list_lcm</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> semiring_gcd list <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">list_lcm</span> <span class="main">≡</span> lcm_list"</span></span>


<span class="keyword1" id="Missing_Unsorted-list_gcd_simps"><span class="command">lemma</span></span> list_gcd_simps<span class="main">:</span> <span class="quoted"><span class="quoted">"list_gcd <span class="main">[]</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"list_gcd <span class="main">(</span><span class="free">x</span> <span class="main">#</span> <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> gcd <span class="free">x</span> <span class="main">(</span>list_gcd <span class="free">xs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>

<span class="keyword1" id="Missing_Unsorted-list_gcd"><span class="command">lemma</span></span> list_gcd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> set <span class="free">xs</span> <span class="main">⟹</span> list_gcd <span class="free">xs</span> <span class="keyword1">dvd</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> Gcd_fin_dvd<span class="main">)</span>

<span class="keyword1" id="Missing_Unsorted-list_gcd_greatest"><span class="command">lemma</span></span> list_gcd_greatest<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> set <span class="free">xs</span> <span class="main">⟹</span> <span class="free">y</span> <span class="keyword1">dvd</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">y</span> <span class="keyword1">dvd</span> <span class="main">(</span>list_gcd <span class="free">xs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> gcd_list_greatest<span class="main">)</span>

<span class="keyword1" id="Missing_Unsorted-list_gcd_mult_int"><span class="command">lemma</span></span> list_gcd_mult_int <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">xs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"int list"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"list_gcd <span class="main">(</span>map <span class="main">(</span>times <span class="free">a</span><span class="main">)</span> <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> <span class="main">¦</span><span class="free">a</span><span class="main">¦</span> <span class="main">*</span> list_gcd <span class="free">xs</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Gcd_mult abs_mult<span class="main">)</span>

<span class="keyword1" id="Missing_Unsorted-list_lcm_simps"><span class="command">lemma</span></span> list_lcm_simps<span class="main">:</span> <span class="quoted"><span class="quoted">"list_lcm <span class="main">[]</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"list_lcm <span class="main">(</span><span class="free">x</span> <span class="main">#</span> <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> lcm <span class="free">x</span> <span class="main">(</span>list_lcm <span class="free">xs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>

<span class="keyword1" id="Missing_Unsorted-list_lcm"><span class="command">lemma</span></span> list_lcm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> set <span class="free">xs</span> <span class="main">⟹</span> <span class="free">x</span> <span class="keyword1">dvd</span> list_lcm <span class="free">xs</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> dvd_Lcm_fin<span class="main">)</span>

<span class="keyword1" id="Missing_Unsorted-list_lcm_least"><span class="command">lemma</span></span> list_lcm_least<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> set <span class="free">xs</span> <span class="main">⟹</span> <span class="bound">x</span> <span class="keyword1">dvd</span> <span class="free">y</span><span class="main">)</span> <span class="main">⟹</span> list_lcm <span class="free">xs</span> <span class="keyword1">dvd</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> lcm_list_least<span class="main">)</span>

<span class="keyword1" id="Missing_Unsorted-lcm_mult_distrib_nat"><span class="command">lemma</span></span> lcm_mult_distrib_nat<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">k</span> <span class="main">::</span> nat<span class="main">)</span> <span class="main">*</span> lcm <span class="free">m</span> <span class="free">n</span> <span class="main">=</span> lcm <span class="main">(</span><span class="free">k</span> <span class="main">*</span> <span class="free">m</span><span class="main">)</span> <span class="main">(</span><span class="free">k</span> <span class="main">*</span> <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lcm_mult_left<span class="main">)</span>

<span class="keyword1" id="Missing_Unsorted-lcm_mult_distrib_int"><span class="command">lemma</span></span> lcm_mult_distrib_int<span class="main">:</span> <span class="quoted"><span class="quoted">"abs <span class="main">(</span><span class="free">k</span><span class="main">::</span>int<span class="main">)</span> <span class="main">*</span> lcm <span class="free">m</span> <span class="free">n</span> <span class="main">=</span> lcm <span class="main">(</span><span class="free">k</span> <span class="main">*</span> <span class="free">m</span><span class="main">)</span> <span class="main">(</span><span class="free">k</span> <span class="main">*</span> <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lcm_mult_left abs_mult<span class="main">)</span>

<span class="keyword1" id="Missing_Unsorted-list_lcm_mult_int"><span class="command">lemma</span></span> list_lcm_mult_int <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">xs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"int list"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"list_lcm <span class="main">(</span>map <span class="main">(</span>times <span class="free">a</span><span class="main">)</span> <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">xs</span> <span class="main">=</span> <span class="main">[]</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">¦</span><span class="free">a</span><span class="main">¦</span> <span class="main">*</span> list_lcm <span class="free">xs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Lcm_mult abs_mult<span class="main">)</span>

<span class="keyword1" id="Missing_Unsorted-list_lcm_pos"><span class="command">lemma</span></span> list_lcm_pos<span class="main">:</span>
  <span class="quoted"><span class="quoted">"list_lcm <span class="free">xs</span> <span class="main">≥</span> <span class="main">(</span><span class="main">0</span> <span class="main">::</span> int<span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∉</span> set <span class="free">xs</span> <span class="main">⟹</span> list_lcm <span class="free">xs</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∉</span> set <span class="free">xs</span> <span class="main">⟹</span> list_lcm <span class="free">xs</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="main">¦</span>Lcm <span class="main">(</span>set <span class="free">xs</span><span class="main">)</span><span class="main">¦</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> abs_ge_zero<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> Lcm <span class="main">(</span>set <span class="free">xs</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"list_lcm <span class="free">xs</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∉</span> set <span class="free">xs</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"list_lcm <span class="free">xs</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Lcm_0_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹list_lcm <span class="free">xs</span> <span class="main">≥</span> <span class="main">0</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"list_lcm <span class="free">xs</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_less<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Missing_Unsorted-quotient_of_nonzero"><span class="command">lemma</span></span> quotient_of_nonzero<span class="main">:</span> <span class="quoted"><span class="quoted">"snd <span class="main">(</span>quotient_of <span class="free">r</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">(</span>quotient_of <span class="free">r</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> quotient_of_denom_pos' <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">r</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>

<span class="keyword1" id="Missing_Unsorted-quotient_of_int_div"><span class="command">lemma</span></span> quotient_of_int_div<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> q<span class="main">:</span> <span class="quoted"><span class="quoted">"quotient_of <span class="main">(</span>of_int <span class="free">x</span> <span class="main">/</span> of_int <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">a</span><span class="main">,</span> <span class="free">b</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">z</span><span class="main">.</span> <span class="bound">z</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">x</span> <span class="main">=</span> <span class="free">a</span> <span class="main">*</span> <span class="bound">z</span> <span class="main">∧</span> <span class="free">y</span> <span class="main">=</span> <span class="free">b</span> <span class="main">*</span> <span class="bound">z</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?r</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"rat_of_int"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">z</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">=</span> gcd <span class="free">x</span> <span class="free">y</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">x'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x'</span> <span class="main">=</span> <span class="free">x</span> <span class="keyword1">div</span> <span class="skolem">z</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">y'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y'</span> <span class="main">=</span> <span class="free">y</span> <span class="keyword1">div</span> <span class="skolem">z</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="skolem">z</span> <span class="main">*</span> <span class="skolem">x'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">=</span> <span class="skolem">z</span> <span class="main">*</span> <span class="skolem">y'</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> x'_def y'_def z_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> y <span class="keyword1"><span class="command">have</span></span> y'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y'</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> id <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> z<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> z_def <span class="keyword1"><span class="command">using</span></span> y <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> cop<span class="main">:</span> <span class="quoted"><span class="quoted">"coprime <span class="skolem">x'</span> <span class="skolem">y'</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> x'_def y'_def z_def 
    <span class="keyword1"><span class="command">using</span></span> div_gcd_coprime y <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?r</span> <span class="free">x</span> <span class="main">/</span> <span class="var">?r</span> <span class="free">y</span> <span class="main">=</span> <span class="var">?r</span> <span class="skolem">x'</span> <span class="main">/</span> <span class="var">?r</span> <span class="skolem">y'</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> id <span class="keyword1"><span class="command">using</span></span> z y y' <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span> 
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">[</span><span class="operator">unfolded</span> this<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> quot<span class="main">:</span> <span class="quoted"><span class="quoted">"quotient_of <span class="main">(</span><span class="var">?r</span> <span class="skolem">x'</span> <span class="main">/</span> <span class="var">?r</span> <span class="skolem">y'</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">a</span><span class="main">,</span> <span class="free">b</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> quotient_of_coprime<span class="main">[</span><span class="operator">OF</span> quot<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> cop'<span class="main">:</span> <span class="quoted"><span class="quoted">"coprime <span class="free">a</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">hence</span></span> cop<span class="main">:</span> <span class="quoted"><span class="quoted">"coprime <span class="free">b</span> <span class="free">a</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> quotient_of_denom_pos<span class="main">[</span><span class="operator">OF</span> quot<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> quotient_of_div<span class="main">[</span><span class="operator">OF</span> quot<span class="main">]</span> quotient_of_denom_pos<span class="main">[</span><span class="operator">OF</span> quot<span class="main">]</span> y'
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?r</span> <span class="skolem">x'</span> <span class="main">*</span> <span class="var">?r</span> <span class="free">b</span> <span class="main">=</span> <span class="var">?r</span> <span class="free">a</span> <span class="main">*</span> <span class="var">?r</span> <span class="skolem">y'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> id'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x'</span> <span class="main">*</span> <span class="free">b</span> <span class="main">=</span> <span class="free">a</span> <span class="main">*</span> <span class="skolem">y'</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> of_int_mult<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
  <span class="keyword1"><span class="command">from</span></span> id'<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="keyword1">dvd</span> <span class="skolem">y'</span> <span class="main">*</span> <span class="free">a</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> mult.commute<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">y'</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> cop y' <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="keyword1">dvd</span> <span class="skolem">y'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> coprime_dvd_mult_left_iff<span class="main">)</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">z'</span></span> <span class="keyword2"><span class="keyword">where</span></span> ybz<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y'</span> <span class="main">=</span> <span class="free">b</span> <span class="main">*</span> <span class="skolem">z'</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> dvd_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> id<span class="main">[</span><span class="operator">unfolded</span> y' this<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">=</span> <span class="free">b</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">z</span> <span class="main">*</span> <span class="skolem">z'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">y</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> zz<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">*</span> <span class="skolem">z'</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> quotient_of_div<span class="main">[</span><span class="operator">OF</span> q<span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="free">y</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> 
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?r</span> <span class="free">x</span> <span class="main">*</span> <span class="var">?r</span> <span class="free">b</span> <span class="main">=</span> <span class="var">?r</span> <span class="free">y</span> <span class="main">*</span> <span class="var">?r</span> <span class="free">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> id'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="free">b</span> <span class="main">=</span> <span class="free">y</span> <span class="main">*</span> <span class="free">a</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> of_int_mult<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
  <span class="keyword1"><span class="command">from</span></span> this<span class="main">[</span><span class="operator">unfolded</span> y<span class="main">]</span> b <span class="keyword1"><span class="command">have</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="free">a</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">z</span> <span class="main">*</span> <span class="skolem">z'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> x y <span class="keyword1"><span class="command">using</span></span> zz <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">max_list_non_empty</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">::</span> linorder<span class="main">)</span> list <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">max_list_non_empty</span> <span class="main">[</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">]</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">max_list_non_empty</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="main">=</span> max <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">(</span><span class="free">max_list_non_empty</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Missing_Unsorted-max_list_non_empty"><span class="command">lemma</span></span> max_list_non_empty<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> set <span class="free">xs</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">≤</span> max_list_non_empty <span class="free">xs</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">y</span> <span class="skolem">ys</span><span class="main">)</span> <span class="keyword1"><span class="command">note</span></span> oCons <span class="main">=</span> this
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">ys</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">z</span> <span class="skolem">zs</span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"max_list_non_empty <span class="main">(</span><span class="skolem">y</span> <span class="main">#</span> <span class="skolem">ys</span><span class="main">)</span> <span class="main">=</span> max <span class="skolem">y</span> <span class="main">(</span>max_list_non_empty <span class="skolem">ys</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> oCons <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> id <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> max.coboundedI2<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">insert</span> oCons<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Missing_Unsorted-cnj_reals"><span class="command">lemma</span></span> cnj_reals<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>cnj <span class="free">c</span> <span class="main">∈</span> <span class="main">ℝ</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">c</span> <span class="main">∈</span> <span class="main">ℝ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Reals_cnj_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="Missing_Unsorted-sgn_real_mono"><span class="command">lemma</span></span> sgn_real_mono<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟹</span> sgn <span class="free">x</span> <span class="main">≤</span> sgn <span class="main">(</span><span class="free">y</span> <span class="main">::</span> real<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> sgn_real_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>

<span class="keyword1" id="Missing_Unsorted-sgn_minus_rat"><span class="command">lemma</span></span> sgn_minus_rat<span class="main">:</span> <span class="quoted"><span class="quoted">"sgn <span class="main">(</span><span class="main">-</span> <span class="main">(</span><span class="free">x</span> <span class="main">::</span> rat<span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span> sgn <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> Rings.sgn_minus<span class="main">)</span>

<span class="keyword1" id="Missing_Unsorted-real_of_rat_sgn"><span class="command">lemma</span></span> real_of_rat_sgn<span class="main">:</span> <span class="quoted"><span class="quoted">"sgn <span class="main">(</span>of_rat <span class="free">x</span><span class="main">)</span> <span class="main">=</span> real_of_rat <span class="main">(</span>sgn <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> sgn_real_def sgn_rat_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Missing_Unsorted-inverse_le_iff_sgn"><span class="command">lemma</span></span> inverse_le_iff_sgn<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> sgn<span class="main">:</span> <span class="quoted"><span class="quoted">"sgn <span class="free">x</span> <span class="main">=</span> sgn <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>inverse <span class="main">(</span><span class="free">x</span> <span class="main">::</span> real<span class="main">)</span> <span class="main">≤</span> inverse <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">y</span> <span class="main">≤</span> <span class="free">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">with</span></span> sgn <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sgn <span class="free">y</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> sgn_real_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False <span class="keyword1"><span class="command">note</span></span> x <span class="main">=</span> this
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">with</span></span> x sgn <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sgn <span class="free">y</span> <span class="main">=</span> <span class="main">-</span><span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> sgn_real_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> inverse_le_iff_le_neg<span class="main"><span class="main">[</span></span><span class="operator">OF</span> True <span class="quoted"><span class="quoted">‹<span class="free">y</span> <span class="main">&lt;</span> <span class="main">0</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">with</span></span> x <span class="keyword1"><span class="command">have</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> sgn <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sgn <span class="free">y</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> sgn_real_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> inverse_le_iff_le<span class="main"><span class="main">[</span></span><span class="operator">OF</span> x <span class="quoted"><span class="quoted">‹<span class="free">y</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Missing_Unsorted-inverse_le_sgn"><span class="command">lemma</span></span> inverse_le_sgn<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> sgn<span class="main">:</span> <span class="quoted"><span class="quoted">"sgn <span class="free">x</span> <span class="main">=</span> sgn <span class="free">y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> xy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="main">(</span><span class="free">y</span> <span class="main">::</span> real<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"inverse <span class="free">y</span> <span class="main">≤</span> inverse <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> xy inverse_le_iff_sgn<span class="main">[</span><span class="operator">OF</span> sgn<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Missing_Unsorted-set_list_update"><span class="command">lemma</span></span> set_list_update<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span><span class="free">xs</span> <span class="main">[</span><span class="free">i</span> <span class="main">:=</span> <span class="free">k</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> 
  <span class="main">(</span><span class="keyword1">if</span> <span class="free">i</span> <span class="main">&lt;</span> length <span class="free">xs</span> <span class="keyword1">then</span> insert <span class="free">k</span> <span class="main">(</span>set <span class="main">(</span>take <span class="free">i</span> <span class="free">xs</span><span class="main">)</span> <span class="main">∪</span> set <span class="main">(</span>drop <span class="main">(</span>Suc <span class="free">i</span><span class="main">)</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">else</span> set <span class="free">xs</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">i</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">x</span> <span class="skolem">xs</span> <span class="skolem">i</span><span class="main">)</span> 
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">i</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Missing_Unsorted-prod_list_dvd"><span class="command">lemma</span></span> prod_list_dvd<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> comm_monoid_mult<span class="main">)</span> <span class="main">∈</span> set <span class="free">xs</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">dvd</span> prod_list <span class="free">xs</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">[</span><span class="operator">unfolded</span> in_set_conv_decomp<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ys</span></span> <span class="skolem"><span class="skolem">zs</span></span> <span class="keyword2"><span class="keyword">where</span></span> xs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">=</span> <span class="skolem">ys</span> <span class="main">@</span> <span class="free">x</span> <span class="main">#</span> <span class="skolem">zs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> xs dvd_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"prod_list <span class="main"><span class="main"><span class="main">(</span></span></span><span class="skolem"><span class="skolem"><span class="skolem">ys</span></span></span> <span class="main"><span class="main"><span class="main">@</span></span></span> <span class="skolem"><span class="skolem"><span class="skolem">zs</span></span></span><span class="main"><span class="main"><span class="main">)</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Missing_Unsorted-dvd_prod"><span class="command">lemma</span></span> dvd_prod<span class="main">:</span> 
<span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'b</span> set"</span></span> 
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">b</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="free">a</span> <span class="keyword1">dvd</span> <span class="free">f</span> <span class="bound">b</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="keyword1">dvd</span> prod <span class="free">f</span> <span class="free">A</span>"</span></span> 
<span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">,</span>1<span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">A</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>insert <span class="skolem">x</span> <span class="skolem">A</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
    <span class="keyword1"><span class="command">using</span></span> comm_monoid_mult_class.dvd_mult dvd_mult2 insert_iff prod.insert <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">context</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">xs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> comm_monoid_mult list"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1" id="Missing_Unsorted-prod_list_filter"><span class="command">lemma</span></span> prod_list_filter<span class="main">:</span> <span class="quoted"><span class="quoted">"prod_list <span class="main">(</span>filter <span class="free">f</span> <span class="free">xs</span><span class="main">)</span> <span class="main">*</span> prod_list <span class="main">(</span>filter <span class="main">(</span><span class="main">λ</span> <span class="bound">x</span><span class="main">.</span> <span class="main">¬</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> prod_list <span class="free">xs</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>

<span class="keyword1" id="Missing_Unsorted-prod_list_partition"><span class="command">lemma</span></span> prod_list_partition<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"partition <span class="free">f</span> <span class="free">xs</span> <span class="main">=</span> <span class="main">(</span><span class="free">ys</span><span class="main">,</span> <span class="free">zs</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"prod_list <span class="free">xs</span> <span class="main">=</span> prod_list <span class="free">ys</span> <span class="main">*</span> prod_list <span class="free">zs</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> prod_list_filter<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">f</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> o_def<span class="main">)</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1" id="Missing_Unsorted-dvd_imp_mult_div_cancel_left"><span class="command">lemma</span></span> dvd_imp_mult_div_cancel_left<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> semidom_divide<span class="main">)</span> <span class="keyword1">dvd</span> <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">*</span> <span class="main">(</span><span class="free">b</span> <span class="keyword1">div</span> <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="free">b</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">with</span></span> dvdE<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">=</span> <span class="free">a</span> <span class="main">*</span> <span class="skolem">c</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command"><span class="improper">with</span></span></span> False <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">*</span> <span class="skolem">c</span> <span class="keyword1">div</span> <span class="free">a</span> <span class="main">=</span> <span class="skolem">c</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">note</span></span> *<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span><span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> semidom<span class="main">)</span> prod_list_zero_iff<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"prod_list <span class="free">xs</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="main">0</span> <span class="main">∈</span> set <span class="free">xs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">xs</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>


<span class="keyword1"><span class="command">context</span></span> comm_monoid_mult <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Missing_Unsorted-unit_prod"><span class="command">lemma</span></span> unit_prod <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="keyword1">dvd</span> <span class="main">1</span> <span class="main">⟹</span> <span class="free">b</span> <span class="keyword1">dvd</span> <span class="main">1</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">a</span> <span class="main">*</span> <span class="free">b</span><span class="main">)</span> <span class="keyword1">dvd</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> mult_1_left <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="main"><span class="quoted"><span class="main"><span class="quoted"><span class="main">1</span></span></span></span></span></span><span class="main"><span class="main">,</span></span> <span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">rule</span> mult_dvd_mono<span class="main">)</span>

<span class="keyword1" id="Missing_Unsorted-is_unit_mult_iff"><span class="command">lemma</span></span> is_unit_mult_iff<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span> <span class="main">*</span> <span class="free">b</span><span class="main">)</span> <span class="keyword1">dvd</span> <span class="main">1</span> <span class="main">⟷</span> <span class="free">a</span> <span class="keyword1">dvd</span> <span class="main">1</span> <span class="main">∧</span> <span class="free">b</span> <span class="keyword1">dvd</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> dvd_mult_left dvd_mult_right<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">context</span></span> comm_semiring_1
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1" id="Missing_Unsorted-irreducibleE"><span class="command">lemma</span></span> irreducibleE<span class="main">[</span><span class="operator">elim</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"irreducible <span class="free">p</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> <span class="main">¬</span> <span class="free">p</span> <span class="keyword1">dvd</span> <span class="main">1</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">⋀</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="free">p</span> <span class="main">=</span> <span class="bound">a</span> <span class="main">*</span> <span class="bound">b</span> <span class="main">⟹</span> <span class="bound">a</span> <span class="keyword1">dvd</span> <span class="main">1</span> <span class="main">∨</span> <span class="bound">b</span> <span class="keyword1">dvd</span> <span class="main">1</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">thesis</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="free">thesis</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> irreducible_def<span class="main">)</span>

<span class="keyword1" id="Missing_Unsorted-not_irreducibleE"><span class="command">lemma</span></span> not_irreducibleE<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> irreducible <span class="free">x</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟹</span> <span class="free">thesis</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">dvd</span> <span class="main">1</span> <span class="main">⟹</span> <span class="free">thesis</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="free">x</span> <span class="main">=</span> <span class="bound">a</span> <span class="main">*</span> <span class="bound">b</span> <span class="main">⟹</span> <span class="main">¬</span> <span class="bound">a</span> <span class="keyword1">dvd</span> <span class="main">1</span> <span class="main">⟹</span> <span class="main">¬</span> <span class="bound">b</span> <span class="keyword1">dvd</span> <span class="main">1</span> <span class="main">⟹</span> <span class="free">thesis</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="free">thesis</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> irreducible_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Missing_Unsorted-prime_elem_dvd_prod_list"><span class="command">lemma</span></span> prime_elem_dvd_prod_list<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"prime_elem <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> pA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="keyword1">dvd</span> prod_list <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">a</span> <span class="main">∈</span> set <span class="free">A</span><span class="main">.</span> <span class="free">p</span> <span class="keyword1">dvd</span> <span class="bound">a</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">insert</span> pA<span class="main"><span class="keyword3">,</span></span> <span class="operator">induct</span> <span class="quoted"><span class="free">A</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil
  <span class="keyword1"><span class="command">with</span></span> p <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prime_elem_not_unit<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">A</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> prime_elem_dvd_mult_iff<span class="main"><span class="main">[</span></span><span class="operator">OF</span> p<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Missing_Unsorted-prime_elem_dvd_prod_mset"><span class="command">lemma</span></span> prime_elem_dvd_prod_mset<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"prime_elem <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> pA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="keyword1">dvd</span> prod_mset <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">a</span> <span class="main">∈#</span> <span class="free">A</span><span class="main">.</span> <span class="free">p</span> <span class="keyword1">dvd</span> <span class="bound">a</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">insert</span> pA<span class="main"><span class="keyword3">,</span></span> <span class="operator">induct</span> <span class="quoted"><span class="free">A</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> empty
  <span class="keyword1"><span class="command">with</span></span> p <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prime_elem_not_unit<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>add <span class="skolem">a</span> <span class="skolem">A</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> prime_elem_dvd_mult_iff<span class="main"><span class="main">[</span></span><span class="operator">OF</span> p<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Missing_Unsorted-mult_unit_dvd_iff"><span class="command">lemma</span></span> mult_unit_dvd_iff<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="keyword1">dvd</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">*</span> <span class="free">b</span> <span class="keyword1">dvd</span> <span class="free">c</span> <span class="main">⟷</span> <span class="free">a</span> <span class="keyword1">dvd</span> <span class="free">c</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">*</span> <span class="free">b</span> <span class="keyword1">dvd</span> <span class="free">c</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="keyword1">dvd</span> <span class="free">c</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> dvd_mult_left<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">b</span></span> <span class="quoted"><span class="free">c</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="keyword1">dvd</span> <span class="free">c</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> assms mult_dvd_mono <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">*</span> <span class="free">b</span> <span class="keyword1">dvd</span> <span class="free">c</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Missing_Unsorted-mult_unit_dvd_iff'"><span class="command">lemma</span></span> mult_unit_dvd_iff'<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="keyword1">dvd</span> <span class="main">1</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">a</span> <span class="main">*</span> <span class="free">b</span><span class="main">)</span> <span class="keyword1">dvd</span> <span class="free">c</span> <span class="main">⟷</span> <span class="free">b</span> <span class="keyword1">dvd</span> <span class="free">c</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> mult_unit_dvd_iff <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">b</span></span> <span class="quoted"><span class="free">c</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>

<span class="keyword1" id="Missing_Unsorted-irreducibleD'"><span class="command">lemma</span></span> irreducibleD'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"irreducible <span class="free">a</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="keyword1">dvd</span> <span class="free">a</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="keyword1">dvd</span> <span class="free">b</span> <span class="main">∨</span> <span class="free">b</span> <span class="keyword1">dvd</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> <span class="free">b</span> <span class="main">*</span> <span class="skolem">c</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">elim</span> dvdE<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> irreducibleD<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> this<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="keyword1">dvd</span> <span class="main">1</span> <span class="main">∨</span> <span class="skolem">c</span> <span class="keyword1">dvd</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> c<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>



<span class="keyword1"><span class="command">context</span></span> idom
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Following lemmas are adapted and generalized so that they don't use "algebraic" classes.
›</span></span>

<span class="keyword1" id="Missing_Unsorted-dvd_times_left_cancel_iff"><span class="command">lemma</span></span> dvd_times_left_cancel_iff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">*</span> <span class="free">b</span> <span class="keyword1">dvd</span> <span class="free">a</span> <span class="main">*</span> <span class="free">c</span> <span class="main">⟷</span> <span class="free">b</span> <span class="keyword1">dvd</span> <span class="free">c</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span> <span class="main">⟷</span> <span class="var">?rhs</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?lhs</span></span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">d</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">*</span> <span class="free">c</span> <span class="main">=</span> <span class="free">a</span> <span class="main">*</span> <span class="free">b</span> <span class="main">*</span> <span class="skolem">d</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">=</span> <span class="free">b</span> <span class="main">*</span> <span class="skolem">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?rhs</span></span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?rhs</span></span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">d</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">=</span> <span class="free">b</span> <span class="main">*</span> <span class="skolem">d</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">*</span> <span class="free">c</span> <span class="main">=</span> <span class="free">a</span> <span class="main">*</span> <span class="free">b</span> <span class="main">*</span> <span class="skolem">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?lhs</span></span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Missing_Unsorted-dvd_times_right_cancel_iff"><span class="command">lemma</span></span> dvd_times_right_cancel_iff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">*</span> <span class="free">a</span> <span class="keyword1">dvd</span> <span class="free">c</span> <span class="main">*</span> <span class="free">a</span> <span class="main">⟷</span> <span class="free">b</span> <span class="keyword1">dvd</span> <span class="free">c</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> dvd_times_left_cancel_iff <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">b</span></span> <span class="quoted"><span class="free">c</span></span><span class="main">]</span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>


<span class="keyword1" id="Missing_Unsorted-irreducibleI'"><span class="command">lemma</span></span> irreducibleI'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">a</span> <span class="keyword1">dvd</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">b</span><span class="main">.</span> <span class="bound">b</span> <span class="keyword1">dvd</span> <span class="free">a</span> <span class="main">⟹</span> <span class="free">a</span> <span class="keyword1">dvd</span> <span class="bound">b</span> <span class="main">∨</span> <span class="bound">b</span> <span class="keyword1">dvd</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"irreducible <span class="free">a</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> irreducibleI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">b</span> <span class="skolem">c</span> <span class="keyword3"><span class="command">assume</span></span> a_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> <span class="skolem">b</span> <span class="main">*</span> <span class="skolem">c</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="keyword1">dvd</span> <span class="skolem">b</span> <span class="main">∨</span> <span class="skolem">b</span> <span class="keyword1">dvd</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> assms<span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="keyword1">dvd</span> <span class="main">1</span> <span class="main">∨</span> <span class="skolem">c</span> <span class="keyword1">dvd</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="keyword1">dvd</span> <span class="skolem">b</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">*</span> <span class="skolem">c</span> <span class="keyword1">dvd</span> <span class="skolem">b</span> <span class="main">*</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a_eq<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> a_eq <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> dvd_times_left_cancel_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>

<span class="keyword1" id="Missing_Unsorted-irreducible_altdef"><span class="command">lemma</span></span> irreducible_altdef<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"irreducible <span class="free">x</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">¬</span> <span class="free">x</span> <span class="keyword1">dvd</span> <span class="main">1</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">b</span><span class="main">.</span> <span class="bound">b</span> <span class="keyword1">dvd</span> <span class="free">x</span> <span class="main">⟶</span> <span class="free">x</span> <span class="keyword1">dvd</span> <span class="bound">b</span> <span class="main">∨</span> <span class="bound">b</span> <span class="keyword1">dvd</span> <span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> irreducibleI'<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span><span class="main">]</span> irreducibleD'<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span><span class="main">]</span> irreducible_not_unit<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Missing_Unsorted-dvd_mult_unit_iff"><span class="command">lemma</span></span> dvd_mult_unit_iff<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="keyword1">dvd</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="keyword1">dvd</span> <span class="free">c</span> <span class="main">*</span> <span class="free">b</span> <span class="main">⟷</span> <span class="free">a</span> <span class="keyword1">dvd</span> <span class="free">c</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> b <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">b'</span></span> <span class="keyword2"><span class="keyword">where</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">*</span> <span class="skolem">b'</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">elim</span> dvdE<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> b0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> 1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> <span class="main">(</span><span class="free">a</span> <span class="main">*</span> <span class="skolem">b'</span><span class="main">)</span> <span class="main">*</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="keyword1">dvd</span> <span class="free">c</span> <span class="main">*</span> <span class="free">b</span> <span class="main">⟷</span> <span class="free">a</span> <span class="main">*</span> <span class="skolem">b'</span> <span class="keyword1">dvd</span> <span class="free">c</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> b0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> dvd_mult_left<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Missing_Unsorted-dvd_mult_unit_iff'"><span class="command">lemma</span></span> dvd_mult_unit_iff'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="keyword1">dvd</span> <span class="main">1</span> <span class="main">⟹</span> <span class="free">a</span> <span class="keyword1">dvd</span> <span class="free">b</span> <span class="main">*</span> <span class="free">c</span> <span class="main">⟷</span> <span class="free">a</span> <span class="keyword1">dvd</span> <span class="free">c</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> dvd_mult_unit_iff <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">b</span></span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">c</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>

<span class="keyword1" id="Missing_Unsorted-irreducible_mult_unit_left"><span class="command">lemma</span></span> irreducible_mult_unit_left<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="keyword1">dvd</span> <span class="main">1</span> <span class="main">⟹</span> irreducible <span class="main">(</span><span class="free">a</span> <span class="main">*</span> <span class="free">p</span><span class="main">)</span> <span class="main">⟷</span> irreducible <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> irreducible_altdef mult.commute<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">a</span></span><span class="main"><span class="main">]</span></span> dvd_mult_unit_iff<span class="main">)</span>

<span class="keyword1" id="Missing_Unsorted-irreducible_mult_unit_right"><span class="command">lemma</span></span> irreducible_mult_unit_right<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="keyword1">dvd</span> <span class="main">1</span> <span class="main">⟹</span> irreducible <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">a</span><span class="main">)</span> <span class="main">⟷</span> irreducible <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> irreducible_altdef mult.commute<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">a</span></span><span class="main"><span class="main">]</span></span> dvd_mult_unit_iff<span class="main">)</span>

<span class="keyword1" id="Missing_Unsorted-prime_elem_imp_irreducible"><span class="command">lemma</span></span> prime_elem_imp_irreducible<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"prime_elem <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"irreducible <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> irreducibleI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">b</span>
  <span class="keyword3"><span class="command">assume</span></span> p_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword1"><span class="command">have</span></span> nz<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> p_eq <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="keyword1">dvd</span> <span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹prime_elem <span class="free">p</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="keyword1">dvd</span> <span class="skolem">a</span> <span class="main">∨</span> <span class="free">p</span> <span class="keyword1">dvd</span> <span class="skolem">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> prime_elem_dvd_multD<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">=</span> <span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span> <span class="keyword1">dvd</span> <span class="main">1</span> <span class="main">*</span> <span class="skolem">b</span> <span class="main">∨</span> <span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span> <span class="keyword1">dvd</span> <span class="skolem">a</span> <span class="main">*</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="keyword1">dvd</span> <span class="main">1</span> <span class="main">∨</span> <span class="skolem">b</span> <span class="keyword1">dvd</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> dvd_times_left_cancel_iff<span class="main"><span class="main">[</span></span><span class="operator">OF</span> nz<span class="main"><span class="main"><span class="main">(</span></span></span>1<span class="main"><span class="main"><span class="main">)</span></span></span><span class="main"><span class="main">]</span></span> dvd_times_right_cancel_iff<span class="main"><span class="main">[</span></span><span class="operator">OF</span> nz<span class="main"><span class="main"><span class="main">(</span></span></span>2<span class="main"><span class="main"><span class="main">)</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">insert</span> assms<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prime_elem_def<span class="main">)</span>

<span class="keyword1" id="Missing_Unsorted-unit_imp_dvd"><span class="command">lemma</span></span> unit_imp_dvd <span class="main">[</span><span class="operator">dest</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="keyword1">dvd</span> <span class="main">1</span> <span class="main">⟹</span> <span class="free">b</span> <span class="keyword1">dvd</span> <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> dvd_trans <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="main"><span class="quoted"><span class="main"><span class="quoted"><span class="main">1</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1" id="Missing_Unsorted-unit_mult_left_cancel"><span class="command">lemma</span></span> unit_mult_left_cancel<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="keyword1">dvd</span> <span class="main">1</span> <span class="main">⟹</span> <span class="free">a</span> <span class="main">*</span> <span class="free">b</span> <span class="main">=</span> <span class="free">a</span> <span class="main">*</span> <span class="free">c</span> <span class="main">⟷</span> <span class="free">b</span> <span class="main">=</span> <span class="free">c</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> mult_cancel_left <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">b</span></span> <span class="quoted"><span class="free">c</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Missing_Unsorted-unit_mult_right_cancel"><span class="command">lemma</span></span> unit_mult_right_cancel<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="keyword1">dvd</span> <span class="main">1</span> <span class="main">⟹</span> <span class="free">b</span> <span class="main">*</span> <span class="free">a</span> <span class="main">=</span> <span class="free">c</span> <span class="main">*</span> <span class="free">a</span> <span class="main">⟷</span> <span class="free">b</span> <span class="main">=</span> <span class="free">c</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> unit_mult_left_cancel <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">b</span></span> <span class="quoted"><span class="free">c</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹New parts from here›</span></span>

<span class="keyword1" id="Missing_Unsorted-irreducible_multD"><span class="command">lemma</span></span> irreducible_multD<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> l<span class="main">:</span> <span class="quoted"><span class="quoted">"irreducible <span class="main">(</span><span class="free">a</span><span class="main">*</span><span class="free">b</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="keyword1">dvd</span> <span class="main">1</span> <span class="main">∧</span> irreducible <span class="free">b</span> <span class="main">∨</span> <span class="free">b</span> <span class="keyword1">dvd</span> <span class="main">1</span> <span class="main">∧</span> irreducible <span class="free">a</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> l <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="keyword1">dvd</span> <span class="main">1</span> <span class="main">∨</span> <span class="free">b</span> <span class="keyword1">dvd</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> irreducibleD <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">elim</span> disjE<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="keyword1">dvd</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> l <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"irreducible <span class="free">b</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> irreducible_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> is_unit_mult_iff mult.left_commute mult_not_zero<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> a <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="keyword1">dvd</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> l <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"irreducible <span class="free">a</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> irreducible_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> is_unit_mult_iff mult_not_zero semiring_normalization_rules<span class="main"><span class="main">(</span></span>16<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> a <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> field<span class="main">)</span> irreducible_field<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"irreducible <span class="free">x</span> <span class="main">⟷</span> False"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> dvd_field_iff irreducible_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> idom<span class="main">)</span> irreducible_mult<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"irreducible <span class="main">(</span><span class="free">a</span><span class="main">*</span><span class="free">b</span><span class="main">)</span> <span class="main">⟷</span> <span class="free">a</span> <span class="keyword1">dvd</span> <span class="main">1</span> <span class="main">∧</span> irreducible <span class="free">b</span> <span class="main">∨</span> <span class="free">b</span> <span class="keyword1">dvd</span> <span class="main">1</span> <span class="main">∧</span> irreducible <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> irreducible_multD <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> irreducible_mult_unit_left irreducible_mult_unit_right<span class="main">)</span>


<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Missing_Polynomial">
<div class="head">
<h1>Theory Missing_Polynomial</h1>
</div>
<pre class="source"><span class="comment1">(*  
    Author:      René Thiemann 
                 Akihisa Yamada
                 Jose Divason
    License:     BSD
*)</span>
<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Missing Polynomial›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The theory contains some basic results on polynomials which have not been detected in
  the distribution, especially on linear factors and degrees.›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Missing_Polynomial
<span class="keyword2"><span class="keyword">imports</span></span> 
  <span class="quoted">"<a href="https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL-Computational_Algebra/Polynomial_Factorial.html">HOL-Computational_Algebra.Polynomial_Factorial</a>"</span>
  <a href="#Missing_Unsorted">Missing_Unsorted</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Basic Properties›</span></span>

<span class="keyword1" id="Missing_Polynomial-degree_0_id"><span class="command">lemma</span></span> degree_0_id<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">[:</span> coeff <span class="free">p</span> <span class="main">0</span> <span class="main">:]</span> <span class="main">=</span> <span class="free">p</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">x</span><span class="main">.</span> <span class="main">0</span> <span class="main">≠</span> Suc <span class="bound">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> coeff_pCons_0 degree_pCons_eq_if pCons_cases<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Missing_Polynomial-degree0_coeffs"><span class="command">lemma</span></span> degree0_coeffs<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟹</span>
  <span class="main">∃</span> <span class="bound">a</span><span class="main">.</span> <span class="free">p</span> <span class="main">=</span> <span class="main">[:</span> <span class="bound">a</span> <span class="main">:]</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> degree_pCons_eq_if old.nat.distinct<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> pCons_cases<span class="main">)</span>

<span class="keyword1" id="Missing_Polynomial-degree1_coeffs"><span class="command">lemma</span></span> degree1_coeffs<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span> <span class="main">=</span> <span class="main">1</span> <span class="main">⟹</span>
  <span class="main">∃</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="free">p</span> <span class="main">=</span> <span class="main">[:</span> <span class="bound">b</span><span class="main">,</span> <span class="bound">a</span> <span class="main">:]</span> <span class="main">∧</span> <span class="bound">a</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> One_nat_def degree_pCons_eq_if nat.inject old.nat.distinct<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> pCons_0_0 pCons_cases<span class="main">)</span>

<span class="keyword1" id="Missing_Polynomial-degree2_coeffs"><span class="command">lemma</span></span> degree2_coeffs<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">⟹</span>
  <span class="main">∃</span> <span class="bound">a</span> <span class="bound">b</span> <span class="bound">c</span><span class="main">.</span> <span class="free">p</span> <span class="main">=</span> <span class="main">[:</span> <span class="bound">c</span><span class="main">,</span> <span class="bound">b</span><span class="main">,</span> <span class="bound">a</span> <span class="main">:]</span> <span class="main">∧</span> <span class="bound">a</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc_1 Suc_neq_Zero degree1_coeffs degree_pCons_eq_if nat.inject pCons_cases<span class="main">)</span>

<span class="keyword1" id="Missing_Polynomial-poly_zero"><span class="command">lemma</span></span> poly_zero<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> comm_ring_1 poly"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> degree <span class="free">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> degp<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="free">x</span> <span class="main">=</span> coeff <span class="free">p</span> <span class="main">(</span>degree <span class="free">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">subst</span> degree_0_id<span class="main"><span class="main">[</span></span><span class="operator">OF</span> degp<span class="main"><span class="main">,</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"coeff <span class="free">p</span> <span class="main">(</span>degree <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> x <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Missing_Polynomial-coeff_monom_Suc"><span class="command">lemma</span></span> coeff_monom_Suc<span class="main">:</span> <span class="quoted"><span class="quoted">"coeff <span class="main">(</span>monom <span class="free">a</span> <span class="main">(</span>Suc <span class="free">d</span><span class="main">)</span> <span class="main">*</span> <span class="free">p</span><span class="main">)</span> <span class="main">(</span>Suc <span class="free">i</span><span class="main">)</span> <span class="main">=</span> coeff <span class="main">(</span>monom <span class="free">a</span> <span class="free">d</span> <span class="main">*</span> <span class="free">p</span><span class="main">)</span> <span class="free">i</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> monom_Suc<span class="main">)</span>

<span class="keyword1" id="Missing_Polynomial-coeff_sum_monom"><span class="command">lemma</span></span> coeff_sum_monom<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≤</span> <span class="free">d</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"coeff <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">≤</span><span class="free">d</span><span class="main">.</span> monom <span class="main">(</span><span class="free">f</span> <span class="bound">i</span><span class="main">)</span> <span class="bound">i</span><span class="main">)</span> <span class="free">n</span> <span class="main">=</span> <span class="free">f</span> <span class="free">n</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">=</span> <span class="main">_</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">≤</span><span class="free">d</span><span class="main">.</span> coeff <span class="main">(</span>monom <span class="main">(</span><span class="free">f</span> <span class="bound">i</span><span class="main">)</span> <span class="bound">i</span><span class="main">)</span> <span class="free">n</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> sum <span class="var">?cmf</span> <span class="main">_</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> coeff_sum<span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{..</span><span class="free">d</span><span class="main">}</span> <span class="main">=</span> insert <span class="free">n</span> <span class="main">(</span><span class="main">{..</span><span class="free">d</span><span class="main">}</span><span class="main">-</span><span class="main">{</span><span class="free">n</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> n <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"sum <span class="var">?cmf</span> <span class="main">{..</span><span class="free">d</span><span class="main">}</span> <span class="main">=</span> sum <span class="var">?cmf</span> <span class="main">...</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> sum <span class="var">?cmf</span> <span class="main">(</span><span class="main">{..</span><span class="free">d</span><span class="main">}</span><span class="main">-</span><span class="main">{</span><span class="free">n</span><span class="main">}</span><span class="main">)</span> <span class="main">+</span> <span class="var">?cmf</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> sum.insert<span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum <span class="var">?cmf</span> <span class="main">(</span><span class="main">{..</span><span class="free">d</span><span class="main">}</span><span class="main">-</span><span class="main">{</span><span class="free">n</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> sum.neutral<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Missing_Polynomial-linear_poly_root"><span class="command">lemma</span></span> linear_poly_root<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> comm_ring_1<span class="main">)</span> <span class="main">∈</span> set <span class="free">as</span> <span class="main">⟹</span> poly <span class="main">(</span><span class="main">∏</span> <span class="bound">a</span> <span class="main">←</span> <span class="free">as</span><span class="main">.</span> <span class="main">[:</span> <span class="main">-</span> <span class="bound">a</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span> <span class="free">a</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">as</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">b</span> <span class="skolem">as</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> <span class="skolem">b</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">with</span></span> Cons <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> set <span class="skolem">as</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> Cons<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Missing_Polynomial-degree_lcoeff_sum"><span class="command">lemma</span></span> degree_lcoeff_sum<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> deg<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span><span class="free">f</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> fin<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">∈</span> <span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> degle<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">p</span> <span class="main">.</span> <span class="bound">p</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">-</span> <span class="main">{</span><span class="free">q</span><span class="main">}</span> <span class="main">⟹</span> degree <span class="main">(</span><span class="free">f</span> <span class="bound">p</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> cong<span class="main">:</span> <span class="quoted"><span class="quoted">"coeff <span class="main">(</span><span class="free">f</span> <span class="free">q</span><span class="main">)</span> <span class="free">n</span> <span class="main">=</span> <span class="free">c</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span>sum <span class="free">f</span> <span class="free">S</span><span class="main">)</span> <span class="main">=</span> <span class="free">n</span> <span class="main">∧</span> coeff <span class="main">(</span>sum <span class="free">f</span> <span class="free">S</span><span class="main">)</span> <span class="free">n</span> <span class="main">=</span> <span class="free">c</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">=</span> <span class="main">{</span><span class="free">q</span><span class="main">}</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> deg cong <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">with</span></span> q <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">-</span> <span class="main">{</span><span class="free">q</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> degle<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span>sum <span class="free">f</span> <span class="free">S</span><span class="main">)</span> <span class="main">=</span> degree <span class="main">(</span><span class="free">f</span> <span class="free">q</span> <span class="main">+</span> sum <span class="free">f</span> <span class="main">(</span><span class="free">S</span> <span class="main">-</span> <span class="main">{</span><span class="free">q</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> sum.remove<span class="main">[</span><span class="operator">OF</span> fin q<span class="main">]</span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> degree <span class="main">(</span><span class="free">f</span> <span class="free">q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> degree_add_eq_left<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span>sum <span class="free">f</span> <span class="main">(</span><span class="free">S</span> <span class="main">-</span> <span class="main">{</span><span class="free">q</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="free">n</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> degree_sum_le<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">-</span> <span class="main">{</span><span class="free">q</span><span class="main">}</span> <span class="main">⟹</span> degree <span class="main">(</span><span class="free">f</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">≤</span> <span class="free">n</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> degle<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">p</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">insert</span> fin<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> n <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span>sum <span class="free">f</span> <span class="main">(</span><span class="free">S</span> <span class="main">-</span> <span class="main">{</span><span class="free">q</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> degree <span class="main">(</span><span class="free">f</span> <span class="free">q</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> deg <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> deg<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> cong<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="free">S</span> <span class="main">-</span> <span class="main">{</span><span class="free">q</span><span class="main">}</span><span class="main">.</span> coeff <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span>degree <span class="main">(</span><span class="free">f</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.neutral<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> ballI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> coeff_eq_0<span class="main"><span class="main">[</span></span><span class="operator">OF</span> degle<span class="main"><span class="main">[</span></span><span class="operator">folded</span> deg<span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"coeff <span class="main">(</span>sum <span class="free">f</span> <span class="free">S</span><span class="main">)</span> <span class="main">(</span>degree <span class="main">(</span><span class="free">f</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> coeff <span class="main">(</span><span class="free">f</span> <span class="free">q</span><span class="main">)</span> <span class="main">(</span>degree <span class="main">(</span><span class="free">f</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> coeff_sum
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> sum.remove<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ q<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> id<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> fin<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Missing_Polynomial-degree_sum_list_le"><span class="command">lemma</span></span> degree_sum_list_le<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span> <span class="bound">p</span> <span class="main">.</span> <span class="bound">p</span> <span class="main">∈</span> set <span class="free">ps</span> <span class="main">⟹</span> degree <span class="bound">p</span> <span class="main">≤</span> <span class="free">n</span><span class="main">)</span>
  <span class="main">⟹</span> degree <span class="main">(</span>sum_list <span class="free">ps</span><span class="main">)</span> <span class="main">≤</span> <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">ps</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">p</span> <span class="skolem">ps</span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span>sum_list <span class="skolem">ps</span><span class="main">)</span> <span class="main">≤</span> <span class="free">n</span>"</span></span> <span class="quoted"><span class="quoted">"degree <span class="skolem">p</span> <span class="main">≤</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> sum_list.Cons <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> degree_add_le<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Missing_Polynomial-degree_prod_list_le"><span class="command">lemma</span></span> degree_prod_list_le<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span>prod_list <span class="free">ps</span><span class="main">)</span> <span class="main">≤</span> sum_list <span class="main">(</span>map degree <span class="free">ps</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">ps</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">p</span> <span class="skolem">ps</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> prod_list.Cons
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> order.trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> degree_mult_le<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> Cons<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Missing_Polynomial-smult_sum"><span class="command">lemma</span></span> smult_sum<span class="main">:</span> <span class="quoted"><span class="quoted">"smult <span class="main">(</span><span class="main">∑</span><span class="bound">i</span> <span class="main">∈</span> <span class="free">S</span><span class="main">.</span> <span class="free">f</span> <span class="bound">i</span><span class="main">)</span> <span class="free">p</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span> <span class="main">∈</span> <span class="free">S</span><span class="main">.</span> smult <span class="main">(</span><span class="free">f</span> <span class="bound">i</span><span class="main">)</span> <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">S</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> infinite_finite_induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> smult_add_left<span class="main">)</span>


<span class="keyword1" id="Missing_Polynomial-range_coeff"><span class="command">lemma</span></span> range_coeff<span class="main">:</span> <span class="quoted"><span class="quoted">"range <span class="main">(</span>coeff <span class="free">p</span><span class="main">)</span> <span class="main">=</span> insert <span class="main">0</span> <span class="main">(</span>set <span class="main">(</span>coeffs <span class="free">p</span><span class="main">)</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> nth_default_coeffs_eq range_nth_default<span class="main">)</span>

<span class="keyword1" id="Missing_Polynomial-smult_power"><span class="command">lemma</span></span> smult_power<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>smult <span class="free">a</span> <span class="free">p</span><span class="main">)</span> <span class="main">^</span> <span class="free">n</span> <span class="main">=</span> smult <span class="main">(</span><span class="free">a</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span> <span class="main">(</span><span class="free">p</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>

<span class="keyword1" id="Missing_Polynomial-poly_sum_list"><span class="command">lemma</span></span> poly_sum_list<span class="main">:</span> <span class="quoted"><span class="quoted">"poly <span class="main">(</span>sum_list <span class="free">ps</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> sum_list <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span> <span class="bound">p</span><span class="main">.</span> poly <span class="bound">p</span> <span class="free">x</span><span class="main">)</span> <span class="free">ps</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">ps</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="Missing_Polynomial-poly_prod_list"><span class="command">lemma</span></span> poly_prod_list<span class="main">:</span> <span class="quoted"><span class="quoted">"poly <span class="main">(</span>prod_list <span class="free">ps</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> prod_list <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span> <span class="bound">p</span><span class="main">.</span> poly <span class="bound">p</span> <span class="free">x</span><span class="main">)</span> <span class="free">ps</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">ps</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="Missing_Polynomial-sum_list_neutral"><span class="command">lemma</span></span> sum_list_neutral<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> set <span class="free">xs</span> <span class="main">⟹</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">⟹</span> sum_list <span class="free">xs</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="Missing_Polynomial-prod_list_neutral"><span class="command">lemma</span></span> prod_list_neutral<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> set <span class="free">xs</span> <span class="main">⟹</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">1</span><span class="main">)</span> <span class="main">⟹</span> prod_list <span class="free">xs</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> comm_monoid_mult<span class="main">)</span> prod_list_map_remove1<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> set <span class="free">xs</span> <span class="main">⟹</span> prod_list <span class="main">(</span>map <span class="free">f</span> <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="free">x</span> <span class="main">*</span> prod_list <span class="main">(</span>map <span class="free">f</span> <span class="main">(</span>remove1 <span class="free">x</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>

<span class="keyword1" id="Missing_Polynomial-poly_as_sum"><span class="command">lemma</span></span> poly_as_sum<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>comm_semiring_1 poly"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="free">x</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">≤</span>degree <span class="free">p</span><span class="main">.</span> <span class="free">x</span> <span class="main">^</span> <span class="bound">i</span> <span class="main">*</span> coeff <span class="free">p</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> poly_altdef <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>

<span class="keyword1" id="Missing_Polynomial-poly_prod_0"><span class="command">lemma</span></span> poly_prod_0<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">ps</span> <span class="main">⟹</span> poly <span class="main">(</span>prod <span class="free">f</span> <span class="free">ps</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> <span class="main">(</span><span class="main">0</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> field<span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">p</span> <span class="main">∈</span> <span class="free">ps</span><span class="main">.</span> poly <span class="main">(</span><span class="free">f</span> <span class="bound">p</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">ps</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> finite_induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="Missing_Polynomial-coeff_monom_mult"><span class="command">lemma</span></span> coeff_monom_mult<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"coeff <span class="main">(</span>monom <span class="free">a</span> <span class="free">d</span> <span class="main">*</span> <span class="free">p</span><span class="main">)</span> <span class="free">i</span> <span class="main">=</span>
    <span class="main">(</span><span class="keyword1">if</span> <span class="free">d</span> <span class="main">≤</span> <span class="free">i</span> <span class="keyword1">then</span> <span class="free">a</span> <span class="main">*</span> coeff <span class="free">p</span> <span class="main">(</span><span class="free">i</span><span class="main">-</span><span class="free">d</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">=</span> <span class="var">?r</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">≤</span> <span class="free">i</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> False <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> coeff_mult <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span> <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">j</span><span class="main">.</span> coeff <span class="main">(</span>monom <span class="free">a</span> <span class="free">d</span><span class="main">)</span> <span class="bound">j</span> <span class="main">*</span> coeff <span class="free">p</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="bound">j</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">j</span><span class="main">.</span> <span class="bound">j</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="free">i</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="free">d</span><span class="main">}</span> <span class="main">⟹</span> <span class="var">?f</span> <span class="bound">j</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="free">i</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="free">d</span><span class="main">}</span><span class="main">.</span> <span class="var">?f</span> <span class="bound">j</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">+</span> <span class="var">?f</span> <span class="free">d</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span> <span class="main">∈</span> insert <span class="free">d</span> <span class="main">(</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="free">i</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="free">d</span><span class="main">}</span><span class="main">)</span><span class="main">.</span> <span class="var">?f</span> <span class="bound">j</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">subst</span> sum.insert<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="free">i</span><span class="main">}</span><span class="main">.</span> <span class="var">?f</span> <span class="bound">j</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> insert_Diff<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> True<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">≤</span><span class="free">i</span><span class="main">.</span> <span class="var">?f</span> <span class="bound">j</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.cong<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="var">?l</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> coeff_mult <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Missing_Polynomial-poly_eqI2"><span class="command">lemma</span></span> poly_eqI2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span> <span class="main">=</span> degree <span class="free">q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">≤</span> degree <span class="free">p</span> <span class="main">⟹</span> coeff <span class="free">p</span> <span class="bound">i</span> <span class="main">=</span> coeff <span class="free">q</span> <span class="bound">i</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> poly_eqI<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms le_degree<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹A nice extension rule for polynomials.›</span></span>
<span class="keyword1" id="Missing_Polynomial-poly_ext"><span class="command">lemma</span></span> poly_ext<span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="free">q</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>ring_char_0<span class="main">,</span> idom<span class="main">}</span> poly"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> poly <span class="free">q</span> <span class="bound">x</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> poly_eq_poly_eq_iff<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Copied from non-negative variants.›</span></span>
<span class="keyword1" id="Missing_Polynomial-coeff_linear_power_neg"><span class="command">lemma</span></span> coeff_linear_power_neg<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">a</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>comm_ring_1"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"coeff <span class="main">(</span><span class="main">[:</span><span class="free">a</span><span class="main">,</span> <span class="main">-</span><span class="main">1</span><span class="main">:]</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span> <span class="free">n</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> coeff_eq_0<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> le_less_trans degree_power_le<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Missing_Polynomial-degree_linear_power_neg"><span class="command">lemma</span></span> degree_linear_power_neg<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">a</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>idom<span class="main">,</span>comm_ring_1<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span><span class="main">[:</span><span class="free">a</span><span class="main">,</span> <span class="main">-</span><span class="main">1</span><span class="main">:]</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> order_antisym<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ord_le_eq_trans <span class="main"><span class="main">[</span></span><span class="operator">OF</span> degree_power_le<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> le_degree<span class="main">)</span>
<span class="keyword1"><span class="command">unfolding</span></span> coeff_linear_power_neg
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Polynomial Composition›</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span> <span class="main">=</span> pcompose_pCons

<span class="keyword1" id="Missing_Polynomial-pcompose_eq_0"><span class="command">lemma</span></span> pcompose_eq_0<span class="main">:</span> <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">q</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> idom poly"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> q<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="free">q</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">q</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="free">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>pCons <span class="skolem">a</span> <span class="skolem">p</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>pCons <span class="skolem">a</span> <span class="skolem">p</span><span class="main">)</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">q</span> <span class="main">=</span> <span class="main">[:</span><span class="skolem">a</span><span class="main">:]</span> <span class="main">+</span> <span class="free">q</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">p</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">q</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> id <span class="keyword1"><span class="command">unfolding</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">with</span></span> pCons<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">q</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> degree_mult_eq<span class="main">[</span><span class="operator">OF</span> _ this<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">q</span></span><span class="main">]</span> q <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span><span class="free">q</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">p</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">hence</span></span> deg<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span><span class="main">[:</span><span class="skolem">a</span><span class="main">:]</span> <span class="main">+</span> <span class="free">q</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">p</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> degree_add_eq_right<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> id <span class="keyword1"><span class="command">using</span></span> False deg <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">declare</span></span> degree_pcompose<span class="main">[</span><span class="operator">simp</span><span class="main">]</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Monic Polynomials›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">monic</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">monic</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">≡</span> coeff <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">(</span>degree <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>

<span class="keyword1" id="Missing_Polynomial-unit_factor_field"><span class="command">lemma</span></span> unit_factor_field <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"unit_factor <span class="main">(</span><span class="free">x</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>field<span class="main">,</span>normalization_semidom<span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"is_unit <span class="free">x</span>"</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> is_unit_unit_factor dvd_field_iff<span class="main">)</span>

<span class="keyword1" id="Missing_Polynomial-poly_gcd_monic"><span class="command">lemma</span></span> poly_gcd_monic<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>field<span class="main">,</span>factorial_ring_gcd<span class="main">,</span>semiring_gcd_mult_normalize<span class="main">}</span> poly"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∨</span> <span class="free">q</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"monic <span class="main">(</span>gcd <span class="free">p</span> <span class="free">q</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">=</span> unit_factor <span class="main">(</span>gcd <span class="free">p</span> <span class="free">q</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> unit_factor_gcd<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">[:</span>lead_coeff <span class="main">(</span>gcd <span class="free">p</span> <span class="free">q</span><span class="main">)</span><span class="main">:]</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> unit_factor_poly_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> monom_0<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> coeff_pCons_0 degree_1 lead_coeff_1<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Missing_Polynomial-normalize_monic"><span class="command">lemma</span></span> normalize_monic<span class="main">:</span> <span class="quoted"><span class="quoted">"monic <span class="free">p</span> <span class="main">⟹</span> normalize <span class="free">p</span> <span class="main">=</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> normalize_poly_eq_map_poly is_unit_unit_factor<span class="main">)</span>

<span class="keyword1" id="Missing_Polynomial-lcoeff_monic_mult"><span class="command">lemma</span></span> lcoeff_monic_mult<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> monic<span class="main">:</span> <span class="quoted"><span class="quoted">"monic <span class="main">(</span><span class="free">p</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> comm_semiring_1 poly<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"coeff <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span> <span class="main">(</span>degree <span class="free">p</span> <span class="main">+</span> degree <span class="free">q</span><span class="main">)</span> <span class="main">=</span> coeff <span class="free">q</span> <span class="main">(</span>degree <span class="free">q</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?pqi</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">i</span><span class="main">.</span> coeff <span class="free">p</span> <span class="bound">i</span> <span class="main">*</span> coeff <span class="free">q</span> <span class="main">(</span>degree <span class="free">p</span> <span class="main">+</span> degree <span class="free">q</span> <span class="main">-</span> <span class="bound">i</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coeff <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span> <span class="main">(</span>degree <span class="free">p</span> <span class="main">+</span> degree <span class="free">q</span><span class="main">)</span> <span class="main">=</span> 
    <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">≤</span>degree <span class="free">p</span> <span class="main">+</span> degree <span class="free">q</span><span class="main">.</span> <span class="var">?pqi</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> coeff_mult <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="var">?pqi</span> <span class="main">(</span>degree <span class="free">p</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span>sum <span class="var">?pqi</span> <span class="main">(</span><span class="main">{..</span> degree <span class="free">p</span> <span class="main">+</span> degree <span class="free">q</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span>degree <span class="free">p</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> sum.remove<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"degree <span class="free"><span class="free"><span class="free">p</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?pqi</span> <span class="main">(</span>degree <span class="free">p</span><span class="main">)</span> <span class="main">=</span> coeff <span class="free">q</span> <span class="main">(</span>degree <span class="free">q</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> monic <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>sum <span class="var">?pqi</span> <span class="main">(</span><span class="main">{..</span> degree <span class="free">p</span> <span class="main">+</span> degree <span class="free">q</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span>degree <span class="free">p</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sum.neutral<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> ballI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">d</span>
    <span class="keyword3"><span class="command">assume</span></span> d<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">∈</span> <span class="main">{..</span> degree <span class="free">p</span> <span class="main">+</span> degree <span class="free">q</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span>degree <span class="free">p</span><span class="main">}</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?pqi</span> <span class="skolem">d</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">&lt;</span> degree <span class="free">p</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span> <span class="main">+</span> degree <span class="free">q</span> <span class="main">-</span> <span class="skolem">d</span> <span class="main">&gt;</span> degree <span class="free">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"coeff <span class="free">q</span> <span class="main">(</span>degree <span class="free">p</span> <span class="main">+</span> degree <span class="free">q</span> <span class="main">-</span> <span class="skolem">d</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> coeff_eq_0<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">with</span></span> d <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">&gt;</span> degree <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"coeff <span class="free">p</span> <span class="skolem">d</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> coeff_eq_0<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Missing_Polynomial-degree_monic_mult"><span class="command">lemma</span></span> degree_monic_mult<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> monic<span class="main">:</span> <span class="quoted"><span class="quoted">"monic <span class="main">(</span><span class="free">p</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> comm_semiring_1 poly<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> degree <span class="free">p</span> <span class="main">+</span> degree <span class="free">q</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span> <span class="main">+</span> degree <span class="free">q</span> <span class="main">≥</span> degree <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> degree_mult_le<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span> <span class="main">+</span> degree <span class="free">q</span> <span class="main">≤</span> degree <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> q <span class="keyword1"><span class="command">have</span></span> cq<span class="main">:</span> <span class="quoted"><span class="quoted">"coeff <span class="free">q</span> <span class="main">(</span>degree <span class="free">q</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"coeff <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span> <span class="main">(</span>degree <span class="free">p</span> <span class="main">+</span> degree <span class="free">q</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> lcoeff_monic_mult<span class="main">[</span><span class="operator">OF</span> monic<span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span> <span class="main">≥</span> degree <span class="free">p</span> <span class="main">+</span> degree <span class="free">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> le_degree<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Missing_Polynomial-degree_prod_sum_monic"><span class="command">lemma</span></span> degree_prod_sum_monic<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span>
  S<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">S</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> nzd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∉</span> <span class="main">(</span>degree <span class="keyword1">o</span> <span class="free">f</span><span class="main">)</span> <span class="main">`</span> <span class="free">S</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> monic<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span> <span class="bound">a</span> <span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">⟹</span> monic <span class="main">(</span><span class="free">f</span> <span class="bound">a</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span>prod <span class="free">f</span> <span class="free">S</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>sum <span class="main">(</span>degree <span class="keyword1">o</span> <span class="free">f</span><span class="main">)</span> <span class="free">S</span><span class="main">)</span> <span class="main">∧</span> coeff <span class="main">(</span>prod <span class="free">f</span> <span class="free">S</span><span class="main">)</span> <span class="main">(</span>sum <span class="main">(</span>degree <span class="keyword1">o</span> <span class="free">f</span><span class="main">)</span> <span class="free">S</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> S nzd monic 
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span>prod <span class="free">f</span> <span class="free">S</span><span class="main">)</span> <span class="main">=</span> sum <span class="main">(</span>degree <span class="main">∘</span> <span class="free">f</span><span class="main">)</span> <span class="free">S</span> 
  <span class="main">∧</span> <span class="main">(</span><span class="free">S</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">⟶</span> degree <span class="main">(</span>prod <span class="free">f</span> <span class="free">S</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> prod <span class="free">f</span> <span class="free">S</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">∧</span> coeff <span class="main">(</span>prod <span class="free">f</span> <span class="free">S</span><span class="main">)</span> <span class="main">(</span>sum <span class="main">(</span>degree <span class="keyword1">o</span> <span class="free">f</span><span class="main">)</span> <span class="free">S</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">S</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> finite_induct<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>insert <span class="skolem">a</span> <span class="skolem">S</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> IH1<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span>prod <span class="free">f</span> <span class="skolem">S</span><span class="main">)</span> <span class="main">=</span> sum <span class="main">(</span>degree <span class="keyword1">o</span> <span class="free">f</span><span class="main">)</span> <span class="skolem">S</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> insert <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> IH2<span class="main">:</span> <span class="quoted"><span class="quoted">"coeff <span class="main">(</span>prod <span class="free">f</span> <span class="skolem">S</span><span class="main">)</span> <span class="main">(</span>degree <span class="main">(</span>prod <span class="free">f</span> <span class="skolem">S</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> insert <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span>prod <span class="free">f</span> <span class="main">(</span>insert <span class="skolem">a</span> <span class="skolem">S</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> sum <span class="main">(</span>degree <span class="main">∘</span> <span class="free">f</span><span class="main">)</span> <span class="main">(</span>insert <span class="skolem">a</span> <span class="skolem">S</span><span class="main">)</span>
      <span class="main">∧</span> coeff <span class="main">(</span>prod <span class="free">f</span> <span class="main">(</span>insert <span class="skolem">a</span> <span class="skolem">S</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>sum <span class="main">(</span>degree <span class="keyword1">o</span> <span class="free">f</span><span class="main">)</span> <span class="main">(</span>insert <span class="skolem">a</span> <span class="skolem">S</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span> <span class="main">=</span> <span class="main">{}</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">with</span></span> insert <span class="keyword1"><span class="command">have</span></span> nz<span class="main">:</span> <span class="quoted"><span class="quoted">"prod <span class="free">f</span> <span class="skolem">S</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> insert <span class="keyword1"><span class="command">have</span></span> monic<span class="main">:</span> <span class="quoted"><span class="quoted">"coeff <span class="main">(</span><span class="free">f</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">(</span>degree <span class="main">(</span><span class="free">f</span> <span class="skolem">a</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>degree <span class="main">∘</span> <span class="free">f</span><span class="main">)</span> <span class="skolem">a</span> <span class="main">=</span> degree <span class="main">(</span><span class="free">f</span> <span class="skolem">a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> prod.insert<span class="main">[</span><span class="operator">OF</span> insert<span class="main"><span class="main">(</span></span>1-2<span class="main"><span class="main">)</span></span><span class="main">]</span> sum.insert<span class="main">[</span><span class="operator">OF</span> insert<span class="main"><span class="main">(</span></span>1-2<span class="main"><span class="main">)</span></span><span class="main">]</span> id
        <span class="keyword1"><span class="command">unfolding</span></span> degree_monic_mult<span class="main">[</span><span class="operator">OF</span> monic nz<span class="main">]</span> 
        <span class="keyword1"><span class="command">unfolding</span></span> IH1<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
        <span class="keyword1"><span class="command">unfolding</span></span> lcoeff_monic_mult<span class="main">[</span><span class="operator">OF</span> monic<span class="main">]</span> IH2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">insert</span> insert<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> id <span class="keyword1"><span class="command">unfolding</span></span> sum.insert<span class="main">[</span><span class="operator">OF</span> insert<span class="main"><span class="main">(</span></span>1-2<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">using</span></span> insert <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span> 

<span class="keyword1" id="Missing_Polynomial-degree_prod_monic"><span class="command">lemma</span></span> degree_prod_monic<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">⟹</span> degree <span class="main">(</span><span class="free">f</span> <span class="bound">i</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> comm_semiring_1 poly<span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">⟹</span> coeff <span class="main">(</span><span class="free">f</span> <span class="bound">i</span><span class="main">)</span> <span class="main">1</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span>prod <span class="free">f</span> <span class="main">{</span><span class="main">0</span> <span class="main">..&lt;</span> <span class="free">n</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="free">n</span> <span class="main">∧</span> coeff <span class="main">(</span>prod <span class="free">f</span> <span class="main">{</span><span class="main">0</span> <span class="main">..&lt;</span> <span class="free">n</span><span class="main">}</span><span class="main">)</span> <span class="free">n</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> degree_prod_sum_monic<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">0</span> <span class="main">..&lt;</span> <span class="free">n</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="free">f</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Missing_Polynomial-degree_prod_sum_lt_n"><span class="command">lemma</span></span> degree_prod_sum_lt_n<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">⟹</span> degree <span class="main">(</span><span class="free">f</span> <span class="bound">i</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> comm_semiring_1 poly<span class="main">)</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> fi<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span><span class="free">f</span> <span class="free">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span>prod <span class="free">f</span> <span class="main">{</span><span class="main">0</span> <span class="main">..&lt;</span> <span class="free">n</span><span class="main">}</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span>prod <span class="free">f</span> <span class="main">{</span><span class="main">0</span> <span class="main">..&lt;</span> <span class="free">n</span><span class="main">}</span><span class="main">)</span> <span class="main">≤</span> sum <span class="main">(</span>degree <span class="keyword1">o</span> <span class="free">f</span><span class="main">)</span> <span class="main">{</span><span class="main">0</span> <span class="main">..&lt;</span> <span class="free">n</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> degree_prod_sum_le<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum <span class="main">(</span>degree <span class="keyword1">o</span> <span class="free">f</span><span class="main">)</span> <span class="main">{</span><span class="main">0</span> <span class="main">..&lt;</span> <span class="free">n</span><span class="main">}</span> <span class="main">=</span> <span class="main">(</span>degree <span class="keyword1">o</span> <span class="free">f</span><span class="main">)</span> <span class="free">i</span> <span class="main">+</span> sum <span class="main">(</span>degree <span class="keyword1">o</span> <span class="free">f</span><span class="main">)</span> <span class="main">(</span><span class="main">{</span><span class="main">0</span> <span class="main">..&lt;</span> <span class="free">n</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.remove<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> i<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>degree <span class="keyword1">o</span> <span class="free">f</span><span class="main">)</span> <span class="free">i</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> fi <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum <span class="main">(</span>degree <span class="keyword1">o</span> <span class="free">f</span><span class="main">)</span> <span class="main">(</span><span class="main">{</span><span class="main">0</span> <span class="main">..&lt;</span> <span class="free">n</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span><span class="main">)</span> <span class="main">≤</span> sum <span class="main">(</span><span class="main">λ</span> <span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span><span class="main">{</span><span class="main">0</span> <span class="main">..&lt;</span> <span class="free">n</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum_mono<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> assms<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">n</span> <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> i <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> i <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Missing_Polynomial-degree_linear_factors"><span class="command">lemma</span></span> degree_linear_factors<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span><span class="main">∏</span> <span class="bound">a</span> <span class="main">←</span> <span class="free">as</span><span class="main">.</span> <span class="main">[:</span> <span class="free">f</span> <span class="bound">a</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span> <span class="main">=</span> length <span class="free">as</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">as</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">b</span> <span class="skolem">as</span><span class="main">)</span> <span class="keyword1"><span class="command">note</span></span> IH <span class="main">=</span> this
  <span class="keyword1"><span class="command">have</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∏</span><span class="bound">a</span><span class="main">←</span><span class="skolem">b</span> <span class="main">#</span> <span class="skolem">as</span><span class="main">.</span> <span class="main">[:</span><span class="free">f</span> <span class="bound">a</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span> <span class="main">=</span> <span class="main">[:</span><span class="free">f</span> <span class="skolem">b</span><span class="main">,</span><span class="main">1</span> <span class="main">:]</span> <span class="main">*</span> <span class="main">(</span><span class="main">∏</span><span class="bound">a</span><span class="main">←</span><span class="skolem">as</span><span class="main">.</span> <span class="main">[:</span><span class="free">f</span> <span class="bound">a</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> id
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> degree_monic_mult<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> IH<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Missing_Polynomial-monic_mult"><span class="command">lemma</span></span> monic_mult<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="free">q</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> idom poly"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"monic <span class="free">p</span>"</span></span> <span class="quoted"><span class="quoted">"monic <span class="free">q</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"monic <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> nz<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> degree_mult_eq<span class="main">[</span><span class="operator">OF</span> nz<span class="main">]</span> coeff_mult_degree_sum
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Missing_Polynomial-monic_factor"><span class="command">lemma</span></span> monic_factor<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="free">q</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> idom poly"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"monic <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"monic <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"monic <span class="free">q</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> nz<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">[</span><span class="operator">unfolded</span> degree_mult_eq<span class="main"><span class="main"><span class="main">[</span></span></span><span class="operator"><span class="operator">OF</span></span> nz<span class="main"><span class="main"><span class="main">]</span></span></span> coeff_mult_degree_sum <span class="quoted"><span class="quoted"><span class="quoted">‹monic <span class="free"><span class="free">p</span></span>›</span></span></span><span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Missing_Polynomial-monic_prod"><span class="command">lemma</span></span> monic_prod<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span> <span class="main">::</span> idom poly"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">a</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> <span class="free">as</span> <span class="main">⟹</span> monic <span class="main">(</span><span class="free">f</span> <span class="bound">a</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"monic <span class="main">(</span>prod <span class="free">f</span> <span class="free">as</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">as</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> infinite_finite_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>insert <span class="skolem">a</span> <span class="skolem">as</span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"prod <span class="free">f</span> <span class="main">(</span>insert <span class="skolem">a</span> <span class="skolem">as</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="skolem">a</span> <span class="main">*</span> prod <span class="free">f</span> <span class="skolem">as</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"monic <span class="main">(</span><span class="free">f</span> <span class="skolem">a</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"monic <span class="main">(</span>prod <span class="free">f</span> <span class="skolem">as</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> id <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> monic_mult<span class="main"><span class="main">[</span></span><span class="operator">OF</span> *<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Missing_Polynomial-monic_prod_list"><span class="command">lemma</span></span> monic_prod_list<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">as</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> idom poly list"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">a</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> set <span class="free">as</span> <span class="main">⟹</span> monic <span class="bound">a</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"monic <span class="main">(</span>prod_list <span class="free">as</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">as</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> monic_mult<span class="main">)</span>

<span class="keyword1" id="Missing_Polynomial-monic_power"><span class="command">lemma</span></span> monic_power<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"monic <span class="main">(</span><span class="free">p</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> idom poly<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"monic <span class="main">(</span><span class="free">p</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> assms<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> monic_mult<span class="main">)</span>

<span class="keyword1" id="Missing_Polynomial-monic_prod_list_pow"><span class="command">lemma</span></span> monic_prod_list_pow<span class="main">:</span> <span class="quoted"><span class="quoted">"monic <span class="main">(</span><span class="main">∏</span><span class="main">(</span><span class="bound">x</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>idom<span class="main">,</span> <span class="bound">i</span><span class="main">)</span><span class="main">←</span><span class="free">xis</span><span class="main">.</span> <span class="main">[:</span><span class="main">-</span> <span class="bound">x</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">^</span> Suc <span class="bound">i</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> monic_prod_list<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">a</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> <span class="main">[:</span><span class="main">-</span><span class="skolem">x</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">^</span>Suc <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"monic <span class="skolem">a</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> a
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> monic_power<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Missing_Polynomial-monic_degree_0"><span class="command">lemma</span></span> monic_degree_0<span class="main">:</span> <span class="quoted"><span class="quoted">"monic <span class="free">p</span> <span class="main">⟹</span> <span class="main">(</span>degree <span class="free">p</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">p</span> <span class="main">=</span> <span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> le_degree poly_eq_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Roots›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The following proof structure is completely similar to the one
  of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> poly_roots_finite<span class="antiquote"><span class="antiquote">}</span></span></span></span>.›</span></span>

<span class="keyword1" id="Missing_Polynomial-poly_roots_degree"><span class="command">lemma</span></span> poly_roots_degree<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>idom poly"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> card <span class="main">{</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span> <span class="main">≤</span> degree <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="skolem">n</span> <span class="main"><span class="main">≡</span></span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span>"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>0 <span class="skolem">p</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> <span class="main">[:</span><span class="skolem">a</span><span class="main">:]</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">p</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span> <span class="skolem">p</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span><span class="main">.</span> poly <span class="skolem">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword">where</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"poly <span class="skolem">p</span> <span class="skolem">a</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">[:</span><span class="main">-</span><span class="skolem">a</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="keyword1">dvd</span> <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> poly_eq_0_iff_dvd<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> <span class="main">[:</span><span class="main">-</span><span class="skolem">a</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">*</span> <span class="skolem">k</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> k <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degree <span class="skolem">p</span> <span class="main">=</span> Suc <span class="main">(</span>degree <span class="skolem">k</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> degree_mult_eq <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> mult_pCons_left<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹Suc <span class="skolem">n</span> <span class="main">=</span> degree <span class="skolem">p</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> degree <span class="skolem">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> Suc.hyps<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> this <span class="quoted"><span class="quoted">‹<span class="skolem">k</span> <span class="main">≠</span> <span class="main">0</span>›</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">have</span></span> le<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="bound">x</span><span class="main">.</span> poly <span class="skolem">k</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span> <span class="main">≤</span> degree <span class="skolem">k</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="bound">x</span><span class="main">.</span> poly <span class="skolem">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span> <span class="main">=</span> card <span class="main">{</span><span class="bound">x</span><span class="main">.</span> poly <span class="main">(</span><span class="main">[:</span><span class="main">-</span><span class="skolem">a</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">*</span> <span class="skolem">k</span><span class="main">)</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> k <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> poly <span class="main">(</span><span class="main">[:</span><span class="main">-</span><span class="skolem">a</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">*</span> <span class="skolem">k</span><span class="main">)</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span> <span class="main">=</span> insert <span class="skolem">a</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> poly <span class="skolem">k</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">…</span> <span class="main">≤</span> Suc <span class="main">(</span>card <span class="main">{</span><span class="bound">x</span><span class="main">.</span> poly <span class="skolem">k</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> card_insert_if<span class="main">[</span><span class="operator">OF</span> poly_roots_finite<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">k</span> <span class="main">≠</span> <span class="main">0</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> Suc <span class="main">(</span>degree <span class="skolem">k</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> le <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹degree <span class="skolem">p</span> <span class="main">=</span> Suc <span class="main">(</span>degree <span class="skolem">k</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Missing_Polynomial-poly_root_factor"><span class="command">lemma</span></span> poly_root_factor<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>poly <span class="main">(</span><span class="main">[:</span> <span class="free">r</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span> <span class="main">(</span><span class="free">k</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> idom<span class="main">)</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">k</span> <span class="main">=</span> <span class="main">-</span><span class="free">r</span> <span class="main">∨</span> poly <span class="free">q</span> <span class="free">k</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="var"><span class="quoted"><span class="var">?one</span></span></span><span class="main">)</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span>poly <span class="main">(</span><span class="free">q</span> <span class="main">*</span> <span class="main">[:</span> <span class="free">r</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span> <span class="free">k</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">k</span> <span class="main">=</span> <span class="main">-</span><span class="free">r</span> <span class="main">∨</span> poly <span class="free">q</span> <span class="free">k</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="var"><span class="quoted"><span class="var">?two</span></span></span><span class="main">)</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span>poly <span class="main">[:</span> <span class="free">r</span><span class="main">,</span> <span class="main">1</span> <span class="main">:]</span> <span class="free">k</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">k</span> <span class="main">=</span> <span class="main">-</span><span class="free">r</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="var"><span class="quoted"><span class="var">?three</span></span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">+</span> <span class="free">k</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟹</span> <span class="free">k</span> <span class="main">=</span> <span class="main">-</span> <span class="free">r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> minus_unique<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?one</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> poly_mult <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?two</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> poly_mult <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?three</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Missing_Polynomial-poly_root_constant"><span class="command">lemma</span></span> poly_root_constant<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> <span class="main">(</span>poly <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="main">[:</span><span class="free">c</span><span class="main">:]</span><span class="main">)</span> <span class="main">(</span><span class="free">k</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> idom<span class="main">)</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>poly <span class="free">p</span> <span class="free">k</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> poly_mult <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>


<span class="keyword1" id="Missing_Polynomial-poly_linear_exp_linear_factors_rev"><span class="command">lemma</span></span> poly_linear_exp_linear_factors_rev<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[:</span><span class="free">b</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span><span class="main">)</span><span class="main">^</span><span class="main">(</span>length <span class="main">(</span>filter <span class="main">(</span><span class="main">(=)</span> <span class="free">b</span><span class="main">)</span> <span class="free">as</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">dvd</span> <span class="main">(</span><span class="main">∏</span> <span class="main">(</span><span class="bound">a</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> comm_ring_1<span class="main">)</span> <span class="main">←</span> <span class="free">as</span><span class="main">.</span> <span class="main">[:</span> <span class="bound">a</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">as</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">as</span><span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ls</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>filter <span class="main">(</span><span class="main">(=)</span> <span class="free">b</span><span class="main">)</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">as</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?l</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>filter <span class="main">(</span><span class="main">(=)</span> <span class="free">b</span><span class="main">)</span> <span class="skolem">as</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> prod<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∏</span> <span class="bound">a</span> <span class="main">←</span> Cons <span class="skolem">a</span> <span class="skolem">as</span><span class="main">.</span> <span class="main">[:</span> <span class="bound">a</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span> <span class="main">=</span> <span class="main">[:</span> <span class="skolem">a</span><span class="main">,</span> <span class="main">1</span> <span class="main">:]</span> <span class="main">*</span> <span class="main">(</span><span class="main">∏</span> <span class="bound">a</span> <span class="main">←</span> <span class="skolem">as</span><span class="main">.</span> <span class="main">[:</span> <span class="bound">a</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> <span class="free">b</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">hence</span></span> len<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?ls</span> <span class="main">=</span> <span class="var">?l</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> prod len <span class="keyword1"><span class="command">using</span></span> Cons <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> dvd_mult<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">hence</span></span> len<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[:</span> <span class="free">b</span><span class="main">,</span> <span class="main">1</span> <span class="main">:]</span> <span class="main">^</span> <span class="var">?ls</span> <span class="main">=</span> <span class="main">[:</span> <span class="skolem">a</span><span class="main">,</span> <span class="main">1</span> <span class="main">:]</span> <span class="main">*</span> <span class="main">[:</span> <span class="free">b</span><span class="main">,</span> <span class="main">1</span> <span class="main">:]</span> <span class="main">^</span> <span class="var">?l</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> prod len <span class="keyword1"><span class="command">using</span></span> Cons <span class="keyword1"><span class="command">using</span></span> dvd_refl mult_dvd_mono <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Missing_Polynomial-order_max"><span class="command">lemma</span></span> order_max<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> dvd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[:</span> <span class="main">-</span><span class="free">a</span><span class="main">,</span> <span class="main">1</span> <span class="main">:]</span> <span class="main">^</span> <span class="free">k</span> <span class="keyword1">dvd</span> <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">≤</span> order <span class="free">a</span> <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="var">?thesis</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">j</span><span class="main">.</span> <span class="free">k</span> <span class="main">=</span> Suc <span class="main">(</span>order <span class="free">a</span> <span class="free">p</span> <span class="main">+</span> <span class="bound">j</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="keyword2"><span class="keyword">where</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">=</span> Suc <span class="main">(</span>order <span class="free">a</span> <span class="free">p</span> <span class="main">+</span> <span class="skolem">j</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">[:</span> <span class="main">-</span><span class="free">a</span><span class="main">,</span> <span class="main">1</span> <span class="main">:]</span> <span class="main">^</span> Suc <span class="main">(</span>order <span class="free">a</span> <span class="free">p</span><span class="main">)</span> <span class="keyword1">dvd</span> <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> power_le_dvd<span class="main"><span class="main">[</span></span><span class="operator">OF</span> dvd<span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> k<span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> order_2<span class="main">[</span><span class="operator">OF</span> p<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">a</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Divisibility›</span></span>

<span class="keyword1"><span class="command">context</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">SORT_CONSTRAINT</span><span class="main">(</span><span class="tfree">'a</span> <span class="main">::</span> idom<span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1" id="Missing_Polynomial-poly_linear_linear_factor"><span class="command">lemma</span></span> poly_linear_linear_factor<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> 
  dvd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[:</span><span class="free">b</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span> <span class="keyword1">dvd</span> <span class="main">(</span><span class="main">∏</span> <span class="main">(</span><span class="bound">a</span> <span class="main">::</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">←</span> <span class="free">as</span><span class="main">.</span> <span class="main">[:</span> <span class="bound">a</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> set <span class="free">as</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?p</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">as</span><span class="main">.</span> <span class="main">(</span><span class="main">∏</span> <span class="bound">a</span> <span class="main">←</span> <span class="bound">as</span><span class="main">.</span> <span class="main">[:</span> <span class="bound">a</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?b</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">[:</span><span class="free">b</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">[</span><span class="operator">unfolded</span> dvd_def<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?p</span> <span class="free">as</span> <span class="main">=</span> <span class="var">?b</span> <span class="main">*</span> <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">from</span></span> arg_cong<span class="main">[</span><span class="operator">OF</span> id<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">p</span><span class="main">.</span> poly <span class="bound">p</span> <span class="main">(</span><span class="main">-</span><span class="free">b</span><span class="main">)</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="main">(</span><span class="var">?p</span> <span class="free">as</span><span class="main">)</span> <span class="main">(</span><span class="main">-</span><span class="free">b</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">as</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">as</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?p</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">as</span><span class="main">)</span> <span class="main">=</span> <span class="main">[:</span><span class="skolem">a</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span> <span class="main">*</span> <span class="var">?p</span> <span class="skolem">as</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> Cons<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">unfolded</span> this<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="main">(</span><span class="var">?p</span> <span class="skolem">as</span><span class="main">)</span> <span class="main">(</span><span class="main">-</span><span class="free">b</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">-</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> Cons<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Missing_Polynomial-poly_linear_exp_linear_factors"><span class="command">lemma</span></span> poly_linear_exp_linear_factors<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> dvd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[:</span><span class="free">b</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span><span class="main">)</span><span class="main">^</span><span class="free">n</span> <span class="keyword1">dvd</span> <span class="main">(</span><span class="main">∏</span> <span class="main">(</span><span class="bound">a</span> <span class="main">::</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">←</span> <span class="free">as</span><span class="main">.</span> <span class="main">[:</span> <span class="bound">a</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>filter <span class="main">(</span><span class="main">(=)</span> <span class="free">b</span><span class="main">)</span> <span class="free">as</span><span class="main">)</span> <span class="main">≥</span> <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?p</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">as</span><span class="main">.</span> <span class="main">(</span><span class="main">∏</span> <span class="bound">a</span> <span class="main">←</span> <span class="bound">as</span><span class="main">.</span> <span class="main">[:</span> <span class="bound">a</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?b</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">[:</span><span class="free">b</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> dvd <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">as</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span> <span class="skolem">as</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> bs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?b</span> <span class="main">^</span> Suc <span class="skolem">n</span> <span class="main">=</span> <span class="var">?b</span> <span class="main">*</span> <span class="var">?b</span> <span class="main">^</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> poly_linear_linear_factor<span class="main">[</span><span class="operator">OF</span> dvd_mult_left<span class="main"><span class="main">[</span></span><span class="operator">OF</span> Suc<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> bs<span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">,</span> 
      <span class="operator">unfolded</span> in_set_conv_decomp<span class="main">]</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">as1</span></span> <span class="skolem"><span class="skolem">as2</span></span> <span class="keyword2"><span class="keyword">where</span></span> as<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">as</span> <span class="main">=</span> <span class="skolem">as1</span> <span class="main">@</span> <span class="free">b</span> <span class="main">#</span> <span class="skolem">as2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?p</span> <span class="skolem">as</span> <span class="main">=</span> <span class="main">[:</span><span class="free">b</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span> <span class="main">*</span> <span class="var">?p</span> <span class="main">(</span><span class="skolem">as1</span> <span class="main">@</span> <span class="skolem">as2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> as
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">as1</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">as1</span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?p</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">as1</span> <span class="main">@</span> <span class="free">b</span> <span class="main">#</span> <span class="skolem">as2</span><span class="main">)</span> <span class="main">=</span> <span class="main">[:</span><span class="skolem">a</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span> <span class="main">*</span> <span class="var">?p</span> <span class="main">(</span><span class="skolem">as1</span> <span class="main">@</span> <span class="free">b</span> <span class="main">#</span> <span class="skolem">as2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?p</span> <span class="main">(</span><span class="skolem">as1</span> <span class="main">@</span> <span class="free">b</span> <span class="main">#</span> <span class="skolem">as2</span><span class="main">)</span> <span class="main">=</span> <span class="main">[:</span><span class="free">b</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span> <span class="main">*</span> <span class="var">?p</span> <span class="main">(</span><span class="skolem">as1</span> <span class="main">@</span> <span class="skolem">as2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> Cons <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">[:</span><span class="skolem">a</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span> <span class="main">*</span> <span class="main">…</span> <span class="main">=</span> <span class="main">[:</span><span class="free">b</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span> <span class="main">*</span> <span class="main">(</span><span class="main">[:</span><span class="skolem">a</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span> <span class="main">*</span> <span class="var">?p</span> <span class="main">(</span><span class="skolem">as1</span> <span class="main">@</span> <span class="skolem">as2</span><span class="main">)</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> mult.left_commute<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> Suc<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">unfolded</span> bs this dvd_mult_cancel_left<span class="main">]</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?b</span> <span class="main">^</span> <span class="skolem">n</span> <span class="keyword1">dvd</span> <span class="var">?p</span> <span class="main">(</span><span class="skolem">as1</span> <span class="main">@</span> <span class="skolem">as2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> Suc<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> as <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>    
<span class="keyword1"><span class="command">qed</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1" id="Missing_Polynomial-const_poly_dvd"><span class="command">lemma</span></span> const_poly_dvd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[:</span><span class="free">a</span><span class="main">:]</span> <span class="keyword1">dvd</span> <span class="main">[:</span><span class="free">b</span><span class="main">:]</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">a</span> <span class="keyword1">dvd</span> <span class="free">b</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="keyword1">dvd</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">=</span> <span class="free">a</span> <span class="main">*</span> <span class="skolem">c</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> dvd_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">[:</span><span class="free">b</span><span class="main">:]</span> <span class="main">=</span> <span class="main">[:</span><span class="free">a</span><span class="main">:]</span> <span class="main">*</span> <span class="main">[:</span> <span class="skolem">c</span><span class="main">:]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">[:</span><span class="free">a</span><span class="main">:]</span> <span class="keyword1">dvd</span> <span class="main">[:</span><span class="free">b</span><span class="main">:]</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> dvd_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">[:</span><span class="free">a</span><span class="main">:]</span> <span class="keyword1">dvd</span> <span class="main">[:</span><span class="free">b</span><span class="main">:]</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">pc</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">[:</span><span class="free">b</span><span class="main">:]</span> <span class="main">=</span>  <span class="main">[:</span><span class="free">a</span><span class="main">:]</span> <span class="main">*</span> <span class="skolem">pc</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> dvd_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> arg_cong<span class="main">[</span><span class="operator">OF</span> this<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">p</span><span class="main">.</span> coeff <span class="bound">p</span> <span class="main">0</span>"</span></span><span class="main">,</span> <span class="operator">unfolded</span> coeff_mult<span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">=</span> <span class="free">a</span> <span class="main">*</span> coeff <span class="skolem">pc</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="keyword1">dvd</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> dvd_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Missing_Polynomial-const_poly_dvd_1"><span class="command">lemma</span></span> const_poly_dvd_1 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">[:</span><span class="free">a</span><span class="main">:]</span> <span class="keyword1">dvd</span> <span class="main">1</span> <span class="main">⟷</span> <span class="free">a</span> <span class="keyword1">dvd</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> const_poly_dvd one_poly_eq_simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>

<span class="keyword1" id="Missing_Polynomial-poly_dvd_1"><span class="command">lemma</span></span> poly_dvd_1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>comm_semiring_1<span class="main">,</span>semiring_no_zero_divisors<span class="main">}</span> poly"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="keyword1">dvd</span> <span class="main">1</span> <span class="main">⟷</span> degree <span class="free">p</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> coeff <span class="free">p</span> <span class="main">0</span> <span class="keyword1">dvd</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">with</span></span> divides_degree<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">from</span></span> degree0_coeffs<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword">where</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="main">[:</span><span class="skolem">a</span><span class="main">:]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> p <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Degree based version of irreducibility.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">irreducible<span class="hidden">⇩</span><sub>d</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> comm_semiring_1 poly <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">irreducible<span class="hidden">⇩</span><sub>d</sub></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> <span class="main">(</span>degree <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">q</span> <span class="bound">r</span><span class="main">.</span> degree <span class="bound">q</span> <span class="main">&lt;</span> degree <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">⟶</span> degree <span class="bound">r</span> <span class="main">&lt;</span> degree <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">⟶</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">≠</span> <span class="bound">q</span> <span class="main">*</span> <span class="bound">r</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Missing_Polynomial-irreducible"><span class="command">lemma</span></span> irreducible<span class="hidden">⇩</span><sub>d</sub>I <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">q</span> <span class="bound">r</span><span class="main">.</span> degree <span class="bound">q</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> degree <span class="bound">q</span> <span class="main">&lt;</span> degree <span class="free">p</span> <span class="main">⟹</span> degree <span class="bound">r</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> degree <span class="bound">r</span> <span class="main">&lt;</span> degree <span class="free">p</span> <span class="main">⟹</span> <span class="free">p</span> <span class="main">=</span> <span class="bound">q</span> <span class="main">*</span> <span class="bound">r</span> <span class="main">⟹</span> False"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"irreducible<span class="hidden">⇩</span><sub>d</sub> <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> irreducible<span class="hidden">⇩</span><sub>d</sub>_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI allI impI notI 1<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">q</span> <span class="skolem">r</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"degree <span class="skolem">q</span> <span class="main">&lt;</span> degree <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"degree <span class="skolem">r</span> <span class="main">&lt;</span> degree <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="skolem">q</span> <span class="main">*</span> <span class="skolem">r</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> degree_mult_le<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">q</span></span> <span class="quoted"><span class="skolem">r</span></span><span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> 2<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Missing_Polynomial-irreducible"><span class="command">lemma</span></span> irreducible<span class="hidden">⇩</span><sub>d</sub>I2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>comm_semiring_1<span class="main">,</span>semiring_no_zero_divisors<span class="main">}</span> poly"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> deg<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ndvd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">q</span><span class="main">.</span> degree <span class="bound">q</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> degree <span class="bound">q</span> <span class="main">≤</span> degree <span class="free">p</span> <span class="keyword1">div</span> <span class="numeral">2</span> <span class="main">⟹</span> <span class="main">¬</span> <span class="bound">q</span> <span class="keyword1">dvd</span> <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"irreducible<span class="hidden">⇩</span><sub>d</sub> <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="var">?thesis</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> this<span class="main">[</span><span class="operator">unfolded</span> irreducible<span class="hidden">⇩</span><sub>d</sub>_def<span class="main">]</span> deg <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="keyword2"><span class="keyword">where</span></span> dq<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="skolem">q</span> <span class="main">&lt;</span> degree <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> dr<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="skolem">r</span> <span class="main">&lt;</span> degree <span class="free">p</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="skolem">q</span> <span class="main">*</span> <span class="skolem">r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> deg <span class="keyword1"><span class="command">have</span></span> p0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> p <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> degree_mult_eq<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> p <span class="keyword1"><span class="command">have</span></span> dp<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span> <span class="main">=</span> degree <span class="skolem">q</span> <span class="main">+</span> degree <span class="skolem">r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"degree <span class="skolem">q</span> <span class="main">≤</span> degree <span class="free">p</span> <span class="keyword1">div</span> <span class="numeral">2</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">from</span></span> ndvd<span class="main">[</span><span class="operator">OF</span> _ True<span class="main">]</span> dq dr dp p <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">with</span></span> dp <span class="keyword1"><span class="command">have</span></span> dr<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="skolem">r</span> <span class="main">≤</span> degree <span class="free">p</span> <span class="keyword1">div</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> p <span class="keyword1"><span class="command">have</span></span> dvd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="keyword1">dvd</span> <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> ndvd<span class="main">[</span><span class="operator">OF</span> _ dr<span class="main">]</span> dvd dp dq <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Missing_Polynomial-reducible"><span class="command">lemma</span></span> reducible<span class="hidden">⇩</span><sub>d</sub>I<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">q</span> <span class="bound">r</span><span class="main">.</span> degree <span class="bound">q</span> <span class="main">&lt;</span> degree <span class="free">p</span> <span class="main">∧</span> degree <span class="bound">r</span> <span class="main">&lt;</span> degree <span class="free">p</span> <span class="main">∧</span> <span class="free">p</span> <span class="main">=</span> <span class="bound">q</span> <span class="main">*</span> <span class="bound">r</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> irreducible<span class="hidden">⇩</span><sub>d</sub> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> irreducible<span class="hidden">⇩</span><sub>d</sub>_def<span class="main">)</span>

<span class="keyword1" id="Missing_Polynomial-irreducible"><span class="command">lemma</span></span> irreducible<span class="hidden">⇩</span><sub>d</sub>E <span class="main">[</span><span class="operator">elim</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"irreducible<span class="hidden">⇩</span><sub>d</sub> <span class="free">p</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">⋀</span><span class="bound">q</span> <span class="bound">r</span><span class="main">.</span> degree <span class="bound">q</span> <span class="main">&lt;</span> degree <span class="free">p</span> <span class="main">⟹</span> degree <span class="bound">r</span> <span class="main">&lt;</span> degree <span class="free">p</span> <span class="main">⟹</span> <span class="free">p</span> <span class="main">≠</span> <span class="bound">q</span> <span class="main">*</span> <span class="bound">r</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">thesis</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="free">thesis</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> irreducible<span class="hidden">⇩</span><sub>d</sub>_def<span class="main">)</span>

<span class="keyword1" id="Missing_Polynomial-reducible"><span class="command">lemma</span></span> reducible<span class="hidden">⇩</span><sub>d</sub>E <span class="main">[</span><span class="operator">elim</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> red<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> irreducible<span class="hidden">⇩</span><sub>d</sub> <span class="free">p</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟹</span> <span class="free">thesis</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">q</span> <span class="bound">r</span><span class="main">.</span> degree <span class="bound">q</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> degree <span class="bound">q</span> <span class="main">&lt;</span> degree <span class="free">p</span> <span class="main">⟹</span> degree <span class="bound">r</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> degree <span class="bound">r</span> <span class="main">&lt;</span> degree <span class="free">p</span> <span class="main">⟹</span> <span class="free">p</span> <span class="main">=</span> <span class="bound">q</span> <span class="main">*</span> <span class="bound">r</span> <span class="main">⟹</span> <span class="free">thesis</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="free">thesis</span></span>
  <span class="keyword1"><span class="command">using</span></span> red<span class="main">[</span><span class="operator">unfolded</span> irreducible<span class="hidden">⇩</span><sub>d</sub>_def de_Morgan_conj not_not not_all not_imp<span class="main">]</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">elim</span> disjE exE conjE<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>degree <span class="free">p</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> <span class="free">thesis</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">q</span> <span class="skolem">r</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"degree <span class="skolem">q</span> <span class="main">&lt;</span> degree <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"degree <span class="skolem">r</span> <span class="main">&lt;</span> degree <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="skolem">q</span> <span class="main">*</span> <span class="skolem">r</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> degree_mult_le<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">q</span></span> <span class="quoted"><span class="skolem">r</span></span><span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="free">thesis</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> 2<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Missing_Polynomial-irreducible"><span class="command">lemma</span></span> irreducible<span class="hidden">⇩</span><sub>d</sub>D<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"irreducible<span class="hidden">⇩</span><sub>d</sub> <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">q</span> <span class="bound">r</span><span class="main">.</span> degree <span class="bound">q</span> <span class="main">&lt;</span> degree <span class="free">p</span> <span class="main">⟹</span> degree <span class="bound">r</span> <span class="main">&lt;</span> degree <span class="free">p</span> <span class="main">⟹</span> <span class="free">p</span> <span class="main">≠</span> <span class="bound">q</span> <span class="main">*</span> <span class="bound">r</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> irreducible<span class="hidden">⇩</span><sub>d</sub>_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">theorem</span></span> irreducible<span class="hidden">⇩</span><sub>d</sub>_factorization_exists<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">fs</span><span class="main">.</span> <span class="bound">fs</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">f</span> <span class="main">∈</span> set <span class="bound">fs</span><span class="main">.</span> irreducible<span class="hidden">⇩</span><sub>d</sub> <span class="bound">f</span> <span class="main">∧</span> degree <span class="bound">f</span> <span class="main">≤</span> degree <span class="free">p</span><span class="main">)</span> <span class="main">∧</span> <span class="free">p</span> <span class="main">=</span> prod_list <span class="bound">fs</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>irreducible<span class="hidden">⇩</span><sub>d</sub> <span class="free">p</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">fs</span><span class="main">.</span> length <span class="bound">fs</span> <span class="main">&gt;</span> <span class="main">1</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">f</span> <span class="main">∈</span> set <span class="bound">fs</span><span class="main">.</span> irreducible<span class="hidden">⇩</span><sub>d</sub> <span class="bound">f</span> <span class="main">∧</span> degree <span class="bound">f</span> <span class="main">&lt;</span> degree <span class="free">p</span><span class="main">)</span> <span class="main">∧</span> <span class="free">p</span> <span class="main">=</span> prod_list <span class="bound">fs</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">atomize</span><span class="main"><span class="main">(</span></span><span class="quasi_keyword">full</span><span class="main"><span class="main">)</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> assms<span class="main"><span class="keyword3">,</span></span> <span class="operator">induct</span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span>"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span><span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> less_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> less
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> deg_f<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="skolem">p</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"irreducible<span class="hidden">⇩</span><sub>d</sub> <span class="skolem">p</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="main">[</span><span class="skolem">p</span><span class="main">]</span> <span class="main">⊆</span> Collect irreducible<span class="hidden">⇩</span><sub>d</sub>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> prod_list <span class="main">[</span><span class="skolem">p</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> True <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">p</span><span class="main">]</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">with</span></span> deg_f <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="skolem"><span class="skolem">h</span></span>
    <span class="keyword2"><span class="keyword">where</span></span> deg_g<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="skolem">g</span> <span class="main">&lt;</span> degree <span class="skolem">p</span>"</span></span> <span class="quoted"><span class="quoted">"degree <span class="skolem">g</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> deg_h<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="skolem">h</span> <span class="main">&lt;</span> degree <span class="skolem">p</span>"</span></span> <span class="quoted"><span class="quoted">"degree <span class="skolem">h</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> f_gh<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> <span class="skolem">g</span> <span class="main">*</span> <span class="skolem">h</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> less.hyps<span class="main">[</span><span class="operator">OF</span> deg_g<span class="main">]</span> less.hyps<span class="main">[</span><span class="operator">OF</span> deg_h<span class="main">]</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">gs</span></span> <span class="skolem"><span class="skolem">hs</span></span>
    <span class="keyword2"><span class="keyword">where</span></span> emp<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="skolem">gs</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">hs</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">f</span> <span class="main">∈</span> set <span class="skolem">gs</span><span class="main">.</span> irreducible<span class="hidden">⇩</span><sub>d</sub> <span class="bound">f</span> <span class="main">∧</span> degree <span class="bound">f</span> <span class="main">≤</span> degree <span class="skolem">g</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">=</span> prod_list <span class="skolem">gs</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">f</span> <span class="main">∈</span> set <span class="skolem">hs</span><span class="main">.</span> irreducible<span class="hidden">⇩</span><sub>d</sub> <span class="bound">f</span> <span class="main">∧</span> degree <span class="bound">f</span> <span class="main">≤</span> degree <span class="skolem">h</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">=</span> prod_list <span class="skolem">hs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> f_gh deg_g deg_h
    <span class="keyword1"><span class="command">have</span></span> len<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="skolem">gs</span><span class="main">@</span><span class="skolem">hs</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> mem<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">f</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">gs</span><span class="main">@</span><span class="skolem">hs</span><span class="main">)</span><span class="main">.</span> irreducible<span class="hidden">⇩</span><sub>d</sub> <span class="bound">f</span> <span class="main">∧</span> degree <span class="bound">f</span> <span class="main">&lt;</span> degree <span class="skolem">p</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> prod_list <span class="main">(</span><span class="skolem">gs</span><span class="main">@</span><span class="skolem">hs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> length_greater_0_conv<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> False <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">gs</span><span class="main">@</span><span class="skolem">hs</span>"</span></span><span class="main"><span class="main">]</span></span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> less_imp_le<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Missing_Polynomial-irreducible"><span class="command">lemma</span></span> irreducible<span class="hidden">⇩</span><sub>d</sub>_factor<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>comm_semiring_1<span class="main">,</span>semiring_no_zero_divisors<span class="main">}</span> poly"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">q</span> <span class="bound">r</span><span class="main">.</span> irreducible<span class="hidden">⇩</span><sub>d</sub> <span class="bound">q</span> <span class="main">∧</span> <span class="free">p</span> <span class="main">=</span> <span class="bound">q</span> <span class="main">*</span> <span class="bound">r</span> <span class="main">∧</span> degree <span class="bound">r</span> <span class="main">&lt;</span> degree <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span>"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> less_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>less <span class="skolem">p</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"irreducible<span class="hidden">⇩</span><sub>d</sub> <span class="skolem">p</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">with</span></span> less<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="skolem"><span class="skolem">r</span></span>
    <span class="keyword2"><span class="keyword">where</span></span> q<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="skolem">q</span> <span class="main">&lt;</span> degree <span class="skolem">p</span>"</span></span> <span class="quoted"><span class="quoted">"degree <span class="skolem">q</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="skolem">r</span> <span class="main">&lt;</span> degree <span class="skolem">p</span>"</span></span> <span class="quoted"><span class="quoted">"degree <span class="skolem">r</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> <span class="skolem">q</span> <span class="main">*</span> <span class="skolem">r</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> less<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> q<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="keyword2"><span class="keyword">where</span></span> IH<span class="main">:</span> <span class="quoted"><span class="quoted">"irreducible<span class="hidden">⇩</span><sub>d</sub> <span class="skolem">s</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">=</span> <span class="skolem">s</span> <span class="main">*</span> <span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> p <span class="keyword1"><span class="command">have</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> <span class="skolem">s</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">t</span> <span class="main">*</span> <span class="skolem">r</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> IH <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> less<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"degree <span class="skolem">p</span> <span class="main">=</span> degree <span class="skolem">s</span> <span class="main">+</span> <span class="main">(</span>degree <span class="main">(</span><span class="skolem">t</span> <span class="main">*</span> <span class="skolem">r</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> p 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> degree_mult_eq<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> p<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> irreducible<span class="hidden">⇩</span><sub>d</sub>D<span class="main">[</span><span class="operator">OF</span> IH<span class="main"><span class="main"><span class="main">(</span></span></span>1<span class="main"><span class="main"><span class="main">)</span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degree <span class="skolem">p</span> <span class="main">&gt;</span> degree <span class="main">(</span><span class="skolem">t</span> <span class="main">*</span> <span class="skolem">r</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> p IH <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">p</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="main"><span class="quoted"><span class="main"><span class="quoted"><span class="main">1</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> True less<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">context</span></span> mult_zero <span class="keyword2"><span class="keyword">begin</span></span> <span class="comment1">(* least class with times and zero *)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">zero_divisor</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">zero_divisor</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">≡</span> <span class="main">∃</span><span class="bound">b</span><span class="main">.</span> <span class="bound">b</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">*</span> <span class="bound">b</span> <span class="main">=</span> <span class="main">0</span>"</span></span>

<span class="keyword1" id="Missing_Polynomial-zero_divisorI"><span class="command">lemma</span></span> zero_divisorI<span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">*</span> <span class="free">b</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"zero_divisor <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> zero_divisor_def<span class="main">)</span>

<span class="keyword1" id="Missing_Polynomial-zero_divisorE"><span class="command">lemma</span></span> zero_divisorE<span class="main">[</span><span class="operator">elim</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"zero_divisor <span class="free">a</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">b</span><span class="main">.</span> <span class="bound">b</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> <span class="free">a</span> <span class="main">*</span> <span class="bound">b</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟹</span> <span class="free">thesis</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="free">thesis</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> zero_divisor_def<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1" id="Missing_Polynomial-zero_divisor_0"><span class="command">lemma</span></span> zero_divisor_0<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"zero_divisor <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>mult_zero<span class="main">,</span>zero_neq_one<span class="main">}</span><span class="main">)</span>"</span></span> <span class="comment1">(* No need for one! *)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> zero_divisorI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1" id="Missing_Polynomial-not_zero_divisor_1"><span class="command">lemma</span></span> not_zero_divisor_1<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">¬</span> zero_divisor <span class="main">(</span><span class="main">1</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>monoid_mult<span class="main">,</span>mult_zero<span class="main">}</span><span class="main">)</span>"</span></span> <span class="comment1">(* No need for associativity! *)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Missing_Polynomial-zero_divisor_iff_eq_0"><span class="command">lemma</span></span> zero_divisor_iff_eq_0<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">a</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>semiring_no_zero_divisors<span class="main">,</span> zero_neq_one<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"zero_divisor <span class="free">a</span> <span class="main">⟷</span> <span class="free">a</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Missing_Polynomial-mult_eq_0_not_zero_divisor_left"><span class="command">lemma</span></span> mult_eq_0_not_zero_divisor_left<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">a</span> <span class="free">b</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> mult_zero"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> zero_divisor <span class="free">a</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">*</span> <span class="free">b</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="free">b</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> zero_divisor_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

<span class="keyword1" id="Missing_Polynomial-mult_eq_0_not_zero_divisor_right"><span class="command">lemma</span></span> mult_eq_0_not_zero_divisor_right<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">a</span> <span class="free">b</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>ab_semigroup_mult<span class="main">,</span>mult_zero<span class="main">}</span>"</span></span> <span class="comment1">(* No need for associativity! *)</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> zero_divisor <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">*</span> <span class="free">b</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="free">a</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> zero_divisor_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>

<span class="keyword1" id="Missing_Polynomial-degree_smult_not_zero_divisor_left"><span class="command">lemma</span></span> degree_smult_not_zero_divisor_left<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> zero_divisor <span class="free">c</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span>smult <span class="free">c</span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span> degree <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coeff <span class="main">(</span>smult <span class="free">c</span> <span class="free">p</span><span class="main">)</span> <span class="main">(</span>degree <span class="free">p</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> le_degree<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> degree_smult_le<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">c</span></span> <span class="quoted"><span class="free">p</span></span><span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Missing_Polynomial-degree_smult_not_zero_divisor_right"><span class="command">lemma</span></span> degree_smult_not_zero_divisor_right<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> zero_divisor <span class="main">(</span>lead_coeff <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span>smult <span class="free">c</span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">c</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> degree <span class="free">p</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coeff <span class="main">(</span>smult <span class="free">c</span> <span class="free">p</span><span class="main">)</span> <span class="main">(</span>degree <span class="free">p</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> le_degree<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> degree_smult_le<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">c</span></span> <span class="quoted"><span class="free">p</span></span><span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>


<span class="keyword1" id="Missing_Polynomial-irreducible"><span class="command">lemma</span></span> irreducible<span class="hidden">⇩</span><sub>d</sub>_smult_not_zero_divisor_left<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> c0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> zero_divisor <span class="free">c</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> L<span class="main">:</span> <span class="quoted"><span class="quoted">"irreducible<span class="hidden">⇩</span><sub>d</sub> <span class="main">(</span>smult <span class="free">c</span> <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"irreducible<span class="hidden">⇩</span><sub>d</sub> <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> irreducible<span class="hidden">⇩</span><sub>d</sub>I<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> L <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span>smult <span class="free">c</span> <span class="free">p</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">note</span></span> degree_smult_le
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">q</span> <span class="skolem">r</span>
  <span class="keyword3"><span class="command">assume</span></span> deg_q<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="skolem">q</span> <span class="main">&lt;</span> degree <span class="free">p</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> deg_r<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="skolem">r</span> <span class="main">&lt;</span> degree <span class="free">p</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> p_qr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="skolem">q</span> <span class="main">*</span> <span class="skolem">r</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"smult <span class="free">c</span> <span class="free">p</span> <span class="main">=</span> smult <span class="free">c</span> <span class="skolem">q</span> <span class="main">*</span> <span class="skolem">r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">note</span></span> degree_smult_le<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">c</span></span> <span class="quoted"><span class="skolem">q</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">note</span></span> deg_q
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span>smult <span class="free">c</span> <span class="skolem">q</span><span class="main">)</span> <span class="main">&lt;</span> degree <span class="main">(</span>smult <span class="free">c</span> <span class="free">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> c0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> deg_r <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="skolem">r</span> <span class="main">&lt;</span> <span class="main">…</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> c0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> irreducible<span class="hidden">⇩</span><sub>d</sub>D<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> L 2 3<span class="main">]</span> 1 <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> irreducible<span class="hidden">⇩</span><sub>d</sub>_smultI <span class="main">=</span>
  irreducible<span class="hidden">⇩</span><sub>d</sub>_smult_not_zero_divisor_left
  <span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="tfree">'a</span> <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>comm_semiring_1<span class="main">,</span>semiring_no_zero_divisors<span class="main">}</span>"</span></span><span class="main">,</span> <span class="operator">simplified</span><span class="main">]</span>

<span class="keyword1" id="Missing_Polynomial-irreducible"><span class="command">lemma</span></span> irreducible<span class="hidden">⇩</span><sub>d</sub>_smult_not_zero_divisor_right<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> zero_divisor <span class="main">(</span>lead_coeff <span class="free">p</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> L<span class="main">:</span> <span class="quoted"><span class="quoted">"irreducible<span class="hidden">⇩</span><sub>d</sub> <span class="main">(</span>smult <span class="free">c</span> <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"irreducible<span class="hidden">⇩</span><sub>d</sub> <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> L <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> p0 <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span>smult <span class="free">c</span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span> degree <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"irreducible<span class="hidden">⇩</span><sub>d</sub> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> iffI irreducible<span class="hidden">⇩</span><sub>d</sub>I conjI<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> L <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">q</span> <span class="skolem">r</span>
    <span class="keyword3"><span class="command">assume</span></span> deg_q<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="skolem">q</span> <span class="main">&lt;</span> degree <span class="free">p</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> deg_r<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="skolem">r</span> <span class="main">&lt;</span> degree <span class="free">p</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p_qr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="skolem">q</span> <span class="main">*</span> <span class="skolem">r</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"smult <span class="free">c</span> <span class="free">p</span> <span class="main">=</span> smult <span class="free">c</span> <span class="skolem">q</span> <span class="main">*</span> <span class="skolem">r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">note</span></span> degree_smult_le<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">c</span></span> <span class="quoted"><span class="skolem">q</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">note</span></span> deg_q
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span>smult <span class="free">c</span> <span class="skolem">q</span><span class="main">)</span> <span class="main">&lt;</span> degree <span class="main">(</span>smult <span class="free">c</span> <span class="free">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> deg_r <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="skolem">r</span> <span class="main">&lt;</span> <span class="main">…</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> irreducible<span class="hidden">⇩</span><sub>d</sub>D<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> L 2 3<span class="main">]</span> 1 <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Missing_Polynomial-zero_divisor_mult_left"><span class="command">lemma</span></span> zero_divisor_mult_left<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">a</span> <span class="free">b</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>ab_semigroup_mult<span class="main">,</span> mult_zero<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"zero_divisor <span class="free">a</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"zero_divisor <span class="main">(</span><span class="free">a</span> <span class="main">*</span> <span class="free">b</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> c0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">*</span> <span class="skolem">c</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">*</span> <span class="free">b</span> <span class="main">*</span> <span class="skolem">c</span> <span class="main">=</span> <span class="free">a</span> <span class="main">*</span> <span class="skolem">c</span> <span class="main">*</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> c0 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Missing_Polynomial-zero_divisor_mult_right"><span class="command">lemma</span></span> zero_divisor_mult_right<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">a</span> <span class="free">b</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>semigroup_mult<span class="main">,</span> mult_zero<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"zero_divisor <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"zero_divisor <span class="main">(</span><span class="free">a</span> <span class="main">*</span> <span class="free">b</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> c0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">*</span> <span class="skolem">c</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">*</span> <span class="free">b</span> <span class="main">*</span> <span class="skolem">c</span> <span class="main">=</span> <span class="free">a</span> <span class="main">*</span> <span class="main">(</span><span class="free">b</span> <span class="main">*</span> <span class="skolem">c</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> c0 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Missing_Polynomial-not_zero_divisor_mult"><span class="command">lemma</span></span> not_zero_divisor_mult<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">a</span> <span class="free">b</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>ab_semigroup_mult<span class="main">,</span> mult_zero<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> zero_divisor <span class="main">(</span><span class="free">a</span> <span class="main">*</span> <span class="free">b</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> zero_divisor <span class="free">a</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> zero_divisor <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> zero_divisor_mult_right zero_divisor_mult_left<span class="main">)</span>

<span class="keyword1" id="Missing_Polynomial-zero_divisor_smult_left"><span class="command">lemma</span></span> zero_divisor_smult_left<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"zero_divisor <span class="free">a</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"zero_divisor <span class="main">(</span>smult <span class="free">a</span> <span class="free">f</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> b0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">*</span> <span class="skolem">b</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"smult <span class="free">a</span> <span class="free">f</span> <span class="main">*</span> <span class="main">[:</span><span class="skolem">b</span><span class="main">:]</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> b0 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> zero_divisorI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">[:</span><span class="skolem">b</span><span class="main">:]</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Missing_Polynomial-unit_not_zero_divisor"><span class="command">lemma</span></span> unit_not_zero_divisor<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">a</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>comm_monoid_mult<span class="main">,</span> mult_zero<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="keyword1">dvd</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>zero_divisor <span class="free">a</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> ab<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">=</span> <span class="free">a</span> <span class="main">*</span> <span class="skolem">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">elim</span> dvdE<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"zero_divisor <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"zero_divisor <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> ab<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> zero_divisor_mult_left<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="Missing_Polynomial-linear_irreducible"><span class="command">lemma</span></span> linear_irreducible<span class="hidden">⇩</span><sub>d</sub><span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"irreducible<span class="hidden">⇩</span><sub>d</sub> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> irreducible<span class="hidden">⇩</span><sub>d</sub>I<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> assms<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="Missing_Polynomial-irreducible"><span class="command">lemma</span></span> irreducible<span class="hidden">⇩</span><sub>d</sub>_dvd_smult<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>comm_semiring_1<span class="main">,</span>semiring_no_zero_divisors<span class="main">}</span> poly"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"irreducible<span class="hidden">⇩</span><sub>d</sub> <span class="free">q</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="keyword1">dvd</span> <span class="free">q</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">c</span><span class="main">.</span> <span class="bound">c</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">q</span> <span class="main">=</span> smult <span class="bound">c</span> <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="keyword2"><span class="keyword">where</span></span> q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">=</span> <span class="free">p</span> <span class="main">*</span> <span class="skolem">r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">elim</span> dvdE<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> degree_mult_eq<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="skolem">r</span></span><span class="main">]</span> assms<span class="main">(</span>1<span class="main">)</span> q
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> degree <span class="free">p</span> <span class="main">&lt;</span> degree <span class="free">q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> nz<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> degree_mult_eq_0 gr_implies_not_zero irreducible<span class="hidden">⇩</span><sub>d</sub>D<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> less_add_same_cancel2<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> deg<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span> <span class="main">≥</span> degree <span class="free">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="keyword1">dvd</span> <span class="free">q</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">=</span> <span class="skolem">k</span> <span class="main">*</span> <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> dvd_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> nz <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> deg<span class="main">[</span><span class="operator">unfolded</span> q degree_mult_eq<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">k</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="main"><span class="main">]</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degree <span class="skolem">k</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> q <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">=</span> <span class="main">[:</span> <span class="skolem">c</span> <span class="main">:]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> degree_0_id<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">k</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">=</span> smult <span class="skolem">c</span> <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> q k <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">c</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Map over Polynomial Coefficients›</span></span>
<span class="keyword1" id="Missing_Polynomial-map_poly_simps"><span class="command">lemma</span></span> map_poly_simps<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"map_poly <span class="free">f</span> <span class="main">(</span>pCons <span class="free">c</span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span>
    <span class="main">(</span><span class="keyword1">if</span> <span class="free">c</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">p</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> pCons <span class="main">(</span><span class="free">f</span> <span class="free">c</span><span class="main">)</span> <span class="main">(</span>map_poly <span class="free">f</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True <span class="keyword1"><span class="command">note</span></span> c0 <span class="main">=</span> this <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> c0 <span class="keyword1"><span class="command">unfolding</span></span> map_poly_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">next</span></span> <span class="keyword3"><span class="command">case</span></span> False <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> map_poly_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span> <span class="keyword3"><span class="command">case</span></span> False <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> map_poly_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Missing_Polynomial-map_poly_pCons"><span class="command">lemma</span></span> map_poly_pCons<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∨</span> <span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"map_poly <span class="free">f</span> <span class="main">(</span>pCons <span class="free">c</span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span> pCons <span class="main">(</span><span class="free">f</span> <span class="free">c</span><span class="main">)</span> <span class="main">(</span>map_poly <span class="free">f</span> <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> map_poly_simps <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Missing_Polynomial-map_poly_map_poly"><span class="command">lemma</span></span> map_poly_map_poly<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> f0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"map_poly <span class="free">f</span> <span class="main">(</span>map_poly <span class="free">g</span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span> map_poly <span class="main">(</span><span class="free">f</span> <span class="main">∘</span> <span class="free">g</span><span class="main">)</span> <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>pCons <span class="skolem">a</span> <span class="skolem">p</span><span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="skolem">a</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∨</span> map_poly <span class="free">g</span> <span class="skolem">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> map_poly_pCons<span class="main">[</span><span class="operator">OF</span> pCons<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">unfolding</span></span> map_poly_pCons<span class="main">[</span><span class="operator">OF</span> True<span class="main">]</span>
      <span class="keyword1"><span class="command">unfolding</span></span> pCons<span class="main">(</span>2<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> map_poly_pCons<span class="main">[</span><span class="operator">OF</span> pCons<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">unfolding</span></span> pCons<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f0<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Missing_Polynomial-map_poly_zero"><span class="command">lemma</span></span> map_poly_zero<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">c</span><span class="main">.</span> <span class="free">f</span> <span class="bound">c</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟶</span> <span class="bound">c</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"map_poly <span class="free">f</span> <span class="free">p</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="free">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> map_poly_simps f<span class="main">)</span>

<span class="keyword1" id="Missing_Polynomial-map_poly_add"><span class="command">lemma</span></span> map_poly_add<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> h0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> h_add<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">p</span> <span class="bound">q</span><span class="main">.</span> <span class="free">h</span> <span class="main">(</span><span class="bound">p</span> <span class="main">+</span> <span class="bound">q</span><span class="main">)</span> <span class="main">=</span> <span class="free">h</span> <span class="bound">p</span> <span class="main">+</span> <span class="free">h</span> <span class="bound">q</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"map_poly <span class="free">h</span> <span class="main">(</span><span class="free">p</span> <span class="main">+</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> map_poly <span class="free">h</span> <span class="free">p</span> <span class="main">+</span> map_poly <span class="free">h</span> <span class="free">q</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">q</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>pCons <span class="skolem">a</span> <span class="skolem">p</span><span class="main">)</span> <span class="keyword1"><span class="command">note</span></span> pIH <span class="main">=</span> this
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>pCons <span class="skolem">b</span> <span class="skolem">q</span><span class="main">)</span> <span class="keyword1"><span class="command">note</span></span> qIH <span class="main">=</span> this
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> map_poly_pCons<span class="main">[</span><span class="operator">OF</span> qIH<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span>
          <span class="keyword1"><span class="command">unfolding</span></span> map_poly_pCons<span class="main">[</span><span class="operator">OF</span> pIH<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span>
          <span class="keyword1"><span class="command">unfolding</span></span> add_pCons
          <span class="keyword1"><span class="command">unfolding</span></span> pIH<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
          <span class="keyword1"><span class="command">unfolding</span></span> h_add<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span><span class="operator">symmetric</span><span class="main">]</span>
          <span class="keyword1"><span class="command">unfolding</span></span> map_poly_simps <span class="keyword1"><span class="command">using</span></span> h0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Morphismic properties of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"pCons <span class="main"><span class="main">0</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>›</span></span>

<span class="keyword1" id="Missing_Polynomial-monom_pCons_0_monom"><span class="command">lemma</span></span> monom_pCons_0_monom<span class="main">:</span>
  <span class="quoted"><span class="quoted">"monom <span class="main">(</span>pCons <span class="main">0</span> <span class="main">(</span>monom <span class="free">a</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="free">d</span> <span class="main">=</span> map_poly <span class="main">(</span>pCons <span class="main">0</span><span class="main">)</span> <span class="main">(</span>monom <span class="main">(</span>monom <span class="free">a</span> <span class="free">n</span><span class="main">)</span> <span class="free">d</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">d</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">unfolding</span></span> monom_0 <span class="keyword1"><span class="command">unfolding</span></span> map_poly_simps <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">unfolding</span></span> monom_Suc map_poly_simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Missing_Polynomial-pCons_0_add"><span class="command">lemma</span></span> pCons_0_add<span class="main">:</span> <span class="quoted"><span class="quoted">"pCons <span class="main">0</span> <span class="main">(</span><span class="free">p</span> <span class="main">+</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> pCons <span class="main">0</span> <span class="free">p</span> <span class="main">+</span> pCons <span class="main">0</span> <span class="free">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Missing_Polynomial-sum_pCons_0_commute"><span class="command">lemma</span></span> sum_pCons_0_commute<span class="main">:</span>
  <span class="quoted"><span class="quoted">"sum <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> pCons <span class="main">0</span> <span class="main">(</span><span class="free">f</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="free">S</span> <span class="main">=</span> pCons <span class="main">0</span> <span class="main">(</span>sum <span class="free">f</span> <span class="free">S</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">S</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> infinite_finite_induct<span class="main"><span class="keyword3">;</span></span><span class="operator">simp</span><span class="main">)</span>

<span class="keyword1" id="Missing_Polynomial-pCons_0_as_mult"><span class="command">lemma</span></span> pCons_0_as_mult<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> comm_semiring_1 poly"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"pCons <span class="main">0</span> <span class="free">p</span> <span class="main">=</span> <span class="main">[:</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span> <span class="main">*</span> <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>



<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Misc›</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">expand_powers</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>nat <span class="main">×</span> <span class="tfree">'a</span><span class="main">)</span>list <span class="main">⇒</span> <span class="tfree">'a</span> list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">expand_powers</span> <span class="main">[]</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">expand_powers</span> <span class="main">(</span><span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">ps</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">#</span> <span class="free">expand_powers</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">ps</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">expand_powers</span> <span class="main">(</span><span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">ps</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">expand_powers</span> <span class="free"><span class="bound"><span class="entity">ps</span></span></span>"</span></span>

<span class="keyword1" id="Missing_Polynomial-expand_powers"><span class="command">lemma</span></span> expand_powers<span class="main">:</span> <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span> <span class="main">::</span> comm_ring_1"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∏</span> <span class="main">(</span><span class="bound">n</span><span class="main">,</span><span class="bound">a</span><span class="main">)</span> <span class="main">←</span> <span class="free">n_as</span><span class="main">.</span> <span class="free">f</span> <span class="bound">a</span> <span class="main">^</span> <span class="bound">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span> <span class="bound">a</span> <span class="main">←</span> expand_powers <span class="free">n_as</span><span class="main">.</span> <span class="free">f</span> <span class="bound">a</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sym<span class="main"><span class="keyword3">,</span></span> <span class="operator">induct</span> <span class="quoted"><span class="free">n_as</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> expand_powers.induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="Missing_Polynomial-poly_smult_zero_iff"><span class="command">lemma</span></span> poly_smult_zero_iff<span class="main">:</span> <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> idom"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>poly <span class="main">(</span>smult <span class="free">a</span> <span class="free">p</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">a</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> poly <span class="free">p</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Missing_Polynomial-poly_prod_list_zero_iff"><span class="command">lemma</span></span> poly_prod_list_zero_iff<span class="main">:</span> <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> idom"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>poly <span class="main">(</span>prod_list <span class="free">ps</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">p</span> <span class="main">∈</span> set <span class="free">ps</span><span class="main">.</span> poly <span class="bound">p</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">ps</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="Missing_Polynomial-poly_mult_zero_iff"><span class="command">lemma</span></span> poly_mult_zero_iff<span class="main">:</span> <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> idom"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>poly <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>poly <span class="free">p</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> poly <span class="free">q</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Missing_Polynomial-poly_power_zero_iff"><span class="command">lemma</span></span> poly_power_zero_iff<span class="main">:</span> <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> idom"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>poly <span class="main">(</span><span class="free">p</span><span class="main">^</span><span class="free">n</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">n</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> poly <span class="free">p</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">n</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>


<span class="keyword1" id="Missing_Polynomial-sum_monom_0_iff"><span class="command">lemma</span></span> sum_monom_0_iff<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> fin<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">S</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> g<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">i</span> <span class="bound">j</span><span class="main">.</span> <span class="free">g</span> <span class="bound">i</span> <span class="main">=</span> <span class="free">g</span> <span class="bound">j</span> <span class="main">⟹</span> <span class="bound">i</span> <span class="main">=</span> <span class="bound">j</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"sum <span class="main">(</span><span class="main">λ</span> <span class="bound">i</span><span class="main">.</span> monom <span class="main">(</span><span class="free">f</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="free">g</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="free">S</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">i</span> <span class="main">∈</span> <span class="free">S</span><span class="main">.</span> <span class="free">f</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">=</span> <span class="var">?r</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="var">?r</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> fi<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">i</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?g</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">i</span><span class="main">.</span> monom <span class="main">(</span><span class="free">f</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="free">g</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coeff <span class="main">(</span>sum <span class="var">?g</span> <span class="free">S</span><span class="main">)</span> <span class="main">(</span><span class="free">g</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="skolem">i</span> <span class="main">+</span> sum <span class="main">(</span><span class="main">λ</span> <span class="bound">j</span><span class="main">.</span> coeff <span class="main">(</span><span class="var">?g</span> <span class="bound">j</span><span class="main">)</span> <span class="main">(</span><span class="free">g</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">S</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">i</span><span class="main">}</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> sum.remove<span class="main"><span class="main">[</span></span><span class="operator">OF</span> fin i<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> coeff_sum<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum <span class="main">(</span><span class="main">λ</span> <span class="bound">j</span><span class="main">.</span> coeff <span class="main">(</span><span class="var">?g</span> <span class="bound">j</span><span class="main">)</span> <span class="main">(</span><span class="free">g</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">S</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">i</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.neutral<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> g<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coeff <span class="main">(</span>sum <span class="var">?g</span> <span class="free">S</span><span class="main">)</span> <span class="main">(</span><span class="free">g</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> fi <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="var">?l</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Missing_Polynomial-degree_prod_list_eq"><span class="command">lemma</span></span> degree_prod_list_eq<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">p</span><span class="main">.</span> <span class="bound">p</span> <span class="main">∈</span> set <span class="free">ps</span> <span class="main">⟹</span> <span class="main">(</span><span class="bound">p</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> idom poly<span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span>prod_list <span class="free">ps</span><span class="main">)</span> <span class="main">=</span> sum_list <span class="main">(</span>map degree <span class="free">ps</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">ps</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">p</span> <span class="skolem">ps</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> prod_list.Cons
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> degree_mult_eq<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> Cons<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> prod_list_zero_iff<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Missing_Polynomial-degree_power_eq"><span class="command">lemma</span></span> degree_power_eq<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span><span class="free">p</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> degree <span class="main">(</span><span class="free">p</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> idom poly<span class="main">)</span> <span class="main">*</span> <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> p <span class="keyword1"><span class="command">have</span></span> pn<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">^</span> <span class="skolem">n</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> degree_mult_eq<span class="main">[</span><span class="operator">OF</span> p pn<span class="main">]</span> Suc <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Missing_Polynomial-coeff_Poly"><span class="command">lemma</span></span> coeff_Poly<span class="main">:</span> <span class="quoted"><span class="quoted">"coeff <span class="main">(</span>Poly <span class="free">xs</span><span class="main">)</span> <span class="free">i</span> <span class="main">=</span> <span class="main">(</span>nth_default <span class="main">0</span> <span class="free">xs</span> <span class="free">i</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> nth_default_coeffs_eq<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"Poly <span class="free">xs</span>"</span></span><span class="main">,</span> <span class="operator">symmetric</span><span class="main">]</span> coeffs_Poly <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Missing_Polynomial-rsquarefree_def'"><span class="command">lemma</span></span> rsquarefree_def'<span class="main">:</span> <span class="quoted"><span class="quoted">"rsquarefree <span class="free">p</span> <span class="main">=</span> <span class="main">(</span><span class="free">p</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">a</span><span class="main">.</span> order <span class="bound">a</span> <span class="free">p</span> <span class="main">≤</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">a</span><span class="main">.</span> order <span class="bound">a</span> <span class="free">p</span> <span class="main">≤</span> <span class="main">1</span> <span class="main">⟷</span> order <span class="bound">a</span> <span class="free">p</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> order <span class="bound">a</span> <span class="free">p</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> rsquarefree_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Missing_Polynomial-order_prod_list"><span class="command">lemma</span></span> order_prod_list<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span> <span class="bound">p</span><span class="main">.</span> <span class="bound">p</span> <span class="main">∈</span> set <span class="free">ps</span> <span class="main">⟹</span> <span class="bound">p</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">⟹</span> order <span class="free">x</span> <span class="main">(</span>prod_list <span class="free">ps</span><span class="main">)</span> <span class="main">=</span> sum_list <span class="main">(</span>map <span class="main">(</span>order <span class="free">x</span><span class="main">)</span> <span class="free">ps</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">ps</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> order_mult<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> prod_list_zero_iff<span class="main">)</span>

<span class="keyword1" id="Missing_Polynomial-irreducible"><span class="command">lemma</span></span> irreducible<span class="hidden">⇩</span><sub>d</sub>_dvd_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">a</span> <span class="free">b</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>comm_semiring_1<span class="main">,</span>semiring_no_zero_divisors<span class="main">}</span> poly"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"irreducible<span class="hidden">⇩</span><sub>d</sub> <span class="free">a</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"irreducible<span class="hidden">⇩</span><sub>d</sub> <span class="free">b</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="keyword1">dvd</span> <span class="free">b</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"monic <span class="free">a</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"monic <span class="free">b</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> coeff_smult degree_smult_eq irreducible<span class="hidden">⇩</span><sub>d</sub>D<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> irreducible<span class="hidden">⇩</span><sub>d</sub>_dvd_smult 
    mult.right_neutral smult_1_left<span class="main">)</span>

<span class="keyword1" id="Missing_Polynomial-monic_gcd_dvd"><span class="command">lemma</span></span> monic_gcd_dvd<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> fg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">dvd</span> <span class="free">g</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> mon<span class="main">:</span> <span class="quoted"><span class="quoted">"monic <span class="free">f</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> gcd<span class="main">:</span> <span class="quoted"><span class="quoted">"gcd <span class="free">g</span> <span class="free">h</span> <span class="main">∈</span> <span class="main">{</span><span class="main">1</span><span class="main">,</span> <span class="free">g</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"gcd <span class="free">f</span> <span class="free">h</span> <span class="main">∈</span> <span class="main">{</span><span class="main">1</span><span class="main">,</span> <span class="free">f</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"coprime <span class="free">g</span> <span class="free">h</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">with</span></span> dvd_refl <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coprime <span class="free">f</span> <span class="free">h</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> fg <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> coprime_divisors<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">with</span></span> gcd <span class="keyword1"><span class="command">have</span></span> gcd<span class="main">:</span> <span class="quoted"><span class="quoted">"gcd <span class="free">g</span> <span class="free">h</span> <span class="main">=</span> <span class="free">g</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> coprime_iff_gcd_eq_1<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> fg <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">dvd</span> gcd <span class="free">g</span> <span class="free">h</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">dvd</span> <span class="free">h</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"gcd <span class="free">f</span> <span class="free">h</span> <span class="main">=</span> normalize <span class="free">f</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> gcd_proj1_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"normalize <span class="free">f</span> <span class="main">=</span> <span class="free">f</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> mon <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> normalize_monic<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Missing_Polynomial-monom_power"><span class="command">lemma</span></span> monom_power<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>monom <span class="free">a</span> <span class="free">b</span><span class="main">)</span><span class="main">^</span><span class="free">n</span> <span class="main">=</span> monom <span class="main">(</span><span class="free">a</span><span class="main">^</span><span class="free">n</span><span class="main">)</span> <span class="main">(</span><span class="free">b</span><span class="main">*</span><span class="free">n</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_monom<span class="main">)</span>

<span class="keyword1" id="Missing_Polynomial-poly_const_pow"><span class="command">lemma</span></span> poly_const_pow<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[:</span><span class="free">a</span><span class="main">:]</span><span class="main">^</span><span class="free">b</span> <span class="main">=</span> <span class="main">[:</span><span class="free">a</span><span class="main">^</span><span class="free">b</span><span class="main">:]</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Groups.mult_ac<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> monom_0 monom_power mult_zero_right<span class="main">)</span>

<span class="keyword1" id="Missing_Polynomial-degree_pderiv_le"><span class="command">lemma</span></span> degree_pderiv_le<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span>pderiv <span class="free">f</span><span class="main">)</span> <span class="main">≤</span> degree <span class="free">f</span> <span class="main">-</span> <span class="main">1</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="var">?thesis</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> ge<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span>pderiv <span class="free">f</span><span class="main">)</span> <span class="main">≥</span> Suc <span class="main">(</span>degree <span class="free">f</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"pderiv <span class="free">f</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"coeff <span class="main">(</span>pderiv <span class="free">f</span><span class="main">)</span> <span class="main">(</span>degree <span class="main">(</span>pderiv <span class="free">f</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> this<span class="main">[</span><span class="operator">unfolded</span> coeff_pderiv<span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coeff <span class="free">f</span> <span class="main">(</span>Suc <span class="main">(</span>degree <span class="main">(</span>pderiv <span class="free">f</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span>degree <span class="main">(</span>pderiv <span class="free">f</span><span class="main">)</span><span class="main">)</span> <span class="main">&gt;</span> degree <span class="free">f</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ge <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> coeff_eq_0<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Missing_Polynomial-map_div_is_smult_inverse"><span class="command">lemma</span></span> map_div_is_smult_inverse<span class="main">:</span> <span class="quoted"><span class="quoted">"map_poly <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">/</span> <span class="main">(</span><span class="free">a</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> field<span class="main">)</span><span class="main">)</span> <span class="free">p</span> <span class="main">=</span> smult <span class="main">(</span>inverse <span class="free">a</span><span class="main">)</span> <span class="free">p</span>"</span></span> 
  <span class="keyword1"><span class="command">unfolding</span></span> smult_conv_map_poly
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> divide_inverse_commute<span class="main">)</span>

<span class="keyword1" id="Missing_Polynomial-normalize_poly_old_def"><span class="command">lemma</span></span> normalize_poly_old_def<span class="main">:</span>
  <span class="quoted"><span class="quoted">"normalize <span class="main">(</span><span class="free">f</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>normalization_semidom<span class="main">,</span>field<span class="main">}</span> poly<span class="main">)</span> <span class="main">=</span> smult <span class="main">(</span>inverse <span class="main">(</span>unit_factor <span class="main">(</span>lead_coeff <span class="free">f</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> normalize_poly_eq_map_poly map_div_is_smult_inverse<span class="main">)</span>

<span class="comment1">(* was in Euclidean_Algorithm in Number_Theory before, but has been removed *)</span>
<span class="keyword1" id="Missing_Polynomial-poly_dvd_antisym"><span class="command">lemma</span></span> poly_dvd_antisym<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="free">q</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'b</span><span class="main">::</span>idom poly"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> coeff<span class="main">:</span> <span class="quoted"><span class="quoted">"coeff <span class="free">p</span> <span class="main">(</span>degree <span class="free">p</span><span class="main">)</span> <span class="main">=</span> coeff <span class="free">q</span> <span class="main">(</span>degree <span class="free">q</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> dvd1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="keyword1">dvd</span> <span class="free">q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> dvd2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="keyword1">dvd</span> <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="free">q</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True <span class="keyword1"><span class="command">with</span></span> coeff <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="free">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False <span class="keyword1"><span class="command">with</span></span> coeff <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> degree<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span> <span class="main">=</span> degree <span class="free">q</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="keyword1">dvd</span> <span class="free">q</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">q</span> <span class="keyword1">dvd</span> <span class="free">p</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">q</span> <span class="main">≠</span> <span class="main">0</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> order_antisym dvd_imp_degree_le<span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="keyword1">dvd</span> <span class="free">q</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword">where</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">=</span> <span class="free">p</span> <span class="main">*</span> <span class="skolem">a</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">q</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> degree a <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degree <span class="skolem">a</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> degree_mult_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> coeff a <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="free">q</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">a</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Missing_Polynomial-coeff_f_0_code"><span class="command">lemma</span></span> coeff_f_0_code<span class="main">[</span><span class="operator">code_unfold</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"coeff <span class="free">f</span> <span class="main">0</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> coeffs <span class="free">f</span> <span class="keyword1">of</span> <span class="main">[]</span> <span class="main">⇒</span> <span class="main">0</span> <span class="main">|</span> <span class="bound">x</span> <span class="main">#</span> <span class="main"><span class="bound">_</span></span> <span class="main">⇒</span> <span class="bound">x</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">f</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> cCons_def<span class="main">)</span>

<span class="keyword1" id="Missing_Polynomial-poly_compare_0_code"><span class="command">lemma</span></span> poly_compare_0_code<span class="main">[</span><span class="operator">code_unfold</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> coeffs <span class="free">f</span> <span class="keyword1">of</span> <span class="main">[]</span> <span class="main">⇒</span> True <span class="main">|</span> <span class="main"><span class="bound">_</span></span> <span class="main">⇒</span> False<span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> coeffs_eq_Nil list.disc_eq_case<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Getting more efficient code for abbreviation <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">lead_coeff</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>"›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">leading_coeff</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">code_abbrev</span><span class="main">,</span> <span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">leading_coeff</span> <span class="main">=</span> lead_coeff"</span></span> 

<span class="keyword1" id="Missing_Polynomial-leading_coeff_code"><span class="command">lemma</span></span> leading_coeff_code <span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"leading_coeff <span class="free">f</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span> <span class="bound">xs</span> <span class="main">=</span> coeffs <span class="free">f</span> <span class="keyword1">in</span> <span class="keyword1">if</span> <span class="bound">xs</span> <span class="main">=</span> <span class="main">[]</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> last <span class="bound">xs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> last_coeffs_eq_coeff_degree<span class="main">)</span>

<span class="keyword1" id="Missing_Polynomial-nth_coeffs_coeff"><span class="command">lemma</span></span> nth_coeffs_coeff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> length <span class="main">(</span>coeffs <span class="free">f</span><span class="main">)</span> <span class="main">⟹</span> coeffs <span class="free">f</span> <span class="main">!</span> <span class="free">i</span> <span class="main">=</span> coeff <span class="free">f</span> <span class="free">i</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> nth_default_coeffs_eq nth_default_def<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">monom_mult</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">::</span> comm_semiring_1 poly <span class="main">⇒</span> <span class="tfree">'a</span> poly"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">monom_mult</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">=</span> monom <span class="main">1</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span>"</span></span> 

<span class="keyword1" id="Missing_Polynomial-monom_mult_unfold"><span class="command">lemma</span></span> monom_mult_unfold <span class="main">[</span><span class="operator">code_unfold</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"monom <span class="main">1</span> <span class="free">n</span> <span class="main">*</span> <span class="free">f</span> <span class="main">=</span> monom_mult <span class="free">n</span> <span class="free">f</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">*</span> monom <span class="main">1</span> <span class="free">n</span> <span class="main">=</span> monom_mult <span class="free">n</span> <span class="free">f</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> monom_mult_def <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>

<span class="keyword1" id="Missing_Polynomial-monom_mult_code"><span class="command">lemma</span></span> monom_mult_code <span class="main">[</span><span class="operator">code</span> <span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword">abstract</span></span></span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"coeffs <span class="main">(</span>monom_mult <span class="free">n</span> <span class="free">f</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span> <span class="bound">xs</span> <span class="main">=</span> coeffs <span class="free">f</span> <span class="keyword1">in</span>
    <span class="keyword1">if</span> <span class="bound">xs</span> <span class="main">=</span> <span class="main">[]</span> <span class="keyword1">then</span> <span class="bound">xs</span> <span class="keyword1">else</span> replicate <span class="free">n</span> <span class="main">0</span> <span class="main">@</span> <span class="bound">xs</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> coeffs_eqI<span class="main">)</span>
    <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Let_def monom_mult_def coeff_monom_mult nth_default_append nth_default_coeffs_eq<span class="main">)</span>

<span class="keyword1" id="Missing_Polynomial-coeff_pcompose_monom"><span class="command">lemma</span></span> coeff_pcompose_monom<span class="main">:</span> <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> comm_ring_1 poly"</span></span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"coeff <span class="main">(</span><span class="free">f</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> monom <span class="main">1</span> <span class="free">n</span><span class="main">)</span> <span class="main">(</span><span class="free">n</span> <span class="main">*</span> <span class="free">i</span> <span class="main">+</span> <span class="free">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">j</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> coeff <span class="free">f</span> <span class="free">i</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>     
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">f</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">i</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>pCons <span class="skolem">a</span> <span class="skolem">f</span> <span class="skolem">i</span><span class="main">)</span>
  <span class="keyword1"><span class="command">note</span></span> d <span class="main">=</span> pcompose_pCons coeff_add coeff_monom_mult coeff_pCons
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">i</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 0
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> d 0 <span class="keyword1"><span class="command">using</span></span> n <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">j</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">ii</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">*</span> Suc <span class="skolem">ii</span> <span class="main">+</span> <span class="free">j</span> <span class="main">-</span> <span class="free">n</span> <span class="main">=</span> <span class="free">n</span> <span class="main">*</span> <span class="skolem">ii</span> <span class="main">+</span> <span class="free">j</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> n <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> diff_mult_distrib2<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> id1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">n</span> <span class="main">≤</span> <span class="free">n</span> <span class="main">*</span> Suc <span class="skolem">ii</span> <span class="main">+</span> <span class="free">j</span><span class="main">)</span> <span class="main">=</span> True"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> id2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">case</span> <span class="free">n</span> <span class="main">*</span> Suc <span class="skolem">ii</span> <span class="main">+</span> <span class="free">j</span> <span class="keyword1">of</span> <span class="main">0</span> <span class="main">⇒</span> <span class="skolem">a</span> <span class="main">|</span> Suc <span class="bound">x</span> <span class="main">⇒</span> coeff <span class="main">0</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> n
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">*</span> Suc <span class="skolem">ii</span> <span class="main">+</span> <span class="free">j</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> d Suc id id1 id2 pCons<span class="main">(</span>2<span class="main">)</span> if_True <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Missing_Polynomial-coeff_pcompose_x_pow_n"><span class="command">lemma</span></span> coeff_pcompose_x_pow_n<span class="main">:</span> <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> comm_ring_1 poly"</span></span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"coeff <span class="main">(</span><span class="free">f</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> monom <span class="main">1</span> <span class="free">n</span><span class="main">)</span> <span class="main">(</span><span class="free">n</span> <span class="main">*</span> <span class="free">i</span><span class="main">)</span> <span class="main">=</span> coeff <span class="free">f</span> <span class="free">i</span>"</span></span>     
  <span class="keyword1"><span class="command">using</span></span> coeff_pcompose_monom<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">0</span></span> <span class="quoted"><span class="free">n</span></span> <span class="quoted"><span class="free">f</span></span> <span class="quoted"><span class="free">i</span></span><span class="main">]</span> n <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        
<span class="keyword1" id="Missing_Polynomial-dvd_dvd_smult"><span class="command">lemma</span></span> dvd_dvd_smult<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="keyword1">dvd</span> <span class="free">b</span> <span class="main">⟹</span> <span class="free">f</span> <span class="keyword1">dvd</span> <span class="free">g</span> <span class="main">⟹</span> smult <span class="free">a</span> <span class="free">f</span> <span class="keyword1">dvd</span> smult <span class="free">b</span> <span class="free">g</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> dvd_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult_smult_left mult_smult_right smult_smult<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">sdiv_poly</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> idom_divide poly <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> poly"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">sdiv_poly</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">=</span> <span class="main">(</span>map_poly <span class="main">(</span><span class="main">λ</span> <span class="bound">c</span><span class="main">.</span> <span class="bound">c</span> <span class="keyword1">div</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span>"</span></span>  

<span class="keyword1" id="Missing_Polynomial-smult_map_poly"><span class="command">lemma</span></span> smult_map_poly<span class="main">:</span> <span class="quoted"><span class="quoted">"smult <span class="free">a</span> <span class="main">=</span> map_poly <span class="main">(</span><span class="main">(*)</span> <span class="free">a</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> poly_eqI<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> coeff_map_poly<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  
<span class="keyword1" id="Missing_Polynomial-smult_exact_sdiv_poly"><span class="command">lemma</span></span> smult_exact_sdiv_poly<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">c</span><span class="main">.</span> <span class="bound">c</span> <span class="main">∈</span> set <span class="main">(</span>coeffs <span class="free">p</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">a</span> <span class="keyword1">dvd</span> <span class="bound">c</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"smult <span class="free">a</span> <span class="main">(</span>sdiv_poly <span class="free">p</span> <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="free">p</span>"</span></span> 
  <span class="keyword1"><span class="command">unfolding</span></span> smult_map_poly sdiv_poly_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> map_poly_map_poly<span class="main"><span class="keyword3">,</span></span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span><span class="operator">rule</span> map_poly_idI<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> assms<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="Missing_Polynomial-coeff_sdiv_poly"><span class="command">lemma</span></span> coeff_sdiv_poly<span class="main">:</span> <span class="quoted"><span class="quoted">"coeff <span class="main">(</span>sdiv_poly <span class="free">f</span> <span class="free">a</span><span class="main">)</span> <span class="free">n</span> <span class="main">=</span> coeff <span class="free">f</span> <span class="free">n</span> <span class="keyword1">div</span> <span class="free">a</span>"</span></span> 
  <span class="keyword1"><span class="command">unfolding</span></span> sdiv_poly_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> coeff_map_poly<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>    

<span class="keyword1" id="Missing_Polynomial-poly_pinfty_ge"><span class="command">lemma</span></span> poly_pinfty_ge<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real poly"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"lead_coeff <span class="free">p</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">n</span><span class="main">.</span> <span class="main">∀</span> <span class="bound"><span class="bound">x</span></span> <span class="main">≥</span> <span class="bound">n</span><span class="main">.</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">≥</span> <span class="free">b</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?p</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">-</span> <span class="main">[:</span><span class="free">b</span> <span class="main">-</span> lead_coeff <span class="free">p</span> <span class="main">:]</span>"</span></span> 
  <span class="keyword1"><span class="command">have</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"lead_coeff <span class="var">?p</span> <span class="main">=</span> lead_coeff <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">p</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lead_coeff <span class="var">?p</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> poly_pinfty_gt_lc<span class="main">[</span><span class="operator">OF</span> this<span class="main">,</span> <span class="operator">unfolded</span> id<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span>
    <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≥</span> <span class="skolem">n</span> <span class="main">⟹</span> <span class="main">0</span> <span class="main">≤</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">-</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Missing_Polynomial-pderiv_sum"><span class="command">lemma</span></span> pderiv_sum<span class="main">:</span> <span class="quoted"><span class="quoted">"pderiv <span class="main">(</span>sum <span class="free">f</span> <span class="free">I</span><span class="main">)</span> <span class="main">=</span> sum <span class="main">(</span><span class="main">λ</span> <span class="bound">i</span><span class="main">.</span> <span class="main">(</span>pderiv <span class="main">(</span><span class="free">f</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">I</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">I</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> infinite_finite_induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> pderiv_add<span class="main">)</span>

<span class="keyword1" id="Missing_Polynomial-smult_sum2"><span class="command">lemma</span></span> smult_sum2<span class="main">:</span> <span class="quoted"><span class="quoted">"smult <span class="free">m</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span> <span class="main">∈</span> <span class="free">S</span><span class="main">.</span> <span class="free">f</span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span> <span class="main">∈</span> <span class="free">S</span><span class="main">.</span> smult <span class="free">m</span> <span class="main">(</span><span class="free">f</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">S</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> infinite_finite_induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> smult_add_right<span class="main">)</span>

<span class="keyword1" id="Missing_Polynomial-degree_mult_not_eq"><span class="command">lemma</span></span> degree_mult_not_eq<span class="main">:</span>
  <span class="quoted"><span class="quoted">"degree <span class="main">(</span><span class="free">f</span> <span class="main">*</span> <span class="free">g</span><span class="main">)</span> <span class="main">≠</span> degree <span class="free">f</span> <span class="main">+</span> degree <span class="free">g</span> <span class="main">⟹</span> lead_coeff <span class="free">f</span> <span class="main">*</span> lead_coeff <span class="free">g</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> coeff_mult_degree_sum degree_mult_le le_antisym le_degree<span class="main">)</span>

<span class="keyword1" id="Missing_Polynomial-irreducible"><span class="command">lemma</span></span> irreducible<span class="hidden">⇩</span><sub>d</sub>_multD<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">a</span> <span class="free">b</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>comm_semiring_1<span class="main">,</span>semiring_no_zero_divisors<span class="main">}</span> poly"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> l<span class="main">:</span> <span class="quoted"><span class="quoted">"irreducible<span class="hidden">⇩</span><sub>d</sub> <span class="main">(</span><span class="free">a</span><span class="main">*</span><span class="free">b</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"degree <span class="free">a</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">a</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> irreducible<span class="hidden">⇩</span><sub>d</sub> <span class="free">b</span> <span class="main">∨</span> degree <span class="free">b</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">b</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> irreducible<span class="hidden">⇩</span><sub>d</sub> <span class="free">a</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> l <span class="keyword1"><span class="command">have</span></span> a0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> b0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">note</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span> <span class="main">=</span> degree_mult_eq<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span>
  <span class="keyword1"><span class="command">from</span></span> l <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degree <span class="free">a</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> degree <span class="free">b</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> irreducible<span class="hidden">⇩</span><sub>d</sub>_def<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">elim</span> disjE<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="free">a</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> l a0 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"irreducible<span class="hidden">⇩</span><sub>d</sub> <span class="free">b</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> irreducible<span class="hidden">⇩</span><sub>d</sub>_def<span class="main">)</span>
        <span class="main">(</span><span class="operator">metis</span> degree_mult_eq degree_mult_eq_0 mult.left_commute plus_nat.add_0<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> a a0 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="free">b</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> l b0 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"irreducible<span class="hidden">⇩</span><sub>d</sub> <span class="free">a</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> irreducible<span class="hidden">⇩</span><sub>d</sub>_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> add_cancel_left_right degree_mult_eq degree_mult_eq_0 neq0_conv semiring_normalization_rules<span class="main"><span class="main">(</span></span>16<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> b b0 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Missing_Polynomial-irreducible_connect_field"><span class="command">lemma</span></span> irreducible_connect_field<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> field poly"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"irreducible<span class="hidden">⇩</span><sub>d</sub> <span class="free">f</span> <span class="main">=</span> irreducible <span class="free">f</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">=</span> <span class="var">?r</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?r</span> <span class="main">⟹</span> <span class="var">?l</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> irreducible<span class="hidden">⇩</span><sub>d</sub>I<span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>is_unit_iff_degree<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> irreducible_multD <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> poly_dvd_1<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> l<span class="main">:</span> <span class="var"><span class="quoted"><span class="var">?l</span></span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?r</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> irreducibleI<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> l <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_unit <span class="free">f</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> poly_dvd_1<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">=</span> <span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> l<span class="main">[</span><span class="operator">unfolded</span> this<span class="main">]</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="keyword1">dvd</span> <span class="main">1</span> <span class="main">∨</span> <span class="skolem">b</span> <span class="keyword1">dvd</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> irreducible<span class="hidden">⇩</span><sub>d</sub>_multD <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>is_unit_iff_degree<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Missing_Polynomial-is_unit_field_poly"><span class="command">lemma</span></span> is_unit_field_poly<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>field poly"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_unit <span class="free">p</span> <span class="main">⟷</span> <span class="free">p</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> degree <span class="free">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">=</span><span class="main">0</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> is_unit_iff_degree<span class="main">)</span>

<span class="keyword1" id="Missing_Polynomial-irreducible_smult_field"><span class="command">lemma</span></span> irreducible_smult_field<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">c</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> field"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"irreducible <span class="main">(</span>smult <span class="free">c</span> <span class="free">p</span><span class="main">)</span> <span class="main">⟷</span> <span class="free">c</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> irreducible <span class="free">p</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L</span> <span class="main">⟷</span> <span class="var">?R</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> iffI conjI irreducible<span class="hidden">⇩</span><sub>d</sub>_smult_not_zero_divisor_left<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">c</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">p</span></span></span></span><span class="main"><span class="main">,</span></span> <span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"irreducible <span class="main">(</span>smult <span class="free">c</span> <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?R</span></span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> c0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> irr<span class="main">:</span> <span class="quoted"><span class="quoted">"irreducible <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?L</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">fold</span> irreducible_connect_field<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> irreducible<span class="hidden">⇩</span><sub>d</sub>I<span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> degree_smult_eq if_not_P<span class="main"><span class="main">[</span></span><span class="operator">OF</span> c0<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> irr <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">q</span> <span class="skolem">r</span>
    <span class="keyword1"><span class="command">from</span></span> c0 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> smult <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="free">c</span><span class="main">)</span> <span class="main">(</span>smult <span class="free">c</span> <span class="free">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"smult <span class="free">c</span> <span class="free">p</span> <span class="main">=</span> <span class="skolem">q</span> <span class="main">*</span> <span class="skolem">r</span>"</span></span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> smult <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="free">c</span><span class="main">)</span> <span class="main">…</span>"</span></span><span class="keyword1"><span class="command">.</span></span>
    <span class="keyword3"><span class="command">assume</span></span> main<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="skolem">q</span> <span class="main">&lt;</span> degree <span class="free">p</span>"</span></span> <span class="quoted"><span class="quoted">"degree <span class="skolem">r</span> <span class="main">&lt;</span> degree <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>irreducible<span class="hidden">⇩</span><sub>d</sub> <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> reducible<span class="hidden">⇩</span><sub>d</sub>I<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"smult <span class="main"><span class="main"><span class="main">(</span></span></span><span class="main"><span class="main"><span class="main">1</span></span></span><span class="main"><span class="main"><span class="main">/</span></span></span><span class="free"><span class="free"><span class="free">c</span></span></span><span class="main"><span class="main"><span class="main">)</span></span></span> <span class="skolem"><span class="skolem"><span class="skolem">q</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">r</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> irr c0 main<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> irr <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Missing_Polynomial-irreducible_monic_factor"><span class="command">lemma</span></span> irreducible_monic_factor<span class="main">:</span> <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> field poly"</span></span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">q</span> <span class="bound">r</span><span class="main">.</span> irreducible <span class="bound">q</span> <span class="main">∧</span> <span class="free">p</span> <span class="main">=</span> <span class="bound">q</span> <span class="main">*</span> <span class="bound">r</span> <span class="main">∧</span> monic <span class="bound">q</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> irreducible<span class="hidden">⇩</span><sub>d</sub>_factorization_exists<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">fs</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">fs</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"set <span class="skolem">fs</span> <span class="main">⊆</span> Collect irreducible"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> prod_list <span class="skolem">fs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> q<span class="main">:</span> <span class="quoted"><span class="quoted">"irreducible <span class="main">(</span>hd <span class="skolem">fs</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> hd <span class="skolem">fs</span> <span class="main">*</span> prod_list <span class="main">(</span>tl <span class="skolem">fs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">atomize</span><span class="main"><span class="main">(</span></span><span class="quasi_keyword">full</span><span class="main"><span class="main">)</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">fs</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">=</span> coeff <span class="main">(</span>hd <span class="skolem">fs</span><span class="main">)</span> <span class="main">(</span>degree <span class="main">(</span>hd <span class="skolem">fs</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> q <span class="keyword1"><span class="command">have</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> c_def irreducible<span class="hidden">⇩</span><sub>d</sub>_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"smult <span class="main"><span class="main"><span class="main">(</span></span></span><span class="main"><span class="main"><span class="main">1</span></span></span><span class="main"><span class="main"><span class="main">/</span></span></span><span class="skolem"><span class="skolem"><span class="skolem">c</span></span></span><span class="main"><span class="main"><span class="main">)</span></span></span> <span class="main"><span class="main"><span class="main">(</span></span></span>hd <span class="skolem"><span class="skolem"><span class="skolem">fs</span></span></span><span class="main"><span class="main"><span class="main">)</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"smult <span class="skolem"><span class="skolem"><span class="skolem">c</span></span></span> <span class="main"><span class="main"><span class="main">(</span></span></span>prod_list <span class="main"><span class="main"><span class="main">(</span></span></span>tl <span class="skolem"><span class="skolem"><span class="skolem">fs</span></span></span><span class="main"><span class="main"><span class="main">)</span></span></span><span class="main"><span class="main"><span class="main">)</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> p<span class="main"><span class="keyword3">,</span></span>
    <span class="operator">insert</span> q c<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> c_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Missing_Polynomial-monic_irreducible_factorization"><span class="command">lemma</span></span> monic_irreducible_factorization<span class="main">:</span> <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> field poly"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"monic <span class="free">p</span> <span class="main">⟹</span> 
  <span class="main">∃</span> <span class="bound">as</span> <span class="bound">f</span><span class="main">.</span> finite <span class="bound">as</span> <span class="main">∧</span> <span class="free">p</span> <span class="main">=</span> prod <span class="main">(</span><span class="main">λ</span> <span class="bound">a</span><span class="main">.</span> <span class="bound">a</span> <span class="main">^</span> Suc <span class="main">(</span><span class="bound">f</span> <span class="bound">a</span><span class="main">)</span><span class="main">)</span> <span class="bound">as</span> <span class="main">∧</span> <span class="bound">as</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound">q</span><span class="main">.</span> irreducible <span class="bound">q</span> <span class="main">∧</span> monic <span class="bound">q</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span>"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> less_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>less <span class="skolem">p</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"degree <span class="skolem">p</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">with</span></span> less<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> coeff_eq_0 poly_eq_iff<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">{}</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">from</span></span> irreducible<span class="hidden">⇩</span><sub>d</sub>_factor<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="keyword2"><span class="keyword">where</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> <span class="skolem">q</span> <span class="main">*</span> <span class="skolem">r</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> q<span class="main">:</span> <span class="quoted"><span class="quoted">"irreducible <span class="skolem">q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> deg<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="skolem">r</span> <span class="main">&lt;</span> degree <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> q0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">=</span> coeff <span class="skolem">q</span> <span class="main">(</span>degree <span class="skolem">q</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?q</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"smult <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="skolem">c</span><span class="main">)</span> <span class="skolem">q</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?r</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"smult <span class="skolem">c</span> <span class="skolem">r</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> q0 <span class="keyword1"><span class="command">have</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">/</span> <span class="skolem">c</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> c_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> <span class="var">?q</span> <span class="main">*</span> <span class="var">?r</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> p <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> deg<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="var">?r</span> <span class="main">&lt;</span> degree <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> c deg <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?Q</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">q</span><span class="main">.</span> irreducible <span class="bound">q</span> <span class="main">∧</span> monic <span class="main">(</span><span class="bound">q</span> <span class="main">::</span> <span class="tfree">'a</span> poly<span class="main">)</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> mon<span class="main">:</span> <span class="quoted"><span class="quoted">"monic <span class="var">?q</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> c_def <span class="keyword1"><span class="command">using</span></span> q0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> monic_factor<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹monic <span class="skolem">p</span>›</span></span><span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> p<span class="main"><span class="main">]</span></span> this<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"monic <span class="var">?r</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">from</span></span> less<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> deg this<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="skolem"><span class="skolem">as</span></span>
      <span class="keyword2"><span class="keyword">where</span></span> as<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="skolem">as</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?r</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span> <span class="bound">a</span> <span class="main">∈</span><span class="skolem">as</span><span class="main">.</span> <span class="bound">a</span> <span class="main">^</span> Suc <span class="main">(</span><span class="skolem">f</span> <span class="bound">a</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="quoted"><span class="quoted">"<span class="skolem">as</span> <span class="main">⊆</span> <span class="var">?Q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> q c <span class="keyword1"><span class="command">have</span></span> irred<span class="main">:</span> <span class="quoted"><span class="quoted">"irreducible <span class="var">?q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="var">?q</span> <span class="main">∈</span> <span class="skolem">as</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?as</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"insert <span class="var">?q</span> <span class="skolem">as</span>"</span></span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">a</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">a</span> <span class="main">=</span> <span class="var">?q</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="skolem">f</span> <span class="bound">a</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> <span class="var">?q</span> <span class="main">*</span> <span class="main">(</span><span class="main">∏</span> <span class="bound">a</span> <span class="main">∈</span><span class="skolem">as</span><span class="main">.</span> <span class="bound">a</span> <span class="main">^</span> Suc <span class="main">(</span><span class="skolem">f</span> <span class="bound">a</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> p as <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∏</span> <span class="bound">a</span> <span class="main">∈</span><span class="skolem">as</span><span class="main">.</span> <span class="bound">a</span> <span class="main">^</span> Suc <span class="main">(</span><span class="skolem">f</span> <span class="bound">a</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span> <span class="bound">a</span> <span class="main">∈</span><span class="skolem">as</span><span class="main">.</span> <span class="bound">a</span> <span class="main">^</span> Suc <span class="main">(</span><span class="var">?f</span> <span class="bound">a</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> prod.cong<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> False<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?q</span> <span class="main">*</span> <span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span> <span class="bound">a</span> <span class="main">∈</span> <span class="var">?as</span><span class="main">.</span> <span class="bound">a</span> <span class="main">^</span> Suc <span class="main">(</span><span class="var">?f</span> <span class="bound">a</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> prod.insert<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> as False<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span> <span class="bound">a</span> <span class="main">∈</span> <span class="var">?as</span><span class="main">.</span> <span class="bound">a</span> <span class="main">^</span> Suc <span class="main">(</span><span class="var">?f</span> <span class="bound">a</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">from</span></span> as<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> fin<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="var">?as</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> as mon irred <span class="keyword1"><span class="command">have</span></span> Q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?as</span> <span class="main">⊆</span> <span class="var">?Q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> fin p Q <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
        <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="var"><span class="quoted"><span class="var"><span class="quoted"><span class="var"><span class="quoted"><span class="var">?as</span></span></span></span></span></span></span><span class="main"><span class="main">]</span></span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="var"><span class="quoted"><span class="var"><span class="quoted"><span class="var"><span class="quoted"><span class="var">?f</span></span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">a</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">a</span> <span class="main">=</span> <span class="var">?q</span> <span class="keyword1">then</span> Suc <span class="main">(</span><span class="skolem">f</span> <span class="bound">a</span><span class="main">)</span> <span class="keyword1">else</span> <span class="skolem">f</span> <span class="bound">a</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> <span class="var">?q</span> <span class="main">*</span> <span class="main">(</span><span class="main">∏</span> <span class="bound">a</span> <span class="main">∈</span><span class="skolem">as</span><span class="main">.</span> <span class="bound">a</span> <span class="main">^</span> Suc <span class="main">(</span><span class="skolem">f</span> <span class="bound">a</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> p as <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∏</span> <span class="bound">a</span> <span class="main">∈</span><span class="skolem">as</span><span class="main">.</span> <span class="bound">a</span> <span class="main">^</span> Suc <span class="main">(</span><span class="skolem">f</span> <span class="bound">a</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="var">?q</span> <span class="main">^</span> Suc <span class="main">(</span><span class="skolem">f</span> <span class="var">?q</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∏</span> <span class="bound">a</span> <span class="main">∈</span><span class="main">(</span><span class="skolem">as</span> <span class="main">-</span> <span class="main">{</span><span class="var">?q</span><span class="main">}</span><span class="main">)</span><span class="main">.</span> <span class="bound">a</span> <span class="main">^</span> Suc <span class="main">(</span><span class="skolem">f</span> <span class="bound">a</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> prod.remove<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ True<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> as<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∏</span> <span class="bound">a</span> <span class="main">∈</span><span class="main">(</span><span class="skolem">as</span> <span class="main">-</span> <span class="main">{</span><span class="var">?q</span><span class="main">}</span><span class="main">)</span><span class="main">.</span> <span class="bound">a</span> <span class="main">^</span> Suc <span class="main">(</span><span class="skolem">f</span> <span class="bound">a</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span> <span class="bound">a</span> <span class="main">∈</span><span class="main">(</span><span class="skolem">as</span> <span class="main">-</span> <span class="main">{</span><span class="var">?q</span><span class="main">}</span><span class="main">)</span><span class="main">.</span> <span class="bound">a</span> <span class="main">^</span> Suc <span class="main">(</span><span class="var">?f</span> <span class="bound">a</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> prod.cong<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?q</span> <span class="main">*</span> <span class="main">(</span><span class="var">?q</span> <span class="main">^</span> Suc <span class="main">(</span><span class="skolem">f</span> <span class="var">?q</span><span class="main">)</span> <span class="main">*</span> <span class="main">…</span> <span class="main">)</span> <span class="main">=</span> <span class="var">?q</span> <span class="main">^</span> Suc <span class="main">(</span><span class="var">?f</span> <span class="var">?q</span><span class="main">)</span> <span class="main">*</span> <span class="main">…</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span> <span class="bound">a</span> <span class="main">∈</span> <span class="skolem">as</span><span class="main">.</span> <span class="bound">a</span> <span class="main">^</span> Suc <span class="main">(</span><span class="var">?f</span> <span class="bound">a</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> prod.remove<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ True<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> as<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span> <span class="bound">a</span> <span class="main">∈</span> <span class="skolem">as</span><span class="main">.</span> <span class="bound">a</span> <span class="main">^</span> Suc <span class="main">(</span><span class="var">?f</span> <span class="bound">a</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">with</span></span> as <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">as</span></span></span></span></span></span><span class="main"><span class="main">]</span></span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="var"><span class="quoted"><span class="var"><span class="quoted"><span class="var"><span class="quoted"><span class="var">?f</span></span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Missing_Polynomial-monic_irreducible_gcd"><span class="command">lemma</span></span> monic_irreducible_gcd<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"monic <span class="main">(</span><span class="free">f</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">,</span>euclidean_ring_gcd<span class="main">,</span>semiring_gcd_mult_normalize<span class="main">,</span>
                  normalization_euclidean_semiring_multiplicative<span class="main">}</span> poly<span class="main">)</span> <span class="main">⟹</span>
   irreducible <span class="free">f</span> <span class="main">⟹</span> gcd <span class="free">f</span> <span class="free">u</span> <span class="main">∈</span> <span class="main">{</span><span class="main">1</span><span class="main">,</span><span class="free">f</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> gcd_dvd1 irreducible_altdef insertCI is_unit_gcd_iff poly_dvd_antisym poly_gcd_monic<span class="main">)</span>
<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Ring_Hom_Poly">
<div class="head">
<h1>Theory Ring_Hom_Poly</h1>
</div>
<pre class="source"><span class="comment1">(*  
    Author:      René Thiemann 
                 Akihisa Yamada
    License:     BSD
*)</span>
<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Connecting Polynomials with Homomorphism Locales›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Ring_Hom_Poly
<span class="keyword2"><span class="keyword">imports</span></span> 
  <span class="quoted">"<a href="https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL-Computational_Algebra/Euclidean_Algorithm.html">HOL-Computational_Algebra.Euclidean_Algorithm</a>"</span>
  <a href="#Ring_Hom">Ring_Hom</a>
  <a href="#Missing_Polynomial">Missing_Polynomial</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">poly</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> as a homomorphism. Note that types differ.›</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> poly_hom<span class="main">:</span> comm_semiring_hom <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">p</span><span class="main">.</span> poly <span class="bound">p</span> <span class="free">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">interpretation</span></span> poly_hom<span class="main">:</span> comm_ring_hom <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">p</span><span class="main">.</span> poly <span class="bound">p</span> <span class="free">a</span>"</span></span><span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> poly_hom<span class="main">:</span> idom_hom <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">p</span><span class="main">.</span> poly <span class="bound">p</span> <span class="free">a</span>"</span></span><span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="keyword1">(∘<span class="hidden">⇩</span><sub>p</sub>)</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> as a homomorphism.›</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> pcompose_hom<span class="main">:</span> comm_semiring_hom <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">q</span><span class="main">.</span> <span class="bound">q</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> pcompose_add pcompose_mult pcompose_1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">interpretation</span></span> pcompose_hom<span class="main">:</span> comm_ring_hom <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">q</span><span class="main">.</span> <span class="bound">q</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> pcompose_hom<span class="main">:</span> idom_hom <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">q</span><span class="main">.</span> <span class="bound">q</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>



<span class="keyword1"><span class="command">definition</span></span> <span class="entity">eval_poly</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span> <span class="main">::</span> comm_semiring_1<span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">::</span> zero poly <span class="main">⇒</span> <span class="tfree">'b</span> <span class="main">⇒</span> <span class="tfree">'b</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="main">[</span><span class="operator">code</span> <span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword">del</span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">eval_poly</span> <span class="free"><span class="bound"><span class="entity">h</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> poly <span class="main">(</span>map_poly <span class="free"><span class="bound"><span class="entity">h</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Ring_Hom_Poly-eval_poly_code"><span class="command">lemma</span></span> eval_poly_code<span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"eval_poly <span class="free">h</span> <span class="free">p</span> <span class="free">x</span> <span class="main">=</span> fold_coeffs <span class="main">(</span><span class="main">λ</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="free">h</span> <span class="bound">a</span> <span class="main">+</span> <span class="free">x</span> <span class="main">*</span> <span class="bound">b</span><span class="main">)</span> <span class="free">p</span> <span class="main">0</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> eval_poly_def<span class="main">)</span>

<span class="keyword1" id="Ring_Hom_Poly-eval_poly_as_sum"><span class="command">lemma</span></span> eval_poly_as_sum<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">h</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> zero <span class="main">⇒</span> <span class="tfree">'b</span> <span class="main">::</span> comm_semiring_1"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"eval_poly <span class="free">h</span> <span class="free">p</span> <span class="free">x</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">≤</span>degree <span class="free">p</span><span class="main">.</span> <span class="free">x</span><span class="main">^</span><span class="bound">i</span> <span class="main">*</span> <span class="free">h</span> <span class="main">(</span>coeff <span class="free">p</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> eval_poly_def
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span> <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>pCons <span class="skolem">a</span> <span class="skolem">p</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> True map_poly_simps assms<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span> <span class="keyword3"><span class="command">case</span></span> False <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> degree_pCons_eq<span class="main">[</span><span class="operator">OF</span> False<span class="main">]</span>
        <span class="keyword1"><span class="command">unfolding</span></span> sum.atMost_Suc_shift
        <span class="keyword1"><span class="command">unfolding</span></span> map_poly_pCons<span class="main">[</span><span class="operator">OF</span> pCons<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pCons<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> sum_distrib_left mult.assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Ring_Hom_Poly-coeff_const"><span class="command">lemma</span></span> coeff_const<span class="main">:</span> <span class="quoted"><span class="quoted">"coeff <span class="main">[:</span> <span class="free">a</span> <span class="main">:]</span> <span class="free">i</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">i</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="free">a</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> coeff_monom monom_0<span class="main">)</span>

<span class="keyword1" id="Ring_Hom_Poly-x_as_monom"><span class="command">lemma</span></span> x_as_monom<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[:</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span> <span class="main">=</span> monom <span class="main">1</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> monom_0 monom_Suc<span class="main">)</span>

<span class="keyword1" id="Ring_Hom_Poly-x_pow_n"><span class="command">lemma</span></span> x_pow_n<span class="main">:</span> <span class="quoted"><span class="quoted">"monom <span class="main">1</span> <span class="main">1</span> <span class="main">^</span> <span class="free">n</span> <span class="main">=</span> monom <span class="main">1</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> monom_0 monom_Suc<span class="main">)</span>

<span class="keyword1" id="Ring_Hom_Poly-map_poly_eval_poly"><span class="command">lemma</span></span> map_poly_eval_poly<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> h0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"map_poly <span class="free">h</span> <span class="free">p</span> <span class="main">=</span> eval_poly <span class="main">(</span><span class="main">λ</span> <span class="bound">a</span><span class="main">.</span> <span class="main">[:</span> <span class="free">h</span> <span class="bound">a</span> <span class="main">:]</span><span class="main">)</span> <span class="free">p</span> <span class="main">[:</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?mp</span> <span class="main">=</span> <span class="var">?ep</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> poly_eqI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="main">::</span> <span class="quoted">nat</span>
  <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">≤</span><span class="skolem">i</span><span class="main">.</span> <span class="main">∑</span><span class="bound">xa</span><span class="main">≤</span>degree <span class="free">p</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">xa</span> <span class="main">=</span> <span class="bound">x</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span> <span class="main">*</span> coeff <span class="main">[:</span><span class="free">h</span> <span class="main">(</span>coeff <span class="free">p</span> <span class="bound">xa</span><span class="main">)</span><span class="main">:]</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> 
    <span class="main">=</span> <span class="free">h</span> <span class="main">(</span>coeff <span class="free">p</span> <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"sum <span class="var">?f</span> <span class="var">?s</span> <span class="main">=</span> <span class="var">?r</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum <span class="var">?f</span> <span class="var">?s</span> <span class="main">=</span> <span class="var">?f</span> <span class="skolem">i</span> <span class="main">+</span> sum <span class="var">?f</span> <span class="main">(</span><span class="main">{..</span><span class="skolem">i</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">i</span><span class="main">}</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.remove<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">i</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum <span class="var">?f</span> <span class="main">(</span><span class="main">{..</span><span class="skolem">i</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">i</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.neutral<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> ballI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> sum.neutral<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> coeff_const<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?f</span> <span class="skolem">i</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">xa</span><span class="main">≤</span>degree <span class="free">p</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">xa</span> <span class="main">=</span> <span class="skolem">i</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span> <span class="main">*</span> <span class="free">h</span> <span class="main">(</span>coeff <span class="free">p</span> <span class="bound">xa</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> <span class="var">?m</span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">unfolding</span></span> coeff_const <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="var">?r</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≤</span> degree <span class="free">p</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> sum.remove<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">i</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> True<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">hence</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"coeff <span class="free">p</span> <span class="skolem">i</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> le_degree <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> sum.neutral<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> h0<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> h'0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[:</span> <span class="free">h</span> <span class="main">0</span> <span class="main">:]</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> h0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"coeff <span class="var">?mp</span> <span class="skolem">i</span> <span class="main">=</span> coeff <span class="var">?ep</span> <span class="skolem">i</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> coeff_map_poly<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">h</span></span><span class="main">,</span> <span class="operator">OF</span> h0<span class="main">]</span>
    <span class="keyword1"><span class="command">unfolding</span></span> eval_poly_as_sum<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="main">[:</span> <span class="free">h</span> <span class="bound">a</span> <span class="main">:]</span>"</span></span><span class="main">,</span> <span class="operator">OF</span> h'0<span class="main">]</span>
    <span class="keyword1"><span class="command">unfolding</span></span> coeff_sum
    <span class="keyword1"><span class="command">unfolding</span></span> x_as_monom x_pow_n coeff_mult
    <span class="keyword1"><span class="command">unfolding</span></span> sum.swap<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="main">_</span> <span class="quoted"><span class="quoted">"<span class="main">{..</span>degree <span class="free">p</span><span class="main">}</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">unfolding</span></span> coeff_monom <span class="keyword1"><span class="command">using</span></span> 2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Ring_Hom_Poly-smult_as_map_poly"><span class="command">lemma</span></span> smult_as_map_poly<span class="main">:</span> <span class="quoted"><span class="quoted">"smult <span class="free">a</span> <span class="main">=</span> map_poly <span class="main">(</span><span class="main">(*)</span> <span class="free">a</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> poly_eqI<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> coeff_map_poly<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> map_poly<span class="antiquote"><span class="antiquote">}</span></span></span></span> of Homomorphisms›</span></span>

<span class="keyword1"><span class="command">context</span></span> zero_hom <span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We will consider <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">hom</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is always simpler than <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"map_poly <span class="free"><span class="free">hom</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.›</span></span>
  <span class="keyword1" id="Ring_Hom_Poly-map_poly_hom_monom"><span class="command">lemma</span></span> map_poly_hom_monom<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"map_poly <span class="free">hom</span> <span class="main">(</span>monom <span class="free">a</span> <span class="free">i</span><span class="main">)</span> <span class="main">=</span> monom <span class="main">(</span><span class="free">hom</span> <span class="free">a</span><span class="main">)</span> <span class="free">i</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">rule</span> map_poly_monom<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1" id="Ring_Hom_Poly-coeff_map_poly_hom"><span class="command">lemma</span></span> coeff_map_poly_hom<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"coeff <span class="main">(</span>map_poly <span class="free">hom</span> <span class="free">p</span><span class="main">)</span> <span class="free">i</span> <span class="main">=</span> <span class="free">hom</span> <span class="main">(</span>coeff <span class="free">p</span> <span class="free">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> coeff_map_poly<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> hom_zero<span class="main">)</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">locale</span></span> map_poly_zero_hom <span class="main">=</span> base<span class="main">:</span> zero_hom
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">sublocale</span></span> zero_hom <span class="quoted"><span class="quoted">"map_poly <span class="free">hom</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> map_poly<span class="antiquote"><span class="antiquote">}</span></span></span></span> preserves homomorphisms over addition.›</span></span>

<span class="keyword1"><span class="command">context</span></span> comm_monoid_add_hom
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1" id="Ring_Hom_Poly-map_poly_hom_add"><span class="command">lemma</span></span> map_poly_hom_add<span class="main">[</span><span class="operator">hom_distribs</span><span class="main">]</span><span class="main">:</span>
    <span class="quoted"><span class="quoted">"map_poly <span class="free">hom</span> <span class="main">(</span><span class="free">p</span> <span class="main">+</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> map_poly <span class="free">hom</span> <span class="free">p</span> <span class="main">+</span> map_poly <span class="free">hom</span> <span class="free">q</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> map_poly_add<span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">hom_distribs</span></span><span class="main">)</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">locale</span></span> map_poly_comm_monoid_add_hom <span class="main">=</span> base<span class="main">:</span> comm_monoid_add_hom
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">sublocale</span></span> comm_monoid_add_hom <span class="quoted"><span class="quoted">"map_poly <span class="free">hom</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">hom_distribs</span></span><span class="main">)</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹To preserve homomorphisms over multiplication, it demands commutative ring homomorphisms.›</span></span>
<span class="keyword1"><span class="command">context</span></span> comm_semiring_hom <span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1" id="Ring_Hom_Poly-map_poly_pCons_hom"><span class="command">lemma</span></span> map_poly_pCons_hom<span class="main">[</span><span class="operator">hom_distribs</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"map_poly <span class="free">hom</span> <span class="main">(</span>pCons <span class="free">a</span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span> pCons <span class="main">(</span><span class="free">hom</span> <span class="free">a</span><span class="main">)</span> <span class="main">(</span>map_poly <span class="free">hom</span> <span class="free">p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> map_poly_simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1" id="Ring_Hom_Poly-map_poly_hom_smult"><span class="command">lemma</span></span> map_poly_hom_smult<span class="main">[</span><span class="operator">hom_distribs</span><span class="main">]</span><span class="main">:</span>
    <span class="quoted"><span class="quoted">"map_poly <span class="free">hom</span> <span class="main">(</span>smult <span class="free">c</span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span> smult <span class="main">(</span><span class="free">hom</span> <span class="free">c</span><span class="main">)</span> <span class="main">(</span>map_poly <span class="free">hom</span> <span class="free">p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">hom_distribs</span></span><span class="main">)</span>
  <span class="keyword1" id="Ring_Hom_Poly-poly_map_poly"><span class="command">lemma</span></span> poly_map_poly<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"poly <span class="main">(</span>map_poly <span class="free">hom</span> <span class="free">p</span><span class="main">)</span> <span class="main">(</span><span class="free">hom</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">hom</span> <span class="main">(</span>poly <span class="free">p</span> <span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">hom_distribs</span></span><span class="main">)</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">locale</span></span> map_poly_comm_semiring_hom <span class="main">=</span> base<span class="main">:</span> comm_semiring_hom
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">sublocale</span></span> map_poly_comm_monoid_add_hom<span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">sublocale</span></span> comm_semiring_hom <span class="quoted"><span class="quoted">"map_poly <span class="free">hom</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"map_poly <span class="free">hom</span> <span class="main">1</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span> <span class="skolem">q</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"map_poly <span class="free">hom</span> <span class="main">(</span><span class="skolem">p</span> <span class="main">*</span> <span class="skolem">q</span><span class="main">)</span> <span class="main">=</span> map_poly <span class="free">hom</span> <span class="skolem">p</span> <span class="main">*</span> map_poly <span class="free">hom</span> <span class="skolem">q</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">p</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">hom_distribs</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">locale</span></span> map_poly_comm_ring_hom <span class="main">=</span> base<span class="main">:</span> comm_ring_hom
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">sublocale</span></span> map_poly_comm_semiring_hom<span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">sublocale</span></span> comm_ring_hom <span class="quoted"><span class="quoted">"map_poly <span class="free">hom</span>"</span></span><span class="keyword1"><span class="command">..</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">locale</span></span> map_poly_idom_hom <span class="main">=</span> base<span class="main">:</span> idom_hom
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">sublocale</span></span> map_poly_comm_ring_hom<span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">sublocale</span></span> idom_hom <span class="quoted"><span class="quoted">"map_poly <span class="free">hom</span>"</span></span><span class="keyword1"><span class="command">..</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Injectivity›</span></span>

<span class="keyword1"><span class="command">locale</span></span> map_poly_inj_zero_hom <span class="main">=</span> base<span class="main">:</span> inj_zero_hom
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">sublocale</span></span> inj_zero_hom <span class="quoted"><span class="quoted">"map_poly <span class="free">hom</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span> <span class="skolem">q</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> poly"</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"map_poly <span class="free">hom</span> <span class="skolem">p</span> <span class="main">=</span> map_poly <span class="free">hom</span> <span class="skolem">q</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> cong<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">p</span><span class="main">.</span> coeff <span class="bound">p</span> <span class="main">_</span>"</span></span><span class="main">,</span> <span class="operator">OF</span> refl this<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> <span class="skolem">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> poly_eqI<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">locale</span></span> map_poly_inj_comm_monoid_add_hom <span class="main">=</span> base<span class="main">:</span> inj_comm_monoid_add_hom
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">sublocale</span></span> map_poly_comm_monoid_add_hom<span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">sublocale</span></span> map_poly_inj_zero_hom<span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">sublocale</span></span> inj_comm_monoid_add_hom <span class="quoted"><span class="quoted">"map_poly <span class="free">hom</span>"</span></span><span class="keyword1"><span class="command">..</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">locale</span></span> map_poly_inj_comm_semiring_hom <span class="main">=</span> base<span class="main">:</span> inj_comm_semiring_hom
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">sublocale</span></span> map_poly_comm_semiring_hom<span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">sublocale</span></span> map_poly_inj_zero_hom<span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">sublocale</span></span> inj_comm_semiring_hom <span class="quoted"><span class="quoted">"map_poly <span class="free">hom</span>"</span></span><span class="keyword1"><span class="command">..</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">locale</span></span> map_poly_inj_comm_ring_hom <span class="main">=</span> base<span class="main">:</span> inj_comm_ring_hom
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">sublocale</span></span> map_poly_inj_comm_semiring_hom<span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">sublocale</span></span> inj_comm_ring_hom <span class="quoted"><span class="quoted">"map_poly <span class="free">hom</span>"</span></span><span class="keyword1"><span class="command">..</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">locale</span></span> map_poly_inj_idom_hom <span class="main">=</span> base<span class="main">:</span> inj_idom_hom
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">sublocale</span></span> map_poly_inj_comm_ring_hom<span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">sublocale</span></span> inj_idom_hom <span class="quoted"><span class="quoted">"map_poly <span class="free">hom</span>"</span></span><span class="keyword1"><span class="command">..</span></span>
<span class="keyword2"><span class="keyword">end</span></span>




<span class="keyword1" id="Ring_Hom_Poly-degree_map_poly_le"><span class="command">lemma</span></span> degree_map_poly_le<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span>map_poly <span class="free">f</span> <span class="free">p</span><span class="main">)</span> <span class="main">≤</span> degree <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main"><span class="keyword3">;</span></span><span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="Ring_Hom_Poly-coeffs_map_poly"><span class="command">lemma</span></span> coeffs_map_poly<span class="main">:</span> <span class="comment1">(* An exact variant *)</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span>lead_coeff <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="free">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"coeffs <span class="main">(</span>map_poly <span class="free">f</span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span> map <span class="free">f</span> <span class="main">(</span>coeffs <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> coeffs_map_poly <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>coeffs_def<span class="main">)</span>

<span class="keyword1" id="Ring_Hom_Poly-degree_map_poly"><span class="command">lemma</span></span> degree_map_poly<span class="main">:</span> <span class="comment1">(* An exact variant *)</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span>lead_coeff <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="free">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"degree <span class="main">(</span>map_poly <span class="free">f</span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span> degree <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> degree_eq_length_coeffs <span class="keyword1"><span class="command">unfolding</span></span> coeffs_map_poly<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">f</span></span><span class="main">,</span> <span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">context</span></span> zero_hom_0 <span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1" id="Ring_Hom_Poly-degree_map_poly_hom"><span class="command">lemma</span></span> degree_map_poly_hom<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span>map_poly <span class="free">hom</span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span> degree <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> degree_map_poly<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1" id="Ring_Hom_Poly-coeffs_map_poly_hom"><span class="command">lemma</span></span> coeffs_map_poly_hom<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"coeffs <span class="main">(</span>map_poly <span class="free">hom</span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span> map <span class="free">hom</span> <span class="main">(</span>coeffs <span class="free">p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> coeffs_map_poly<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1" id="Ring_Hom_Poly-hom_lead_coeff"><span class="command">lemma</span></span> hom_lead_coeff<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"lead_coeff <span class="main">(</span>map_poly <span class="free">hom</span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="free">hom</span> <span class="main">(</span>lead_coeff <span class="free">p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">context</span></span> comm_semiring_hom <span class="keyword2"><span class="keyword">begin</span></span>

  <span class="keyword1"><span class="command">interpretation</span></span> map_poly_hom<span class="main">:</span> map_poly_comm_semiring_hom<span class="keyword1"><span class="command">..</span></span>

  <span class="keyword1" id="Ring_Hom_Poly-poly_map_poly_0"><span class="command">lemma</span></span> poly_map_poly_0<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
    <span class="quoted"><span class="quoted">"poly <span class="main">(</span>map_poly <span class="free">hom</span> <span class="free">p</span><span class="main">)</span> <span class="main">0</span> <span class="main">=</span> <span class="free">hom</span> <span class="main">(</span>poly <span class="free">p</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">=</span> <span class="var">?r</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">=</span> poly <span class="main">(</span>map_poly <span class="free">hom</span> <span class="free">p</span><span class="main">)</span> <span class="main">(</span><span class="free">hom</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> poly_map_poly<span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1" id="Ring_Hom_Poly-poly_map_poly_1"><span class="command">lemma</span></span> poly_map_poly_1<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
    <span class="quoted"><span class="quoted">"poly <span class="main">(</span>map_poly <span class="free">hom</span> <span class="free">p</span><span class="main">)</span> <span class="main">1</span> <span class="main">=</span> <span class="free">hom</span> <span class="main">(</span>poly <span class="free">p</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">=</span> <span class="var">?r</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">=</span> poly <span class="main">(</span>map_poly <span class="free">hom</span> <span class="free">p</span><span class="main">)</span> <span class="main">(</span><span class="free">hom</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> poly_map_poly<span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1" id="Ring_Hom_Poly-map_poly_hom_as_monom_sum"><span class="command">lemma</span></span> map_poly_hom_as_monom_sum<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">≤</span>degree <span class="free">p</span><span class="main">.</span> monom <span class="main">(</span><span class="free">hom</span> <span class="main">(</span>coeff <span class="free">p</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="bound">j</span><span class="main">)</span> <span class="main">=</span> map_poly <span class="free">hom</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span><span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> poly_as_sum_of_monoms'<span class="main"><span class="main">[</span></span><span class="operator">OF</span> le_refl<span class="main"><span class="main">,</span></span> <span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">hom_distribs</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1" id="Ring_Hom_Poly-map_poly_pcompose"><span class="command">lemma</span></span> map_poly_pcompose<span class="main">[</span><span class="operator">hom_distribs</span><span class="main">]</span><span class="main">:</span>
    <span class="quoted"><span class="quoted">"map_poly <span class="free">hom</span> <span class="main">(</span><span class="free">f</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">g</span><span class="main">)</span> <span class="main">=</span> map_poly <span class="free">hom</span> <span class="free">f</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> map_poly <span class="free">hom</span> <span class="free">g</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">f</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">g</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">hom_distribs</span></span><span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">context</span></span> comm_semiring_hom <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Ring_Hom_Poly-eval_poly_0"><span class="command">lemma</span></span> eval_poly_0<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"eval_poly <span class="free">hom</span> <span class="main">0</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> eval_poly_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1" id="Ring_Hom_Poly-eval_poly_monom"><span class="command">lemma</span></span> eval_poly_monom<span class="main">:</span> <span class="quoted"><span class="quoted">"eval_poly <span class="free">hom</span> <span class="main">(</span>monom <span class="free">a</span> <span class="free">n</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> <span class="free">hom</span> <span class="free">a</span> <span class="main">*</span> <span class="free">x</span> <span class="main">^</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> eval_poly_def
  <span class="keyword1"><span class="command">unfolding</span></span> map_poly_monom<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">hom</span></span><span class="main">,</span> <span class="operator">OF</span> hom_zero<span class="main">]</span> <span class="keyword1"><span class="command">using</span></span> poly_monom<span class="keyword1"><span class="command">.</span></span>

<span class="keyword1" id="Ring_Hom_Poly-poly_map_poly_eval_poly"><span class="command">lemma</span></span> poly_map_poly_eval_poly<span class="main">:</span> <span class="quoted"><span class="quoted">"poly <span class="main">(</span>map_poly <span class="free">hom</span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span> eval_poly <span class="free">hom</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> eval_poly_def<span class="keyword1"><span class="command">..</span></span>

<span class="keyword1" id="Ring_Hom_Poly-map_poly_eval_poly"><span class="command">lemma</span></span> map_poly_eval_poly<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"map_poly <span class="free">hom</span> <span class="free">p</span> <span class="main">=</span> eval_poly <span class="main">(</span><span class="main">λ</span> <span class="bound">a</span><span class="main">.</span> <span class="main">[:</span> <span class="free">hom</span> <span class="bound">a</span> <span class="main">:]</span><span class="main">)</span> <span class="free">p</span> <span class="main">[:</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> map_poly_eval_poly<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1" id="Ring_Hom_Poly-degree_extension"><span class="command">lemma</span></span> degree_extension<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span> <span class="main">≤</span> <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">≤</span>degree <span class="free">p</span><span class="main">.</span> <span class="free">x</span> <span class="main">^</span> <span class="bound">i</span> <span class="main">*</span> <span class="free">hom</span> <span class="main">(</span>coeff <span class="free">p</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>
      <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">≤</span><span class="free">n</span><span class="main">.</span> <span class="free">x</span> <span class="main">^</span> <span class="bound">i</span> <span class="main">*</span> <span class="free">hom</span> <span class="main">(</span>coeff <span class="free">p</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">=</span> <span class="var">?r</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">i</span><span class="main">.</span> <span class="free">x</span> <span class="main">^</span> <span class="bound">i</span> <span class="main">*</span> <span class="free">hom</span> <span class="main">(</span>coeff <span class="free">p</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">=</span> <span class="free">n</span> <span class="main">-</span> degree <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">=</span> degree <span class="free">p</span> <span class="main">+</span> <span class="skolem">m</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> m_def <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?r</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span> <span class="bound">i</span> <span class="main">≤</span> degree <span class="free">p</span> <span class="main">+</span> <span class="skolem">m</span><span class="main">.</span> <span class="var">?f</span> <span class="bound">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> n <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="var">?l</span> <span class="main">+</span> sum <span class="var">?f</span> <span class="main">{</span>Suc <span class="main">(</span>degree <span class="free">p</span><span class="main">)</span> <span class="main">..</span> degree <span class="free">p</span> <span class="main">+</span> <span class="skolem">m</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> sum.union_disjoint<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> sum.cong<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum <span class="var">?f</span> <span class="main">{</span>Suc <span class="main">(</span>degree <span class="free">p</span><span class="main">)</span> <span class="main">..</span> degree <span class="free">p</span> <span class="main">+</span> <span class="skolem">m</span><span class="main">}</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.neutral<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> coeff_eq_0<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Ring_Hom_Poly-eval_poly_add"><span class="command">lemma</span></span> eval_poly_add<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"eval_poly <span class="free">hom</span> <span class="main">(</span><span class="free">p</span> <span class="main">+</span> <span class="free">q</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> eval_poly <span class="free">hom</span> <span class="free">p</span> <span class="free">x</span> <span class="main">+</span> eval_poly <span class="free">hom</span> <span class="free">q</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> eval_poly_def <span class="dynamic"><span class="dynamic">hom_distribs</span></span><span class="keyword1"><span class="command">..</span></span>

<span class="keyword1" id="Ring_Hom_Poly-eval_poly_sum"><span class="command">lemma</span></span> eval_poly_sum<span class="main">:</span> <span class="quoted"><span class="quoted">"eval_poly <span class="free">hom</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="free">p</span> <span class="bound">k</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> eval_poly <span class="free">hom</span> <span class="main">(</span><span class="free">p</span> <span class="bound">k</span><span class="main">)</span> <span class="free">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">A</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> infinite_finite_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>insert <span class="skolem">a</span> <span class="skolem">A</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> sum.insert<span class="main">[</span><span class="operator">OF</span> insert<span class="main"><span class="main">(</span></span>1-2<span class="main"><span class="main">)</span></span><span class="main">]</span> insert<span class="main">(</span>3<span class="main">)</span><span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> eval_poly_def<span class="main">)</span>

<span class="keyword1" id="Ring_Hom_Poly-eval_poly_poly"><span class="command">lemma</span></span> eval_poly_poly<span class="main">:</span> <span class="quoted"><span class="quoted">"eval_poly <span class="free">hom</span> <span class="free">p</span> <span class="main">(</span><span class="free">hom</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">hom</span> <span class="main">(</span>poly <span class="free">p</span> <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> eval_poly_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">context</span></span> comm_ring_hom <span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">interpretation</span></span> map_poly_hom<span class="main">:</span> map_poly_comm_ring_hom<span class="keyword1"><span class="command">..</span></span>

  <span class="keyword1" id="Ring_Hom_Poly-pseudo_divmod_main_hom"><span class="command">lemma</span></span> pseudo_divmod_main_hom<span class="main">:</span>
    <span class="quoted"><span class="quoted">"pseudo_divmod_main <span class="main">(</span><span class="free">hom</span> <span class="free">lc</span><span class="main">)</span> <span class="main">(</span>map_poly <span class="free">hom</span> <span class="free">q</span><span class="main">)</span> <span class="main">(</span>map_poly <span class="free">hom</span> <span class="free">r</span><span class="main">)</span> <span class="main">(</span>map_poly <span class="free">hom</span> <span class="free">d</span><span class="main">)</span> <span class="free">dr</span> <span class="free">i</span> <span class="main">=</span>
     map_prod <span class="main">(</span>map_poly <span class="free">hom</span><span class="main">)</span> <span class="main">(</span>map_poly <span class="free">hom</span><span class="main">)</span> <span class="main">(</span>pseudo_divmod_main <span class="free">lc</span> <span class="free">q</span> <span class="free">r</span> <span class="free">d</span> <span class="free">dr</span> <span class="free">i</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">lc</span></span> <span class="quoted"><span class="free">q</span></span> <span class="quoted"><span class="free">r</span></span> <span class="quoted"><span class="free">d</span></span> <span class="quoted"><span class="free">dr</span></span> <span class="quoted"><span class="free">i</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>pseudo_divmod_main.induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Let_def <span class="dynamic"><span class="dynamic">hom_distribs</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">lemma</span></span><span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> inj_comm_ring_hom<span class="main">)</span> pseudo_divmod_hom<span class="main">:</span>
  <span class="quoted"><span class="quoted">"pseudo_divmod <span class="main">(</span>map_poly <span class="free">hom</span> <span class="free">p</span><span class="main">)</span> <span class="main">(</span>map_poly <span class="free">hom</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span>
   map_prod <span class="main">(</span>map_poly <span class="free">hom</span><span class="main">)</span> <span class="main">(</span>map_poly <span class="free">hom</span><span class="main">)</span> <span class="main">(</span>pseudo_divmod <span class="free">p</span> <span class="free">q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> pseudo_divmod_def <span class="keyword1"><span class="command">using</span></span> pseudo_divmod_main_hom<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span><span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> inj_idom_hom<span class="main">)</span> pseudo_mod_hom<span class="main">:</span>
  <span class="quoted"><span class="quoted">"pseudo_mod <span class="main">(</span>map_poly <span class="free">hom</span> <span class="free">p</span><span class="main">)</span> <span class="main">(</span>map_poly <span class="free">hom</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> map_poly <span class="free">hom</span> <span class="main">(</span>pseudo_mod <span class="free">p</span> <span class="free">q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> pseudo_divmod_hom <span class="keyword1"><span class="command">unfolding</span></span> pseudo_mod_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span><span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> idom_hom<span class="main">)</span> map_poly_pderiv<span class="main">[</span><span class="operator">hom_distribs</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"map_poly <span class="free">hom</span> <span class="main">(</span>pderiv <span class="free">p</span><span class="main">)</span> <span class="main">=</span> pderiv <span class="main">(</span>map_poly <span class="free">hom</span> <span class="free">p</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> pderiv.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">a</span> <span class="skolem">p</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> pderiv.simps map_poly_pCons_hom <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">hom_distribs</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">context</span></span> field_hom
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Ring_Hom_Poly-map_poly_pdivmod"><span class="command">lemma</span></span> map_poly_pdivmod<span class="main">[</span><span class="operator">hom_distribs</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"map_prod <span class="main">(</span>map_poly <span class="free">hom</span><span class="main">)</span> <span class="main">(</span>map_poly <span class="free">hom</span><span class="main">)</span> <span class="main">(</span><span class="free">p</span> <span class="keyword1">div</span> <span class="free">q</span><span class="main">,</span> <span class="free">p</span> <span class="keyword1">mod</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span>
    <span class="main">(</span>map_poly <span class="free">hom</span> <span class="free">p</span> <span class="keyword1">div</span> map_poly <span class="free">hom</span> <span class="free">q</span><span class="main">,</span> map_poly <span class="free">hom</span> <span class="free">p</span> <span class="keyword1">mod</span> map_poly <span class="free">hom</span> <span class="free">q</span><span class="main">)</span>"</span></span>
  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">=</span> <span class="var">?r</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?mp</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"map_poly <span class="free">hom</span>"</span></span>
  <span class="keyword1"><span class="command">interpret</span></span> map_poly_hom<span class="main">:</span> map_poly_idom_hom<span class="keyword1"><span class="command">..</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="keyword2"><span class="keyword">where</span></span> dm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">p</span> <span class="keyword1">div</span> <span class="free">q</span><span class="main">,</span> <span class="free">p</span> <span class="keyword1">mod</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">r</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>  
  <span class="keyword1"><span class="command">hence</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">=</span> <span class="free">p</span> <span class="keyword1">div</span> <span class="free">q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> s<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">=</span> <span class="free">p</span> <span class="keyword1">mod</span> <span class="free">q</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">from</span></span> dm <span class="main">[</span><span class="operator">folded</span> pdivmod_pdivmodrel<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eucl_rel_poly <span class="free">p</span> <span class="free">q</span> <span class="main">(</span><span class="skolem">r</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> this<span class="main">[</span><span class="operator">unfolded</span> eucl_rel_poly_iff<span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="skolem">r</span> <span class="main">*</span> <span class="free">q</span> <span class="main">+</span> <span class="skolem">s</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> cond<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">if</span> <span class="free">q</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="skolem">r</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="skolem">s</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> degree <span class="skolem">s</span> <span class="main">&lt;</span> degree <span class="free">q</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> arg_cong<span class="main">[</span><span class="operator">OF</span> eq<span class="main">,</span> <span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?mp</span></span></span><span class="main">,</span> <span class="operator">unfolded</span> map_poly_add<span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?mp</span> <span class="free">p</span> <span class="main">=</span> <span class="var">?mp</span> <span class="free">q</span> <span class="main">*</span> <span class="var">?mp</span> <span class="skolem">r</span> <span class="main">+</span> <span class="var">?mp</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">hom_distribs</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> cond <span class="keyword1"><span class="command">have</span></span> cond<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">if</span> <span class="var">?mp</span> <span class="free">q</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="var">?mp</span> <span class="skolem">r</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="var">?mp</span> <span class="skolem">s</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> degree <span class="main">(</span><span class="var">?mp</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">&lt;</span> degree <span class="main">(</span><span class="var">?mp</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> eq cond <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eucl_rel_poly <span class="main">(</span><span class="var">?mp</span> <span class="free">p</span><span class="main">)</span> <span class="main">(</span><span class="var">?mp</span> <span class="free">q</span><span class="main">)</span> <span class="main">(</span><span class="var">?mp</span> <span class="skolem">r</span><span class="main">,</span> <span class="var">?mp</span> <span class="skolem">s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> eucl_rel_poly_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> this<span class="main">[</span><span class="operator">unfolded</span> pdivmod_pdivmodrel<span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> dm prod.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Ring_Hom_Poly-map_poly_div"><span class="command">lemma</span></span> map_poly_div<span class="main">[</span><span class="operator">hom_distribs</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"map_poly <span class="free">hom</span> <span class="main">(</span><span class="free">p</span> <span class="keyword1">div</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> map_poly <span class="free">hom</span> <span class="free">p</span> <span class="keyword1">div</span> map_poly <span class="free">hom</span> <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> map_poly_pdivmod<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="free">q</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Ring_Hom_Poly-map_poly_mod"><span class="command">lemma</span></span> map_poly_mod<span class="main">[</span><span class="operator">hom_distribs</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"map_poly <span class="free">hom</span> <span class="main">(</span><span class="free">p</span> <span class="keyword1">mod</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> map_poly <span class="free">hom</span> <span class="free">p</span> <span class="keyword1">mod</span> map_poly <span class="free">hom</span> <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> map_poly_pdivmod<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="free">q</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">locale</span></span> field_hom' <span class="main">=</span> field_hom <span class="quoted"><span class="free">hom</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">hom</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>field_gcd<span class="main">}</span> <span class="main">⇒</span> <span class="tfree">'b</span> <span class="main">::</span> <span class="main">{</span>field_gcd<span class="main">}</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Ring_Hom_Poly-map_poly_normalize"><span class="command">lemma</span></span> map_poly_normalize<span class="main">[</span><span class="operator">hom_distribs</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"map_poly <span class="free">hom</span> <span class="main">(</span>normalize <span class="free">p</span><span class="main">)</span> <span class="main">=</span> normalize <span class="main">(</span>map_poly <span class="free">hom</span> <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> normalize_poly_def <span class="dynamic"><span class="dynamic">hom_distribs</span></span><span class="main">)</span>

<span class="keyword1" id="Ring_Hom_Poly-map_poly_gcd"><span class="command">lemma</span></span> map_poly_gcd<span class="main">[</span><span class="operator">hom_distribs</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"map_poly <span class="free">hom</span> <span class="main">(</span>gcd <span class="free">p</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> gcd <span class="main">(</span>map_poly <span class="free">hom</span> <span class="free">p</span><span class="main">)</span> <span class="main">(</span>map_poly <span class="free">hom</span> <span class="free">q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="free">q</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> eucl_induct<span class="main">)</span>
    <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> map_poly_normalize <span class="dynamic"><span class="dynamic">ac_simps</span></span> <span class="dynamic"><span class="dynamic">hom_distribs</span></span><span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">div_poly</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> euclidean_semiring <span class="main">⇒</span> <span class="tfree">'a</span> poly <span class="main">⇒</span> <span class="tfree">'a</span> poly"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">div_poly</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> map_poly <span class="main">(</span><span class="main">λ</span> <span class="bound">c</span><span class="main">.</span> <span class="bound">c</span> <span class="keyword1">div</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span>"</span></span>

<span class="keyword1" id="Ring_Hom_Poly-smult_div_poly"><span class="command">lemma</span></span> smult_div_poly<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">c</span><span class="main">.</span> <span class="bound">c</span> <span class="main">∈</span> set <span class="main">(</span>coeffs <span class="free">p</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">a</span> <span class="keyword1">dvd</span> <span class="bound">c</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"smult <span class="free">a</span> <span class="main">(</span>div_poly <span class="free">a</span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="free">p</span>"</span></span> 
  <span class="keyword1"><span class="command">unfolding</span></span> smult_as_map_poly div_poly_def 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> map_poly_map_poly<span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> map_poly_idI<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> assms<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="Ring_Hom_Poly-coeff_div_poly"><span class="command">lemma</span></span> coeff_div_poly<span class="main">:</span> <span class="quoted"><span class="quoted">"coeff <span class="main">(</span>div_poly <span class="free">a</span> <span class="free">f</span><span class="main">)</span> <span class="free">n</span> <span class="main">=</span> coeff <span class="free">f</span> <span class="free">n</span> <span class="keyword1">div</span> <span class="free">a</span>"</span></span> 
  <span class="keyword1"><span class="command">unfolding</span></span> div_poly_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> coeff_map_poly<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">locale</span></span> map_poly_inj_idom_divide_hom <span class="main">=</span> base<span class="main">:</span> inj_idom_divide_hom
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">sublocale</span></span> map_poly_idom_hom <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">sublocale</span></span> map_poly_inj_zero_hom <span class="keyword1"><span class="command">..</span></span> 
<span class="keyword1"><span class="command">sublocale</span></span> inj_idom_hom <span class="quoted"><span class="quoted">"map_poly <span class="free">hom</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1" id="Ring_Hom_Poly-divide_poly_main_hom"><span class="command">lemma</span></span> divide_poly_main_hom<span class="main">:</span> <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">hh</span> <span class="main">≡</span> map_poly <span class="free">hom</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">hh</span> <span class="main">(</span>divide_poly_main <span class="free">lc</span> <span class="free">f</span> <span class="free">g</span> <span class="free">h</span> <span class="free">i</span> <span class="free">j</span><span class="main">)</span> <span class="main">=</span> divide_poly_main <span class="main">(</span><span class="free">hom</span> <span class="free">lc</span><span class="main">)</span> <span class="main">(</span><span class="free">hh</span> <span class="free">f</span><span class="main">)</span> <span class="main">(</span><span class="free">hh</span> <span class="free">g</span><span class="main">)</span> <span class="main">(</span><span class="free">hh</span> <span class="free">h</span><span class="main">)</span> <span class="free">i</span> <span class="free">j</span>"</span></span>  
  <span class="keyword1"><span class="command">unfolding</span></span> hh_def
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">j</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">lc</span></span> <span class="quoted"><span class="free">f</span></span> <span class="quoted"><span class="free">g</span></span> <span class="quoted"><span class="free">h</span></span> <span class="quoted"><span class="free">i</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">j</span> <span class="skolem">lc</span> <span class="skolem">f</span> <span class="skolem">g</span> <span class="skolem">h</span> <span class="skolem">i</span><span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?h</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"map_poly <span class="free">hom</span>"</span></span> 
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> divide_poly_main.simps Let_def
    <span class="keyword1"><span class="command">unfolding</span></span> base.coeff_map_poly_hom base.hom_div<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> base.hom_mult<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> base.eq_iff
      if_distrib<span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?h</span></span></span><span class="main">]</span> hom_zero
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> if_cong<span class="main"><span class="main">[</span></span><span class="operator">OF</span> refl _ refl<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> Suc<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> hom_minus hom_add hom_mult<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">sublocale</span></span> inj_idom_divide_hom <span class="quoted"><span class="quoted">"map_poly <span class="free">hom</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span> <span class="skolem">g</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> poly"</span></span> 
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?h</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"map_poly <span class="free">hom</span>"</span></span> 
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?h</span> <span class="main">(</span><span class="skolem">f</span> <span class="keyword1">div</span> <span class="skolem">g</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="var">?h</span> <span class="skolem">f</span><span class="main">)</span> <span class="keyword1">div</span> <span class="main">(</span><span class="var">?h</span> <span class="skolem">g</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> divide_poly_def if_distrib<span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?h</span></span></span><span class="main">]</span>
    divide_poly_main_hom <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Ring_Hom_Poly-order_hom"><span class="command">lemma</span></span> order_hom<span class="main">:</span> <span class="quoted"><span class="quoted">"order <span class="main">(</span><span class="free">hom</span> <span class="free">x</span><span class="main">)</span> <span class="main">(</span>map_poly <span class="free">hom</span> <span class="free">f</span><span class="main">)</span> <span class="main">=</span> order <span class="free">x</span> <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Polynomial.order_def <span class="keyword1"><span class="command">unfolding</span></span> hom_dvd_iff<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
  <span class="keyword1"><span class="command">unfolding</span></span> hom_power <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> base.hom_uminus<span class="main">)</span>
<span class="keyword2"><span class="keyword">end</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Example Interpretations›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">of_int_poly</span> <span class="main">≡</span> map_poly of_int"</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> of_int_poly_hom<span class="main">:</span> map_poly_comm_semiring_hom <span class="quoted">of_int</span><span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">interpretation</span></span> of_int_poly_hom<span class="main">:</span> map_poly_comm_ring_hom <span class="quoted">of_int</span><span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">interpretation</span></span> of_int_poly_hom<span class="main">:</span> map_poly_idom_hom <span class="quoted">of_int</span><span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">interpretation</span></span> of_int_poly_hom<span class="main">:</span>
  map_poly_inj_comm_ring_hom <span class="quoted"><span class="quoted">"of_int <span class="main">::</span> int  <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>comm_ring_1<span class="main">,</span>ring_char_0<span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">interpretation</span></span> of_int_poly_hom<span class="main">:</span>
  map_poly_inj_idom_hom <span class="quoted"><span class="quoted">"of_int <span class="main">::</span> int  <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>idom<span class="main">,</span>ring_char_0<span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The following operations are homomorphic w.r.t. only <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">class</span></span> monoid_add<span class="antiquote"><span class="antiquote">}</span></span></span></span>.›</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> pCons_0_hom<span class="main">:</span> injective <span class="quoted"><span class="quoted">"pCons <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">interpretation</span></span> pCons_0_hom<span class="main">:</span> zero_hom_0 <span class="quoted"><span class="quoted">"pCons <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">interpretation</span></span> pCons_0_hom<span class="main">:</span> inj_comm_monoid_add_hom <span class="quoted"><span class="quoted">"pCons <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">interpretation</span></span> pCons_0_hom<span class="main">:</span> inj_ab_group_add_hom <span class="quoted"><span class="quoted">"pCons <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">interpretation</span></span> monom_hom<span class="main">:</span> injective <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> monom <span class="bound">x</span> <span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">interpretation</span></span> monom_hom<span class="main">:</span> inj_monoid_add_hom <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> monom <span class="bound">x</span> <span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> add_monom<span class="main">)</span>
<span class="keyword1"><span class="command">interpretation</span></span> monom_hom<span class="main">:</span> inj_comm_monoid_add_hom <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> monom <span class="bound">x</span> <span class="free">d</span>"</span></span><span class="keyword1"><span class="command">..</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Newton_Interpolation">
<div class="head">
<h1>Theory Newton_Interpolation</h1>
</div>
<pre class="source"><span class="comment1">(*  
    Author:      René Thiemann 
                 Akihisa Yamada
    License:     BSD
*)</span>
<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Newton Interpolation›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We proved the soundness of the Newton interpolation, i.e., a method to interpolate a polynomial $p$
  from a list of points $(x_1,p(x_1)), (x_2, p(x_2)), \ldots$. In experiments it performs
  much faster than the Lagrange interpolation.›</span></span>
<span class="keyword1"><span class="command">theory</span></span> Newton_Interpolation
<span class="keyword2"><span class="keyword">imports</span></span> 
  <span class="quoted">"<a href="https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL-Library/Monad_Syntax.html">HOL-Library.Monad_Syntax</a>"</span>
  <a href="#Ring_Hom_Poly">Ring_Hom_Poly</a>
  <a href="#Divmod_Int">Divmod_Int</a>
  <a href="#Is_Rat_To_Rat">Is_Rat_To_Rat</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹For the Newton interpolation, we start with an efficient implementation (which in prior examples
  we used as an uncertified oracle). Later on, a more abstract definition of the algorithm
  is described for which soundness is proven, and which is provably equivalent to the efficient
  implementation.

  The implementation is based on divided differences and the Horner schema.›</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">horner_composition</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> comm_ring_1 list <span class="main">⇒</span> <span class="tfree">'a</span> list <span class="main">⇒</span> <span class="tfree">'a</span> poly"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">horner_composition</span> <span class="main">[</span><span class="free"><span class="bound"><span class="entity">cn</span></span></span><span class="main">]</span> <span class="free"><span class="bound"><span class="entity">xis</span></span></span> <span class="main">=</span> <span class="main">[:</span><span class="free"><span class="bound"><span class="entity">cn</span></span></span><span class="main">:]</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">horner_composition</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ci</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">cs</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">xi</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">xis</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">horner_composition</span> <span class="free"><span class="bound"><span class="entity">cs</span></span></span> <span class="free"><span class="bound"><span class="entity">xis</span></span></span> <span class="main">*</span> <span class="main">[:</span><span class="main">-</span> <span class="free"><span class="bound"><span class="entity">xi</span></span></span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">+</span> <span class="main">[:</span><span class="free"><span class="bound"><span class="entity">ci</span></span></span><span class="main">:]</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">horner_composition</span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">=</span> <span class="main">0</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> map_poly_comm_ring_hom<span class="main">)</span> horner_composition_hom<span class="main">:</span>
  <span class="quoted"><span class="quoted">"horner_composition <span class="main">(</span>map <span class="free">hom</span> <span class="free">cs</span><span class="main">)</span> <span class="main">(</span>map <span class="free">hom</span> <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> map_poly <span class="free">hom</span> <span class="main">(</span>horner_composition <span class="free">cs</span> <span class="free">xs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">cs</span></span> <span class="quoted"><span class="free">xs</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> horner_composition.induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">hom_distribs</span></span><span class="main">)</span>

<span class="keyword1" id="Newton_Interpolation-horner_coeffs_ints"><span class="command">lemma</span></span> horner_coeffs_ints<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> len<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="free">cs</span> <span class="main">≤</span> Suc <span class="main">(</span>length <span class="free">ys</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>set <span class="main">(</span>coeffs <span class="main">(</span>horner_composition <span class="free">cs</span> <span class="main">(</span>map rat_of_int <span class="free">ys</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">ℤ</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>set <span class="free">cs</span> <span class="main">⊆</span> <span class="main">ℤ</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ir</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"int_of_rat"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ri</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"rat_of_int"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?mir</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"map <span class="var">?ir</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?mri</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"map <span class="var">?ri</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">ics</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ics</span> <span class="main">=</span> map <span class="var">?ir</span> <span class="free">cs</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"set <span class="free">cs</span> <span class="main">⊆</span> <span class="main">ℤ</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> ics<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">cs</span> <span class="main">=</span> <span class="var">?mri</span> <span class="skolem">ics</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> ics_def map_map o_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> map_idI subset_code<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>      
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>coeffs <span class="main">(</span>horner_composition <span class="free">cs</span> <span class="main">(</span><span class="var">?mri</span> <span class="free">ys</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">ℤ</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> ics of_int_poly_hom.horner_composition_hom <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>coeffs <span class="main">(</span>horner_composition <span class="free">cs</span> <span class="main">(</span><span class="var">?mri</span> <span class="free">ys</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">ℤ</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"set <span class="free">cs</span> <span class="main">⊆</span> <span class="main">ℤ</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> len
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">cs</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">ys</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">c</span> <span class="skolem">cs</span> <span class="skolem">xs</span><span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">cs</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∨</span> <span class="skolem">xs</span> <span class="main">=</span> <span class="main">[]</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">with</span></span> Cons <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">cs</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">d</span></span> <span class="skolem"><span class="skolem">ds</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="skolem"><span class="skolem">ys</span></span> <span class="keyword2"><span class="keyword">where</span></span> cs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">cs</span> <span class="main">=</span> <span class="skolem">d</span> <span class="main">#</span> <span class="skolem">ds</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> xs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">=</span> <span class="skolem">y</span> <span class="main">#</span> <span class="skolem">ys</span>"</span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">cs</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">xs</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
        <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?q</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"horner_composition <span class="skolem">cs</span> <span class="main">(</span><span class="var">?mri</span> <span class="skolem">ys</span><span class="main">)</span>"</span></span>
        <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">=</span> <span class="var">?q</span>"</span></span>
        <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> <span class="skolem">q</span> <span class="main">*</span> <span class="main">[:</span><span class="main">-</span> <span class="var">?ri</span> <span class="skolem">y</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">+</span> <span class="main">[:</span><span class="skolem">c</span><span class="main">:]</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"horner_composition <span class="main">(</span><span class="skolem">c</span> <span class="main">#</span> <span class="skolem">cs</span><span class="main">)</span> <span class="main">(</span><span class="var">?mri</span> <span class="skolem">xs</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">p</span>"</span></span> 
          <span class="keyword1"><span class="command">unfolding</span></span> cs xs q_def p_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">have</span></span> coeff<span class="main">:</span> <span class="quoted"><span class="quoted">"coeff <span class="skolem">p</span> <span class="skolem">i</span> <span class="main">∈</span> <span class="main">ℤ</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"coeff <span class="skolem">p</span> <span class="skolem">i</span> <span class="main">∈</span> set <span class="main">(</span>coeffs <span class="skolem">p</span><span class="main">)</span>"</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> True
          <span class="keyword1"><span class="command">with</span></span> Cons<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">unfolded</span> id<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> False
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"coeff <span class="skolem">p</span> <span class="skolem">i</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> range_coeff<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">p</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">{</span></span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
          <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">j</span><span class="main">.</span> coeff <span class="main">[:</span><span class="main">-</span> <span class="var">?ri</span> <span class="skolem">y</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="bound">j</span> <span class="main">*</span> coeff <span class="skolem">q</span> <span class="main">(</span>Suc <span class="skolem">i</span> <span class="main">-</span> <span class="bound">j</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coeff <span class="skolem">p</span> <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span> <span class="main">=</span> coeff <span class="main">(</span><span class="main">[:</span> <span class="main">-</span><span class="var">?ri</span> <span class="skolem">y</span><span class="main">,</span> <span class="main">1</span> <span class="main">:]</span> <span class="main">*</span> <span class="skolem">q</span><span class="main">)</span> <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> p_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">≤</span>Suc <span class="skolem">i</span><span class="main">.</span> <span class="var">?f</span> <span class="bound">j</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> coeff_mult <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="var">?f</span> <span class="main">0</span> <span class="main">+</span> <span class="var">?f</span> <span class="main">1</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="main">{..</span>Suc <span class="skolem">i</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span>Suc <span class="main">0</span><span class="main">}</span><span class="main">.</span> <span class="var">?f</span> <span class="bound">j</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> sum.remove<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="main"><span class="quoted"><span class="main"><span class="quoted"><span class="main">0</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> sum.remove<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="main"><span class="quoted"><span class="main"><span class="quoted"><span class="main">1</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="main">{..</span>Suc <span class="skolem">i</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span>Suc <span class="main">0</span><span class="main">}</span><span class="main">.</span> <span class="var">?f</span> <span class="bound">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sum.neutral<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
            <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">x</span><span class="main">)</span>
            <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">-</span> <span class="main">1</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?f</span> <span class="main">0</span> <span class="main">=</span> <span class="main">-</span> <span class="var">?ri</span> <span class="skolem">y</span> <span class="main">*</span> coeff <span class="skolem">q</span> <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?f</span> <span class="main">1</span> <span class="main">=</span> coeff <span class="skolem">q</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> int<span class="main">:</span> <span class="quoted"><span class="quoted">"coeff <span class="skolem">q</span> <span class="skolem">i</span> <span class="main">-</span> <span class="var">?ri</span> <span class="skolem">y</span> <span class="main">*</span> coeff <span class="skolem">q</span> <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span> <span class="main">∈</span> <span class="main">ℤ</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> coeff<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">i</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"coeff <span class="skolem">q</span> <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span> <span class="main">∈</span> <span class="main">ℤ</span>"</span></span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?ri</span> <span class="skolem">y</span> <span class="main">*</span> coeff <span class="skolem">q</span> <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span> <span class="main">∈</span> <span class="main">ℤ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"coeff <span class="skolem">q</span> <span class="skolem">i</span> <span class="main">∈</span> <span class="main">ℤ</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> int Ints_diff Ints_minus <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
        <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> coeff_q <span class="main">=</span> this
        <span class="keyword1"><span class="command">{</span></span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≤</span> degree <span class="skolem">q</span>"</span></span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"coeff <span class="skolem">q</span> <span class="main">(</span>degree <span class="skolem">q</span> <span class="main">-</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">∈</span> <span class="main">ℤ</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">i</span></span><span class="main">)</span>
            <span class="keyword3"><span class="command">case</span></span> 0
            <span class="keyword1"><span class="command">from</span></span> coeff_q<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"degree <span class="skolem">q</span>"</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Ints_0 Suc_n_not_le_n diff_zero le_degree<span class="main">)</span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span>
            <span class="keyword1"><span class="command">with</span></span> coeff_q<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">i</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc_diff_Suc Suc_leD Suc_n_not_le_n coeff_q le_less<span class="main">)</span>
          <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> coeff_q <span class="main">=</span> this
        <span class="keyword1"><span class="command">{</span></span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coeff <span class="skolem">q</span> <span class="skolem">i</span> <span class="main">∈</span> <span class="main">ℤ</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≤</span> degree <span class="skolem">q</span>"</span></span><span class="main">)</span>
            <span class="keyword3"><span class="command">case</span></span> True
            <span class="keyword1"><span class="command">with</span></span> coeff_q<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"degree <span class="skolem">q</span> <span class="main">-</span> <span class="skolem">i</span>"</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">case</span></span> False
            <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"coeff <span class="skolem">q</span> <span class="skolem">i</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> le_degree <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> coeff_q <span class="main">=</span> this
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>coeffs <span class="skolem">q</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">ℤ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> coeffs_def<span class="main">)</span>
        
        <span class="keyword1"><span class="command">from</span></span> Cons<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> this<span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> q_def<span class="main"><span class="main">]</span></span><span class="main">]</span> Cons<span class="main">(</span>3<span class="main">)</span> xs <span class="keyword1"><span class="command">have</span></span> IH<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">cs</span> <span class="main">⊆</span> <span class="main">ℤ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">=</span> coeff <span class="skolem">q</span> <span class="main">0</span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span> <span class="var">?ri</span> <span class="skolem">y</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">∈</span> <span class="main">ℤ</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> coeff_q<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> r_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coeff <span class="skolem">p</span> <span class="main">0</span> <span class="main">∈</span> <span class="main">ℤ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coeff <span class="skolem">p</span> <span class="main">0</span> <span class="main">=</span> <span class="skolem">r</span> <span class="main">+</span> <span class="skolem">c</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> p_def r_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">∈</span> <span class="main">ℤ</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> r <span class="keyword1"><span class="command">using</span></span> Ints_diff <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
        <span class="keyword1"><span class="command">with</span></span> IH <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">context</span></span>
<span class="keyword2"><span class="keyword">fixes</span></span> 
  <span class="free">ty</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> field itself"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">xs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> list"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">fs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> list"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>


<span class="keyword1"><span class="command">fun</span></span> <span class="entity">divided_differences_impl</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> list <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> list <span class="main">⇒</span> <span class="tfree">'a</span> list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">divided_differences_impl</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">xi_j1</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">x_j1s</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">fj</span></span></span> <span class="free"><span class="bound"><span class="entity">xj</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">xi</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">xis</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span> 
    <span class="bound">x_js</span> <span class="main">=</span> <span class="free">divided_differences_impl</span> <span class="free"><span class="bound"><span class="entity">x_j1s</span></span></span> <span class="free"><span class="bound"><span class="entity">fj</span></span></span> <span class="free"><span class="bound"><span class="entity">xj</span></span></span> <span class="free"><span class="bound"><span class="entity">xis</span></span></span><span class="main">;</span>
    <span class="bound">new</span> <span class="main">=</span> <span class="main">(</span>hd <span class="bound">x_js</span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">xi_j1</span></span></span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">xj</span></span></span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">xi</span></span></span><span class="main">)</span>
    <span class="keyword1">in</span> <span class="bound">new</span> <span class="main">#</span> <span class="bound">x_js</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">divided_differences_impl</span> <span class="main">[]</span> <span class="free"><span class="bound"><span class="entity">fj</span></span></span> <span class="free"><span class="bound"><span class="entity">xj</span></span></span> <span class="free"><span class="bound"><span class="entity">xis</span></span></span> <span class="main">=</span> <span class="main">[</span><span class="free"><span class="bound"><span class="entity">fj</span></span></span><span class="main">]</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">newton_coefficients_main</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> list <span class="main">⇒</span> <span class="tfree">'a</span> list <span class="main">⇒</span> <span class="tfree">'a</span> list list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">newton_coefficients_main</span> <span class="main">[</span><span class="free"><span class="bound"><span class="entity">fj</span></span></span><span class="main">]</span> <span class="free"><span class="bound"><span class="entity">xjs</span></span></span> <span class="main">=</span> <span class="main">[</span><span class="main">[</span><span class="free"><span class="bound"><span class="entity">fj</span></span></span><span class="main">]</span><span class="main">]</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">newton_coefficients_main</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">fj</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">fjs</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">xj</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">xjs</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>
    <span class="keyword1">let</span> <span class="bound">rec</span> <span class="main">=</span> <span class="free">newton_coefficients_main</span> <span class="free"><span class="bound"><span class="entity">fjs</span></span></span> <span class="free"><span class="bound"><span class="entity">xjs</span></span></span><span class="main">;</span> <span class="bound">row</span> <span class="main">=</span> hd <span class="bound">rec</span><span class="main">;</span>
      <span class="bound">new_row</span> <span class="main">=</span> divided_differences_impl <span class="bound">row</span> <span class="free"><span class="bound"><span class="entity">fj</span></span></span> <span class="free"><span class="bound"><span class="entity">xj</span></span></span> <span class="free">xs</span>
    <span class="keyword1">in</span> <span class="bound">new_row</span> <span class="main">#</span> <span class="bound">rec</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">newton_coefficients_main</span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">=</span> <span class="main">[]</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">newton_coefficients</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">newton_coefficients</span> <span class="main">=</span> map hd <span class="main">(</span>newton_coefficients_main <span class="main">(</span>rev <span class="free">fs</span><span class="main">)</span> <span class="main">(</span>rev <span class="free">xs</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">newton_poly_impl</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> poly"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">newton_poly_impl</span> <span class="main">=</span> horner_composition <span class="main">(</span>rev newton_coefficients<span class="main">)</span> <span class="free">xs</span>"</span></span>

<span class="keyword2"><span class="keyword">qualified</span></span> <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">=</span> <span class="free">xs</span> <span class="main">!</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span>"</span></span>
<span class="keyword2"><span class="keyword">qualified</span></span> <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">=</span> <span class="free">fs</span> <span class="main">!</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span>"</span></span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">xd</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="main">=</span> x <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">-</span> x <span class="free"><span class="bound"><span class="entity">j</span></span></span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"xd <span class="free">i</span> <span class="free">i</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"xd <span class="free">i</span> <span class="free">j</span> <span class="main">+</span> xd <span class="free">j</span> <span class="free">k</span> <span class="main">=</span> xd <span class="free">i</span> <span class="free">k</span>"</span></span> <span class="quoted"><span class="quoted">"xd <span class="free">i</span> <span class="free">j</span> <span class="main">+</span> xd <span class="free">k</span> <span class="free">i</span> <span class="main">=</span> xd <span class="free">k</span> <span class="free">j</span>"</span></span> 
  <span class="keyword1"><span class="command">unfolding</span></span> xd_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>

<span class="comment1">(* divided differences [xi,..,xj]f *)</span>
<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">function</span></span> <span class="entity">xij_f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> nat <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">xij_f</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">&lt;</span> <span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="keyword1">then</span> <span class="main">(</span><span class="free">xij_f</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="main">-</span> <span class="free">xij_f</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> xd <span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="keyword1">else</span> f <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">pat_completeness</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">termination</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">relation</span> <span class="quoted"><span class="quoted">"measure <span class="main">(</span><span class="main">λ</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="bound">j</span> <span class="main">-</span> <span class="bound">i</span><span class="main">)</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">definition</span></span> <span class="entity">c</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">=</span> xij_f <span class="main">0</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span>"</span></span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="main">=</span> <span class="main">[:</span> <span class="main">-</span> x <span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span>"</span></span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">function</span></span> <span class="entity">b</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> nat <span class="main">⇒</span> <span class="tfree">'a</span> poly"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">≥</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="keyword1">then</span> <span class="main">[:</span>c <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">:]</span> <span class="keyword1">else</span> <span class="free">b</span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">*</span> X <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">+</span> <span class="main">[:</span>c <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">:]</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">pat_completeness</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">termination</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">relation</span> <span class="quoted"><span class="quoted">"measure <span class="main">(</span><span class="main">λ</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">n</span><span class="main">)</span><span class="main">.</span> Suc <span class="bound">n</span> <span class="main">-</span> <span class="bound">i</span><span class="main">)</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">declare</span></span> b.simps<span class="main">[</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main">]</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">newton_poly</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'a</span> poly"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">newton_poly</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span> b <span class="main">0</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span>"</span></span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">Xij</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="main">=</span> prod_list <span class="main">(</span>map X <span class="main">[</span><span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">..&lt;</span> <span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">]</span><span class="main">)</span>"</span></span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">N</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">=</span> Xij <span class="main">0</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span>"</span></span>

<span class="keyword1" id="Newton_Interpolation-Xii_1"><span class="command">lemma</span></span> Xii_1<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Xij <span class="free">i</span> <span class="free">i</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> Xij_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1" id="Newton_Interpolation-smult_1"><span class="command">lemma</span></span> smult_1<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"smult <span class="free">d</span> <span class="main">1</span> <span class="main">=</span> <span class="main">[:</span><span class="free">d</span><span class="main">:]</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> smult_one<span class="main">)</span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1" id="Newton_Interpolation-newton_poly_sum"><span class="command">lemma</span></span> newton_poly_sum<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"newton_poly <span class="free">n</span> <span class="main">=</span> sum_list <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span> <span class="bound">i</span><span class="main">.</span> smult <span class="main">(</span>c <span class="bound">i</span><span class="main">)</span> <span class="main">(</span>N <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span> <span class="main">..&lt;</span> Suc <span class="free">n</span><span class="main">]</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> newton_poly_def N_def
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">j</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">≤</span> <span class="free">n</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"b <span class="skolem">j</span> <span class="free">n</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">←</span><span class="main">[</span><span class="skolem">j</span><span class="main">..&lt;</span>Suc <span class="free">n</span><span class="main">]</span><span class="main">.</span> smult <span class="main">(</span>c <span class="bound">i</span><span class="main">)</span> <span class="main">(</span>Xij <span class="skolem">j</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">j</span></span> <span class="quoted"><span class="free">n</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> b.induct<span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">j</span> <span class="skolem">n</span><span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">≥</span> <span class="skolem">n</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">with</span></span> 1<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> j<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">=</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"b <span class="skolem">j</span> <span class="skolem">n</span> <span class="main">=</span> <span class="main">[:</span>c <span class="skolem">n</span><span class="main">:]</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> b.simps<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">j</span></span> <span class="quoted"><span class="skolem">n</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> j <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">hence</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"b <span class="skolem">j</span> <span class="skolem">n</span> <span class="main">=</span> b <span class="main">(</span>Suc <span class="skolem">j</span><span class="main">)</span> <span class="skolem">n</span> <span class="main">*</span> X <span class="skolem">j</span> <span class="main">+</span> <span class="main">[:</span> c <span class="skolem">j</span><span class="main">:]</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> b.simps<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">j</span></span> <span class="quoted"><span class="skolem">n</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">nn</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">nn</span> <span class="main">=</span> Suc <span class="skolem">n</span>"</span></span>
        <span class="keyword1"><span class="command">from</span></span> 1<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">j</span><span class="main">..&lt;</span> <span class="skolem">nn</span><span class="main">]</span> <span class="main">=</span> <span class="skolem">j</span> <span class="main">#</span> <span class="main">[</span>Suc <span class="skolem">j</span> <span class="main">..&lt;</span> <span class="skolem">nn</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> nn_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> upt_rec<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> False <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">j</span> <span class="main">≤</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">note</span></span> IH <span class="main">=</span> 1<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> False this<span class="main">]</span>
        <span class="keyword1"><span class="command">have</span></span> id2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">←</span><span class="main">[</span>Suc <span class="skolem">j</span><span class="main">..&lt;</span> <span class="skolem">nn</span><span class="main">]</span><span class="main">.</span> smult <span class="main">(</span>c <span class="bound">x</span><span class="main">)</span> <span class="main">(</span>Xij <span class="main">(</span>Suc <span class="skolem">j</span><span class="main">)</span> <span class="bound">x</span> <span class="main">*</span> X <span class="skolem">j</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
          <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">←</span><span class="main">[</span>Suc <span class="skolem">j</span><span class="main">..&lt;</span> <span class="skolem">nn</span><span class="main">]</span><span class="main">.</span> smult <span class="main">(</span>c <span class="bound">i</span><span class="main">)</span> <span class="main">(</span>Xij <span class="skolem">j</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> arg_cong<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">sum_list</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> map_ext<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> impI<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">i</span><span class="main">)</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Xij <span class="main">(</span>Suc <span class="skolem">j</span><span class="main">)</span> <span class="skolem">i</span> <span class="main">*</span> X <span class="skolem">j</span> <span class="main">=</span> Xij <span class="skolem">j</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Xij_def upt_conv_Cons<span class="main">)</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> b IH sum_list_mult_const<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
          <span class="keyword1"><span class="command">unfolding</span></span> nn_def<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> id
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> id2<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">from</span></span> this<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"b <span class="main">0</span> <span class="free">n</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">←</span><span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="free">n</span><span class="main">]</span><span class="main">.</span> smult <span class="main">(</span>c <span class="bound">i</span><span class="main">)</span> <span class="main">(</span>Xij <span class="main">0</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1" id="Newton_Interpolation-poly_newton_poly"><span class="command">lemma</span></span> poly_newton_poly<span class="main">:</span> <span class="quoted"><span class="quoted">"poly <span class="main">(</span>newton_poly <span class="free">n</span><span class="main">)</span> <span class="free">y</span> <span class="main">=</span> sum_list <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span> <span class="bound">i</span><span class="main">.</span> c <span class="bound">i</span> <span class="main">*</span> poly <span class="main">(</span>N <span class="bound">i</span><span class="main">)</span> <span class="free">y</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span> <span class="main">..&lt;</span> Suc <span class="free">n</span><span class="main">]</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> newton_poly_sum poly_sum_list map_map o_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">pprod</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">l</span><span class="main">←</span><span class="main">[</span><span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">..&lt;</span><span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">]</span><span class="main">.</span> xd <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="bound">l</span><span class="main">)</span>"</span></span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1" id="Newton_Interpolation-poly_N_xi"><span class="command">lemma</span></span> poly_N_xi<span class="main">:</span> <span class="quoted"><span class="quoted">"poly <span class="main">(</span>N <span class="free">i</span><span class="main">)</span> <span class="main">(</span>x <span class="free">j</span><span class="main">)</span> <span class="main">=</span> pprod <span class="free">j</span> <span class="main">0</span> <span class="free">i</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="main">(</span>N <span class="free">i</span><span class="main">)</span> <span class="main">(</span>x <span class="free">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">l</span><span class="main">←</span><span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">i</span><span class="main">]</span><span class="main">.</span> xd <span class="free">j</span> <span class="bound">l</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> N_def Xij_def poly_prod_list X_def<span class="main">[</span><span class="operator">abs_def</span><span class="main">]</span> map_map o_def xd_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> pprod <span class="free">j</span> <span class="main">0</span> <span class="free">i</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> pprod_def <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1" id="Newton_Interpolation-poly_N_xi_cond"><span class="command">lemma</span></span> poly_N_xi_cond<span class="main">:</span> <span class="quoted"><span class="quoted">"poly <span class="main">(</span>N <span class="free">i</span><span class="main">)</span> <span class="main">(</span>x <span class="free">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">j</span> <span class="main">&lt;</span> <span class="free">i</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> pprod <span class="free">j</span> <span class="main">0</span> <span class="free">i</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">&lt;</span> <span class="free">i</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> poly_N_xi <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">∈</span> set <span class="main">[</span><span class="main">0</span> <span class="main">..&lt;</span> <span class="free">i</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> split_list<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">bef</span></span> <span class="skolem"><span class="skolem">aft</span></span> <span class="keyword2"><span class="keyword">where</span></span> id2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="main">0</span> <span class="main">..&lt;</span> <span class="free">i</span><span class="main">]</span> <span class="main">=</span> <span class="skolem">bef</span> <span class="main">@</span> <span class="free">j</span> <span class="main">#</span> <span class="skolem">aft</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∏</span><span class="bound">k</span><span class="main">←</span><span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">i</span><span class="main">]</span><span class="main">.</span> xd <span class="free">j</span> <span class="bound">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> id2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> True <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> poly_N_xi pprod_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1" id="Newton_Interpolation-poly_newton_poly_xj"><span class="command">lemma</span></span> poly_newton_poly_xj<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">≤</span> <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"poly <span class="main">(</span>newton_poly <span class="free">n</span><span class="main">)</span> <span class="main">(</span>x <span class="free">j</span><span class="main">)</span> <span class="main">=</span> sum_list <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span> <span class="bound">i</span><span class="main">.</span> c <span class="bound">i</span> <span class="main">*</span> poly <span class="main">(</span>N <span class="bound">i</span><span class="main">)</span> <span class="main">(</span>x <span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span> <span class="main">..&lt;</span> Suc <span class="free">j</span><span class="main">]</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="main">0</span> <span class="main">..&lt;</span> Suc <span class="free">n</span><span class="main">]</span> <span class="main">=</span> <span class="main">[</span><span class="main">0</span> <span class="main">..&lt;</span> Suc <span class="free">j</span><span class="main">]</span> <span class="main">@</span> <span class="main">[</span>Suc <span class="free">j</span> <span class="main">..&lt;</span> Suc <span class="free">n</span><span class="main">]</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc_le_mono le_Suc_ex less_eq_nat.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> upt_add_eq_append<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> id2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">←</span><span class="main">[</span>Suc <span class="free">j</span><span class="main">..&lt;</span> Suc <span class="free">n</span><span class="main">]</span><span class="main">.</span> c <span class="bound">i</span> <span class="main">*</span> poly <span class="main">(</span>N <span class="bound">i</span><span class="main">)</span> <span class="main">(</span>x <span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum_list_neutral<span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> poly_N_xi_cond<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> poly_newton_poly id map_append sum_list_append id2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">declare</span></span> xij_f.simps<span class="main">[</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main">]</span>

<span class="keyword1"><span class="command">context</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">n</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> dist<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">i</span> <span class="bound">j</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="bound">j</span> <span class="main">⟹</span> <span class="bound">j</span> <span class="main">≤</span> <span class="free">n</span> <span class="main">⟹</span> x <span class="bound">i</span> <span class="main">≠</span> x <span class="bound">j</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1" id="Newton_Interpolation-xd_diff"><span class="command">lemma</span></span> xd_diff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="free">j</span> <span class="main">⟹</span> <span class="free">j</span> <span class="main">≤</span> <span class="free">n</span> <span class="main">⟹</span> xd <span class="free">i</span> <span class="free">j</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
   <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="free">j</span> <span class="main">⟹</span> <span class="free">j</span> <span class="main">≤</span> <span class="free">n</span> <span class="main">⟹</span> xd <span class="free">j</span> <span class="free">i</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> dist<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">i</span></span> <span class="quoted"><span class="free">j</span></span><span class="main">]</span> dist<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">j</span></span> <span class="quoted"><span class="free">i</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> xd_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹This is the key technical lemma for soundness of Newton interpolation.›</span></span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1" id="Newton_Interpolation-divided_differences_main"><span class="command">lemma</span></span> divided_differences_main<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">≤</span> <span class="free">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="free">k</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"sum_list <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span> <span class="bound">j</span><span class="main">.</span> xij_f <span class="free">i</span> <span class="main">(</span><span class="free">i</span> <span class="main">+</span> <span class="bound">j</span><span class="main">)</span> <span class="main">*</span> pprod <span class="free">k</span> <span class="free">i</span> <span class="main">(</span><span class="free">i</span> <span class="main">+</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="free">k</span> <span class="main">-</span> <span class="free">i</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> 
  sum_list <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span> <span class="bound">j</span><span class="main">.</span> xij_f <span class="main">(</span>Suc <span class="free">i</span><span class="main">)</span> <span class="main">(</span>Suc <span class="free">i</span> <span class="main">+</span> <span class="bound">j</span><span class="main">)</span> <span class="main">*</span> pprod <span class="free">k</span> <span class="main">(</span>Suc <span class="free">i</span><span class="main">)</span> <span class="main">(</span>Suc <span class="free">i</span> <span class="main">+</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="free">k</span> <span class="main">-</span> Suc <span class="free">i</span><span class="main">]</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?exp</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">i</span> <span class="bound">j</span><span class="main">.</span> xij_f <span class="bound">i</span> <span class="main">(</span><span class="bound">i</span> <span class="main">+</span> <span class="bound">j</span><span class="main">)</span> <span class="main">*</span> pprod <span class="free">k</span> <span class="bound">i</span> <span class="main">(</span><span class="bound">i</span> <span class="main">+</span> <span class="bound">j</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">ei</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ei</span> <span class="main">=</span> <span class="var">?exp</span> <span class="free">i</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">esi</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">esi</span> <span class="main">=</span> <span class="var">?exp</span> <span class="main">(</span>Suc <span class="free">i</span><span class="main">)</span>"</span></span>  
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ki</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">-</span> <span class="free">i</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?sumi</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">xs</span><span class="main">.</span> sum_list <span class="main">(</span>map <span class="skolem">ei</span> <span class="bound">xs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?sumsi</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">xs</span><span class="main">.</span> sum_list <span class="main">(</span>map <span class="skolem">esi</span> <span class="bound">xs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?mid</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">j</span><span class="main">.</span> xij_f <span class="free">i</span> <span class="main">(</span><span class="free">k</span> <span class="main">-</span> <span class="bound">j</span><span class="main">)</span> <span class="main">*</span> pprod <span class="free">k</span> <span class="main">(</span>Suc <span class="free">i</span><span class="main">)</span> <span class="main">(</span><span class="free">k</span> <span class="main">-</span> <span class="bound">j</span><span class="main">)</span> <span class="main">*</span> xd <span class="main">(</span><span class="free">k</span> <span class="main">-</span> <span class="bound">j</span><span class="main">)</span> <span class="free">i</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?sum</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">j</span><span class="main">.</span> <span class="var">?sumi</span> <span class="main">[</span><span class="main">0</span> <span class="main">..&lt;</span> <span class="var">?ki</span> <span class="main">-</span> <span class="bound">j</span><span class="main">]</span> <span class="main">+</span> <span class="var">?sumsi</span> <span class="main">[</span><span class="var">?ki</span> <span class="main">-</span> <span class="bound">j</span> <span class="main">..&lt;</span> <span class="var">?ki</span><span class="main">]</span> <span class="main">+</span> <span class="var">?mid</span> <span class="bound">j</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">fin</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">fin</span> <span class="main">=</span> <span class="var">?ki</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> fin<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">fin</span> <span class="main">&lt;</span> <span class="var">?ki</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> fin_def <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span> <span class="main">0</span> <span class="main">..&lt;</span> Suc <span class="free">k</span> <span class="main">-</span> <span class="free">i</span><span class="main">]</span> <span class="main">=</span> <span class="main">[</span><span class="main">0</span> <span class="main">..&lt;</span> <span class="var">?ki</span><span class="main">]</span> <span class="main">@</span> <span class="main">[</span><span class="var">?ki</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
    id2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">i</span><span class="main">..&lt;</span><span class="free">k</span><span class="main">]</span> <span class="main">=</span> <span class="free">i</span> <span class="main">#</span> <span class="main">[</span>Suc <span class="free">i</span> <span class="main">..&lt;</span> <span class="free">k</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    id3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">-</span> <span class="main">(</span><span class="free">i</span> <span class="main">+</span> <span class="main">(</span><span class="free">k</span> <span class="main">-</span> Suc <span class="free">i</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">-</span> <span class="main">(</span><span class="var">?ki</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> Suc <span class="free">i</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Suc_diff_le upt_conv_Cons<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> neq<span class="main">:</span> <span class="quoted"><span class="quoted">"xd <span class="main">(</span>Suc <span class="free">i</span><span class="main">)</span> <span class="free">i</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> xd_diff<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">i</span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"Suc <span class="free"><span class="free">i</span></span>"</span></span></span><span class="main">]</span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum_list <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span> <span class="bound">j</span><span class="main">.</span> xij_f <span class="free">i</span> <span class="main">(</span><span class="free">i</span> <span class="main">+</span> <span class="bound">j</span><span class="main">)</span> <span class="main">*</span> pprod <span class="free">k</span> <span class="free">i</span> <span class="main">(</span><span class="free">i</span> <span class="main">+</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="free">k</span> <span class="main">-</span> <span class="free">i</span><span class="main">]</span><span class="main">)</span>
    <span class="main">=</span> <span class="var">?sumi</span> <span class="main">[</span><span class="main">0</span> <span class="main">..&lt;</span> Suc <span class="free">k</span> <span class="main">-</span> <span class="free">i</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> ei_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="var">?sumi</span> <span class="main">[</span><span class="main">0</span> <span class="main">..&lt;</span> <span class="var">?ki</span><span class="main">]</span> <span class="main">+</span> <span class="var">?sumsi</span> <span class="main">[</span><span class="var">?ki</span> <span class="main">..&lt;</span> <span class="var">?ki</span><span class="main">]</span> <span class="main">+</span> <span class="skolem">ei</span> <span class="var">?ki</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> id <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="var">?sum</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> ei_def <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pprod_def id2<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?sum</span> <span class="main">0</span> <span class="main">=</span> <span class="var">?sum</span> <span class="skolem">fin</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> fin
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">fin</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">fin</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> Suc<span class="main">(</span>2<span class="main">)</span> assms 
    <span class="keyword1"><span class="command">have</span></span> fki<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">fin</span> <span class="main">&lt;</span> <span class="var">?ki</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ikf<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">-</span> Suc <span class="skolem">fin</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">-</span> <span class="skolem">fin</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> kfn<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">-</span> <span class="skolem">fin</span> <span class="main">≤</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> xd_diff<span class="main">[</span><span class="operator">OF</span> ikf<span class="main"><span class="main"><span class="main">(</span></span></span>2<span class="main"><span class="main"><span class="main">)</span></span></span> kfn<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> nz<span class="main">:</span> <span class="quoted"><span class="quoted">"xd <span class="main">(</span><span class="free">k</span> <span class="main">-</span> <span class="skolem">fin</span><span class="main">)</span> <span class="free">i</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">note</span></span> IH <span class="main">=</span> Suc<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> fki<span class="main">]</span>
    <span class="keyword1"><span class="command">have</span></span> id4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="main">0</span> <span class="main">..&lt;</span> <span class="var">?ki</span> <span class="main">-</span> <span class="skolem">fin</span><span class="main">]</span> <span class="main">=</span> <span class="main">[</span><span class="main">0</span> <span class="main">..&lt;</span> <span class="var">?ki</span> <span class="main">-</span> Suc <span class="skolem">fin</span><span class="main">]</span> <span class="main">@</span> <span class="main">[</span><span class="var">?ki</span> <span class="main">-</span> Suc <span class="skolem">fin</span><span class="main">]</span>"</span></span> 
      <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">+</span> <span class="main">(</span><span class="free">k</span> <span class="main">-</span> <span class="free">i</span> <span class="main">-</span> Suc <span class="skolem">fin</span><span class="main">)</span> <span class="main">=</span> <span class="free">k</span> <span class="main">-</span> Suc <span class="skolem">fin</span>"</span></span> 
      <span class="quoted"><span class="quoted">"Suc <span class="main">(</span><span class="free">k</span> <span class="main">-</span> Suc <span class="skolem">fin</span><span class="main">)</span> <span class="main">=</span> <span class="free">k</span> <span class="main">-</span> <span class="skolem">fin</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Suc<span class="main">(</span>2<span class="main">)</span> assms  <span class="quoted"><span class="quoted">‹<span class="skolem">fin</span> <span class="main">&lt;</span> <span class="var">?ki</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc_diff_Suc le0 upt_Suc<span class="main">)</span> <span class="main">(</span><span class="operator">insert</span> Suc<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>      
    <span class="keyword1"><span class="command">from</span></span> Suc<span class="main">(</span>2<span class="main">)</span> assms <span class="keyword1"><span class="command">have</span></span> id5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">i</span><span class="main">..&lt;</span><span class="free">k</span> <span class="main">-</span> Suc <span class="skolem">fin</span><span class="main">]</span> <span class="main">=</span> <span class="free">i</span> <span class="main">#</span> <span class="main">[</span>Suc <span class="free">i</span> <span class="main">..&lt;</span> <span class="free">k</span> <span class="main">-</span> Suc <span class="skolem">fin</span><span class="main">]</span>"</span></span>
      <span class="quoted"><span class="quoted">"<span class="main">[</span>Suc <span class="free">i</span><span class="main">..&lt;</span><span class="free">k</span> <span class="main">-</span> <span class="skolem">fin</span><span class="main">]</span> <span class="main">=</span> <span class="main">[</span>Suc <span class="free">i</span><span class="main">..&lt;</span><span class="free">k</span> <span class="main">-</span> Suc <span class="skolem">fin</span><span class="main">]</span> <span class="main">@</span> <span class="main">[</span><span class="free">k</span> <span class="main">-</span> Suc <span class="skolem">fin</span><span class="main">]</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> upt_rec<span class="main">)</span> <span class="main">(</span><span class="operator">metis</span> Suc_leI id4<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> ikf<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> upt_Suc<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?sum</span> <span class="main">0</span> <span class="main">=</span> <span class="var">?sum</span> <span class="skolem">fin</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> IH<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="var">?sumi</span> <span class="main">[</span><span class="main">0</span> <span class="main">..&lt;</span> <span class="var">?ki</span> <span class="main">-</span> Suc <span class="skolem">fin</span><span class="main">]</span> <span class="main">+</span> <span class="var">?sumsi</span> <span class="main">[</span><span class="var">?ki</span> <span class="main">-</span> <span class="skolem">fin</span> <span class="main">..&lt;</span> <span class="var">?ki</span><span class="main">]</span> <span class="main">+</span> 
      <span class="main">(</span><span class="skolem">ei</span> <span class="main">(</span><span class="var">?ki</span> <span class="main">-</span> Suc <span class="skolem">fin</span><span class="main">)</span> <span class="main">+</span> <span class="var">?mid</span> <span class="skolem">fin</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> id4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?mid</span> <span class="skolem">fin</span> <span class="main">=</span> <span class="main">(</span>xij_f <span class="main">(</span>Suc <span class="free">i</span><span class="main">)</span> <span class="main">(</span><span class="free">k</span> <span class="main">-</span> <span class="skolem">fin</span><span class="main">)</span> <span class="main">-</span> xij_f <span class="free">i</span> <span class="main">(</span><span class="free">k</span> <span class="main">-</span> Suc <span class="skolem">fin</span><span class="main">)</span><span class="main">)</span>
      <span class="main">*</span> pprod <span class="free">k</span> <span class="main">(</span>Suc <span class="free">i</span><span class="main">)</span> <span class="main">(</span><span class="free">k</span> <span class="main">-</span> <span class="skolem">fin</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> xij_f.simps<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">i</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">-</span> <span class="skolem">fin</span>"</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">using</span></span> ikf nz <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> xij_f <span class="main">(</span>Suc <span class="free">i</span><span class="main">)</span> <span class="main">(</span><span class="free">k</span> <span class="main">-</span> <span class="skolem">fin</span><span class="main">)</span> <span class="main">*</span> pprod <span class="free">k</span> <span class="main">(</span>Suc <span class="free">i</span><span class="main">)</span> <span class="main">(</span><span class="free">k</span> <span class="main">-</span> <span class="skolem">fin</span><span class="main">)</span> <span class="main">-</span>
      xij_f <span class="free">i</span> <span class="main">(</span><span class="free">k</span> <span class="main">-</span> Suc <span class="skolem">fin</span><span class="main">)</span> <span class="main">*</span> pprod <span class="free">k</span> <span class="main">(</span>Suc <span class="free">i</span><span class="main">)</span> <span class="main">(</span><span class="free">k</span> <span class="main">-</span> <span class="skolem">fin</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">algebra</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"xij_f <span class="main">(</span>Suc <span class="free">i</span><span class="main">)</span> <span class="main">(</span><span class="free">k</span> <span class="main">-</span> <span class="skolem">fin</span><span class="main">)</span> <span class="main">*</span> pprod <span class="free">k</span> <span class="main">(</span>Suc <span class="free">i</span><span class="main">)</span> <span class="main">(</span><span class="free">k</span> <span class="main">-</span> <span class="skolem">fin</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">esi</span> <span class="main">(</span><span class="var">?ki</span> <span class="main">-</span> Suc <span class="skolem">fin</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> esi_def <span class="keyword1"><span class="command">using</span></span> ikf <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> id4<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ei</span> <span class="main">(</span><span class="var">?ki</span> <span class="main">-</span> Suc <span class="skolem">fin</span><span class="main">)</span> <span class="main">=</span> xij_f <span class="free">i</span> <span class="main">(</span><span class="free">k</span> <span class="main">-</span> Suc <span class="skolem">fin</span><span class="main">)</span> <span class="main">*</span> pprod <span class="free">k</span> <span class="free">i</span> <span class="main">(</span><span class="free">k</span> <span class="main">-</span> Suc <span class="skolem">fin</span><span class="main">)</span>"</span></span>       
      <span class="keyword1"><span class="command">unfolding</span></span> ei_def id4 <span class="keyword1"><span class="command">using</span></span> ikf <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?sum</span> <span class="main">0</span> <span class="main">=</span> <span class="var">?sumi</span> <span class="main">[</span><span class="main">0</span> <span class="main">..&lt;</span> <span class="var">?ki</span> <span class="main">-</span> Suc <span class="skolem">fin</span><span class="main">]</span> 
      <span class="main">+</span> <span class="main">(</span><span class="skolem">esi</span> <span class="main">(</span><span class="var">?ki</span> <span class="main">-</span> Suc <span class="skolem">fin</span><span class="main">)</span> <span class="main">+</span> <span class="var">?sumsi</span> <span class="main">[</span><span class="var">?ki</span> <span class="main">-</span> <span class="skolem">fin</span> <span class="main">..&lt;</span> <span class="var">?ki</span><span class="main">]</span><span class="main">)</span>
      <span class="main">+</span> <span class="main">(</span>xij_f <span class="free">i</span> <span class="main">(</span><span class="free">k</span> <span class="main">-</span> Suc <span class="skolem">fin</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>pprod <span class="free">k</span> <span class="free">i</span> <span class="main">(</span><span class="free">k</span> <span class="main">-</span> Suc <span class="skolem">fin</span><span class="main">)</span> <span class="main">-</span> pprod <span class="free">k</span> <span class="main">(</span>Suc <span class="free">i</span><span class="main">)</span> <span class="main">(</span><span class="free">k</span> <span class="main">-</span> <span class="skolem">fin</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">algebra</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">esi</span> <span class="main">(</span><span class="var">?ki</span> <span class="main">-</span> Suc <span class="skolem">fin</span><span class="main">)</span> <span class="main">+</span> <span class="var">?sumsi</span> <span class="main">[</span><span class="var">?ki</span> <span class="main">-</span> <span class="skolem">fin</span> <span class="main">..&lt;</span> <span class="var">?ki</span><span class="main">]</span> 
      <span class="main">=</span> <span class="var">?sumsi</span> <span class="main">(</span><span class="main">(</span><span class="var">?ki</span> <span class="main">-</span> Suc <span class="skolem">fin</span><span class="main">)</span> <span class="main">#</span> <span class="main">[</span><span class="var">?ki</span> <span class="main">-</span> <span class="skolem">fin</span> <span class="main">..&lt;</span> <span class="var">?ki</span><span class="main">]</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?ki</span> <span class="main">-</span> Suc <span class="skolem">fin</span><span class="main">)</span> <span class="main">#</span> <span class="main">[</span><span class="var">?ki</span> <span class="main">-</span> <span class="skolem">fin</span> <span class="main">..&lt;</span> <span class="var">?ki</span><span class="main">]</span> <span class="main">=</span> <span class="main">[</span><span class="var">?ki</span> <span class="main">-</span> Suc <span class="skolem">fin</span> <span class="main">..&lt;</span> <span class="var">?ki</span><span class="main">]</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Suc<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Suc_diff_Suc upt_rec<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"pprod <span class="free">k</span> <span class="free">i</span> <span class="main">(</span><span class="free">k</span> <span class="main">-</span> Suc <span class="skolem">fin</span><span class="main">)</span> <span class="main">-</span> pprod <span class="free">k</span> <span class="main">(</span>Suc <span class="free">i</span><span class="main">)</span> <span class="main">(</span><span class="free">k</span> <span class="main">-</span> <span class="skolem">fin</span><span class="main">)</span> 
      <span class="main">=</span> <span class="main">(</span>xd <span class="free">k</span> <span class="free">i</span><span class="main">)</span> <span class="main">*</span> pprod <span class="free">k</span> <span class="main">(</span>Suc <span class="free">i</span><span class="main">)</span> <span class="main">(</span><span class="free">k</span> <span class="main">-</span> Suc <span class="skolem">fin</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span>xd <span class="free">k</span> <span class="main">(</span><span class="free">k</span> <span class="main">-</span> Suc <span class="skolem">fin</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> pprod <span class="free">k</span> <span class="main">(</span>Suc <span class="free">i</span><span class="main">)</span> <span class="main">(</span><span class="free">k</span> <span class="main">-</span> Suc <span class="skolem">fin</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> pprod_def id5 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span>xd <span class="free">k</span> <span class="free">i</span> <span class="main">-</span> xd <span class="free">k</span> <span class="main">(</span><span class="free">k</span> <span class="main">-</span> Suc <span class="skolem">fin</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> pprod <span class="free">k</span> <span class="main">(</span>Suc <span class="free">i</span><span class="main">)</span> <span class="main">(</span><span class="free">k</span> <span class="main">-</span> Suc <span class="skolem">fin</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">algebra</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span>xd <span class="main">(</span><span class="free">k</span> <span class="main">-</span> Suc <span class="skolem">fin</span><span class="main">)</span> <span class="free">i</span><span class="main">)</span> <span class="main">*</span> pprod <span class="free">k</span> <span class="main">(</span>Suc <span class="free">i</span><span class="main">)</span> <span class="main">(</span><span class="free">k</span> <span class="main">-</span> Suc <span class="skolem">fin</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> xd_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"xij_f <span class="free">i</span> <span class="main">(</span><span class="free">k</span> <span class="main">-</span> Suc <span class="skolem">fin</span><span class="main">)</span> <span class="main">*</span> <span class="main">…</span> <span class="main">=</span> <span class="var">?mid</span> <span class="main">(</span>Suc <span class="skolem">fin</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">ei</span> <span class="main">0</span> <span class="main">+</span> <span class="var">?mid</span> <span class="main">(</span><span class="free">k</span> <span class="main">-</span> <span class="free">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="var">?sumsi</span> <span class="main">[</span><span class="main">1</span> <span class="main">..&lt;</span> <span class="free">k</span> <span class="main">-</span> <span class="free">i</span><span class="main">]</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> fin_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> id3<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ei</span> <span class="main">0</span> <span class="main">+</span> <span class="var">?mid</span> <span class="main">(</span><span class="free">k</span> <span class="main">-</span> <span class="free">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">esi</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> id3
    <span class="keyword1"><span class="command">unfolding</span></span> ei_def esi_def xij_f.simps<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">i</span></span> <span class="quoted"><span class="free">i</span></span><span class="main">]</span>  <span class="keyword1"><span class="command">using</span></span> neq assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span> xij_f.simps pprod_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">esi</span> <span class="main">0</span> <span class="main">+</span> <span class="var">?sumsi</span> <span class="main">[</span><span class="main">1</span> <span class="main">..&lt;</span> <span class="free">k</span> <span class="main">-</span> <span class="free">i</span><span class="main">]</span> <span class="main">=</span> <span class="var">?sumsi</span> <span class="main">(</span><span class="main">0</span> <span class="main">#</span> <span class="main">[</span><span class="main">1</span> <span class="main">..&lt;</span> <span class="free">k</span> <span class="main">-</span> <span class="free">i</span><span class="main">]</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">#</span> <span class="main">[</span><span class="main">1</span> <span class="main">..&lt;</span> <span class="free">k</span> <span class="main">-</span> <span class="free">i</span><span class="main">]</span> <span class="main">=</span> <span class="main">[</span><span class="main">0</span> <span class="main">..&lt;</span> Suc <span class="free">k</span> <span class="main">-</span> Suc <span class="free">i</span><span class="main">]</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> upt_rec<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?sumsi</span> <span class="main">…</span> <span class="main">=</span> sum_list <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span> <span class="bound">j</span><span class="main">.</span> xij_f <span class="main">(</span>Suc <span class="free">i</span><span class="main">)</span> <span class="main">(</span>Suc <span class="free">i</span> <span class="main">+</span> <span class="bound">j</span><span class="main">)</span> <span class="main">*</span> 
    pprod <span class="free">k</span> <span class="main">(</span>Suc <span class="free">i</span><span class="main">)</span> <span class="main">(</span>Suc <span class="free">i</span> <span class="main">+</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="free">k</span> <span class="main">-</span> Suc <span class="free">i</span><span class="main">]</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> esi_def <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1" id="Newton_Interpolation-divided_differences"><span class="command">lemma</span></span> divided_differences<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> kn<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">≤</span> <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ik<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≤</span> <span class="free">k</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"sum_list <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span> <span class="bound">j</span><span class="main">.</span> xij_f <span class="free">i</span> <span class="main">(</span><span class="free">i</span> <span class="main">+</span> <span class="bound">j</span><span class="main">)</span> <span class="main">*</span> pprod <span class="free">k</span> <span class="free">i</span> <span class="main">(</span><span class="free">i</span> <span class="main">+</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="free">k</span> <span class="main">-</span> <span class="free">i</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> f <span class="free">k</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ii</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">+</span> <span class="skolem">ii</span> <span class="main">≤</span> <span class="free">k</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"sum_list <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span> <span class="bound">j</span><span class="main">.</span> xij_f <span class="free">i</span> <span class="main">(</span><span class="free">i</span> <span class="main">+</span> <span class="bound">j</span><span class="main">)</span> <span class="main">*</span> pprod <span class="free">k</span> <span class="free">i</span> <span class="main">(</span><span class="free">i</span> <span class="main">+</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="free">k</span> <span class="main">-</span> <span class="free">i</span><span class="main">]</span><span class="main">)</span>
      <span class="main">=</span> sum_list <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span> <span class="bound">j</span><span class="main">.</span> xij_f <span class="main">(</span><span class="free">i</span> <span class="main">+</span> <span class="skolem">ii</span><span class="main">)</span> <span class="main">(</span><span class="free">i</span> <span class="main">+</span> <span class="skolem">ii</span> <span class="main">+</span> <span class="bound">j</span><span class="main">)</span> <span class="main">*</span> pprod <span class="free">k</span> <span class="main">(</span><span class="free">i</span> <span class="main">+</span> <span class="skolem">ii</span><span class="main">)</span> <span class="main">(</span><span class="free">i</span> <span class="main">+</span> <span class="skolem">ii</span> <span class="main">+</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="free">k</span> <span class="main">-</span> <span class="main">(</span><span class="free">i</span> <span class="main">+</span> <span class="skolem">ii</span><span class="main">)</span><span class="main">]</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">ii</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">ii</span><span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> le1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">+</span> <span class="skolem">ii</span> <span class="main">≤</span> <span class="free">k</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> le2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">+</span> <span class="skolem">ii</span> <span class="main">&lt;</span> <span class="free">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> Suc<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> le1<span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> divided_differences_main<span class="main">[</span><span class="operator">OF</span> kn le2<span class="main">]</span>
        <span class="keyword1"><span class="command">using</span></span> Suc<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> main <span class="main">=</span> this
  <span class="keyword1"><span class="command">have</span></span> ik<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">+</span> <span class="main">(</span><span class="free">k</span> <span class="main">-</span> <span class="free">i</span><span class="main">)</span> <span class="main">≤</span> <span class="free">k</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">+</span> <span class="main">(</span><span class="free">k</span> <span class="main">-</span> <span class="free">i</span><span class="main">)</span> <span class="main">=</span> <span class="free">k</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ik <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> main<span class="main">[</span><span class="operator">OF</span> ik<span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> id
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> xij_f.simps pprod_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>      

<span class="keyword1" id="Newton_Interpolation-newton_poly_sound"><span class="command">lemma</span></span> newton_poly_sound<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">≤</span> <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"poly <span class="main">(</span>newton_poly <span class="free">n</span><span class="main">)</span> <span class="main">(</span>x <span class="free">k</span><span class="main">)</span> <span class="main">=</span> f <span class="free">k</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="main">(</span>newton_poly <span class="free">n</span><span class="main">)</span> <span class="main">(</span>x <span class="free">k</span><span class="main">)</span> <span class="main">=</span> 
    sum_list <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span> <span class="bound">j</span><span class="main">.</span> xij_f <span class="main">0</span> <span class="main">(</span><span class="main">0</span> <span class="main">+</span> <span class="bound">j</span><span class="main">)</span> <span class="main">*</span> pprod <span class="free">k</span> <span class="main">0</span> <span class="main">(</span><span class="main">0</span> <span class="main">+</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="free">k</span> <span class="main">-</span> <span class="main">0</span><span class="main">]</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> poly_newton_poly_xj<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> c_def poly_N_xi <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> f <span class="free">k</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> divided_differences<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1" id="Newton_Interpolation-newton_poly_degree"><span class="command">lemma</span></span> newton_poly_degree<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span>newton_poly <span class="free">n</span><span class="main">)</span> <span class="main">≤</span> <span class="free">n</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≤</span> <span class="free">n</span> <span class="main">⟹</span> degree <span class="main">(</span>b <span class="skolem">i</span> <span class="free">n</span><span class="main">)</span> <span class="main">≤</span> <span class="free">n</span> <span class="main">-</span> <span class="skolem">i</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">i</span></span> <span class="quoted"><span class="free">n</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> b.induct<span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">i</span> <span class="skolem">n</span><span class="main">)</span>
      <span class="keyword1"><span class="command">note</span></span> b <span class="main">=</span> b.simps<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">i</span></span> <span class="quoted"><span class="skolem">n</span></span><span class="main">]</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">≤</span> <span class="skolem">i</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> b <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span>b <span class="skolem">i</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">=</span> degree <span class="main">(</span>b <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span> <span class="skolem">n</span> <span class="main">*</span> X <span class="skolem">i</span> <span class="main">+</span> <span class="main">[:</span>c <span class="skolem">i</span><span class="main">:]</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">unfolding</span></span> b <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> max <span class="main">(</span>degree <span class="main">(</span>b <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span> <span class="skolem">n</span> <span class="main">*</span> X <span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>degree <span class="main">[:</span>c <span class="skolem">i</span><span class="main">:]</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> degree_add_le_max<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> degree <span class="main">(</span>b <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span> <span class="skolem">n</span> <span class="main">*</span> X <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> degree <span class="main">(</span>b <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">+</span> degree <span class="main">(</span>X <span class="skolem">i</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> degree_mult_le<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="skolem">n</span> <span class="main">-</span> Suc <span class="skolem">i</span> <span class="main">+</span> degree <span class="main">(</span>X <span class="skolem">i</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> 1<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> False<span class="main">]</span> 1<span class="main">(</span>2<span class="main">)</span> False add_le_mono1 not_less_eq_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">n</span> <span class="main">-</span> Suc <span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> X_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">n</span> <span class="main">-</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> 1<span class="main">(</span>2<span class="main">)</span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">from</span></span> this<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> newton_poly_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">context</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">n</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> xs<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="free">xs</span> <span class="main">=</span> <span class="free">n</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> fs<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="free">fs</span> <span class="main">=</span> <span class="free">n</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1" id="Newton_Interpolation-newton_coefficients_main"><span class="command">lemma</span></span> newton_coefficients_main<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">⟹</span> newton_coefficients_main <span class="main">(</span>rev <span class="main">(</span>map f <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="free">k</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>rev <span class="main">(</span>map x <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="free">k</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>
    <span class="main">=</span> rev <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span> <span class="bound">i</span><span class="main">.</span> map <span class="main">(</span><span class="main">λ</span> <span class="bound">j</span><span class="main">.</span> xij_f <span class="bound">j</span> <span class="bound">i</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="bound">i</span><span class="main">]</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="free">k</span><span class="main">]</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">k</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> xij_f.simps<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">note</span></span> IH <span class="main">=</span> Suc<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">f</span><span class="main">.</span> rev <span class="main">(</span>map <span class="bound">f</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> <span class="bound">f</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="main">#</span> <span class="bound">f</span> <span class="skolem">k</span> <span class="main">#</span> rev <span class="main">(</span>map <span class="bound">f</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span> <span class="skolem">k</span><span class="main">]</span><span class="main">)</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> id2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">f</span><span class="main">.</span> <span class="bound">f</span> <span class="skolem">k</span> <span class="main">#</span> rev <span class="main">(</span>map <span class="bound">f</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="skolem">k</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> rev <span class="main">(</span>map <span class="bound">f</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span> Suc <span class="skolem">k</span><span class="main">]</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> id newton_coefficients_main.simps Let_def
    <span class="keyword1"><span class="command">unfolding</span></span> id2 IH
    <span class="keyword1"><span class="command">unfolding</span></span> list.simps id2<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> conjI<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 1
    <span class="keyword1"><span class="command">have</span></span> xs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">=</span> map x <span class="main">[</span><span class="main">0</span> <span class="main">..&lt;</span> <span class="free">n</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> xs <span class="keyword1"><span class="command">unfolding</span></span> x_def<span class="main">[</span><span class="operator">abs_def</span><span class="main">]</span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> nth_equalityI<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">nn</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">nn</span> <span class="main">=</span> <span class="main">(</span><span class="main">0</span> <span class="main">::</span> nat<span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">=</span> Suc <span class="skolem">k</span> <span class="main">-</span> <span class="skolem">nn</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> prems<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">=</span> Suc <span class="skolem">k</span> <span class="main">-</span> <span class="skolem">nn</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">nn</span> <span class="main">&lt;</span> Suc <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> m_def nn_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?case</span> <span class="main">=</span> <span class="main">(</span>divided_differences_impl <span class="main">(</span>map <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">j</span><span class="main">.</span> xij_f <span class="bound">j</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="main">[</span><span class="skolem">nn</span><span class="main">..&lt;</span> Suc <span class="skolem">k</span><span class="main">]</span><span class="main">)</span> <span class="main">(</span>f <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>x <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>map x <span class="main">[</span><span class="skolem">nn</span> <span class="main">..&lt;</span> <span class="free">n</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span>
      map <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">j</span><span class="main">.</span> xij_f <span class="bound">j</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">[</span><span class="skolem">nn</span><span class="main">..&lt;</span>Suc <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">]</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> nn_def xs<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> prems
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">m</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="skolem">nn</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> 0
      <span class="keyword1"><span class="command">hence</span></span> nn<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">nn</span> <span class="main">=</span> Suc <span class="skolem">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> nn <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> xij_f.simps<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">m</span><span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹Suc <span class="skolem">k</span> <span class="main">&lt;</span> <span class="free">n</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">nn</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> le<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">nn</span> <span class="main">&lt;</span> Suc <span class="skolem">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> Suc<span class="main">(</span>2-<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> id<span class="main">:</span> 
        <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">nn</span><span class="main">..&lt;</span>Suc <span class="skolem">k</span><span class="main">]</span> <span class="main">=</span> <span class="skolem">nn</span> <span class="main">#</span> <span class="main">[</span>Suc <span class="skolem">nn</span><span class="main">..&lt;</span> Suc <span class="skolem">k</span><span class="main">]</span>"</span></span>
        <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">nn</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">]</span> <span class="main">=</span> <span class="skolem">nn</span> <span class="main">#</span> <span class="main">[</span>Suc <span class="skolem">nn</span><span class="main">..&lt;</span> <span class="free">n</span><span class="main">]</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> id2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">nn</span><span class="main">..&lt;</span>Suc <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">]</span> <span class="main">=</span> <span class="skolem">nn</span> <span class="main">#</span> <span class="main">[</span>Suc <span class="skolem">nn</span><span class="main">..&lt;</span>Suc <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">]</span>"</span></span>
        <span class="quoted"><span class="quoted">"<span class="main">[</span>Suc <span class="skolem">nn</span><span class="main">..&lt;</span>Suc <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">]</span> <span class="main">=</span> Suc <span class="skolem">nn</span> <span class="main">#</span> <span class="main">[</span>Suc <span class="main">(</span>Suc <span class="skolem">nn</span><span class="main">)</span><span class="main">..&lt;</span>Suc <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">]</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> upt_rec<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> Suc<span class="main">(</span>2-<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">=</span> Suc <span class="skolem">k</span> <span class="main">-</span> Suc <span class="skolem">nn</span>"</span></span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">nn</span> <span class="main">&lt;</span> Suc <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">note</span></span> IH <span class="main">=</span> Suc<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> id list.simps divided_differences_impl.simps IH Let_def
        <span class="keyword1"><span class="command">unfolding</span></span> id2 list.simps 
        <span class="keyword1"><span class="command">using</span></span> le
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> xij_f.simps<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem">nn</span></span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">k</span>"</span></span><span class="main"><span class="main">]</span></span> xd_def<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Newton_Interpolation-newton_coefficients"><span class="command">lemma</span></span> newton_coefficients<span class="main">:</span> <span class="quoted"><span class="quoted">"newton_coefficients <span class="main">=</span> rev <span class="main">(</span>map c <span class="main">[</span><span class="main">0</span> <span class="main">..&lt;</span> <span class="free">n</span><span class="main">]</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
  <span class="keyword1"><span class="command">hence</span></span> xs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">fs</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> xs fs <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> newton_coefficients_def 0 
    <span class="keyword1"><span class="command">using</span></span> newton_coefficients_main.simps
    <span class="keyword1"><span class="command">unfolding</span></span> xs <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">nn</span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> sn<span class="main">:</span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">nn</span> <span class="main">=</span> <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> nn<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">nn</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> fs <span class="keyword1"><span class="command">have</span></span> fs<span class="main">:</span> <span class="quoted"><span class="quoted">"map f <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="skolem">nn</span><span class="main">]</span> <span class="main">=</span> <span class="free">fs</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> sn
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> nth_equalityI<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> f_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> xs <span class="keyword1"><span class="command">have</span></span> xs<span class="main">:</span> <span class="quoted"><span class="quoted">"map x <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="skolem">nn</span><span class="main">]</span> <span class="main">=</span> <span class="free">xs</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> sn
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> nth_equalityI<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> x_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> newton_coefficients_def
      newton_coefficients_main<span class="main">[</span><span class="operator">OF</span> nn<span class="main">,</span> <span class="operator">unfolded</span> fs xs<span class="main">]</span>
    <span class="keyword1"><span class="command">unfolding</span></span> sn rev_map<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> map_map o_def 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> arg_cong<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">rev</span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> upt_rec<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> nth_equalityI<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> c_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Newton_Interpolation-newton_poly_impl"><span class="command">lemma</span></span> newton_poly_impl<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">=</span> Suc <span class="free">nn</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"newton_poly_impl <span class="main">=</span> newton_poly <span class="free">nn</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">=</span> <span class="main">(</span><span class="main">0</span> <span class="main">::</span> nat<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> xs<span class="main">:</span> <span class="quoted"><span class="quoted">"map x <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">]</span> <span class="main">=</span> <span class="free">xs</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> xs
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> nth_equalityI<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> x_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≤</span> <span class="free">nn</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> i_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"horner_composition <span class="main">(</span>map c <span class="main">[</span><span class="skolem">i</span><span class="main">..&lt;</span>Suc <span class="free">nn</span><span class="main">]</span><span class="main">)</span> <span class="main">(</span>map x <span class="main">[</span><span class="skolem">i</span><span class="main">..&lt;</span>Suc <span class="free">nn</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> b <span class="skolem">i</span> <span class="free">nn</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">i</span></span> <span class="quoted"><span class="free">nn</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> b.induct<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">i</span> <span class="skolem">n</span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">≤</span> <span class="skolem">i</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">with</span></span> 1<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">=</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> i b.simps<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">n</span></span> <span class="quoted"><span class="skolem">n</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">i</span> <span class="main">≤</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">note</span></span> IH <span class="main">=</span> 1<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> False this<span class="main">]</span>
      <span class="keyword1"><span class="command">have</span></span> bi<span class="main">:</span> <span class="quoted"><span class="quoted">"b <span class="skolem">i</span> <span class="skolem">n</span> <span class="main">=</span> b <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span> <span class="skolem">n</span> <span class="main">*</span> X <span class="skolem">i</span> <span class="main">+</span> <span class="main">[:</span>c <span class="skolem">i</span><span class="main">:]</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> b.simps<span class="main">)</span>    
      <span class="keyword1"><span class="command">from</span></span> False <span class="keyword1"><span class="command">have</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">i</span> <span class="main">..&lt;</span> Suc <span class="skolem">n</span><span class="main">]</span> <span class="main">=</span> <span class="skolem">i</span> <span class="main">#</span> <span class="main">[</span>Suc <span class="skolem">i</span> <span class="main">..&lt;</span> Suc <span class="skolem">n</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> upt_rec<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> False <span class="keyword1"><span class="command">have</span></span> id2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>Suc <span class="skolem">i</span> <span class="main">..&lt;</span> Suc <span class="skolem">n</span><span class="main">]</span> <span class="main">=</span> Suc <span class="skolem">i</span> <span class="main">#</span> <span class="main">[</span>Suc <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span> <span class="main">..&lt;</span> Suc <span class="skolem">n</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> upt_rec<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> id bi list.simps horner_composition.simps id2
        <span class="keyword1"><span class="command">unfolding</span></span> IH<span class="main">[</span><span class="operator">unfolded</span> id2 list.simps<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> X_def<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> newton_poly_impl_def newton_coefficients rev_rev_ident newton_poly_def i_def
      assms<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> xs <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>
<span class="keyword2"><span class="keyword">end</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">context</span></span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">xs</span> <span class="free">fs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"int list"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">divided_differences_impl_int</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"int list <span class="main">⇒</span> int <span class="main">⇒</span> int <span class="main">⇒</span> int list <span class="main">⇒</span> int list option"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">divided_differences_impl_int</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">xi_j1</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">x_j1s</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">fj</span></span></span> <span class="free"><span class="bound"><span class="entity">xj</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">xi</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">xis</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>
     <span class="keyword1">case</span> <span class="free">divided_differences_impl_int</span> <span class="free"><span class="bound"><span class="entity">x_j1s</span></span></span> <span class="free"><span class="bound"><span class="entity">fj</span></span></span> <span class="free"><span class="bound"><span class="entity">xj</span></span></span> <span class="free"><span class="bound"><span class="entity">xis</span></span></span> <span class="keyword1">of</span> None <span class="main">⇒</span> None
   <span class="main">|</span> Some <span class="bound">x_js</span> <span class="main">⇒</span> <span class="keyword1">let</span> <span class="main">(</span><span class="bound">new</span><span class="main">,</span><span class="bound">m</span><span class="main">)</span> <span class="main">=</span> divmod_int <span class="main">(</span>hd <span class="bound">x_js</span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">xi_j1</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">xj</span></span></span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">xi</span></span></span><span class="main">)</span>
     <span class="keyword1">in</span> <span class="keyword1">if</span> <span class="bound">m</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> Some <span class="main">(</span><span class="bound">new</span> <span class="main">#</span> <span class="bound">x_js</span><span class="main">)</span> <span class="keyword1">else</span> None<span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">divided_differences_impl_int</span> <span class="main">[]</span> <span class="free"><span class="bound"><span class="entity">fj</span></span></span> <span class="free"><span class="bound"><span class="entity">xj</span></span></span> <span class="free"><span class="bound"><span class="entity">xis</span></span></span> <span class="main">=</span> Some <span class="main">[</span><span class="free"><span class="bound"><span class="entity">fj</span></span></span><span class="main">]</span>"</span></span>
   
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">newton_coefficients_main_int</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"int list <span class="main">⇒</span> int list <span class="main">⇒</span> int list list option"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">newton_coefficients_main_int</span> <span class="main">[</span><span class="free"><span class="bound"><span class="entity">fj</span></span></span><span class="main">]</span> <span class="free"><span class="bound"><span class="entity">xjs</span></span></span> <span class="main">=</span> Some <span class="main">[</span><span class="main">[</span><span class="free"><span class="bound"><span class="entity">fj</span></span></span><span class="main">]</span><span class="main">]</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">newton_coefficients_main_int</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">fj</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">fjs</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">xj</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">xjs</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">do</span> <span class="main">{</span>
    <span class="bound">rec</span> <span class="main">←</span> <span class="free">newton_coefficients_main_int</span> <span class="free"><span class="bound"><span class="entity">fjs</span></span></span> <span class="free"><span class="bound"><span class="entity">xjs</span></span></span><span class="main">;</span>
    <span class="keyword1">let</span> <span class="bound">row</span> <span class="main">=</span> hd <span class="bound">rec</span><span class="main">;</span>
    <span class="bound">new_row</span> <span class="main">←</span> divided_differences_impl_int <span class="bound">row</span> <span class="free"><span class="bound"><span class="entity">fj</span></span></span> <span class="free"><span class="bound"><span class="entity">xj</span></span></span> <span class="free">xs</span><span class="main">;</span>
    Some <span class="main">(</span><span class="bound">new_row</span> <span class="main">#</span> <span class="bound">rec</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">newton_coefficients_main_int</span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">=</span> Some <span class="main">[]</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">newton_coefficients_int</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"int list option"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">newton_coefficients_int</span> <span class="main">=</span> map_option <span class="main">(</span>map hd<span class="main">)</span> <span class="main">(</span>newton_coefficients_main_int <span class="main">(</span>rev <span class="free">fs</span><span class="main">)</span> <span class="main">(</span>rev <span class="free">xs</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Newton_Interpolation-divided_differences_impl_int_Some"><span class="command">lemma</span></span> divided_differences_impl_int_Some<span class="main">:</span>
  <span class="quoted"><span class="quoted">"length <span class="free">gs</span> <span class="main">≤</span> length <span class="free">ys</span> 
  <span class="main">⟹</span> divided_differences_impl_int <span class="free">gs</span> <span class="free">g</span> <span class="free">x</span> <span class="free">ys</span> <span class="main">=</span> Some <span class="free">res</span>
  <span class="main">⟹</span> divided_differences_impl <span class="main">(</span>map rat_of_int <span class="free">gs</span><span class="main">)</span> <span class="main">(</span>rat_of_int <span class="free">g</span><span class="main">)</span> <span class="main">(</span>rat_of_int <span class="free">x</span><span class="main">)</span> <span class="main">(</span>map rat_of_int <span class="free">ys</span><span class="main">)</span> <span class="main">=</span> map rat_of_int <span class="free">res</span>
    <span class="main">∧</span> length <span class="free">res</span> <span class="main">=</span> Suc <span class="main">(</span>length <span class="free">gs</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">gs</span></span> <span class="quoted"><span class="free">g</span></span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="free">ys</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">res</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> divided_differences_impl_int.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">xi_j1</span> <span class="skolem">x_j1s</span> <span class="skolem">fj</span> <span class="skolem">xj</span> <span class="skolem">xi</span> <span class="skolem">xis</span><span class="main">)</span>
  <span class="keyword1"><span class="command">note</span></span> some <span class="main">=</span> 1<span class="main">(</span>3<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> 1<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> len<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="skolem">x_j1s</span> <span class="main">≤</span> length <span class="skolem">xis</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> some <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x_js</span></span> <span class="keyword2"><span class="keyword">where</span></span> rec<span class="main">:</span> <span class="quoted"><span class="quoted">"divided_differences_impl_int <span class="skolem">x_j1s</span> <span class="skolem">fj</span> <span class="skolem">xj</span> <span class="skolem">xis</span> <span class="main">=</span> Some <span class="skolem">x_js</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span>
  <span class="keyword1"><span class="command">note</span></span> IH <span class="main">=</span> 1<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> len rec<span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"hd <span class="main">(</span>map rat_of_int <span class="skolem">x_js</span><span class="main">)</span> <span class="main">=</span> rat_of_int <span class="main">(</span>hd <span class="skolem">x_js</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> IH <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x_js</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> some<span class="main">[</span><span class="operator">simplified</span><span class="main">,</span> <span class="operator">unfolded</span> rec divmod_int_def<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> mod<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>hd <span class="skolem">x_js</span> <span class="main">-</span> <span class="skolem">xi_j1</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="main">(</span><span class="skolem">xj</span> <span class="main">-</span> <span class="skolem">xi</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> res<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">res</span> <span class="main">=</span> <span class="main">(</span>hd <span class="skolem">x_js</span> <span class="main">-</span> <span class="skolem">xi_j1</span><span class="main">)</span> <span class="keyword1">div</span> <span class="main">(</span><span class="skolem">xj</span> <span class="main">-</span> <span class="skolem">xi</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">x_js</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rat_of_int <span class="main">(</span><span class="main">(</span>hd <span class="skolem">x_js</span> <span class="main">-</span> <span class="skolem">xi_j1</span><span class="main">)</span> <span class="keyword1">div</span> <span class="main">(</span><span class="skolem">xj</span> <span class="main">-</span> <span class="skolem">xi</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> rat_of_int <span class="main">(</span>hd <span class="skolem">x_js</span> <span class="main">-</span> <span class="skolem">xi_j1</span><span class="main">)</span> <span class="main">/</span> rat_of_int <span class="main">(</span><span class="skolem">xj</span> <span class="main">-</span> <span class="skolem">xi</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> mod <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>rat_of_int <span class="main">(</span>hd <span class="skolem">x_js</span><span class="main">)</span> <span class="main">-</span> rat_of_int <span class="skolem">xi_j1</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span>rat_of_int <span class="skolem">xj</span> <span class="main">-</span> rat_of_int <span class="skolem">xi</span><span class="main">)</span> <span class="main">=</span> 
    rat_of_int <span class="main">(</span><span class="main">(</span>hd <span class="skolem">x_js</span> <span class="main">-</span> <span class="skolem">xi_j1</span><span class="main">)</span> <span class="keyword1">div</span> <span class="main">(</span><span class="skolem">xj</span> <span class="main">-</span> <span class="skolem">xi</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> IH Let_def res id<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">fj</span> <span class="skolem">xj</span> <span class="skolem">xis</span> <span class="skolem">res</span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> res<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">res</span> <span class="main">=</span> <span class="main">[</span><span class="skolem">fj</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Newton_Interpolation-div_Ints_mod_0"><span class="command">lemma</span></span> div_Ints_mod_0<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"rat_of_int <span class="free">a</span> <span class="main">/</span> rat_of_int <span class="free">b</span> <span class="main">∈</span> <span class="main">ℤ</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="keyword1">mod</span> <span class="free">b</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">=</span> int_of_rat <span class="main">(</span>rat_of_int <span class="free">a</span> <span class="main">/</span> rat_of_int <span class="free">b</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rat_of_int <span class="free">a</span> <span class="main">/</span> rat_of_int <span class="free">b</span> <span class="main">=</span> rat_of_int <span class="skolem">c</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> c_def <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"rat_of_int <span class="free">a</span> <span class="main">=</span> rat_of_int <span class="free">b</span> <span class="main">*</span> rat_of_int <span class="skolem">c</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> divide_cancel_right nonzero_mult_div_cancel_left of_int_eq_0_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> <span class="free">b</span> <span class="main">*</span> <span class="skolem">c</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> of_int_hom.injectivity<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="keyword1">mod</span> <span class="free">b</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> a <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Newton_Interpolation-divided_differences_impl_int_None"><span class="command">lemma</span></span> divided_differences_impl_int_None<span class="main">:</span>
  <span class="quoted"><span class="quoted">"length <span class="free">gs</span> <span class="main">≤</span> length <span class="free">ys</span> 
  <span class="main">⟹</span> divided_differences_impl_int <span class="free">gs</span> <span class="free">g</span> <span class="free">x</span> <span class="free">ys</span> <span class="main">=</span> None
  <span class="main">⟹</span> <span class="free">x</span> <span class="main">∉</span> set <span class="main">(</span>take <span class="main">(</span>length <span class="free">gs</span><span class="main">)</span> <span class="free">ys</span><span class="main">)</span>
  <span class="main">⟹</span> hd <span class="main">(</span>divided_differences_impl <span class="main">(</span>map rat_of_int <span class="free">gs</span><span class="main">)</span> <span class="main">(</span>rat_of_int <span class="free">g</span><span class="main">)</span> <span class="main">(</span>rat_of_int <span class="free">x</span><span class="main">)</span> <span class="main">(</span>map rat_of_int <span class="free">ys</span><span class="main">)</span><span class="main">)</span> <span class="main">∉</span> <span class="main">ℤ</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">gs</span></span> <span class="quoted"><span class="free">g</span></span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="free">ys</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> divided_differences_impl_int.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">xi_j1</span> <span class="skolem">x_j1s</span> <span class="skolem">fj</span> <span class="skolem">xj</span> <span class="skolem">xi</span> <span class="skolem">xis</span><span class="main">)</span>
  <span class="keyword1"><span class="command">note</span></span> none <span class="main">=</span> 1<span class="main">(</span>3<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> 1<span class="main">(</span>2<span class="main">,</span>4<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> len<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="skolem">x_j1s</span> <span class="main">≤</span> length <span class="skolem">xis</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> xj<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">xj</span> <span class="main">∉</span> set <span class="main">(</span>take <span class="main">(</span>length <span class="skolem">x_j1s</span><span class="main">)</span> <span class="skolem">xis</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> xji<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">xj</span> <span class="main">≠</span> <span class="skolem">xi</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">d</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> divided_differences_impl <span class="main">(</span>map rat_of_int <span class="skolem">x_j1s</span><span class="main">)</span> <span class="main">(</span>rat_of_int <span class="skolem">fj</span><span class="main">)</span> <span class="main">(</span>rat_of_int <span class="skolem">xj</span><span class="main">)</span> <span class="main">(</span>map rat_of_int <span class="skolem">xis</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">note</span></span> IH <span class="main">=</span> 1<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> len _ xj<span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"divided_differences_impl_int <span class="skolem">x_j1s</span> <span class="skolem">fj</span> <span class="skolem">xj</span> <span class="skolem">xis</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> None
    <span class="keyword1"><span class="command">from</span></span> IH<span class="main">[</span><span class="operator">OF</span> None<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> d<span class="main">:</span> <span class="quoted"><span class="quoted">"hd <span class="skolem">d</span> <span class="main">∉</span> <span class="main">ℤ</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> d_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?x</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>hd <span class="skolem">d</span> <span class="main">-</span> rat_of_int <span class="skolem">xi_j1</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span>rat_of_int <span class="skolem">xj</span> <span class="main">-</span> rat_of_int <span class="skolem">xi</span><span class="main">)</span>"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="var">?x</span> <span class="main">∈</span> <span class="main">ℤ</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?x</span> <span class="main">*</span> <span class="main">(</span>of_int <span class="main">(</span><span class="skolem">xj</span> <span class="main">-</span> <span class="skolem">xi</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> rat_of_int <span class="skolem">xi_j1</span> <span class="main">∈</span> <span class="main">ℤ</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> Ints_mult Ints_add Ints_of_int <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?x</span> <span class="main">*</span> <span class="main">(</span>of_int <span class="main">(</span><span class="skolem">xj</span> <span class="main">-</span> <span class="skolem">xi</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> hd <span class="skolem">d</span> <span class="main">-</span> rat_of_int <span class="skolem">xi_j1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> xji <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">+</span> rat_of_int <span class="skolem">xi_j1</span> <span class="main">=</span> hd <span class="skolem">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> d <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Let_def d_def<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Some <span class="skolem">res</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> divided_differences_impl_int_Some<span class="main">[</span><span class="operator">OF</span> len Some<span class="main">]</span>
    <span class="keyword1"><span class="command">have</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"divided_differences_impl <span class="main">(</span>map rat_of_int <span class="skolem">x_j1s</span><span class="main">)</span> <span class="main">(</span>rat_of_int <span class="skolem">fj</span><span class="main">)</span> <span class="main">(</span>rat_of_int <span class="skolem">xj</span><span class="main">)</span> <span class="main">(</span>map rat_of_int <span class="skolem">xis</span><span class="main">)</span> <span class="main">=</span>
      map rat_of_int <span class="skolem">res</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> res<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">res</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> hd<span class="main">:</span> <span class="quoted"><span class="quoted">"hd <span class="main">(</span>map rat_of_int <span class="skolem">res</span><span class="main">)</span> <span class="main">=</span> of_int <span class="main">(</span>hd <span class="skolem">res</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> res <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">res</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> <span class="main">(</span>hd <span class="skolem">res</span> <span class="main">-</span> <span class="skolem">xi_j1</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">=</span> <span class="skolem">xj</span> <span class="main">-</span> <span class="skolem">xi</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> none<span class="main">[</span><span class="operator">simplified</span><span class="main">,</span> <span class="operator">unfolded</span> Some divmod_int_def<span class="main">]</span> 
    <span class="keyword1"><span class="command">have</span></span> mod<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="keyword1">mod</span> <span class="skolem">b</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> a_def b_def<span class="main">)</span>
    <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>rat_of_int <span class="main">(</span>hd <span class="skolem">res</span><span class="main">)</span> <span class="main">-</span> rat_of_int <span class="skolem">xi_j1</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span>rat_of_int <span class="skolem">xj</span> <span class="main">-</span> rat_of_int <span class="skolem">xi</span><span class="main">)</span> <span class="main">∈</span> <span class="main">ℤ</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"rat_of_int <span class="skolem">a</span> <span class="main">/</span> rat_of_int <span class="skolem">b</span> <span class="main">∈</span> <span class="main">ℤ</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> a_def b_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> xji <span class="keyword1"><span class="command">unfolding</span></span> b_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> mod div_Ints_mod_0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> id Let_def hd<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
  
<span class="keyword1" id="Newton_Interpolation-newton_coefficients_main_int_Some"><span class="command">lemma</span></span> newton_coefficients_main_int_Some<span class="main">:</span>
  <span class="quoted"><span class="quoted">"length <span class="free">gs</span> <span class="main">=</span> length <span class="free">ys</span> <span class="main">⟹</span> length <span class="free">ys</span> <span class="main">≤</span> length <span class="free">xs</span>  
  <span class="main">⟹</span> newton_coefficients_main_int <span class="free">gs</span> <span class="free">ys</span> <span class="main">=</span> Some <span class="free">res</span>
  <span class="main">⟹</span> newton_coefficients_main <span class="main">(</span>map rat_of_int <span class="free">xs</span><span class="main">)</span> <span class="main">(</span>map rat_of_int <span class="free">gs</span><span class="main">)</span> <span class="main">(</span>map rat_of_int <span class="free">ys</span><span class="main">)</span> <span class="main">=</span> map <span class="main">(</span>map rat_of_int<span class="main">)</span> <span class="free">res</span>
    <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">x</span> <span class="main">∈</span> set <span class="free">res</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">∧</span> length <span class="bound">x</span> <span class="main">≤</span> length <span class="free">ys</span><span class="main">)</span> <span class="main">∧</span> length <span class="free">res</span> <span class="main">=</span> length <span class="free">gs</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">gs</span></span> <span class="quoted"><span class="free">ys</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">res</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> newton_coefficients_main_int.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">fv</span> <span class="skolem">v</span> <span class="skolem">va</span> <span class="skolem">xj</span> <span class="skolem">xjs</span> <span class="skolem">res</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> 2<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> len<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="skolem">v</span> <span class="main">#</span> <span class="skolem">va</span><span class="main">)</span> <span class="main">=</span> length <span class="skolem">xjs</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">xjs</span> <span class="main">≤</span> length <span class="free">xs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">note</span></span> some <span class="main">=</span> 2<span class="main">(</span>4<span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?n</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"newton_coefficients_main_int <span class="main">(</span><span class="skolem">v</span> <span class="main">#</span> <span class="skolem">va</span><span class="main">)</span> <span class="skolem">xjs</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ri</span></span></span> <span class="main">=</span> <span class="quoted">rat_of_int</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?mri</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"map <span class="var">?ri</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> some <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">rec</span></span> <span class="keyword2"><span class="keyword">where</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?n</span> <span class="main">=</span> Some <span class="skolem">rec</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="var"><span class="quoted"><span class="var">?n</span></span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">note</span></span> some <span class="main">=</span> some<span class="main">[</span><span class="operator">simplified</span><span class="main">,</span> <span class="operator">unfolded</span> n<span class="main">]</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?d</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"divided_differences_impl_int <span class="main">(</span>hd <span class="skolem">rec</span><span class="main">)</span> <span class="skolem">fv</span> <span class="skolem">xj</span> <span class="free">xs</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> some <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">dd</span></span> <span class="keyword2"><span class="keyword">where</span></span> d<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?d</span> <span class="main">=</span> Some <span class="skolem">dd</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> res<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">res</span> <span class="main">=</span> <span class="skolem">dd</span> <span class="main">#</span> <span class="skolem">rec</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="var"><span class="quoted"><span class="var">?d</span></span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">note</span></span> IH <span class="main">=</span> 2<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> len n<span class="main">]</span>
  <span class="keyword1"><span class="command">from</span></span> IH <span class="keyword1"><span class="command">have</span></span> lenn<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>hd <span class="skolem">rec</span><span class="main">)</span> <span class="main">≤</span> length <span class="skolem">xjs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">rec</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> len <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>hd <span class="skolem">rec</span><span class="main">)</span> <span class="main">≤</span> length <span class="free">xs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">note</span></span> dd <span class="main">=</span> divided_differences_impl_int_Some<span class="main">[</span><span class="operator">OF</span> this d<span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> hd<span class="main">:</span> <span class="quoted"><span class="quoted">"hd <span class="main">(</span>map <span class="var">?mri</span> <span class="skolem">rec</span><span class="main">)</span> <span class="main">=</span> <span class="var">?mri</span> <span class="main">(</span>hd <span class="skolem">rec</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> IH <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">rec</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> newton_coefficients_main.simps list.simps
    IH<span class="main">[</span><span class="operator">THEN</span> conjunct1<span class="main">,</span> <span class="operator">unfolded</span> list.simps<span class="main">]</span> Let_def hd
    dd<span class="main">[</span><span class="operator">THEN</span> conjunct1<span class="main">]</span> res 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> conjI<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="skolem">dd</span> <span class="main">#</span> <span class="skolem">rec</span><span class="main">)</span> <span class="main">=</span> length <span class="main">(</span><span class="skolem">fv</span> <span class="main">#</span> <span class="skolem">v</span> <span class="main">#</span> <span class="skolem">va</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> len
      IH<span class="main">[</span><span class="operator">THEN</span> conjunct2<span class="main">]</span> dd<span class="main">[</span><span class="operator">THEN</span> conjunct2<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>insert <span class="skolem">dd</span> <span class="main">(</span>set <span class="skolem">rec</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">∧</span> length <span class="bound">x</span> <span class="main">≤</span> length <span class="main">(</span><span class="skolem">xj</span> <span class="main">#</span> <span class="skolem">xjs</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> len IH<span class="main">[</span><span class="operator">THEN</span> conjunct2<span class="main">]</span> dd<span class="main">[</span><span class="operator">THEN</span> conjunct2<span class="main">]</span> lenn <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Newton_Interpolation-newton_coefficients_main_int_None"><span class="command">lemma</span></span> newton_coefficients_main_int_None<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> dist<span class="main">:</span> <span class="quoted"><span class="quoted">"distinct <span class="free">xs</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"length <span class="free">gs</span> <span class="main">=</span> length <span class="free">ys</span> <span class="main">⟹</span> length <span class="free">ys</span> <span class="main">≤</span> length <span class="free">xs</span>  
  <span class="main">⟹</span> newton_coefficients_main_int <span class="free">gs</span> <span class="free">ys</span> <span class="main">=</span> None
  <span class="main">⟹</span> <span class="free">ys</span> <span class="main">=</span> drop <span class="main">(</span>length <span class="free">xs</span> <span class="main">-</span> length <span class="free">ys</span><span class="main">)</span> <span class="main">(</span>rev <span class="free">xs</span><span class="main">)</span>
  <span class="main">⟹</span> <span class="main">∃</span> <span class="bound">row</span> <span class="main">∈</span> set <span class="main">(</span>newton_coefficients_main <span class="main">(</span>map rat_of_int <span class="free">xs</span><span class="main">)</span> <span class="main">(</span>map rat_of_int <span class="free">gs</span><span class="main">)</span> <span class="main">(</span>map rat_of_int <span class="free">ys</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> hd <span class="bound">row</span> <span class="main">∉</span> <span class="main">ℤ</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">gs</span></span> <span class="quoted"><span class="free">ys</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> newton_coefficients_main_int.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">fv</span> <span class="skolem">v</span> <span class="skolem">va</span> <span class="skolem">xj</span> <span class="skolem">xjs</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> 2<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> len<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="skolem">v</span> <span class="main">#</span> <span class="skolem">va</span><span class="main">)</span> <span class="main">=</span> length <span class="skolem">xjs</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">xjs</span> <span class="main">≤</span> length <span class="free">xs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> arg_cong<span class="main">[</span><span class="operator">OF</span> 2<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted">tl</span><span class="main">]</span> 2<span class="main">(</span>3<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> xjs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">xjs</span> <span class="main">=</span> drop <span class="main">(</span>length <span class="free">xs</span> <span class="main">-</span> length <span class="skolem">xjs</span><span class="main">)</span> <span class="main">(</span>rev <span class="free">xs</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> 2<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> butlast_snoc butlast_take length_drop rev.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> rev_drop rev_rev_ident rev_take<span class="main">)</span>
  <span class="keyword1"><span class="command">note</span></span> none <span class="main">=</span> 2<span class="main">(</span>4<span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?n</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"newton_coefficients_main_int <span class="main">(</span><span class="skolem">v</span> <span class="main">#</span> <span class="skolem">va</span><span class="main">)</span> <span class="skolem">xjs</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?n'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"newton_coefficients_main <span class="main">(</span>map rat_of_int <span class="free">xs</span><span class="main">)</span> <span class="main">(</span>map rat_of_int <span class="main">(</span><span class="skolem">v</span> <span class="main">#</span> <span class="skolem">va</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>map rat_of_int <span class="skolem">xjs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ri</span></span></span> <span class="main">=</span> <span class="quoted">rat_of_int</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?mri</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"map <span class="var">?ri</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="var"><span class="quoted"><span class="var">?n</span></span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> None
    <span class="keyword1"><span class="command">from</span></span> 2<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> len None xjs<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">row</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
      row<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">row</span><span class="main">∈</span>set <span class="var">?n'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"hd <span class="skolem">row</span> <span class="main">∉</span> <span class="main">ℤ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> bexI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">row</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Let_def<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Some <span class="skolem">rec</span><span class="main">)</span>
    <span class="keyword1"><span class="command">note</span></span> some <span class="main">=</span> newton_coefficients_main_int_Some<span class="main">[</span><span class="operator">OF</span> len this<span class="main">]</span>
    <span class="keyword1"><span class="command">hence</span></span> len'<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>hd <span class="skolem">rec</span><span class="main">)</span> <span class="main">≤</span> length <span class="skolem">xjs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">rec</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> lenn<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>hd <span class="skolem">rec</span><span class="main">)</span> <span class="main">≤</span> length <span class="free">xs</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> len <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> hd<span class="main">:</span> <span class="quoted"><span class="quoted">"hd <span class="main">(</span>map <span class="var">?mri</span> <span class="skolem">rec</span><span class="main">)</span> <span class="main">=</span> <span class="var">?mri</span> <span class="main">(</span>hd <span class="skolem">rec</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> some <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">rec</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?d</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"divided_differences_impl_int <span class="main">(</span>hd <span class="skolem">rec</span><span class="main">)</span> <span class="skolem">fv</span> <span class="skolem">xj</span> <span class="free">xs</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> none<span class="main">[</span><span class="operator">simplified</span><span class="main">,</span> <span class="operator">unfolded</span> Some<span class="main">]</span>
    <span class="keyword1"><span class="command">have</span></span> none<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?d</span> <span class="main">=</span> None"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="var"><span class="quoted"><span class="var">?d</span></span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xj</span> <span class="main">∉</span> set <span class="main">(</span>take <span class="main">(</span>length <span class="main">(</span>hd <span class="skolem">rec</span><span class="main">)</span><span class="main">)</span> <span class="free">xs</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xj</span> <span class="main">∈</span> set <span class="main">(</span>take <span class="main">(</span>length <span class="main">(</span>hd <span class="skolem">rec</span><span class="main">)</span><span class="main">)</span> <span class="free">xs</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="main">(</span>hd <span class="skolem">rec</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> xj<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">xj</span> <span class="main">=</span> <span class="free">xs</span> <span class="main">!</span> <span class="skolem">i</span>"</span></span> 
        <span class="keyword1"><span class="command">unfolding</span></span> in_set_conv_nth <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> len' <span class="keyword1"><span class="command">have</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="skolem">xjs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span>length <span class="skolem">xjs</span><span class="main">)</span> <span class="main">≤</span> length <span class="free">xs</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> 2<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> i <span class="keyword1"><span class="command">have</span></span> i0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> 2<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> Suc_diff_Suc Suc_le_lessD diff_less dist distinct_conv_nth 
          hd_drop_conv_nth length_Cons length_drop length_greater_0_conv length_rev less_le_trans 
          list.sel<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> list.simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> nat_neq_iff rev_nth xj xjs<span class="main">)</span>      
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xj</span> <span class="main">∈</span> set <span class="skolem">xjs</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> xjs<span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> xj in_set_conv_nth<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"length <span class="skolem"><span class="skolem"><span class="skolem">xjs</span></span></span> <span class="main"><span class="main"><span class="main">-</span></span></span> Suc <span class="skolem"><span class="skolem"><span class="skolem">i</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> i 2<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> i0<span class="main"><span class="keyword3">,</span></span>
           <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> rev_nth<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> ndist<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> distinct <span class="main">(</span><span class="skolem">xj</span> <span class="main">#</span> <span class="skolem">xjs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> dist <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>rev <span class="free">xs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">from</span></span> distinct_drop<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span><span class="skolem">xj</span> <span class="main">#</span> <span class="skolem">xjs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> 2<span class="main">(</span>5<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
      <span class="keyword1"><span class="command">with</span></span> ndist
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">note</span></span> dd <span class="main">=</span> divided_differences_impl_int_None<span class="main">[</span><span class="operator">OF</span> lenn none this<span class="main">]</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> bexI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> dd<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> some hd<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>


<span class="keyword1" id="Newton_Interpolation-newton_coefficients_int"><span class="command">lemma</span></span> newton_coefficients_int<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> dist<span class="main">:</span> <span class="quoted"><span class="quoted">"distinct <span class="free">xs</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> len<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="free">xs</span> <span class="main">=</span> length <span class="free">fs</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"newton_coefficients_int <span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span> <span class="bound">cs</span> <span class="main">=</span> newton_coefficients <span class="main">(</span>map rat_of_int <span class="free">xs</span><span class="main">)</span> <span class="main">(</span>map of_int <span class="free">fs</span><span class="main">)</span>
    <span class="keyword1">in</span> <span class="keyword1">if</span> set <span class="bound">cs</span> <span class="main">⊆</span> <span class="main">ℤ</span> <span class="keyword1">then</span> Some <span class="main">(</span>map int_of_rat <span class="bound">cs</span><span class="main">)</span> <span class="keyword1">else</span> None<span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> len <span class="keyword1"><span class="command">have</span></span> len<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>rev <span class="free">fs</span><span class="main">)</span> <span class="main">=</span> length <span class="main">(</span>rev <span class="free">xs</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>rev <span class="free">xs</span><span class="main">)</span> <span class="main">≤</span> length <span class="free">xs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"newton_coefficients_main_int <span class="main">(</span>rev <span class="free">fs</span><span class="main">)</span> <span class="main">(</span>rev <span class="free">xs</span><span class="main">)</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Some <span class="skolem">res</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> rev<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">xs</span><span class="main">.</span> map rat_of_int <span class="main">(</span>rev <span class="bound">xs</span><span class="main">)</span> <span class="main">=</span> rev <span class="main">(</span>map of_int <span class="bound">xs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> rev_map <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">note</span></span> n <span class="main">=</span> newton_coefficients_main_int_Some<span class="main">[</span><span class="operator">OF</span> len Some<span class="main">,</span> <span class="operator">unfolded</span> rev<span class="main">]</span>
    <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">row</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">row</span> <span class="main">∈</span> set <span class="skolem">res</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> n <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">row</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"hd <span class="main">(</span>map rat_of_int <span class="skolem">row</span><span class="main">)</span> <span class="main">=</span> rat_of_int <span class="main">(</span>hd <span class="skolem">row</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">row</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">∈</span> <span class="main">ℤ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> int<span class="main">:</span> <span class="quoted"><span class="quoted">"hd <span class="main">(</span>map rat_of_int <span class="skolem">row</span><span class="main">)</span> <span class="main">∈</span> <span class="main">ℤ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"hd <span class="skolem">row</span> <span class="main">=</span> int_of_rat <span class="main">(</span>hd <span class="main">(</span>map rat_of_int <span class="skolem">row</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> id <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">note</span></span> this int
    <span class="keyword1"><span class="command">}</span></span> 
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> newton_coefficients_int_def Some newton_coefficients_def n<span class="main">[</span><span class="operator">THEN</span> conjunct1<span class="main">]</span> Let_def option.simps
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> o_def<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> None
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rev <span class="free">xs</span> <span class="main">=</span> drop <span class="main">(</span>length <span class="free">xs</span> <span class="main">-</span> length <span class="main">(</span>rev <span class="free">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>rev <span class="free">xs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> newton_coefficients_main_int_None<span class="main">[</span><span class="operator">OF</span> dist len None this<span class="main">]</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> newton_coefficients_int_def newton_coefficients_def None <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Let_def rev_map<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">newton_poly_impl_int</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"int poly option"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">newton_poly_impl_int</span> <span class="main">≡</span> <span class="keyword1">case</span> newton_coefficients_int <span class="keyword1">of</span> None <span class="main">⇒</span> None 
     <span class="main">|</span> Some <span class="bound">nc</span> <span class="main">⇒</span> Some <span class="main">(</span>horner_composition <span class="main">(</span>rev <span class="bound">nc</span><span class="main">)</span> <span class="free">xs</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Newton_Interpolation-newton_poly_impl_int"><span class="command">lemma</span></span> newton_poly_impl_int<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> len<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="free">xs</span> <span class="main">=</span> length <span class="free">fs</span>"</span></span> 
  <span class="keyword2"><span class="keyword">and</span></span> dist<span class="main">:</span> <span class="quoted"><span class="quoted">"distinct <span class="free">xs</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"newton_poly_impl_int <span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span> <span class="bound">p</span> <span class="main">=</span> newton_poly_impl <span class="main">(</span>map rat_of_int <span class="free">xs</span><span class="main">)</span> <span class="main">(</span>map of_int <span class="free">fs</span><span class="main">)</span>
    <span class="keyword1">in</span> <span class="keyword1">if</span> set <span class="main">(</span>coeffs <span class="bound">p</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">ℤ</span> <span class="keyword1">then</span> Some <span class="main">(</span>map_poly int_of_rat <span class="bound">p</span><span class="main">)</span> <span class="keyword1">else</span> None<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ir</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"int_of_rat"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ri</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"rat_of_int"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?mir</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"map <span class="var">?ir</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?mri</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"map <span class="var">?ri</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?nc</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"newton_coefficients <span class="main">(</span><span class="var">?mri</span> <span class="free">xs</span><span class="main">)</span> <span class="main">(</span><span class="var">?mri</span> <span class="free">fs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"newton_poly_impl_int <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> set <span class="var">?nc</span> <span class="main">⊆</span> <span class="main">ℤ</span>
    <span class="keyword1">then</span> Some <span class="main">(</span>horner_composition <span class="main">(</span>rev <span class="main">(</span><span class="var">?mir</span> <span class="var">?nc</span><span class="main">)</span><span class="main">)</span> <span class="free">xs</span><span class="main">)</span> <span class="keyword1">else</span> None<span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> newton_poly_impl_int_def newton_coefficients_int<span class="main">[</span><span class="operator">OF</span> dist len<span class="main">]</span> Let_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> len<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>rev <span class="var">?nc</span><span class="main">)</span> <span class="main">≤</span> Suc <span class="main">(</span>length <span class="free">xs</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> length_rev
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> newton_coefficients<span class="main"><span class="main">[</span></span><span class="operator">OF</span> refl<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> len<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span> 
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> id
    <span class="keyword1"><span class="command">unfolding</span></span> newton_poly_impl_def
    <span class="keyword1"><span class="command">unfolding</span></span> Let_def set_rev rev_map horner_coeffs_ints<span class="main">[</span><span class="operator">OF</span> len<span class="main">]</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> if_cong<span class="main"><span class="main">[</span></span><span class="operator">OF</span> refl _ refl<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> arg_cong<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">Some</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">cs</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">cs</span> <span class="main">=</span> rev <span class="var">?nc</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">ics</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ics</span> <span class="main">=</span> map <span class="var">?ir</span> <span class="skolem">cs</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"set <span class="var">?nc</span> <span class="main">⊆</span> <span class="main">ℤ</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"set <span class="skolem">cs</span> <span class="main">⊆</span> <span class="main">ℤ</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> cs_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> ics<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">cs</span> <span class="main">=</span> <span class="var">?mri</span> <span class="skolem">ics</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> ics_def map_map o_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> map_idI subset_code<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>      
    <span class="keyword1"><span class="command">have</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"horner_composition <span class="main">(</span>rev <span class="var">?nc</span><span class="main">)</span> <span class="main">(</span><span class="var">?mri</span> <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> map_poly <span class="var">?ri</span> <span class="main">(</span>horner_composition <span class="skolem">ics</span> <span class="free">xs</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> cs_def<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> ics
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> of_int_poly_hom.horner_composition_hom<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"horner_composition <span class="main">(</span><span class="var">?mir</span> <span class="main">(</span>rev <span class="var">?nc</span><span class="main">)</span><span class="main">)</span> <span class="free">xs</span>
      <span class="main">=</span> map_poly <span class="var">?ir</span> <span class="main">(</span>horner_composition <span class="main">(</span>rev <span class="var">?nc</span><span class="main">)</span> <span class="main">(</span><span class="var">?mri</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> id <span class="keyword1"><span class="command">unfolding</span></span> cs_def<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> ics_def<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> map_poly_map_poly<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> o_def map_poly_idI<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">newton_interpolation_poly</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">::</span> field <span class="main">×</span> <span class="tfree">'a</span><span class="main">)</span>list <span class="main">⇒</span> <span class="tfree">'a</span> poly"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">newton_interpolation_poly</span> <span class="free"><span class="bound"><span class="entity">x_fs</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span> 
    <span class="bound">xs</span> <span class="main">=</span> map fst <span class="free"><span class="bound"><span class="entity">x_fs</span></span></span><span class="main">;</span> <span class="bound">fs</span> <span class="main">=</span> map snd <span class="free"><span class="bound"><span class="entity">x_fs</span></span></span> <span class="keyword1">in</span>
    newton_poly_impl <span class="bound">xs</span> <span class="bound">fs</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">newton_interpolation_poly_int</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>int <span class="main">×</span> int<span class="main">)</span>list <span class="main">⇒</span> int poly option"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">newton_interpolation_poly_int</span> <span class="free"><span class="bound"><span class="entity">x_fs</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span> 
    <span class="bound">xs</span> <span class="main">=</span> map fst <span class="free"><span class="bound"><span class="entity">x_fs</span></span></span><span class="main">;</span> <span class="bound">fs</span> <span class="main">=</span> map snd <span class="free"><span class="bound"><span class="entity">x_fs</span></span></span> <span class="keyword1">in</span>
    newton_poly_impl_int <span class="bound">xs</span> <span class="bound">fs</span><span class="main">)</span>"</span></span>   

<span class="keyword1" id="Newton_Interpolation-newton_interpolation_poly"><span class="command">lemma</span></span> newton_interpolation_poly<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> dist<span class="main">:</span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>map fst <span class="free">xs_ys</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> newton_interpolation_poly <span class="free">xs_ys</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> xy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">xs_ys</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="free">x</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"length <span class="free">xs_ys</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> xy <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">xs_ys</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">nn</span><span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?xs</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"map fst <span class="free">xs_ys</span>"</span></span> <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?fs</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"map snd <span class="free">xs_ys</span>"</span></span> <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?n</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">nn</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> xy<span class="main">[</span><span class="operator">unfolded</span> set_conv_nth<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span> xy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≤</span> <span class="skolem">nn</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="var">?xs</span> <span class="main">!</span> <span class="skolem">i</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">=</span> <span class="var">?fs</span> <span class="main">!</span> <span class="skolem">i</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Suc
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> fst_conv in_set_conv_nth less_Suc_eq_le nth_map snd_conv xy<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"newton_interpolation_poly <span class="free">xs_ys</span> <span class="main">=</span> newton_poly <span class="var">?xs</span> <span class="var">?fs</span> <span class="skolem">nn</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> newton_interpolation_poly_def Let_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> newton_poly_impl<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ _ Suc<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> p id
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> newton_poly_sound<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">nn</span></span></span></span> <span class="var"><span class="quoted"><span class="var"><span class="quoted"><span class="var">?xs</span></span></span></span></span> <span class="main"><span class="main">_</span></span> <span class="var"><span class="quoted"><span class="var"><span class="quoted"><span class="var">?fs</span></span></span></span></span><span class="main"><span class="main">,</span></span> <span class="operator">unfolded</span> 
      Newton_Interpolation.x_def Newton_Interpolation.f_def<span class="main"><span class="main">,</span></span> <span class="operator">OF</span> _ xy<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">,</span></span> <span class="operator">folded</span> xy<span class="main"><span class="main">(</span></span>2-<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="skolem">j</span> <span class="main">⟹</span> <span class="skolem">j</span> <span class="main">≤</span> <span class="skolem">nn</span> <span class="main">⟹</span> <span class="var">?xs</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">≠</span> <span class="var">?xs</span> <span class="main">!</span> <span class="skolem">j</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> dist Suc nth_eq_iff_index_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Newton_Interpolation-degree_newton_interpolation_poly"><span class="command">lemma</span></span> degree_newton_interpolation_poly<span class="main">:</span>  
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span>newton_interpolation_poly <span class="free">xs_ys</span><span class="main">)</span> <span class="main">≤</span> length <span class="free">xs_ys</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"length <span class="free">xs_ys</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
  <span class="keyword1"><span class="command">hence</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">xs_ys</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">xs_ys</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> 
    id newton_interpolation_poly_def Let_def list.simps newton_poly_impl_def
    Newton_Interpolation.newton_coefficients_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">nn</span><span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?xs</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"map fst <span class="free">xs_ys</span>"</span></span> <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?fs</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"map snd <span class="free">xs_ys</span>"</span></span> <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?n</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">nn</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"newton_interpolation_poly <span class="free">xs_ys</span> <span class="main">=</span> newton_poly <span class="var">?xs</span> <span class="var">?fs</span> <span class="skolem">nn</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> newton_interpolation_poly_def Let_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> newton_poly_impl<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ _ Suc<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> id <span class="keyword1"><span class="command">using</span></span> newton_poly_degree<span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?xs</span></span></span> <span class="var"><span class="quoted"><span class="var">?fs</span></span></span> <span class="quoted"><span class="skolem">nn</span></span><span class="main">]</span> Suc <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹For <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> newton_interpolation_poly_int<span class="antiquote"><span class="antiquote">}</span></span></span></span> at this point we just prove that it 
  is equivalent to perfom an interpolation on the rational numbers, and then check
  whether all resulting coefficients are integers. That this corresponds to a 
  sound and complete interpolation algorithm on the integers is proven in the theory
  Polynomial-Interpolation, cf.\ lemmas newton-interpolation-poly-int-Some/None.›</span></span>

<span class="keyword1" id="Newton_Interpolation-newton_interpolation_poly_int"><span class="command">lemma</span></span> newton_interpolation_poly_int<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> dist<span class="main">:</span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>map fst <span class="free">xs_ys</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"newton_interpolation_poly_int <span class="free">xs_ys</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span> 
     <span class="bound">rxs_ys</span> <span class="main">=</span> map <span class="main">(</span><span class="main">λ</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span>rat_of_int <span class="bound">x</span><span class="main">,</span> rat_of_int <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="free">xs_ys</span><span class="main">;</span>
     <span class="bound">rp</span> <span class="main">=</span> newton_interpolation_poly <span class="bound">rxs_ys</span>
     <span class="keyword1">in</span> <span class="keyword1">if</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">x</span> <span class="main">∈</span> set <span class="main">(</span>coeffs <span class="bound">rp</span><span class="main">)</span><span class="main">.</span> is_int_rat <span class="bound">x</span><span class="main">)</span> <span class="keyword1">then</span>
       Some <span class="main">(</span>map_poly int_of_rat <span class="bound">rp</span><span class="main">)</span> <span class="keyword1">else</span> None<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> id1<span class="main">:</span> <span class="quoted"><span class="quoted">"map fst <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span>rat_of_int <span class="bound">x</span><span class="main">,</span> rat_of_int <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="free">xs_ys</span><span class="main">)</span> <span class="main">=</span> map rat_of_int <span class="main">(</span>map fst <span class="free">xs_ys</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs_ys</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> id2<span class="main">:</span> <span class="quoted"><span class="quoted">"map snd <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span>rat_of_int <span class="bound">x</span><span class="main">,</span> rat_of_int <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="free">xs_ys</span><span class="main">)</span> <span class="main">=</span> map rat_of_int <span class="main">(</span>map snd <span class="free">xs_ys</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs_ys</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> id3<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>map fst <span class="free">xs_ys</span><span class="main">)</span> <span class="main">=</span> length <span class="main">(</span>map snd <span class="free">xs_ys</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> newton_interpolation_poly_def  newton_interpolation_poly_int_def Let_def newton_poly_impl_int<span class="main">[</span><span class="operator">OF</span> id3 dist<span class="main">]</span>
    <span class="keyword1"><span class="command">unfolding</span></span> id1 id2
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sym<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> if_cong<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> is_int_rat<span class="main"><span class="main">[</span></span><span class="operator">abs_def</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">hide_const</span></span> 
  Newton_Interpolation.x
  Newton_Interpolation.f
<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Lagrange_Interpolation">
<div class="head">
<h1>Theory Lagrange_Interpolation</h1>
</div>
<pre class="source"><span class="comment1">(*  
    Author:      René Thiemann 
                 Akihisa Yamada
    License:     BSD
*)</span>
<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Lagrange Interpolation›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We formalized the Lagrange interpolation, i.e., a method to interpolate a polynomial $p$
  from a list of points $(x_1,p(x_1)), (x_2, p(x_2)), \ldots$. The interpolation algorithm is proven
  to be sound and complete.›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Lagrange_Interpolation
<span class="keyword2"><span class="keyword">imports</span></span> 
  <a href="#Missing_Polynomial">Missing_Polynomial</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">lagrange_basis_poly</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> field list <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> poly"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">lagrange_basis_poly</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="free"><span class="bound"><span class="entity">xj</span></span></span> <span class="main">≡</span> <span class="keyword1">let</span> <span class="bound">ys</span> <span class="main">=</span> filter <span class="main">(</span><span class="main">λ</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≠</span> <span class="free"><span class="bound"><span class="entity">xj</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span>
    <span class="keyword1">in</span> prod_list <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span> <span class="bound">xi</span><span class="main">.</span> smult <span class="main">(</span>inverse <span class="main">(</span><span class="free"><span class="bound"><span class="entity">xj</span></span></span> <span class="main">-</span> <span class="bound">xi</span><span class="main">)</span><span class="main">)</span> <span class="main">[:</span> <span class="main">-</span> <span class="bound">xi</span><span class="main">,</span> <span class="main">1</span> <span class="main">:]</span><span class="main">)</span> <span class="bound">ys</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">lagrange_interpolation_poly</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">::</span> field <span class="main">×</span> <span class="tfree">'a</span><span class="main">)</span>list <span class="main">⇒</span> <span class="tfree">'a</span> poly"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">lagrange_interpolation_poly</span> <span class="free"><span class="bound"><span class="entity">xs_ys</span></span></span> <span class="main">≡</span> <span class="keyword1">let</span> 
    <span class="bound">xs</span> <span class="main">=</span> map fst <span class="free"><span class="bound"><span class="entity">xs_ys</span></span></span>
    <span class="keyword1">in</span> sum_list <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span> <span class="main">(</span><span class="bound">xj</span><span class="main">,</span><span class="bound">yj</span><span class="main">)</span><span class="main">.</span> smult <span class="bound">yj</span> <span class="main">(</span>lagrange_basis_poly <span class="bound">xs</span> <span class="bound">xj</span><span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">xs_ys</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"lagrange_basis_poly <span class="free">xs</span> <span class="free">xj</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span> <span class="bound">ys</span> <span class="main">=</span> filter <span class="main">(</span><span class="main">λ</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≠</span> <span class="free">xj</span><span class="main">)</span> <span class="free">xs</span>
    <span class="keyword1">in</span> prod_list <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span> <span class="bound">xi</span><span class="main">.</span> <span class="keyword1">let</span> <span class="bound">ii</span> <span class="main">=</span> inverse <span class="main">(</span><span class="free">xj</span> <span class="main">-</span> <span class="bound">xi</span><span class="main">)</span> <span class="keyword1">in</span> <span class="main">[:</span> <span class="main">-</span> <span class="bound">ii</span> <span class="main">*</span> <span class="bound">xi</span><span class="main">,</span> <span class="bound">ii</span> <span class="main">:]</span><span class="main">)</span> <span class="bound">ys</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> lagrange_basis_poly_def Let_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Lagrange_Interpolation-degree_lagrange_basis_poly"><span class="command">lemma</span></span> degree_lagrange_basis_poly<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span>lagrange_basis_poly <span class="free">xs</span> <span class="free">xj</span><span class="main">)</span> <span class="main">≤</span> length <span class="main">(</span>filter <span class="main">(</span><span class="main">λ</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≠</span> <span class="free">xj</span><span class="main">)</span> <span class="free">xs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> lagrange_basis_poly_def Let_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> order.trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> degree_prod_list_le<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> order_trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> sum_list_mono<span class="main"><span class="main"><span class="main">[</span></span></span><span class="operator">of</span> <span class="main"><span class="main"><span class="main">_</span></span></span> <span class="main"><span class="main"><span class="main">_</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">λ</span></span></span> <span class="main"><span class="bound"><span class="main"><span class="bound"><span class="main"><span class="bound">_</span></span></span></span></span></span><span class="main"><span class="main"><span class="main">.</span></span></span> <span class="main"><span class="main"><span class="main">1</span></span></span>"</span></span></span></span><span class="main"><span class="main"><span class="main">]</span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> 
  <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> o_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="Lagrange_Interpolation-degree_lagrange_interpolation_poly"><span class="command">lemma</span></span> degree_lagrange_interpolation_poly<span class="main">:</span>  
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span>lagrange_interpolation_poly <span class="free">xs_ys</span><span class="main">)</span> <span class="main">≤</span> length <span class="free">xs_ys</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">b</span>
    <span class="keyword3"><span class="command">assume</span></span> ab<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">b</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">xs_ys</span>"</span></span> 
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?xs</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"filter <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">≠</span><span class="skolem">a</span><span class="main">)</span> <span class="main">(</span>map fst <span class="free">xs_ys</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> ab <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> set <span class="main">(</span>map fst <span class="free">xs_ys</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span>length <span class="var">?xs</span><span class="main">)</span> <span class="main">≤</span> length <span class="free">xs_ys</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs_ys</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"length <span class="var">?xs</span> <span class="main">≤</span> length <span class="free">xs_ys</span> <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> main <span class="main">=</span> this
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> lagrange_interpolation_poly_def Let_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> degree_sum_list_le<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> order_trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> degree_lagrange_basis_poly<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> main<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Lagrange_Interpolation-lagrange_basis_poly_1"><span class="command">lemma</span></span> lagrange_basis_poly_1<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"poly <span class="main">(</span>lagrange_basis_poly <span class="main">(</span>map fst <span class="free">xs_ys</span><span class="main">)</span> <span class="free">x</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> lagrange_basis_poly_def Let_def poly_prod_list
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> prod_list_neutral<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="main">(</span><span class="operator">metis</span> field_class.field_inverse mult.commute right_diff_distrib right_minus_eq<span class="main">)</span>

<span class="keyword1" id="Lagrange_Interpolation-lagrange_basis_poly_0"><span class="command">lemma</span></span> lagrange_basis_poly_0<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x'</span> <span class="main">∈</span> set <span class="main">(</span>map fst <span class="free">xs_ys</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x'</span> <span class="main">≠</span> <span class="free">x</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"poly <span class="main">(</span>lagrange_basis_poly <span class="main">(</span>map fst <span class="free">xs_ys</span><span class="main">)</span> <span class="free">x</span><span class="main">)</span> <span class="free">x'</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">xi</span><span class="main">.</span> smult <span class="main">(</span>inverse <span class="main">(</span><span class="free">x</span> <span class="main">-</span> <span class="bound">xi</span><span class="main">)</span><span class="main">)</span> <span class="main">[:</span><span class="main">-</span> <span class="bound">xi</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?xs</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"filter <span class="main">(</span><span class="main">λ</span><span class="bound">c</span><span class="main">.</span> <span class="bound">c</span><span class="main">≠</span><span class="free">x</span><span class="main">)</span> <span class="main">(</span>map fst <span class="free">xs_ys</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> mem<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?f</span> <span class="free">x'</span> <span class="main">∈</span> set <span class="main">(</span>map <span class="var">?f</span> <span class="var">?xs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> lagrange_basis_poly_def Let_def poly_prod_list prod_list_map_remove1<span class="main">[</span><span class="operator">OF</span> mem<span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Lagrange_Interpolation-lagrange_interpolation_poly"><span class="command">lemma</span></span> lagrange_interpolation_poly<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> dist<span class="main">:</span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>map fst <span class="free">xs_ys</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> lagrange_interpolation_poly <span class="free">xs_ys</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">xs_ys</span> <span class="main">⟹</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?xs</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"map fst <span class="free">xs_ys</span>"</span></span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
    <span class="keyword3"><span class="command">assume</span></span> xy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">y</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">xs_ys</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> p lagrange_interpolation_poly_def Let_def poly_sum_list map_map o_def
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">subst</span> sum_list_map_remove1<span class="main"><span class="main">[</span></span><span class="operator">OF</span> xy<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> split poly_smult lagrange_basis_poly_1<span class="main"><span class="keyword3">,</span></span>
      <span class="operator">subst</span> sum_list_neutral<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">v</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> set <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">xa</span><span class="main">.</span> poly <span class="main">(</span><span class="keyword1">case</span> <span class="bound">xa</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">xj</span><span class="main">,</span> <span class="bound">yj</span><span class="main">)</span> <span class="main">⇒</span> smult <span class="bound">yj</span> <span class="main">(</span>lagrange_basis_poly <span class="var">?xs</span> <span class="bound">xj</span><span class="main">)</span><span class="main">)</span>
                               <span class="skolem">x</span><span class="main">)</span>
                 <span class="main">(</span>remove1 <span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span> <span class="free">xs_ys</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">∈</span> set <span class="main">(</span>map <span class="var">?f</span> <span class="var">?xy</span><span class="main">)</span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">xy'</span></span> <span class="keyword2"><span class="keyword">where</span></span> mem<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">xy'</span> <span class="main">∈</span> set <span class="var">?xy</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> v<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">=</span> <span class="var">?f</span> <span class="skolem">xy'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x'</span></span> <span class="skolem"><span class="skolem">y'</span></span> <span class="keyword2"><span class="keyword">where</span></span> xy'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">xy'</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">x'</span><span class="main">,</span><span class="skolem">y'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
      <span class="keyword1"><span class="command">from</span></span> v<span class="main">[</span><span class="operator">unfolded</span> this split<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> v<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">=</span> poly <span class="main">(</span>smult <span class="skolem">y'</span> <span class="main">(</span>lagrange_basis_poly <span class="var">?xs</span> <span class="skolem">x'</span><span class="main">)</span><span class="main">)</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">have</span></span> neq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x'</span> <span class="main">≠</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x'</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span>
        <span class="keyword1"><span class="command">with</span></span> mem<span class="main">[</span><span class="operator">unfolded</span> xy'<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> mem<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">y'</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>remove1 <span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">y</span><span class="main">)</span> <span class="free">xs_ys</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">hence</span></span> mem'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">y'</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">xs_ys</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> notin_set_remove1<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> dist<span class="main">[</span><span class="operator">unfolded</span> distinct_map<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> inj<span class="main">:</span> <span class="quoted"><span class="quoted">"inj_on fst <span class="main">(</span>set <span class="free">xs_ys</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">with</span></span> mem' xy <span class="keyword1"><span class="command">have</span></span> y'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y'</span> <span class="main">=</span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> inj_on_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
        <span class="keyword1"><span class="command">from</span></span> dist <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"distinct <span class="free">xs_ys</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> distinct_map <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">y</span><span class="main">)</span> <span class="main">∉</span> set <span class="main">(</span>remove1 <span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">y</span><span class="main">)</span> <span class="free">xs_ys</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">with</span></span> mem<span class="main">[</span><span class="operator">unfolded</span> y'<span class="main">]</span>         
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="main">(</span>lagrange_basis_poly <span class="var">?xs</span> <span class="skolem">x'</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lagrange_basis_poly_0<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> xy mem<span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> xy'<span class="main"><span class="main">]</span></span> dist neq<span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span> 
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> v <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> sound <span class="main">=</span> this
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Neville_Aitken_Interpolation">
<div class="head">
<h1>Theory Neville_Aitken_Interpolation</h1>
</div>
<pre class="source"><span class="comment1">(*  
    Author:      René Thiemann 
                 Akihisa Yamada
    License:     BSD
*)</span>
<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Neville Aitken Interpolation›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We prove soundness of Neville-Aitken's polynomial interpolation algorithm 
  using the recursive formula directly. We further provide an implementation 
  which avoids the exponential branching in the recursion.›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Neville_Aitken_Interpolation
<span class="keyword2"><span class="keyword">imports</span></span> 
  <span class="quoted">"<a href="https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL-Computational_Algebra/Polynomial.html">HOL-Computational_Algebra.Polynomial</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">context</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">::</span> field"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">definition</span></span> <span class="entity">X</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'a</span> poly"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">code_unfold</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">=</span> <span class="main">[:</span><span class="main">-</span><span class="free">x</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span>"</span></span>

<span class="keyword1"><span class="command">function</span></span> <span class="entity">neville_aitken_main</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> nat <span class="main">⇒</span> <span class="tfree">'a</span> poly"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">neville_aitken_main</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">&lt;</span> <span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="keyword1">then</span> 
      <span class="main">(</span>smult <span class="main">(</span>inverse <span class="main">(</span><span class="free">x</span> <span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="main">-</span> <span class="free">x</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>X <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">*</span> <span class="free">neville_aitken_main</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="main">-</span>
      X <span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="main">*</span> <span class="free">neville_aitken_main</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
    <span class="keyword1">else</span> <span class="main">[:</span><span class="free">f</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">:]</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">pat_completeness</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">termination</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">relation</span> <span class="quoted"><span class="quoted">"measure <span class="main">(</span><span class="main">λ</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="bound">j</span> <span class="main">-</span> <span class="bound">i</span><span class="main">)</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">neville_aitken</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'a</span> poly"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">neville_aitken</span> <span class="main">=</span> neville_aitken_main <span class="main">0</span>"</span></span>

<span class="keyword1"><span class="command">declare</span></span> neville_aitken_main.simps<span class="main">[</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main">]</span>

<span class="keyword1" id="Neville_Aitken_Interpolation-neville_aitken_main"><span class="command">lemma</span></span> neville_aitken_main<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> dist<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">i</span> <span class="bound">j</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="bound">j</span> <span class="main">⟹</span> <span class="bound">j</span> <span class="main">≤</span> <span class="free">n</span> <span class="main">⟹</span> <span class="free">x</span> <span class="bound">i</span> <span class="main">≠</span> <span class="free">x</span> <span class="bound">j</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≤</span> <span class="free">k</span> <span class="main">⟹</span> <span class="free">k</span> <span class="main">≤</span> <span class="free">j</span> <span class="main">⟹</span> <span class="free">j</span> <span class="main">≤</span> <span class="free">n</span> <span class="main">⟹</span> poly <span class="main">(</span>neville_aitken_main <span class="free">i</span> <span class="free">j</span><span class="main">)</span> <span class="main">(</span><span class="free">x</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">f</span> <span class="free">k</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">i</span></span> <span class="quoted"><span class="free">j</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">k</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> neville_aitken_main.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">i</span> <span class="skolem">j</span> <span class="skolem">k</span><span class="main">)</span>
  <span class="keyword1"><span class="command">note</span></span> neville_aitken_main.simps<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">i</span></span> <span class="quoted"><span class="skolem">j</span></span><span class="main">,</span> <span class="operator">simp</span><span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="skolem">j</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">with</span></span> 1<span class="main">(</span>3-<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">=</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> False <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> True <span class="keyword1"><span class="command">note</span></span> ij <span class="main">=</span> this
    <span class="keyword1"><span class="command">from</span></span> dist<span class="main">[</span><span class="operator">OF</span> True 1<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> diff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="skolem">i</span> <span class="main">≠</span> <span class="free">x</span> <span class="skolem">j</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> True <span class="keyword1"><span class="command">have</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"neville_aitken_main <span class="skolem">i</span> <span class="skolem">j</span> <span class="main">=</span> 
      <span class="main">(</span>smult <span class="main">(</span>inverse <span class="main">(</span><span class="free">x</span> <span class="skolem">j</span> <span class="main">-</span> <span class="free">x</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>X <span class="skolem">i</span> <span class="main">*</span> neville_aitken_main <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="skolem">j</span> <span class="main">-</span> X <span class="skolem">j</span> 
        <span class="main">*</span> neville_aitken_main <span class="skolem">i</span> <span class="main">(</span><span class="skolem">j</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">note</span></span> IH <span class="main">=</span> 1<span class="main">(</span>1-2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> True<span class="main">]</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">=</span> <span class="skolem">i</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> id True poly_smult <span class="keyword1"><span class="command">using</span></span> IH<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">i</span></span><span class="main">]</span> ij 1<span class="main">(</span>3-<span class="main">)</span> diff
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> X_def <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False <span class="keyword1"><span class="command">note</span></span> ki <span class="main">=</span> this
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">=</span> <span class="skolem">j</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> id True poly_smult <span class="keyword1"><span class="command">using</span></span> IH<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">j</span></span><span class="main">]</span> ij 1<span class="main">(</span>3-<span class="main">)</span> diff
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> X_def <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">with</span></span> ki <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> id poly_smult <span class="keyword1"><span class="command">using</span></span> IH<span class="main">(</span>1-2<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">k</span></span></span></span><span class="main">]</span> ij 1<span class="main">(</span>3-<span class="main">)</span> diff
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> X_def <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Neville_Aitken_Interpolation-degree_neville_aitken_main"><span class="command">lemma</span></span> degree_neville_aitken_main<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span>neville_aitken_main <span class="free">i</span> <span class="free">j</span><span class="main">)</span> <span class="main">≤</span> <span class="free">j</span> <span class="main">-</span> <span class="free">i</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">i</span></span> <span class="quoted"><span class="free">j</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> neville_aitken_main.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">i</span> <span class="skolem">j</span><span class="main">)</span>
  <span class="keyword1"><span class="command">note</span></span> simp <span class="main">=</span> neville_aitken_main.simps<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">i</span></span> <span class="quoted"><span class="skolem">j</span></span><span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="skolem">j</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> simp <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">note</span></span> IH <span class="main">=</span> 1<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?n</span></span></span> <span class="main">=</span> <span class="quoted">neville_aitken_main</span>
    <span class="keyword1"><span class="command">have</span></span> X<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">i</span><span class="main">.</span> degree <span class="main">(</span>X <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> Suc <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> X_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span>X <span class="skolem">i</span> <span class="main">*</span> <span class="var">?n</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">≤</span> Suc <span class="main">(</span>degree <span class="main">(</span><span class="var">?n</span> <span class="main">(</span><span class="skolem">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="skolem">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> order.trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> degree_mult_le<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> X<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> Suc <span class="main">(</span><span class="skolem">j</span> <span class="main">-</span> <span class="main">(</span><span class="skolem">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> IH<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span>X <span class="skolem">i</span> <span class="main">*</span> <span class="var">?n</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">j</span> <span class="main">-</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span>X <span class="skolem">j</span> <span class="main">*</span> <span class="var">?n</span> <span class="skolem">i</span> <span class="main">(</span><span class="skolem">j</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> Suc <span class="main">(</span>degree <span class="main">(</span><span class="var">?n</span> <span class="skolem">i</span> <span class="main">(</span><span class="skolem">j</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> order.trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> degree_mult_le<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> X<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> Suc <span class="main">(</span><span class="main">(</span><span class="skolem">j</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> IH<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span>X <span class="skolem">j</span> <span class="main">*</span> <span class="var">?n</span> <span class="skolem">i</span> <span class="main">(</span><span class="skolem">j</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">j</span> <span class="main">-</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?n</span> <span class="skolem">i</span> <span class="skolem">j</span> <span class="main">=</span> smult <span class="main">(</span>inverse <span class="main">(</span><span class="free">x</span> <span class="skolem">j</span> <span class="main">-</span> <span class="free">x</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span>
            <span class="main">(</span>X <span class="skolem">i</span> <span class="main">*</span> <span class="var">?n</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="skolem">j</span> <span class="main">-</span> X <span class="skolem">j</span> <span class="main">*</span> <span class="var">?n</span> <span class="skolem">i</span> <span class="main">(</span><span class="skolem">j</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> simp <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span><span class="var">?n</span> <span class="skolem">i</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">≤</span> degree <span class="main">(</span>X <span class="skolem">i</span> <span class="main">*</span> <span class="var">?n</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="skolem">j</span> <span class="main">-</span> X <span class="skolem">j</span> <span class="main">*</span> <span class="var">?n</span> <span class="skolem">i</span> <span class="main">(</span><span class="skolem">j</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> id <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> max <span class="main">(</span>degree <span class="main">(</span>X <span class="skolem">i</span> <span class="main">*</span> <span class="var">?n</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="skolem">j</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>degree <span class="main">(</span>X <span class="skolem">j</span> <span class="main">*</span> <span class="var">?n</span> <span class="skolem">i</span> <span class="main">(</span><span class="skolem">j</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> degree_diff_le_max<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="skolem">j</span> <span class="main">-</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> 1 2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Neville_Aitken_Interpolation-degree_neville_aitken"><span class="command">lemma</span></span> degree_neville_aitken<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span>neville_aitken <span class="free">n</span><span class="main">)</span> <span class="main">≤</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> neville_aitken_def <span class="keyword1"><span class="command">using</span></span> degree_neville_aitken_main<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">0</span></span> <span class="quoted"><span class="free">n</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">neville_aitken_merge</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span> poly<span class="main">)</span> list <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span> poly<span class="main">)</span> list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">neville_aitken_merge</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">xi</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">xj</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">p_ij</span></span></span><span class="main">)</span> <span class="main">#</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">xsi</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">xsj</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">p_sisj</span></span></span><span class="main">)</span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">rest</span></span></span><span class="main">)</span> <span class="main">=</span> 
     <span class="main">(</span><span class="free"><span class="bound"><span class="entity">xi</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">xsj</span></span></span><span class="main">,</span> smult <span class="main">(</span>inverse <span class="main">(</span><span class="free"><span class="bound"><span class="entity">xsj</span></span></span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">xi</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">[:</span><span class="main">-</span><span class="free"><span class="bound"><span class="entity">xi</span></span></span><span class="main">,</span><span class="main">1</span><span class="main">:]</span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">p_sisj</span></span></span>
      <span class="main">+</span> <span class="main">[:</span><span class="free"><span class="bound"><span class="entity">xsj</span></span></span><span class="main">,</span><span class="main">-</span><span class="main">1</span><span class="main">:]</span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">p_ij</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">#</span> <span class="free">neville_aitken_merge</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">xsi</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">xsj</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">p_sisj</span></span></span><span class="main">)</span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">rest</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">neville_aitken_merge</span> <span class="main">[</span><span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">]</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">neville_aitken_merge</span> <span class="main">[]</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>

<span class="keyword1" id="Neville_Aitken_Interpolation-length_neville_aitken_merge"><span class="command">lemma</span></span> length_neville_aitken_merge<span class="main">[</span><span class="operator">termination_simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>neville_aitken_merge <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> length <span class="free">xs</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> neville_aitken_merge.induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">neville_aitken_impl_main</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span> poly<span class="main">)</span> list <span class="main">⇒</span> <span class="tfree">'a</span> poly"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">neville_aitken_impl_main</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">e1</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">e2</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">es</span></span></span><span class="main">)</span> <span class="main">=</span> 
     <span class="free">neville_aitken_impl_main</span> <span class="main">(</span>neville_aitken_merge <span class="main">(</span><span class="free"><span class="bound"><span class="entity">e1</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">e2</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">es</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">neville_aitken_impl_main</span> <span class="main">[</span><span class="main">(</span><span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">,</span><span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span><span class="main">]</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">neville_aitken_impl_main</span> <span class="main">[]</span> <span class="main">=</span> <span class="main">0</span>"</span></span>

<span class="keyword1" id="Neville_Aitken_Interpolation-neville_aitken_merge"><span class="command">lemma</span></span> neville_aitken_merge<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">=</span> map <span class="main">(</span><span class="main">λ</span> <span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="free">x</span> <span class="bound">i</span><span class="main">,</span> <span class="free">x</span> <span class="main">(</span><span class="bound">i</span> <span class="main">+</span> <span class="free">j</span><span class="main">)</span><span class="main">,</span> neville_aitken_main <span class="bound">i</span> <span class="main">(</span><span class="bound">i</span> <span class="main">+</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>  <span class="main">[</span><span class="free">l</span> <span class="main">..&lt;</span> Suc <span class="main">(</span><span class="free">l</span> <span class="main">+</span> <span class="free">k</span><span class="main">)</span><span class="main">]</span> 
   <span class="main">⟹</span> neville_aitken_merge <span class="free">xs</span>
       <span class="main">=</span> <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span> <span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="free">x</span> <span class="bound">i</span><span class="main">,</span> <span class="free">x</span> <span class="main">(</span><span class="bound">i</span> <span class="main">+</span> Suc <span class="free">j</span><span class="main">)</span><span class="main">,</span> neville_aitken_main <span class="bound">i</span> <span class="main">(</span><span class="bound">i</span> <span class="main">+</span> Suc <span class="free">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">[</span><span class="free">l</span> <span class="main">..&lt;</span> <span class="free">l</span> <span class="main">+</span> <span class="free">k</span><span class="main">]</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">l</span></span> <span class="quoted"><span class="free">k</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> neville_aitken_merge.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">xi</span> <span class="skolem">xj</span> <span class="skolem">p_ij</span> <span class="skolem">xsi</span> <span class="skolem">xsj</span> <span class="skolem">p_sisj</span> <span class="skolem">rest</span> <span class="skolem">l</span> <span class="skolem">k</span><span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?n</span></span></span> <span class="main">=</span> <span class="quoted">neville_aitken_main</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">j</span> <span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="free">x</span> <span class="bound">i</span><span class="main">,</span> <span class="free">x</span> <span class="main">(</span><span class="bound">i</span> <span class="main">+</span> <span class="bound">j</span><span class="main">)</span><span class="main">,</span> <span class="var">?n</span> <span class="bound">i</span> <span class="main">(</span><span class="bound">i</span> <span class="main">+</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">=</span> <span class="var">?f</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?map</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">j</span><span class="main">.</span> map <span class="main">(</span><span class="var">?f</span> <span class="bound">j</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">note</span></span> res <span class="main">=</span> 1<span class="main">(</span>2<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> arg_cong<span class="main">[</span><span class="operator">OF</span> res<span class="main">,</span> <span class="operator">of</span> <span class="quoted">length</span><span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">kk</span></span> <span class="keyword2"><span class="keyword">where</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">=</span> Suc <span class="skolem">kk</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">k</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">l</span><span class="main">..&lt;</span>Suc <span class="main">(</span><span class="skolem">l</span> <span class="main">+</span> <span class="skolem">k</span><span class="main">)</span><span class="main">]</span> <span class="main">=</span> <span class="skolem">l</span> <span class="main">#</span> <span class="main">[</span>Suc <span class="skolem">l</span> <span class="main">..&lt;</span> Suc <span class="main">(</span>Suc <span class="skolem">l</span> <span class="main">+</span> <span class="skolem">kk</span><span class="main">)</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> upt_rec<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> res<span class="main">[</span><span class="operator">unfolded</span> id<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> id2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">xsi</span><span class="main">,</span> <span class="skolem">xsj</span><span class="main">,</span> <span class="skolem">p_sisj</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">rest</span> <span class="main">=</span>
    <span class="var">?map</span> <span class="free">j</span> <span class="main">[</span>Suc <span class="skolem">l</span><span class="main">..&lt;</span> Suc <span class="main">(</span>Suc <span class="skolem">l</span> <span class="main">+</span> <span class="skolem">kk</span><span class="main">)</span><span class="main">]</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> id3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">xi</span> <span class="main">=</span> <span class="free">x</span> <span class="skolem">l</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xj</span> <span class="main">=</span> <span class="free">x</span> <span class="main">(</span><span class="skolem">l</span> <span class="main">+</span> <span class="free">j</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p_ij</span> <span class="main">=</span> <span class="var">?n</span> <span class="skolem">l</span> <span class="main">(</span><span class="skolem">l</span> <span class="main">+</span> <span class="free">j</span><span class="main">)</span>"</span></span> 
        <span class="quoted"><span class="quoted">"<span class="skolem">xsi</span> <span class="main">=</span> <span class="free">x</span> <span class="main">(</span>Suc <span class="skolem">l</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xsj</span> <span class="main">=</span> <span class="free">x</span> <span class="main">(</span>Suc <span class="main">(</span><span class="skolem">l</span> <span class="main">+</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p_sisj</span> <span class="main">=</span> <span class="var">?n</span> <span class="main">(</span>Suc <span class="skolem">l</span><span class="main">)</span> <span class="main">(</span>Suc <span class="main">(</span><span class="skolem">l</span> <span class="main">+</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> upt_rec<span class="main">)</span>
  <span class="keyword1"><span class="command">note</span></span> IH <span class="main">=</span> 1<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> id2<span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> X<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[:</span><span class="free">x</span> <span class="main">(</span>Suc <span class="main">(</span><span class="skolem">l</span> <span class="main">+</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> <span class="main">-</span> <span class="main">1</span><span class="main">:]</span> <span class="main">=</span> <span class="main">-</span> X <span class="main">(</span>Suc <span class="skolem">l</span> <span class="main">+</span> <span class="free">j</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> X_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> id4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">xi</span><span class="main">,</span> <span class="skolem">xsj</span><span class="main">,</span> smult <span class="main">(</span>inverse <span class="main">(</span><span class="skolem">xsj</span> <span class="main">-</span> <span class="skolem">xi</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">[:</span><span class="main">-</span> <span class="skolem">xi</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">*</span> <span class="skolem">p_sisj</span> <span class="main">+</span>
     <span class="main">[:</span><span class="skolem">xsj</span><span class="main">,</span> <span class="main">-</span> <span class="main">1</span><span class="main">:]</span> <span class="main">*</span> <span class="skolem">p_ij</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="skolem">l</span><span class="main">,</span> <span class="free">x</span> <span class="main">(</span><span class="skolem">l</span> <span class="main">+</span> Suc <span class="free">j</span><span class="main">)</span><span class="main">,</span> <span class="var">?n</span> <span class="skolem">l</span> <span class="main">(</span><span class="skolem">l</span> <span class="main">+</span> Suc <span class="free">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> id3 neville_aitken_main.simps<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">l</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">+</span> Suc <span class="free">j</span>"</span></span><span class="main">]</span> 
      X_def<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> X <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> id5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">l</span><span class="main">..&lt;</span><span class="skolem">l</span> <span class="main">+</span> <span class="skolem">k</span><span class="main">]</span> <span class="main">=</span> <span class="skolem">l</span> <span class="main">#</span> <span class="main">[</span>Suc <span class="skolem">l</span> <span class="main">..&lt;</span> Suc <span class="skolem">l</span> <span class="main">+</span> <span class="skolem">kk</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> k
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> upt_rec<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> neville_aitken_merge.simps IH id4
    <span class="keyword1"><span class="command">unfolding</span></span> id5 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Neville_Aitken_Interpolation-neville_aitken_impl_main"><span class="command">lemma</span></span> neville_aitken_impl_main<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">=</span> map <span class="main">(</span><span class="main">λ</span> <span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="free">x</span> <span class="bound">i</span><span class="main">,</span> <span class="free">x</span> <span class="main">(</span><span class="bound">i</span> <span class="main">+</span> <span class="free">j</span><span class="main">)</span><span class="main">,</span> neville_aitken_main <span class="bound">i</span> <span class="main">(</span><span class="bound">i</span> <span class="main">+</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>  <span class="main">[</span><span class="free">l</span> <span class="main">..&lt;</span> Suc <span class="main">(</span><span class="free">l</span> <span class="main">+</span> <span class="free">k</span><span class="main">)</span><span class="main">]</span> 
   <span class="main">⟹</span> neville_aitken_impl_main <span class="free">xs</span> <span class="main">=</span> neville_aitken_main <span class="free">l</span> <span class="main">(</span><span class="free">l</span> <span class="main">+</span> <span class="free">j</span> <span class="main">+</span> <span class="free">k</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">l</span></span> <span class="quoted"><span class="free">k</span></span> <span class="quoted"><span class="free">j</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> neville_aitken_impl_main.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">e1</span> <span class="skolem">e2</span> <span class="skolem">es</span> <span class="skolem">l</span> <span class="skolem">k</span> <span class="skolem">j</span><span class="main">)</span>
  <span class="keyword1"><span class="command">note</span></span> res <span class="main">=</span> 1<span class="main">(</span>2<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> res <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">kk</span></span> <span class="keyword2"><span class="keyword">where</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">=</span> Suc <span class="skolem">kk</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">k</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> id1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">+</span> <span class="skolem">k</span> <span class="main">=</span> Suc <span class="main">(</span><span class="skolem">l</span> <span class="main">+</span> <span class="skolem">kk</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> neville_aitken_impl_main.simps 1<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> neville_aitken_merge<span class="main"><span class="main">[</span></span><span class="operator">OF</span> 1<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">,</span></span> <span class="operator">unfolded</span> id1<span class="main"><span class="main">]</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> k<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Neville_Aitken_Interpolation-neville_aitken_impl"><span class="command">lemma</span></span> neville_aitken_impl<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">=</span> map <span class="main">(</span><span class="main">λ</span> <span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="free">x</span> <span class="bound">i</span><span class="main">,</span> <span class="free">x</span> <span class="bound">i</span><span class="main">,</span> <span class="main">[:</span><span class="free">f</span> <span class="bound">i</span><span class="main">:]</span><span class="main">)</span><span class="main">)</span>  <span class="main">[</span><span class="main">0</span> <span class="main">..&lt;</span> Suc <span class="free">k</span><span class="main">]</span> 
   <span class="main">⟹</span> neville_aitken_impl_main <span class="free">xs</span> <span class="main">=</span> neville_aitken <span class="free">k</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> neville_aitken_def <span class="keyword1"><span class="command">using</span></span> neville_aitken_impl_main<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">xs</span></span> <span class="quoted"><span class="main">0</span></span> <span class="quoted"><span class="main">0</span></span> <span class="quoted"><span class="free">k</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> neville_aitken_main.simps<span class="main">)</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1" id="Neville_Aitken_Interpolation-neville_aitken"><span class="command">lemma</span></span> neville_aitken<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">i</span> <span class="bound">j</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="bound">j</span> <span class="main">⟹</span> <span class="bound">j</span> <span class="main">≤</span> <span class="free">n</span> <span class="main">⟹</span> <span class="free">x</span> <span class="bound">i</span> <span class="main">≠</span> <span class="free">x</span> <span class="bound">j</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">≤</span> <span class="free">n</span> <span class="main">⟹</span> poly <span class="main">(</span>neville_aitken <span class="free">x</span> <span class="free">f</span> <span class="free">n</span><span class="main">)</span> <span class="main">(</span><span class="free">x</span> <span class="free">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">f</span> <span class="free">j</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> neville_aitken_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> neville_aitken_main<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">n</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">neville_aitken_interpolation_poly</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">::</span> field <span class="main">×</span> <span class="tfree">'a</span><span class="main">)</span>list <span class="main">⇒</span> <span class="tfree">'a</span> poly"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">neville_aitken_interpolation_poly</span> <span class="free"><span class="bound"><span class="entity">x_fs</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span> 
    <span class="bound">start</span> <span class="main">=</span> map <span class="main">(</span><span class="main">λ</span> <span class="main">(</span><span class="bound">xi</span><span class="main">,</span><span class="bound">fi</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">xi</span><span class="main">,</span><span class="bound">xi</span><span class="main">,</span><span class="main">[:</span><span class="bound">fi</span><span class="main">:]</span><span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">x_fs</span></span></span> <span class="keyword1">in</span> 
    neville_aitken_impl_main <span class="bound">start</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Neville_Aitken_Interpolation-neville_aitken_interpolation_impl"><span class="command">lemma</span></span> neville_aitken_interpolation_impl<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x_fs</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"neville_aitken_interpolation_poly <span class="free">x_fs</span> <span class="main">=</span>
  neville_aitken <span class="main">(</span><span class="main">λ</span> <span class="bound">i</span><span class="main">.</span> fst <span class="main">(</span><span class="free">x_fs</span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">i</span><span class="main">.</span> snd <span class="main">(</span><span class="free">x_fs</span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>length <span class="free">x_fs</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span>length <span class="free">x_fs</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> length <span class="free">x_fs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> neville_aitken_interpolation_poly_def Let_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> neville_aitken_impl<span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> id<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> nth_equalityI<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> prod.splits<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1" id="Neville_Aitken_Interpolation-neville_aitken_interpolation_poly"><span class="command">lemma</span></span> neville_aitken_interpolation_poly<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> dist<span class="main">:</span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>map fst <span class="free">xs_ys</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> neville_aitken_interpolation_poly <span class="free">xs_ys</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> xy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">xs_ys</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="free">x</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> neville_aitken <span class="main">(</span><span class="main">λ</span> <span class="bound">i</span><span class="main">.</span> fst <span class="main">(</span><span class="free">xs_ys</span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">i</span><span class="main">.</span> snd <span class="main">(</span><span class="free">xs_ys</span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>length <span class="free">xs_ys</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> p
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> neville_aitken_interpolation_impl<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> xy<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> xy <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="free">xs_ys</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> fst <span class="main">(</span><span class="free">xs_ys</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">=</span> snd <span class="main">(</span><span class="free">xs_ys</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> set_conv_nth <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> fst_conv in_set_conv_nth snd_conv xy<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> p x y
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> neville_aitken<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="skolem">j</span> <span class="main">⟹</span> <span class="skolem">j</span> <span class="main">≤</span> length <span class="free">xs_ys</span> <span class="main">-</span> <span class="main">1</span> <span class="main">⟹</span> fst <span class="main">(</span><span class="free">xs_ys</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">≠</span> fst <span class="main">(</span><span class="free">xs_ys</span> <span class="main">!</span> <span class="skolem">j</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> dist
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> One_nat_def diff_less dual_order.strict_trans2 length_map 
        length_pos_if_in_set lessI less_or_eq_imp_le neq_iff nth_eq_iff_index_eq nth_map xy<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">insert</span> i<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Neville_Aitken_Interpolation-degree_neville_aitken_interpolation_poly"><span class="command">lemma</span></span> degree_neville_aitken_interpolation_poly<span class="main">:</span>  
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span>neville_aitken_interpolation_poly <span class="free">xs_ys</span><span class="main">)</span> <span class="main">≤</span> length <span class="free">xs_ys</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"length <span class="free">xs_ys</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
  <span class="keyword1"><span class="command">hence</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">xs_ys</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">xs_ys</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> id neville_aitken_interpolation_poly_def Let_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">nn</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"neville_aitken_interpolation_poly <span class="free">xs_ys</span> <span class="main">=</span> 
    neville_aitken <span class="main">(</span><span class="main">λ</span> <span class="bound">i</span><span class="main">.</span> fst <span class="main">(</span><span class="free">xs_ys</span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">i</span><span class="main">.</span> snd <span class="main">(</span><span class="free">xs_ys</span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>length <span class="free">xs_ys</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> neville_aitken_interpolation_impl<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> Suc<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> id <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> degree_neville_aitken<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Polynomial_Interpolation">
<div class="head">
<h1>Theory Polynomial_Interpolation</h1>
</div>
<pre class="source"><span class="comment1">(*  
    Author:      René Thiemann 
                 Akihisa Yamada
    License:     BSD
*)</span>
<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Polynomial Interpolation›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We combine Newton's, Lagrange's, and Neville-Aitken's interpolation algorithms 
  to a combined interpolation algorithm which is parametric. This parametric algorithm is then
  further extend from fields to also perform interpolation of integer polynomials.
  
  In experiments it is revealed that Newton's algorithm performs better than the one
  of Lagrange. Moreover, on the integer numbers, only Newton's algorithm has been
  optimized with fast failure capabilities.›</span></span>
<span class="keyword1"><span class="command">theory</span></span> Polynomial_Interpolation
<span class="keyword2"><span class="keyword">imports</span></span>
  <a href="#Improved_Code_Equations">Improved_Code_Equations</a>
  <a href="#Newton_Interpolation">Newton_Interpolation</a>
  <a href="#Lagrange_Interpolation">Lagrange_Interpolation</a>
  <a href="#Neville_Aitken_Interpolation">Neville_Aitken_Interpolation</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">datatype</span></span> interpolation_algorithm <span class="main">=</span> Newton <span class="main">|</span> Lagrange <span class="main">|</span> Neville_Aitken

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">interpolation_poly</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"interpolation_algorithm <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">::</span> field <span class="main">×</span> <span class="tfree">'a</span><span class="main">)</span>list <span class="main">⇒</span> <span class="tfree">'a</span> poly"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">interpolation_poly</span> Newton <span class="main">=</span> newton_interpolation_poly"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">interpolation_poly</span> Lagrange <span class="main">=</span> lagrange_interpolation_poly"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">interpolation_poly</span> Neville_Aitken <span class="main">=</span> neville_aitken_interpolation_poly"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">interpolation_poly_int</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"interpolation_algorithm <span class="main">⇒</span> <span class="main">(</span>int <span class="main">×</span> int<span class="main">)</span>list <span class="main">⇒</span> int poly option"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">interpolation_poly_int</span> Newton <span class="free"><span class="bound"><span class="entity">xs_ys</span></span></span> <span class="main">=</span> newton_interpolation_poly_int <span class="free"><span class="bound"><span class="entity">xs_ys</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">interpolation_poly_int</span> <span class="free"><span class="bound"><span class="entity">alg</span></span></span> <span class="free"><span class="bound"><span class="entity">xs_ys</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span> 
     <span class="bound">rxs_ys</span> <span class="main">=</span> map <span class="main">(</span><span class="main">λ</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span>of_int <span class="bound">x</span><span class="main">,</span> of_int <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">xs_ys</span></span></span><span class="main">;</span>
     <span class="bound">rp</span> <span class="main">=</span> interpolation_poly <span class="free"><span class="bound"><span class="entity">alg</span></span></span> <span class="bound">rxs_ys</span>
     <span class="keyword1">in</span> <span class="keyword1">if</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">x</span> <span class="main">∈</span> set <span class="main">(</span>coeffs <span class="bound">rp</span><span class="main">)</span><span class="main">.</span> is_int_rat <span class="bound">x</span><span class="main">)</span> <span class="keyword1">then</span>
       Some <span class="main">(</span>map_poly int_of_rat <span class="bound">rp</span><span class="main">)</span> <span class="keyword1">else</span> None<span class="main">)</span>"</span></span>

<span class="keyword1" id="Polynomial_Interpolation-interpolation_poly_int_def"><span class="command">lemma</span></span> interpolation_poly_int_def<span class="main">:</span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>map fst <span class="free">xs_ys</span><span class="main">)</span> <span class="main">⟹</span>
  interpolation_poly_int <span class="free">alg</span> <span class="free">xs_ys</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span> 
     <span class="bound">rxs_ys</span> <span class="main">=</span> map <span class="main">(</span><span class="main">λ</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span>of_int <span class="bound">x</span><span class="main">,</span> of_int <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="free">xs_ys</span><span class="main">;</span>
     <span class="bound">rp</span> <span class="main">=</span> interpolation_poly <span class="free">alg</span> <span class="bound">rxs_ys</span>
     <span class="keyword1">in</span> <span class="keyword1">if</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">x</span> <span class="main">∈</span> set <span class="main">(</span>coeffs <span class="bound">rp</span><span class="main">)</span><span class="main">.</span> is_int_rat <span class="bound">x</span><span class="main">)</span> <span class="keyword1">then</span>
       Some <span class="main">(</span>map_poly int_of_rat <span class="bound">rp</span><span class="main">)</span> <span class="keyword1">else</span> None<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">alg</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> newton_interpolation_poly_int<span class="main">)</span>

<span class="keyword1" id="Polynomial_Interpolation-interpolation_poly"><span class="command">lemma</span></span> interpolation_poly<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> dist<span class="main">:</span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>map fst <span class="free">xs_ys</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> interpolation_poly <span class="free">alg</span> <span class="free">xs_ys</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> xy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">xs_ys</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="free">x</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">alg</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Newton
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> newton_interpolation_poly<span class="main">[</span><span class="operator">OF</span> dist _ xy<span class="main">]</span> p <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> Lagrange
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> lagrange_interpolation_poly<span class="main">[</span><span class="operator">OF</span> dist _ xy<span class="main">]</span> p <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> Neville_Aitken
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> neville_aitken_interpolation_poly<span class="main">[</span><span class="operator">OF</span> dist _ xy<span class="main">]</span> p <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Polynomial_Interpolation-degree_interpolation_poly"><span class="command">lemma</span></span> degree_interpolation_poly<span class="main">:</span>  
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span>interpolation_poly <span class="free">alg</span> <span class="free">xs_ys</span><span class="main">)</span> <span class="main">≤</span> length <span class="free">xs_ys</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> degree_lagrange_interpolation_poly<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">xs_ys</span></span><span class="main">]</span>
    degree_newton_interpolation_poly<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">xs_ys</span></span><span class="main">]</span>
    degree_neville_aitken_interpolation_poly<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">xs_ys</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">alg</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="Polynomial_Interpolation-uniqueness_of_interpolation"><span class="command">lemma</span></span> uniqueness_of_interpolation<span class="main">:</span> <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> idom poly"</span></span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> cS<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="free">S</span> <span class="main">=</span> Suc <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span> <span class="main">≤</span> <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"degree <span class="free">q</span> <span class="main">≤</span> <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   id<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">⟹</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> poly <span class="free">q</span> <span class="bound">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="free">q</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">=</span> <span class="free">p</span> <span class="main">-</span> <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?R</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> poly <span class="skolem">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> sub<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">⊆</span> <span class="var">?R</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> f_def <span class="keyword1"><span class="command">using</span></span> id <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> f_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False <span class="keyword1"><span class="command">note</span></span> f <span class="main">=</span> this
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?R</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> poly <span class="skolem">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> poly_roots_finite<span class="main">[</span><span class="operator">OF</span> f<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="var">?R</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">from</span></span> card_mono<span class="main">[</span><span class="operator">OF</span> this sub<span class="main">]</span> poly_roots_degree<span class="main">[</span><span class="operator">OF</span> f<span class="main">]</span> 
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Suc <span class="free">n</span> <span class="main">≤</span> degree <span class="skolem">f</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> cS <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> f_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> degree_diff_le<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> assms<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Polynomial_Interpolation-uniqueness_of_interpolation_point_list"><span class="command">lemma</span></span> uniqueness_of_interpolation_point_list<span class="main">:</span> <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> idom poly"</span></span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> dist<span class="main">:</span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>map fst <span class="free">xs_ys</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">xs_ys</span> <span class="main">⟹</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">y</span>"</span></span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span> <span class="main">&lt;</span> length <span class="free">xs_ys</span>"</span></span> 
  <span class="keyword2"><span class="keyword">and</span></span> q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">xs_ys</span> <span class="main">⟹</span> poly <span class="free">q</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">y</span>"</span></span> <span class="quoted"><span class="quoted">"degree <span class="free">q</span> <span class="main">&lt;</span> length <span class="free">xs_ys</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="free">q</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?xs</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"map fst <span class="free">xs_ys</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> q <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> len<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="free">xs_ys</span> <span class="main">=</span> Suc <span class="skolem">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> dq<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="free">q</span> <span class="main">≤</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">xs_ys</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> p <span class="keyword1"><span class="command">have</span></span> dp<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span> <span class="main">≤</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> len <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> dist <span class="keyword1"><span class="command">have</span></span> card<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>set <span class="var">?xs</span><span class="main">)</span> <span class="main">=</span> Suc <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> len<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
    <span class="keyword1"><span class="command">using</span></span> distinct_card <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> uniqueness_of_interpolation<span class="main"><span class="main">[</span></span><span class="operator">OF</span> card dp dq<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> set <span class="var">?xs</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">y</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">xs_ys</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> p<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> q<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="skolem">x</span> <span class="main">=</span> poly <span class="free">q</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>  
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Polynomial_Interpolation-exactly_one_poly_interpolation"><span class="command">lemma</span></span> exactly_one_poly_interpolation<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> xs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">xs_ys</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> dist<span class="main">:</span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>map fst <span class="free">xs_ys</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃!</span> <span class="bound">p</span><span class="main">.</span> degree <span class="bound">p</span> <span class="main">&lt;</span> length <span class="free">xs_ys</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">xs_ys</span> <span class="main">⟶</span> poly <span class="bound">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">(</span><span class="bound">y</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> field<span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?alg</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"undefined"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?p</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"interpolation_poly <span class="var">?alg</span> <span class="free">xs_ys</span>"</span></span>
  <span class="keyword1"><span class="command">note</span></span> inter <span class="main">=</span> interpolation_poly<span class="main">[</span><span class="operator">OF</span> dist refl<span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ex1I<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="var"><span class="quoted"><span class="var"><span class="quoted"><span class="var">?p</span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI allI impI<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> dp<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="var">?p</span> <span class="main">&lt;</span> length <span class="free">xs_ys</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> degree_interpolation_poly<span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?alg</span></span></span> <span class="quoted"><span class="free">xs_ys</span></span><span class="main">]</span> xs <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">xs_ys</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">xs_ys</span> <span class="main">⟹</span> poly <span class="main">(</span>interpolation_poly <span class="var">?alg</span> <span class="free">xs_ys</span><span class="main">)</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">y</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> inter<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">q</span> 
    <span class="keyword3"><span class="command">assume</span></span> q<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="skolem">q</span> <span class="main">&lt;</span> length <span class="free">xs_ys</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">xs_ys</span> <span class="main">⟶</span> poly <span class="skolem">q</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">=</span> <span class="var">?p</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> uniqueness_of_interpolation_point_list<span class="main"><span class="main">[</span></span><span class="operator">OF</span> dist _ _ inter dp<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> q<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="Polynomial_Interpolation-interpolation_poly_int_Some"><span class="command">lemma</span></span> interpolation_poly_int_Some<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> dist'<span class="main">:</span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>map fst <span class="free">xs_ys</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"interpolation_poly_int <span class="free">alg</span> <span class="free">xs_ys</span> <span class="main">=</span> Some <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">xs_ys</span> <span class="main">⟹</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">y</span>"</span></span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span> <span class="main">≤</span> length <span class="free">xs_ys</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?r</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"rat_of_int"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">rxs_ys</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">rxs_ys</span> <span class="main">=</span> map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="var">?r</span> <span class="bound">x</span><span class="main">,</span> <span class="var">?r</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="free">xs_ys</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> dist<span class="main">:</span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>map fst <span class="skolem">rxs_ys</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> dist' <span class="keyword1"><span class="command">unfolding</span></span> distinct_map rxs_ys_def inj_on_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">rp</span></span> <span class="keyword2"><span class="keyword">where</span></span> rp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">rp</span> <span class="main">=</span> interpolation_poly <span class="free">alg</span> <span class="skolem">rxs_ys</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> p<span class="main">[</span><span class="operator">unfolded</span> interpolation_poly_int_def<span class="main"><span class="main">[</span></span><span class="operator">OF</span> dist'<span class="main"><span class="main">]</span></span> Let_def<span class="main">,</span> <span class="operator">folded</span> rxs_ys_def rp<span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> map_poly int_of_rat <span class="skolem">rp</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ball<span class="main">:</span> <span class="quoted"><span class="quoted">"Ball <span class="main">(</span>set <span class="main">(</span>coeffs <span class="skolem">rp</span><span class="main">)</span><span class="main">)</span> is_int_rat"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">rp</span> <span class="main">=</span> map_poly <span class="var">?r</span> <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> p
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sym<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> map_poly_map_poly<span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> map_poly_idI<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> ball<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">note</span></span> inter <span class="main">=</span> interpolation_poly<span class="main">[</span><span class="operator">OF</span> dist rp<span class="main">]</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">y</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">xs_ys</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?r</span> <span class="skolem">x</span><span class="main">,</span> <span class="var">?r</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">∈</span> set <span class="skolem">rxs_ys</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> rxs_ys_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> inter<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="skolem">rp</span> <span class="main">(</span><span class="var">?r</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="var">?r</span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this<span class="main">[</span><span class="operator">unfolded</span> id of_int_hom.poly_map_poly<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span> <span class="main">≤</span> length <span class="free">xs_ys</span> <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> degree_interpolation_poly<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">alg</span></span> <span class="quoted"><span class="skolem">rxs_ys</span></span><span class="main">,</span> <span class="operator">folded</span> rp<span class="main">]</span>
    <span class="keyword1"><span class="command">unfolding</span></span> id rxs_ys_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>  
  

<span class="keyword1" id="Polynomial_Interpolation-interpolation_poly_int_None"><span class="command">lemma</span></span> interpolation_poly_int_None<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> dist<span class="main">:</span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>map fst <span class="free">xs_ys</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"interpolation_poly_int <span class="free">alg</span> <span class="free">xs_ys</span> <span class="main">=</span> None"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">xs_ys</span> <span class="main">⟹</span> poly <span class="free">q</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> dq<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="free">q</span> <span class="main">&lt;</span> length <span class="free">xs_ys</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted">False</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?r</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"rat_of_int"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?rp</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"map_poly <span class="var">?r</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">rxs_ys</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">rxs_ys</span> <span class="main">=</span> map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="var">?r</span> <span class="bound">x</span><span class="main">,</span> <span class="var">?r</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="free">xs_ys</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> dist'<span class="main">:</span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>map fst <span class="skolem">rxs_ys</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> dist <span class="keyword1"><span class="command">unfolding</span></span> distinct_map rxs_ys_def inj_on_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">rp</span></span> <span class="keyword2"><span class="keyword">where</span></span> rp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">rp</span> <span class="main">=</span> interpolation_poly <span class="free">alg</span> <span class="skolem">rxs_ys</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">note</span></span> degrp <span class="main">=</span> degree_interpolation_poly<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">alg</span></span> <span class="quoted"><span class="skolem">rxs_ys</span></span><span class="main">,</span> <span class="operator">folded</span> rp<span class="main">]</span>
  <span class="keyword1"><span class="command">from</span></span> q <span class="keyword1"><span class="command">have</span></span> q'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span> <span class="main">∈</span> set <span class="skolem">rxs_ys</span> <span class="main">⟹</span> poly <span class="main">(</span><span class="var">?rp</span> <span class="free">q</span><span class="main">)</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">y</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> rxs_ys_def 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span><span class="var">?rp</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> degree <span class="free">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">rp</span> <span class="main">=</span> <span class="var">?rp</span> <span class="free">q</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> uniqueness_of_interpolation_point_list<span class="main"><span class="main">[</span></span><span class="operator">OF</span> dist' interpolation_poly<span class="main"><span class="main">[</span></span><span class="operator">OF</span> dist' rp<span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span>
    <span class="operator">insert</span> q' dq degrp<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> rxs_ys_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> p<span class="main">[</span><span class="operator">unfolded</span> interpolation_poly_int_def<span class="main"><span class="main">[</span></span><span class="operator">OF</span> dist<span class="main"><span class="main">]</span></span> Let_def<span class="main">,</span> <span class="operator">folded</span> rxs_ys_def rp<span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">c</span> <span class="main">∈</span> set <span class="main">(</span>coeffs <span class="skolem">rp</span><span class="main">)</span><span class="main">.</span> <span class="bound">c</span> <span class="main">∉</span> <span class="main">ℤ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> this<span class="main">[</span><span class="operator">unfolded</span> id<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> newton_interpolation_poly_int_Some <span class="main">=</span> 
  interpolation_poly_int_Some<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> alg <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted">Newton</span></span><span class="main">,</span> <span class="operator">unfolded</span> interpolation_poly_int.simps<span class="main">]</span>

<span class="keyword1"><span class="command">lemmas</span></span> newton_interpolation_poly_int_None <span class="main">=</span> 
  interpolation_poly_int_None<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> alg <span class="main"><span class="main">=</span></span> <span class="quoted">Newton</span><span class="main">,</span> <span class="operator">unfolded</span> interpolation_poly_int.simps<span class="main">]</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We can also use Newton's improved algorithm for integer polynomials to show that
    there is no polynomial $p$ over the integers such that $p(0) = 0$ and $p(2) = 1$.
    The reason is that the intermediate result for computing the linear interpolant for these
    two point fails, and so adding further points (which corresponds to increasing the degree)
    will also fail. Of course, this can be generalized, showing that whenever you cannot
    interpolate a set of $n$ points with an integer polynomial of degree $n-1$, then you
    cannot interpolate this set of points with any integer polynomial. However, we did not
    formally prove this more general fact.›</span></span>

<span class="keyword1" id="Polynomial_Interpolation-impossible_p_0_is_0_and_p_2_is_1"><span class="command">lemma</span></span> impossible_p_0_is_0_and_p_2_is_1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">p</span><span class="main">.</span> poly <span class="bound">p</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> poly <span class="bound">p</span> <span class="numeral">2</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span> <span class="main">::</span> int<span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">p</span><span class="main">.</span> poly <span class="bound">p</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> poly <span class="bound">p</span> <span class="numeral">2</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span> <span class="main">::</span> int<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"poly <span class="skolem">p</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"poly <span class="skolem">p</span> <span class="numeral">2</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span> <span class="main">::</span> int<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">xs_ys</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs_ys</span> <span class="main">=</span> map <span class="main">(</span><span class="main">λ</span> <span class="bound">i</span><span class="main">.</span> <span class="main">(</span>int <span class="bound">i</span><span class="main">,</span> poly <span class="skolem">p</span> <span class="main">(</span>int <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">[</span> <span class="numeral">3</span> <span class="main">..&lt;</span> <span class="numeral">3</span> <span class="main">+</span> degree <span class="skolem">p</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?l</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">xs</span><span class="main">.</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">#</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">::</span> int<span class="main">,</span><span class="main">1</span> <span class="main">::</span> int<span class="main">)</span> <span class="main">#</span> <span class="bound">xs</span>"</span></span> 
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?xs_ys</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="skolem">xs_ys</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">list</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">list</span> <span class="main">=</span> map fst <span class="var">?xs_ys</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> dist<span class="main">:</span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>map fst <span class="var">?xs_ys</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> xs_ys_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> o_def distinct_map inj_on_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span> <span class="main">∈</span> set <span class="var">?xs_ys</span> <span class="main">⟹</span> poly <span class="skolem">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">y</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> xs_ys_def <span class="keyword1"><span class="command">using</span></span> p <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> deg<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="skolem">p</span> <span class="main">&lt;</span> length <span class="var">?xs_ys</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> xs_ys_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"newton_coefficients_main_int <span class="skolem">list</span> <span class="main">(</span>rev <span class="main">(</span>map snd <span class="var">?xs_ys</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>rev <span class="main">(</span>map fst <span class="var">?xs_ys</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> None"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">xs_ys</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> rev_induct<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> Nil
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> list_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> divmod_int_def<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>snoc <span class="skolem">xy</span> <span class="skolem">xs_ys</span><span class="main">)</span> <span class="keyword1"><span class="command">note</span></span> IH <span class="main">=</span> this
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> xy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">xy</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">y</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">xs_ys</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> rev_cases<span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> Nil
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> Nil xy
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> list_def divmod_int_def<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>snoc <span class="skolem">xs_ys'</span> <span class="skolem">xy'</span><span class="main">)</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x'</span></span> <span class="skolem"><span class="skolem">y'</span></span> <span class="keyword2"><span class="keyword">where</span></span> xy'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">xy'</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">x'</span><span class="main">,</span><span class="skolem">y'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> IH <span class="keyword1"><span class="command">unfolding</span></span> xy' snoc xy <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">hence</span></span> newton<span class="main">:</span> <span class="quoted"><span class="quoted">"newton_interpolation_poly_int <span class="var">?xs_ys</span> <span class="main">=</span> None"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> newton_interpolation_poly_int_def Let_def newton_poly_impl_int_def
      Newton_Interpolation.newton_coefficients_int_def list_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> newton_interpolation_poly_int_None<span class="main">[</span><span class="operator">OF</span> dist newton p deg<span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>
    
<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div>