<div id="CauchysMeanTheorem">
<div class="head">
<h1>Theory CauchysMeanTheorem</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:       Cauchy's Mean Theorem
    Author:      Benjamin Porter &lt;Benjamin.Porter at gmail.com&gt;, 2006
                 cleaned up a bit by Tobias Nipkow, 2007
    Maintainer:  Benjamin Porter &lt;Benjamin.Porter at gmail.com&gt;
*)</span>

<span class="keyword1"><span class="command">chapter</span></span> <span class="quoted"><span class="plain_text">‹Cauchy's Mean Theorem›</span></span>

<span class="keyword1"><span class="command">theory</span></span> CauchysMeanTheorem
<span class="keyword2"><span class="keyword">imports</span></span> <a href="https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL/Complex_Main.html">Complex_Main</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Abstract›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The following document presents a proof of Cauchy's Mean
theorem formalised in the Isabelle/Isar theorem proving system.

{\em Theorem}: For any collection of positive real numbers the
geometric mean is always less than or equal to the arithmetic mean. In
mathematical terms: $$\sqrt[n]{x_1 x_2 \dots x_n} \leq \frac{x_1 +
\dots + x_n}{n}$$ We will use the term {\em mean} to denote the
arithmetic mean and {\em gmean} to denote the geometric mean.

{\em Informal Proof}:

This proof is based on the proof presented in [1]. First we need an
auxiliary lemma (the proof of which is presented formally below) that
states:

Given two pairs of numbers of equal sum, the pair with the greater
product is the pair with the least difference. Using this lemma we now
present the proof -

Given any collection $C$ of positive numbers with mean $M$ and product
$P$ and with some element not equal to M we can choose two elements
from the collection, $a$ and $b$ where $a&gt;M$ and $b&lt;M$. Remove these
elements from the collection and replace them with two new elements,
$a'$ and $b'$ such that $a' = M$ and $a' + b' = a + b$. This new
collection $C'$ now has a greater product $P'$ but equal mean with
respect to $C$. We can continue in this fashion until we have a
collection $C_n$ such that $P_n &gt; P$ and $M_n = M$, but $C_n$ has all
its elements equal to $M$ and thus $P_n = M^n$. Using the definition
of geometric and arithmetic means above we can see that for any
collection of positive elements $E$ it is always true that gmean E
$\leq$ mean E. QED.


[1] Dorrie, H. "100 Great Problems of Elementary Mathematics." 1965, Dover.
›</span></span>


<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Formal proof›</span></span>

<span class="comment1">(* ============================================================================= *)</span>
<span class="comment1">(* ============================================================================= *)</span>
<span class="comment1">(* ============================================================================= *)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Collection sum and product›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The finite collections of numbers will be modelled as
lists. We then define sum and product operations over these lists.›</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Sum and product definitions›</span></span>

<span class="keyword1"><span class="command">notation</span></span> <span class="main">(</span>input<span class="main">)</span> sum_list <span class="main">(</span><span class="quoted">"<span class="keyword1">∑:</span>_"</span> <span class="main">[</span>999<span class="main">]</span> 998<span class="main">)</span>

<span class="keyword1"><span class="command">notation</span></span> <span class="main">(</span>input<span class="main">)</span> prod_list <span class="main">(</span><span class="quoted">"<span class="keyword1">∏:</span>_"</span> <span class="main">[</span>999<span class="main">]</span> 998<span class="main">)</span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Properties of sum and product›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We now present some useful properties of sum and product over
collections.›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹These lemmas just state that if all the elements in a
collection $C$ are less (greater than) than some value $m$, then the
sum will less than (greater than) $m*length(C)$.›</span></span>

<span class="keyword1" id="CauchysMeanTheorem-sum_list_mono_lt"><span class="command">lemma</span></span> sum_list_mono_lt <span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">xs</span><span class="main">::</span><span class="quoted"><span class="quoted">"real list"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span> set <span class="free">xs</span><span class="main">.</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">m</span><span class="main">)</span>
         <span class="main">⟶</span> <span class="main">(</span><span class="main">(</span><span class="main">∑:</span><span class="free">xs</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">(</span><span class="free">m</span><span class="main">*</span><span class="main">(</span>real <span class="main">(</span>length <span class="free">xs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">y</span> <span class="skolem">ys</span><span class="main">)</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">assume</span></span> ant<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span><span class="main">#</span><span class="skolem">ys</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span><span class="skolem">y</span><span class="main">#</span><span class="skolem">ys</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">m</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> ylm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">&lt;</span> <span class="free">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∑:</span><span class="main">(</span><span class="skolem">y</span><span class="main">#</span><span class="skolem">ys</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">m</span> <span class="main">*</span> real <span class="main">(</span>length <span class="main">(</span><span class="skolem">y</span><span class="main">#</span><span class="skolem">ys</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ys</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">with</span></span></span> ant <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>set <span class="skolem">ys</span><span class="main">.</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">with</span></span></span> calculation Cons <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∑:</span><span class="skolem">ys</span> <span class="main">&lt;</span> <span class="free">m</span><span class="main">*</span>real <span class="main">(</span>length <span class="skolem">ys</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∑:</span><span class="skolem">ys</span> <span class="main">+</span> <span class="skolem">y</span> <span class="main">&lt;</span> <span class="free">m</span><span class="main">*</span>real<span class="main">(</span>length <span class="skolem">ys</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> ylm <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∑:</span><span class="main">(</span><span class="skolem">y</span><span class="main">#</span><span class="skolem">ys</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">m</span><span class="main">*</span><span class="main">(</span>real<span class="main">(</span>length <span class="skolem">ys</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∑:</span><span class="main">(</span><span class="skolem">y</span><span class="main">#</span><span class="skolem">ys</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">m</span><span class="main">*</span><span class="main">(</span>real<span class="main">(</span>length <span class="skolem">ys</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∑:</span><span class="main">(</span><span class="skolem">y</span><span class="main">#</span><span class="skolem">ys</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">m</span><span class="main">*</span><span class="main">(</span>real <span class="main">(</span>length<span class="main">(</span><span class="skolem">y</span><span class="main">#</span><span class="skolem">ys</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="skolem">ys</span> <span class="main">≠</span> <span class="main">[]</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ys</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> ylm <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="CauchysMeanTheorem-sum_list_mono_gt"><span class="command">lemma</span></span> sum_list_mono_gt <span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">xs</span><span class="main">::</span><span class="quoted"><span class="quoted">"real list"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>set <span class="free">xs</span><span class="main">.</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="free">m</span><span class="main">)</span>
         <span class="main">⟶</span> <span class="main">(</span><span class="main">(</span><span class="main">∑:</span><span class="free">xs</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">(</span><span class="free">m</span><span class="main">*</span><span class="main">(</span>real <span class="main">(</span>length <span class="free">xs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">txt</span></span> <span class="quoted"><span class="plain_text">‹proof omitted›</span></span>
<span class="comment1">(*&lt;*)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">y</span> <span class="skolem">ys</span><span class="main">)</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">assume</span></span> ant<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span><span class="main">#</span><span class="skolem">ys</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span><span class="skolem">y</span><span class="main">#</span><span class="skolem">ys</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="free">m</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> ylm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">&gt;</span> <span class="free">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∑:</span><span class="main">(</span><span class="skolem">y</span><span class="main">#</span><span class="skolem">ys</span><span class="main">)</span> <span class="main">&gt;</span> <span class="free">m</span> <span class="main">*</span> real <span class="main">(</span>length <span class="main">(</span><span class="skolem">y</span><span class="main">#</span><span class="skolem">ys</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ys</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">with</span></span></span> ant <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>set <span class="skolem">ys</span><span class="main">.</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="free">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">with</span></span></span> calculation Cons <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∑:</span><span class="skolem">ys</span> <span class="main">&gt;</span> <span class="free">m</span><span class="main">*</span>real <span class="main">(</span>length <span class="skolem">ys</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∑:</span><span class="skolem">ys</span> <span class="main">+</span> <span class="skolem">y</span> <span class="main">&gt;</span> <span class="free">m</span><span class="main">*</span>real<span class="main">(</span>length <span class="skolem">ys</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> ylm <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∑:</span><span class="main">(</span><span class="skolem">y</span><span class="main">#</span><span class="skolem">ys</span><span class="main">)</span> <span class="main">&gt;</span> <span class="free">m</span><span class="main">*</span><span class="main">(</span>real<span class="main">(</span>length <span class="skolem">ys</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∑:</span><span class="main">(</span><span class="skolem">y</span><span class="main">#</span><span class="skolem">ys</span><span class="main">)</span> <span class="main">&gt;</span> <span class="free">m</span><span class="main">*</span><span class="main">(</span>real<span class="main">(</span>length <span class="skolem">ys</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∑:</span><span class="main">(</span><span class="skolem">y</span><span class="main">#</span><span class="skolem">ys</span><span class="main">)</span> <span class="main">&gt;</span> <span class="free">m</span><span class="main">*</span><span class="main">(</span>real <span class="main">(</span>length<span class="main">(</span><span class="skolem">y</span><span class="main">#</span><span class="skolem">ys</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="skolem">ys</span> <span class="main">≠</span> <span class="main">[]</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ys</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> ylm <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="comment1">(*&gt;*)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹If $a$ is in $C$ then the sum of the collection $D$ where $D$
is $C$ with $a$ removed is the sum of $C$ minus $a$.›</span></span>

<span class="keyword1" id="CauchysMeanTheorem-sum_list_rmv1"><span class="command">lemma</span></span> sum_list_rmv1<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> set <span class="free">xs</span> <span class="main">⟹</span> <span class="main">∑:</span><span class="main">(</span>remove1 <span class="free">a</span> <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> <span class="main">∑:</span><span class="free">xs</span> <span class="main">-</span> <span class="main">(</span><span class="free">a</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> ab_group_add<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹A handy addition and division distribution law over collection
sums.›</span></span>

<span class="keyword1" id="CauchysMeanTheorem-list_sum_distrib_aux"><span class="command">lemma</span></span> list_sum_distrib_aux<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑:</span><span class="free">xs</span><span class="main">/</span><span class="main">(</span><span class="free">n</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> archimedean_field<span class="main">)</span> <span class="main">+</span> <span class="main">∑:</span><span class="free">xs</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">∑:</span><span class="free">xs</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">x</span> <span class="skolem">xs</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span>
      <span class="quoted"><span class="quoted">"<span class="main">∑:</span><span class="main">(</span><span class="skolem">x</span><span class="main">#</span><span class="skolem">xs</span><span class="main">)</span><span class="main">/</span><span class="free">n</span> <span class="main">=</span> <span class="skolem">x</span><span class="main">/</span><span class="free">n</span> <span class="main">+</span> <span class="main">∑:</span><span class="skolem">xs</span><span class="main">/</span><span class="free">n</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_divide_distrib<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command"><span class="improper">with</span></span></span> Cons <span class="keyword1"><span class="command">have</span></span>
      <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">x</span><span class="main">/</span><span class="free">n</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span><span class="main">+</span><span class="main">1</span><span class="main">/</span><span class="free">n</span><span class="main">)</span><span class="main">*</span><span class="main">∑:</span><span class="skolem">xs</span> <span class="main">-</span> <span class="main">∑:</span><span class="skolem">xs</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span>
      <span class="quoted"><span class="quoted">"<span class="main">∑:</span><span class="main">(</span><span class="skolem">x</span><span class="main">#</span><span class="skolem">xs</span><span class="main">)</span> <span class="main">/</span> <span class="free">n</span> <span class="main">+</span> <span class="main">∑:</span><span class="main">(</span><span class="skolem">x</span><span class="main">#</span><span class="skolem">xs</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">x</span><span class="main">/</span><span class="free">n</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span><span class="main">+</span><span class="main">1</span><span class="main">/</span><span class="free">n</span><span class="main">)</span><span class="main">*</span><span class="main">∑:</span><span class="skolem">xs</span> <span class="main">-</span> <span class="main">∑:</span><span class="skolem">xs</span> <span class="main">+</span> <span class="main">∑:</span><span class="main">(</span><span class="skolem">x</span><span class="main">#</span><span class="skolem">xs</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span>
      <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">x</span><span class="main">/</span><span class="free">n</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span><span class="main">+</span><span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="free">n</span><span class="main">)</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">*</span><span class="main">∑:</span><span class="skolem">xs</span> <span class="main">+</span> <span class="main">∑:</span><span class="main">(</span><span class="skolem">x</span><span class="main">#</span><span class="skolem">xs</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> mult_1_left <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">∑:</span></span></span><span class="skolem"><span class="skolem"><span class="skolem">xs</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span>
      <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">x</span><span class="main">/</span><span class="free">n</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="free">n</span><span class="main">)</span><span class="main">*</span><span class="main">∑:</span><span class="skolem">xs</span> <span class="main">+</span> <span class="main">∑:</span><span class="main">(</span><span class="skolem">x</span><span class="main">#</span><span class="skolem">xs</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span>
      <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="free">n</span><span class="main">)</span><span class="main">*</span><span class="main">∑:</span><span class="main">(</span><span class="skolem">x</span><span class="main">#</span><span class="skolem">xs</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">*</span><span class="main">∑:</span><span class="main">(</span><span class="skolem">x</span><span class="main">#</span><span class="skolem">xs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">divide_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="CauchysMeanTheorem-remove1_retains_prod"><span class="command">lemma</span></span> remove1_retains_prod<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">a</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">xs</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> comm_ring_1 list"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">:</span> set <span class="free">xs</span> <span class="main">⟶</span> <span class="main">∏:</span><span class="free">xs</span> <span class="main">=</span> <span class="main">∏:</span><span class="main">(</span>remove1 <span class="free">a</span> <span class="free">xs</span><span class="main">)</span> <span class="main">*</span> <span class="free">a</span>"</span></span>
  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="free">xs</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">aa</span> <span class="skolem">list</span><span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> plist<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="skolem">list</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="main">(</span><span class="skolem">aa</span><span class="main">#</span><span class="skolem">list</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> aml<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">:</span> set<span class="main">(</span><span class="skolem">aa</span><span class="main">#</span><span class="skolem">list</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∏:</span><span class="main">(</span><span class="skolem">aa</span> <span class="main">#</span> <span class="skolem">list</span><span class="main">)</span> <span class="main">=</span> <span class="main">∏:</span>remove1 <span class="free">a</span> <span class="main">(</span><span class="skolem">aa</span> <span class="main">#</span> <span class="skolem">list</span><span class="main">)</span> <span class="main">*</span> <span class="free">a</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> aeq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> <span class="skolem">aa</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span>
        <span class="quoted"><span class="quoted">"remove1 <span class="free">a</span> <span class="main">(</span><span class="skolem">aa</span><span class="main">#</span><span class="skolem">list</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">list</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">hence</span></span>
        <span class="quoted"><span class="quoted">"<span class="main">∏:</span><span class="main">(</span>remove1 <span class="free">a</span> <span class="main">(</span><span class="skolem">aa</span><span class="main">#</span><span class="skolem">list</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">∏:</span><span class="skolem">list</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">with</span></span></span> aeq <span class="keyword1"><span class="command">have</span></span>
        <span class="quoted"><span class="quoted">"<span class="main">∏:</span><span class="main">(</span><span class="skolem">aa</span><span class="main">#</span><span class="skolem">list</span><span class="main">)</span> <span class="main">=</span> <span class="main">∏:</span><span class="skolem">list</span> <span class="main">*</span> <span class="free">a</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span>
        <span class="quoted"><span class="quoted">"<span class="main">∏:</span><span class="main">(</span><span class="skolem">aa</span><span class="main">#</span><span class="skolem">list</span><span class="main">)</span> <span class="main">=</span> <span class="main">∏:</span>remove1 <span class="free">a</span> <span class="main">(</span><span class="skolem">aa</span> <span class="main">#</span> <span class="skolem">list</span><span class="main">)</span> <span class="main">*</span> <span class="free">a</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> naeq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≠</span> <span class="skolem">aa</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> aml <span class="keyword1"><span class="command">have</span></span> aml2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">:</span> set <span class="skolem">list</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">from</span></span> naeq <span class="keyword1"><span class="command">have</span></span>
        <span class="quoted"><span class="quoted">"remove1 <span class="free">a</span> <span class="main">(</span><span class="skolem">aa</span><span class="main">#</span><span class="skolem">list</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">aa</span><span class="main">#</span><span class="main">(</span>remove1 <span class="free">a</span> <span class="skolem">list</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">hence</span></span></span>
        <span class="quoted"><span class="quoted">"<span class="main">∏:</span><span class="main">(</span>remove1 <span class="free">a</span> <span class="main">(</span><span class="skolem">aa</span><span class="main">#</span><span class="skolem">list</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">aa</span> <span class="main">*</span> <span class="main">∏:</span><span class="main">(</span>remove1 <span class="free">a</span> <span class="skolem">list</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> aml2 plist <span class="keyword1"><span class="command">have</span></span>
        <span class="quoted"><span class="quoted">"<span class="main">∏:</span><span class="skolem">list</span> <span class="main">=</span> <span class="main">∏:</span><span class="main">(</span>remove1 <span class="free">a</span> <span class="skolem">list</span><span class="main">)</span> <span class="main">*</span> <span class="free">a</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span>
        <span class="quoted"><span class="quoted">"<span class="main">∏:</span><span class="main">(</span><span class="skolem">aa</span><span class="main">#</span><span class="skolem">list</span><span class="main">)</span> <span class="main">=</span> <span class="main">∏:</span>remove1 <span class="free">a</span> <span class="main">(</span><span class="skolem">aa</span> <span class="main">#</span> <span class="skolem">list</span><span class="main">)</span> <span class="main">*</span> <span class="free">a</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The final lemma of this section states that if all elements
are positive and non-zero then the product of these elements is also
positive and non-zero.›</span></span>

<span class="keyword1" id="CauchysMeanTheorem-el_gt0_imp_prod_gt0"><span class="command">lemma</span></span> el_gt0_imp_prod_gt0 <span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">xs</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> archimedean_field list"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">:</span> set <span class="free">xs</span> <span class="main">⟶</span> <span class="bound">y</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> <span class="main">∏:</span><span class="free">xs</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">xs</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> exp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∏:</span><span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">xs</span><span class="main">)</span> <span class="main">=</span> <span class="main">∏:</span><span class="skolem">xs</span> <span class="main">*</span> <span class="skolem">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> Cons <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> exp Cons <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="comment1">(* ============================================================================= *)</span>
<span class="comment1">(* ============================================================================= *)</span>
<span class="comment1">(* ============================================================================= *)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Auxiliary lemma›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹This section presents a proof of the auxiliary lemma required
for this theorem.›</span></span>

<span class="keyword1" id="CauchysMeanTheorem-prod_exp"><span class="command">lemma</span></span> prod_exp<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span><span class="main">::</span><span class="quoted">real</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">4</span><span class="main">*</span><span class="main">(</span><span class="free">x</span><span class="main">*</span><span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span><span class="main">+</span><span class="free">y</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span> <span class="main">-</span> <span class="main">(</span><span class="free">x</span><span class="main">-</span><span class="free">y</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power2_diff power2_sum<span class="main">)</span>

<span class="keyword1" id="CauchysMeanTheorem-abs_less_imp_sq_less"><span class="command">lemma</span></span> abs_less_imp_sq_less <span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span><span class="main">::</span><span class="quoted">real</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">y</span><span class="main">::</span><span class="quoted">real</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">z</span><span class="main">::</span><span class="quoted">real</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">w</span><span class="main">::</span><span class="quoted">real</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> diff<span class="main">:</span> <span class="quoted"><span class="quoted">"abs <span class="main">(</span><span class="free">x</span><span class="main">-</span><span class="free">y</span><span class="main">)</span> <span class="main">&lt;</span> abs <span class="main">(</span><span class="free">z</span><span class="main">-</span><span class="free">w</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">-</span><span class="free">y</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span> <span class="main">&lt;</span> <span class="main">(</span><span class="free">z</span><span class="main">-</span><span class="free">w</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">=</span><span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"abs <span class="main">(</span><span class="free">x</span><span class="main">-</span><span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">with</span></span></span> diff <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"abs<span class="main">(</span><span class="free">z</span><span class="main">-</span><span class="free">w</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">z</span><span class="main">-</span><span class="free">w</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">≠</span><span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"abs <span class="main">(</span><span class="free">x</span> <span class="main">-</span> <span class="free">y</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> diff <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>abs <span class="main">(</span><span class="free">x</span><span class="main">-</span><span class="free">y</span><span class="main">)</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span> <span class="main">&lt;</span> <span class="main">(</span>abs <span class="main">(</span><span class="free">z</span><span class="main">-</span><span class="free">w</span><span class="main">)</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">drule</span> power_strict_mono <span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> a<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"abs <span class="main"><span class="main"><span class="main">(</span></span></span><span class="free"><span class="free"><span class="free">x</span></span></span><span class="main"><span class="main"><span class="main">-</span></span></span><span class="free"><span class="free"><span class="free">y</span></span></span><span class="main"><span class="main"><span class="main">)</span></span></span>"</span></span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> n<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="numeral"><span class="quoted"><span class="numeral"><span class="quoted"><span class="numeral">2</span></span></span></span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> b<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"abs <span class="main"><span class="main"><span class="main">(</span></span></span><span class="free"><span class="free"><span class="free">z</span></span></span><span class="main"><span class="main"><span class="main">-</span></span></span><span class="free"><span class="free"><span class="free">w</span></span></span><span class="main"><span class="main"><span class="main">)</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The required lemma (phrased slightly differently than in the
informal proof.) Here we show that for any two pairs of numbers with
equal sums the pair with the least difference has the greater
product.›</span></span>

<span class="keyword1" id="CauchysMeanTheorem-le_diff_imp_gt_prod"><span class="command">lemma</span></span> le_diff_imp_gt_prod <span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span><span class="main">::</span><span class="quoted">real</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">y</span><span class="main">::</span><span class="quoted">real</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">z</span><span class="main">::</span><span class="quoted">real</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">w</span><span class="main">::</span><span class="quoted">real</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> diff<span class="main">:</span> <span class="quoted"><span class="quoted">"abs <span class="main">(</span><span class="free">x</span><span class="main">-</span><span class="free">y</span><span class="main">)</span> <span class="main">&lt;</span> abs <span class="main">(</span><span class="free">z</span><span class="main">-</span><span class="free">w</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> sum<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">+</span><span class="free">y</span> <span class="main">=</span> <span class="free">z</span><span class="main">+</span><span class="free">w</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">*</span><span class="free">y</span> <span class="main">&gt;</span> <span class="free">z</span><span class="main">*</span><span class="free">w</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> sum <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">+</span><span class="free">y</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span> <span class="main">=</span> <span class="main">(</span><span class="free">z</span><span class="main">+</span><span class="free">w</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> diff <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">-</span><span class="free">y</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span> <span class="main">&lt;</span> <span class="main">(</span><span class="free">z</span><span class="main">-</span><span class="free">w</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> abs_less_imp_sq_less<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">+</span><span class="free">y</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span> <span class="main">-</span> <span class="main">(</span><span class="free">x</span><span class="main">-</span><span class="free">y</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span> <span class="main">&gt;</span> <span class="main">(</span><span class="free">z</span><span class="main">+</span><span class="free">w</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span> <span class="main">-</span> <span class="main">(</span><span class="free">z</span><span class="main">-</span><span class="free">w</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">*</span><span class="free">y</span> <span class="main">&gt;</span> <span class="free">z</span><span class="main">*</span><span class="free">w</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> prod_exp <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(* ============================================================================= *)</span>
<span class="comment1">(* ============================================================================= *)</span>
<span class="comment1">(* ============================================================================= *)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Mean and GMean›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Now we introduce definitions and properties of arithmetic and
geometric means over collections of real numbers.›</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Definitions›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹{\em Arithmetic mean}›</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">mean</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>real list<span class="main">)</span><span class="main">⇒</span>real"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">mean</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∑:</span><span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">/</span> real <span class="main">(</span>length <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹{\em Geometric mean}›</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">gmean</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>real list<span class="main">)</span><span class="main">⇒</span>real"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">gmean</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">=</span> root <span class="main">(</span>length <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> <span class="main">(</span><span class="main">∏:</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Properties›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Here we present some trivial properties of {\em mean} and {\em gmean}.›</span></span>

<span class="keyword1" id="CauchysMeanTheorem-list_sum_mean"><span class="command">lemma</span></span> list_sum_mean<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">xs</span><span class="main">::</span><span class="quoted"><span class="quoted">"real list"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∑:</span><span class="free">xs</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>mean <span class="free">xs</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>real <span class="main">(</span>length <span class="free">xs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct_tac</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">xs</span></span></span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> mean_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="CauchysMeanTheorem-list_mean_eq_iff"><span class="command">lemma</span></span> list_mean_eq_iff<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">one</span><span class="main">::</span><span class="quoted"><span class="quoted">"real list"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">two</span><span class="main">::</span><span class="quoted"><span class="quoted">"real list"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span>
    se<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span> <span class="main">∑:</span><span class="free">one</span> <span class="main">=</span> <span class="main">∑:</span><span class="free">two</span> <span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    le<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>length <span class="free">one</span> <span class="main">=</span> length <span class="free">two</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>mean <span class="free">one</span> <span class="main">=</span> mean <span class="free">two</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> se le <span class="keyword1"><span class="command">have</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑:</span><span class="free">one</span> <span class="main">/</span> real <span class="main">(</span>length <span class="free">one</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑:</span><span class="free">two</span> <span class="main">/</span> real <span class="main">(</span>length <span class="free">two</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> mean_def <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="CauchysMeanTheorem-list_gmean_gt_iff"><span class="command">lemma</span></span> list_gmean_gt_iff<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">one</span><span class="main">::</span><span class="quoted"><span class="quoted">"real list"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">two</span><span class="main">::</span><span class="quoted"><span class="quoted">"real list"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span>
    gz1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∏:</span><span class="free">one</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> gz2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∏:</span><span class="free">two</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    ne1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">one</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ne2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">two</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    pe<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∏:</span><span class="free">one</span> <span class="main">&gt;</span> <span class="main">∏:</span><span class="free">two</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    le<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>length <span class="free">one</span> <span class="main">=</span> length <span class="free">two</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>gmean <span class="free">one</span> <span class="main">&gt;</span> gmean <span class="free">two</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> gmean_def
  <span class="keyword1"><span class="command">using</span></span> le ne2 pe <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹This slightly more complicated lemma shows that for every non-empty collection with mean $M$, adding another element $a$ where $a=M$ results in a new list with the same mean $M$.›</span></span>

<span class="keyword1" id="CauchysMeanTheorem-list_mean_cons"><span class="command">lemma</span></span> list_mean_cons <span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">xs</span><span class="main">::</span><span class="quoted"><span class="quoted">"real list"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟶</span> mean <span class="main">(</span><span class="main">(</span>mean <span class="free">xs</span><span class="main">)</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span> <span class="main">=</span> mean <span class="free">xs</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> lne<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">len</span></span> <span class="keyword2"><span class="keyword">where</span></span> ld<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">len</span> <span class="main">=</span> real <span class="main">(</span>length <span class="free">xs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> lne <span class="keyword1"><span class="command">have</span></span> lgt0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">len</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> lnez<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">len</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> lgt0 <span class="keyword1"><span class="command">have</span></span> l1nez<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">len</span> <span class="main">+</span> <span class="main">1</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> ld <span class="keyword1"><span class="command">have</span></span> mean<span class="main">:</span> <span class="quoted"><span class="quoted">"mean <span class="free">xs</span> <span class="main">=</span> <span class="main">∑:</span><span class="free">xs</span> <span class="main">/</span> <span class="skolem">len</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> mean_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> ld of_nat_add of_int_1 mean_def
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"mean <span class="main">(</span><span class="main">(</span>mean <span class="free">xs</span><span class="main">)</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑:</span><span class="free">xs</span><span class="main">/</span><span class="skolem">len</span> <span class="main">+</span> <span class="main">∑:</span><span class="free">xs</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span><span class="main">+</span><span class="skolem">len</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> list_sum_distrib_aux<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">xs</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="skolem">len</span><span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="main">∑:</span><span class="free">xs</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span><span class="main">+</span><span class="skolem">len</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command"><span class="improper">with</span></span></span> lnez <span class="keyword1"><span class="command">have</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">len</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">*</span><span class="main">∑:</span><span class="free">xs</span> <span class="main">/</span> <span class="main">(</span><span class="skolem">len</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span><span class="main">+</span><span class="skolem">len</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> mult_divide_mult_cancel_left
      <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">,</span></span> <span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> c<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem">len</span></span>"</span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> a<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">(</span></span><span class="main"><span class="main">1</span></span> <span class="main"><span class="main">+</span></span> <span class="main"><span class="main">1</span></span> <span class="main"><span class="main">/</span></span> <span class="skolem"><span class="skolem">len</span></span><span class="main"><span class="main">)</span></span> <span class="main"><span class="main">*</span></span> <span class="main"><span class="main">∑:</span></span><span class="free"><span class="free">xs</span></span>"</span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> b<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">1</span></span><span class="main"><span class="main">+</span></span><span class="skolem"><span class="skolem">len</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> l1nez <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">∑:</span><span class="free">xs</span> <span class="main">/</span> <span class="skolem">len</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> mult.commute <span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> a<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem">len</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> mult_divide_mult_cancel_left
      <span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> c<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem">len</span></span><span class="main"><span class="main">+</span></span><span class="main"><span class="main">1</span></span>"</span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> a<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">∑:</span></span><span class="free"><span class="free">xs</span></span>"</span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> b<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem">len</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">ac_simps</span></span> <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"mean <span class="main">(</span><span class="main">(</span>mean <span class="free">xs</span><span class="main">)</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span> <span class="main">=</span> mean <span class="free">xs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mean<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹For a non-empty collection with positive mean, if we add a positive number to the collection then the mean remains positive.›</span></span>

<span class="keyword1" id="CauchysMeanTheorem-mean_gt_0"><span class="command">lemma</span></span> mean_gt_0 <span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">xs</span><span class="main">≠</span><span class="main">[]</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">x</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="main">(</span>mean <span class="free">xs</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="main">(</span>mean <span class="main">(</span><span class="free">x</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">x</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">&lt;</span> mean <span class="free">xs</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> xgt0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> mgt0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> mean <span class="free">xs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> a <span class="keyword1"><span class="command">have</span></span> lxsgt0<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="free">xs</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> mgt0 <span class="keyword1"><span class="command">have</span></span> xsgt0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="main">∑:</span><span class="free">xs</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"mean <span class="free">xs</span> <span class="main">=</span> <span class="main">∑:</span><span class="free">xs</span> <span class="main">/</span> real <span class="main">(</span>length <span class="free">xs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> mean_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∑:</span><span class="free">xs</span> <span class="main">=</span> mean <span class="free">xs</span> <span class="main">*</span> real <span class="main">(</span>length <span class="free">xs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> lxsgt0 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"real <span class="main">(</span>length <span class="free">xs</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">with</span></span></span> calculation lxsgt0 mgt0 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">with</span></span> xgt0 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∑:</span><span class="main">(</span><span class="free">x</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="main">(</span>mean <span class="main">(</span><span class="free">x</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="main">∑:</span><span class="main">(</span><span class="free">x</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"real <span class="main">(</span>length <span class="main">(</span><span class="free">x</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> mean_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(* ============================================================================= *)</span>
<span class="comment1">(* ============================================================================= *)</span>
<span class="comment1">(* ============================================================================= *)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>list_neq›</span></span></span></span>, <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>list_eq›</span></span></span></span>›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹This section presents a useful formalisation of the act of removing all the elements from a collection that are equal (not equal) to a particular value. We use this to extract all the non-mean elements from a collection as is required by the proof.›</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Definitions›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>list_neq›</span></span></span></span> and <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>list_eq›</span></span></span></span> just extract elements from a collection that are not equal (or equal) to some value.›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span>
  <span class="entity">list_neq</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> list<span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> list<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">list_neq</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="free"><span class="bound"><span class="entity">el</span></span></span> <span class="main">==</span> filter <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">≠</span><span class="free"><span class="bound"><span class="entity">el</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span>
  <span class="entity">list_eq</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> list<span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> list<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">list_eq</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="free"><span class="bound"><span class="entity">el</span></span></span> <span class="main">==</span> filter <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">=</span><span class="free"><span class="bound"><span class="entity">el</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span>"</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Properties›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹This lemma just proves a required fact about <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>list_neq›</span></span></span></span>, {\em remove1} and {\em length}.›</span></span>

<span class="keyword1" id="CauchysMeanTheorem-list_neq_remove1"><span class="command">lemma</span></span> list_neq_remove1 <span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">≠</span><span class="free">m</span> <span class="main">∧</span> <span class="free">a</span> <span class="main">:</span> set <span class="free">xs</span>
  <span class="main">⟶</span> length <span class="main">(</span>list_neq <span class="main">(</span>remove1 <span class="free">a</span> <span class="free">xs</span><span class="main">)</span> <span class="free">m</span><span class="main">)</span> <span class="main">&lt;</span> length <span class="main">(</span>list_neq <span class="free">xs</span> <span class="free">m</span><span class="main">)</span>"</span></span>
  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?A</span> <span class="free">xs</span> <span class="main">⟶</span> <span class="var">?B</span> <span class="free">xs</span>"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="free">xs</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">x</span> <span class="skolem">xs</span><span class="main">)</span>
  <span class="keyword1"><span class="command">note</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?P</span> <span class="skolem">xs</span>›</span></span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?A</span> <span class="main">(</span><span class="skolem">x</span><span class="main">#</span><span class="skolem">xs</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span>
      a_ne_m<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">≠</span><span class="free">m</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      a_mem_x_xs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">:</span> set<span class="main">(</span><span class="skolem">x</span><span class="main">#</span><span class="skolem">xs</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?B</span> <span class="main">(</span><span class="skolem">x</span><span class="main">#</span><span class="skolem">xs</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> a_ne_m a_mem_x_xs <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">=</span><span class="free">a</span>"</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> xs_ne<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> a_ne_m a_mem_x_xs <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">=</span><span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">with</span></span> a_ne_m <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> a_ne_x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">≠</span><span class="skolem">x</span>"</span></span>
        <span class="keyword1"><span class="command">with</span></span> a_mem_x_xs <span class="keyword1"><span class="command">have</span></span> a_mem_xs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">:</span> set <span class="skolem">xs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">with</span></span> xs_ne a_ne_m Cons <span class="keyword1"><span class="command">have</span></span>
          rel<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>list_neq <span class="main">(</span>remove1 <span class="free">a</span> <span class="skolem">xs</span><span class="main">)</span> <span class="free">m</span><span class="main">)</span> <span class="main">&lt;</span> length <span class="main">(</span>list_neq <span class="skolem">xs</span> <span class="free">m</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
          <span class="keyword3"><span class="command">assume</span></span> x_e_m<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">=</span><span class="free">m</span>"</span></span>
          <span class="keyword1"><span class="command">with</span></span> Cons xs_ne a_ne_m a_mem_xs <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">assume</span></span> x_ne_m<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">≠</span><span class="free">m</span>"</span></span>
          <span class="keyword1"><span class="command">from</span></span> a_ne_x <span class="keyword1"><span class="command">have</span></span>
            <span class="quoted"><span class="quoted">"remove1 <span class="free">a</span> <span class="main">(</span><span class="skolem">x</span><span class="main">#</span><span class="skolem">xs</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">x</span><span class="main">#</span><span class="main">(</span>remove1 <span class="free">a</span> <span class="skolem">xs</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">hence</span></span>
            <span class="quoted"><span class="quoted">"length <span class="main">(</span>list_neq <span class="main">(</span>remove1 <span class="free">a</span> <span class="main">(</span><span class="skolem">x</span><span class="main">#</span><span class="skolem">xs</span><span class="main">)</span><span class="main">)</span> <span class="free">m</span><span class="main">)</span> <span class="main">=</span>
             length <span class="main">(</span>list_neq <span class="main">(</span><span class="skolem">x</span><span class="main">#</span><span class="main">(</span>remove1 <span class="free">a</span> <span class="skolem">xs</span><span class="main">)</span><span class="main">)</span> <span class="free">m</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command"><span class="improper">with</span></span></span> x_ne_m <span class="keyword1"><span class="command">have</span></span>
            <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">1</span> <span class="main">+</span> length <span class="main">(</span>list_neq <span class="main">(</span>remove1 <span class="free">a</span> <span class="skolem">xs</span><span class="main">)</span> <span class="free">m</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span>
            <span class="quoted"><span class="quoted">"length <span class="main">(</span>list_neq <span class="main">(</span>remove1 <span class="free">a</span> <span class="main">(</span><span class="skolem">x</span><span class="main">#</span><span class="skolem">xs</span><span class="main">)</span><span class="main">)</span> <span class="free">m</span><span class="main">)</span> <span class="main">=</span>
             <span class="main">1</span> <span class="main">+</span> length <span class="main">(</span>list_neq <span class="main">(</span>remove1 <span class="free">a</span> <span class="skolem">xs</span><span class="main">)</span> <span class="free">m</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">with</span></span></span> x_ne_m a_ne_x <span class="keyword1"><span class="command">have</span></span>
            <span class="quoted"><span class="quoted">"length <span class="main">(</span>list_neq <span class="main">(</span><span class="skolem">x</span><span class="main">#</span><span class="skolem">xs</span><span class="main">)</span> <span class="free">m</span><span class="main">)</span> <span class="main">=</span>
             <span class="main">1</span> <span class="main">+</span> length <span class="main">(</span>list_neq <span class="skolem">xs</span> <span class="free">m</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">with</span></span></span> rel <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="main">(</span><span class="skolem">x</span><span class="main">#</span><span class="skolem">xs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We now prove some facts about <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>list_eq›</span></span></span></span>, <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>list_neq›</span></span></span></span>, length, sum and product.›</span></span>

<span class="keyword1" id="CauchysMeanTheorem-list_eq_sum"><span class="command">lemma</span></span> list_eq_sum <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">xs</span><span class="main">::</span><span class="quoted"><span class="quoted">"real list"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∑:</span><span class="main">(</span>list_eq <span class="free">xs</span> <span class="free">m</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">m</span> <span class="main">*</span> <span class="main">(</span>real <span class="main">(</span>length <span class="main">(</span>list_eq <span class="free">xs</span> <span class="free">m</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct_tac</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">xs</span></span></span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="CauchysMeanTheorem-list_eq_prod"><span class="command">lemma</span></span> list_eq_prod <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">xs</span><span class="main">::</span><span class="quoted"><span class="quoted">"real list"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∏:</span><span class="main">(</span>list_eq <span class="free">xs</span> <span class="free">m</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">m</span> <span class="main">^</span> <span class="main">(</span>length <span class="main">(</span>list_eq <span class="free">xs</span> <span class="free">m</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct_tac</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">xs</span></span></span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="CauchysMeanTheorem-sum_list_split"><span class="command">lemma</span></span> sum_list_split<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">xs</span><span class="main">::</span><span class="quoted"><span class="quoted">"real list"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∑:</span><span class="free">xs</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑:</span><span class="main">(</span>list_neq <span class="free">xs</span> <span class="free">m</span><span class="main">)</span> <span class="main">+</span> <span class="main">∑:</span><span class="main">(</span>list_eq <span class="free">xs</span> <span class="free">m</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="CauchysMeanTheorem-prod_list_split"><span class="command">lemma</span></span> prod_list_split<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">xs</span><span class="main">::</span><span class="quoted"><span class="quoted">"real list"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∏:</span><span class="free">xs</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏:</span><span class="main">(</span>list_neq <span class="free">xs</span> <span class="free">m</span><span class="main">)</span> <span class="main">*</span> <span class="main">∏:</span><span class="main">(</span>list_eq <span class="free">xs</span> <span class="free">m</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="CauchysMeanTheorem-sum_list_length_split"><span class="command">lemma</span></span> sum_list_length_split<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">xs</span><span class="main">::</span><span class="quoted"><span class="quoted">"real list"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"length <span class="free">xs</span> <span class="main">=</span> length <span class="main">(</span>list_neq <span class="free">xs</span> <span class="free">m</span><span class="main">)</span> <span class="main">+</span> length <span class="main">(</span>list_eq <span class="free">xs</span> <span class="free">m</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>



<span class="comment1">(* ============================================================================= *)</span>
<span class="comment1">(* ============================================================================= *)</span>
<span class="comment1">(* ============================================================================= *)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Element selection›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We now show that given after extracting all the elements not equal to the mean there exists one that is greater then (or less than) the mean.›</span></span>

<span class="keyword1" id="CauchysMeanTheorem-pick_one_gt"><span class="command">lemma</span></span> pick_one_gt<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">xs</span><span class="main">::</span><span class="quoted"><span class="quoted">"real list"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">m</span><span class="main">::</span><span class="quoted">real</span>
  <span class="keyword2"><span class="keyword">defines</span></span> m<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">≡</span> <span class="main">(</span>mean <span class="free">xs</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> neq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">noteq</span> <span class="main">≡</span> list_neq <span class="free">xs</span> <span class="free">m</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> asum<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">noteq</span><span class="main">≠</span><span class="main">[]</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">e</span><span class="main">.</span> <span class="bound">e</span> <span class="main">:</span> set <span class="free">noteq</span> <span class="main">∧</span> <span class="bound">e</span> <span class="main">&gt;</span> <span class="free">m</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?m</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>mean <span class="free">xs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?neq</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"list_neq <span class="free">xs</span> <span class="var">?m</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?eq</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"list_eq <span class="free">xs</span> <span class="var">?m</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> list_eq_sum <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑:</span><span class="var">?eq</span><span class="main">)</span> <span class="main">=</span> <span class="var">?m</span> <span class="main">*</span> <span class="main">(</span>real <span class="main">(</span>length <span class="var">?eq</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> asum <span class="keyword1"><span class="command">have</span></span> neq_ne<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="var">?neq</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> m neq <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">assume</span></span> not_el<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="main">∃</span><span class="bound">e</span><span class="main">.</span> <span class="bound">e</span> <span class="main">:</span> set <span class="free">noteq</span> <span class="main">∧</span> <span class="free">m</span> <span class="main">&lt;</span> <span class="bound">e</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> not_el_exp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="main">∃</span><span class="bound">e</span><span class="main">.</span> <span class="bound">e</span> <span class="main">:</span> set <span class="var">?neq</span> <span class="main">∧</span> <span class="var">?m</span> <span class="main">&lt;</span> <span class="bound">e</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> m neq <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">e</span><span class="main">.</span> <span class="main">¬</span><span class="main">(</span><span class="bound">e</span> <span class="main">:</span> set <span class="var">?neq</span><span class="main">)</span> <span class="main">∨</span> <span class="main">¬</span><span class="main">(</span><span class="bound">e</span> <span class="main">&gt;</span> <span class="var">?m</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">e</span><span class="main">.</span> <span class="bound">e</span> <span class="main">:</span> set <span class="var">?neq</span> <span class="main">⟶</span> <span class="main">¬</span><span class="main">(</span><span class="bound">e</span> <span class="main">&gt;</span> <span class="var">?m</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">e</span><span class="main">.</span> <span class="bound">e</span> <span class="main">:</span> set <span class="var">?neq</span> <span class="main">⟶</span> <span class="bound">e</span> <span class="main">≤</span> <span class="var">?m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> linorder_not_less<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">e</span><span class="main">.</span> <span class="bound">e</span> <span class="main">:</span> set <span class="var">?neq</span> <span class="main">⟶</span> <span class="bound">e</span> <span class="main">&lt;</span> <span class="var">?m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>order_le_less<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> assms sum_list_mono_lt <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑:</span><span class="var">?neq</span><span class="main">)</span> <span class="main">&lt;</span> <span class="var">?m</span> <span class="main">*</span> <span class="main">(</span>real <span class="main">(</span>length <span class="var">?neq</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑:</span><span class="var">?neq</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑:</span><span class="var">?eq</span><span class="main">)</span> <span class="main">&lt;</span> <span class="var">?m</span> <span class="main">*</span> <span class="main">(</span>real <span class="main">(</span>length <span class="var">?neq</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑:</span><span class="var">?eq</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="var">?m</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span>real <span class="main">(</span>length <span class="var">?neq</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span>real <span class="main">(</span>length <span class="var">?eq</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="var">?m</span> <span class="main">*</span> <span class="main">(</span>real <span class="main">(</span>length <span class="free">xs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> of_nat_add <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_list_length_split <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">∑:</span><span class="free">xs</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> list_sum_mean <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> not_el calculation <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> sum_list_split <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="CauchysMeanTheorem-pick_one_lt"><span class="command">lemma</span></span> pick_one_lt<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">xs</span><span class="main">::</span><span class="quoted"><span class="quoted">"real list"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">m</span><span class="main">::</span><span class="quoted">real</span>
  <span class="keyword2"><span class="keyword">defines</span></span> m<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">≡</span> <span class="main">(</span>mean <span class="free">xs</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> neq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">noteq</span> <span class="main">≡</span> list_neq <span class="free">xs</span> <span class="free">m</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> asum<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">noteq</span><span class="main">≠</span><span class="main">[]</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">e</span><span class="main">.</span> <span class="bound">e</span> <span class="main">:</span> set <span class="free">noteq</span> <span class="main">∧</span> <span class="bound">e</span> <span class="main">&lt;</span> <span class="free">m</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span> <span class="comment1">― ‹reductio ad absurdum›</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?m</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>mean <span class="free">xs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?neq</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"list_neq <span class="free">xs</span> <span class="var">?m</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?eq</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"list_eq <span class="free">xs</span> <span class="var">?m</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> list_eq_sum <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑:</span><span class="var">?eq</span><span class="main">)</span> <span class="main">=</span> <span class="var">?m</span> <span class="main">*</span> <span class="main">(</span>real <span class="main">(</span>length <span class="var">?eq</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> asum <span class="keyword1"><span class="command">have</span></span> neq_ne<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="var">?neq</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> m neq <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">assume</span></span> not_el<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="main">∃</span><span class="bound">e</span><span class="main">.</span> <span class="bound">e</span> <span class="main">:</span> set <span class="free">noteq</span> <span class="main">∧</span> <span class="free">m</span> <span class="main">&gt;</span> <span class="bound">e</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> not_el_exp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="main">∃</span><span class="bound">e</span><span class="main">.</span> <span class="bound">e</span> <span class="main">:</span> set <span class="var">?neq</span> <span class="main">∧</span> <span class="var">?m</span> <span class="main">&gt;</span> <span class="bound">e</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> m neq <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">e</span><span class="main">.</span> <span class="main">¬</span><span class="main">(</span><span class="bound">e</span> <span class="main">:</span> set <span class="var">?neq</span><span class="main">)</span> <span class="main">∨</span> <span class="main">¬</span><span class="main">(</span><span class="bound">e</span> <span class="main">&lt;</span> <span class="var">?m</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">e</span><span class="main">.</span> <span class="bound">e</span> <span class="main">:</span> set <span class="var">?neq</span> <span class="main">⟶</span> <span class="main">¬</span><span class="main">(</span><span class="bound">e</span> <span class="main">&lt;</span> <span class="var">?m</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">e</span><span class="main">.</span> <span class="bound">e</span> <span class="main">:</span> set <span class="var">?neq</span> <span class="main">⟶</span> <span class="bound">e</span> <span class="main">≥</span> <span class="var">?m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> linorder_not_less<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">e</span><span class="main">.</span> <span class="bound">e</span> <span class="main">:</span> set <span class="var">?neq</span> <span class="main">⟶</span> <span class="bound">e</span> <span class="main">&gt;</span> <span class="var">?m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> order_le_less<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> assms sum_list_mono_gt <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑:</span><span class="var">?neq</span><span class="main">)</span> <span class="main">&gt;</span> <span class="var">?m</span> <span class="main">*</span> <span class="main">(</span>real <span class="main">(</span>length <span class="var">?neq</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑:</span><span class="var">?neq</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑:</span><span class="var">?eq</span><span class="main">)</span> <span class="main">&gt;</span> <span class="var">?m</span> <span class="main">*</span> <span class="main">(</span>real <span class="main">(</span>length <span class="var">?neq</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑:</span><span class="var">?eq</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?m</span> <span class="main">*</span> <span class="main">(</span>real <span class="main">(</span>length <span class="var">?neq</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑:</span><span class="var">?eq</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
     <span class="main">(</span><span class="var">?m</span> <span class="main">*</span> <span class="main">(</span>real <span class="main">(</span>length <span class="var">?neq</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="var">?m</span> <span class="main">*</span> <span class="main">(</span>real <span class="main">(</span>length <span class="var">?eq</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="var">?m</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span>real <span class="main">(</span>length <span class="var">?neq</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span>real <span class="main">(</span>length <span class="var">?eq</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="var">?m</span> <span class="main">*</span> <span class="main">(</span>real <span class="main">(</span>length <span class="free">xs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> of_nat_add <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_list_length_split <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">∑:</span><span class="free">xs</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> list_sum_mean <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> not_el calculation <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> sum_list_split <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(* =================================================================== *)</span>
<span class="comment1">(* =================================================================== *)</span>
<span class="comment1">(* =================================================================== *)</span>
<span class="comment1">(* =================================================================== *)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Abstract properties›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹In order to maintain some comprehension of the following proofs we now introduce some properties of collections.›</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Definitions›</span></span>




<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹{\em het}: The heterogeneity of a collection is the number of elements not equal to its mean. A heterogeneity of zero implies the all the elements in the collection are the same (i.e. homogeneous).›</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">het</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real list <span class="main">⇒</span> nat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">het</span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="main">=</span> length <span class="main">(</span>list_neq <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="main">(</span>mean <span class="free"><span class="bound"><span class="entity">l</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="CauchysMeanTheorem-het_gt_0_imp_noteq_ne"><span class="command">lemma</span></span> het_gt_0_imp_noteq_ne<span class="main">:</span> <span class="quoted"><span class="quoted">"het <span class="free">l</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> list_neq <span class="free">l</span> <span class="main">(</span>mean <span class="free">l</span><span class="main">)</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> het_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="CauchysMeanTheorem-het_gt_0I"><span class="command">lemma</span></span> het_gt_0I<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> set <span class="free">xs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> set <span class="free">xs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> neq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≠</span> <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"het <span class="free">xs</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="var">?thesis</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"het <span class="free">xs</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> this<span class="main">[</span><span class="operator">unfolded</span> het_def<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"list_neq <span class="free">xs</span> <span class="main">(</span>mean <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> arg_cong<span class="main">[</span><span class="operator">OF</span> this<span class="main">,</span> <span class="operator">of</span> <span class="quoted">set</span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> mean<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> set <span class="free">xs</span> <span class="main">⟹</span> <span class="bound">x</span> <span class="main">=</span> mean <span class="free">xs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> mean<span class="main">[</span><span class="operator">OF</span> a<span class="main">]</span> mean<span class="main">[</span><span class="operator">OF</span> b<span class="main">]</span> neq <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>γ-eq›</span></span></span></span>: Two lists are $\gamma$-equivalent if and only
if they both have the same number of elements and the same arithmetic
means.›</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">γ_eq</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>real list<span class="main">)</span><span class="main">*</span><span class="main">(</span>real list<span class="main">)</span><span class="main">)</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">γ_eq</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">⟷</span> mean <span class="main">(</span>fst <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="main">=</span> mean <span class="main">(</span>snd <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="main">∧</span> length <span class="main">(</span>fst <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="main">=</span> length <span class="main">(</span>snd <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>γ_eq›</span></span></span></span> is transitive and symmetric.›</span></span>

<span class="keyword1" id="CauchysMeanTheorem-γ_eq_sym"><span class="command">lemma</span></span> γ_eq_sym<span class="main">:</span> <span class="quoted"><span class="quoted">"γ_eq <span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">)</span> <span class="main">=</span> γ_eq <span class="main">(</span><span class="free">b</span><span class="main">,</span><span class="free">a</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> γ_eq_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="CauchysMeanTheorem-γ_eq_trans"><span class="command">lemma</span></span> γ_eq_trans<span class="main">:</span>
  <span class="quoted"><span class="quoted">"γ_eq <span class="main">(</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">)</span> <span class="main">⟹</span> γ_eq <span class="main">(</span><span class="free">y</span><span class="main">,</span><span class="free">z</span><span class="main">)</span> <span class="main">⟹</span> γ_eq <span class="main">(</span><span class="free">x</span><span class="main">,</span><span class="free">z</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> γ_eq_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹{\em pos}: A list is positive if all its elements are greater than 0.›</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">pos</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real list <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">pos</span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="main">⟷</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">l</span></span></span><span class="main">=</span><span class="main">[]</span> <span class="keyword1">then</span> False <span class="keyword1">else</span> <span class="main">∀</span><span class="bound">e</span><span class="main">.</span> <span class="bound">e</span> <span class="main">:</span> set <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="main">⟶</span> <span class="bound">e</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="CauchysMeanTheorem-pos_empty"><span class="command">lemma</span></span> pos_empty <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"pos <span class="main">[]</span> <span class="main">=</span> False"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> pos_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1" id="CauchysMeanTheorem-pos_single"><span class="command">lemma</span></span> pos_single <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"pos <span class="main">[</span><span class="free">x</span><span class="main">]</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> pos_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1" id="CauchysMeanTheorem-pos_imp_ne"><span class="command">lemma</span></span> pos_imp_ne<span class="main">:</span> <span class="quoted"><span class="quoted">"pos <span class="free">xs</span> <span class="main">⟹</span> <span class="free">xs</span><span class="main">≠</span><span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> pos_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="CauchysMeanTheorem-pos_cons"><span class="command">lemma</span></span> pos_cons <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟶</span> pos <span class="main">(</span><span class="free">x</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span> <span class="main">=</span>
   <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span><span class="free">x</span><span class="main">&gt;</span><span class="main">0</span><span class="main">)</span> <span class="keyword1">then</span> pos <span class="free">xs</span> <span class="keyword1">else</span> False<span class="main">)</span>"</span></span>
  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="free">x</span> <span class="free">xs</span>"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?A</span> <span class="free">xs</span> <span class="main">⟶</span> <span class="var">?S</span> <span class="free">x</span> <span class="free">xs</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> if_split<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> impI<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> xsne<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> pxs_simp<span class="main">:</span>
    <span class="quoted"><span class="quoted">"pos <span class="free">xs</span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound">e</span><span class="main">.</span> <span class="bound">e</span> <span class="main">:</span> set <span class="free">xs</span> <span class="main">⟶</span> <span class="bound">e</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> pos_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">0</span> <span class="main">&lt;</span> <span class="free">x</span> <span class="main">⟶</span> pos <span class="main">(</span><span class="free">x</span> <span class="main">#</span> <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> pos <span class="free">xs</span><span class="main">)</span> <span class="main">∧</span>
     <span class="main">(</span><span class="main">¬</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">x</span> <span class="main">⟶</span> <span class="main">¬</span> pos <span class="main">(</span><span class="free">x</span> <span class="main">#</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">assume</span></span> xgt0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">x</span>"</span></span>
      <span class="keyword1"><span class="command">{</span></span>
        <span class="keyword3"><span class="command">assume</span></span> pxs<span class="main">:</span> <span class="quoted"><span class="quoted">"pos <span class="free">xs</span>"</span></span>
        <span class="keyword1"><span class="command">with</span></span> pxs_simp <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">e</span><span class="main">.</span> <span class="bound">e</span> <span class="main">:</span> set <span class="free">xs</span> <span class="main">⟶</span> <span class="bound">e</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">with</span></span> xgt0 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">e</span><span class="main">.</span> <span class="bound">e</span> <span class="main">:</span> set <span class="main">(</span><span class="free">x</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span> <span class="main">⟶</span> <span class="bound">e</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"pos <span class="main">(</span><span class="free">x</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> pos_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">moreover</span></span>
      <span class="keyword1"><span class="command">{</span></span>
        <span class="keyword3"><span class="command">assume</span></span> pxxs<span class="main">:</span> <span class="quoted"><span class="quoted">"pos <span class="main">(</span><span class="free">x</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">e</span><span class="main">.</span> <span class="bound">e</span> <span class="main">:</span> set <span class="main">(</span><span class="free">x</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span> <span class="main">⟶</span> <span class="bound">e</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> pos_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">e</span><span class="main">.</span> <span class="bound">e</span> <span class="main">:</span> set <span class="free">xs</span> <span class="main">⟶</span> <span class="bound">e</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">with</span></span> xsne <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"pos <span class="free">xs</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> pos_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"pos <span class="main">(</span><span class="free">x</span> <span class="main">#</span> <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> pos <span class="free">xs</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">x</span> <span class="main">⟶</span> pos <span class="main">(</span><span class="free">x</span> <span class="main">#</span> <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> pos <span class="free">xs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">assume</span></span> xngt0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">0</span><span class="main">&lt;</span><span class="free">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">{</span></span>
        <span class="keyword3"><span class="command">assume</span></span> pxs<span class="main">:</span> <span class="quoted"><span class="quoted">"pos <span class="free">xs</span>"</span></span>
        <span class="keyword1"><span class="command">with</span></span> pxs_simp <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">e</span><span class="main">.</span> <span class="bound">e</span> <span class="main">:</span> set <span class="free">xs</span> <span class="main">⟶</span> <span class="bound">e</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">with</span></span> xngt0 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∀</span><span class="bound">e</span><span class="main">.</span> <span class="bound">e</span> <span class="main">:</span> set <span class="main">(</span><span class="free">x</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span> <span class="main">⟶</span> <span class="bound">e</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span>pos <span class="main">(</span><span class="free">x</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> pos_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">moreover</span></span>
      <span class="keyword1"><span class="command">{</span></span>
        <span class="keyword3"><span class="command">assume</span></span> pxxs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>pos <span class="free">xs</span>"</span></span>
        <span class="keyword1"><span class="command">with</span></span> xsne <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∀</span><span class="bound">e</span><span class="main">.</span> <span class="bound">e</span> <span class="main">:</span> set <span class="free">xs</span> <span class="main">⟶</span> <span class="bound">e</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> pos_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∀</span><span class="bound">e</span><span class="main">.</span> <span class="bound">e</span> <span class="main">:</span> set <span class="main">(</span><span class="free">x</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span> <span class="main">⟶</span> <span class="bound">e</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span>pos <span class="main">(</span><span class="free">x</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> pos_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> pos <span class="main">(</span><span class="free">x</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">x</span> <span class="main">⟶</span> <span class="main">¬</span> pos <span class="main">(</span><span class="free">x</span> <span class="main">#</span> <span class="free">xs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Properties›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Here we prove some non-trivial properties of the abstract properties.›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Two lemmas regarding {\em pos}. The first states the removing
an element from a positive collection (of more than 1 element) results
in a positive collection. The second asserts that the mean of a
positive collection is positive.›</span></span>

<span class="keyword1" id="CauchysMeanTheorem-pos_imp_rmv_pos"><span class="command">lemma</span></span> pos_imp_rmv_pos<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>remove1 <span class="free">a</span> <span class="free">xs</span><span class="main">)</span><span class="main">≠</span><span class="main">[]</span>"</span></span> <span class="quoted"><span class="quoted">"pos <span class="free">xs</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"pos <span class="main">(</span>remove1 <span class="free">a</span> <span class="free">xs</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> pl<span class="main">:</span> <span class="quoted"><span class="quoted">"pos <span class="free">xs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> rmvne<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>remove1 <span class="free">a</span> <span class="free">xs</span><span class="main">)</span><span class="main">≠</span><span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> pl <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pos_imp_ne<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> pl pos_def <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">:</span> set <span class="free">xs</span> <span class="main">⟶</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">:</span> set <span class="main">(</span>remove1 <span class="free">a</span> <span class="free">xs</span><span class="main">)</span> <span class="main">⟶</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> set_remove1_subset<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="free">xs</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">blast</span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> rmvne <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"pos <span class="main">(</span>remove1 <span class="free">a</span> <span class="free">xs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> pos_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="CauchysMeanTheorem-pos_mean"><span class="command">lemma</span></span> pos_mean<span class="main">:</span> <span class="quoted"><span class="quoted">"pos <span class="free">xs</span> <span class="main">⟹</span> mean <span class="free">xs</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pos_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">x</span> <span class="skolem">xs</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
    <span class="keyword3"><span class="command">assume</span></span> xse<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"pos <span class="main">(</span><span class="skolem">x</span><span class="main">#</span><span class="skolem">xs</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> Cons<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> xse <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> mean <span class="main">(</span><span class="skolem">x</span><span class="main">#</span><span class="skolem">xs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>mean_def<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> xsne<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
      <span class="keyword3"><span class="command">assume</span></span> pxs<span class="main">:</span> <span class="quoted"><span class="quoted">"pos <span class="skolem">xs</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> Cons<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> z_le_mxs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> mean <span class="skolem">xs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
      <span class="keyword1"><span class="command">{</span></span>
        <span class="keyword3"><span class="command">assume</span></span> ass<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">with</span></span> ass z_le_mxs xsne <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> mean <span class="main">(</span><span class="skolem">x</span><span class="main">#</span><span class="skolem">xs</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> mean_gt_0<span class="main">)</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">moreover</span></span>
      <span class="keyword1"><span class="command">{</span></span>
        <span class="keyword1"><span class="command">from</span></span> xsne pxs <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">x</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">x</span>"</span></span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">with</span></span> xsne pos_cons <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"pos <span class="main">(</span><span class="skolem">x</span><span class="main">#</span><span class="skolem">xs</span><span class="main">)</span> <span class="main">=</span> False"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">with</span></span> Cons<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> mean <span class="main">(</span><span class="skolem">x</span><span class="main">#</span><span class="skolem">xs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> npxs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>pos <span class="skolem">xs</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> xsne pos_cons <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"pos <span class="main">(</span><span class="skolem">x</span><span class="main">#</span><span class="skolem">xs</span><span class="main">)</span> <span class="main">=</span> False"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> Cons<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We now show that homogeneity of a non-empty collection $x$
implies that its product is equal to <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>(mean x)^(length x)›</span></span></span></span>.›</span></span>

<span class="keyword1" id="CauchysMeanTheorem-prod_list_het0"><span class="command">lemma</span></span> prod_list_het0<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">≠</span><span class="main">[]</span> <span class="main">∧</span> het <span class="free">x</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟹</span> <span class="main">∏:</span><span class="free">x</span> <span class="main">=</span> <span class="main">(</span>mean <span class="free">x</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span>length <span class="free">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">≠</span><span class="main">[]</span> <span class="main">∧</span> het <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> xne<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">≠</span><span class="main">[]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> hetx<span class="main">:</span> <span class="quoted"><span class="quoted">"het <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> hetx <span class="keyword1"><span class="command">have</span></span> lz<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>list_neq <span class="free">x</span> <span class="main">(</span>mean <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> het_def <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∏:</span><span class="main">(</span>list_neq <span class="free">x</span> <span class="main">(</span>mean <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> prod_list_split <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∏:</span><span class="free">x</span> <span class="main">=</span> <span class="main">∏:</span><span class="main">(</span>list_eq <span class="free">x</span> <span class="main">(</span>mean <span class="free">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> meta_spec <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">x</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> meta_spec <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"mean <span class="free"><span class="free">x</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command"><span class="improper">with</span></span></span> list_eq_prod <span class="keyword1"><span class="command">have</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span>mean <span class="free">x</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span>length <span class="main">(</span>list_eq <span class="free">x</span> <span class="main">(</span>mean <span class="free">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command"><span class="improper">with</span></span></span> calculation lz sum_list_length_split <span class="keyword1"><span class="command">have</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">∏:</span><span class="free">x</span> <span class="main">=</span> <span class="main">(</span>mean <span class="free">x</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span>length <span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> meta_spec <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">x</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> meta_spec <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"mean <span class="free"><span class="free">x</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Furthermore we present an important result - that a
homogeneous collection has equal geometric and arithmetic means.›</span></span>

<span class="keyword1" id="CauchysMeanTheorem-het_base"><span class="command">lemma</span></span> het_base<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"pos <span class="free">x</span> <span class="main">∧</span> het <span class="free">x</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟹</span> gmean <span class="free">x</span> <span class="main">=</span> mean <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> ass<span class="main">:</span> <span class="quoted"><span class="quoted">"pos <span class="free">x</span> <span class="main">∧</span> het <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span>
    xne<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">≠</span><span class="main">[]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    hetx<span class="main">:</span> <span class="quoted"><span class="quoted">"het <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    posx<span class="main">:</span> <span class="quoted"><span class="quoted">"pos <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> posx pos_mean <span class="keyword1"><span class="command">have</span></span> mxgt0<span class="main">:</span> <span class="quoted"><span class="quoted">"mean <span class="free">x</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> xne <span class="keyword1"><span class="command">have</span></span> lxgt0<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="free">x</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> ass prod_list_het0 <span class="keyword1"><span class="command">have</span></span>
    <span class="quoted"><span class="quoted">"root <span class="main">(</span>length <span class="free">x</span><span class="main">)</span> <span class="main">(</span><span class="main">∏:</span><span class="free">x</span><span class="main">)</span> <span class="main">=</span> root <span class="main">(</span>length <span class="free">x</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span>mean <span class="free">x</span><span class="main">)</span><span class="main">^</span><span class="main">(</span>length <span class="free">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> lxgt0 mxgt0 real_root_power_cancel <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> mean <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"gmean <span class="free">x</span> <span class="main">=</span> mean <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> gmean_def <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(* =================================================================== *)</span>
<span class="comment1">(* =================================================================== *)</span>
<span class="comment1">(* =================================================================== *)</span>
<span class="comment1">(* =================================================================== *)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Existence of a new collection›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We now present the largest and most important proof in this
document. Given any positive and non-homogeneous collection of real
numbers there exists a new collection that is $\gamma$-equivalent,
positive, has a strictly lower heterogeneity and a greater geometric
mean.›</span></span>

<span class="keyword1" id="CauchysMeanTheorem-new_list_gt_gmean"><span class="command">lemma</span></span> new_list_gt_gmean<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">xs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real list"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">m</span> <span class="main">::</span> <span class="quoted">real</span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">neq</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">eq</span>
  <span class="keyword2"><span class="keyword">defines</span></span>
    m<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">≡</span> mean <span class="free">xs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    neq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">noteq</span> <span class="main">≡</span> list_neq <span class="free">xs</span> <span class="free">m</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">eq</span> <span class="main">≡</span> list_eq <span class="free">xs</span> <span class="free">m</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> pos_xs<span class="main">:</span> <span class="quoted"><span class="quoted">"pos <span class="free">xs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> het_gt_0<span class="main">:</span> <span class="quoted"><span class="quoted">"het <span class="free">xs</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">xs'</span><span class="main">.</span> gmean <span class="bound">xs'</span> <span class="main">&gt;</span> gmean <span class="free">xs</span> <span class="main">∧</span> γ_eq <span class="main">(</span><span class="bound">xs'</span><span class="main">,</span><span class="free">xs</span><span class="main">)</span> <span class="main">∧</span>
          het <span class="bound">xs'</span> <span class="main">&lt;</span> het <span class="free">xs</span> <span class="main">∧</span> pos <span class="bound">xs'</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> pos_xs pos_imp_ne <span class="keyword1"><span class="command">have</span></span>
    pos_els<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">:</span> set <span class="free">xs</span> <span class="main">⟶</span> <span class="bound">y</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> pos_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> el_gt0_imp_prod_gt0<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">xs</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> pos_asm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∏:</span><span class="free">xs</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> neq het_gt_0 het_gt_0_imp_noteq_ne m <span class="keyword1"><span class="command">have</span></span>
    neqne<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">noteq</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">txt</span></span> <span class="quoted"><span class="plain_text">‹Pick two elements from xs, one greater than m, one less than m.›</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms pick_one_gt neqne <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">α</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    α_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">α</span> <span class="main">:</span> set <span class="free">noteq</span> <span class="main">∧</span> <span class="skolem">α</span> <span class="main">&gt;</span> <span class="free">m</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> neq m <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> assms pick_one_lt neqne <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">β</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    β_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">β</span> <span class="main">:</span> set <span class="free">noteq</span> <span class="main">∧</span> <span class="skolem">β</span> <span class="main">&lt;</span> <span class="free">m</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> neq m <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> α_def β_def <span class="keyword1"><span class="command">have</span></span> α_gt<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">α</span> <span class="main">&gt;</span> <span class="free">m</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> β_lt<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">β</span> <span class="main">&lt;</span> <span class="free">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> α_def β_def <span class="keyword1"><span class="command">have</span></span> el_neq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">β</span> <span class="main">≠</span> <span class="skolem">α</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> neqne neq <span class="keyword1"><span class="command">have</span></span> xsne<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">from</span></span> β_def <span class="keyword1"><span class="command">have</span></span> β_mem<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">β</span> <span class="main">:</span> set <span class="free">xs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> neq<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> α_def <span class="keyword1"><span class="command">have</span></span> α_mem<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">α</span> <span class="main">:</span> set <span class="free">xs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> neq<span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> pos_xs pos_def xsne α_mem β_mem α_def β_def <span class="keyword1"><span class="command">have</span></span>
    α_pos<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">α</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> β_pos<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">β</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="comment1">― ‹remove these elements from xs, and insert two new elements›</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">left_over</span></span> <span class="keyword2"><span class="keyword">where</span></span> lo<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">left_over</span> <span class="main">=</span> <span class="main">(</span>remove1 <span class="skolem">β</span> <span class="main">(</span>remove1 <span class="skolem">α</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> bdef<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">+</span> <span class="skolem">b</span> <span class="main">=</span> <span class="skolem">α</span> <span class="main">+</span> <span class="skolem">β</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">drule</span> meta_spec <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem"><span class="skolem">α</span></span></span> <span class="main"><span class="main"><span class="main">+</span></span></span> <span class="skolem"><span class="skolem"><span class="skolem">β</span></span></span> <span class="main"><span class="main"><span class="main">-</span></span></span> <span class="free"><span class="free"><span class="free">m</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> m pos_xs pos_def pos_mean <span class="keyword1"><span class="command">have</span></span> m_pos<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> bdef α_pos β_pos α_gt β_lt <span class="keyword1"><span class="command">have</span></span> b_pos<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">new_list</span></span> <span class="keyword2"><span class="keyword">where</span></span> nl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">new_list</span> <span class="main">=</span> <span class="free">m</span><span class="main">#</span><span class="skolem">b</span><span class="main">#</span><span class="main">(</span><span class="skolem">left_over</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">from</span></span> el_neq β_mem α_mem <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">β</span> <span class="main">:</span> set <span class="free">xs</span> <span class="main">∧</span> <span class="skolem">α</span> <span class="main">:</span> set <span class="free">xs</span> <span class="main">∧</span> <span class="skolem">β</span> <span class="main">≠</span> <span class="skolem">α</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">α</span> <span class="main">:</span> set <span class="main">(</span>remove1 <span class="skolem">β</span> <span class="free">xs</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">β</span> <span class="main">:</span> set<span class="main">(</span>remove1 <span class="skolem">α</span> <span class="free">xs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> in_set_remove1<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">hence</span></span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>remove1 <span class="skolem">α</span> <span class="free">xs</span><span class="main">)</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">∧</span> <span class="main">(</span>remove1 <span class="skolem">β</span> <span class="free">xs</span><span class="main">)</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span>
    mem <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">α</span> <span class="main">:</span> set<span class="main">(</span>remove1 <span class="skolem">β</span> <span class="free">xs</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">β</span> <span class="main">:</span> set<span class="main">(</span>remove1 <span class="skolem">α</span> <span class="free">xs</span><span class="main">)</span> <span class="main">∧</span>
          <span class="main">(</span>remove1 <span class="skolem">α</span> <span class="free">xs</span><span class="main">)</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">∧</span> <span class="main">(</span>remove1 <span class="skolem">β</span> <span class="free">xs</span><span class="main">)</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="comment1">― ‹prove that new list is positive›</span>
  <span class="keyword1"><span class="command">from</span></span> nl <span class="keyword1"><span class="command">have</span></span> nl_pos<span class="main">:</span> <span class="quoted"><span class="quoted">"pos <span class="skolem">new_list</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">left_over</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> nl b_pos m_pos <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> lone<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">left_over</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> mem pos_imp_rmv_pos pos_xs <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"pos <span class="main">(</span>remove1 <span class="skolem">α</span> <span class="free">xs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> lo lone pos_imp_rmv_pos <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"pos <span class="skolem">left_over</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> lone mem nl m_pos b_pos <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="comment1">― ‹now show that the new list has the same mean as the old list›</span>
  <span class="keyword1"><span class="command">with</span></span> mem nl lo bdef α_mem β_mem
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∑:</span><span class="skolem">new_list</span> <span class="main">=</span> <span class="main">∑:</span><span class="free">xs</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> sum_list_rmv1<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> sum_list_rmv1<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> lo nl β_mem α_mem mem <span class="keyword1"><span class="command">have</span></span>
    leq<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="skolem">new_list</span> <span class="main">=</span> length <span class="free">xs</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> conjE<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> length_remove1<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> length_remove1<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span>length_pos_if_in_set<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> eq_mean<span class="main">:</span> <span class="quoted"><span class="quoted">"mean <span class="skolem">new_list</span> <span class="main">=</span> mean <span class="free">xs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> list_mean_eq_iff<span class="main">)</span>

  <span class="comment1">― ‹finally show that the new list has a greater gmean than the old list›</span>
  <span class="keyword1"><span class="command">have</span></span> gt_gmean<span class="main">:</span> <span class="quoted"><span class="quoted">"gmean <span class="skolem">new_list</span> <span class="main">&gt;</span> gmean <span class="free">xs</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> bdef α_gt β_lt <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"abs <span class="main">(</span><span class="free">m</span> <span class="main">-</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">&lt;</span> abs <span class="main">(</span><span class="skolem">α</span> <span class="main">-</span> <span class="skolem">β</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> bdef <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span><span class="main">+</span><span class="skolem">b</span> <span class="main">=</span> <span class="skolem">α</span><span class="main">+</span><span class="skolem">β</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> mb_gt_gt<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">m</span><span class="main">*</span><span class="skolem">b</span> <span class="main">&gt;</span> <span class="skolem">α</span><span class="main">*</span><span class="skolem">β</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> le_diff_imp_gt_prod<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> nl <span class="keyword1"><span class="command">have</span></span>
      <span class="quoted"><span class="quoted">"<span class="main">∏:</span><span class="skolem">new_list</span> <span class="main">=</span> <span class="main">∏:</span><span class="skolem">left_over</span> <span class="main">*</span> <span class="main">(</span><span class="free">m</span><span class="main">*</span><span class="skolem">b</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">from</span></span> lo α_mem β_mem mem remove1_retains_prod<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="tfree">'a</span> <span class="main"><span class="main">=</span></span> <span class="quoted">real</span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span>
      xsprod<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∏:</span><span class="free">xs</span> <span class="main">=</span> <span class="main">∏:</span><span class="skolem">left_over</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">α</span><span class="main">*</span><span class="skolem">β</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> xsne <span class="keyword1"><span class="command">have</span></span>
      <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> nl <span class="keyword1"><span class="command">have</span></span>
      nlne<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">new_list</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> pos_asm lo <span class="keyword1"><span class="command">have</span></span>
      <span class="quoted"><span class="quoted">"<span class="main">∏:</span><span class="skolem">left_over</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">from</span></span> pos_asm <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∏:</span><span class="free">xs</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
        <span class="keyword1"><span class="command">moreover</span></span>
        <span class="keyword1"><span class="command">from</span></span> xsprod <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∏:</span><span class="free">xs</span> <span class="main">=</span> <span class="main">∏:</span><span class="skolem">left_over</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">α</span><span class="main">*</span><span class="skolem">β</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∏:</span><span class="skolem">left_over</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">α</span><span class="main">*</span><span class="skolem">β</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">moreover</span></span>
        <span class="keyword1"><span class="command">from</span></span> pos_els α_mem β_mem <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">α</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">β</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">α</span><span class="main">*</span><span class="skolem">β</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∏:</span><span class="skolem">left_over</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> zero_less_mult_pos2 <span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> a<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">(</span></span><span class="skolem"><span class="skolem">α</span></span> <span class="main"><span class="main">*</span></span> <span class="skolem"><span class="skolem">β</span></span><span class="main"><span class="main">)</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∏:</span><span class="skolem">new_list</span> <span class="main">&gt;</span> <span class="main">∏:</span><span class="free">xs</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">with</span></span></span> pos_asm nl <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∏:</span><span class="skolem">new_list</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> calculation pos_asm xsne nlne leq list_gmean_gt_iff
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"gmean <span class="skolem">new_list</span> <span class="main">&gt;</span> gmean <span class="free">xs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="comment1">― ‹auxiliary info›</span>
  <span class="keyword1"><span class="command">from</span></span> β_lt <span class="keyword1"><span class="command">have</span></span> β_ne_m<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">β</span> <span class="main">≠</span> <span class="free">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> mem <span class="keyword1"><span class="command">have</span></span>
    β_mem_rmv_α<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">β</span> <span class="main">:</span> set <span class="main">(</span>remove1 <span class="skolem">α</span> <span class="free">xs</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> rmv_α_ne<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>remove1 <span class="skolem">α</span> <span class="free">xs</span><span class="main">)</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">from</span></span> α_def <span class="keyword1"><span class="command">have</span></span> α_ne_m<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">α</span> <span class="main">≠</span> <span class="free">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="comment1">― ‹now show that new list is more homogeneous›</span>
  <span class="keyword1"><span class="command">have</span></span> lt_het<span class="main">:</span> <span class="quoted"><span class="quoted">"het <span class="skolem">new_list</span> <span class="main">&lt;</span> het <span class="free">xs</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
    <span class="keyword3"><span class="command">assume</span></span> bm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span><span class="main">=</span><span class="free">m</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> het_def <span class="keyword1"><span class="command">have</span></span>
      <span class="quoted"><span class="quoted">"het <span class="skolem">new_list</span> <span class="main">=</span> length <span class="main">(</span>list_neq <span class="skolem">new_list</span> <span class="main">(</span>mean <span class="skolem">new_list</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command"><span class="improper">with</span></span></span> m nl eq_mean <span class="keyword1"><span class="command">have</span></span>
      <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> length <span class="main">(</span>list_neq <span class="main">(</span><span class="free">m</span><span class="main">#</span><span class="skolem">b</span><span class="main">#</span><span class="main">(</span><span class="skolem">left_over</span><span class="main">)</span><span class="main">)</span> <span class="free">m</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command"><span class="improper">with</span></span></span> bm <span class="keyword1"><span class="command">have</span></span>
      <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> length <span class="main">(</span>list_neq <span class="skolem">left_over</span> <span class="free">m</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command"><span class="improper">with</span></span></span> lo β_def α_def <span class="keyword1"><span class="command">have</span></span>
      <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> length <span class="main">(</span>list_neq <span class="main">(</span>remove1 <span class="skolem">β</span> <span class="main">(</span>remove1 <span class="skolem">α</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span> <span class="free">m</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> β_ne_m β_mem_rmv_α rmv_α_ne <span class="keyword1"><span class="command">have</span></span>
      <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">&lt;</span> length <span class="main">(</span>list_neq <span class="main">(</span>remove1 <span class="skolem">α</span> <span class="free">xs</span><span class="main">)</span> <span class="free">m</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> list_neq_remove1<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> α_mem α_ne_m xsne <span class="keyword1"><span class="command">have</span></span>
      <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">&lt;</span> length <span class="main">(</span>list_neq <span class="free">xs</span> <span class="free">m</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> list_neq_remove1<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command"><span class="improper">with</span></span></span> m het_def <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> het <span class="free">xs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"het <span class="skolem">new_list</span> <span class="main">&lt;</span> het <span class="free">xs</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> bnm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span><span class="main">≠</span><span class="free">m</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> het_def <span class="keyword1"><span class="command">have</span></span>
      <span class="quoted"><span class="quoted">"het <span class="skolem">new_list</span> <span class="main">=</span> length <span class="main">(</span>list_neq <span class="skolem">new_list</span> <span class="main">(</span>mean <span class="skolem">new_list</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command"><span class="improper">with</span></span></span> m nl eq_mean <span class="keyword1"><span class="command">have</span></span>
      <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> length <span class="main">(</span>list_neq <span class="main">(</span><span class="free">m</span><span class="main">#</span><span class="skolem">b</span><span class="main">#</span><span class="main">(</span><span class="skolem">left_over</span><span class="main">)</span><span class="main">)</span> <span class="free">m</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command"><span class="improper">with</span></span></span> bnm <span class="keyword1"><span class="command">have</span></span>
      <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> length <span class="main">(</span><span class="skolem">b</span><span class="main">#</span><span class="main">(</span>list_neq <span class="skolem">left_over</span> <span class="free">m</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span>
      <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">1</span> <span class="main">+</span> length <span class="main">(</span>list_neq <span class="skolem">left_over</span> <span class="free">m</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command"><span class="improper">with</span></span></span> lo β_def α_def <span class="keyword1"><span class="command">have</span></span>
      <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">1</span> <span class="main">+</span> length <span class="main">(</span>list_neq <span class="main">(</span>remove1 <span class="skolem">β</span> <span class="main">(</span>remove1 <span class="skolem">α</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span> <span class="free">m</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> β_ne_m β_mem_rmv_α rmv_α_ne <span class="keyword1"><span class="command">have</span></span>
      <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">&lt;</span> <span class="main">1</span> <span class="main">+</span> length <span class="main">(</span>list_neq <span class="main">(</span>remove1 <span class="skolem">α</span> <span class="free">xs</span><span class="main">)</span> <span class="free">m</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> nat_add_left_cancel_less<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> list_neq_remove1<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span>
      <span class="quoted"><span class="quoted">"het <span class="skolem">new_list</span> <span class="main">≤</span> length <span class="main">(</span>list_neq <span class="main">(</span>remove1 <span class="skolem">α</span> <span class="free">xs</span><span class="main">)</span> <span class="free">m</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> α_mem α_ne_m xsne <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">&lt;</span> length <span class="main">(</span>list_neq <span class="free">xs</span> <span class="free">m</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> list_neq_remove1<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command"><span class="improper">with</span></span></span> m het_def <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> het <span class="free">xs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"het <span class="skolem">new_list</span> <span class="main">&lt;</span> het <span class="free">xs</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>

      <span class="comment1">― ‹thus thesis by existence of newlist›</span>
  <span class="keyword1"><span class="command">from</span></span> γ_eq_def lt_het gt_gmean eq_mean leq nl_pos <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Furthermore we show that for all non-homogeneous positive
collections there exists another collection that is
$\gamma$-equivalent, positive, has a greater geometric mean {\em and}
is homogeneous.›</span></span>

<span class="keyword1" id="CauchysMeanTheorem-existence_of_het0"><span class="command">lemma</span></span> existence_of_het0 <span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="free">p</span> <span class="main">=</span> het <span class="bound">x</span> <span class="main">∧</span> <span class="free">p</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∧</span> pos <span class="bound">x</span> <span class="main">⟶</span>
  <span class="main">(</span><span class="main">∃</span><span class="bound">y</span><span class="main">.</span> gmean <span class="bound">y</span> <span class="main">&gt;</span> gmean <span class="bound">x</span> <span class="main">∧</span> γ_eq <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span> <span class="main">∧</span> het <span class="bound">y</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> pos <span class="bound">y</span><span class="main">)</span>"</span></span>
  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?Q</span> <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="var">?A</span> <span class="bound">x</span> <span class="free">p</span> <span class="main">⟶</span> <span class="var">?S</span> <span class="bound">x</span><span class="main">)</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> nat_less_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span>
  <span class="keyword3"><span class="command">assume</span></span> ind<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">m</span></span><span class="main">&lt;</span><span class="skolem">n</span><span class="main">.</span> <span class="var">?Q</span> <span class="bound">m</span>"</span></span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
    <span class="keyword3"><span class="command">assume</span></span> ass<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?A</span> <span class="skolem">x</span> <span class="skolem">n</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"het <span class="skolem">x</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"pos <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> new_list_gt_gmean <span class="keyword1"><span class="command">have</span></span>
      <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">y</span><span class="main">.</span> gmean <span class="bound">y</span> <span class="main">&gt;</span> gmean <span class="skolem">x</span> <span class="main">∧</span> γ_eq <span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span> <span class="main">∧</span> het <span class="bound">y</span> <span class="main">&lt;</span> het <span class="skolem">x</span> <span class="main">∧</span> pos <span class="bound">y</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> meta_spec <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">x</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> meta_mp<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> meta_mp<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span><span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> γ_eq_sym<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">β</span></span> <span class="keyword2"><span class="keyword">where</span></span>
      β_def<span class="main">:</span> <span class="quoted"><span class="quoted">"gmean <span class="skolem">β</span> <span class="main">&gt;</span> gmean <span class="skolem">x</span> <span class="main">∧</span> γ_eq <span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">β</span><span class="main">)</span> <span class="main">∧</span> het <span class="skolem">β</span> <span class="main">&lt;</span> het <span class="skolem">x</span> <span class="main">∧</span> pos <span class="skolem">β</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> bdef<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">=</span> het <span class="skolem">β</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> ass β_def <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">&lt;</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> ind <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?Q</span> <span class="skolem">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> β_def <span class="keyword1"><span class="command">have</span></span>
      ind2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">=</span> het <span class="skolem">β</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">b</span> <span class="main">∧</span> pos <span class="skolem">β</span> <span class="main">⟶</span>
      <span class="main">(</span><span class="main">∃</span><span class="bound">y</span><span class="main">.</span> gmean <span class="skolem">β</span> <span class="main">&lt;</span> gmean <span class="bound">y</span> <span class="main">∧</span> γ_eq <span class="main">(</span><span class="skolem">β</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span> <span class="main">∧</span> het <span class="bound">y</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> pos <span class="bound">y</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="main">0</span><span class="main">&lt;</span><span class="skolem">b</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span><span class="main">=</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> bdef <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"het <span class="skolem">β</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> β_def <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?S</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">b</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> bdef ind2 β_def <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?S</span> <span class="skolem">β</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">γ</span></span> <span class="keyword2"><span class="keyword">where</span></span>
        <span class="quoted"><span class="quoted">"gmean <span class="skolem">β</span> <span class="main">&lt;</span> gmean <span class="skolem">γ</span> <span class="main">∧</span> γ_eq <span class="main">(</span><span class="skolem">β</span><span class="main">,</span> <span class="skolem">γ</span><span class="main">)</span> <span class="main">∧</span> het <span class="skolem">γ</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> pos <span class="skolem">γ</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">with</span></span> β_def <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"gmean <span class="skolem">x</span> <span class="main">&lt;</span> gmean <span class="skolem">γ</span> <span class="main">∧</span> γ_eq <span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">γ</span><span class="main">)</span> <span class="main">∧</span> het <span class="skolem">γ</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> pos <span class="skolem">γ</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> γ_eq_trans<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?S</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?S</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="var">?Q</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Cauchy's Mean Theorem›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We now present the final proof of the theorem. For any
positive collection we show that its geometric mean is less than or
equal to its arithmetic mean.›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> CauchysMeanTheorem<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">z</span><span class="main">::</span><span class="quoted"><span class="quoted">"real list"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"pos <span class="free">z</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"gmean <span class="free">z</span> <span class="main">≤</span> mean <span class="free">z</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹pos <span class="free">z</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> zne<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">z</span><span class="main">≠</span><span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pos_imp_ne<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"gmean <span class="free">z</span> <span class="main">≤</span> mean <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"het <span class="free">z</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹pos <span class="free">z</span>›</span></span> zne het_base <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"gmean <span class="free">z</span> <span class="main">=</span> mean <span class="free">z</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"het <span class="free">z</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"het <span class="free">z</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">=</span> het <span class="free">z</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">with</span></span></span> calculation <span class="quoted"><span class="quoted">‹pos <span class="free">z</span>›</span></span> existence_of_het0 <span class="keyword1"><span class="command">have</span></span>
      <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">y</span><span class="main">.</span> gmean <span class="bound">y</span> <span class="main">&gt;</span> gmean <span class="free">z</span> <span class="main">∧</span> γ_eq <span class="main">(</span><span class="free">z</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span> <span class="main">∧</span> het <span class="bound">y</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> pos <span class="bound">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">α</span></span> <span class="keyword2"><span class="keyword">where</span></span>
      <span class="quoted"><span class="quoted">"gmean <span class="skolem">α</span> <span class="main">&gt;</span> gmean <span class="free">z</span> <span class="main">∧</span> γ_eq <span class="main">(</span><span class="free">z</span><span class="main">,</span><span class="skolem">α</span><span class="main">)</span> <span class="main">∧</span> het <span class="skolem">α</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> pos <span class="skolem">α</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">with</span></span> het_base γ_eq_def pos_imp_ne <span class="keyword1"><span class="command">have</span></span>
      <span class="quoted"><span class="quoted">"mean <span class="free">z</span> <span class="main">=</span> mean <span class="skolem">α</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      <span class="quoted"><span class="quoted">"gmean <span class="skolem">α</span> <span class="main">&gt;</span> gmean <span class="free">z</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      <span class="quoted"><span class="quoted">"gmean <span class="skolem">α</span> <span class="main">=</span> mean <span class="skolem">α</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"gmean <span class="free">z</span> <span class="main">&lt;</span> mean <span class="free">z</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹In the equality version we prove that the geometric mean
  is identical to the arithmetic mean iff the collection is 
  homogeneous.›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> CauchysMeanTheorem_Eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">z</span><span class="main">::</span><span class="quoted"><span class="quoted">"real list"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"pos <span class="free">z</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"gmean <span class="free">z</span> <span class="main">=</span> mean <span class="free">z</span> <span class="main">⟷</span> het <span class="free">z</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> 
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"het <span class="free">z</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> het_base<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">z</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹pos <span class="free">z</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"gmean <span class="free">z</span> <span class="main">=</span> mean <span class="free">z</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"gmean <span class="free">z</span> <span class="main">=</span> mean <span class="free">z</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"het <span class="free">z</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"het <span class="free">z</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"het <span class="free">z</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">=</span> het <span class="free">z</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">with</span></span></span> calculation <span class="quoted"><span class="quoted">‹pos <span class="free">z</span>›</span></span> existence_of_het0 <span class="keyword1"><span class="command">have</span></span>
      <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">y</span><span class="main">.</span> gmean <span class="bound">y</span> <span class="main">&gt;</span> gmean <span class="free">z</span> <span class="main">∧</span> γ_eq <span class="main">(</span><span class="free">z</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span> <span class="main">∧</span> het <span class="bound">y</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> pos <span class="bound">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">α</span></span> <span class="keyword2"><span class="keyword">where</span></span>
      <span class="quoted"><span class="quoted">"gmean <span class="skolem">α</span> <span class="main">&gt;</span> gmean <span class="free">z</span> <span class="main">∧</span> γ_eq <span class="main">(</span><span class="free">z</span><span class="main">,</span><span class="skolem">α</span><span class="main">)</span> <span class="main">∧</span> het <span class="skolem">α</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> pos <span class="skolem">α</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">with</span></span> het_base γ_eq_def pos_imp_ne <span class="keyword1"><span class="command">have</span></span>
      <span class="quoted"><span class="quoted">"mean <span class="free">z</span> <span class="main">=</span> mean <span class="skolem">α</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      <span class="quoted"><span class="quoted">"gmean <span class="skolem">α</span> <span class="main">&gt;</span> gmean <span class="free">z</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      <span class="quoted"><span class="quoted">"gmean <span class="skolem">α</span> <span class="main">=</span> mean <span class="skolem">α</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"gmean <span class="free">z</span> <span class="main">&lt;</span> mean <span class="free">z</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>
 
<span class="keyword1"><span class="command">corollary</span></span> CauchysMeanTheorem_Less<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">z</span><span class="main">::</span><span class="quoted"><span class="quoted">"real list"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"pos <span class="free">z</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"het <span class="free">z</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"gmean <span class="free">z</span> <span class="main">&lt;</span> mean <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> 
    CauchysMeanTheorem<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹pos <span class="free">z</span>›</span></span><span class="main">]</span> 
    CauchysMeanTheorem_Eq<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹pos <span class="free">z</span>›</span></span><span class="main">]</span>
    <span class="quoted"><span class="quoted">‹het <span class="free">z</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="CauchySchwarz">
<div class="head">
<h1>Theory CauchySchwarz</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:       The Cauchy-Schwarz Inequality
    Author:      Benjamin Porter &lt;Benjamin.Porter at gmail.com&gt;, 2006
    Maintainer:  Benjamin Porter &lt;Benjamin.Porter at gmail.com&gt;
*)</span>

<span class="keyword1"><span class="command">chapter</span></span> <span class="quoted"><span class="plain_text">‹The Cauchy-Schwarz Inequality›</span></span>

<span class="keyword1"><span class="command">theory</span></span> CauchySchwarz
<span class="keyword2"><span class="keyword">imports</span></span> <a href="https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL/Complex_Main.html">Complex_Main</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="comment1">(*&lt;*)</span>

<span class="comment1">(* Some basic results that don't need to be in the final doc ..*)</span>


<span class="keyword1"><span class="command">lemmas</span></span> real_sq <span class="main">=</span> power2_eq_square <span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="tfree">'a</span> <span class="main"><span class="main">=</span></span> <span class="quoted">real</span><span class="main">,</span> <span class="operator">symmetric</span><span class="main">]</span>

<span class="keyword1"><span class="command">lemmas</span></span> real_sq_exp <span class="main">=</span> power_mult_distrib <span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="tfree">'a</span> <span class="main"><span class="main">=</span></span> <span class="quoted">real</span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> <span class="var">?n</span> <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="numeral">2</span></span><span class="main">]</span>

<span class="keyword1" id="CauchySchwarz-double_sum_equiv"><span class="command">lemma</span></span> double_sum_equiv<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span><span class="main">::</span><span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> real"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="free">n</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="free">n</span><span class="main">}</span><span class="main">.</span> <span class="free">f</span> <span class="bound">k</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
   <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="free">n</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="free">n</span><span class="main">}</span><span class="main">.</span> <span class="free">f</span> <span class="bound">j</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.swap<span class="main">)</span>

<span class="comment1">(*&gt;*)</span>



<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Abstract›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The following document presents a formalised proof of the
Cauchy-Schwarz Inequality for the specific case of $R^n$. The system
used is Isabelle/Isar. 

{\em Theorem:} Take $V$ to be some vector space possessing a norm and
inner product, then for all $a,b \in V$ the following inequality
holds: <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>¦a⋅b¦ ≤ ∥a∥*∥b∥›</span></span></span></span>. Specifically, in the Real case, the
norm is the Euclidean length and the inner product is the standard dot
product.›</span></span>


<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Formal Proof›</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Vector, Dot and Norm definitions.›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹This section presents definitions for a real vector type, a
dot product function and a norm function.›</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Vector›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We now define a vector type to be a tuple of (function,
length). Where the function is of type <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">typ</span></span> <span class="quoted"><span class="quoted">"nat<span class="main"><span class="main">⇒</span></span>real"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>. We also
define some accessor functions and appropriate notation.›</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span> vector <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>nat<span class="main">⇒</span>real<span class="main">)</span> <span class="main">*</span> nat"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">ith</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"vector <span class="main">⇒</span> nat <span class="main">⇒</span> real"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span><span class="keyword3">(</span>_<span class="keyword3">)</span><span class="keyword1">⇘</span>_<span class="keyword1">⇙</span><span class="keyword3">)</span>"</span> <span class="main">[</span>80<span class="main">,</span>100<span class="main">]</span> 100<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">ith</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">=</span> fst <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">vlen</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"vector <span class="main">⇒</span> nat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">vlen</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">=</span> snd <span class="free"><span class="bound"><span class="entity">v</span></span></span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Now to access the second element of some vector $v$ the syntax
is $v_2$.›</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Dot and Norm›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We now define the dot product and norm operations.›</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">dot</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"vector <span class="main">⇒</span> vector <span class="main">⇒</span> real"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">⋅</span>"</span> 60<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">dot</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="main">(</span>vlen <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span><span class="main">}</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="hidden">⇘</span><sub><span class="bound">j</span></sub><span class="hidden">⇙</span><span class="main">*</span><span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="hidden">⇘</span><sub><span class="bound">j</span></sub><span class="hidden">⇙</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">norm</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"vector <span class="main">⇒</span> real"</span></span>                  <span class="main">(</span><span class="quoted">"<span class="keyword1">∥</span>_<span class="keyword1">∥</span>"</span> 100<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">norm</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">=</span> sqrt <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="main">(</span>vlen <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span><span class="main">}</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="hidden">⇘</span><sub><span class="bound">j</span></sub><span class="hidden">⇙</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Another definition of the norm is <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="main">∥</span></span><span class="free"><span class="free">v</span></span><span class="main"><span class="main">∥</span></span> <span class="main"><span class="main">=</span></span> sqrt
<span class="main"><span class="main">(</span></span><span class="free"><span class="free">v</span></span><span class="main"><span class="main">⋅</span></span><span class="free"><span class="free">v</span></span><span class="main"><span class="main">)</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>. We show that our definition leads to this one.›</span></span>

<span class="keyword1" id="CauchySchwarz-norm_dot"><span class="command">lemma</span></span> norm_dot<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">∥</span><span class="free">v</span><span class="main">∥</span> <span class="main">=</span> sqrt <span class="main">(</span><span class="free">v</span><span class="main">⋅</span><span class="free">v</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sqrt <span class="main">(</span><span class="free">v</span><span class="main">⋅</span><span class="free">v</span><span class="main">)</span> <span class="main">=</span> sqrt <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="main">(</span>vlen <span class="free">v</span><span class="main">)</span><span class="main">}</span><span class="main">.</span> <span class="free">v</span><span class="hidden">⇘</span><sub><span class="bound">j</span></sub><span class="hidden">⇙</span><span class="main">*</span><span class="free">v</span><span class="hidden">⇘</span><sub><span class="bound">j</span></sub><span class="hidden">⇙</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> dot_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command"><span class="improper">with</span></span></span> real_sq <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> sqrt <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="main">(</span>vlen <span class="free">v</span><span class="main">)</span><span class="main">}</span><span class="main">.</span> <span class="free">v</span><span class="hidden">⇘</span><sub><span class="bound">j</span></sub><span class="hidden">⇙</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">∥</span><span class="free">v</span><span class="main">∥</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> norm_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹A further important property is that the norm is never negative.›</span></span>

<span class="keyword1" id="CauchySchwarz-norm_pos"><span class="command">lemma</span></span> norm_pos<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">∥</span><span class="free">v</span><span class="main">∥</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">j</span><span class="main">.</span> <span class="free">v</span><span class="hidden">⇘</span><sub><span class="bound">j</span></sub><span class="hidden">⇙</span><span class="main">^</span><span class="numeral">2</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> ith_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="main">(</span>vlen <span class="free">v</span><span class="main">)</span><span class="main">}</span><span class="main">.</span> <span class="free">v</span><span class="hidden">⇘</span><sub><span class="bound">j</span></sub><span class="hidden">⇙</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_nonneg<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> real_sqrt_ge_zero <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sqrt <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="main">(</span>vlen <span class="free">v</span><span class="main">)</span><span class="main">}</span><span class="main">.</span> <span class="free">v</span><span class="hidden">⇘</span><sub><span class="bound">j</span></sub><span class="hidden">⇙</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> norm_def <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We now prove an intermediary lemma regarding double summation.›</span></span>

<span class="keyword1" id="CauchySchwarz-double_sum_aux"><span class="command">lemma</span></span> double_sum_aux<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span><span class="main">::</span><span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> real"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="free">n</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="free">n</span><span class="main">}</span><span class="main">.</span> <span class="free">f</span> <span class="bound">k</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
   <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="free">n</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="free">n</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="free">f</span> <span class="bound">k</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">j</span> <span class="main">+</span> <span class="free">f</span> <span class="bound">j</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">k</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span>
    <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="free">n</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="free">n</span><span class="main">}</span><span class="main">.</span> <span class="free">f</span> <span class="bound">k</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
    <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="free">n</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="free">n</span><span class="main">}</span><span class="main">.</span> <span class="free">f</span> <span class="bound">k</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span>
    <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="free">n</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="free">n</span><span class="main">}</span><span class="main">.</span> <span class="free">f</span> <span class="bound">k</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span>
    <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="free">n</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="free">n</span><span class="main">}</span><span class="main">.</span> <span class="free">f</span> <span class="bound">k</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span>
    <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="free">n</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="free">n</span><span class="main">}</span><span class="main">.</span> <span class="free">f</span> <span class="bound">j</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> double_sum_equiv<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span>
    <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="free">n</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="free">n</span><span class="main">}</span><span class="main">.</span> <span class="free">f</span> <span class="bound">k</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">j</span> <span class="main">+</span> <span class="free">f</span> <span class="bound">j</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum.distrib<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span>
    <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="free">n</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="free">n</span><span class="main">}</span><span class="main">.</span> <span class="free">f</span> <span class="bound">k</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
    <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="free">n</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="free">n</span><span class="main">}</span><span class="main">.</span> <span class="free">f</span> <span class="bound">k</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">j</span> <span class="main">+</span> <span class="free">f</span> <span class="bound">j</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">hence</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="free">n</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="free">n</span><span class="main">}</span><span class="main">.</span> <span class="free">f</span> <span class="bound">k</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
     <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="free">n</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="free">n</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="free">f</span> <span class="bound">k</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">j</span> <span class="main">+</span> <span class="free">f</span> <span class="bound">j</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span>
     <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="free">n</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="free">n</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="free">f</span> <span class="bound">k</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">j</span> <span class="main">+</span> <span class="free">f</span> <span class="bound">j</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">k</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_distrib_left mult.commute<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inverse_eq_divide<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The final theorem can now be proven. It is a simple forward
proof that uses properties of double summation and the preceding
lemma.›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> CauchySchwarzReal<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span><span class="main">::</span><span class="quoted">vector</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"vlen <span class="free">x</span> <span class="main">=</span> vlen <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="free">x</span><span class="main">⋅</span><span class="free">y</span><span class="main">¦</span> <span class="main">≤</span> <span class="main">∥</span><span class="free">x</span><span class="main">∥</span><span class="main">*</span><span class="main">∥</span><span class="free">y</span><span class="main">∥</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="free">x</span><span class="main">⋅</span><span class="free">y</span><span class="main">¦</span><span class="main">^</span><span class="numeral">2</span> <span class="main">≤</span> <span class="main">(</span><span class="main">∥</span><span class="free">x</span><span class="main">∥</span><span class="main">*</span><span class="main">∥</span><span class="free">y</span><span class="main">∥</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">txt</span></span> <span class="quoted"><span class="plain_text">‹We can rewrite the goal in the following form ...›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∥</span><span class="free">x</span><span class="main">∥</span><span class="main">*</span><span class="main">∥</span><span class="free">y</span><span class="main">∥</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span> <span class="main">-</span> <span class="main">¦</span><span class="free">x</span><span class="main">⋅</span><span class="free">y</span><span class="main">¦</span><span class="main">^</span><span class="numeral">2</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> nx<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> vlen <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹vlen <span class="free">x</span> <span class="main">=</span> vlen <span class="free">y</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> ny<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> vlen <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">{</span></span>
        <span class="keyword1"><span class="command">txt</span></span> <span class="quoted"><span class="plain_text">‹Some preliminary simplification rules.›</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="skolem">n</span><span class="main">}</span><span class="main">.</span> <span class="free">x</span><span class="hidden">⇘</span><sub><span class="bound">j</span></sub><span class="hidden">⇙</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_nonneg<span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> xp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>sqrt <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="skolem">n</span><span class="main">}</span><span class="main">.</span> <span class="free">x</span><span class="hidden">⇘</span><sub><span class="bound">j</span></sub><span class="hidden">⇙</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="skolem">n</span><span class="main">}</span><span class="main">.</span> <span class="free">x</span><span class="hidden">⇘</span><sub><span class="bound">j</span></sub><span class="hidden">⇙</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> real_sqrt_pow2<span class="main">)</span>

        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="skolem">n</span><span class="main">}</span><span class="main">.</span> <span class="free">y</span><span class="hidden">⇘</span><sub><span class="bound">j</span></sub><span class="hidden">⇙</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_nonneg<span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> yp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>sqrt <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="skolem">n</span><span class="main">}</span><span class="main">.</span> <span class="free">y</span><span class="hidden">⇘</span><sub><span class="bound">j</span></sub><span class="hidden">⇙</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="skolem">n</span><span class="main">}</span><span class="main">.</span> <span class="free">y</span><span class="hidden">⇘</span><sub><span class="bound">j</span></sub><span class="hidden">⇙</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> real_sqrt_pow2<span class="main">)</span>

        <span class="keyword1"><span class="command">txt</span></span> <span class="quoted"><span class="plain_text">‹The main result of this section is that <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>(∥x∥*∥y∥)^2›</span></span></span></span> can be written as a double sum.›</span></span>
        <span class="keyword1"><span class="command">have</span></span>
          <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∥</span><span class="free">x</span><span class="main">∥</span><span class="main">*</span><span class="main">∥</span><span class="free">y</span><span class="main">∥</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span> <span class="main">=</span> <span class="main">∥</span><span class="free">x</span><span class="main">∥</span><span class="main">^</span><span class="numeral">2</span> <span class="main">*</span> <span class="main">∥</span><span class="free">y</span><span class="main">∥</span><span class="main">^</span><span class="numeral">2</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> real_sq_exp<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> nx ny <span class="keyword1"><span class="command">have</span></span>
          <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span>sqrt <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="skolem">n</span><span class="main">}</span><span class="main">.</span> <span class="free">x</span><span class="hidden">⇘</span><sub><span class="bound">j</span></sub><span class="hidden">⇙</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span>sqrt <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="skolem">n</span><span class="main">}</span><span class="main">.</span> <span class="free">y</span><span class="hidden">⇘</span><sub><span class="bound">j</span></sub><span class="hidden">⇙</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> norm_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> xp yp <span class="keyword1"><span class="command">have</span></span>
          <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="skolem">n</span><span class="main">}</span><span class="main">.</span> <span class="free">x</span><span class="hidden">⇘</span><sub><span class="bound">j</span></sub><span class="hidden">⇙</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="skolem">n</span><span class="main">}</span><span class="main">.</span> <span class="free">y</span><span class="hidden">⇘</span><sub><span class="bound">j</span></sub><span class="hidden">⇙</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> sum_product <span class="keyword1"><span class="command">have</span></span>
          <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="skolem">n</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="skolem">n</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="free">x</span><span class="hidden">⇘</span><sub><span class="bound">k</span></sub><span class="hidden">⇙</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="free">y</span><span class="hidden">⇘</span><sub><span class="bound">j</span></sub><span class="hidden">⇙</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span>
          <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∥</span><span class="free">x</span><span class="main">∥</span><span class="main">*</span><span class="main">∥</span><span class="free">y</span><span class="main">∥</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="skolem">n</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="skolem">n</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="free">x</span><span class="hidden">⇘</span><sub><span class="bound">k</span></sub><span class="hidden">⇙</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="free">y</span><span class="hidden">⇘</span><sub><span class="bound">j</span></sub><span class="hidden">⇙</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">moreover</span></span>
      <span class="keyword1"><span class="command">{</span></span>
        <span class="keyword1"><span class="command">txt</span></span> <span class="quoted"><span class="plain_text">‹We also show that <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>¦x⋅y¦^2›</span></span></span></span> can be expressed as a double sum.›</span></span>
        <span class="keyword1"><span class="command">have</span></span>
          <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="free">x</span><span class="main">⋅</span><span class="free">y</span><span class="main">¦</span><span class="main">^</span><span class="numeral">2</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span><span class="main">⋅</span><span class="free">y</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> nx <span class="keyword1"><span class="command">have</span></span>
          <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="skolem">n</span><span class="main">}</span><span class="main">.</span> <span class="free">x</span><span class="hidden">⇘</span><sub><span class="bound">j</span></sub><span class="hidden">⇙</span><span class="main">*</span><span class="free">y</span><span class="hidden">⇘</span><sub><span class="bound">j</span></sub><span class="hidden">⇙</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> dot_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> real_sq <span class="keyword1"><span class="command">have</span></span>
          <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="skolem">n</span><span class="main">}</span><span class="main">.</span> <span class="free">x</span><span class="hidden">⇘</span><sub><span class="bound">j</span></sub><span class="hidden">⇙</span><span class="main">*</span><span class="free">y</span><span class="hidden">⇘</span><sub><span class="bound">j</span></sub><span class="hidden">⇙</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="skolem">n</span><span class="main">}</span><span class="main">.</span> <span class="free">x</span><span class="hidden">⇘</span><sub><span class="bound">j</span></sub><span class="hidden">⇙</span><span class="main">*</span><span class="free">y</span><span class="hidden">⇘</span><sub><span class="bound">j</span></sub><span class="hidden">⇙</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> sum_product <span class="keyword1"><span class="command">have</span></span>
          <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="skolem">n</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="skolem">n</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="free">x</span><span class="hidden">⇘</span><sub><span class="bound">k</span></sub><span class="hidden">⇙</span><span class="main">*</span><span class="free">y</span><span class="hidden">⇘</span><sub><span class="bound">k</span></sub><span class="hidden">⇙</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="free">x</span><span class="hidden">⇘</span><sub><span class="bound">j</span></sub><span class="hidden">⇙</span><span class="main">*</span><span class="free">y</span><span class="hidden">⇘</span><sub><span class="bound">j</span></sub><span class="hidden">⇙</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span>
          <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="free">x</span><span class="main">⋅</span><span class="free">y</span><span class="main">¦</span><span class="main">^</span><span class="numeral">2</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="skolem">n</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="skolem">n</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="free">x</span><span class="hidden">⇘</span><sub><span class="bound">k</span></sub><span class="hidden">⇙</span><span class="main">*</span><span class="free">y</span><span class="hidden">⇘</span><sub><span class="bound">k</span></sub><span class="hidden">⇙</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="free">x</span><span class="hidden">⇘</span><sub><span class="bound">j</span></sub><span class="hidden">⇙</span><span class="main">*</span><span class="free">y</span><span class="hidden">⇘</span><sub><span class="bound">j</span></sub><span class="hidden">⇙</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">txt</span></span> <span class="quoted"><span class="plain_text">‹We now manipulate the double sum expressions to get the
      required inequality.›</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span>
        <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∥</span><span class="free">x</span><span class="main">∥</span><span class="main">*</span><span class="main">∥</span><span class="free">y</span><span class="main">∥</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span> <span class="main">-</span> <span class="main">¦</span><span class="free">x</span><span class="main">⋅</span><span class="free">y</span><span class="main">¦</span><span class="main">^</span><span class="numeral">2</span> <span class="main">=</span>
         <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="skolem">n</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="skolem">n</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="free">x</span><span class="hidden">⇘</span><sub><span class="bound">k</span></sub><span class="hidden">⇙</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="free">y</span><span class="hidden">⇘</span><sub><span class="bound">j</span></sub><span class="hidden">⇙</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span>
         <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="skolem">n</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="skolem">n</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="free">x</span><span class="hidden">⇘</span><sub><span class="bound">k</span></sub><span class="hidden">⇙</span><span class="main">*</span><span class="free">y</span><span class="hidden">⇘</span><sub><span class="bound">k</span></sub><span class="hidden">⇙</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="free">x</span><span class="hidden">⇘</span><sub><span class="bound">j</span></sub><span class="hidden">⇙</span><span class="main">*</span><span class="free">y</span><span class="hidden">⇘</span><sub><span class="bound">j</span></sub><span class="hidden">⇙</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span>
        <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span>
         <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="skolem">n</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="skolem">n</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="free">x</span><span class="hidden">⇘</span><sub><span class="bound">k</span></sub><span class="hidden">⇙</span><span class="main">^</span><span class="numeral">2</span><span class="main">*</span><span class="free">y</span><span class="hidden">⇘</span><sub><span class="bound">j</span></sub><span class="hidden">⇙</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="free">x</span><span class="hidden">⇘</span><sub><span class="bound">j</span></sub><span class="hidden">⇙</span><span class="main">^</span><span class="numeral">2</span><span class="main">*</span><span class="free">y</span><span class="hidden">⇘</span><sub><span class="bound">k</span></sub><span class="hidden">⇙</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span>
         <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="skolem">n</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="skolem">n</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="free">x</span><span class="hidden">⇘</span><sub><span class="bound">k</span></sub><span class="hidden">⇙</span><span class="main">*</span><span class="free">y</span><span class="hidden">⇘</span><sub><span class="bound">k</span></sub><span class="hidden">⇙</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="free">x</span><span class="hidden">⇘</span><sub><span class="bound">j</span></sub><span class="hidden">⇙</span><span class="main">*</span><span class="free">y</span><span class="hidden">⇘</span><sub><span class="bound">j</span></sub><span class="hidden">⇙</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> double_sum_aux<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span>
        <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span>
         <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="skolem">n</span><span class="main">}</span><span class="main">.</span>  <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="skolem">n</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="free">x</span><span class="hidden">⇘</span><sub><span class="bound">k</span></sub><span class="hidden">⇙</span><span class="main">^</span><span class="numeral">2</span><span class="main">*</span><span class="free">y</span><span class="hidden">⇘</span><sub><span class="bound">j</span></sub><span class="hidden">⇙</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="free">x</span><span class="hidden">⇘</span><sub><span class="bound">j</span></sub><span class="hidden">⇙</span><span class="main">^</span><span class="numeral">2</span><span class="main">*</span><span class="free">y</span><span class="hidden">⇘</span><sub><span class="bound">k</span></sub><span class="hidden">⇙</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">/</span><span class="numeral">2</span> <span class="main">-</span> <span class="main">(</span><span class="free">x</span><span class="hidden">⇘</span><sub><span class="bound">k</span></sub><span class="hidden">⇙</span><span class="main">*</span><span class="free">y</span><span class="hidden">⇘</span><sub><span class="bound">k</span></sub><span class="hidden">⇙</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="free">x</span><span class="hidden">⇘</span><sub><span class="bound">j</span></sub><span class="hidden">⇙</span><span class="main">*</span><span class="free">y</span><span class="hidden">⇘</span><sub><span class="bound">j</span></sub><span class="hidden">⇙</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_subtractf<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span>
        <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span>
         <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="skolem">n</span><span class="main">}</span><span class="main">.</span>  <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="skolem">n</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span>inverse <span class="numeral">2</span><span class="main">)</span><span class="main">*</span><span class="numeral">2</span><span class="main">*</span>
         <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free">x</span><span class="hidden">⇘</span><sub><span class="bound">k</span></sub><span class="hidden">⇙</span><span class="main">^</span><span class="numeral">2</span><span class="main">*</span><span class="free">y</span><span class="hidden">⇘</span><sub><span class="bound">j</span></sub><span class="hidden">⇙</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="free">x</span><span class="hidden">⇘</span><sub><span class="bound">j</span></sub><span class="hidden">⇙</span><span class="main">^</span><span class="numeral">2</span><span class="main">*</span><span class="free">y</span><span class="hidden">⇘</span><sub><span class="bound">k</span></sub><span class="hidden">⇙</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="free">x</span><span class="hidden">⇘</span><sub><span class="bound">k</span></sub><span class="hidden">⇙</span><span class="main">*</span><span class="free">y</span><span class="hidden">⇘</span><sub><span class="bound">k</span></sub><span class="hidden">⇙</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="free">x</span><span class="hidden">⇘</span><sub><span class="bound">j</span></sub><span class="hidden">⇙</span><span class="main">*</span><span class="free">y</span><span class="hidden">⇘</span><sub><span class="bound">j</span></sub><span class="hidden">⇙</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span>
        <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span>
         <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="skolem">n</span><span class="main">}</span><span class="main">.</span>  <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="skolem">n</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span>inverse <span class="numeral">2</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span>
        <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free">x</span><span class="hidden">⇘</span><sub><span class="bound">k</span></sub><span class="hidden">⇙</span><span class="main">^</span><span class="numeral">2</span><span class="main">*</span><span class="free">y</span><span class="hidden">⇘</span><sub><span class="bound">j</span></sub><span class="hidden">⇙</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="free">x</span><span class="hidden">⇘</span><sub><span class="bound">j</span></sub><span class="hidden">⇙</span><span class="main">^</span><span class="numeral">2</span><span class="main">*</span><span class="free">y</span><span class="hidden">⇘</span><sub><span class="bound">k</span></sub><span class="hidden">⇙</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="free">x</span><span class="hidden">⇘</span><sub><span class="bound">k</span></sub><span class="hidden">⇙</span><span class="main">*</span><span class="free">y</span><span class="hidden">⇘</span><sub><span class="bound">k</span></sub><span class="hidden">⇙</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="free">x</span><span class="hidden">⇘</span><sub><span class="bound">j</span></sub><span class="hidden">⇙</span><span class="main">*</span><span class="free">y</span><span class="hidden">⇘</span><sub><span class="bound">j</span></sub><span class="hidden">⇙</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> mult.assoc<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span>
        <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span>
         <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="skolem">n</span><span class="main">}</span><span class="main">.</span>  <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="skolem">n</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span>inverse <span class="numeral">2</span><span class="main">)</span><span class="main">*</span>
        <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free">x</span><span class="hidden">⇘</span><sub><span class="bound">k</span></sub><span class="hidden">⇙</span><span class="main">^</span><span class="numeral">2</span><span class="main">*</span><span class="free">y</span><span class="hidden">⇘</span><sub><span class="bound">j</span></sub><span class="hidden">⇙</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="free">x</span><span class="hidden">⇘</span><sub><span class="bound">j</span></sub><span class="hidden">⇙</span><span class="main">^</span><span class="numeral">2</span><span class="main">*</span><span class="free">y</span><span class="hidden">⇘</span><sub><span class="bound">k</span></sub><span class="hidden">⇙</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="numeral">2</span><span class="main">*</span><span class="main">(</span>inverse <span class="numeral">2</span><span class="main">)</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">*</span><span class="main">(</span><span class="free">x</span><span class="hidden">⇘</span><sub><span class="bound">k</span></sub><span class="hidden">⇙</span><span class="main">*</span><span class="free">y</span><span class="hidden">⇘</span><sub><span class="bound">k</span></sub><span class="hidden">⇙</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="free">x</span><span class="hidden">⇘</span><sub><span class="bound">j</span></sub><span class="hidden">⇙</span><span class="main">*</span><span class="free">y</span><span class="hidden">⇘</span><sub><span class="bound">j</span></sub><span class="hidden">⇙</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> distrib_right mult.assoc <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span>
        <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span>
        <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="skolem">n</span><span class="main">}</span><span class="main">.</span>  <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="skolem">n</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span>inverse <span class="numeral">2</span><span class="main">)</span><span class="main">*</span>
        <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free">x</span><span class="hidden">⇘</span><sub><span class="bound">k</span></sub><span class="hidden">⇙</span><span class="main">^</span><span class="numeral">2</span><span class="main">*</span><span class="free">y</span><span class="hidden">⇘</span><sub><span class="bound">j</span></sub><span class="hidden">⇙</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="free">x</span><span class="hidden">⇘</span><sub><span class="bound">j</span></sub><span class="hidden">⇙</span><span class="main">^</span><span class="numeral">2</span><span class="main">*</span><span class="free">y</span><span class="hidden">⇘</span><sub><span class="bound">k</span></sub><span class="hidden">⇙</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">*</span><span class="main">(</span><span class="free">x</span><span class="hidden">⇘</span><sub><span class="bound">k</span></sub><span class="hidden">⇙</span><span class="main">*</span><span class="free">y</span><span class="hidden">⇘</span><sub><span class="bound">k</span></sub><span class="hidden">⇙</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="free">x</span><span class="hidden">⇘</span><sub><span class="bound">j</span></sub><span class="hidden">⇙</span><span class="main">*</span><span class="free">y</span><span class="hidden">⇘</span><sub><span class="bound">j</span></sub><span class="hidden">⇙</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> mult.assoc<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span>
        <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span>
         <span class="main">(</span>inverse <span class="numeral">2</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="skolem">n</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="skolem">n</span><span class="main">}</span><span class="main">.</span>
         <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free">x</span><span class="hidden">⇘</span><sub><span class="bound">k</span></sub><span class="hidden">⇙</span><span class="main">^</span><span class="numeral">2</span><span class="main">*</span><span class="free">y</span><span class="hidden">⇘</span><sub><span class="bound">j</span></sub><span class="hidden">⇙</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="free">x</span><span class="hidden">⇘</span><sub><span class="bound">j</span></sub><span class="hidden">⇙</span><span class="main">^</span><span class="numeral">2</span><span class="main">*</span><span class="free">y</span><span class="hidden">⇘</span><sub><span class="bound">k</span></sub><span class="hidden">⇙</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">*</span><span class="main">(</span><span class="free">x</span><span class="hidden">⇘</span><sub><span class="bound">k</span></sub><span class="hidden">⇙</span><span class="main">*</span><span class="free">y</span><span class="hidden">⇘</span><sub><span class="bound">k</span></sub><span class="hidden">⇙</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="free">x</span><span class="hidden">⇘</span><sub><span class="bound">j</span></sub><span class="hidden">⇙</span><span class="main">*</span><span class="free">y</span><span class="hidden">⇘</span><sub><span class="bound">j</span></sub><span class="hidden">⇙</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> sum_distrib_left<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span>
        <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span>
         <span class="main">(</span>inverse <span class="numeral">2</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="skolem">n</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="skolem">n</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="free">x</span><span class="hidden">⇘</span><sub><span class="bound">k</span></sub><span class="hidden">⇙</span><span class="main">*</span><span class="free">y</span><span class="hidden">⇘</span><sub><span class="bound">j</span></sub><span class="hidden">⇙</span> <span class="main">-</span> <span class="free">x</span><span class="hidden">⇘</span><sub><span class="bound">j</span></sub><span class="hidden">⇙</span><span class="main">*</span><span class="free">y</span><span class="hidden">⇘</span><sub><span class="bound">k</span></sub><span class="hidden">⇙</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> power2_diff real_sq_exp<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="skolem">n</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="skolem">n</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="free">x</span><span class="hidden">⇘</span><sub><span class="bound">k</span></sub><span class="hidden">⇙</span><span class="main">*</span><span class="free">y</span><span class="hidden">⇘</span><sub><span class="bound">j</span></sub><span class="hidden">⇙</span> <span class="main">-</span> <span class="free">x</span><span class="hidden">⇘</span><sub><span class="bound">j</span></sub><span class="hidden">⇙</span><span class="main">*</span><span class="free">y</span><span class="hidden">⇘</span><sub><span class="bound">k</span></sub><span class="hidden">⇙</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_nonneg<span class="main">)</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∥</span><span class="free">x</span><span class="main">∥</span><span class="main">*</span><span class="main">∥</span><span class="free">y</span><span class="main">∥</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span> <span class="main">-</span> <span class="main">¦</span><span class="free">x</span><span class="main">⋅</span><span class="free">y</span><span class="main">¦</span><span class="main">^</span><span class="numeral">2</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="main">∥</span><span class="free">x</span><span class="main">∥</span><span class="main">*</span><span class="main">∥</span><span class="free">y</span><span class="main">∥</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> norm_pos<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> power2_le_imp_le<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div>