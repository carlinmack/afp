<div id="Multiset">
<div class="head">
<h1>Theory Multiset</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Multiset›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  \file{Multiset} contains a minimal multiset structure.
›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Multiset
<span class="keyword2"><span class="keyword">imports</span></span> <a href="../../HOL/HOL/Main.html">Main</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹A minimal multiset theory›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Völzer, p. 84, does specify that messages in transit are modelled using
  multisets.
  
  We decided to implement a tiny structure for multisets, just fitting our needs.
  These multisets allow to add new values to them, to check for elements existing
  in a certain multiset, filter elements according to boolean predicates, remove
  elements and to create a new multiset from a single element.
›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  A multiset for a type is a mapping from the elements of the type to natural
  numbers. So, we record how often a message has to be processed in the future.
›</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span> <span class="tfree">'a</span> multiset <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> nat"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">mElem</span> <span class="main">::</span>
  <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> multiset <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="quoted">"_ <span class="keyword1">∈#</span> _"</span> 60<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free">mElem</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">ms</span></span></span> <span class="main">≡</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free"><span class="bound"><span class="entity">ms</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Hence the union of two multisets is the addition of the number of the
  elements and therefore the associative and the commutative laws holds for
  the union.
›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">mUnion</span> <span class="main">::</span>
  <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> multiset <span class="main">⇒</span> <span class="tfree">'a</span> multiset <span class="main">⇒</span> <span class="tfree">'a</span> multiset"</span></span> <span class="main">(</span><span class="quoted">"_ <span class="keyword1">∪#</span> _"</span> 70<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">mUnion</span> <span class="free"><span class="bound"><span class="entity">msA</span></span></span> <span class="free"><span class="bound"><span class="entity">msB</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">msA</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">+</span> <span class="free"><span class="bound"><span class="entity">msB</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Correspondingly the subtraction is defined and the commutative law holds.
›</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">mRm</span> <span class="main">::</span>
  <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> multiset <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> multiset"</span></span> <span class="main">(</span><span class="quoted">"_ <span class="keyword1">-#</span> _"</span> 65<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">mRm</span> <span class="free"><span class="bound"><span class="entity">ms</span></span></span> <span class="free"><span class="bound"><span class="entity">rm</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">≡</span> <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">rm</span></span></span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">ms</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">-</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="free"><span class="bound"><span class="entity">ms</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">mSingleton</span> <span class="main">::</span>
  <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> multiset"</span></span>          <span class="main">(</span><span class="quoted">"<span class="keyword1">{#</span> _ <span class="keyword1">}</span>"</span><span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">mSingleton</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">≡</span> <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The lemma \isb{AXc} adds just the fact we need for our proofs about
  the commutativity of the union of multisets while elements are removed.
›</span></span>
<span class="keyword1" id="Multiset-AXc"><span class="command">lemma</span></span> AXc<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free">c1</span> <span class="main">≠</span> <span class="free">c2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free">c1</span> <span class="main">∈#</span> <span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">c2</span> <span class="main">∈#</span> <span class="free">X</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">A1</span> <span class="main">∪#</span> <span class="main">(</span><span class="main">(</span><span class="free">A2</span> <span class="main">∪#</span> <span class="main">(</span><span class="free">X</span> <span class="main">-#</span> <span class="free">c2</span><span class="main">)</span><span class="main">)</span> <span class="main">-#</span> <span class="free">c1</span><span class="main">)</span><span class="main">)</span> 
      <span class="main">=</span> <span class="main">(</span><span class="free">A2</span> <span class="main">∪#</span> <span class="main">(</span><span class="main">(</span><span class="free">A1</span> <span class="main">∪#</span> <span class="main">(</span><span class="free">X</span> <span class="main">-#</span> <span class="free">c1</span><span class="main">)</span><span class="main">)</span> <span class="main">-#</span> <span class="free">c2</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span> 
  <span class="keyword1"><span class="command">have</span></span> 
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">A2</span> <span class="main">∪#</span> <span class="main">(</span><span class="main">(</span><span class="free">A1</span> <span class="main">∪#</span> <span class="main">(</span><span class="free">X</span> <span class="main">-#</span> <span class="free">c1</span><span class="main">)</span><span class="main">)</span> <span class="main">-#</span> <span class="free">c2</span><span class="main">)</span><span class="main">)</span> 
         <span class="main">=</span> <span class="main">(</span><span class="free">A2</span> <span class="main">∪#</span> <span class="main">(</span><span class="free">A1</span> <span class="main">∪#</span> <span class="main">(</span><span class="main">(</span><span class="free">X</span> <span class="main">-#</span> <span class="free">c1</span><span class="main">)</span> <span class="main">-#</span> <span class="free">c2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">A1</span> <span class="main">∪#</span> <span class="main">(</span><span class="main">(</span><span class="free">A2</span> <span class="main">∪#</span> <span class="main">(</span><span class="free">X</span> <span class="main">-#</span> <span class="free">c2</span><span class="main">)</span><span class="main">)</span> <span class="main">-#</span> <span class="free">c1</span><span class="main">)</span><span class="main">)</span> "</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="AsynchronousSystem">
<div class="head">
<h1>Theory AsynchronousSystem</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹AsynchronousSystem›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  \file{AsynchronousSystem} defines a message datatype and a transition system locale to
  model asynchronous distributed computation. It establishes a diamond property for a
  special reachability relation within such transition systems.
›</span></span>

<span class="keyword1"><span class="command">theory</span></span> AsynchronousSystem
<span class="keyword2"><span class="keyword">imports</span></span> <a href="Multiset.html">Multiset</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  The formalization is type-parameterized over
  \begin{description}
    \item[\var{'p} process identifiers.] Corresponds to the set $P$ in Völzer.
      Finiteness is not yet demanded, but will be in \file{FLPSystem}.
    \item[\var{'s} process states.] Corresponds to $S$, countability is not
      imposed.
    \item[\var{'v} message payloads.] Corresponds to the interprocess
      communication part of $M$ from Völzer. The whole of $M$ is captured by
      \isb{messageValue}.
  \end{description}
›</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Messages›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  A \isb{message} is either an initial input message telling a process
  which value it should introduce to the consensus negotiation, a message
  to the environment communicating the consensus outcome, or a message
  passed from one process to some other.
›</span></span>

<span class="keyword1"><span class="command">datatype</span></span> <span class="main">(</span><span class="tfree">'p</span><span class="main">,</span> <span class="tfree">'v</span><span class="main">)</span> message <span class="main">=</span>
  InMsg <span class="tfree"><span class="quoted"><span class="tfree">'p</span></span></span> <span class="quoted">bool</span>  <span class="main">(</span><span class="quoted">"<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">&lt;</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>_<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">,</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> <span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">inM</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> _<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">&gt;</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>"</span><span class="main">)</span>
<span class="main">|</span> OutMsg <span class="quoted">bool</span>    <span class="main">(</span><span class="quoted">"<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">&lt;⊥,</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> <span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">outM</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> _<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">&gt;</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>"</span><span class="main">)</span>
<span class="main">|</span> Msg <span class="tfree"><span class="quoted"><span class="tfree">'p</span></span></span> <span class="tfree"><span class="quoted"><span class="tfree">'v</span></span></span>      <span class="main">(</span><span class="quoted">"<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">&lt;</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>_<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">,</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> _<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">&gt;</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>"</span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  A message value is the content of a message, which a process may receive. 
›</span></span>

<span class="keyword1"><span class="command">datatype</span></span> <span class="tfree">'v</span> messageValue <span class="main">=</span> 
  Bool <span class="quoted">bool</span>
<span class="main">|</span> Value <span class="tfree"><span class="quoted"><span class="tfree">'v</span></span></span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">unpackMessage</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'p</span><span class="main">,</span> <span class="tfree">'v</span><span class="main">)</span> message <span class="main">⇒</span> <span class="tfree">'v</span> messageValue"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">unpackMessage</span> <span class="main">&lt;</span><span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">,</span> <span class="keyword1">inM</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">&gt;</span>  <span class="main">=</span> Bool <span class="free"><span class="bound"><span class="entity">b</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">unpackMessage</span> <span class="main">&lt;</span><span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">&gt;</span>      <span class="main">=</span> Value <span class="free"><span class="bound"><span class="entity">v</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">unpackMessage</span> <span class="main">&lt;⊥,</span> <span class="keyword1">outM</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">&gt;</span> <span class="main">=</span> Bool False"</span></span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">isReceiverOf</span> <span class="main">::</span> 
  <span class="quoted"><span class="quoted">"<span class="tfree">'p</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'p</span><span class="main">,</span> <span class="tfree">'v</span><span class="main">)</span> message <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> 
   <span class="quoted"><span class="quoted">"<span class="free">isReceiverOf</span> <span class="free"><span class="bound"><span class="entity">p1</span></span></span> <span class="main">(</span><span class="main">&lt;</span><span class="free"><span class="bound"><span class="entity">p2</span></span></span><span class="main">,</span> <span class="keyword1">inM</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">&gt;</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">p1</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">p2</span></span></span><span class="main">)</span>"</span></span>
 <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">isReceiverOf</span> <span class="free"><span class="bound"><span class="entity">p1</span></span></span> <span class="main">(</span><span class="main">&lt;</span><span class="free"><span class="bound"><span class="entity">p2</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">&gt;</span><span class="main">)</span> <span class="main">=</span>     <span class="main">(</span><span class="free"><span class="bound"><span class="entity">p1</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">p2</span></span></span><span class="main">)</span>"</span></span>
 <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">isReceiverOf</span> <span class="free"><span class="bound"><span class="entity">p1</span></span></span> <span class="main">(</span><span class="main">&lt;⊥,</span><span class="keyword1">outM</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">&gt;</span><span class="main">)</span> <span class="main">=</span>  False"</span></span>

<span class="keyword1" id="AsynchronousSystem-UniqueReceiverOf"><span class="command">lemma</span></span> UniqueReceiverOf<span class="main">:</span>
<span class="keyword2"><span class="keyword">fixes</span></span> 
  <span class="free">msg</span>  <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'p</span><span class="main">,</span> <span class="tfree">'v</span><span class="main">)</span> message"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">p</span> <span class="free">q</span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'p</span></span></span>
<span class="keyword2"><span class="keyword">assumes</span></span>
  <span class="quoted"><span class="quoted">"isReceiverOf <span class="free">q</span> <span class="free">msg</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="free">q</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> 
  <span class="quoted"><span class="quoted">"<span class="main">¬</span> isReceiverOf <span class="free">p</span> <span class="free">msg</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">msg</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Configurations›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Here we formalize a configuration as detailed in section 2 of Völzer's paper.

  Note that Völzer imposes the finiteness of the message multiset by
  definition while we do not do so. In \isb{FiniteMessages}
  We prove the finiteness to follow from the assumption that only
  finitely many messages can be sent at once.
›</span></span>

<span class="keyword1"><span class="command">record</span></span> <span class="main">(</span><span class="tfree">'p</span><span class="main">,</span> <span class="tfree">'v</span><span class="main">,</span> <span class="tfree">'s</span><span class="main">)</span> configuration <span class="main">=</span>
  states <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'p</span> <span class="main">⇒</span> <span class="tfree">'s</span>"</span></span>
  msgs <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="tfree">'p</span><span class="main">,</span> <span class="tfree">'v</span><span class="main">)</span> message<span class="main">)</span> multiset"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  C.f. Völzer: \textquote{A step is identified with a message $(p, m)$. A step $(p, m)$ is enabled
  in a configuration c if $\var{msgs}_c$ contains the message $(p, m)$.}
›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">enabled</span> <span class="main">::</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'p</span><span class="main">,</span> <span class="tfree">'v</span><span class="main">,</span> <span class="tfree">'s</span><span class="main">)</span> configuration <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'p</span><span class="main">,</span> <span class="tfree">'v</span><span class="main">)</span> message <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free">enabled</span> <span class="free"><span class="bound"><span class="entity">cfg</span></span></span> <span class="free"><span class="bound"><span class="entity">msg</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">msg</span></span></span> <span class="main">∈#</span> msgs <span class="free"><span class="bound"><span class="entity">cfg</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹The system locale›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The locale describing a system is derived by slight refactoring from the
  following passage of Völzer:
  \begin{displayquote}
    A process $p$ consists of an initial state $s_p \in S$ and a step transition
    function, which assigns to each pair $(m, s)$ of a message value $m$ and
    a process state $s$ a follower state and a finite set of messages (the
    messages to be sent by $p$ in a step).
  \end{displayquote}
›</span></span>

<span class="keyword1"><span class="command">locale</span></span> asynchronousSystem <span class="main">=</span>
<span class="keyword2"><span class="keyword">fixes</span></span> 
  <span class="free">trans</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'p</span> <span class="main">⇒</span> <span class="tfree">'s</span> <span class="main">⇒</span> <span class="tfree">'v</span> messageValue <span class="main">⇒</span> <span class="tfree">'s</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">sends</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'p</span> <span class="main">⇒</span> <span class="tfree">'s</span> <span class="main">⇒</span> <span class="tfree">'v</span> messageValue <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'p</span><span class="main">,</span> <span class="tfree">'v</span><span class="main">)</span> message multiset"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">start</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'p</span> <span class="main">⇒</span> <span class="tfree">'s</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">Proc</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'p</span> set"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">Proc</span> <span class="main">≡</span> <span class="main">(</span>UNIV <span class="main">::</span> <span class="tfree">'p</span> set<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹The step relation›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The step relation is defined analogously to Völzer:
  \begin{displayquote}
    {[}If enabled, a step may{]} occur, resulting in a follower
    configuration $c^\prime$, where $c^\prime$ is obtained from $c$ by removing
    $(p, m)$ from $\var{msgs}_c$, changing $p$'s state and adding the set of
    messages to $\var{msgs}_c$ according to the step transition function
    associated with $p$. We denote this by $c \xrightarrow{p,m} c^\prime$.
  \end{displayquote}
  There are no steps consuming output messages.
›</span></span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">steps</span> <span class="main">::</span> 
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'p</span><span class="main">,</span> <span class="tfree">'v</span><span class="main">,</span> <span class="tfree">'s</span><span class="main">)</span> configuration
   <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'p</span><span class="main">,</span> <span class="tfree">'v</span><span class="main">)</span> message
   <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'p</span><span class="main">,</span> <span class="tfree">'v</span><span class="main">,</span> <span class="tfree">'s</span><span class="main">)</span> configuration
   <span class="main">⇒</span> bool"</span></span>
   <span class="main">(</span><span class="quoted">"_ <span class="keyword1">⊢</span> _ <span class="keyword1">↦</span> _"</span> <span class="main">[</span>70<span class="main">,</span>70<span class="main">,</span>70<span class="main">]</span><span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span> 
  StepInMsg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">cfg1</span></span></span> <span class="main"><span class="free">⊢</span></span> <span class="main">&lt;</span><span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">,</span> <span class="keyword1">inM</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">&gt;</span> <span class="main"><span class="free">↦</span></span> <span class="free"><span class="bound"><span class="entity">cfg2</span></span></span> <span class="main">=</span> <span class="main">(</span>
  <span class="main">(</span><span class="main">∀</span> <span class="bound">s</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="bound">s</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">⟶</span> states <span class="free"><span class="bound"><span class="entity">cfg2</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> <span class="free">trans</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">(</span>states <span class="free"><span class="bound"><span class="entity">cfg1</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">(</span>Bool <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span><span class="main">)</span>
      <span class="main">∧</span> <span class="main">(</span><span class="main">(</span><span class="bound">s</span> <span class="main">≠</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">⟶</span> states <span class="free"><span class="bound"><span class="entity">cfg2</span></span></span> <span class="bound">s</span> <span class="main">=</span> states <span class="free"><span class="bound"><span class="entity">cfg1</span></span></span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span>
   <span class="main">∧</span> enabled <span class="free"><span class="bound"><span class="entity">cfg1</span></span></span> <span class="main">&lt;</span><span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">,</span> <span class="keyword1">inM</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">&gt;</span>
   <span class="main">∧</span> msgs <span class="free"><span class="bound"><span class="entity">cfg2</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free">sends</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">(</span>states <span class="free"><span class="bound"><span class="entity">cfg1</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">(</span>Bool <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span>
                  <span class="main">∪#</span> <span class="main">(</span>msgs <span class="free"><span class="bound"><span class="entity">cfg1</span></span></span> <span class="main">-#</span> <span class="main">&lt;</span><span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">,</span> <span class="keyword1">inM</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">&gt;</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="main">|</span> StepMsg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">cfg1</span></span></span> <span class="main"><span class="free">⊢</span></span> <span class="main">&lt;</span><span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">&gt;</span> <span class="main"><span class="free">↦</span></span> <span class="free"><span class="bound"><span class="entity">cfg2</span></span></span> <span class="main">=</span> <span class="main">(</span>
  <span class="main">(</span><span class="main">∀</span> <span class="bound">s</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="bound">s</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">⟶</span> states <span class="free"><span class="bound"><span class="entity">cfg2</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> <span class="free">trans</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">(</span>states <span class="free"><span class="bound"><span class="entity">cfg1</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">(</span>Value <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span><span class="main">)</span>
      <span class="main">∧</span> <span class="main">(</span><span class="main">(</span><span class="bound">s</span> <span class="main">≠</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">⟶</span> states <span class="free"><span class="bound"><span class="entity">cfg2</span></span></span> <span class="bound">s</span> <span class="main">=</span> states <span class="free"><span class="bound"><span class="entity">cfg1</span></span></span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span>
   <span class="main">∧</span> enabled <span class="free"><span class="bound"><span class="entity">cfg1</span></span></span> <span class="main">&lt;</span><span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">&gt;</span>
   <span class="main">∧</span> msgs <span class="free"><span class="bound"><span class="entity">cfg2</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free">sends</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">(</span>states <span class="free"><span class="bound"><span class="entity">cfg1</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">(</span>Value <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span>
                  <span class="main">∪#</span> <span class="main">(</span>msgs <span class="free"><span class="bound"><span class="entity">cfg1</span></span></span> <span class="main">-#</span> <span class="main">&lt;</span><span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">&gt;</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="main">|</span> StepOutMsg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">cfg1</span></span></span> <span class="main"><span class="free">⊢</span></span> <span class="main">&lt;⊥,</span><span class="keyword1">outM</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">&gt;</span> <span class="main"><span class="free">↦</span></span> <span class="free"><span class="bound"><span class="entity">cfg2</span></span></span> <span class="main">=</span> 
    False"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The system is distributed and asynchronous in the sense that the processing
  of messages only affects the process the message is directed to while the
  rest stays unchanged.
›</span></span>
<span class="keyword1" id="AsynchronousSystem-NoReceivingNoChange"><span class="command">lemma</span></span> NoReceivingNoChange<span class="main">:</span>
<span class="keyword2"><span class="keyword">fixes</span></span>
  <span class="free">cfg1</span> <span class="free">cfg2</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'p</span><span class="main">,</span><span class="tfree">'v</span><span class="main">,</span><span class="tfree">'s</span><span class="main">)</span> configuration"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">m</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'p</span><span class="main">,</span><span class="tfree">'v</span><span class="main">)</span> message"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">p</span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'p</span></span></span>
<span class="keyword2"><span class="keyword">assumes</span></span>
  Step<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">cfg1</span> <span class="main">⊢</span> <span class="free">m</span> <span class="main">↦</span> <span class="free">cfg2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  Rec<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> isReceiverOf <span class="free">p</span> <span class="free">m</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span>
  <span class="quoted"><span class="quoted">"states <span class="free">cfg1</span> <span class="free">p</span> <span class="main">=</span> states <span class="free">cfg2</span> <span class="free">p</span> "</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">m</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>OutMsg <span class="skolem">b'</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> Step <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>InMsg <span class="skolem">q</span> <span class="skolem">b'</span><span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> CaseM<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">=</span> <span class="main">&lt;</span><span class="skolem">q</span><span class="main">,</span> <span class="keyword1">inM</span> <span class="skolem">b'</span><span class="main">&gt;</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="skolem">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> Step CaseM <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Msg <span class="skolem">q</span> <span class="skolem">v'</span><span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> CaseM<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">=</span> <span class="main">&lt;</span><span class="skolem">q</span><span class="main">,</span> <span class="skolem">v'</span><span class="main">&gt;</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="skolem">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> Step CaseM <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="AsynchronousSystem-ExistsMsg"><span class="command">lemma</span></span> ExistsMsg<span class="main">:</span>
<span class="keyword2"><span class="keyword">fixes</span></span>
  <span class="free">cfg1</span> <span class="free">cfg2</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'p</span><span class="main">,</span><span class="tfree">'v</span><span class="main">,</span><span class="tfree">'s</span><span class="main">)</span> configuration"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">m</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'p</span><span class="main">,</span><span class="tfree">'v</span><span class="main">)</span> message"</span></span>
<span class="keyword2"><span class="keyword">assumes</span></span>
  Step<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">cfg1</span> <span class="main">⊢</span> <span class="free">m</span> <span class="main">↦</span> <span class="free">cfg2</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">∈#</span> <span class="main">(</span>msgs <span class="free">cfg1</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms enabled_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">m</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="AsynchronousSystem-NoMessageLossStep"><span class="command">lemma</span></span> NoMessageLossStep<span class="main">:</span>
<span class="keyword2"><span class="keyword">fixes</span></span>
  <span class="free">cfg1</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'p</span><span class="main">,</span><span class="tfree">'v</span><span class="main">,</span><span class="tfree">'s</span><span class="main">)</span> configuration"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">cfg2</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'p</span><span class="main">,</span><span class="tfree">'v</span><span class="main">,</span><span class="tfree">'s</span><span class="main">)</span> configuration"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">p</span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'p</span></span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">m</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'p</span><span class="main">,</span><span class="tfree">'v</span><span class="main">)</span> message"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">m'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'p</span><span class="main">,</span><span class="tfree">'v</span><span class="main">)</span> message"</span></span>
<span class="keyword2"><span class="keyword">assumes</span></span>
  Step<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">cfg1</span> <span class="main">⊢</span> <span class="free">m</span> <span class="main">↦</span> <span class="free">cfg2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  Rec1<span class="main">:</span> <span class="quoted"><span class="quoted">"isReceiverOf <span class="free">p</span> <span class="free">m</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  Rec2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>isReceiverOf <span class="free">p</span> <span class="free">m'</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> 
  <span class="quoted"><span class="quoted">"msgs <span class="free">cfg1</span> <span class="free">m'</span> <span class="main">≤</span> msgs <span class="free">cfg2</span> <span class="free">m'</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">m</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="AsynchronousSystem-OutOnlyGrowing"><span class="command">lemma</span></span> OutOnlyGrowing<span class="main">:</span>
<span class="keyword2"><span class="keyword">fixes</span></span> 
  <span class="free">cfg1</span> <span class="free">cfg2</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'p</span><span class="main">,</span><span class="tfree">'v</span><span class="main">,</span><span class="tfree">'s</span><span class="main">)</span> configuration"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">b</span><span class="main">::</span><span class="quoted">bool</span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">m</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'p</span><span class="main">,</span> <span class="tfree">'v</span><span class="main">)</span> message"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">p</span><span class="main">::</span><span class="tfree"><span class="quoted"><span class="tfree">'p</span></span></span>
<span class="keyword2"><span class="keyword">assumes</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">cfg1</span> <span class="main">⊢</span> <span class="free">m</span> <span class="main">↦</span> <span class="free">cfg2</span>"</span></span>
  <span class="quoted"><span class="quoted">"isReceiverOf <span class="free">p</span> <span class="free">m</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> 
  <span class="quoted"><span class="quoted">"msgs <span class="free">cfg2</span> <span class="main">&lt;⊥,</span> <span class="keyword1">outM</span> <span class="free">b</span><span class="main">&gt;</span> 
  <span class="main">=</span> <span class="main">(</span>msgs <span class="free">cfg1</span> <span class="main">&lt;⊥,</span> <span class="keyword1">outM</span> <span class="free">b</span><span class="main">&gt;</span><span class="main">)</span> <span class="main">+</span> 
    <span class="free">sends</span> <span class="free">p</span> <span class="main">(</span>states <span class="free">cfg1</span> <span class="free">p</span><span class="main">)</span> <span class="main">(</span>unpackMessage <span class="free">m</span><span class="main">)</span> <span class="main">&lt;⊥,</span> <span class="keyword1">outM</span> <span class="free">b</span><span class="main">&gt;</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">-</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">=</span> <span class="main">&lt;⊥,</span> <span class="keyword1">outM</span> <span class="free">b</span><span class="main">&gt;</span> <span class="main">⟹</span> False"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span> <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">hence</span></span> MNotOut<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">≠</span> <span class="main">&lt;⊥,</span> <span class="keyword1">outM</span> <span class="free">b</span><span class="main">&gt;</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> MsgFunction<span class="main">:</span> <span class="quoted"><span class="quoted">"msgs <span class="free">cfg2</span> 
                    <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">sends</span> <span class="free">p</span> <span class="main">(</span>states <span class="free">cfg1</span> <span class="free">p</span><span class="main">)</span> <span class="main">(</span>unpackMessage <span class="free">m</span><span class="main">)</span><span class="main">)</span> 
                      <span class="main">∪#</span> <span class="main">(</span><span class="main">(</span>msgs <span class="free">cfg1</span><span class="main">)</span> <span class="main">-#</span> <span class="free">m</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">m</span></span><span class="main">)</span> 
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>InMsg <span class="skolem">pa</span> <span class="skolem">bool</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> PaIsP<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">pa</span> <span class="main">=</span> <span class="free">p</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>unpackMessage <span class="free">m</span><span class="main">)</span> <span class="main">=</span> Bool <span class="skolem">bool</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> isReceiverOf_def assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> UniqueReceiverOf<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">cfg1</span> <span class="main">⊢</span> <span class="main">&lt;</span><span class="free">p</span><span class="main">,</span> <span class="keyword1">inM</span> <span class="skolem">bool</span><span class="main">&gt;</span> <span class="main">↦</span> <span class="free">cfg2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> InMsg <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"msgs <span class="free">cfg2</span> <span class="main">=</span> <span class="main">(</span><span class="free">sends</span> <span class="free">p</span> <span class="main">(</span>states <span class="free">cfg1</span> <span class="free">p</span><span class="main">)</span> <span class="main">(</span>Bool <span class="skolem">bool</span><span class="main">)</span> 
                       <span class="main">∪#</span> <span class="main">(</span>msgs <span class="free">cfg1</span> <span class="main">-#</span> <span class="main">&lt;</span><span class="free">p</span><span class="main">,</span> <span class="keyword1">inM</span> <span class="skolem">bool</span><span class="main">&gt;</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"msgs <span class="free">cfg2</span> <span class="main">=</span> <span class="main">(</span><span class="free">sends</span> <span class="free">p</span> <span class="main">(</span>states <span class="free">cfg1</span> <span class="free">p</span><span class="main">)</span> <span class="main">(</span>Bool <span class="skolem">bool</span><span class="main">)</span> 
                       <span class="main">∪#</span> <span class="main">(</span>msgs <span class="free">cfg1</span> <span class="main">-#</span> <span class="free">m</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> PaIsP<span class="main">(</span>1<span class="main">)</span> InMsg <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> StepInMsg assms PaIsP <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span> <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>OutMsg <span class="skolem">b</span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span> <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Msg <span class="skolem">pa</span> <span class="skolem">va</span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> PaIsP<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">pa</span> <span class="main">=</span> <span class="free">p</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>unpackMessage <span class="free">m</span><span class="main">)</span> <span class="main">=</span> Value <span class="skolem">va</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> isReceiverOf_def assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> UniqueReceiverOf<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">cfg1</span> <span class="main">⊢</span> <span class="main">&lt;</span><span class="free">p</span><span class="main">,</span> <span class="skolem">va</span><span class="main">&gt;</span> <span class="main">↦</span> <span class="free">cfg2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> Msg <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"msgs <span class="free">cfg2</span> <span class="main">=</span> <span class="main">(</span><span class="free">sends</span> <span class="free">p</span> <span class="main">(</span>states <span class="free">cfg1</span> <span class="free">p</span><span class="main">)</span> <span class="main">(</span>Value <span class="skolem">va</span><span class="main">)</span> 
                       <span class="main">∪#</span> <span class="main">(</span>msgs <span class="free">cfg1</span> <span class="main">-#</span> <span class="main">&lt;</span><span class="free">p</span><span class="main">,</span> <span class="skolem">va</span><span class="main">&gt;</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"msgs <span class="free">cfg2</span> <span class="main">=</span> <span class="main">(</span><span class="free">sends</span> <span class="free">p</span> <span class="main">(</span>states <span class="free">cfg1</span> <span class="free">p</span><span class="main">)</span> <span class="main">(</span>Value <span class="skolem">va</span><span class="main">)</span> 
                       <span class="main">∪#</span> <span class="main">(</span>msgs <span class="free">cfg1</span> <span class="main">-#</span> <span class="free">m</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> PaIsP<span class="main">(</span>1<span class="main">)</span> Msg <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> StepInMsg assms PaIsP <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">sends</span> <span class="free">p</span> <span class="main">(</span>states <span class="free">cfg1</span> <span class="free">p</span><span class="main">)</span> <span class="main">(</span>unpackMessage <span class="free">m</span><span class="main">)</span><span class="main">)</span> 
         <span class="main">∪#</span> <span class="main">(</span><span class="main">(</span>msgs <span class="free">cfg1</span><span class="main">)</span> <span class="main">-#</span> <span class="free">m</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;⊥,</span> <span class="keyword1">outM</span> <span class="free">b</span><span class="main">&gt;</span> 
       <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">sends</span> <span class="free">p</span> <span class="main">(</span>states <span class="free">cfg1</span> <span class="free">p</span><span class="main">)</span> <span class="main">(</span>unpackMessage <span class="free">m</span><span class="main">)</span><span class="main">)</span> 
         <span class="main">∪#</span> <span class="main">(</span>msgs <span class="free">cfg1</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;⊥,</span> <span class="keyword1">outM</span> <span class="free">b</span><span class="main">&gt;</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> MNotOut <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"msgs <span class="free">cfg2</span> <span class="main">&lt;⊥,</span> <span class="keyword1">outM</span> <span class="free">b</span><span class="main">&gt;</span> 
       <span class="main">=</span> <span class="main">(</span>msgs <span class="free">cfg1</span> <span class="main">&lt;⊥,</span> <span class="keyword1">outM</span> <span class="free">b</span><span class="main">&gt;</span><span class="main">)</span> <span class="main">+</span> 
         <span class="free">sends</span> <span class="free">p</span> <span class="main">(</span>states <span class="free">cfg1</span> <span class="free">p</span><span class="main">)</span> <span class="main">(</span>unpackMessage <span class="free">m</span><span class="main">)</span> <span class="main">&lt;⊥,</span> <span class="keyword1">outM</span> <span class="free">b</span><span class="main">&gt;</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> MsgFunction <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="AsynchronousSystem-OtherMessagesOnlyGrowing"><span class="command">lemma</span></span> OtherMessagesOnlyGrowing<span class="main">:</span>
<span class="keyword2"><span class="keyword">fixes</span></span>
  <span class="free">cfg1</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'p</span><span class="main">,</span><span class="tfree">'v</span><span class="main">,</span><span class="tfree">'s</span><span class="main">)</span> configuration"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">cfg2</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'p</span><span class="main">,</span><span class="tfree">'v</span><span class="main">,</span><span class="tfree">'s</span><span class="main">)</span> configuration"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">p</span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'p</span></span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">m</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'p</span><span class="main">,</span><span class="tfree">'v</span><span class="main">)</span> message"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">m'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'p</span><span class="main">,</span><span class="tfree">'v</span><span class="main">)</span> message"</span></span>
<span class="keyword2"><span class="keyword">assumes</span></span>
  Step<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">cfg1</span> <span class="main">⊢</span> <span class="free">m</span> <span class="main">↦</span> <span class="free">cfg2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">≠</span> <span class="free">m'</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span>
  <span class="quoted"><span class="quoted">"msgs <span class="free">cfg1</span> <span class="free">m'</span> <span class="main">≤</span> msgs <span class="free">cfg2</span> <span class="free">m'</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">m</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Völzer: \textquote{Note that steps are enabled persistently, i.e., an
  enabled step remains enabled as long as it does not occur.}
›</span></span>
<span class="keyword1" id="AsynchronousSystem-OnlyOccurenceDisables"><span class="command">lemma</span></span> OnlyOccurenceDisables<span class="main">:</span>
<span class="keyword2"><span class="keyword">fixes</span></span>
  <span class="free">cfg1</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'p</span><span class="main">,</span><span class="tfree">'v</span><span class="main">,</span><span class="tfree">'s</span><span class="main">)</span> configuration"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">cfg2</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'p</span><span class="main">,</span><span class="tfree">'v</span><span class="main">,</span><span class="tfree">'s</span><span class="main">)</span> configuration"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">p</span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'p</span></span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">m</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'p</span><span class="main">,</span><span class="tfree">'v</span><span class="main">)</span> message"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">m'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'p</span><span class="main">,</span><span class="tfree">'v</span><span class="main">)</span> message"</span></span>
<span class="keyword2"><span class="keyword">assumes</span></span>
  Step<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">cfg1</span> <span class="main">⊢</span> <span class="free">m</span> <span class="main">↦</span> <span class="free">cfg2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  En<span class="main">:</span> <span class="quoted"><span class="quoted">"enabled <span class="free">cfg1</span> <span class="free">m'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  NotEn<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span>enabled <span class="free">cfg2</span> <span class="free">m'</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">=</span> <span class="free">m'</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">m</span></span><span class="main">)</span> <span class="keyword1"><span class="command">print_cases</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>InMsg <span class="skolem">p</span> <span class="skolem">bool</span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> Step <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"msgs <span class="free">cfg2</span> <span class="main">=</span> <span class="main">(</span><span class="free">sends</span> <span class="skolem">p</span> <span class="main">(</span>states <span class="free">cfg1</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">(</span>Bool <span class="skolem">bool</span><span class="main">)</span> 
                              <span class="main">∪#</span> <span class="main">(</span>msgs <span class="free">cfg1</span> <span class="main">-#</span> <span class="main">&lt;</span><span class="skolem">p</span><span class="main">,</span> <span class="keyword1">inM</span> <span class="skolem">bool</span><span class="main">&gt;</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">=</span> <span class="free">m'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> InMsg En NotEn 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> enabled_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> less_nat_zero_code<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>OutMsg <span class="skolem">bool</span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> Step <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">=</span> <span class="free">m'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Msg <span class="skolem">p</span> <span class="skolem">v</span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> Step <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"msgs <span class="free">cfg2</span> <span class="main">=</span> <span class="main">(</span><span class="free">sends</span> <span class="skolem">p</span> <span class="main">(</span>states <span class="free">cfg1</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">(</span>Value <span class="skolem">v</span><span class="main">)</span> 
                              <span class="main">∪#</span> <span class="main">(</span>msgs <span class="free">cfg1</span> <span class="main">-#</span> <span class="main">&lt;</span><span class="skolem">p</span><span class="main">,</span> <span class="skolem">v</span><span class="main">&gt;</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">=</span> <span class="free">m'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Msg En NotEn 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> enabled_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> less_nat_zero_code<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Reachability›</span></span>

<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">reachable</span> <span class="main">::</span> 
  <span class="quoted"><span class="quoted">"  <span class="main">(</span><span class="tfree">'p</span><span class="main">,</span> <span class="tfree">'v</span><span class="main">,</span> <span class="tfree">'s</span><span class="main">)</span> configuration 
  <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'p</span><span class="main">,</span> <span class="tfree">'v</span><span class="main">,</span> <span class="tfree">'s</span><span class="main">)</span> configuration
  <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> 
  init<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">reachable</span> <span class="free"><span class="bound"><span class="entity">cfg1</span></span></span> <span class="free"><span class="bound"><span class="entity">cfg1</span></span></span>"</span></span>
<span class="main">|</span> step<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">reachable</span> <span class="free"><span class="bound"><span class="entity">cfg1</span></span></span> <span class="free"><span class="bound"><span class="entity">cfg2</span></span></span><span class="main">;</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">cfg2</span></span></span> <span class="main">⊢</span> <span class="free"><span class="bound"><span class="entity">msg</span></span></span> <span class="main">↦</span> <span class="free"><span class="bound"><span class="entity">cfg3</span></span></span><span class="main">)</span> <span class="main">⟧</span> 
          <span class="main">⟹</span> <span class="free">reachable</span> <span class="free"><span class="bound"><span class="entity">cfg1</span></span></span> <span class="free"><span class="bound"><span class="entity">cfg3</span></span></span>"</span></span>

<span class="keyword1" id="AsynchronousSystem-ReachableStepFirst"><span class="command">lemma</span></span> ReachableStepFirst<span class="main">:</span> 
<span class="keyword2"><span class="keyword">assumes</span></span>
  <span class="quoted"><span class="quoted">"reachable <span class="free">cfg</span> <span class="free">cfg'</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free">cfg</span> <span class="main">=</span> <span class="free">cfg'</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">cfg1</span> <span class="bound">msg</span> <span class="bound">p</span> <span class="main">.</span> <span class="main">(</span><span class="free">cfg</span> <span class="main">⊢</span> <span class="bound">msg</span> <span class="main">↦</span> <span class="bound">cfg1</span><span class="main">)</span> <span class="main">∧</span> enabled <span class="free">cfg</span> <span class="bound">msg</span> 
                    <span class="main">∧</span> isReceiverOf <span class="bound">p</span> <span class="bound">msg</span>  
                    <span class="main">∧</span> reachable <span class="bound">cfg1</span> <span class="free">cfg'</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">using</span></span> assms 
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> reachable.induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> 
    <span class="operator">metis</span> StepOutMsg ExistsMsg init enabled_def isReceiverOf.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> 
    isReceiverOf.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> message.exhaust<span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> asynchronousSystem.step<span class="main">)</span>

<span class="keyword1" id="AsynchronousSystem-ReachableTrans"><span class="command">lemma</span></span> ReachableTrans<span class="main">:</span> 
<span class="keyword2"><span class="keyword">fixes</span></span> 
  <span class="free">cfg1</span> <span class="free">cfg2</span> <span class="free">cfg3</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'p</span><span class="main">,</span> <span class="tfree">'v</span><span class="main">,</span> <span class="tfree">'s</span> <span class="main">)</span> configuration"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
  <span class="free">Q</span> <span class="main">::</span> <span class="quoted"><span class="quoted">" <span class="tfree">'p</span> set"</span></span>
<span class="keyword2"><span class="keyword">assumes</span></span> 
  <span class="quoted"><span class="quoted">"reachable <span class="free">cfg1</span> <span class="free">cfg2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
  <span class="quoted"><span class="quoted">"reachable <span class="free">cfg2</span> <span class="free">cfg3</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"reachable <span class="free">cfg1</span> <span class="free">cfg3</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"reachable <span class="free">cfg2</span> <span class="free">cfg3</span> <span class="main">⟹</span> reachable <span class="free">cfg1</span> <span class="free">cfg2</span> <span class="main">⟹</span> reachable <span class="free">cfg1</span> <span class="free">cfg3</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> reachable.induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">cfg1'</span> <span class="skolem">cfg2'</span> <span class="skolem">msg</span> <span class="skolem">cfg3'</span>
    <span class="keyword3"><span class="command">assume</span></span> 
      <span class="quoted"><span class="quoted">"reachable <span class="free">cfg1</span> <span class="skolem">cfg2'</span>"</span></span>
      <span class="quoted"><span class="quoted">"<span class="skolem">cfg2'</span> <span class="main">⊢</span> <span class="skolem">msg</span> <span class="main">↦</span> <span class="skolem">cfg3'</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"reachable <span class="free">cfg1</span> <span class="skolem">cfg3'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> reachable.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">stepReachable</span> <span class="main">::</span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'p</span><span class="main">,</span> <span class="tfree">'v</span><span class="main">,</span> <span class="tfree">'s</span><span class="main">)</span> configuration
  <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'p</span> <span class="main">,</span><span class="tfree">'v</span><span class="main">)</span> message
  <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'p</span><span class="main">,</span> <span class="tfree">'v</span><span class="main">,</span> <span class="tfree">'s</span><span class="main">)</span> configuration
  <span class="main">⇒</span> bool"</span></span> 
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">stepReachable</span> <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="free"><span class="bound"><span class="entity">msg</span></span></span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span> <span class="main">≡</span> 
    <span class="main">∃</span> <span class="bound">c'</span> <span class="bound">c''</span><span class="main">.</span> reachable <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="bound">c'</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">c'</span> <span class="main">⊢</span> <span class="free"><span class="bound"><span class="entity">msg</span></span></span> <span class="main">↦</span> <span class="bound">c''</span><span class="main">)</span> <span class="main">∧</span> reachable <span class="bound">c''</span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span> "</span></span>

<span class="keyword1" id="AsynchronousSystem-StepReachable"><span class="command">lemma</span></span> StepReachable<span class="main">:</span>
<span class="keyword2"><span class="keyword">fixes</span></span>
  <span class="free">cfg</span> <span class="free">cfg'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'p</span><span class="main">,</span><span class="tfree">'v</span><span class="main">,</span><span class="tfree">'s</span><span class="main">)</span> configuration"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">msg</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'p</span><span class="main">,</span> <span class="tfree">'v</span><span class="main">)</span> message"</span></span>
<span class="keyword2"><span class="keyword">assumes</span></span>
  <span class="quoted"><span class="quoted">"reachable <span class="free">cfg</span> <span class="free">cfg'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="quoted"><span class="quoted">"enabled <span class="free">cfg</span> <span class="free">msg</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span>enabled <span class="free">cfg'</span> <span class="free">msg</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"stepReachable <span class="free">cfg</span> <span class="free">msg</span> <span class="free">cfg'</span>"</span></span> 
<span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> reachable.induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">cfg1</span> <span class="skolem">cfg2</span> <span class="skolem">msga</span> <span class="skolem">cfg3</span>
  <span class="keyword3"><span class="command">assume</span></span> Step<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">cfg2</span> <span class="main">⊢</span> <span class="skolem">msga</span> <span class="main">↦</span> <span class="skolem">cfg3</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    ReachCfg1Cfg2<span class="main">:</span> <span class="quoted"><span class="quoted">"reachable <span class="skolem">cfg1</span> <span class="skolem">cfg2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    IV<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>enabled <span class="skolem">cfg1</span> <span class="free">msg</span> <span class="main">⟹</span> <span class="main">¬</span> enabled <span class="skolem">cfg2</span> <span class="free">msg</span> 
        <span class="main">⟹</span> stepReachable <span class="skolem">cfg1</span> <span class="free">msg</span> <span class="skolem">cfg2</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    AssumpInduct<span class="main">:</span> <span class="quoted"><span class="quoted">"enabled <span class="skolem">cfg1</span> <span class="free">msg</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> enabled <span class="skolem">cfg3</span> <span class="free">msg</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> ReachCfg2Cfg3<span class="main">:</span> <span class="quoted"><span class="quoted">"reachable <span class="skolem">cfg2</span> <span class="skolem">cfg3</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Step 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> reachable.init reachable.step<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"stepReachable <span class="skolem">cfg1</span> <span class="free">msg</span> <span class="skolem">cfg3</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"enabled <span class="skolem">cfg2</span> <span class="free">msg</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> AssumpEnabled<span class="main">:</span> <span class="quoted"><span class="quoted">"enabled <span class="skolem">cfg2</span> <span class="free">msg</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">msga</span> <span class="main">=</span> <span class="free">msg</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> OnlyOccurenceDisables Step AssumpInduct<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"stepReachable <span class="skolem">cfg1</span> <span class="free">msg</span> <span class="skolem">cfg3</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ReachCfg1Cfg2 Step 
      <span class="keyword1"><span class="command">unfolding</span></span> stepReachable_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> init<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> AssumpNotEnabled<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> enabled <span class="skolem">cfg2</span> <span class="free">msg</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"stepReachable <span class="skolem">cfg1</span> <span class="free">msg</span> <span class="skolem">cfg2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> IV AssumpInduct<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"stepReachable <span class="skolem">cfg1</span> <span class="free">msg</span> <span class="skolem">cfg3</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> ReachCfg2Cfg3 ReachableTrans asynchronousSystem.stepReachable_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Reachability with special process activity›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  We say that \isb{qReachable cfg1 Q cfg2} iff cfg2 is reachable from cfg1
  only by activity of processes from Q.
›</span></span>
<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">qReachable</span> <span class="main">::</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'p</span><span class="main">,</span><span class="tfree">'v</span><span class="main">,</span><span class="tfree">'s</span><span class="main">)</span> configuration 
  <span class="main">⇒</span> <span class="tfree">'p</span> set 
  <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'p</span><span class="main">,</span><span class="tfree">'v</span><span class="main">,</span><span class="tfree">'s</span><span class="main">)</span> configuration 
  <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>  
  InitQ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">qReachable</span> <span class="free"><span class="bound"><span class="entity">cfg1</span></span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="free"><span class="bound"><span class="entity">cfg1</span></span></span>"</span></span>
<span class="main">|</span> StepQ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">qReachable</span> <span class="free"><span class="bound"><span class="entity">cfg1</span></span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="free"><span class="bound"><span class="entity">cfg2</span></span></span><span class="main">;</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">cfg2</span></span></span> <span class="main">⊢</span> <span class="free"><span class="bound"><span class="entity">msg</span></span></span> <span class="main">↦</span> <span class="free"><span class="bound"><span class="entity">cfg3</span></span></span><span class="main">)</span> <span class="main">;</span>
            <span class="main">∃</span> <span class="bound">p</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">.</span> isReceiverOf <span class="bound">p</span> <span class="free"><span class="bound"><span class="entity">msg</span></span></span> <span class="main">⟧</span> 
          <span class="main">⟹</span> <span class="free">qReachable</span> <span class="free"><span class="bound"><span class="entity">cfg1</span></span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="free"><span class="bound"><span class="entity">cfg3</span></span></span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  We say that \isb{withoutQReachable cfg1 Q cfg2} iff cfg2 is reachable from cfg1
  with no activity of processes from Q.
›</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">withoutQReachable</span> <span class="main">::</span>
   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'p</span><span class="main">,</span><span class="tfree">'v</span><span class="main">,</span><span class="tfree">'s</span><span class="main">)</span> configuration 
  <span class="main">⇒</span> <span class="tfree">'p</span> set 
  <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'p</span><span class="main">,</span><span class="tfree">'v</span><span class="main">,</span><span class="tfree">'s</span><span class="main">)</span> configuration 
  <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">withoutQReachable</span> <span class="free"><span class="bound"><span class="entity">cfg1</span></span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="free"><span class="bound"><span class="entity">cfg2</span></span></span> <span class="main">≡</span> 
    qReachable <span class="free"><span class="bound"><span class="entity">cfg1</span></span></span> <span class="main">(</span><span class="main">(</span>UNIV <span class="main">::</span> <span class="tfree">'p</span> set <span class="main">)</span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">cfg2</span></span></span>"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  Obviously q-reachability (and thus also without-q-reachability) implies 
  reachability.
›</span></span>
<span class="keyword1" id="AsynchronousSystem-QReachImplReach"><span class="command">lemma</span></span> QReachImplReach<span class="main">:</span>
<span class="keyword2"><span class="keyword">fixes</span></span>
  <span class="free">cfg1</span> <span class="free">cfg2</span><span class="main">::</span>  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'p</span><span class="main">,</span> <span class="tfree">'v</span><span class="main">,</span> <span class="tfree">'s</span> <span class="main">)</span> configuration"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">Q</span> <span class="main">::</span> <span class="quoted"><span class="quoted">" <span class="tfree">'p</span> set"</span></span>
<span class="keyword2"><span class="keyword">assumes</span></span>
  <span class="quoted"><span class="quoted">"qReachable <span class="free">cfg1</span> <span class="free">Q</span> <span class="free">cfg2</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> 
  <span class="quoted"><span class="quoted">"reachable <span class="free">cfg1</span> <span class="free">cfg2</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms 
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> qReachable.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> InitQ <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> reachable.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> StepQ <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> reachable.step <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="AsynchronousSystem-QReachableTrans"><span class="command">lemma</span></span> QReachableTrans<span class="main">:</span> 
<span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">cfg1</span> <span class="free">cfg2</span> <span class="free">cfg3</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'p</span><span class="main">,</span> <span class="tfree">'v</span><span class="main">,</span> <span class="tfree">'s</span> <span class="main">)</span> configuration"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">Q</span> <span class="main">::</span> <span class="quoted"><span class="quoted">" <span class="tfree">'p</span> set"</span></span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"qReachable <span class="free">cfg2</span> <span class="free">Q</span> <span class="free">cfg3</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="quoted"><span class="quoted">"qReachable <span class="free">cfg1</span> <span class="free">Q</span> <span class="free">cfg2</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"qReachable <span class="free">cfg1</span> <span class="free">Q</span> <span class="free">cfg3</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> qReachable.induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>StepQ<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> qReachable.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="AsynchronousSystem-NotInQFrozenQReachability"><span class="command">lemma</span></span> NotInQFrozenQReachability<span class="main">:</span> 
<span class="keyword2"><span class="keyword">fixes</span></span>
  <span class="free">cfg1</span> <span class="free">cfg2</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'p</span><span class="main">,</span><span class="tfree">'v</span><span class="main">,</span><span class="tfree">'s</span><span class="main">)</span> configuration"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">p</span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'p</span></span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">Q</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'p</span> set"</span></span>
<span class="keyword2"><span class="keyword">assumes</span></span>
  <span class="quoted"><span class="quoted">"qReachable <span class="free">cfg1</span> <span class="free">Q</span> <span class="free">cfg2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∉</span> <span class="free">Q</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span>
  <span class="quoted"><span class="quoted">"states <span class="free">cfg1</span> <span class="free">p</span> <span class="main">=</span> states <span class="free">cfg2</span> <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms 
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> qReachable.induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">cfg1'</span> <span class="skolem">Q'</span> <span class="skolem">cfg2'</span> <span class="skolem">msg</span> <span class="skolem">cfg3</span> <span class="skolem">p'</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"qReachable <span class="skolem">cfg1'</span> <span class="skolem">Q'</span> <span class="skolem">cfg2'</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> Step<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">cfg2'</span> <span class="main">⊢</span> <span class="skolem">msg</span> <span class="main">↦</span> <span class="skolem">cfg3</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> Rec<span class="main">:</span> <span class="quoted"><span class="quoted">"isReceiverOf <span class="skolem">p'</span> <span class="skolem">msg</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p'</span> <span class="main">∈</span> <span class="skolem">Q'</span>"</span></span>  <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∉</span> <span class="skolem">Q'</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> notEq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="skolem">p'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">with</span></span> Rec <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span>isReceiverOf <span class="free">p</span> <span class="skolem">msg</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">msg</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"states <span class="skolem">cfg2'</span> <span class="free">p</span> <span class="main">=</span> states <span class="skolem">cfg3</span> <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Step NoReceivingNoChange <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> WithoutQReachablFrozenQ<span class="main">:</span>
<span class="keyword2"><span class="keyword">fixes</span></span>
  <span class="free">cfg1</span> <span class="free">cfg2</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'p</span><span class="main">,</span><span class="tfree">'v</span><span class="main">,</span><span class="tfree">'s</span><span class="main">)</span> configuration"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">p</span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'p</span></span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">Q</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'p</span> set"</span></span>
<span class="keyword2"><span class="keyword">assumes</span></span>
  Steps<span class="main">:</span> <span class="quoted"><span class="quoted">"withoutQReachable <span class="free">cfg1</span> <span class="free">Q</span> <span class="free">cfg2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  P<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> <span class="free">Q</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span>
  <span class="quoted"><span class="quoted">"states <span class="free">cfg1</span> <span class="free">p</span> <span class="main">=</span> states <span class="free">cfg2</span> <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms NotInQFrozenQReachability <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="AsynchronousSystem-NoActivityNoMessageLoss"><span class="command">lemma</span></span> NoActivityNoMessageLoss <span class="main">:</span>
<span class="keyword2"><span class="keyword">fixes</span></span>
  <span class="free">cfg1</span> <span class="free">cfg2</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'p</span><span class="main">,</span><span class="tfree">'v</span><span class="main">,</span><span class="tfree">'s</span><span class="main">)</span> configuration"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">p</span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'p</span></span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">Q</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'p</span> set"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">m'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'p</span><span class="main">,</span> <span class="tfree">'v</span><span class="main">)</span> message"</span></span>
<span class="keyword2"><span class="keyword">assumes</span></span>
  <span class="quoted"><span class="quoted">"qReachable <span class="free">cfg1</span> <span class="free">Q</span> <span class="free">cfg2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∉</span> <span class="free">Q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="quoted"><span class="quoted">"isReceiverOf <span class="free">p</span> <span class="free">m'</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span>msgs <span class="free">cfg1</span> <span class="free">m'</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span>msgs <span class="free">cfg2</span> <span class="free">m'</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> qReachable.induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>StepQ <span class="skolem">cfg1'</span> <span class="skolem">Q'</span> <span class="skolem">cfg2'</span> <span class="skolem">msg</span> <span class="skolem">cfg3</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p'</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    P'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p'</span> <span class="main">∈</span> <span class="skolem">Q'</span>"</span></span> <span class="quoted"><span class="quoted">"isReceiverOf <span class="skolem">p'</span> <span class="skolem">msg</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="skolem">p'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span>isReceiverOf <span class="skolem">p'</span> <span class="free">m'</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">m'</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> NoMessageLossStep StepQ<span class="main">(</span>3<span class="main">)</span> P'
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"msgs <span class="skolem">cfg2'</span> <span class="free">m'</span> <span class="main">≤</span> msgs <span class="skolem">cfg3</span> <span class="free">m'</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> StepQ
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"msgs <span class="skolem">cfg1'</span> <span class="free">m'</span> <span class="main">≤</span> msgs <span class="skolem">cfg3</span> <span class="free">m'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="AsynchronousSystem-NoMessageLoss"><span class="command">lemma</span></span> NoMessageLoss<span class="main">:</span>
<span class="keyword2"><span class="keyword">fixes</span></span>
  <span class="free">cfg1</span> <span class="free">cfg2</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'p</span><span class="main">,</span><span class="tfree">'v</span><span class="main">,</span><span class="tfree">'s</span><span class="main">)</span> configuration"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">p</span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'p</span></span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">Q</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'p</span> set"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">m'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'p</span><span class="main">,</span> <span class="tfree">'v</span><span class="main">)</span> message"</span></span>
<span class="keyword2"><span class="keyword">assumes</span></span>
  <span class="quoted"><span class="quoted">"withoutQReachable <span class="free">cfg1</span> <span class="free">Q</span> <span class="free">cfg2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> <span class="free">Q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="quoted"><span class="quoted">"isReceiverOf <span class="free">p</span> <span class="free">m'</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span>msgs <span class="free">cfg1</span> <span class="free">m'</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span>msgs <span class="free">cfg2</span> <span class="free">m'</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">using</span></span> assms NoActivityNoMessageLoss <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="AsynchronousSystem-NoOutMessageLoss"><span class="command">lemma</span></span> NoOutMessageLoss<span class="main">:</span>
<span class="keyword2"><span class="keyword">fixes</span></span>
  <span class="free">cfg1</span> <span class="free">cfg2</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'p</span><span class="main">,</span><span class="tfree">'v</span><span class="main">,</span><span class="tfree">'s</span><span class="main">)</span> configuration"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">v</span> <span class="main">::</span> <span class="quoted">bool</span>
<span class="keyword2"><span class="keyword">assumes</span></span>
  <span class="quoted"><span class="quoted">"reachable <span class="free">cfg1</span> <span class="free">cfg2</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span>msgs <span class="free">cfg1</span> <span class="main">&lt;⊥,</span> <span class="keyword1">outM</span> <span class="free">v</span><span class="main">&gt;</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span>msgs <span class="free">cfg2</span> <span class="main">&lt;⊥,</span> <span class="keyword1">outM</span> <span class="free">v</span><span class="main">&gt;</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms 
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> reachable.induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">cfg1</span> <span class="skolem">cfg'</span> <span class="skolem">msg</span> <span class="skolem">cfg2</span>
  <span class="keyword3"><span class="command">assume</span></span> AssInduct<span class="main">:</span>
    <span class="quoted"><span class="quoted">"reachable <span class="skolem">cfg1</span> <span class="skolem">cfg'</span>"</span></span>
    <span class="quoted"><span class="quoted">"msgs <span class="skolem">cfg1</span> <span class="main">&lt;⊥,</span> <span class="keyword1">outM</span> <span class="free">v</span><span class="main">&gt;</span> <span class="main">≤</span> msgs <span class="skolem">cfg'</span> <span class="main">&lt;⊥,</span> <span class="keyword1">outM</span> <span class="free">v</span><span class="main">&gt;</span>"</span></span> 
    <span class="quoted"><span class="quoted">"<span class="skolem">cfg'</span> <span class="main">⊢</span> <span class="skolem">msg</span> <span class="main">↦</span> <span class="skolem">cfg2</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> AssInduct<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"msgs <span class="skolem">cfg'</span> <span class="main">&lt;⊥,</span> <span class="keyword1">outM</span> <span class="free">v</span><span class="main">&gt;</span> <span class="main">≤</span> msgs <span class="skolem">cfg2</span> <span class="main">&lt;⊥,</span> <span class="keyword1">outM</span> <span class="free">v</span><span class="main">&gt;</span>"</span></span>  
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">msg</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> AssInduct<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">" msgs <span class="skolem">cfg1</span> <span class="main">&lt;⊥,</span> <span class="keyword1">outM</span> <span class="free">v</span><span class="main">&gt;</span> <span class="main">≤</span> msgs <span class="skolem">cfg2</span> <span class="main">&lt;⊥,</span> <span class="keyword1">outM</span> <span class="free">v</span><span class="main">&gt;</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> le_trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span> 

<span class="keyword1" id="AsynchronousSystem-StillEnabled"><span class="command">lemma</span></span> StillEnabled<span class="main">:</span>
<span class="keyword2"><span class="keyword">fixes</span></span> 
  <span class="free">cfg1</span> <span class="free">cfg2</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'p</span><span class="main">,</span><span class="tfree">'v</span><span class="main">,</span><span class="tfree">'s</span><span class="main">)</span> configuration"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">p</span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'p</span></span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">msg</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'p</span><span class="main">,</span><span class="tfree">'v</span><span class="main">)</span> message"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">Q</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'p</span> set"</span></span>
<span class="keyword2"><span class="keyword">assumes</span></span> 
  <span class="quoted"><span class="quoted">"withoutQReachable <span class="free">cfg1</span> <span class="free">Q</span> <span class="free">cfg2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> <span class="free">Q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="quoted"><span class="quoted">"isReceiverOf <span class="free">p</span> <span class="free">msg</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="quoted"><span class="quoted">"enabled <span class="free">cfg1</span> <span class="free">msg</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span>
  <span class="quoted"><span class="quoted">"enabled <span class="free">cfg2</span> <span class="free">msg</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms enabled_def NoMessageLoss 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> le_0_eq neq0_conv<span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Initial reachability›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">initial</span> <span class="main">::</span> 
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'p</span><span class="main">,</span> <span class="tfree">'v</span><span class="main">,</span> <span class="tfree">'s</span><span class="main">)</span> configuration <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">initial</span> <span class="free"><span class="bound"><span class="entity">cfg</span></span></span> <span class="main">≡</span>
        <span class="main">(</span><span class="main">∀</span> <span class="bound">p</span><span class="main">::</span><span class="tfree">'p</span> <span class="main">.</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">v</span><span class="main">::</span>bool <span class="main">.</span> <span class="main">(</span><span class="main">(</span>msgs <span class="free"><span class="bound"><span class="entity">cfg</span></span></span> <span class="main">(</span><span class="main">&lt;</span><span class="bound">p</span><span class="main">,</span> <span class="keyword1">inM</span> <span class="bound">v</span><span class="main">&gt;</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
      <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">p</span> <span class="bound">m1</span> <span class="bound">m2</span> <span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="bound">m1</span> <span class="main">∈#</span> <span class="main">(</span>msgs <span class="free"><span class="bound"><span class="entity">cfg</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">m2</span> <span class="main">∈#</span> <span class="main">(</span>msgs <span class="free"><span class="bound"><span class="entity">cfg</span></span></span><span class="main">)</span><span class="main">)</span> 
         <span class="main">∧</span> isReceiverOf <span class="bound">p</span> <span class="bound">m1</span> <span class="main">∧</span> isReceiverOf <span class="bound">p</span> <span class="bound">m2</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="bound">m1</span> <span class="main">=</span> <span class="bound">m2</span><span class="main">)</span><span class="main">)</span>
      <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">v</span><span class="main">::</span>bool <span class="main">.</span> <span class="main">(</span>msgs <span class="free"><span class="bound"><span class="entity">cfg</span></span></span><span class="main">)</span> <span class="main">(</span><span class="main">&lt;⊥,</span> <span class="keyword1">outM</span> <span class="bound">v</span><span class="main">&gt;</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>
      <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">p</span> <span class="bound">v</span><span class="main">.</span> <span class="main">(</span>msgs <span class="free"><span class="bound"><span class="entity">cfg</span></span></span><span class="main">)</span> <span class="main">(</span><span class="main">&lt;</span><span class="bound">p</span><span class="main">,</span> <span class="bound">v</span><span class="main">&gt;</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>
      <span class="main">∧</span> states <span class="free"><span class="bound"><span class="entity">cfg</span></span></span> <span class="main">=</span> <span class="free">start</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">initReachable</span> <span class="main">::</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'p</span><span class="main">,</span> <span class="tfree">'v</span><span class="main">,</span> <span class="tfree">'s</span><span class="main">)</span> configuration <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">initReachable</span> <span class="free"><span class="bound"><span class="entity">cfg</span></span></span> <span class="main">≡</span> <span class="main">∃</span><span class="bound">cfg0</span> <span class="main">.</span> initial <span class="bound">cfg0</span> <span class="main">∧</span> reachable <span class="bound">cfg0</span> <span class="free"><span class="bound"><span class="entity">cfg</span></span></span>"</span></span>

<span class="keyword1" id="AsynchronousSystem-InitialIsInitReachable"><span class="command">lemma</span></span> InitialIsInitReachable <span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"initial <span class="free">c</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"initReachable <span class="free">c</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms reachable.init
  <span class="keyword1"><span class="command">unfolding</span></span> initReachable_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Diamond property of reachability›</span></span>

<span class="keyword1" id="AsynchronousSystem-DiamondOne"><span class="command">lemma</span></span> DiamondOne<span class="main">:</span>
<span class="keyword2"><span class="keyword">fixes</span></span>
  <span class="free">cfg</span> <span class="free">cfg1</span> <span class="free">cfg2</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'p</span><span class="main">,</span><span class="tfree">'v</span><span class="main">,</span><span class="tfree">'s</span><span class="main">)</span> configuration"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">p</span> <span class="free">q</span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'p</span></span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">m</span> <span class="free">m'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'p</span><span class="main">,</span><span class="tfree">'v</span><span class="main">)</span> message"</span></span>
<span class="keyword2"><span class="keyword">assumes</span></span>
  StepP<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">cfg</span> <span class="main">⊢</span> <span class="free">m</span>  <span class="main">↦</span> <span class="free">cfg1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  PNotQ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="free">q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  Rec<span class="main">:</span> <span class="quoted"><span class="quoted">"isReceiverOf <span class="free">p</span> <span class="free">m</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span>isReceiverOf <span class="free">p</span> <span class="free">m'</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  Rec'<span class="main">:</span> <span class="quoted"><span class="quoted">"isReceiverOf <span class="free">q</span> <span class="free">m'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span>isReceiverOf <span class="free">q</span> <span class="free">m</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  StepWithoutP<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">cfg</span> <span class="main">⊢</span> <span class="free">m'</span> <span class="main">↦</span> <span class="free">cfg2</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">cfg'</span> <span class="main">::</span> <span class="main">(</span><span class="tfree">'p</span><span class="main">,</span><span class="tfree">'v</span><span class="main">,</span><span class="tfree">'s</span><span class="main">)</span> configuration <span class="main">.</span> <span class="main">(</span><span class="free">cfg1</span> <span class="main">⊢</span> <span class="free">m'</span> <span class="main">↦</span> <span class="bound">cfg'</span><span class="main">)</span>
        <span class="main">∧</span> <span class="main">(</span><span class="free">cfg2</span> <span class="main">⊢</span> <span class="free">m</span> <span class="main">↦</span> <span class="bound">cfg'</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">m</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>InMsg <span class="skolem">p</span> <span class="skolem">b</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> StepWithoutP ExistsMsg <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" <span class="free">m'</span> <span class="main">∈#</span> <span class="main">(</span>msgs <span class="free">cfg</span><span class="main">)</span> "</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>          
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">m'</span> <span class="main">∈#</span> <span class="main">(</span>msgs <span class="free">cfg1</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> StepP Rec NoMessageLossStep le_neq_implies_less le_antisym 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span>  gr_implies_not0 neq0_conv<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> EnM'<span class="main">:</span> <span class="quoted"><span class="quoted">"enabled <span class="free">cfg1</span> <span class="free">m'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> enabled_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> StepP ExistsMsg <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">∈#</span> <span class="main">(</span>msgs <span class="free">cfg</span><span class="main">)</span> "</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">∈#</span> <span class="main">(</span>msgs <span class="free">cfg2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> StepWithoutP Rec' NoMessageLossStep
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> le_0_eq neq0_conv<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> EnM<span class="main">:</span> <span class="quoted"><span class="quoted">"enabled <span class="free">cfg2</span> <span class="free">m</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> enabled_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">assume</span></span> CaseM<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">=</span> <span class="main">&lt;</span><span class="skolem">p</span><span class="main">,</span> <span class="keyword1">inM</span> <span class="skolem">b</span><span class="main">&gt;</span>"</span></span>
  
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">m'</span></span><span class="main">)</span> 
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>OutMsg <span class="skolem">b'</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> StepWithoutP <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>InMsg <span class="skolem">q</span> <span class="skolem">b'</span><span class="main">)</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">cfg'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">cfg'</span> <span class="main">=</span> <span class="main">⦇</span>states <span class="main">=</span> <span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="main">(</span>
      <span class="keyword1">if</span> <span class="bound">s</span> <span class="main">=</span> <span class="skolem">q</span> <span class="keyword1">then</span>
        <span class="free">trans</span> <span class="skolem">q</span> <span class="main">(</span>states <span class="free">cfg</span> <span class="skolem">q</span><span class="main">)</span> <span class="main">(</span>Bool <span class="skolem">b'</span><span class="main">)</span>
      <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="bound">s</span> <span class="main">=</span> <span class="skolem">p</span> <span class="keyword1">then</span>
        <span class="free">trans</span> <span class="skolem">p</span> <span class="main">(</span>states <span class="free">cfg</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">(</span>Bool <span class="skolem">b</span><span class="main">)</span>
      <span class="keyword1">else</span>
        states <span class="free">cfg</span> <span class="bound">s</span><span class="main">)</span><span class="main">,</span>
      msgs <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">sends</span> <span class="skolem">q</span> <span class="main">(</span>states <span class="free">cfg</span> <span class="skolem">q</span><span class="main">)</span> <span class="main">(</span>Bool <span class="skolem">b'</span><span class="main">)</span><span class="main">)</span> 
        <span class="main">∪#</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free">sends</span> <span class="skolem">p</span> <span class="main">(</span>states <span class="free">cfg</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">(</span>Bool <span class="skolem">b</span><span class="main">)</span><span class="main">)</span>
            <span class="main">∪#</span> <span class="main">(</span><span class="main">(</span>msgs <span class="free">cfg</span><span class="main">)</span><span class="main">-#</span> <span class="free">m</span><span class="main">)</span><span class="main">)</span> <span class="main">-#</span> <span class="free">m'</span><span class="main">)</span><span class="main">)</span><span class="main">⦈</span> "</span></span>
    <span class="keyword1"><span class="command">have</span></span> StepP'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">cfg1</span> <span class="main">⊢</span> <span class="free">m'</span> <span class="main">↦</span> <span class="skolem">cfg'</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> StepP  EnM' Rec
      <span class="keyword1"><span class="command">unfolding</span></span> cfg'_def InMsg CaseM <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> EnM <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">cfg2</span> <span class="main">⊢</span> <span class="free">m</span> <span class="main">↦</span> <span class="skolem">cfg'</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> InMsg cfg'_def StepP StepP' StepWithoutP NoReceivingNoChange  
            Rec' CaseM EnM'
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">clarify</span><span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> msgCfg<span class="main">:</span>
        <span class="quoted"><span class="quoted">"msgs <span class="free">cfg1</span> <span class="main">=</span> <span class="main">(</span><span class="free">sends</span> <span class="skolem">p</span> <span class="main">(</span>states <span class="free">cfg</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">(</span>Bool <span class="skolem">b</span><span class="main">)</span>  
                     <span class="main">∪#</span> <span class="main">(</span>msgs <span class="free">cfg</span> <span class="main">-#</span> <span class="main">&lt;</span><span class="skolem">p</span><span class="main">,</span> <span class="keyword1">inM</span> <span class="skolem">b</span><span class="main">&gt;</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="quoted"><span class="quoted">"msgs <span class="free">cfg2</span> <span class="main">=</span> <span class="main">(</span><span class="free">sends</span> <span class="skolem">q</span> <span class="main">(</span>states <span class="free">cfg</span> <span class="skolem">q</span><span class="main">)</span> <span class="main">(</span>Bool <span class="skolem">b'</span><span class="main">)</span> 
                     <span class="main">∪#</span> <span class="main">(</span>msgs <span class="free">cfg</span> <span class="main">-#</span> <span class="main">&lt;</span><span class="skolem">q</span><span class="main">,</span> <span class="keyword1">inM</span> <span class="skolem">b'</span><span class="main">&gt;</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"enabled <span class="free">cfg</span> <span class="free">m</span>"</span></span> <span class="quoted"><span class="quoted">"enabled <span class="free">cfg</span> <span class="free">m'</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> StepP StepWithoutP CaseM InMsg 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> msgCfg <span class="keyword3"><span class="command">show</span></span> 
        <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">sends</span> <span class="skolem">q</span> <span class="main">(</span>states <span class="free">cfg</span> <span class="skolem">q</span><span class="main">)</span> <span class="main">(</span>Bool <span class="skolem">b'</span><span class="main">)</span> <span class="main">∪#</span> <span class="main">(</span>msgs <span class="free">cfg1</span> <span class="main">-#</span> <span class="main">&lt;</span><span class="skolem">q</span><span class="main">,</span> <span class="keyword1">inM</span> <span class="skolem">b'</span><span class="main">&gt;</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
         <span class="main">(</span><span class="free">sends</span> <span class="skolem">p</span> <span class="main">(</span>states <span class="free">cfg</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">(</span>Bool <span class="skolem">b</span><span class="main">)</span> <span class="main">∪#</span> <span class="main">(</span>msgs <span class="free">cfg2</span> <span class="main">-#</span> <span class="main">&lt;</span><span class="skolem">p</span><span class="main">,</span> <span class="keyword1">inM</span> <span class="skolem">b</span><span class="main">&gt;</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> CaseM InMsg StepP StepWithoutP Rec' AXc<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">m'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span>"</span></span> <span class="quoted"><span class="quoted">"msgs <span class="free">cfg</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="free">sends</span> <span class="skolem">q</span> <span class="main">(</span>states <span class="free">cfg</span> <span class="skolem">q</span><span class="main">)</span> <span class="main">(</span>Bool <span class="skolem">b'</span><span class="main">)</span>"</span></span> 
          <span class="quoted"><span class="quoted">"<span class="free">sends</span> <span class="skolem">p</span> <span class="main">(</span>states <span class="free">cfg</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">(</span>Bool <span class="skolem">b</span><span class="main">)</span>"</span></span><span class="main">]</span>         
        <span class="keyword1"><span class="command">unfolding</span></span> enabled_def
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Msg <span class="skolem">q</span> <span class="skolem">v'</span><span class="main">)</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">cfg'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">cfg'</span> <span class="main">=</span> <span class="main">⦇</span>states <span class="main">=</span> <span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="main">(</span>
      <span class="keyword1">if</span> <span class="bound">s</span> <span class="main">=</span> <span class="skolem">q</span> <span class="keyword1">then</span>
        <span class="free">trans</span> <span class="skolem">q</span> <span class="main">(</span>states <span class="free">cfg</span> <span class="skolem">q</span><span class="main">)</span> <span class="main">(</span>Value <span class="skolem">v'</span><span class="main">)</span>
      <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="bound">s</span> <span class="main">=</span> <span class="skolem">p</span> <span class="keyword1">then</span>
        <span class="free">trans</span> <span class="skolem">p</span> <span class="main">(</span>states <span class="free">cfg</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">(</span>Bool <span class="skolem">b</span><span class="main">)</span>
      <span class="keyword1">else</span>
        states <span class="free">cfg</span> <span class="bound">s</span><span class="main">)</span><span class="main">,</span>
      msgs <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">sends</span> <span class="skolem">q</span> <span class="main">(</span>states <span class="free">cfg</span> <span class="skolem">q</span><span class="main">)</span> <span class="main">(</span>Value <span class="skolem">v'</span><span class="main">)</span><span class="main">)</span> 
        <span class="main">∪#</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free">sends</span> <span class="skolem">p</span> <span class="main">(</span>states <span class="free">cfg</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">(</span>Bool <span class="skolem">b</span><span class="main">)</span><span class="main">)</span>
            <span class="main">∪#</span> <span class="main">(</span><span class="main">(</span>msgs <span class="free">cfg</span><span class="main">)</span><span class="main">-#</span> <span class="free">m</span><span class="main">)</span><span class="main">)</span>
            <span class="main">-#</span> <span class="free">m'</span><span class="main">)</span><span class="main">)</span><span class="main">⦈</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> StepP'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">cfg1</span> <span class="main">⊢</span> <span class="free">m'</span> <span class="main">↦</span> <span class="skolem">cfg'</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> StepP EnM' Rec
      <span class="keyword1"><span class="command">unfolding</span></span> Msg CaseM cfg'_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> EnM <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">cfg2</span> <span class="main">⊢</span> <span class="free">m</span> <span class="main">↦</span> <span class="skolem">cfg'</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Msg cfg'_def StepP StepP' StepWithoutP NoReceivingNoChange Rec' CaseM EnM'
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span><span class="operator">clarify</span><span class="main">)</span> 
      <span class="keyword3"><span class="command">assume</span></span> msgCfg1<span class="main">:</span>
        <span class="quoted"><span class="quoted">"msgs <span class="free">cfg1</span> <span class="main">=</span> <span class="main">(</span><span class="free">sends</span> <span class="skolem">p</span> <span class="main">(</span>states <span class="free">cfg</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">(</span>Bool <span class="skolem">b</span><span class="main">)</span>   
                      <span class="main">∪#</span> <span class="main">(</span>msgs <span class="free">cfg</span> <span class="main">-#</span> <span class="main">&lt;</span><span class="skolem">p</span><span class="main">,</span> <span class="keyword1">inM</span> <span class="skolem">b</span><span class="main">&gt;</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="quoted"><span class="quoted">"msgs <span class="free">cfg2</span> <span class="main">=</span> <span class="main">(</span><span class="free">sends</span> <span class="skolem">q</span> <span class="main">(</span>states <span class="free">cfg</span> <span class="skolem">q</span><span class="main">)</span> <span class="main">(</span>Value <span class="skolem">v'</span><span class="main">)</span> 
                      <span class="main">∪#</span> <span class="main">(</span>msgs <span class="free">cfg</span> <span class="main">-#</span> <span class="main">&lt;</span><span class="skolem">q</span><span class="main">,</span>  <span class="skolem">v'</span><span class="main">&gt;</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"enabled <span class="free">cfg</span> <span class="free">m</span>"</span></span> <span class="quoted"><span class="quoted">"enabled <span class="free">cfg</span> <span class="free">m'</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> StepP StepWithoutP CaseM Msg 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> msgCfg1 <span class="keyword3"><span class="command">show</span></span> 
        <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">sends</span> <span class="skolem">q</span> <span class="main">(</span>states <span class="free">cfg</span> <span class="skolem">q</span><span class="main">)</span> <span class="main">(</span>Value <span class="skolem">v'</span><span class="main">)</span> <span class="main">∪#</span> <span class="main">(</span>msgs <span class="free">cfg1</span> <span class="main">-#</span> <span class="main">&lt;</span><span class="skolem">q</span><span class="main">,</span> <span class="skolem">v'</span><span class="main">&gt;</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
         <span class="main">(</span><span class="free">sends</span> <span class="skolem">p</span> <span class="main">(</span>states <span class="free">cfg</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">(</span>Bool <span class="skolem">b</span><span class="main">)</span> <span class="main">∪#</span> <span class="main">(</span>msgs <span class="free">cfg2</span> <span class="main">-#</span> <span class="main">&lt;</span><span class="skolem">p</span><span class="main">,</span> <span class="keyword1">inM</span> <span class="skolem">b</span><span class="main">&gt;</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> CaseM Msg StepP StepWithoutP Rec' AXc<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">m'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span>"</span></span> <span class="quoted"><span class="quoted">"msgs <span class="free">cfg</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="free">sends</span> <span class="skolem">q</span> <span class="main">(</span>states <span class="free">cfg</span> <span class="skolem">q</span><span class="main">)</span> <span class="main">(</span>Value <span class="skolem">v'</span><span class="main">)</span>"</span></span> 
          <span class="quoted"><span class="quoted">"<span class="free">sends</span> <span class="skolem">p</span> <span class="main">(</span>states <span class="free">cfg</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">(</span>Bool <span class="skolem">b</span><span class="main">)</span>"</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">unfolding</span></span> enabled_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>OutMsg <span class="skolem">b</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> StepP <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Msg <span class="skolem">p</span> <span class="skolem">v</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> StepWithoutP ExistsMsg <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" <span class="free">m'</span> <span class="main">∈#</span> <span class="main">(</span>msgs <span class="free">cfg</span><span class="main">)</span> "</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">m'</span> <span class="main">∈#</span> <span class="main">(</span>msgs <span class="free">cfg1</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> StepP Rec NoMessageLossStep le_neq_implies_less le_antisym 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span>  gr_implies_not0 neq0_conv<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> EnM'<span class="main">:</span> <span class="quoted"><span class="quoted">"enabled <span class="free">cfg1</span> <span class="free">m'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> enabled_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> StepP ExistsMsg <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">∈#</span> <span class="main">(</span>msgs <span class="free">cfg</span><span class="main">)</span> "</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">∈#</span> <span class="main">(</span>msgs <span class="free">cfg2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> StepWithoutP Rec' NoMessageLossStep
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> le_0_eq neq0_conv<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> EnM<span class="main">:</span> <span class="quoted"><span class="quoted">"enabled <span class="free">cfg2</span> <span class="free">m</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> enabled_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">assume</span></span> CaseM<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">=</span> <span class="main">&lt;</span><span class="skolem">p</span><span class="main">,</span> <span class="skolem">v</span><span class="main">&gt;</span>"</span></span> 
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">m'</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>OutMsg <span class="skolem">b'</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> StepWithoutP <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>InMsg <span class="skolem">q</span> <span class="skolem">b'</span><span class="main">)</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">cfg'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">cfg'</span> <span class="main">=</span> <span class="main">⦇</span>states <span class="main">=</span> <span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="main">(</span>
      <span class="keyword1">if</span> <span class="bound">s</span> <span class="main">=</span> <span class="skolem">q</span> <span class="keyword1">then</span>
        <span class="free">trans</span> <span class="skolem">q</span> <span class="main">(</span>states <span class="free">cfg</span> <span class="skolem">q</span><span class="main">)</span> <span class="main">(</span>Bool <span class="skolem">b'</span><span class="main">)</span>
      <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="bound">s</span> <span class="main">=</span> <span class="skolem">p</span> <span class="keyword1">then</span>
        <span class="free">trans</span> <span class="skolem">p</span> <span class="main">(</span>states <span class="free">cfg</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">(</span>Value <span class="skolem">v</span><span class="main">)</span>
      <span class="keyword1">else</span>
        states <span class="free">cfg</span> <span class="bound">s</span><span class="main">)</span><span class="main">,</span>
      msgs <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">sends</span> <span class="skolem">q</span> <span class="main">(</span>states <span class="free">cfg</span> <span class="skolem">q</span><span class="main">)</span> <span class="main">(</span>Bool <span class="skolem">b'</span><span class="main">)</span><span class="main">)</span> 
        <span class="main">∪#</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free">sends</span> <span class="skolem">p</span> <span class="main">(</span>states <span class="free">cfg</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">(</span>Value <span class="skolem">v</span><span class="main">)</span><span class="main">)</span>
        <span class="main">∪#</span> <span class="main">(</span><span class="main">(</span>msgs <span class="free">cfg</span><span class="main">)</span><span class="main">-#</span> <span class="free">m</span><span class="main">)</span><span class="main">)</span>
        <span class="main">-#</span> <span class="free">m'</span><span class="main">)</span><span class="main">)</span><span class="main">⦈</span> "</span></span>
    <span class="keyword1"><span class="command">hence</span></span> StepP'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">cfg1</span> <span class="main">⊢</span> <span class="free">m'</span> <span class="main">↦</span> <span class="skolem">cfg'</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> StepP InMsg EnM' Rec CaseM
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> EnM <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">cfg2</span> <span class="main">⊢</span> <span class="free">m</span> <span class="main">↦</span> <span class="skolem">cfg'</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> InMsg cfg'_def StepP StepP' StepWithoutP NoReceivingNoChange Rec' 
            CaseM EnM'
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">clarify</span><span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> msgCfg<span class="main">:</span>
        <span class="quoted"><span class="quoted">"msgs <span class="free">cfg1</span> <span class="main">=</span> <span class="main">(</span><span class="free">sends</span> <span class="skolem">p</span> <span class="main">(</span>states <span class="free">cfg</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">(</span>Value <span class="skolem">v</span><span class="main">)</span>
          <span class="main">∪#</span> <span class="main">(</span>msgs <span class="free">cfg</span> <span class="main">-#</span> <span class="main">&lt;</span><span class="skolem">p</span><span class="main">,</span> <span class="skolem">v</span><span class="main">&gt;</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="quoted"><span class="quoted">"msgs <span class="free">cfg2</span> <span class="main">=</span> <span class="main">(</span><span class="free">sends</span> <span class="skolem">q</span> <span class="main">(</span>states <span class="free">cfg</span> <span class="skolem">q</span><span class="main">)</span> <span class="main">(</span>Bool <span class="skolem">b'</span><span class="main">)</span>
          <span class="main">∪#</span> <span class="main">(</span>msgs <span class="free">cfg</span> <span class="main">-#</span> <span class="main">&lt;</span><span class="skolem">q</span><span class="main">,</span> <span class="keyword1">inM</span> <span class="skolem">b'</span><span class="main">&gt;</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"enabled <span class="free">cfg</span> <span class="free">m</span>"</span></span> <span class="quoted"><span class="quoted">"enabled <span class="free">cfg</span> <span class="free">m'</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> StepP StepWithoutP CaseM InMsg <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> msgCfg <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">" <span class="main">(</span><span class="free">sends</span> <span class="skolem">q</span> <span class="main">(</span>states <span class="free">cfg</span> <span class="skolem">q</span><span class="main">)</span> <span class="main">(</span>Bool <span class="skolem">b'</span><span class="main">)</span> 
                         <span class="main">∪#</span> <span class="main">(</span>msgs <span class="free">cfg1</span> <span class="main">-#</span> <span class="main">&lt;</span><span class="skolem">q</span><span class="main">,</span> <span class="keyword1">inM</span> <span class="skolem">b'</span><span class="main">&gt;</span><span class="main">)</span><span class="main">)</span> 
                       <span class="main">=</span> <span class="main">(</span><span class="free">sends</span> <span class="skolem">p</span> <span class="main">(</span>states <span class="free">cfg</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">(</span>Value <span class="skolem">v</span><span class="main">)</span> 
                         <span class="main">∪#</span> <span class="main">(</span>msgs <span class="free">cfg2</span> <span class="main">-#</span> <span class="main">&lt;</span><span class="skolem">p</span><span class="main">,</span> <span class="skolem">v</span><span class="main">&gt;</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> CaseM StepP StepWithoutP Rec' InMsg AXc<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">m'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span>"</span></span> <span class="quoted"><span class="quoted">"msgs <span class="free">cfg</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="free">sends</span> <span class="skolem">q</span> <span class="main">(</span>states <span class="free">cfg</span> <span class="skolem">q</span><span class="main">)</span> <span class="main">(</span>Bool <span class="skolem">b'</span><span class="main">)</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="free">sends</span> <span class="skolem">p</span> <span class="main">(</span>states <span class="free">cfg</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">(</span>Value <span class="skolem">v</span><span class="main">)</span>"</span></span><span class="main">]</span>
          <span class="keyword1"><span class="command">unfolding</span></span> enabled_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Msg <span class="skolem">q</span> <span class="skolem">v'</span><span class="main">)</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">cfg'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">cfg'</span> <span class="main">=</span> <span class="main">⦇</span>states <span class="main">=</span> <span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="main">(</span>
      <span class="keyword1">if</span> <span class="bound">s</span> <span class="main">=</span> <span class="skolem">q</span> <span class="keyword1">then</span>
        <span class="free">trans</span> <span class="skolem">q</span> <span class="main">(</span>states <span class="free">cfg</span> <span class="skolem">q</span><span class="main">)</span> <span class="main">(</span>Value <span class="skolem">v'</span><span class="main">)</span>
      <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="bound">s</span> <span class="main">=</span> <span class="skolem">p</span> <span class="keyword1">then</span>
        <span class="free">trans</span> <span class="skolem">p</span> <span class="main">(</span>states <span class="free">cfg</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">(</span>Value <span class="skolem">v</span><span class="main">)</span>
      <span class="keyword1">else</span>
        states <span class="free">cfg</span> <span class="bound">s</span><span class="main">)</span><span class="main">,</span>
      msgs <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">sends</span> <span class="skolem">q</span> <span class="main">(</span>states <span class="free">cfg</span> <span class="skolem">q</span><span class="main">)</span> <span class="main">(</span>Value <span class="skolem">v'</span><span class="main">)</span><span class="main">)</span> 
        <span class="main">∪#</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free">sends</span> <span class="skolem">p</span> <span class="main">(</span>states <span class="free">cfg</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">(</span>Value <span class="skolem">v</span><span class="main">)</span><span class="main">)</span>
        <span class="main">∪#</span> <span class="main">(</span><span class="main">(</span>msgs <span class="free">cfg</span><span class="main">)</span><span class="main">-#</span> <span class="free">m</span><span class="main">)</span><span class="main">)</span>
        <span class="main">-#</span> <span class="free">m'</span><span class="main">)</span><span class="main">)</span><span class="main">⦈</span> "</span></span>
    <span class="keyword1"><span class="command">hence</span></span> StepP'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">cfg1</span> <span class="main">⊢</span> <span class="free">m'</span> <span class="main">↦</span> <span class="skolem">cfg'</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> StepP Msg EnM' Rec CaseM <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> EnM <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">cfg2</span> <span class="main">⊢</span> <span class="free">m</span> <span class="main">↦</span> <span class="skolem">cfg'</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Msg cfg'_def StepP StepP' StepWithoutP NoReceivingNoChange Rec' CaseM EnM'
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">clarify</span><span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> msgCfg<span class="main">:</span>
        <span class="quoted"><span class="quoted">"msgs <span class="free">cfg1</span> <span class="main">=</span> <span class="main">(</span><span class="free">sends</span> <span class="skolem">p</span> <span class="main">(</span>states <span class="free">cfg</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">(</span>Value <span class="skolem">v</span><span class="main">)</span>
          <span class="main">∪#</span> <span class="main">(</span>msgs <span class="free">cfg</span> <span class="main">-#</span> <span class="main">&lt;</span><span class="skolem">p</span><span class="main">,</span> <span class="skolem">v</span><span class="main">&gt;</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="quoted"><span class="quoted">"msgs <span class="free">cfg2</span> <span class="main">=</span> <span class="main">(</span><span class="free">sends</span> <span class="skolem">q</span> <span class="main">(</span>states <span class="free">cfg</span> <span class="skolem">q</span><span class="main">)</span> <span class="main">(</span>Value <span class="skolem">v'</span><span class="main">)</span>
          <span class="main">∪#</span> <span class="main">(</span>msgs <span class="free">cfg</span> <span class="main">-#</span> <span class="main">&lt;</span><span class="skolem">q</span><span class="main">,</span> <span class="skolem">v'</span><span class="main">&gt;</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"enabled <span class="free">cfg</span> <span class="free">m</span>"</span></span> <span class="quoted"><span class="quoted">"enabled <span class="free">cfg</span> <span class="free">m'</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> StepP StepWithoutP CaseM Msg <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

      <span class="keyword1"><span class="command">with</span></span> msgCfg <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">" <span class="main">(</span><span class="free">sends</span> <span class="skolem">q</span> <span class="main">(</span>states <span class="free">cfg</span> <span class="skolem">q</span><span class="main">)</span> <span class="main">(</span>Value <span class="skolem">v'</span><span class="main">)</span> 
                         <span class="main">∪#</span> <span class="main">(</span>msgs <span class="free">cfg1</span> <span class="main">-#</span> <span class="main">&lt;</span><span class="skolem">q</span><span class="main">,</span> <span class="skolem">v'</span><span class="main">&gt;</span><span class="main">)</span><span class="main">)</span> 
                       <span class="main">=</span> <span class="main">(</span><span class="free">sends</span> <span class="skolem">p</span> <span class="main">(</span>states <span class="free">cfg</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">(</span>Value <span class="skolem">v</span><span class="main">)</span> 
                         <span class="main">∪#</span> <span class="main">(</span>msgs <span class="free">cfg2</span> <span class="main">-#</span> <span class="main">&lt;</span><span class="skolem">p</span><span class="main">,</span> <span class="skolem">v</span><span class="main">&gt;</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> CaseM StepP StepWithoutP Rec' Msg 
          AXc<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">m'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span>"</span></span> <span class="quoted"><span class="quoted">"msgs <span class="free">cfg</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">sends</span> <span class="skolem">q</span> <span class="main">(</span>states <span class="free">cfg</span> <span class="skolem">q</span><span class="main">)</span> <span class="main">(</span>Value <span class="skolem">v'</span><span class="main">)</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="free">sends</span> <span class="skolem">p</span> <span class="main">(</span>states <span class="free">cfg</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">(</span>Value <span class="skolem">v</span><span class="main">)</span>"</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">unfolding</span></span> enabled_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>          
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="AsynchronousSystem-DiamondTwo"><span class="command">lemma</span></span> DiamondTwo<span class="main">:</span>
<span class="keyword2"><span class="keyword">fixes</span></span>
  <span class="free">cfg</span> <span class="free">cfg1</span> <span class="free">cfg2</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'p</span><span class="main">,</span><span class="tfree">'v</span><span class="main">,</span><span class="tfree">'s</span><span class="main">)</span> configuration"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">Q</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'p</span> set"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">msg</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'p</span><span class="main">,</span> <span class="tfree">'v</span><span class="main">)</span> message"</span></span>
<span class="keyword2"><span class="keyword">assumes</span></span>
  QReach<span class="main">:</span> <span class="quoted"><span class="quoted">"qReachable <span class="free">cfg</span> <span class="free">Q</span> <span class="free">cfg1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  Step<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">cfg</span>  <span class="main">⊢</span> <span class="free">msg</span> <span class="main">↦</span> <span class="free">cfg2</span>"</span></span>
        <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">p</span><span class="main">∈</span>Proc <span class="main">-</span> <span class="free">Q</span><span class="main">.</span> isReceiverOf <span class="bound">p</span> <span class="free">msg</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="main">(</span><span class="bound">cfg'</span> <span class="main">::</span> <span class="main">(</span><span class="tfree">'p</span><span class="main">,</span><span class="tfree">'v</span><span class="main">,</span><span class="tfree">'s</span><span class="main">)</span> configuration<span class="main">)</span> <span class="main">.</span> <span class="main">(</span><span class="free">cfg1</span>  <span class="main">⊢</span> <span class="free">msg</span> <span class="main">↦</span> <span class="bound">cfg'</span><span class="main">)</span> 
  <span class="main">∧</span> qReachable <span class="free">cfg2</span> <span class="free">Q</span> <span class="bound">cfg'</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms 
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> qReachable.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">cfg</span> <span class="skolem">Q</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"qReachable <span class="free">cfg2</span> <span class="skolem">Q</span> <span class="free">cfg2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> qReachable.simps<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">cfg</span> <span class="main">⊢</span> <span class="free">msg</span> <span class="main">↦</span> <span class="free">cfg2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">p</span><span class="main">∈</span>UNIV <span class="main">-</span> <span class="skolem">Q</span><span class="main">.</span> isReceiverOf <span class="bound">p</span> <span class="free">msg</span>"</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">cfg</span> <span class="main">⊢</span> <span class="free">msg</span> <span class="main">↦</span> <span class="free">cfg2</span><span class="main">)</span> <span class="main">∧</span> qReachable <span class="free">cfg2</span> <span class="skolem">Q</span> <span class="free">cfg2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">cfg'</span><span class="main">.</span><span class="main">(</span><span class="skolem">cfg</span> <span class="main">⊢</span> <span class="free">msg</span> <span class="main">↦</span> <span class="bound">cfg'</span><span class="main">)</span> <span class="main">∧</span> qReachable <span class="free">cfg2</span> <span class="skolem">Q</span> <span class="bound">cfg'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">cfg</span> <span class="skolem">Q</span> <span class="skolem">cfg1'</span> <span class="skolem">msga</span> <span class="skolem">cfg1</span>
  <span class="keyword3"><span class="command">assume</span></span>   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">cfg</span> <span class="main">⊢</span> <span class="free">msg</span> <span class="main">↦</span> <span class="free">cfg2</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">p</span><span class="main">∈</span>UNIV <span class="main">-</span> <span class="skolem">Q</span><span class="main">.</span> isReceiverOf <span class="bound">p</span> <span class="free">msg</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="skolem">cfg</span> <span class="main">⊢</span> <span class="free">msg</span> <span class="main">↦</span> <span class="free">cfg2</span><span class="main">)</span> <span class="main">⟹</span>
     <span class="main">(</span><span class="main">∃</span><span class="bound">p</span><span class="main">∈</span>UNIV <span class="main">-</span> <span class="skolem">Q</span><span class="main">.</span> isReceiverOf <span class="bound">p</span> <span class="free">msg</span><span class="main">)</span> <span class="main">⟹</span>
     <span class="main">(</span><span class="main">∃</span><span class="bound">cfg'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">cfg1'</span> <span class="main">⊢</span> <span class="free">msg</span> <span class="main">↦</span> <span class="bound">cfg'</span><span class="main">)</span> <span class="main">∧</span> qReachable <span class="free">cfg2</span> <span class="skolem">Q</span> <span class="bound">cfg'</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">cfg'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">cfg1'</span> <span class="main">⊢</span> <span class="free">msg</span> <span class="main">↦</span> <span class="bound">cfg'</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">p</span><span class="main">∈</span>UNIV <span class="main">-</span> <span class="skolem">Q</span><span class="main">.</span> isReceiverOf <span class="bound">p</span> <span class="free">msg</span><span class="main">)</span> 
        <span class="main">∧</span> qReachable <span class="free">cfg2</span> <span class="skolem">Q</span> <span class="bound">cfg'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">cfg'</span></span> <span class="keyword2"><span class="keyword">where</span></span> Cfg'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">cfg1'</span> <span class="main">⊢</span> <span class="free">msg</span> <span class="main">↦</span> <span class="skolem">cfg'</span><span class="main">)</span>"</span></span> 
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">p</span><span class="main">∈</span>UNIV <span class="main">-</span> <span class="skolem">Q</span><span class="main">.</span> isReceiverOf <span class="bound">p</span> <span class="free">msg</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"qReachable <span class="free">cfg2</span> <span class="skolem">Q</span> <span class="skolem">cfg'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> P<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span><span class="main">∈</span>UNIV <span class="main">-</span> <span class="skolem">Q</span>"</span></span> <span class="quoted"><span class="quoted">"isReceiverOf <span class="skolem">p</span> <span class="free">msg</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">assume</span></span> Step2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">cfg1'</span> <span class="main">⊢</span> <span class="skolem">msga</span> <span class="main">↦</span> <span class="skolem">cfg1</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">p</span><span class="main">∈</span><span class="skolem">Q</span><span class="main">.</span> isReceiverOf <span class="bound">p</span> <span class="skolem">msga</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span>qReachable <span class="skolem">cfg</span> <span class="skolem">Q</span> <span class="skolem">cfg1'</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p'</span></span> <span class="keyword2"><span class="keyword">where</span></span> P'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p'</span><span class="main">∈</span><span class="skolem">Q</span>"</span></span> <span class="quoted"><span class="quoted">"isReceiverOf <span class="skolem">p'</span> <span class="skolem">msga</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> P'<span class="main">(</span>1<span class="main">)</span> P<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> notEq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">≠</span> <span class="skolem">p'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">with</span></span> P<span class="main">(</span>2<span class="main">)</span> P'<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> isReceiverOf <span class="skolem">p'</span> <span class="free">msg</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> isReceiverOf <span class="skolem">p</span> <span class="skolem">msga</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> UniqueReceiverOf<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">p'</span></span> <span class="quoted"><span class="skolem">msga</span></span> <span class="quoted"><span class="skolem">p</span></span><span class="main">]</span> UniqueReceiverOf<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">p</span></span> <span class="quoted"><span class="free">msg</span></span> <span class="quoted"><span class="skolem">p'</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> notEq P'<span class="main">(</span>2<span class="main">)</span> P<span class="main">(</span>2<span class="main">)</span> Cfg'<span class="main">(</span>1<span class="main">)</span> Step2<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> 
    <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">cfg''</span><span class="main">.</span> <span class="main">(</span><span class="skolem">cfg'</span> <span class="main">⊢</span> <span class="skolem">msga</span> <span class="main">↦</span> <span class="bound">cfg''</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">cfg1</span> <span class="main">⊢</span> <span class="free">msg</span> <span class="main">↦</span> <span class="bound">cfg''</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> DiamondOne <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">cfg''</span></span> <span class="keyword2"><span class="keyword">where</span></span> Cfg''<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">cfg'</span> <span class="main">⊢</span> <span class="skolem">msga</span> <span class="main">↦</span> <span class="skolem">cfg''</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">cfg1</span> <span class="main">⊢</span> <span class="free">msg</span> <span class="main">↦</span> <span class="skolem">cfg''</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> Cfg''<span class="main">(</span>1<span class="main">)</span> Step2<span class="main">(</span>2<span class="main">)</span> Cfg'<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"qReachable <span class="free">cfg2</span> <span class="skolem">Q</span> <span class="skolem">cfg''</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> qReachable.simps<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">cfg2</span></span> <span class="quoted"><span class="skolem">Q</span></span> <span class="quoted"><span class="skolem">cfg''</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> Cfg'<span class="main">(</span>2<span class="main">)</span> Cfg''<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> 
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">cfg1</span> <span class="main">⊢</span> <span class="free">msg</span> <span class="main">↦</span> <span class="skolem">cfg''</span><span class="main">)</span> <span class="main">∧</span> qReachable <span class="free">cfg2</span> <span class="skolem">Q</span> <span class="skolem">cfg''</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">cfg'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">cfg1</span> <span class="main">⊢</span> <span class="free">msg</span> <span class="main">↦</span> <span class="bound">cfg'</span><span class="main">)</span> <span class="main">∧</span> qReachable <span class="free">cfg2</span> <span class="skolem">Q</span> <span class="bound">cfg'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Proposition 1 of Völzer.›</span></span>
<span class="keyword1" id="AsynchronousSystem-Diamond"><span class="command">lemma</span></span> Diamond<span class="main">:</span>
<span class="keyword2"><span class="keyword">fixes</span></span>
  <span class="free">cfg</span> <span class="free">cfg1</span> <span class="free">cfg2</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'p</span><span class="main">,</span><span class="tfree">'v</span><span class="main">,</span><span class="tfree">'s</span><span class="main">)</span> configuration"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">Q</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'p</span> set"</span></span>
<span class="keyword2"><span class="keyword">assumes</span></span>
  QReach<span class="main">:</span> <span class="quoted"><span class="quoted">"qReachable <span class="free">cfg</span> <span class="free">Q</span> <span class="free">cfg1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  WithoutQReach<span class="main">:</span> <span class="quoted"><span class="quoted">"withoutQReachable <span class="free">cfg</span> <span class="free">Q</span> <span class="free">cfg2</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> 
  <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">cfg'</span><span class="main">.</span> withoutQReachable <span class="free">cfg1</span> <span class="free">Q</span> <span class="bound">cfg'</span> 
     <span class="main">∧</span> qReachable <span class="free">cfg2</span> <span class="free">Q</span> <span class="bound">cfg'</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">notQ</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">notQ</span> <span class="main">≡</span> UNIV <span class="main">-</span> <span class="free">Q</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> WithoutQReach <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"qReachable <span class="free">cfg</span> <span class="skolem">notQ</span> <span class="free">cfg2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> QReach notQ_def
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> qReachable.induct<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">cfg2</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"qReachable <span class="skolem">cfg2</span> <span class="free">Q</span> <span class="free">cfg1</span>"</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"qReachable <span class="free">cfg1</span> <span class="main">(</span>UNIV <span class="main">-</span> <span class="free">Q</span><span class="main">)</span> <span class="free">cfg1</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> qReachable.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> 
      <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">cfg'</span><span class="main">.</span> qReachable <span class="free">cfg1</span> <span class="main">(</span>UNIV <span class="main">-</span> <span class="free">Q</span><span class="main">)</span> <span class="bound">cfg'</span> 
        <span class="main">∧</span> qReachable <span class="skolem">cfg2</span> <span class="free">Q</span> <span class="bound">cfg'</span>"</span></span>  
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">cfg</span> <span class="skolem">cfg2'</span> <span class="skolem">cfg2</span> <span class="skolem">msg</span>
    <span class="keyword3"><span class="command">assume</span></span> Ass1<span class="main">:</span> <span class="quoted"><span class="quoted">" qReachable <span class="skolem">cfg</span> <span class="free">Q</span> <span class="free">cfg1</span>"</span></span> <span class="quoted"><span class="quoted">"qReachable <span class="skolem">cfg</span> <span class="main">(</span>UNIV <span class="main">-</span> <span class="free">Q</span><span class="main">)</span> <span class="skolem">cfg2'</span> "</span></span> 
    <span class="keyword3"><span class="command">assume</span></span> Ass2<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="skolem">cfg2'</span> <span class="main">⊢</span> <span class="skolem">msg</span> <span class="main">↦</span> <span class="skolem">cfg2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">p</span><span class="main">∈</span>UNIV <span class="main">-</span> <span class="free">Q</span><span class="main">.</span> isReceiverOf <span class="bound">p</span> <span class="skolem">msg</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"qReachable <span class="skolem">cfg</span> <span class="free">Q</span> <span class="free">cfg1</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">cfg'</span><span class="main">.</span> qReachable <span class="free">cfg1</span> <span class="main">(</span>UNIV <span class="main">-</span> <span class="free">Q</span><span class="main">)</span> <span class="bound">cfg'</span> 
      <span class="main">∧</span> qReachable <span class="skolem">cfg2'</span> <span class="free">Q</span> <span class="bound">cfg'</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> Ass1<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">cfg'</span><span class="main">.</span> qReachable <span class="free">cfg1</span> <span class="main">(</span>UNIV <span class="main">-</span> <span class="free">Q</span><span class="main">)</span> <span class="bound">cfg'</span> 
      <span class="main">∧</span> qReachable <span class="skolem">cfg2'</span> <span class="free">Q</span> <span class="bound">cfg'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">cfg'</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
      Cfg'1<span class="main">:</span> <span class="quoted"><span class="quoted">"qReachable <span class="skolem">cfg2'</span> <span class="free">Q</span> <span class="skolem">cfg'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
      Cfg'<span class="main">:</span>  <span class="quoted"><span class="quoted">"qReachable <span class="free">cfg1</span> <span class="main">(</span>UNIV <span class="main">-</span> <span class="free">Q</span><span class="main">)</span> <span class="skolem">cfg'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> Cfg'1 Ass2 <span class="keyword1"><span class="command">have</span></span> 
      <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">cfg''</span><span class="main">.</span><span class="main">(</span><span class="skolem">cfg'</span> <span class="main">⊢</span> <span class="skolem">msg</span> <span class="main">↦</span> <span class="bound">cfg''</span><span class="main">)</span> <span class="main">∧</span> qReachable <span class="skolem">cfg2</span> <span class="free">Q</span> <span class="bound">cfg''</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> DiamondTwo <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">cfg''</span></span> <span class="keyword2"><span class="keyword">where</span></span>
      Cfg''<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">cfg'</span> <span class="main">⊢</span> <span class="skolem">msg</span> <span class="main">↦</span> <span class="skolem">cfg''</span>"</span></span> <span class="quoted"><span class="quoted">"qReachable <span class="skolem">cfg2</span> <span class="free">Q</span> <span class="skolem">cfg''</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> Cfg' Cfg''<span class="main">(</span>1<span class="main">)</span> Ass2<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"qReachable <span class="free">cfg1</span> <span class="main">(</span>UNIV <span class="main">-</span> <span class="free">Q</span><span class="main">)</span> <span class="skolem">cfg''</span>"</span></span>  
      <span class="keyword1"><span class="command">using</span></span> qReachable.simps<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">cfg1</span></span> <span class="quoted"><span class="quoted">"UNIV<span class="main">-</span><span class="free">Q</span>"</span></span> <span class="quoted"><span class="skolem">cfg''</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> Cfg'' <span class="keyword3"><span class="command">show</span></span> 
      <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">cfg'</span><span class="main">.</span> qReachable <span class="free">cfg1</span> <span class="main">(</span>UNIV <span class="main">-</span> <span class="free">Q</span><span class="main">)</span> <span class="bound">cfg'</span> 
        <span class="main">∧</span> qReachable <span class="skolem">cfg2</span> <span class="free">Q</span> <span class="bound">cfg'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Invariant finite message count›</span></span>

<span class="keyword1" id="AsynchronousSystem-FiniteMessages"><span class="command">lemma</span></span> FiniteMessages<span class="main">:</span>
<span class="keyword2"><span class="keyword">fixes</span></span> 
  <span class="free">cfg</span>  <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'p</span><span class="main">,</span> <span class="tfree">'v</span><span class="main">,</span> <span class="tfree">'s</span><span class="main">)</span> configuration"</span></span>
<span class="keyword2"><span class="keyword">assumes</span></span>
  FiniteProcs<span class="main">:</span> <span class="quoted"><span class="quoted">"finite Proc"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  FiniteSends<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">p</span> <span class="bound">s</span> <span class="bound">m</span><span class="main">.</span> finite <span class="main">{</span><span class="bound">v</span><span class="main">.</span> <span class="bound">v</span> <span class="main">∈#</span> <span class="main">(</span><span class="free">sends</span> <span class="bound">p</span> <span class="bound">s</span> <span class="bound">m</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  InitReachable<span class="main">:</span> <span class="quoted"><span class="quoted">"initReachable <span class="free">cfg</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound">msg</span> <span class="main">.</span> <span class="bound">msg</span> <span class="main">∈#</span> msgs <span class="free">cfg</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">-</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">init</span> <span class="main">.</span> initial <span class="bound">init</span> <span class="main">∧</span> reachable <span class="bound">init</span> <span class="free">cfg</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms 
    <span class="keyword1"><span class="command">unfolding</span></span> initReachable_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">init</span></span> <span class="keyword2"><span class="keyword">where</span></span> Init<span class="main">:</span> <span class="quoted"><span class="quoted">"initial <span class="skolem">init</span>"</span></span> <span class="quoted"><span class="quoted">"reachable <span class="skolem">init</span> <span class="free">cfg</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> InitMsgs<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">msg</span> <span class="main">.</span> <span class="bound">msg</span> <span class="main">∈#</span> msgs <span class="skolem">init</span><span class="main">}</span> 
    <span class="main">=</span> <span class="main">{</span> <span class="bound">msg</span> <span class="main">.</span> <span class="main">(</span><span class="bound">msg</span> <span class="main">∈#</span> msgs <span class="skolem">init</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">p</span> <span class="bound">v</span><span class="main">.</span> <span class="main">&lt;</span><span class="bound">p</span><span class="main">,</span> <span class="bound">v</span><span class="main">&gt;</span> <span class="main">=</span> <span class="bound">msg</span><span class="main">)</span><span class="main">}</span> 
      <span class="main">∪</span> <span class="main">{</span> <span class="bound">msg</span> <span class="main">.</span> <span class="main">(</span><span class="bound">msg</span> <span class="main">∈#</span> msgs <span class="skolem">init</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">v</span><span class="main">.</span>  <span class="main">&lt;⊥,</span> <span class="keyword1">outM</span> <span class="bound">v</span><span class="main">&gt;</span> <span class="main">=</span> <span class="bound">msg</span><span class="main">)</span><span class="main">}</span>
      <span class="main">∪</span> <span class="main">{</span> <span class="bound">msg</span> <span class="main">.</span> <span class="main">(</span><span class="bound">msg</span> <span class="main">∈#</span> msgs <span class="skolem">init</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">p</span> <span class="bound">v</span><span class="main">.</span>  <span class="main">&lt;</span><span class="bound">p</span><span class="main">,</span> <span class="keyword1">inM</span> <span class="bound">v</span><span class="main">&gt;</span> <span class="main">=</span> <span class="bound">msg</span><span class="main">)</span><span class="main">}</span>"</span></span> 
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span><span class="operator">metis</span> message.exhaust<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> A<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">{</span> <span class="bound">msg</span> <span class="main">.</span> <span class="main">(</span><span class="bound">msg</span> <span class="main">∈#</span> msgs <span class="skolem">init</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">p</span> <span class="bound">v</span><span class="main">.</span> <span class="main">&lt;</span><span class="bound">p</span><span class="main">,</span> <span class="bound">v</span><span class="main">&gt;</span> <span class="main">=</span> <span class="bound">msg</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> initial_def<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">init</span></span><span class="main">]</span> Init<span class="main">(</span>1<span class="main">)</span><span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> less_not_refl3<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> B<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">{</span> <span class="bound">msg</span> <span class="main">.</span> <span class="main">(</span><span class="bound">msg</span> <span class="main">∈#</span> msgs <span class="skolem">init</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">v</span><span class="main">.</span>  <span class="main">&lt;⊥,</span> <span class="keyword1">outM</span> <span class="bound">v</span><span class="main">&gt;</span> <span class="main">=</span> <span class="bound">msg</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> initial_def<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">init</span></span><span class="main">]</span> Init<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> less_not_refl3<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">p</span> <span class="main">.</span> finite <span class="main">{</span><span class="main">&lt;</span><span class="bound">p</span><span class="main">,</span> <span class="keyword1">inM</span> True<span class="main">&gt;</span><span class="main">,</span> <span class="main">&lt;</span><span class="bound">p</span><span class="main">,</span> <span class="keyword1">inM</span> False<span class="main">&gt;</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> SubsetMsg<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">p</span><span class="main">.</span> <span class="main">{</span> <span class="bound">msg</span> <span class="main">.</span> <span class="main">(</span><span class="bound">msg</span> <span class="main">∈#</span> msgs <span class="skolem">init</span><span class="main">)</span> 
      <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">v</span><span class="main">::</span>bool <span class="main">.</span>  <span class="main">&lt;</span><span class="bound">p</span><span class="main">,</span> <span class="keyword1">inM</span> <span class="bound">v</span><span class="main">&gt;</span> <span class="main">=</span> <span class="bound">msg</span><span class="main">)</span><span class="main">}</span> 
      <span class="main">⊆</span> <span class="main">{</span><span class="main">&lt;</span><span class="bound">p</span><span class="main">,</span> <span class="keyword1">inM</span> True<span class="main">&gt;</span><span class="main">,</span> <span class="main">&lt;</span><span class="bound">p</span><span class="main">,</span> <span class="keyword1">inM</span> False<span class="main">&gt;</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> AllFinite<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">p</span><span class="main">.</span> finite <span class="main">{</span> <span class="bound">msg</span> <span class="main">.</span> <span class="main">(</span><span class="bound">msg</span> <span class="main">∈#</span> msgs <span class="skolem">init</span><span class="main">)</span> 
      <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">v</span><span class="main">::</span>bool <span class="main">.</span>  <span class="main">&lt;</span><span class="bound">p</span><span class="main">,</span> <span class="keyword1">inM</span> <span class="bound">v</span><span class="main">&gt;</span> <span class="main">=</span> <span class="bound">msg</span><span class="main">)</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> finite_subset <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" <span class="main">{</span> <span class="bound">msg</span> <span class="main">.</span> <span class="main">(</span><span class="bound">msg</span> <span class="main">∈#</span> msgs <span class="skolem">init</span><span class="main">)</span> 
    <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">p</span><span class="main">∈</span>Proc <span class="main">.</span> <span class="main">∃</span> <span class="bound">v</span><span class="main">::</span>bool<span class="main">.</span>  <span class="main">&lt;</span><span class="bound">p</span><span class="main">,</span> <span class="keyword1">inM</span> <span class="bound">v</span><span class="main">&gt;</span> <span class="main">=</span> <span class="bound">msg</span><span class="main">)</span><span class="main">}</span> 
      <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span> <span class="bound">p</span> <span class="main">∈</span> Proc <span class="main">.</span> <span class="main">{</span> <span class="bound">msg</span> <span class="main">.</span> <span class="main">(</span><span class="bound">msg</span> <span class="main">∈#</span> msgs <span class="skolem">init</span><span class="main">)</span> 
    <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">v</span><span class="main">::</span>bool <span class="main">.</span>  <span class="main">&lt;</span><span class="bound">p</span><span class="main">,</span> <span class="keyword1">inM</span> <span class="bound">v</span><span class="main">&gt;</span> <span class="main">=</span> <span class="bound">msg</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"finite  <span class="main">{</span> <span class="bound">msg</span> <span class="main">.</span> <span class="main">(</span><span class="bound">msg</span> <span class="main">∈#</span> msgs <span class="skolem">init</span><span class="main">)</span> 
    <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">p</span><span class="main">∈</span>Proc <span class="main">.</span> <span class="main">∃</span> <span class="bound">v</span><span class="main">::</span>bool<span class="main">.</span>  <span class="main">&lt;</span><span class="bound">p</span><span class="main">,</span> <span class="keyword1">inM</span> <span class="bound">v</span><span class="main">&gt;</span> <span class="main">=</span> <span class="bound">msg</span><span class="main">)</span><span class="main">}</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> AllFinite FiniteProcs <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> InitFinite<span class="main">:</span><span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound">msg</span> <span class="main">.</span> <span class="bound">msg</span> <span class="main">∈#</span> msgs <span class="skolem">init</span><span class="main">}</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> A B InitMsgs<span class="main">)</span> 
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> Init<span class="main">(</span>2<span class="main">)</span> InitFinite
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> reachable.induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">cfg1</span> <span class="skolem">cfg2</span> <span class="skolem">msg</span> <span class="skolem">cfg3</span>
    <span class="keyword3"><span class="command">assume</span></span> assmsInduct<span class="main">:</span><span class="quoted"><span class="quoted">"reachable <span class="skolem">cfg1</span> <span class="skolem">cfg2</span>"</span></span> 
      <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound">msg</span><span class="main">.</span> <span class="bound">msg</span> <span class="main">∈#</span> msgs <span class="skolem">cfg2</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">cfg2</span> <span class="main">⊢</span> <span class="skolem">msg</span> <span class="main">↦</span> <span class="skolem">cfg3</span>"</span></span> 
      <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound">msg</span><span class="main">.</span> <span class="bound">msg</span> <span class="main">∈#</span> msgs <span class="skolem">cfg1</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"reachable <span class="skolem">init</span> <span class="free">cfg</span>"</span></span> 
      <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound">msg</span><span class="main">.</span> <span class="bound">msg</span> <span class="main">∈#</span> msgs <span class="skolem">init</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> assmsInduct<span class="main">(</span>3<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"isReceiverOf <span class="skolem">p</span> <span class="skolem">msg</span> "</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> StepOutMsg isReceiverOf.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> isReceiverOf.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> 
       message.exhaust<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"msgs <span class="skolem">cfg3</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>msgs <span class="skolem">cfg2</span> <span class="main">-#</span> <span class="skolem">msg</span><span class="main">)</span> <span class="main">∪#</span> <span class="main">(</span><span class="free">sends</span> <span class="skolem">p</span> <span class="main">(</span>states <span class="skolem">cfg2</span> <span class="skolem">p</span><span class="main">)</span> 
      <span class="main">(</span>unpackMessage <span class="skolem">msg</span><span class="main">)</span> <span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> assmsInduct<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">msg</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add.commute<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> MsgSet<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">msg</span><span class="main">.</span> <span class="bound">msg</span> <span class="main">∈#</span>  msgs <span class="skolem">cfg3</span> <span class="main">}</span> 
      <span class="main">=</span> <span class="main">{</span><span class="bound">m</span><span class="main">.</span> <span class="bound">m</span> <span class="main">∈#</span> <span class="main">(</span><span class="main">(</span>msgs <span class="skolem">cfg2</span> <span class="main">-#</span> <span class="skolem">msg</span><span class="main">)</span> <span class="main">∪#</span> <span class="main">(</span><span class="free">sends</span> <span class="skolem">p</span> <span class="main">(</span>states <span class="skolem">cfg2</span> <span class="skolem">p</span><span class="main">)</span> 
        <span class="main">(</span>unpackMessage <span class="skolem">msg</span><span class="main">)</span> <span class="main">)</span><span class="main">)</span> <span class="main">}</span> "</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">v</span><span class="main">.</span> <span class="bound">v</span> <span class="main">∈#</span> <span class="main">(</span>msgs <span class="skolem">cfg2</span> <span class="main">-#</span> <span class="skolem">msg</span><span class="main">)</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound">msg</span><span class="main">.</span> <span class="bound">msg</span> <span class="main">∈#</span> msgs <span class="skolem">cfg2</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> finite_subset<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound">v</span><span class="main">.</span> <span class="main">(</span><span class="bound">v</span> <span class="main">∈#</span> <span class="free">sends</span> <span class="skolem">p</span> <span class="main">(</span>states <span class="skolem">cfg2</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">(</span>unpackMessage <span class="skolem">msg</span><span class="main">)</span><span class="main">)</span>
        <span class="main">∨</span> <span class="main">(</span><span class="bound">v</span> <span class="main">∈#</span> <span class="main">(</span>msgs <span class="skolem">cfg2</span> <span class="main">-#</span> <span class="skolem">msg</span><span class="main">)</span><span class="main">)</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> FiniteSends assmsInduct<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound">msg</span><span class="main">.</span> <span class="bound">msg</span> <span class="main">∈#</span> msgs <span class="skolem">cfg3</span><span class="main">}</span>"</span></span>
       <span class="keyword1"><span class="command">unfolding</span></span> MsgSet <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="ListUtilities">
<div class="head">
<h1>Theory ListUtilities</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹ListUtilities›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  \file{ListUtilities} defines a (proper) prefix relation for lists, and proves some
  additional lemmata, mostly about lists.
›</span></span>

<span class="keyword1"><span class="command">theory</span></span> ListUtilities
<span class="keyword2"><span class="keyword">imports</span></span> <a href="../../HOL/HOL/Main.html">Main</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹List Prefixes›</span></span>

<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">prefixList</span> <span class="main">::</span>
  <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> list <span class="main">⇒</span> <span class="tfree">'a</span> list <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">prefixList</span> <span class="main">[]</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">prefixList</span> <span class="free"><span class="bound"><span class="entity">xa</span></span></span> <span class="free"><span class="bound"><span class="entity">xb</span></span></span> <span class="main">⟹</span> <span class="free">prefixList</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">xa</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">xb</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="ListUtilities-PrefixListHasTail"><span class="command">lemma</span></span> PrefixListHasTail<span class="main">:</span>
<span class="keyword2"><span class="keyword">fixes</span></span> 
  <span class="free">l1</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> list"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">l2</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> list"</span></span>
<span class="keyword2"><span class="keyword">assumes</span></span>
  <span class="quoted"><span class="quoted">"prefixList <span class="free">l1</span> <span class="free">l2</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">l</span> <span class="main">.</span> <span class="free">l2</span> <span class="main">=</span> <span class="free">l1</span> <span class="main">@</span> <span class="bound">l</span> <span class="main">∧</span> <span class="bound">l</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> prefixList.induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="ListUtilities-PrefixListMonotonicity"><span class="command">lemma</span></span> PrefixListMonotonicity<span class="main">:</span>
<span class="keyword2"><span class="keyword">fixes</span></span> 
  <span class="free">l1</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> list"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">l2</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> list"</span></span>
<span class="keyword2"><span class="keyword">assumes</span></span>
  <span class="quoted"><span class="quoted">"prefixList <span class="free">l1</span> <span class="free">l2</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span>
  <span class="quoted"><span class="quoted">"length <span class="free">l1</span> <span class="main">&lt;</span> length <span class="free">l2</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> prefixList.induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="ListUtilities-TailIsPrefixList"><span class="command">lemma</span></span> TailIsPrefixList <span class="main">:</span> 
<span class="keyword2"><span class="keyword">fixes</span></span> 
  <span class="free">l1</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> list"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">tail</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> list"</span></span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">tail</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"prefixList <span class="free">l1</span> <span class="main">(</span><span class="free">l1</span> <span class="main">@</span> <span class="free">tail</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">l1</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">x</span> <span class="bound">xs</span> <span class="main">.</span> <span class="free">tail</span> <span class="main">=</span> <span class="bound">x</span> <span class="main">#</span> <span class="bound">xs</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> neq_Nil_conv<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"prefixList <span class="main">[]</span> <span class="free">tail</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> prefixList.intros<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">l1</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"prefixList <span class="skolem">l1</span> <span class="main">(</span><span class="skolem">l1</span> <span class="main">@</span> <span class="free">tail</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"prefixList <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">l1</span><span class="main">)</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">l1</span> <span class="main">@</span> <span class="free">tail</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> prefixList.intros<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="ListUtilities-PrefixListTransitive"><span class="command">lemma</span></span> PrefixListTransitive<span class="main">:</span>
<span class="keyword2"><span class="keyword">fixes</span></span> 
  <span class="free">l1</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> list"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">l2</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> list"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">l3</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> list"</span></span>
<span class="keyword2"><span class="keyword">assumes</span></span>
  <span class="quoted"><span class="quoted">"prefixList <span class="free">l1</span> <span class="free">l2</span>"</span></span>
  <span class="quoted"><span class="quoted">"prefixList <span class="free">l2</span> <span class="free">l3</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span>
  <span class="quoted"><span class="quoted">"prefixList <span class="free">l1</span> <span class="free">l3</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">l12</span> <span class="main">.</span> <span class="free">l2</span> <span class="main">=</span> <span class="free">l1</span> <span class="main">@</span> <span class="bound">l12</span> <span class="main">∧</span> <span class="bound">l12</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> PrefixListHasTail <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">l12</span></span> <span class="keyword2"><span class="keyword">where</span></span> Extend1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">l2</span> <span class="main">=</span> <span class="free">l1</span> <span class="main">@</span> <span class="skolem">l12</span> <span class="main">∧</span> <span class="skolem">l12</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> Extend2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">l23</span> <span class="main">.</span> <span class="free">l3</span> <span class="main">=</span> <span class="free">l2</span> <span class="main">@</span> <span class="bound">l23</span> <span class="main">∧</span> <span class="bound">l23</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> PrefixListHasTail <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">l23</span></span> <span class="keyword2"><span class="keyword">where</span></span> Extend2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">l3</span> <span class="main">=</span> <span class="free">l2</span> <span class="main">@</span> <span class="skolem">l23</span> <span class="main">∧</span> <span class="skolem">l23</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">l3</span> <span class="main">=</span> <span class="free">l1</span> <span class="main">@</span> <span class="main">(</span><span class="skolem">l12</span> <span class="main">@</span> <span class="skolem">l23</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">l12</span> <span class="main">@</span> <span class="skolem">l23</span><span class="main">)</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> Extend1 Extend2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">l</span> <span class="main">.</span> <span class="free">l3</span> <span class="main">=</span> <span class="free">l1</span> <span class="main">@</span> <span class="bound">l</span> <span class="main">∧</span> <span class="bound">l</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"prefixList <span class="free">l1</span> <span class="free">l3</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> TailIsPrefixList <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Lemmas for lists and nat predicates›</span></span>

<span class="keyword1" id="ListUtilities-NatPredicateTippingPoint"><span class="command">lemma</span></span> NatPredicateTippingPoint<span class="main">:</span>
<span class="keyword2"><span class="keyword">fixes</span></span> 
  <span class="free">n2</span> <span class="free">Pr</span>
<span class="keyword2"><span class="keyword">assumes</span></span>
  Min<span class="main">:</span>     <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">n2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  Pr0<span class="main">:</span>     <span class="quoted"><span class="quoted">"<span class="free">Pr</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  NotPrN2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="free">Pr</span> <span class="free">n2</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">n</span></span><span class="main">&lt;</span><span class="free">n2</span><span class="main">.</span> <span class="free">Pr</span> <span class="bound">n</span> <span class="main">∧</span> <span class="main">¬</span><span class="free">Pr</span> <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span>"</span></span>                       
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> classical<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> Asm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="free">Pr</span> <span class="bound">n</span> <span class="main">⟶</span> <span class="bound">n</span> <span class="main">&lt;</span> <span class="free">n2</span> <span class="main">⟶</span> <span class="free">Pr</span> <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">&lt;</span> <span class="free">n2</span> <span class="main">⟹</span> <span class="free">Pr</span> <span class="bound">n</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&lt;</span> <span class="free">n2</span> <span class="main">⟹</span> <span class="free">Pr</span> <span class="skolem">n</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">n</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Pr0 Asm<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted">False</span>
    <span class="keyword1"><span class="command">using</span></span> Asm<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">n2</span> <span class="main">-</span> <span class="main">1</span>"</span></span><span class="main">]</span> Min NotPrN2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="ListUtilities-MinPredicate"><span class="command">lemma</span></span> MinPredicate<span class="main">:</span>
<span class="keyword2"><span class="keyword">fixes</span></span> 
  <span class="free">P</span><span class="main">::</span><span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">assumes</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">n</span> <span class="main">.</span> <span class="free">P</span> <span class="bound">n</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> 
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span> <span class="bound">n0</span> <span class="main">.</span> <span class="main">(</span><span class="free">P</span> <span class="bound">n0</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">n'</span> <span class="main">.</span> <span class="main">(</span><span class="free">P</span> <span class="bound">n'</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="bound">n'</span> <span class="main">≥</span> <span class="bound">n0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> LeastI2_wellorder Suc_n_not_le_n<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The lemma \isb{MinPredicate2} describes one case of \isb{MinPredicate}
  where the aforementioned smallest element is zero.
›</span></span>

<span class="keyword1" id="ListUtilities-MinPredicate2"><span class="command">lemma</span></span> MinPredicate2<span class="main">:</span>
<span class="keyword2"><span class="keyword">fixes</span></span>
  <span class="free">P</span><span class="main">::</span><span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">assumes</span></span>
 <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">n</span> <span class="main">.</span> <span class="free">P</span> <span class="bound">n</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">n0</span> <span class="main">.</span> <span class="main">(</span><span class="free">P</span> <span class="bound">n0</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">n0</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="main">¬</span> <span class="free">P</span> <span class="main">(</span><span class="bound">n0</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms MinPredicate
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_diff_cancel_right' diff_is_0_eq diff_mult_distrib mult_eq_if<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  \isb{PredicatePairFunction} allows to obtain functions mapping two arguments
  to pairs from 4-ary predicates which are left-total on their first
  two arguments.
›</span></span>

<span class="keyword1" id="ListUtilities-PredicatePairFunction"><span class="command">lemma</span></span> PredicatePairFunction<span class="main">:</span> 
<span class="keyword2"><span class="keyword">fixes</span></span>
  <span class="free">P</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span> <span class="main">⇒</span> <span class="tfree">'c</span> <span class="main">⇒</span> <span class="tfree">'d</span> <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">assumes</span></span>
  A1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x1</span> <span class="bound">x2</span> <span class="main">.</span> <span class="main">∃</span><span class="bound">y1</span> <span class="bound">y2</span> <span class="main">.</span> <span class="main">(</span><span class="free">P</span> <span class="bound">x1</span> <span class="bound">x2</span> <span class="bound">y1</span> <span class="bound">y2</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> 
  <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">f</span> <span class="main">.</span> <span class="main">∀</span><span class="bound">x1</span> <span class="bound">x2</span> <span class="main">.</span> <span class="main">∃</span><span class="bound">y1</span> <span class="bound">y2</span> <span class="main">.</span>
    <span class="main">(</span><span class="bound">f</span> <span class="bound">x1</span> <span class="bound">x2</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">y1</span><span class="main">,</span> <span class="bound">y2</span><span class="main">)</span> 
    <span class="main">∧</span> <span class="main">(</span><span class="free">P</span> <span class="bound">x1</span> <span class="bound">x2</span> <span class="main">(</span>fst <span class="main">(</span><span class="bound">f</span> <span class="bound">x1</span> <span class="bound">x2</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>snd <span class="main">(</span><span class="bound">f</span> <span class="bound">x1</span> <span class="bound">x2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">P'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P'</span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="main">=</span> <span class="free">P</span> <span class="main">(</span>fst <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span>snd <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span>fst <span class="skolem">y</span><span class="main">)</span> <span class="main">(</span>snd <span class="skolem">y</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="main">∃</span><span class="bound">y</span><span class="main">.</span> <span class="skolem">P'</span> <span class="bound">x</span>  <span class="bound">y</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> A1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">f</span><span class="main">.</span> <span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">P'</span> <span class="bound">x</span> <span class="main">(</span><span class="bound">f</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">P'</span> <span class="bound">x</span> <span class="main">(</span><span class="skolem">f</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">f'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f'</span> <span class="skolem">x1</span> <span class="skolem">x2</span> <span class="main">=</span> <span class="skolem">f</span> <span class="main">(</span><span class="skolem">x1</span><span class="main">,</span> <span class="skolem">x2</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x1</span> <span class="skolem">x2</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">P'</span> <span class="bound">x</span> <span class="main">(</span><span class="skolem">f'</span> <span class="main">(</span>fst <span class="bound">x</span><span class="main">)</span> <span class="main">(</span>snd <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">f'</span><span class="main">.</span> <span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">P'</span> <span class="bound">x</span> <span class="main">(</span><span class="bound">f'</span> <span class="main">(</span>fst <span class="bound">x</span><span class="main">)</span> <span class="main">(</span>snd <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> P'_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>           

<span class="keyword1" id="ListUtilities-PredicatePairFunctions2"><span class="command">lemma</span></span> PredicatePairFunctions2<span class="main">:</span> 
<span class="keyword2"><span class="keyword">fixes</span></span>
  <span class="free">P</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span> <span class="main">⇒</span> <span class="tfree">'c</span> <span class="main">⇒</span> <span class="tfree">'d</span> <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">assumes</span></span>
  A1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x1</span> <span class="bound">x2</span> <span class="main">.</span> <span class="main">∃</span><span class="bound">y1</span> <span class="bound">y2</span> <span class="main">.</span> <span class="main">(</span><span class="free">P</span> <span class="bound">x1</span> <span class="bound">x2</span> <span class="bound">y1</span> <span class="bound">y2</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">f1</span> <span class="free">f2</span>  <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x1</span> <span class="bound">x2</span> <span class="main">.</span> <span class="main">∃</span><span class="bound">y1</span> <span class="bound">y2</span> <span class="main">.</span>
    <span class="main">(</span><span class="free">f1</span> <span class="bound">x1</span> <span class="bound">x2</span><span class="main">)</span> <span class="main">=</span> <span class="bound">y1</span> <span class="main">∧</span> <span class="main">(</span><span class="free">f2</span> <span class="bound">x1</span> <span class="bound">x2</span><span class="main">)</span> <span class="main">=</span> <span class="bound">y2</span> 
    <span class="main">∧</span> <span class="main">(</span><span class="free">P</span> <span class="bound">x1</span> <span class="bound">x2</span> <span class="main">(</span><span class="free">f1</span> <span class="bound">x1</span> <span class="bound">x2</span><span class="main">)</span> <span class="main">(</span><span class="free">f2</span> <span class="bound">x1</span> <span class="bound">x2</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">thesis</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> ass<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">f1</span> <span class="bound">f2</span><span class="main">.</span> <span class="main">∀</span><span class="bound">x1</span> <span class="bound">x2</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x1</span> <span class="bound">x2</span> <span class="main">(</span><span class="bound">f1</span> <span class="bound">x1</span> <span class="bound">x2</span><span class="main">)</span> <span class="main">(</span><span class="bound">f2</span> <span class="bound">x1</span> <span class="bound">x2</span><span class="main">)</span> <span class="main">⟹</span> False"</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> F<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x1</span> <span class="bound">x2</span><span class="main">.</span> <span class="main">∃</span><span class="bound">y1</span> <span class="bound">y2</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x1</span> <span class="bound">x2</span> <span class="main">=</span> <span class="main">(</span><span class="bound">y1</span><span class="main">,</span> <span class="bound">y2</span><span class="main">)</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">x1</span> <span class="bound">x2</span> <span class="main">(</span>fst <span class="main">(</span><span class="skolem">f</span> <span class="bound">x1</span> <span class="bound">x2</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>snd <span class="main">(</span><span class="skolem">f</span> <span class="bound">x1</span> <span class="bound">x2</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> PredicatePairFunction<span class="main">[</span><span class="operator">OF</span> A1<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">f1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f1</span> <span class="skolem">x1</span> <span class="skolem">x2</span> <span class="main">=</span> fst <span class="main">(</span><span class="skolem">f</span> <span class="skolem">x1</span> <span class="skolem">x2</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x1</span> <span class="skolem">x2</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">f2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f2</span> <span class="skolem">x1</span> <span class="skolem">x2</span> <span class="main">=</span> snd <span class="main">(</span><span class="skolem">f</span> <span class="skolem">x1</span> <span class="skolem">x2</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x1</span> <span class="skolem">x2</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
    <span class="keyword1"><span class="command">using</span></span> ass<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">f1</span></span> <span class="quoted"><span class="skolem">f2</span></span><span class="main">]</span> F <span class="keyword1"><span class="command">unfolding</span></span> f1_def f2_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="ListUtilities-PredicatePairFunctions2Inv"><span class="command">lemma</span></span> PredicatePairFunctions2Inv<span class="main">:</span> 
<span class="keyword2"><span class="keyword">fixes</span></span>
  <span class="free">P</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span> <span class="main">⇒</span> <span class="tfree">'c</span> <span class="main">⇒</span> <span class="tfree">'d</span> <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">assumes</span></span>
  A1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x1</span> <span class="bound">x2</span> <span class="main">.</span> <span class="main">∃</span><span class="bound">y1</span> <span class="bound">y2</span> <span class="main">.</span> <span class="main">(</span><span class="free">P</span> <span class="bound">x1</span> <span class="bound">x2</span> <span class="bound">y1</span> <span class="bound">y2</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">f1</span> <span class="free">f2</span>  <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x1</span> <span class="bound">x2</span> <span class="main">.</span> <span class="main">(</span><span class="free">P</span> <span class="bound">x1</span> <span class="bound">x2</span> <span class="main">(</span><span class="free">f1</span> <span class="bound">x1</span> <span class="bound">x2</span><span class="main">)</span> <span class="main">(</span><span class="free">f2</span> <span class="bound">x1</span> <span class="bound">x2</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> PredicatePairFunctions2<span class="main">[</span><span class="operator">OF</span> A1<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="ListUtilities-SmallerMultipleStepsWithLimit"><span class="command">lemma</span></span> SmallerMultipleStepsWithLimit<span class="main">:</span>
<span class="keyword2"><span class="keyword">fixes</span></span>
  <span class="free">k</span> <span class="free">A</span> <span class="free">limit</span>
<span class="keyword2"><span class="keyword">assumes</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound"><span class="bound">n</span></span> <span class="main">≥</span> <span class="free">limit</span> <span class="main">.</span> <span class="main">(</span><span class="free">A</span> <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">(</span><span class="free">A</span> <span class="bound">n</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound"><span class="bound">n</span></span> <span class="main">≥</span> <span class="free">limit</span> <span class="main">.</span> <span class="main">(</span><span class="free">A</span> <span class="main">(</span><span class="bound">n</span> <span class="main">+</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="free">A</span> <span class="bound">n</span><span class="main">)</span> <span class="main">-</span> <span class="free">k</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">k</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span> <span class="skolem">k</span>
  <span class="keyword3"><span class="command">assume</span></span> IH<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">n</span></span><span class="main">≥</span><span class="free">limit</span><span class="main">.</span> <span class="free">A</span> <span class="main">(</span><span class="bound">n</span> <span class="main">+</span> <span class="skolem">k</span><span class="main">)</span> <span class="main">≤</span> <span class="free">A</span> <span class="bound">n</span> <span class="main">-</span> <span class="skolem">k</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">limit</span> <span class="main">≤</span> <span class="skolem">n</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">(</span>Suc <span class="main">(</span><span class="skolem">n</span> <span class="main">+</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">A</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">+</span> <span class="skolem">k</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">(</span>Suc <span class="main">(</span><span class="skolem">n</span> <span class="main">+</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">A</span> <span class="skolem">n</span> <span class="main">-</span> <span class="skolem">k</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> IH <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">(</span>Suc <span class="main">(</span><span class="skolem">n</span> <span class="main">+</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="free">A</span> <span class="skolem">n</span> <span class="main">-</span> Suc <span class="skolem">k</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc_lessI add_Suc_right add_diff_cancel_left' 
       less_diff_conv less_or_eq_imp_le add.commute<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="ListUtilities-PrefixSameOnLow"><span class="command">lemma</span></span> PrefixSameOnLow<span class="main">:</span>
<span class="keyword2"><span class="keyword">fixes</span></span>
  <span class="free">l1</span> <span class="free">l2</span>
<span class="keyword2"><span class="keyword">assumes</span></span>
  <span class="quoted"><span class="quoted">"prefixList <span class="free">l1</span> <span class="free">l2</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound"><span class="bound">index</span></span> <span class="main">&lt;</span> length <span class="free">l1</span> <span class="main">.</span> <span class="free">l1</span> <span class="main">!</span> <span class="bound">index</span> <span class="main">=</span> <span class="free">l2</span> <span class="main">!</span> <span class="bound">index</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> prefixList.induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">xa</span> <span class="skolem">xb</span> <span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span> list"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">x</span> <span class="skolem">index</span>
  <span class="keyword3"><span class="command">assume</span></span> AssumpProof<span class="main">:</span> <span class="quoted"><span class="quoted">"prefixList <span class="skolem">xa</span> <span class="skolem">xb</span>"</span></span> 
        <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">index</span></span> <span class="main">&lt;</span> length <span class="skolem">xa</span><span class="main">.</span> <span class="skolem">xa</span> <span class="main">!</span> <span class="bound">index</span> <span class="main">=</span> <span class="skolem">xb</span> <span class="main">!</span> <span class="bound">index</span>"</span></span>
        <span class="quoted"><span class="quoted">"prefixList <span class="free">l1</span> <span class="free">l2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">index</span> <span class="main">&lt;</span> Suc <span class="main">(</span>length <span class="skolem">xa</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span> <span class="main">#</span> <span class="skolem">xa</span><span class="main">)</span> <span class="main">!</span> <span class="skolem">index</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">#</span> <span class="skolem">xb</span><span class="main">)</span> <span class="main">!</span> <span class="skolem">index</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> AssumpProof
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">index</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="ListUtilities-KeepProperty"><span class="command">lemma</span></span> KeepProperty<span class="main">:</span>
<span class="keyword2"><span class="keyword">fixes</span></span>
  <span class="free">P</span> <span class="free">Q</span> <span class="free">low</span>
<span class="keyword2"><span class="keyword">assumes</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound"><span class="bound">i</span></span> <span class="main">≥</span> <span class="free">low</span> <span class="main">.</span> <span class="free">P</span> <span class="bound">i</span> <span class="main">⟶</span> <span class="main">(</span><span class="free">P</span> <span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span> <span class="main">∧</span> <span class="free">Q</span> <span class="bound">i</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="free">low</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound"><span class="bound">i</span></span> <span class="main">≥</span> <span class="free">low</span> <span class="main">.</span> <span class="free">Q</span> <span class="bound">i</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
  <span class="keyword3"><span class="command">assume</span></span> Assump<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">≥</span><span class="free">low</span><span class="main">.</span> <span class="free">P</span> <span class="bound">i</span> <span class="main">⟶</span> <span class="free">P</span> <span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span> <span class="main">∧</span> <span class="free">Q</span> <span class="bound">i</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="free">low</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">low</span> <span class="main">≤</span> <span class="skolem">i</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">≥</span><span class="free">low</span><span class="main">.</span> <span class="free">P</span> <span class="bound">i</span> <span class="main">⟶</span> <span class="free">P</span> <span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound"><span class="bound">i</span></span> <span class="main">≥</span> <span class="free">low</span> <span class="main">.</span> <span class="free">P</span> <span class="bound">i</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Assump<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> dec_induct<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Assump<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Assump <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="ListUtilities-ListLenDrop"><span class="command">lemma</span></span> ListLenDrop<span class="main">:</span> 
<span class="keyword2"><span class="keyword">fixes</span></span>
  <span class="free">i</span> <span class="free">la</span> <span class="free">lb</span>
<span class="keyword2"><span class="keyword">assumes</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> length <span class="free">lb</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≥</span> <span class="free">la</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">lb</span> <span class="main">!</span> <span class="free">i</span> <span class="main">∈</span> set <span class="main">(</span>drop <span class="free">la</span> <span class="free">lb</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Cons_nth_drop_Suc in_set_member member_rec<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> 
       set_drop_subset_set_drop rev_subsetD<span class="main">)</span>

<span class="keyword1" id="ListUtilities-DropToShift"><span class="command">lemma</span></span> DropToShift<span class="main">:</span>
<span class="keyword2"><span class="keyword">fixes</span></span>
  <span class="free">l</span> <span class="free">i</span> <span class="free">list</span>
<span class="keyword2"><span class="keyword">assumes</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">+</span> <span class="free">i</span> <span class="main">&lt;</span> length <span class="free">list</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span>drop <span class="free">l</span> <span class="free">list</span><span class="main">)</span> <span class="main">!</span> <span class="free">i</span> <span class="main">=</span> <span class="free">list</span> <span class="main">!</span> <span class="main">(</span><span class="free">l</span> <span class="main">+</span> <span class="free">i</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">l</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="ListUtilities-SetToIndex"><span class="command">lemma</span></span> SetToIndex<span class="main">:</span>
<span class="keyword2"><span class="keyword">fixes</span></span>
  <span class="free">a</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">liste</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span> list"</span></span>
<span class="keyword2"><span class="keyword">assumes</span></span>
  AssumpSetToIndex<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> set <span class="free">liste</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound"><span class="bound">index</span></span> <span class="main">&lt;</span> length <span class="free">liste</span> <span class="main">.</span> <span class="free">a</span> <span class="main">=</span> <span class="free">liste</span> <span class="main">!</span> <span class="bound">index</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> LenInduct<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">xs</span><span class="main">.</span> <span class="main">∀</span><span class="bound">ys</span><span class="main">.</span> length <span class="bound">ys</span> <span class="main">&lt;</span> length <span class="bound">xs</span> <span class="main">⟶</span> <span class="free">a</span> <span class="main">∈</span> set <span class="bound">ys</span> 
          <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">index</span></span><span class="main">&lt;</span>length <span class="bound">ys</span><span class="main">.</span> <span class="free">a</span> <span class="main">=</span> <span class="bound">ys</span> <span class="main">!</span> <span class="bound">index</span><span class="main">)</span> 
          <span class="main">⟹</span> <span class="free">a</span> <span class="main">∈</span> set <span class="bound">xs</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">index</span></span><span class="main">&lt;</span>length <span class="bound">xs</span><span class="main">.</span> <span class="free">a</span> <span class="main">=</span> <span class="bound">xs</span> <span class="main">!</span> <span class="bound">index</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">xs</span>
    <span class="keyword3"><span class="command">assume</span></span> AssumpLengthInduction<span class="main">:</span> 
      <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">ys</span><span class="main">.</span> length <span class="bound">ys</span> <span class="main">&lt;</span> length <span class="skolem">xs</span> <span class="main">⟶</span> <span class="free">a</span> <span class="main">∈</span> set <span class="bound">ys</span> 
      <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">index</span></span><span class="main">&lt;</span>length <span class="bound">ys</span><span class="main">.</span> <span class="free">a</span> <span class="main">=</span> <span class="bound">ys</span> <span class="main">!</span> <span class="bound">index</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> set <span class="skolem">xs</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">x</span> <span class="bound">xs'</span> <span class="main">.</span> <span class="skolem">xs</span> <span class="main">=</span> <span class="bound">x</span><span class="main">#</span><span class="bound">xs'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> AssumpLengthInduction<span class="main">(</span>2<span class="main">)</span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ListMem.cases ListMem_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="skolem"><span class="skolem">xs'</span></span> <span class="keyword2"><span class="keyword">where</span></span> XSSplit<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">=</span> <span class="skolem">x</span><span class="main">#</span><span class="skolem">xs'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> insert <span class="skolem">x</span> <span class="main">(</span>set <span class="skolem">xs'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> set_simps AssumpLengthInduction 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">∨</span> <span class="free">a</span> <span class="main">∈</span> set <span class="skolem">xs'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">index</span></span><span class="main">&lt;</span>length <span class="skolem">xs</span><span class="main">.</span> <span class="free">a</span> <span class="main">=</span> <span class="skolem">xs</span> <span class="main">!</span> <span class="bound">index</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span><span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">index</span></span><span class="main">&lt;</span>length <span class="skolem">xs</span><span class="main">.</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">xs</span> <span class="main">!</span> <span class="bound">index</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> XSSplit <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> AssumpCases<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> set <span class="skolem">xs'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≠</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">xs'</span> <span class="main">&lt;</span> length <span class="skolem">xs</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> XSSplit <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">index</span></span><span class="main">&lt;</span>length <span class="skolem">xs'</span><span class="main">.</span> <span class="free">a</span> <span class="main">=</span> <span class="skolem">xs'</span> <span class="main">!</span> <span class="bound">index</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> AssumpLengthInduction<span class="main">(</span>1<span class="main">)</span> AssumpCases<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">index</span></span><span class="main">&lt;</span>length <span class="skolem">xs</span><span class="main">.</span> <span class="free">a</span> <span class="main">=</span> <span class="skolem">xs</span> <span class="main">!</span> <span class="bound">index</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> XSSplit <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound"><span class="bound">index</span></span> <span class="main">&lt;</span> length <span class="free">liste</span> <span class="main">.</span> <span class="free">a</span> <span class="main">=</span> <span class="free">liste</span> <span class="main">!</span> <span class="bound">index</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> length_induct<span class="main">[</span><span class="operator">of</span> 
      <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">l</span><span class="main">.</span> <span class="free">a</span> <span class="main">∈</span> set <span class="bound">l</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span> <span class="bound"><span class="bound">index</span></span> <span class="main">&lt;</span> length <span class="bound">l</span> <span class="main">.</span> <span class="free">a</span> <span class="main">=</span> <span class="bound">l</span> <span class="main">!</span> <span class="bound">index</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">liste</span>"</span></span><span class="main">]</span> 
    AssumpSetToIndex <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="ListUtilities-DropToIndex"><span class="command">lemma</span></span> DropToIndex<span class="main">:</span>
<span class="keyword2"><span class="keyword">fixes</span></span>
  <span class="free">a</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">l</span> <span class="free">liste</span> 
<span class="keyword2"><span class="keyword">assumes</span></span>
  AssumpDropToIndex<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> set <span class="main">(</span>drop <span class="free">l</span> <span class="free">liste</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound"><span class="bound">i</span></span> <span class="main">≥</span> <span class="free">l</span> <span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> length <span class="free">liste</span> <span class="main">∧</span> <span class="free">a</span> <span class="main">=</span> <span class="free">liste</span> <span class="main">!</span> <span class="bound">i</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound"><span class="bound">index</span></span> <span class="main">&lt;</span> length <span class="main">(</span>drop <span class="free">l</span> <span class="free">liste</span><span class="main">)</span> <span class="main">.</span> <span class="free">a</span> <span class="main">=</span> <span class="main">(</span>drop <span class="free">l</span> <span class="free">liste</span><span class="main">)</span> <span class="main">!</span> <span class="bound">index</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> AssumpDropToIndex SetToIndex<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">a</span>"</span></span> <span class="quoted"><span class="quoted">"drop <span class="free">l</span> <span class="free">liste</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">index</span></span> <span class="keyword2"><span class="keyword">where</span></span> Index<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">index</span> <span class="main">&lt;</span> length <span class="main">(</span>drop <span class="free">l</span> <span class="free">liste</span><span class="main">)</span>"</span></span> 
    <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> <span class="main">(</span>drop <span class="free">l</span> <span class="free">liste</span><span class="main">)</span> <span class="main">!</span> <span class="skolem">index</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">+</span> <span class="skolem">index</span> <span class="main">&lt;</span> length <span class="free">liste</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Index<span class="main">(</span>1<span class="main">)</span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> length_drop less_diff_conv add.commute<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> <span class="free">liste</span> <span class="main">!</span> <span class="main">(</span><span class="free">l</span> <span class="main">+</span> <span class="skolem">index</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> DropToShift<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">l</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">index</span>"</span></span><span class="main">]</span> Index<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">i</span></span><span class="main">≥</span><span class="free">l</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> length <span class="free">liste</span> <span class="main">∧</span> <span class="free">a</span> <span class="main">=</span> <span class="free">liste</span> <span class="main">!</span> <span class="bound">i</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="free">l</span> <span class="main">+</span> <span class="skolem">index</span> <span class="main">&lt;</span> length <span class="free">liste</span>›</span></span> le_add1<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Execution">
<div class="head">
<h1>Theory Execution</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Execution›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  \file{Execution} introduces a locale for executions within asynchronous systems.
›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Execution
<span class="keyword2"><span class="keyword">imports</span></span> <a href="AsynchronousSystem.html">AsynchronousSystem</a> <a href="ListUtilities.html">ListUtilities</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Execution locale definition›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  A (finite) execution within a system is a list of configurations \isb{exec}
  accompanied by a list of messages \isb{trace} such that the first configuration
  is initial and every next state can be reached processing the messages
  in \isb{trace}.
›</span></span>
<span class="keyword1"><span class="command">locale</span></span> execution <span class="main">=</span>
  asynchronousSystem <span class="quoted"><span class="free">trans</span></span> <span class="quoted"><span class="free">sends</span></span> <span class="quoted"><span class="free">start</span></span>    
<span class="keyword2"><span class="keyword">for</span></span>
  <span class="free">trans</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'p</span> <span class="main">⇒</span> <span class="tfree">'s</span> <span class="main">⇒</span> <span class="tfree">'v</span> messageValue <span class="main">⇒</span> <span class="tfree">'s</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">sends</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'p</span> <span class="main">⇒</span> <span class="tfree">'s</span> <span class="main">⇒</span> <span class="tfree">'v</span> messageValue <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'p</span><span class="main">,</span> <span class="tfree">'v</span><span class="main">)</span> message multiset"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">start</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'p</span> <span class="main">⇒</span> <span class="tfree">'s</span>"</span></span>
<span class="main">+</span>
<span class="keyword2"><span class="keyword">fixes</span></span>
  <span class="free">exec</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'p</span><span class="main">,</span> <span class="tfree">'v</span><span class="main">,</span> <span class="tfree">'s</span> <span class="main">)</span> configuration list"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">trace</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'p</span><span class="main">,</span> <span class="tfree">'v</span><span class="main">)</span> message list"</span></span>
<span class="keyword2"><span class="keyword">assumes</span></span> 
  notEmpty<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="free">exec</span> <span class="main">≥</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
  length<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="free">exec</span> <span class="main">-</span> <span class="main">1</span> <span class="main">=</span> length <span class="free">trace</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  base<span class="main">:</span> <span class="quoted"><span class="quoted">"initial <span class="main">(</span>hd <span class="free">exec</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  step<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">i</span> <span class="main">&lt;</span> length <span class="free">exec</span> <span class="main">-</span> <span class="main">1</span> <span class="main">;</span> <span class="free">cfg1</span> <span class="main">=</span> <span class="free">exec</span> <span class="main">!</span> <span class="free">i</span> <span class="main">;</span> <span class="free">cfg2</span> <span class="main">=</span> <span class="free">exec</span> <span class="main">!</span> <span class="main">(</span><span class="free">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">⟧</span>
      <span class="main">⟹</span> <span class="main">(</span><span class="main">(</span><span class="free">cfg1</span> <span class="main">⊢</span> <span class="free">trace</span> <span class="main">!</span> <span class="free">i</span> <span class="main">↦</span> <span class="free">cfg2</span><span class="main">)</span><span class="main">)</span> "</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">execMsg</span> <span class="main">::</span>
  <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'p</span><span class="main">,</span><span class="tfree">'v</span><span class="main">)</span> message"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">execMsg</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="free">trace</span> <span class="main">!</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">execConf</span> <span class="main">::</span>
  <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'p</span><span class="main">,</span> <span class="tfree">'v</span><span class="main">,</span> <span class="tfree">'s</span><span class="main">)</span> configuration"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">execConf</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span>  <span class="main">≡</span> <span class="main">(</span><span class="free">exec</span> <span class="main">!</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Enabledness and occurrence in the execution›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">minimalEnabled</span> <span class="main">::</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'p</span><span class="main">,</span> <span class="tfree">'v</span><span class="main">)</span> message <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">minimalEnabled</span> <span class="free"><span class="bound"><span class="entity">msg</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">p</span> <span class="main">.</span> isReceiverOf <span class="bound">p</span> <span class="free"><span class="bound"><span class="entity">msg</span></span></span><span class="main">)</span> 
    <span class="main">∧</span> <span class="main">(</span>enabled <span class="main">(</span>last <span class="free">exec</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">msg</span></span></span><span class="main">)</span>
    <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">n</span> <span class="main">.</span> <span class="bound">n</span> <span class="main">&lt;</span> length <span class="free">exec</span> <span class="main">∧</span> enabled <span class="main">(</span>execConf <span class="bound">n</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">msg</span></span></span> 
      <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span> <span class="bound"><span class="bound">n'</span></span> <span class="main">≥</span> <span class="bound">n</span> <span class="main">.</span> <span class="bound">n'</span> <span class="main">&lt;</span> length <span class="free">trace</span> <span class="main">⟶</span> <span class="free"><span class="bound"><span class="entity">msg</span></span></span> <span class="main">≠</span> <span class="main">(</span>execMsg <span class="bound">n'</span><span class="main">)</span><span class="main">)</span>
    <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">n'</span> <span class="bound">msg'</span> <span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="main">∃</span> <span class="bound">p</span> <span class="main">.</span> isReceiverOf <span class="bound">p</span> <span class="bound">msg'</span><span class="main">)</span> 
      <span class="main">∧</span> <span class="main">(</span>enabled <span class="main">(</span>last <span class="free">exec</span><span class="main">)</span> <span class="bound">msg'</span><span class="main">)</span> 
      <span class="main">∧</span> <span class="bound">n'</span> <span class="main">&lt;</span> length <span class="free">trace</span> 
      <span class="main">∧</span> enabled <span class="main">(</span>execConf <span class="bound">n'</span><span class="main">)</span> <span class="bound">msg'</span> 
      <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span> <span class="bound"><span class="bound">n''</span></span> <span class="main">≥</span> <span class="bound">n'</span> <span class="main">.</span> <span class="bound">n''</span> <span class="main">&lt;</span> length <span class="free">trace</span> <span class="main">⟶</span> <span class="bound">msg'</span> <span class="main">≠</span> 
                      <span class="main">(</span>execMsg <span class="bound">n''</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> <span class="bound">n'</span> <span class="main">≥</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">firstOccurrence</span> <span class="main">::</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'p</span><span class="main">,</span> <span class="tfree">'v</span><span class="main">)</span> message <span class="main">⇒</span> nat <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>                    
  <span class="quoted"><span class="quoted">"<span class="free">firstOccurrence</span> <span class="free"><span class="bound"><span class="entity">msg</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">p</span> <span class="main">.</span> isReceiverOf <span class="bound">p</span> <span class="free"><span class="bound"><span class="entity">msg</span></span></span><span class="main">)</span> 
    <span class="main">∧</span> <span class="main">(</span>enabled <span class="main">(</span>last <span class="free">exec</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">msg</span></span></span><span class="main">)</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">&lt;</span> <span class="main">(</span>length <span class="free">exec</span><span class="main">)</span>
    <span class="main">∧</span> enabled <span class="main">(</span>execConf <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">msg</span></span></span> 
    <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span> <span class="bound"><span class="bound">n'</span></span> <span class="main">≥</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">.</span> <span class="bound">n'</span> <span class="main">&lt;</span> length <span class="free">trace</span> <span class="main">⟶</span> <span class="free"><span class="bound"><span class="entity">msg</span></span></span> <span class="main">≠</span> <span class="main">(</span>execMsg <span class="bound">n'</span><span class="main">)</span><span class="main">)</span>
    <span class="main">∧</span> <span class="main">(</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">¬</span> enabled <span class="main">(</span>execConf <span class="main">(</span><span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">msg</span></span></span> 
      <span class="main">∨</span> <span class="free"><span class="bound"><span class="entity">msg</span></span></span> <span class="main">=</span> execMsg <span class="main">(</span><span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Execution-FirstOccurrenceExists"><span class="command">lemma</span></span> FirstOccurrenceExists<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span>
  <span class="quoted"><span class="quoted">"enabled <span class="main">(</span>last <span class="free">exec</span><span class="main">)</span> <span class="free">msg</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">p</span><span class="main">.</span> isReceiverOf <span class="bound">p</span> <span class="free">msg</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">n</span> <span class="main">.</span> firstOccurrence <span class="free">msg</span> <span class="bound">n</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="free">exec</span> <span class="main">-</span> <span class="main">1</span> <span class="main">&lt;</span> length <span class="free">exec</span> 
    <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span> <span class="bound"><span class="bound">n'</span></span> <span class="main">≥</span> <span class="main">(</span>length <span class="free">exec</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">.</span> <span class="bound">n'</span> <span class="main">&lt;</span> length <span class="free">trace</span> <span class="main">⟶</span> <span class="free">trace</span> <span class="main">!</span> <span class="bound">n'</span> <span class="main">≠</span> <span class="free">msg</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> length
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> diff_diff_cancel leD notEmpty zero_less_diff 
      zero_less_one<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> NNotInTrace<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound"><span class="bound">n</span></span> <span class="main">&lt;</span> length <span class="free">exec</span> <span class="main">.</span> 
    <span class="main">(</span><span class="main">∀</span> <span class="bound"><span class="bound">n'</span></span><span class="main">≥</span><span class="bound">n</span> <span class="main">.</span> <span class="bound">n'</span> <span class="main">&lt;</span> length <span class="free">trace</span> <span class="main">⟶</span> <span class="free">trace</span> <span class="main">!</span> <span class="bound">n'</span> <span class="main">≠</span> <span class="free">msg</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound"><span class="bound">n0</span></span> <span class="main">&lt;</span> length <span class="free">exec</span> <span class="main">.</span> 
    <span class="main">(</span><span class="main">∀</span> <span class="bound"><span class="bound">n'</span></span><span class="main">≥</span><span class="bound">n0</span> <span class="main">.</span> <span class="bound">n'</span> <span class="main">&lt;</span> length <span class="free">trace</span> <span class="main">⟶</span> <span class="free">trace</span> <span class="main">!</span> <span class="bound">n'</span> <span class="main">≠</span> <span class="free">msg</span><span class="main">)</span> <span class="main">∧</span>
    <span class="main">(</span><span class="main">(</span><span class="bound">n0</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> 
      <span class="main">∨</span> <span class="main">¬</span> <span class="main">(</span><span class="main">∀</span> <span class="bound"><span class="bound">n'</span></span> <span class="main">≥</span> <span class="main">(</span><span class="bound">n0</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">.</span> <span class="bound">n'</span> <span class="main">&lt;</span> length <span class="free">trace</span> <span class="main">⟶</span> <span class="free">trace</span> <span class="main">!</span> <span class="bound">n'</span> <span class="main">≠</span> <span class="free">msg</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> MinPredicate2<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span><span class="main">(</span><span class="bound">x</span> <span class="main">&lt;</span> length <span class="free">exec</span> 
      <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">n'</span></span><span class="main">≥</span><span class="bound">x</span><span class="main">.</span><span class="main">(</span><span class="bound">n'</span><span class="main">&lt;</span>length <span class="free">trace</span> <span class="main">⟶</span> <span class="free">trace</span> <span class="main">!</span> <span class="bound">n'</span> <span class="main">≠</span> <span class="free">msg</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">n0</span><span class="main">.</span> <span class="bound">n0</span> <span class="main">&lt;</span> length <span class="free">exec</span> 
    <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span> <span class="bound"><span class="bound">n'</span></span><span class="main">≥</span><span class="bound">n0</span> <span class="main">.</span> <span class="bound">n'</span> <span class="main">&lt;</span> length <span class="free">trace</span> <span class="main">⟶</span> <span class="free">trace</span> <span class="main">!</span> <span class="bound">n'</span> <span class="main">≠</span> <span class="free">msg</span><span class="main">)</span> 
    <span class="main">∧</span> <span class="main">(</span><span class="main">(</span><span class="bound">n0</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> 
      <span class="main">∨</span> <span class="main">¬</span> <span class="main">(</span><span class="main">∀</span> <span class="bound"><span class="bound">n'</span></span> <span class="main">≥</span> <span class="main">(</span><span class="bound">n0</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">.</span> <span class="bound">n'</span> <span class="main">&lt;</span> length <span class="free">trace</span> <span class="main">⟶</span> <span class="free">trace</span> <span class="main">!</span> <span class="bound">n'</span> <span class="main">≠</span> <span class="free">msg</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n0</span></span> <span class="keyword2"><span class="keyword">where</span></span> N0a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n0</span> <span class="main">&lt;</span> length <span class="free">exec</span> 
    <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span> <span class="bound"><span class="bound">n'</span></span><span class="main">≥</span><span class="skolem">n0</span> <span class="main">.</span> <span class="bound">n'</span> <span class="main">&lt;</span> length <span class="free">trace</span> <span class="main">⟶</span> <span class="free">trace</span> <span class="main">!</span> <span class="bound">n'</span> <span class="main">≠</span> <span class="free">msg</span><span class="main">)</span> 
    <span class="main">∧</span> <span class="main">(</span><span class="main">(</span><span class="skolem">n0</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> 
      <span class="main">∨</span> <span class="main">¬</span> <span class="main">(</span><span class="main">∀</span> <span class="bound"><span class="bound">n'</span></span> <span class="main">≥</span> <span class="main">(</span><span class="skolem">n0</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">.</span> <span class="bound">n'</span> <span class="main">&lt;</span> length <span class="free">trace</span> <span class="main">⟶</span> <span class="free">trace</span> <span class="main">!</span> <span class="bound">n'</span> <span class="main">≠</span> <span class="free">msg</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">hence</span></span> N0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n0</span> <span class="main">&lt;</span> length <span class="free">exec</span>"</span></span> 
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span> <span class="bound"><span class="bound">n'</span></span><span class="main">≥</span><span class="skolem">n0</span> <span class="main">.</span> <span class="bound">n'</span> <span class="main">&lt;</span> length <span class="free">trace</span> <span class="main">⟶</span> <span class="free">trace</span> <span class="main">!</span> <span class="bound">n'</span> <span class="main">≠</span> <span class="free">msg</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="skolem">n0</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> 
      <span class="main">∨</span> <span class="main">¬</span> <span class="main">(</span><span class="main">∀</span> <span class="bound"><span class="bound">n'</span></span> <span class="main">≥</span> <span class="main">(</span><span class="skolem">n0</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">.</span> <span class="bound">n'</span> <span class="main">&lt;</span> length <span class="free">trace</span> <span class="main">⟶</span> <span class="free">trace</span> <span class="main">!</span> <span class="bound">n'</span> <span class="main">≠</span> <span class="free">msg</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> N0a <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> N0'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n0</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="free">trace</span> <span class="main">!</span> <span class="main">(</span><span class="skolem">n0</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="free">msg</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">n0</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> N0NotZero<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n0</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∀</span> <span class="bound"><span class="bound">n'</span></span> <span class="main">≥</span> <span class="main">(</span><span class="skolem">n0</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">.</span> <span class="bound">n'</span> <span class="main">&lt;</span> length <span class="free">trace</span> <span class="main">⟶</span> <span class="free">trace</span> <span class="main">!</span> <span class="bound">n'</span> <span class="main">≠</span> <span class="free">msg</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> N0<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n0</span> <span class="main">-</span> <span class="main">1</span> <span class="main">&lt;</span> length <span class="free">trace</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> N0<span class="main">(</span>1<span class="main">)</span> length N0NotZero 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> calculation le_less_trans<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"execMsg <span class="main">(</span><span class="skolem">n0</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="free">msg</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> N0<span class="main">(</span>2<span class="main">)</span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> One_nat_def Suc_diff_Suc diff_Suc_eq_diff_pred 
         diff_diff_cancel diff_is_0_eq leI nat_le_linear<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound"><span class="bound">n1</span></span> <span class="main">&lt;</span> length <span class="free">exec</span> <span class="main">.</span> 
    <span class="main">(</span><span class="main">∀</span> <span class="bound"><span class="bound">n'</span></span><span class="main">≥</span><span class="bound">n1</span> <span class="main">.</span> <span class="bound">n'</span> <span class="main">&lt;</span> length <span class="free">trace</span> <span class="main">⟶</span> <span class="free">trace</span> <span class="main">!</span> <span class="bound">n'</span> <span class="main">≠</span> <span class="free">msg</span><span class="main">)</span> 
    <span class="main">∧</span> enabled <span class="main">(</span><span class="free">exec</span> <span class="main">!</span> <span class="bound">n1</span><span class="main">)</span> <span class="free">msg</span> 
    <span class="main">∧</span> <span class="main">(</span><span class="bound">n1</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="main">¬</span> enabled <span class="main">(</span><span class="free">exec</span> <span class="main">!</span> <span class="main">(</span><span class="bound">n1</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="free">msg</span> <span class="main">∨</span> <span class="free">trace</span> <span class="main">!</span> <span class="main">(</span><span class="bound">n1</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="free">msg</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"enabled <span class="main">(</span><span class="free">exec</span> <span class="main">!</span> <span class="skolem">n0</span><span class="main">)</span> <span class="free">msg</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"enabled <span class="main">(</span>execConf <span class="skolem">n0</span><span class="main">)</span> <span class="free">msg</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n0</span> <span class="main">&lt;</span> length <span class="free">exec</span>"</span></span> 
      <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span> <span class="bound"><span class="bound">n'</span></span><span class="main">≥</span><span class="skolem">n0</span> <span class="main">.</span> <span class="bound">n'</span> <span class="main">&lt;</span> length <span class="free">trace</span> <span class="main">⟶</span> <span class="free">trace</span> <span class="main">!</span> <span class="bound">n'</span> <span class="main">≠</span> <span class="free">msg</span><span class="main">)</span>"</span></span> 
      <span class="quoted"><span class="quoted">"enabled <span class="main">(</span><span class="free">exec</span> <span class="main">!</span> <span class="skolem">n0</span><span class="main">)</span> <span class="free">msg</span> <span class="main">∧</span>
      <span class="main">(</span><span class="skolem">n0</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="main">¬</span> enabled <span class="main">(</span><span class="free">exec</span> <span class="main">!</span> <span class="main">(</span><span class="skolem">n0</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="free">msg</span> <span class="main">∨</span> <span class="free">trace</span> <span class="main">!</span> <span class="main">(</span><span class="skolem">n0</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="free">msg</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> N0 N0' <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">n1</span></span><span class="main">&lt;</span>length <span class="free">exec</span><span class="main">.</span>
       <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">n'</span></span><span class="main">≥</span><span class="bound">n1</span><span class="main">.</span> <span class="bound">n'</span> <span class="main">&lt;</span> length <span class="free">trace</span> <span class="main">⟶</span> execMsg <span class="bound">n'</span> <span class="main">≠</span> <span class="free">msg</span><span class="main">)</span> 
       <span class="main">∧</span> enabled <span class="main">(</span>execConf <span class="bound">n1</span><span class="main">)</span> <span class="free">msg</span> 
       <span class="main">∧</span> <span class="main">(</span><span class="bound">n1</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="main">¬</span> enabled <span class="main">(</span>execConf <span class="main">(</span><span class="bound">n1</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="free">msg</span> 
         <span class="main">∨</span> execMsg <span class="main">(</span><span class="bound">n1</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="free">msg</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> NotEnabled<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> enabled <span class="main">(</span>execConf <span class="skolem">n0</span><span class="main">)</span> <span class="free">msg</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"last <span class="free">exec</span> <span class="main">=</span> <span class="free">exec</span> <span class="main">!</span> <span class="main">(</span>length <span class="free">exec</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> last_conv_nth notEmpty 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> NNotInTrace length_0_conv less_nat_zero_code<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> EnabledInLast<span class="main">:</span> <span class="quoted"><span class="quoted">"enabled <span class="main">(</span><span class="free">exec</span> <span class="main">!</span> <span class="main">(</span>length <span class="free">exec</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="free">msg</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n0</span> <span class="main">≠</span> length <span class="free">exec</span> <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> NotEnabled <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> N0Small<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n0</span> <span class="main">&lt;</span> length <span class="free">exec</span> <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> N0<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound"><span class="bound">k</span></span> <span class="main">&lt;</span> length <span class="free">exec</span> <span class="main">-</span> <span class="main">1</span> <span class="main">-</span> <span class="skolem">n0</span>  <span class="main">.</span> <span class="main">¬</span> enabled <span class="main">(</span>execConf <span class="main">(</span><span class="skolem">n0</span> <span class="main">+</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="free">msg</span> 
      <span class="main">∧</span> enabled <span class="main">(</span>execConf <span class="main">(</span><span class="skolem">n0</span> <span class="main">+</span> <span class="bound">k</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="free">msg</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> NatPredicateTippingPoint<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"length <span class="free">exec</span> <span class="main">-</span> <span class="main">1</span> <span class="main">-</span> <span class="skolem">n0</span>"</span></span> 
        <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span><span class="main">¬</span><span class="main">(</span>enabled <span class="main">(</span><span class="free">exec</span> <span class="main">!</span> <span class="main">(</span><span class="skolem">n0</span> <span class="main">+</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="free">msg</span><span class="main">)</span>"</span></span><span class="main">]</span>
        assms<span class="main">(</span>1<span class="main">)</span> NotEnabled EnabledInLast <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> K<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="skolem">k</span> <span class="main">&lt;</span> length <span class="free">exec</span> <span class="main">-</span> <span class="main">1</span> <span class="main">-</span> <span class="skolem">n0</span>"</span></span> 
      <span class="quoted"><span class="quoted">"<span class="main">¬</span> enabled <span class="main">(</span>execConf <span class="main">(</span><span class="skolem">n0</span> <span class="main">+</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="free">msg</span>"</span></span> 
      <span class="quoted"><span class="quoted">"enabled <span class="main">(</span>execConf <span class="main">(</span><span class="skolem">n0</span> <span class="main">+</span> <span class="skolem">k</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="free">msg</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">n1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n1</span> <span class="main">=</span> <span class="skolem">k</span> <span class="main">+</span> <span class="skolem">n0</span> <span class="main">+</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> N1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n1</span> <span class="main">≥</span> <span class="skolem">n0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> enabled <span class="main">(</span>execConf <span class="main">(</span><span class="skolem">n1</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="free">msg</span>"</span></span> 
      <span class="quoted"><span class="quoted">"enabled <span class="main">(</span>execConf <span class="skolem">n1</span><span class="main">)</span> <span class="free">msg</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n1</span> <span class="main">&lt;</span> length <span class="free">exec</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> n1_def <span class="keyword1"><span class="command">using</span></span> K
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add.commute<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">n'</span></span><span class="main">≥</span><span class="skolem">n1</span><span class="main">.</span> <span class="bound">n'</span> <span class="main">&lt;</span> length <span class="free">trace</span> <span class="main">⟶</span> execMsg <span class="bound">n'</span> <span class="main">≠</span> <span class="free">msg</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> N1<span class="main">(</span>1<span class="main">)</span> N0<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> order_trans<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">n1</span></span><span class="main">&lt;</span>length <span class="free">exec</span><span class="main">.</span>
        <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">n'</span></span><span class="main">≥</span><span class="bound">n1</span><span class="main">.</span> <span class="bound">n'</span> <span class="main">&lt;</span> length <span class="free">trace</span> <span class="main">⟶</span> execMsg <span class="bound">n'</span> <span class="main">≠</span> <span class="free">msg</span><span class="main">)</span> 
        <span class="main">∧</span> enabled <span class="main">(</span>execConf <span class="bound">n1</span><span class="main">)</span> <span class="free">msg</span> 
        <span class="main">∧</span> <span class="main">(</span><span class="bound">n1</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="main">¬</span> enabled <span class="main">(</span>execConf <span class="main">(</span><span class="bound">n1</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="free">msg</span> 
          <span class="main">∨</span> execMsg <span class="main">(</span><span class="bound">n1</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="free">msg</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> N1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n1</span></span> <span class="keyword2"><span class="keyword">where</span></span> N1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n1</span> <span class="main">&lt;</span> length <span class="free">exec</span>"</span></span> 
    <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound"><span class="bound">n'</span></span><span class="main">≥</span><span class="skolem">n1</span> <span class="main">.</span> <span class="bound">n'</span> <span class="main">&lt;</span> length <span class="free">trace</span> <span class="main">⟶</span> <span class="free">trace</span> <span class="main">!</span> <span class="bound">n'</span> <span class="main">≠</span> <span class="free">msg</span>"</span></span>
    <span class="quoted"><span class="quoted">"enabled <span class="main">(</span><span class="free">exec</span> <span class="main">!</span> <span class="skolem">n1</span><span class="main">)</span> <span class="free">msg</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="skolem">n1</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="main">¬</span> enabled <span class="main">(</span><span class="free">exec</span> <span class="main">!</span> <span class="main">(</span><span class="skolem">n1</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="free">msg</span> <span class="main">∨</span> <span class="free">trace</span> <span class="main">!</span> <span class="main">(</span><span class="skolem">n1</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="free">msg</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"firstOccurrence <span class="free">msg</span> <span class="skolem">n1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> firstOccurrence_def 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">n</span><span class="main">.</span> firstOccurrence <span class="free">msg</span> <span class="bound">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Execution-ReachableInExecution"><span class="command">lemma</span></span> ReachableInExecution<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> length <span class="free">exec</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">≤</span> <span class="free">i</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span>
  <span class="quoted"><span class="quoted">"reachable <span class="main">(</span>execConf <span class="free">j</span><span class="main">)</span> <span class="main">(</span>execConf <span class="free">i</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">i</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"reachable <span class="main">(</span>execConf <span class="main">0</span><span class="main">)</span> <span class="main">(</span>execConf <span class="main">0</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> reachable.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ia</span>
  <span class="keyword3"><span class="command">assume</span></span> 
    IH<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">j</span> <span class="main">≤</span> <span class="skolem">ia</span> <span class="main">⟹</span> reachable <span class="main">(</span>execConf <span class="free">j</span><span class="main">)</span> <span class="main">(</span>execConf <span class="skolem">ia</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="quoted"><span class="quoted">"Suc <span class="skolem">ia</span> <span class="main">&lt;</span> length <span class="free">exec</span>"</span></span> 
    <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">≤</span> Suc <span class="skolem">ia</span>"</span></span>  
    <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> length <span class="free">exec</span>"</span></span> 
    <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">≤</span> <span class="free">i</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"reachable <span class="main">(</span>execConf <span class="free">j</span><span class="main">)</span> <span class="main">(</span>execConf <span class="main">(</span>Suc <span class="skolem">ia</span><span class="main">)</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">=</span> Suc <span class="skolem">ia</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"reachable <span class="main">(</span>execConf <span class="main">(</span>Suc <span class="skolem">ia</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>execConf <span class="main">(</span>Suc <span class="skolem">ia</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> reachable.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">≠</span> Suc <span class="skolem">ia</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">≤</span> <span class="skolem">ia</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> IH<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"reachable <span class="main">(</span>execConf <span class="free">j</span><span class="main">)</span> <span class="main">(</span>execConf <span class="skolem">ia</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> IH<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"reachable <span class="main">(</span>execConf <span class="skolem">ia</span><span class="main">)</span> <span class="main">(</span>execConf <span class="main">(</span>Suc <span class="skolem">ia</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> reachable.simps
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> IH<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> Suc_eq_plus1 less_diff_conv local.step<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"reachable <span class="main">(</span>execConf <span class="free">j</span><span class="main">)</span> <span class="main">(</span>execConf <span class="main">(</span>Suc <span class="skolem">ia</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> ReachableTrans <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Execution-LastPoint"><span class="command">lemma</span></span> LastPoint<span class="main">:</span>
<span class="keyword2"><span class="keyword">fixes</span></span>
  <span class="free">msg</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'p</span><span class="main">,</span> <span class="tfree">'v</span><span class="main">)</span> message"</span></span>
<span class="keyword2"><span class="keyword">assumes</span></span>
  <span class="quoted"><span class="quoted">"enabled <span class="main">(</span>last <span class="free">exec</span><span class="main">)</span> <span class="free">msg</span>"</span></span>
<span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">n</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&lt;</span> length <span class="free">exec</span>"</span></span>
  <span class="quoted"><span class="quoted">"enabled <span class="main">(</span>execConf <span class="free">n</span><span class="main">)</span> <span class="free">msg</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound"><span class="bound">n'</span></span> <span class="main">≥</span> <span class="free">n</span> <span class="main">.</span>
    <span class="bound">n'</span> <span class="main">&lt;</span> length <span class="free">trace</span> <span class="main">⟶</span> <span class="free">msg</span> <span class="main">≠</span> <span class="main">(</span>execMsg <span class="bound">n'</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">n0</span> <span class="main">.</span> 
      <span class="bound">n0</span> <span class="main">&lt;</span> length <span class="free">exec</span> 
    <span class="main">∧</span> enabled <span class="main">(</span>execConf <span class="bound">n0</span><span class="main">)</span> <span class="free">msg</span> 
    <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span> <span class="bound"><span class="bound">n'</span></span> <span class="main">≥</span> <span class="bound">n0</span> <span class="main">.</span>
        <span class="bound">n'</span> <span class="main">&lt;</span> length <span class="free">trace</span> <span class="main">⟶</span> <span class="free">msg</span> <span class="main">≠</span> <span class="main">(</span>execMsg <span class="bound">n'</span><span class="main">)</span><span class="main">)</span>
    <span class="main">⟶</span> <span class="bound">n0</span> <span class="main">≥</span> <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">len</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">len</span> <span class="main">=</span> length <span class="free">exec</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span>
    <span class="quoted"><span class="quoted">"<span class="skolem">len</span> <span class="main">&lt;</span> length <span class="free">exec</span>"</span></span>
    <span class="quoted"><span class="quoted">"enabled <span class="main">(</span>execConf <span class="skolem">len</span><span class="main">)</span> <span class="free">msg</span>"</span></span> 
    <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound"><span class="bound">n'</span></span> <span class="main">≥</span> <span class="skolem">len</span> <span class="main">.</span> <span class="bound">n'</span> <span class="main">&lt;</span> length <span class="free">trace</span> <span class="main">⟶</span> <span class="free">msg</span> <span class="main">≠</span> <span class="main">(</span>execMsg <span class="bound">n'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms notEmpty length <span class="keyword1"><span class="command">unfolding</span></span> len_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> One_nat_def last_conv_nth list.size<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> not_one_le_zero<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">n</span> <span class="main">.</span> <span class="bound">n</span> <span class="main">&lt;</span> length <span class="free">exec</span> <span class="main">∧</span> enabled <span class="main">(</span>execConf <span class="bound">n</span><span class="main">)</span> <span class="free">msg</span> 
    <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span> <span class="bound"><span class="bound">n'</span></span> <span class="main">≥</span> <span class="bound">n</span> <span class="main">.</span> <span class="bound">n'</span> <span class="main">&lt;</span> length <span class="free">trace</span> <span class="main">⟶</span> <span class="free">msg</span> <span class="main">≠</span> <span class="main">(</span>execMsg <span class="bound">n'</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> MinPredicate<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> 
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> that False <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Execution-ExistImpliesMinEnabled"><span class="command">lemma</span></span> ExistImpliesMinEnabled<span class="main">:</span>
<span class="keyword2"><span class="keyword">fixes</span></span> 
  <span class="free">msg</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'p</span><span class="main">,</span> <span class="tfree">'v</span><span class="main">)</span> message"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">p</span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'p</span></span></span>
<span class="keyword2"><span class="keyword">assumes</span></span> 
  <span class="quoted"><span class="quoted">"isReceiverOf <span class="free">p</span> <span class="free">msg</span>"</span></span> 
  <span class="quoted"><span class="quoted">"enabled <span class="main">(</span>last <span class="free">exec</span><span class="main">)</span> <span class="free">msg</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">msg'</span> <span class="main">.</span> minimalEnabled <span class="bound">msg'</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> MsgHasMinTime<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">msg</span> <span class="main">.</span> <span class="main">(</span>enabled <span class="main">(</span>last <span class="free">exec</span><span class="main">)</span> <span class="bound">msg</span> 
    <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">p</span> <span class="main">.</span> isReceiverOf <span class="bound">p</span> <span class="bound">msg</span><span class="main">)</span><span class="main">)</span>
    <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">n</span> <span class="main">.</span>  <span class="bound">n</span> <span class="main">&lt;</span> length <span class="free">exec</span> <span class="main">∧</span> enabled <span class="main">(</span>execConf <span class="bound">n</span><span class="main">)</span> <span class="bound">msg</span> 
        <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span> <span class="bound"><span class="bound">n'</span></span> <span class="main">≥</span> <span class="bound">n</span> <span class="main">.</span> <span class="bound">n'</span> <span class="main">&lt;</span> length <span class="free">trace</span> <span class="main">⟶</span> <span class="bound">msg</span> <span class="main">≠</span> <span class="main">(</span>execMsg <span class="bound">n'</span><span class="main">)</span><span class="main">)</span>
        <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">n0</span> <span class="main">.</span>  <span class="bound">n0</span> <span class="main">&lt;</span> length <span class="free">exec</span> <span class="main">∧</span> enabled <span class="main">(</span>execConf <span class="bound">n0</span><span class="main">)</span> <span class="bound">msg</span> 
        <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span> <span class="bound"><span class="bound">n'</span></span> <span class="main">≥</span> <span class="bound">n0</span> <span class="main">.</span> <span class="bound">n'</span> <span class="main">&lt;</span> length <span class="free">trace</span> <span class="main">⟶</span> <span class="bound">msg</span> <span class="main">≠</span> <span class="main">(</span>execMsg <span class="bound">n'</span><span class="main">)</span><span class="main">)</span> 
        <span class="main">⟶</span> <span class="bound">n0</span> <span class="main">≥</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> LastPoint<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?enabledTimes</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">n</span><span class="main">::</span>nat <span class="main">.</span> <span class="main">∃</span> <span class="bound">msg</span> <span class="main">.</span> <span class="main">(</span>enabled <span class="main">(</span>last <span class="free">exec</span><span class="main">)</span> <span class="bound">msg</span> 
    <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">p</span> <span class="main">.</span> isReceiverOf <span class="bound">p</span> <span class="bound">msg</span><span class="main">)</span><span class="main">)</span>
    <span class="main">∧</span>  <span class="bound">n</span> <span class="main">&lt;</span> length <span class="free">exec</span> <span class="main">∧</span> <span class="main">(</span>enabled <span class="main">(</span>execConf <span class="bound">n</span><span class="main">)</span> <span class="bound">msg</span> 
    <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span> <span class="bound"><span class="bound">n'</span></span> <span class="main">≥</span> <span class="bound">n</span> <span class="main">.</span> <span class="bound">n'</span> <span class="main">&lt;</span> length <span class="free">trace</span> <span class="main">⟶</span> <span class="bound">msg</span> <span class="main">≠</span> <span class="main">(</span>execMsg <span class="bound">n'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> NotEmpty<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="var">?enabledTimes</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms MsgHasMinTime <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">n0</span> <span class="main">.</span> <span class="bound">n0</span> <span class="main">∈</span> <span class="var">?enabledTimes</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">nMin</span> <span class="main">∈</span> <span class="var">?enabledTimes</span> <span class="main">.</span> <span class="main">∀</span> <span class="bound">x</span> <span class="main">∈</span> <span class="var">?enabledTimes</span> <span class="main">.</span> <span class="bound">x</span> <span class="main">≥</span> <span class="bound">nMin</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> MinPredicate<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">n</span><span class="main">.</span><span class="main">(</span><span class="bound">n</span> <span class="main">∈</span> <span class="var">?enabledTimes</span><span class="main">)</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">nMin</span></span> <span class="keyword2"><span class="keyword">where</span></span> NMin<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">nMin</span> <span class="main">∈</span> <span class="var">?enabledTimes</span>"</span></span> 
    <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">x</span> <span class="main">∈</span> <span class="var">?enabledTimes</span> <span class="main">.</span> <span class="bound">x</span> <span class="main">≥</span> <span class="skolem">nMin</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">msg</span> <span class="main">.</span> <span class="main">(</span>enabled <span class="main">(</span>last <span class="free">exec</span><span class="main">)</span> <span class="bound">msg</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">p</span> <span class="main">.</span> isReceiverOf <span class="bound">p</span> <span class="bound">msg</span><span class="main">)</span><span class="main">)</span>
    <span class="main">∧</span>  <span class="skolem">nMin</span> <span class="main">&lt;</span> length <span class="free">exec</span> <span class="main">∧</span> <span class="main">(</span>enabled <span class="main">(</span>execConf <span class="skolem">nMin</span><span class="main">)</span> <span class="bound">msg</span> 
    <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span> <span class="bound"><span class="bound">n'</span></span> <span class="main">≥</span> <span class="skolem">nMin</span> <span class="main">.</span> <span class="bound">n'</span> <span class="main">&lt;</span> length <span class="free">trace</span> <span class="main">⟶</span> <span class="bound">msg</span> <span class="main">≠</span> <span class="main">(</span>execMsg <span class="bound">n'</span><span class="main">)</span><span class="main">)</span>
    <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">n0</span> <span class="main">.</span>  <span class="bound">n0</span> <span class="main">&lt;</span> length <span class="free">exec</span> <span class="main">∧</span> enabled <span class="main">(</span>execConf <span class="bound">n0</span><span class="main">)</span> <span class="bound">msg</span> 
      <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span> <span class="bound"><span class="bound">n'</span></span> <span class="main">≥</span> <span class="bound">n0</span> <span class="main">.</span> <span class="bound">n'</span> <span class="main">&lt;</span> length <span class="free">trace</span> <span class="main">⟶</span> <span class="bound">msg</span> <span class="main">≠</span> <span class="main">(</span>execMsg <span class="bound">n'</span><span class="main">)</span><span class="main">)</span> 
      <span class="main">⟶</span> <span class="bound">n0</span> <span class="main">≥</span> <span class="skolem">nMin</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">msg</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>enabled <span class="main">(</span>last <span class="free">exec</span><span class="main">)</span> <span class="skolem">msg</span> 
    <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">p</span> <span class="main">.</span> isReceiverOf <span class="bound">p</span> <span class="skolem">msg</span><span class="main">)</span><span class="main">)</span>
    <span class="main">∧</span> <span class="skolem">nMin</span> <span class="main">&lt;</span> length <span class="free">exec</span> <span class="main">∧</span><span class="main">(</span>enabled <span class="main">(</span>execConf <span class="skolem">nMin</span><span class="main">)</span> <span class="skolem">msg</span> 
    <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span> <span class="bound"><span class="bound">n'</span></span> <span class="main">≥</span> <span class="skolem">nMin</span> <span class="main">.</span> <span class="bound">n'</span> <span class="main">&lt;</span> length <span class="free">trace</span> <span class="main">⟶</span> <span class="skolem">msg</span> <span class="main">≠</span> <span class="main">(</span>execMsg <span class="bound">n'</span><span class="main">)</span><span class="main">)</span>
    <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">n0</span> <span class="main">.</span>  <span class="bound">n0</span> <span class="main">&lt;</span> length <span class="free">exec</span> <span class="main">∧</span> enabled <span class="main">(</span>execConf <span class="bound">n0</span><span class="main">)</span> <span class="skolem">msg</span> 
      <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span> <span class="bound"><span class="bound">n'</span></span> <span class="main">≥</span> <span class="bound">n0</span> <span class="main">.</span> <span class="bound">n'</span> <span class="main">&lt;</span> length <span class="free">trace</span> <span class="main">⟶</span> <span class="skolem">msg</span> <span class="main">≠</span> <span class="main">(</span>execMsg <span class="bound">n'</span><span class="main">)</span><span class="main">)</span> 
      <span class="main">⟶</span> <span class="bound">n0</span> <span class="main">≥</span> <span class="skolem">nMin</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span> <span class="bound">n'</span> <span class="bound">msg'</span> <span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="main">∃</span> <span class="bound">p</span> <span class="main">.</span> isReceiverOf <span class="bound">p</span> <span class="bound">msg'</span><span class="main">)</span> 
    <span class="main">∧</span> <span class="main">(</span>enabled <span class="main">(</span>last <span class="free">exec</span><span class="main">)</span> <span class="bound">msg'</span><span class="main">)</span> 
    <span class="main">∧</span> <span class="bound">n'</span> <span class="main">&lt;</span> length <span class="free">trace</span> <span class="main">∧</span> enabled <span class="main">(</span>execConf <span class="bound">n'</span><span class="main">)</span> <span class="bound">msg'</span> 
    <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span> <span class="bound"><span class="bound">n''</span></span> <span class="main">≥</span> <span class="bound">n'</span> <span class="main">.</span> <span class="bound">n''</span> <span class="main">&lt;</span> length <span class="free">trace</span> <span class="main">⟶</span> <span class="bound">msg'</span> <span class="main">≠</span> <span class="main">(</span>execMsg <span class="bound">n''</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
      <span class="main">⟶</span> <span class="bound">n'</span> <span class="main">≥</span> <span class="skolem">nMin</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n'</span> <span class="skolem">msg'</span> <span class="skolem">p</span>
    <span class="keyword3"><span class="command">assume</span></span> Assms<span class="main">:</span>
      <span class="quoted"><span class="quoted">"isReceiverOf <span class="skolem">p</span> <span class="skolem">msg'</span>"</span></span> 
      <span class="quoted"><span class="quoted">"enabled <span class="main">(</span>last <span class="free">exec</span><span class="main">)</span> <span class="skolem">msg'</span>"</span></span> 
      <span class="quoted"><span class="quoted">"<span class="skolem">n'</span> <span class="main">&lt;</span> length <span class="free">trace</span>"</span></span> 
      <span class="quoted"><span class="quoted">"enabled <span class="main">(</span>execConf <span class="skolem">n'</span><span class="main">)</span> <span class="skolem">msg'</span>"</span></span> 
      <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">n''</span></span> <span class="main">≥</span> <span class="skolem">n'</span><span class="main">.</span> <span class="main">(</span><span class="bound">n''</span> <span class="main">&lt;</span> length <span class="free">trace</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="skolem">msg'</span> <span class="main">≠</span> execMsg <span class="bound">n''</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> Assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n'</span> <span class="main">&lt;</span> length <span class="free">exec</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> length <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> Assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n'</span> <span class="main">∈</span> <span class="var">?enabledTimes</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">nMin</span> <span class="main">≤</span> <span class="skolem">n'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> NMin<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"minimalEnabled <span class="skolem">msg</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> minimalEnabled_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Execution-StaysEnabledStep"><span class="command">lemma</span></span> StaysEnabledStep<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span>
  En<span class="main">:</span> <span class="quoted"><span class="quoted">"enabled <span class="free">cfg</span> <span class="free">msg</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  Cfg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">cfg</span> <span class="main">=</span> <span class="free">exec</span> <span class="main">!</span> <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  N<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&lt;</span> length <span class="free">exec</span>"</span></span> 
<span class="keyword2"><span class="keyword">shows</span></span>
  <span class="quoted"><span class="quoted">"enabled <span class="main">(</span><span class="free">exec</span> <span class="main">!</span> <span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="free">msg</span> 
  <span class="main">∨</span> <span class="free">n</span> <span class="main">=</span> <span class="main">(</span>length <span class="free">exec</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> 
  <span class="main">∨</span> <span class="free">msg</span> <span class="main">=</span> <span class="free">trace</span> <span class="main">!</span> <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">=</span> length <span class="free">exec</span> <span class="main">-</span> <span class="main">1</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">with</span></span> N <span class="keyword1"><span class="command">have</span></span> N<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&lt;</span> length <span class="free">exec</span> <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> Cfg <span class="keyword1"><span class="command">have</span></span> Step<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="free">cfg</span> <span class="main">⊢</span> <span class="free">trace</span> <span class="main">!</span> <span class="free">n</span> <span class="main">↦</span> <span class="main">(</span><span class="free">exec</span> <span class="main">!</span> <span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> step <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"enabled <span class="main">(</span><span class="free">exec</span> <span class="main">!</span> <span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="free">msg</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> enabled <span class="main">(</span><span class="free">exec</span> <span class="main">!</span> <span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="free">msg</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> En enabled_def Step N OnlyOccurenceDisables <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>                          

<span class="keyword1" id="Execution-StaysEnabledHelp"><span class="command">lemma</span></span> StaysEnabledHelp<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span>
  <span class="quoted"><span class="quoted">"enabled <span class="free">cfg</span> <span class="free">msg</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">cfg</span> <span class="main">=</span> <span class="free">exec</span> <span class="main">!</span> <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&lt;</span> length <span class="free">exec</span>"</span></span>    
<span class="keyword2"><span class="keyword">shows</span></span> 
  <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">i</span> <span class="main">.</span> <span class="bound">i</span> <span class="main">≥</span> <span class="free">n</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="main">(</span>length <span class="free">exec</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">∧</span> enabled <span class="main">(</span><span class="free">exec</span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span> <span class="free">msg</span> 
  <span class="main">⟶</span> <span class="free">msg</span> <span class="main">=</span> <span class="main">(</span><span class="free">trace</span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span>enabled <span class="main">(</span><span class="free">exec</span> <span class="main">!</span> <span class="main">(</span><span class="bound">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="free">msg</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≤</span> <span class="skolem">i</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="free">exec</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
    <span class="quoted"><span class="quoted">"enabled <span class="main">(</span>execConf <span class="skolem">i</span><span class="main">)</span> <span class="free">msg</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> enabled <span class="main">(</span>execConf <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="free">msg</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">msg</span> <span class="main">=</span> <span class="main">(</span><span class="free">trace</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms StaysEnabledStep
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add.right_neutral add_strict_mono le_add_diff_inverse2
        nat_neq_iff notEmpty  zero_less_one<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Execution-StaysEnabled"><span class="command">lemma</span></span> StaysEnabled<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> En<span class="main">:</span> <span class="quoted"><span class="quoted">"enabled <span class="free">cfg</span> <span class="free">msg</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">cfg</span> <span class="main">=</span> <span class="free">exec</span> <span class="main">!</span> <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&lt;</span> length <span class="free">exec</span>"</span></span>   
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"enabled <span class="main">(</span>last <span class="free">exec</span><span class="main">)</span> <span class="free">msg</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">i</span> <span class="main">.</span> <span class="bound">i</span> <span class="main">≥</span> <span class="free">n</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="main">(</span>length <span class="free">exec</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> 
  <span class="main">∧</span> <span class="free">msg</span> <span class="main">=</span> <span class="free">trace</span> <span class="main">!</span> <span class="bound">i</span> <span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"enabled <span class="main">(</span>last <span class="free">exec</span><span class="main">)</span> <span class="free">msg</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False 
  <span class="keyword1"><span class="command">hence</span></span> NotEnabled<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> enabled <span class="main">(</span>last <span class="free">exec</span><span class="main">)</span> <span class="free">msg</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"last <span class="free">exec</span> <span class="main">=</span> <span class="free">exec</span> <span class="main">!</span> <span class="main">(</span>length <span class="free">exec</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> last_conv_nth list.size<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> notEmpty not_one_le_zero<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">l</span> <span class="main">.</span> <span class="bound">l</span> <span class="main">≥</span> <span class="free">n</span> <span class="main">∧</span> last <span class="free">exec</span> <span class="main">=</span> <span class="free">exec</span> <span class="main">!</span> <span class="bound">l</span> <span class="main">∧</span> <span class="bound">l</span> <span class="main">=</span> length <span class="free">exec</span> <span class="main">-</span> <span class="main">1</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">l</span></span> <span class="keyword2"><span class="keyword">where</span></span> L<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">≥</span> <span class="free">n</span>"</span></span> <span class="quoted"><span class="quoted">"last <span class="free">exec</span> <span class="main">=</span> <span class="free">exec</span> <span class="main">!</span> <span class="skolem">l</span>"</span></span> 
    <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">=</span> length <span class="free">exec</span> <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span> <span class="bound">i</span> <span class="main">.</span> <span class="bound">i</span> <span class="main">≥</span> <span class="free">n</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="main">(</span>length <span class="free">exec</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">∧</span> <span class="free">msg</span> <span class="main">=</span> <span class="free">trace</span> <span class="main">!</span> <span class="bound">i</span> <span class="main">)</span>"</span></span>  
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> Ass<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">i</span></span><span class="main">≥</span><span class="free">n</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> length <span class="free">exec</span> <span class="main">-</span> <span class="main">1</span> <span class="main">∧</span> <span class="free">msg</span> <span class="main">=</span> execMsg <span class="bound">i</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">hence</span></span> Not<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">∨</span> <span class="bound">i</span> <span class="main">≥</span> length <span class="free">exec</span> <span class="main">-</span> <span class="main">1</span> <span class="main">∨</span> <span class="free">msg</span> <span class="main">≠</span> execMsg <span class="bound">i</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> leI<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">≥</span> <span class="free">n</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">≤</span> length <span class="free">exec</span> <span class="main">-</span> <span class="main">1</span> <span class="main">⟶</span> enabled <span class="main">(</span><span class="free">exec</span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span> <span class="free">msg</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> 
      <span class="keyword3"><span class="command">assume</span></span> I<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≤</span> <span class="skolem">i</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≤</span> length <span class="free">exec</span> <span class="main">-</span> <span class="main">1</span>"</span></span>  
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"enabled <span class="main">(</span>execConf <span class="skolem">i</span><span class="main">)</span> <span class="free">msg</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> StaysEnabledHelp<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> assms<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> Ass 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">i</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> Suc_le_lessD le_Suc_eq<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">with</span></span> NotEnabled L <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">― ‹end of locale Execution›</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Expanding executions to longer executions›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> asynchronousSystem<span class="main">)</span> expandExecutionStep<span class="main">:</span>
<span class="keyword2"><span class="keyword">fixes</span></span> 
  <span class="free">cfg</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'p</span><span class="main">,</span> <span class="tfree">'v</span><span class="main">,</span> <span class="tfree">'s</span> <span class="main">)</span> configuration"</span></span>
<span class="keyword2"><span class="keyword">assumes</span></span>
  CfgIsReachable<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>last <span class="free">exec'</span><span class="main">)</span> <span class="main">⊢</span> <span class="free">msg</span> <span class="main">↦</span> <span class="free">cMsg</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  ExecIsExecution<span class="main">:</span> <span class="quoted"><span class="quoted">"execution <span class="free">trans</span> <span class="free">sends</span> <span class="free">start</span> <span class="free">exec'</span> <span class="free">trace'</span>"</span></span> 
<span class="keyword2"><span class="keyword">shows</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">exec''</span> <span class="bound">trace''</span><span class="main">.</span> <span class="main">(</span>execution <span class="free">trans</span> <span class="free">sends</span> <span class="free">start</span> <span class="bound">exec''</span> <span class="bound">trace''</span><span class="main">)</span> 
  <span class="main">∧</span> <span class="main">(</span>prefixList <span class="free">exec'</span> <span class="bound">exec''</span><span class="main">)</span> 
  <span class="main">∧</span> <span class="main">(</span>prefixList <span class="free">trace'</span> <span class="bound">trace''</span><span class="main">)</span> 
  <span class="main">∧</span> <span class="main">(</span>last <span class="bound">exec''</span><span class="main">)</span> <span class="main">=</span> <span class="free">cMsg</span> 
  <span class="main">∧</span> <span class="main">(</span>last <span class="bound">trace''</span> <span class="main">=</span> <span class="free">msg</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">execMsg</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">execMsg</span> <span class="main">=</span> <span class="free">exec'</span> <span class="main">@</span> <span class="main">[</span><span class="free">cMsg</span><span class="main">]</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">traceMsg</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">traceMsg</span> <span class="main">=</span> <span class="free">trace'</span> <span class="main">@</span> <span class="main">[</span><span class="free">msg</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> ExecMsgEq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound"><span class="bound">i</span></span> <span class="main">&lt;</span> <span class="main">(</span><span class="main">(</span>length <span class="skolem">execMsg</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">.</span> <span class="skolem">execMsg</span> <span class="main">!</span> <span class="bound">i</span> <span class="main">=</span> <span class="free">exec'</span><span class="main">!</span><span class="bound">i</span> "</span></span> 
    <span class="keyword1"><span class="command">using</span></span> execMsg_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nth_append<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> TraceMsgEq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound"><span class="bound">i</span></span> <span class="main">&lt;</span> <span class="main">(</span><span class="main">(</span>length <span class="skolem">traceMsg</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">.</span> <span class="skolem">traceMsg</span><span class="main">!</span><span class="bound">i</span> <span class="main">=</span> <span class="free">trace'</span><span class="main">!</span><span class="bound">i</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> traceMsg_def 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nth_append<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> ExecLen<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>length <span class="skolem">execMsg</span><span class="main">)</span> <span class="main">≥</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> execMsg_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> lessLessExec<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">i</span> <span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="main">(</span>length <span class="free">exec'</span><span class="main">)</span> <span class="main">⟶</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="main">(</span>length <span class="skolem">execMsg</span> <span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> execMsg_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> ExecLenTraceLen<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="free">exec'</span><span class="main">-</span> <span class="main">1</span> <span class="main">=</span> length <span class="free">trace'</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> ExecIsExecution execution.length <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> lessLessTrace<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">i</span> <span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="main">(</span>length <span class="free">exec'</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">⟶</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="main">(</span>length <span class="free">trace'</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> ExecLenTraceLen <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> Exec'Len<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="free">exec'</span> <span class="main">≥</span> <span class="main">1</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> ExecIsExecution execution.notEmpty <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"hd <span class="free">exec'</span> <span class="main">=</span> hd <span class="skolem">execMsg</span> "</span></span> <span class="keyword1"><span class="command">using</span></span> execMsg_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> One_nat_def hd_append2 length_0_conv not_one_le_zero<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"initial <span class="main">(</span>hd <span class="free">exec'</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> ExecIsExecution execution.base <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> ExecInit<span class="main">:</span> <span class="quoted"><span class="quoted">"initial <span class="main">(</span>hd <span class="skolem">execMsg</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> execMsg_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> ExecMsgLen<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="skolem">execMsg</span> <span class="main">-</span> <span class="main">1</span> <span class="main">=</span> length <span class="skolem">traceMsg</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> ExecLenTraceLen <span class="keyword1"><span class="command">unfolding</span></span> execMsg_def traceMsg_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span><span class="operator">metis</span> Exec'Len Suc_pred length_greater_0_conv list.size<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> 
       not_one_le_zero<span class="main">)</span> 
  <span class="keyword1"><span class="command">have</span></span> ExecSteps<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound"><span class="bound">i</span></span> <span class="main">&lt;</span> length <span class="free">exec'</span> <span class="main">-</span> <span class="main">1</span> <span class="main">.</span>
    <span class="main">(</span><span class="main">(</span><span class="free">exec'</span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span>  <span class="main">⊢</span> <span class="free">trace'</span> <span class="main">!</span> <span class="bound">i</span> <span class="main">↦</span> <span class="main">(</span><span class="free">exec'</span> <span class="main">!</span> <span class="main">(</span><span class="bound">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> ExecIsExecution execution.step <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound"><span class="bound">i</span></span> <span class="main">&lt;</span> length <span class="skolem">execMsg</span> <span class="main">-</span> <span class="main">1</span><span class="main">.</span> 
    <span class="main">(</span><span class="main">(</span><span class="skolem">execMsg</span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span> <span class="main">⊢</span> <span class="skolem">traceMsg</span> <span class="main">!</span> <span class="bound">i</span> <span class="main">↦</span> <span class="main">(</span><span class="skolem">execMsg</span> <span class="main">!</span> <span class="main">(</span><span class="bound">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> execMsg_def traceMsg_def
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
    <span class="keyword3"><span class="command">assume</span></span> IlessLen<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="main">(</span>length <span class="free">exec'</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">exec'</span> <span class="main">@</span> <span class="main">[</span><span class="free">cMsg</span><span class="main">]</span><span class="main">)</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">⊢</span> <span class="main">(</span><span class="main">(</span><span class="free">trace'</span> <span class="main">@</span> <span class="main">[</span><span class="free">msg</span><span class="main">]</span><span class="main">)</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span> 
      <span class="main">↦</span> <span class="main">(</span><span class="main">(</span><span class="free">exec'</span> <span class="main">@</span> <span class="main">[</span><span class="free">cMsg</span><span class="main">]</span><span class="main">)</span> <span class="main">!</span> <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">i</span> <span class="main">&lt;</span> <span class="main">(</span>length <span class="free">exec'</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">hence</span></span> IlessLen1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">i</span> <span class="main">&lt;</span> <span class="main">(</span>length <span class="free">exec'</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">exec'</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span>  <span class="main">⊢</span> <span class="free">trace'</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">↦</span> <span class="main">(</span><span class="free">exec'</span> <span class="main">!</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> ExecSteps <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> IlessLen1 ExecMsgEq lessLessExec execMsg_def 
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">exec'</span> <span class="main">@</span> <span class="main">[</span><span class="free">cMsg</span><span class="main">]</span><span class="main">)</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">⊢</span> <span class="main">(</span><span class="main">(</span><span class="free">trace'</span><span class="main">)</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span> 
        <span class="main">↦</span> <span class="main">(</span><span class="main">(</span><span class="free">exec'</span> <span class="main">@</span> <span class="main">[</span><span class="free">cMsg</span><span class="main">]</span><span class="main">)</span> <span class="main">!</span> <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">exec'</span> <span class="main">@</span> <span class="main">[</span><span class="free">cMsg</span><span class="main">]</span><span class="main">)</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">⊢</span> <span class="main">(</span><span class="main">(</span><span class="free">trace'</span> <span class="main">@</span> <span class="main">[</span><span class="free">msg</span><span class="main">]</span><span class="main">)</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span> 
        <span class="main">↦</span> <span class="main">(</span><span class="main">(</span><span class="free">exec'</span> <span class="main">@</span> <span class="main">[</span><span class="free">cMsg</span><span class="main">]</span><span class="main">)</span> <span class="main">!</span> <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> IlessLen1 TraceMsgEq lessLessTrace traceMsg_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">with</span></span> IlessLen <span class="keyword1"><span class="command">have</span></span> IEqLen1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">i</span> <span class="main">=</span> <span class="main">(</span>length <span class="free">exec'</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">exec'</span> <span class="main">@</span> <span class="main">[</span><span class="free">cMsg</span><span class="main">]</span><span class="main">)</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">⊢</span> <span class="main">(</span><span class="main">(</span><span class="free">trace'</span> <span class="main">@</span> <span class="main">[</span><span class="free">msg</span><span class="main">]</span><span class="main">)</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span> 
        <span class="main">↦</span> <span class="main">(</span><span class="main">(</span><span class="free">exec'</span> <span class="main">@</span> <span class="main">[</span><span class="free">cMsg</span><span class="main">]</span><span class="main">)</span> <span class="main">!</span> <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span>  execMsg_def traceMsg_def  CfgIsReachable Exec'Len 
               ExecLenTraceLen ExecMsgEq ExecMsgLen IlessLen   
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> One_nat_def Suc_eq_plus1 Suc_eq_plus1_left last_conv_nth 
           le_add_diff_inverse length_append less_nat_zero_code list.size<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> 
           list.size<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> nth_append_length<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">hence</span></span> isExecution<span class="main">:</span> <span class="quoted"><span class="quoted">"execution <span class="free">trans</span> <span class="free">sends</span> <span class="free">start</span> <span class="skolem">execMsg</span> <span class="skolem">traceMsg</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> ExecLen ExecMsgLen ExecInit  
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold_locales</span> <span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span><span class="main">)</span> 
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prefixList <span class="free">exec'</span> <span class="skolem">execMsg</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> execMsg_def 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> TailIsPrefixList not_Cons_self2<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prefixList <span class="free">trace'</span> <span class="skolem">traceMsg</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> traceMsg_def 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> TailIsPrefixList not_Cons_self2<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> execMsg_def traceMsg_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> last_snoc<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> asynchronousSystem<span class="main">)</span> expandExecutionReachable<span class="main">:</span>
<span class="keyword2"><span class="keyword">fixes</span></span> 
  <span class="free">cfg</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'p</span><span class="main">,</span> <span class="tfree">'v</span><span class="main">,</span> <span class="tfree">'s</span> <span class="main">)</span> configuration"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">cfgLast</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'p</span><span class="main">,</span> <span class="tfree">'v</span><span class="main">,</span> <span class="tfree">'s</span> <span class="main">)</span> configuration"</span></span>
<span class="keyword2"><span class="keyword">assumes</span></span>
  CfgIsReachable<span class="main">:</span> <span class="quoted"><span class="quoted">"reachable <span class="main">(</span><span class="free">cfgLast</span><span class="main">)</span> <span class="free">cfg</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  ExecIsExecution<span class="main">:</span> <span class="quoted"><span class="quoted">"execution <span class="free">trans</span> <span class="free">sends</span> <span class="free">start</span> <span class="free">exec</span> <span class="free">trace</span>"</span></span>  <span class="keyword2"><span class="keyword">and</span></span>
  ExecLast<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">cfgLast</span> <span class="main">=</span> last <span class="free">exec</span>"</span></span> 
<span class="keyword2"><span class="keyword">shows</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">exec'</span> <span class="bound">trace'</span><span class="main">.</span> <span class="main">(</span>execution <span class="free">trans</span> <span class="free">sends</span> <span class="free">start</span> <span class="bound">exec'</span> <span class="bound">trace'</span><span class="main">)</span> 
  <span class="main">∧</span> <span class="main">(</span><span class="main">(</span>prefixList <span class="free">exec</span> <span class="bound">exec'</span> 
    <span class="main">∧</span> prefixList <span class="free">trace</span> <span class="bound">trace'</span><span class="main">)</span> 
    <span class="main">∨</span> <span class="main">(</span><span class="free">exec</span> <span class="main">=</span> <span class="bound">exec'</span> <span class="main">∧</span> <span class="free">trace</span> <span class="main">=</span> <span class="bound">trace'</span><span class="main">)</span><span class="main">)</span> 
  <span class="main">∧</span> <span class="main">(</span>last <span class="bound">exec'</span><span class="main">)</span> <span class="main">=</span> <span class="free">cfg</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> CfgIsReachable  ExecIsExecution ExecLast 
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">cfgLast</span></span> <span class="quoted"><span class="free">cfg</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> reachable.induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">msg</span> <span class="skolem">cfg3</span> <span class="skolem">exec'</span> <span class="skolem">trace'</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>last <span class="skolem">exec'</span><span class="main">)</span> <span class="main">⊢</span> <span class="skolem">msg</span> <span class="main">↦</span> <span class="skolem">cfg3</span>"</span></span>
         <span class="quoted"><span class="quoted">"execution <span class="free">trans</span> <span class="free">sends</span> <span class="free">start</span> <span class="skolem">exec'</span> <span class="skolem">trace'</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">exec''</span> <span class="bound">trace''</span><span class="main">.</span> <span class="main">(</span>execution <span class="free">trans</span> <span class="free">sends</span> <span class="free">start</span> <span class="bound">exec''</span> <span class="bound">trace''</span><span class="main">)</span> 
    <span class="main">∧</span> <span class="main">(</span>prefixList <span class="skolem">exec'</span> <span class="bound">exec''</span><span class="main">)</span> 
    <span class="main">∧</span> <span class="main">(</span>prefixList <span class="skolem">trace'</span> <span class="bound">trace''</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>last <span class="bound">exec''</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">cfg3</span> 
    <span class="main">∧</span> <span class="main">(</span>last <span class="bound">trace''</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">msg</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> expandExecutionStep<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span>  <span class="skolem"><span class="skolem">exec''</span></span> <span class="skolem"><span class="skolem">trace''</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
    NewExec<span class="main">:</span> <span class="quoted"><span class="quoted">"execution <span class="free">trans</span> <span class="free">sends</span> <span class="free">start</span> <span class="skolem">exec''</span> <span class="skolem">trace''</span>"</span></span> 
             <span class="quoted"><span class="quoted">"prefixList <span class="skolem">exec'</span> <span class="skolem">exec''</span>"</span></span> <span class="quoted"><span class="quoted">"prefixList <span class="skolem">trace'</span> <span class="skolem">trace''</span>"</span></span> 
             <span class="quoted"><span class="quoted">"last <span class="skolem">exec''</span> <span class="main">=</span> <span class="skolem">cfg3</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">assume</span></span> prefixLists<span class="main">:</span> <span class="quoted"><span class="quoted">"prefixList <span class="free">exec</span> <span class="skolem">exec'</span>"</span></span> 
                      <span class="quoted"><span class="quoted">"prefixList <span class="free">trace</span> <span class="skolem">trace'</span>"</span></span> 
  <span class="keyword1"><span class="command">from</span></span> prefixLists<span class="main">(</span>1<span class="main">)</span> NewExec<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prefixList <span class="free">exec</span> <span class="skolem">exec''</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> PrefixListTransitive <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> prefixLists<span class="main">(</span>2<span class="main">)</span> NewExec<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> 
    <span class="quoted"><span class="quoted">"prefixList <span class="free">trace</span> <span class="skolem">trace''</span>"</span></span>  <span class="keyword1"><span class="command">using</span></span> PrefixListTransitive <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">exec''</span> <span class="bound">trace''</span> <span class="main">.</span>
          execution <span class="free">trans</span> <span class="free">sends</span> <span class="free">start</span> <span class="bound">exec''</span> <span class="bound">trace''</span> <span class="main">∧</span>
          <span class="main">(</span><span class="main">(</span>prefixList <span class="free">exec</span> <span class="bound">exec''</span> <span class="main">∧</span> prefixList <span class="free">trace</span> <span class="bound">trace''</span><span class="main">)</span> 
          <span class="main">∨</span> <span class="main">(</span><span class="free">exec</span> <span class="main">=</span> <span class="bound">exec''</span> <span class="main">∧</span> <span class="free">trace</span> <span class="main">=</span> <span class="bound">trace''</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
          last <span class="bound">exec''</span> <span class="main">=</span> <span class="skolem">cfg3</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> NewExec<span class="main">(</span>1<span class="main">)</span> NewExec<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">msg</span> <span class="skolem">cfg3</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>last <span class="free">exec</span><span class="main">)</span> <span class="main">⊢</span> <span class="skolem">msg</span> <span class="main">↦</span> <span class="skolem">cfg3</span>"</span></span> <span class="quoted"><span class="quoted">"execution <span class="free">trans</span> <span class="free">sends</span> <span class="free">start</span> <span class="free">exec</span> <span class="free">trace</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">exec'</span> <span class="bound">trace'</span><span class="main">.</span> execution <span class="free">trans</span> <span class="free">sends</span> <span class="free">start</span> <span class="bound">exec'</span> <span class="bound">trace'</span> <span class="main">∧</span>
       <span class="main">(</span>prefixList <span class="free">exec</span> <span class="bound">exec'</span> <span class="main">∧</span> prefixList <span class="free">trace</span> <span class="bound">trace'</span> 
        <span class="main">∨</span> <span class="free">exec</span> <span class="main">=</span> <span class="bound">exec'</span> <span class="main">∧</span> <span class="free">trace</span> <span class="main">=</span> <span class="bound">trace'</span><span class="main">)</span> <span class="main">∧</span> last <span class="bound">exec'</span> <span class="main">=</span> <span class="skolem">cfg3</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> expandExecutionStep <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> asynchronousSystem<span class="main">)</span> expandExecution<span class="main">:</span>
<span class="keyword2"><span class="keyword">fixes</span></span> 
  <span class="free">cfg</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'p</span><span class="main">,</span> <span class="tfree">'v</span><span class="main">,</span> <span class="tfree">'s</span> <span class="main">)</span> configuration"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">cfgLast</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'p</span><span class="main">,</span> <span class="tfree">'v</span><span class="main">,</span> <span class="tfree">'s</span> <span class="main">)</span> configuration"</span></span>
<span class="keyword2"><span class="keyword">assumes</span></span>
  CfgIsReachable<span class="main">:</span> <span class="quoted"><span class="quoted">"stepReachable <span class="main">(</span>last <span class="free">exec</span><span class="main">)</span> <span class="free">msg</span> <span class="free">cfg</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  ExecIsExecution<span class="main">:</span> <span class="quoted"><span class="quoted">"execution <span class="free">trans</span> <span class="free">sends</span> <span class="free">start</span> <span class="free">exec</span> <span class="free">trace</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">exec'</span> <span class="bound">trace'</span><span class="main">.</span> <span class="main">(</span>execution <span class="free">trans</span> <span class="free">sends</span> <span class="free">start</span> <span class="bound">exec'</span> <span class="bound">trace'</span><span class="main">)</span> 
  <span class="main">∧</span> <span class="main">(</span>prefixList <span class="free">exec</span> <span class="bound">exec'</span><span class="main">)</span> 
  <span class="main">∧</span> <span class="main">(</span>prefixList <span class="free">trace</span> <span class="bound">trace'</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>last <span class="bound">exec'</span><span class="main">)</span> <span class="main">=</span> <span class="free">cfg</span> 
  <span class="main">∧</span> <span class="main">(</span><span class="free">msg</span> <span class="main">∈</span> set <span class="main">(</span>drop <span class="main">(</span>length <span class="free">trace</span><span class="main">)</span> <span class="bound">trace'</span><span class="main">)</span><span class="main">)</span>"</span></span>  
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> CfgIsReachable <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c'</span></span> <span class="skolem"><span class="skolem">c''</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
    Step<span class="main">:</span> <span class="quoted"><span class="quoted">"reachable <span class="main">(</span>last <span class="free">exec</span><span class="main">)</span> <span class="skolem">c'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c'</span> <span class="main">⊢</span> <span class="free">msg</span> <span class="main">↦</span> <span class="skolem">c''</span>"</span></span> <span class="quoted"><span class="quoted">"reachable <span class="skolem">c''</span> <span class="free">cfg</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> stepReachable_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> Step<span class="main">(</span>1<span class="main">)</span> ExecIsExecution <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">exec'</span> <span class="bound">trace'</span> <span class="main">.</span>
    execution <span class="free">trans</span> <span class="free">sends</span> <span class="free">start</span> <span class="bound">exec'</span> <span class="bound">trace'</span> <span class="main">∧</span>
    <span class="main">(</span><span class="main">(</span>prefixList <span class="free">exec</span> <span class="bound">exec'</span> <span class="main">∧</span> prefixList <span class="free">trace</span> <span class="bound">trace'</span><span class="main">)</span> 
    <span class="main">∨</span> <span class="main">(</span><span class="free">exec</span> <span class="main">=</span> <span class="bound">exec'</span> <span class="main">∧</span> <span class="free">trace</span> <span class="main">=</span> <span class="bound">trace'</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
    last <span class="bound">exec'</span> <span class="main">=</span> <span class="skolem">c'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> expandExecutionReachable<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span>  <span class="skolem"><span class="skolem">exec'</span></span> <span class="skolem"><span class="skolem">trace'</span></span> <span class="keyword2"><span class="keyword">where</span></span> Exec'<span class="main">:</span> 
    <span class="quoted"><span class="quoted">"execution <span class="free">trans</span> <span class="free">sends</span> <span class="free">start</span> <span class="skolem">exec'</span> <span class="skolem">trace'</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span>prefixList <span class="free">exec</span> <span class="skolem">exec'</span> <span class="main">∧</span> prefixList <span class="free">trace</span> <span class="skolem">trace'</span><span class="main">)</span> 
      <span class="main">∨</span> <span class="main">(</span><span class="free">exec</span> <span class="main">=</span> <span class="skolem">exec'</span> <span class="main">∧</span> <span class="free">trace</span> <span class="main">=</span> <span class="skolem">trace'</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"last <span class="skolem">exec'</span> <span class="main">=</span> <span class="skolem">c'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> Exec'<span class="main">(</span>1<span class="main">)</span> Exec'<span class="main">(</span>3<span class="main">)</span> Step<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">exec''</span> <span class="bound">trace''</span> <span class="main">.</span> 
    execution <span class="free">trans</span> <span class="free">sends</span> <span class="free">start</span> <span class="bound">exec''</span> <span class="bound">trace''</span> <span class="main">∧</span>
    prefixList <span class="skolem">exec'</span> <span class="bound">exec''</span> <span class="main">∧</span> prefixList <span class="skolem">trace'</span> <span class="bound">trace''</span> 
    <span class="main">∧</span> last <span class="bound">exec''</span> <span class="main">=</span> <span class="skolem">c''</span> <span class="main">∧</span> last <span class="bound">trace''</span> <span class="main">=</span> <span class="free">msg</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> expandExecutionStep<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">exec''</span></span> <span class="skolem"><span class="skolem">trace''</span></span> <span class="keyword2"><span class="keyword">where</span></span> Exec''<span class="main">:</span> 
    <span class="quoted"><span class="quoted">"execution <span class="free">trans</span> <span class="free">sends</span> <span class="free">start</span> <span class="skolem">exec''</span> <span class="skolem">trace''</span>"</span></span>
    <span class="quoted"><span class="quoted">"prefixList <span class="skolem">exec'</span> <span class="skolem">exec''</span>"</span></span> <span class="quoted"><span class="quoted">"prefixList <span class="skolem">trace'</span> <span class="skolem">trace''</span>"</span></span> 
    <span class="quoted"><span class="quoted">"last <span class="skolem">exec''</span> <span class="main">=</span> <span class="skolem">c''</span>"</span></span> <span class="quoted"><span class="quoted">"last <span class="skolem">trace''</span> <span class="main">=</span> <span class="free">msg</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> PrefixLists<span class="main">:</span> <span class="quoted"><span class="quoted">"prefixList <span class="free">exec</span> <span class="skolem">exec''</span> <span class="main">∧</span> prefixList <span class="free">trace</span> <span class="skolem">trace''</span>"</span></span>  
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">exec</span> <span class="main">=</span> <span class="skolem">exec'</span> <span class="main">∧</span> <span class="free">trace</span> <span class="main">=</span> <span class="skolem">trace'</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">with</span></span> Exec'' <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"prefixList <span class="free">exec</span> <span class="skolem">exec''</span> <span class="main">∧</span> prefixList <span class="free">trace</span> <span class="skolem">trace''</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">with</span></span> Exec'<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> Prefix<span class="main">:</span> <span class="quoted"><span class="quoted">"prefixList <span class="free">exec</span> <span class="skolem">exec'</span>"</span></span> 
      <span class="quoted"><span class="quoted">"prefixList <span class="free">trace</span> <span class="skolem">trace'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> Prefix<span class="main">(</span>1<span class="main">)</span> Exec''<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prefixList <span class="free">exec</span> <span class="skolem">exec''</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> PrefixListTransitive <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> Prefix<span class="main">(</span>2<span class="main">)</span> Exec''<span class="main">(</span>3<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span>  <span class="quoted"><span class="quoted">"prefixList <span class="free">exec</span> <span class="skolem">exec''</span> 
      <span class="main">∧</span> prefixList <span class="free">trace</span> <span class="skolem">trace''</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> PrefixListTransitive <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">with</span></span> Exec''<span class="main">(</span>5<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> MsgInTrace''<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">msg</span> <span class="main">∈</span> set <span class="main">(</span>drop <span class="main">(</span>length <span class="free">trace</span><span class="main">)</span> <span class="skolem">trace''</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> PrefixListMonotonicity drop_eq_Nil last_drop 
      last_in_set not_le<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> Step<span class="main">(</span>3<span class="main">)</span> Exec''<span class="main">(</span>1<span class="main">)</span> Exec''<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">exec'''</span> <span class="bound">trace'''</span> <span class="main">.</span>
    execution <span class="free">trans</span> <span class="free">sends</span> <span class="free">start</span> <span class="bound">exec'''</span> <span class="bound">trace'''</span> <span class="main">∧</span>
    <span class="main">(</span><span class="main">(</span>prefixList <span class="skolem">exec''</span> <span class="bound">exec'''</span> <span class="main">∧</span> prefixList <span class="skolem">trace''</span> <span class="bound">trace'''</span><span class="main">)</span> 
    <span class="main">∨</span> <span class="main">(</span><span class="skolem">exec''</span> <span class="main">=</span> <span class="bound">exec'''</span> <span class="main">∧</span> <span class="skolem">trace''</span> <span class="main">=</span> <span class="bound">trace'''</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
    last <span class="bound">exec'''</span> <span class="main">=</span> <span class="free">cfg</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> expandExecutionReachable<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">exec'''</span></span> <span class="skolem"><span class="skolem">trace'''</span></span> <span class="keyword2"><span class="keyword">where</span></span> Exec'''<span class="main">:</span> 
    <span class="quoted"><span class="quoted">"execution <span class="free">trans</span> <span class="free">sends</span> <span class="free">start</span> <span class="skolem">exec'''</span> <span class="skolem">trace'''</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span>prefixList <span class="skolem">exec''</span> <span class="skolem">exec'''</span> <span class="main">∧</span> prefixList <span class="skolem">trace''</span> <span class="skolem">trace'''</span><span class="main">)</span> 
    <span class="main">∨</span> <span class="main">(</span><span class="skolem">exec''</span> <span class="main">=</span> <span class="skolem">exec'''</span> <span class="main">∧</span> <span class="skolem">trace''</span> <span class="main">=</span> <span class="skolem">trace'''</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"last <span class="skolem">exec'''</span> <span class="main">=</span> <span class="free">cfg</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prefixList <span class="free">exec</span> <span class="skolem">exec'''</span> <span class="main">∧</span> prefixList <span class="free">trace</span> <span class="skolem">trace'''</span> 
    <span class="main">∧</span> <span class="free">msg</span> <span class="main">∈</span> set <span class="main">(</span>drop <span class="main">(</span>length <span class="free">trace</span><span class="main">)</span> <span class="skolem">trace'''</span><span class="main">)</span>"</span></span>  
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">exec''</span> <span class="main">=</span> <span class="skolem">exec'''</span> <span class="main">∧</span> <span class="skolem">trace''</span> <span class="main">=</span> <span class="skolem">trace'''</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">with</span></span> PrefixLists MsgInTrace'' 
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"prefixList <span class="free">exec</span> <span class="skolem">exec'''</span> <span class="main">∧</span> prefixList <span class="free">trace</span> <span class="skolem">trace'''</span> 
    <span class="main">∧</span> <span class="free">msg</span> <span class="main">∈</span> set <span class="main">(</span>drop <span class="main">(</span>length <span class="free">trace</span><span class="main">)</span> <span class="skolem">trace'''</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">with</span></span> Exec'''<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> Prefix<span class="main">:</span> <span class="quoted"><span class="quoted">"prefixList <span class="skolem">exec''</span> <span class="skolem">exec'''</span>"</span></span> 
      <span class="quoted"><span class="quoted">"prefixList <span class="skolem">trace''</span> <span class="skolem">trace'''</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> Prefix<span class="main">(</span>1<span class="main">)</span> PrefixLists <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prefixList <span class="free">exec</span> <span class="skolem">exec'''</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> PrefixListTransitive <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> Prefix<span class="main">(</span>2<span class="main">)</span> PrefixLists <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prefixList <span class="free">exec</span> <span class="skolem">exec'''</span> 
      <span class="main">∧</span> prefixList <span class="free">trace</span> <span class="skolem">trace'''</span>"</span></span>  
      <span class="keyword1"><span class="command">using</span></span> PrefixListTransitive <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">msg</span> <span class="main">∈</span> set <span class="main">(</span>drop <span class="main">(</span>length <span class="free">trace</span><span class="main">)</span> <span class="skolem">trace'''</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> Prefix<span class="main">(</span>2<span class="main">)</span> PrefixLists MsgInTrace'' 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>hide_lams<span class="main"><span class="main">,</span></span> no_types<span class="main"><span class="main">)</span></span> PrefixListHasTail append_eq_conv_conj 
         drop_take rev_subsetD set_take_subset<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">with</span></span> Exec'''<span class="main">(</span>1<span class="main">)</span> Exec'''<span class="main">(</span>3<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Infinite and fair executions›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Völzer does not give much attention to the definition of the
  infinite executions. We derive them from finite executions by considering
  infinite executions to be infinite sequence of finite executions increasing
  monotonically w.r.t. the list prefix relation.
›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> asynchronousSystem<span class="main">)</span> <span class="entity">infiniteExecution</span> <span class="main">::</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span>nat <span class="main">⇒</span> <span class="main">(</span><span class="main">(</span><span class="tfree">'p</span><span class="main">,</span> <span class="tfree">'v</span><span class="main">,</span> <span class="tfree">'s</span><span class="main">)</span> configuration list<span class="main">)</span><span class="main">)</span> 
  <span class="main">⇒</span> <span class="main">(</span>nat <span class="main">⇒</span> <span class="main">(</span><span class="main">(</span><span class="tfree">'p</span><span class="main">,</span> <span class="tfree">'v</span><span class="main">)</span> message list<span class="main">)</span><span class="main">)</span> <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">infiniteExecution</span> <span class="free"><span class="bound"><span class="entity">fe</span></span></span> <span class="free"><span class="bound"><span class="entity">ft</span></span></span> <span class="main">≡</span>
    <span class="main">∀</span> <span class="bound">n</span> <span class="main">.</span> execution <span class="free">trans</span> <span class="free">sends</span> <span class="free">start</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">fe</span></span></span> <span class="bound">n</span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ft</span></span></span> <span class="bound">n</span><span class="main">)</span> <span class="main">∧</span> 
      prefixList <span class="main">(</span><span class="free"><span class="bound"><span class="entity">fe</span></span></span> <span class="bound">n</span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">fe</span></span></span> <span class="main">(</span><span class="bound">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
      prefixList <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ft</span></span></span> <span class="bound">n</span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ft</span></span></span> <span class="main">(</span><span class="bound">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> asynchronousSystem<span class="main">)</span> <span class="entity">correctInfinite</span> <span class="main">::</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span>nat <span class="main">⇒</span> <span class="main">(</span><span class="main">(</span><span class="tfree">'p</span><span class="main">,</span> <span class="tfree">'v</span><span class="main">,</span> <span class="tfree">'s</span><span class="main">)</span> configuration list<span class="main">)</span><span class="main">)</span> 
  <span class="main">⇒</span> <span class="main">(</span>nat <span class="main">⇒</span> <span class="main">(</span><span class="main">(</span><span class="tfree">'p</span><span class="main">,</span> <span class="tfree">'v</span><span class="main">)</span> message list<span class="main">)</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'p</span> <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free">correctInfinite</span> <span class="free"><span class="bound"><span class="entity">fe</span></span></span> <span class="free"><span class="bound"><span class="entity">ft</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">≡</span> 
    infiniteExecution <span class="free"><span class="bound"><span class="entity">fe</span></span></span> <span class="free"><span class="bound"><span class="entity">ft</span></span></span>
    <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">n</span> <span class="main">.</span> <span class="main">∀</span> <span class="bound"><span class="bound">n0</span></span> <span class="main">&lt;</span> length <span class="main">(</span><span class="free"><span class="bound"><span class="entity">fe</span></span></span> <span class="bound">n</span><span class="main">)</span><span class="main">.</span> <span class="main">∀</span> <span class="bound">msg</span> <span class="main">.</span><span class="main">(</span>enabled <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">fe</span></span></span> <span class="bound">n</span><span class="main">)</span> <span class="main">!</span> <span class="bound">n0</span><span class="main">)</span> <span class="bound">msg</span><span class="main">)</span> 
    <span class="main">∧</span> isReceiverOf <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="bound">msg</span> 
    <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">msg'</span> <span class="main">.</span> <span class="main">∃</span> <span class="bound"><span class="bound">n'</span></span> <span class="main">≥</span> <span class="bound">n</span> <span class="main">.</span> <span class="main">∃</span> <span class="bound"><span class="bound">n0'</span></span> <span class="main">≥</span> <span class="bound">n0</span> <span class="main">.</span>isReceiverOf <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="bound">msg'</span> 
    <span class="main">∧</span> <span class="bound">n0'</span> <span class="main">&lt;</span> length <span class="main">(</span><span class="free"><span class="bound"><span class="entity">fe</span></span></span> <span class="bound">n'</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">msg'</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">ft</span></span></span> <span class="bound">n'</span><span class="main">)</span> <span class="main">!</span> <span class="bound">n0'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> asynchronousSystem<span class="main">)</span> <span class="entity">fairInfiniteExecution</span> <span class="main">::</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span>nat <span class="main">⇒</span> <span class="main">(</span><span class="main">(</span><span class="tfree">'p</span><span class="main">,</span> <span class="tfree">'v</span><span class="main">,</span> <span class="tfree">'s</span><span class="main">)</span> configuration list<span class="main">)</span><span class="main">)</span> 
  <span class="main">⇒</span> <span class="main">(</span>nat <span class="main">⇒</span> <span class="main">(</span><span class="main">(</span><span class="tfree">'p</span><span class="main">,</span> <span class="tfree">'v</span><span class="main">)</span> message list<span class="main">)</span><span class="main">)</span> <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">fairInfiniteExecution</span> <span class="free"><span class="bound"><span class="entity">fe</span></span></span> <span class="free"><span class="bound"><span class="entity">ft</span></span></span> <span class="main">≡</span>
    infiniteExecution <span class="free"><span class="bound"><span class="entity">fe</span></span></span> <span class="free"><span class="bound"><span class="entity">ft</span></span></span>
    <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">n</span> <span class="main">.</span> <span class="main">∀</span> <span class="bound"><span class="bound">n0</span></span> <span class="main">&lt;</span> length <span class="main">(</span><span class="free"><span class="bound"><span class="entity">fe</span></span></span> <span class="bound">n</span><span class="main">)</span><span class="main">.</span> <span class="main">∀</span> <span class="bound">p</span> <span class="main">.</span> <span class="main">∀</span> <span class="bound">msg</span> <span class="main">.</span> 
      <span class="main">(</span><span class="main">(</span>enabled <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">fe</span></span></span> <span class="bound">n</span><span class="main">)</span> <span class="main">!</span> <span class="bound">n0</span><span class="main">)</span> <span class="bound">msg</span><span class="main">)</span> 
        <span class="main">∧</span> isReceiverOf <span class="bound">p</span> <span class="bound">msg</span> <span class="main">∧</span> correctInfinite <span class="free"><span class="bound"><span class="entity">fe</span></span></span> <span class="free"><span class="bound"><span class="entity">ft</span></span></span> <span class="bound">p</span> <span class="main">)</span> 
      <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span> <span class="bound"><span class="bound">n'</span></span> <span class="main">≥</span> <span class="bound">n</span> <span class="main">.</span> <span class="main">∃</span> <span class="bound"><span class="bound">n0'</span></span> <span class="main">≥</span> <span class="bound">n0</span> <span class="main">.</span> <span class="bound">n0'</span> <span class="main">&lt;</span> length <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ft</span></span></span> <span class="bound">n'</span><span class="main">)</span> 
        <span class="main">∧</span> <span class="main">(</span><span class="bound">msg</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">ft</span></span></span> <span class="bound">n'</span><span class="main">)</span> <span class="main">!</span> <span class="bound">n0'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="FLPSystem">
<div class="head">
<h1>Theory FLPSystem</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹FLPSystem›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  \file{FLPSystem} extends \file{AsynchronousSystem} with concepts of consensus
  and decisions. It develops a concept of non-uniformity regarding pending
  decision possibilities, where non-uniform configurations can always
  reach other non-uniform ones.
›</span></span>

<span class="keyword1"><span class="command">theory</span></span> FLPSystem
<span class="keyword2"><span class="keyword">imports</span></span> <a href="AsynchronousSystem.html">AsynchronousSystem</a> <a href="ListUtilities.html">ListUtilities</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Locale for the FLP consensus setting›</span></span>

<span class="keyword1"><span class="command">locale</span></span> flpSystem <span class="main">=</span>
  asynchronousSystem <span class="quoted"><span class="free">trans</span></span> <span class="quoted"><span class="free">sends</span></span> <span class="quoted"><span class="free">start</span></span>    
    <span class="keyword2"><span class="keyword">for</span></span> <span class="free">trans</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'p</span> <span class="main">⇒</span> <span class="tfree">'s</span> <span class="main">⇒</span> <span class="tfree">'v</span> messageValue <span class="main">⇒</span><span class="tfree">'s</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">sends</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'p</span> <span class="main">⇒</span> <span class="tfree">'s</span> <span class="main">⇒</span> <span class="tfree">'v</span> messageValue <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'p</span><span class="main">,</span> <span class="tfree">'v</span><span class="main">)</span> message multiset"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">start</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'p</span> <span class="main">⇒</span> <span class="tfree">'s</span>"</span></span> <span class="main">+</span>
<span class="keyword2"><span class="keyword">assumes</span></span> finiteProcs<span class="main">:</span> <span class="quoted"><span class="quoted">"finite Proc"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> minimalProcs<span class="main">:</span> <span class="quoted"><span class="quoted">"card Proc <span class="main">≥</span> <span class="numeral">2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> finiteSends<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound">v</span><span class="main">.</span> <span class="bound">v</span> <span class="main">∈#</span> <span class="main">(</span><span class="free">sends</span> <span class="free">p</span> <span class="free">s</span> <span class="free">m</span><span class="main">)</span><span class="main">}</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> noInSends<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">sends</span> <span class="free">p</span> <span class="free">s</span> <span class="free">m</span> <span class="main">&lt;</span><span class="free">p2</span><span class="main">,</span> <span class="keyword1">inM</span> <span class="free">v</span><span class="main">&gt;</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Decidedness and uniformity of configurations›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">vDecided</span> <span class="main">::</span>
  <span class="quoted"><span class="quoted">"bool <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'p</span><span class="main">,</span> <span class="tfree">'v</span><span class="main">,</span> <span class="tfree">'s</span><span class="main">)</span> configuration <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">vDecided</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">cfg</span></span></span> <span class="main">≡</span> initReachable <span class="free"><span class="bound"><span class="entity">cfg</span></span></span> <span class="main">∧</span> <span class="main">(</span><span class="main">&lt;⊥,</span> <span class="keyword1">outM</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">&gt;</span> <span class="main">∈#</span> msgs <span class="free"><span class="bound"><span class="entity">cfg</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">decided</span> <span class="main">::</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'p</span><span class="main">,</span> <span class="tfree">'v</span><span class="main">,</span> <span class="tfree">'s</span><span class="main">)</span> configuration <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">decided</span> <span class="free"><span class="bound"><span class="entity">cfg</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="main">∃</span><span class="bound">v</span> <span class="main">.</span> vDecided <span class="bound">v</span> <span class="free"><span class="bound"><span class="entity">cfg</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">pSilDecVal</span> <span class="main">::</span>
  <span class="quoted"><span class="quoted">"bool <span class="main">⇒</span> <span class="tfree">'p</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'p</span><span class="main">,</span> <span class="tfree">'v</span><span class="main">,</span> <span class="tfree">'s</span><span class="main">)</span> configuration <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">pSilDecVal</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">≡</span> initReachable <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">∧</span> 
    <span class="main">(</span><span class="main">∃</span> <span class="bound">c'</span><span class="main">::</span><span class="main">(</span><span class="tfree">'p</span><span class="main">,</span> <span class="tfree">'v</span><span class="main">,</span> <span class="tfree">'s</span><span class="main">)</span> configuration <span class="main">.</span> <span class="main">(</span>withoutQReachable <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">{</span><span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">}</span> <span class="bound">c'</span><span class="main">)</span> 
    <span class="main">∧</span> vDecided <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="bound">c'</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">pSilentDecisionValues</span> <span class="main">::</span>
  <span class="quoted"><span class="quoted">"<span class="tfree">'p</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'p</span><span class="main">,</span> <span class="tfree">'v</span><span class="main">,</span> <span class="tfree">'s</span><span class="main">)</span> configuration <span class="main">⇒</span> bool set"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">val[</span>_<span class="keyword1">,</span>_<span class="keyword1">]</span>"</span><span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span> 
  <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">val[</span></span><span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main"><span class="free">,</span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main"><span class="free">]</span></span> <span class="main">≡</span> <span class="main">{</span><span class="bound">v</span><span class="main">.</span> pSilDecVal <span class="bound">v</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">vUniform</span> <span class="main">::</span>
  <span class="quoted"><span class="quoted">"bool <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'p</span><span class="main">,</span> <span class="tfree">'v</span><span class="main">,</span> <span class="tfree">'s</span><span class="main">)</span> configuration <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free">vUniform</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">≡</span> initReachable <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">p</span><span class="main">.</span> <span class="keyword1">val[</span><span class="bound">p</span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">]</span> <span class="main">=</span> <span class="main">{</span><span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">}</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">nonUniform</span> <span class="main">::</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'p</span><span class="main">,</span> <span class="tfree">'v</span><span class="main">,</span> <span class="tfree">'s</span><span class="main">)</span> configuration <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">nonUniform</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">≡</span> initReachable <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">∧</span>
    <span class="main">¬</span><span class="main">(</span>vUniform False <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span> <span class="main">∧</span> 
    <span class="main">¬</span><span class="main">(</span>vUniform True <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Agreement, validity, termination›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  Völzer defines consensus in terms of the classical notions
  of agreement, validity, and termination. The proof then mostly applies a
  weakened notion of termination, which we refer to as ,,pseudo termination''.
›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">agreement</span> <span class="main">::</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'p</span><span class="main">,</span> <span class="tfree">'v</span><span class="main">,</span> <span class="tfree">'s</span><span class="main">)</span> configuration <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free">agreement</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">≡</span> 
    <span class="main">(</span><span class="main">∀</span><span class="bound">v1</span><span class="main">.</span> <span class="main">(</span><span class="main">&lt;⊥,</span> <span class="keyword1">outM</span> <span class="bound">v1</span><span class="main">&gt;</span> <span class="main">∈#</span> msgs <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span> 
      <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">v2</span><span class="main">.</span> <span class="main">(</span><span class="main">&lt;⊥,</span> <span class="keyword1">outM</span> <span class="bound">v2</span><span class="main">&gt;</span> <span class="main">∈#</span> msgs <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span> 
        <span class="main">⟷</span> <span class="bound">v2</span> <span class="main">=</span> <span class="bound">v1</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">agreementInit</span> <span class="main">::</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'p</span><span class="main">,</span> <span class="tfree">'v</span><span class="main">,</span> <span class="tfree">'s</span><span class="main">)</span> configuration <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'p</span><span class="main">,</span> <span class="tfree">'v</span><span class="main">,</span> <span class="tfree">'s</span><span class="main">)</span> configuration <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free">agreementInit</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">≡</span> 
    initial <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">∧</span> reachable <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">⟶</span> 
      <span class="main">(</span><span class="main">∀</span><span class="bound">v1</span><span class="main">.</span> <span class="main">(</span><span class="main">&lt;⊥,</span> <span class="keyword1">outM</span> <span class="bound">v1</span><span class="main">&gt;</span> <span class="main">∈#</span> msgs <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span> 
        <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">v2</span><span class="main">.</span> <span class="main">(</span><span class="main">&lt;⊥,</span> <span class="keyword1">outM</span> <span class="bound">v2</span><span class="main">&gt;</span> <span class="main">∈#</span> msgs <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span> 
          <span class="main">⟷</span> <span class="bound">v2</span> <span class="main">=</span> <span class="bound">v1</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">validity</span> <span class="main">::</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'p</span><span class="main">,</span> <span class="tfree">'v</span><span class="main">,</span> <span class="tfree">'s</span><span class="main">)</span> configuration <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'p</span><span class="main">,</span> <span class="tfree">'v</span><span class="main">,</span> <span class="tfree">'s</span><span class="main">)</span> configuration <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">validity</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">≡</span>
    initial <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">∧</span> reachable <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">⟶</span> 
      <span class="main">(</span><span class="main">∀</span><span class="bound">v</span><span class="main">.</span> <span class="main">(</span><span class="main">&lt;⊥,</span> <span class="keyword1">outM</span> <span class="bound">v</span><span class="main">&gt;</span> <span class="main">∈#</span> msgs <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span> 
        <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">p</span><span class="main">.</span> <span class="main">(</span><span class="main">&lt;</span><span class="bound">p</span><span class="main">,</span> <span class="keyword1">inM</span> <span class="bound">v</span><span class="main">&gt;</span> <span class="main">∈#</span> msgs <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  The termination concept which is implied by the concept of "pseudo-consensus"
  in the paper.
›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">terminationPseudo</span> <span class="main">::</span>
  <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'p</span><span class="main">,</span> <span class="tfree">'v</span><span class="main">,</span> <span class="tfree">'s</span><span class="main">)</span> configuration <span class="main">⇒</span> <span class="tfree">'p</span> set <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">terminationPseudo</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="main">(</span>initReachable <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">∧</span> card <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">+</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">≥</span> card Proc<span class="main">)</span> 
    <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">c'</span><span class="main">.</span> qReachable <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="bound">c'</span> <span class="main">∧</span> decided <span class="bound">c'</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Propositions about decisions›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  For every process \var{p} and every configuration that is reachable from an
  initial configuration (i.e. \isb{initReachable} \var{c}) we have
  $\var{val(p,c)} \neq \emptyset$.

  This follows directly from the definition of \var{val} and the definition of
  \isb{terminationPseudo}, which has to be assumed to ensure that there is a
  reachable configuration that is decided.
  
  \voelzer{Proposition 2(a)}
›</span></span>
<span class="keyword1" id="FLPSystem-DecisionValuesExist"><span class="command">lemma</span></span> DecisionValuesExist<span class="main">:</span>
<span class="keyword2"><span class="keyword">fixes</span></span>
  <span class="free">c</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'p</span><span class="main">,</span> <span class="tfree">'v</span><span class="main">,</span> <span class="tfree">'s</span><span class="main">)</span> configuration"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">p</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'p</span>"</span></span> 
<span class="keyword2"><span class="keyword">assumes</span></span>
  Termination<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">cc</span> <span class="bound">Q</span> <span class="main">.</span> terminationPseudo <span class="main">1</span> <span class="bound">cc</span> <span class="bound">Q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  Reachable<span class="main">:</span> <span class="quoted"><span class="quoted">"initReachable <span class="free">c</span>"</span></span>      
<span class="keyword2"><span class="keyword">shows</span></span>
  <span class="quoted"><span class="quoted">"<span class="keyword1">val[</span><span class="free">p</span><span class="main">,</span><span class="free">c</span><span class="main">]</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>  
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> Termination
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>initReachable <span class="free">c</span> <span class="main">∧</span> card Proc <span class="main">≤</span> card <span class="main">(</span>UNIV <span class="main">-</span> <span class="main">{</span><span class="free">p</span><span class="main">}</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> 
      <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">c'</span><span class="main">.</span> qReachable <span class="free">c</span> <span class="main">(</span>UNIV<span class="main">-</span><span class="main">{</span><span class="free">p</span><span class="main">}</span><span class="main">)</span> <span class="bound">c'</span> <span class="main">∧</span> initReachable <span class="bound">c'</span> 
      <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">v</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> msgs <span class="bound">c'</span> <span class="main">&lt;⊥,</span> <span class="keyword1">outM</span> <span class="bound">v</span><span class="main">&gt;</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> terminationPseudo_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> Reachable minimalProcs finiteProcs
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">c'</span><span class="main">.</span> qReachable <span class="free">c</span> <span class="main">(</span>UNIV <span class="main">-</span> <span class="main">{</span><span class="free">p</span><span class="main">}</span><span class="main">)</span> <span class="bound">c'</span> <span class="main">∧</span> initReachable <span class="bound">c'</span> 
    <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">v</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> msgs <span class="bound">c'</span> <span class="main">&lt;⊥,</span> <span class="keyword1">outM</span> <span class="bound">v</span><span class="main">&gt;</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> terminationPseudo_def initReachable_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> pSilDecVal_def 
    <span class="keyword1"><span class="command">using</span></span> Reachable <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  The lemma \isb{DecidedImpliesUniform} proves that every \isb{vDecided}
  configuration \var{c} is also \isb{vUniform}. Völzer claims that this
  follows directly from the definitions of \isb{vDecided} and \isb{vUniform}.
  But this is not quite enough: One must also assume \isb{terminationPseudo}
  and \isb{agreement} for all reachable configurations.

  \voelzer{Proposition 2(b)}
›</span></span>
<span class="keyword1" id="FLPSystem-DecidedImpliesUniform"><span class="command">lemma</span></span> DecidedImpliesUniform<span class="main">:</span>
<span class="keyword2"><span class="keyword">fixes</span></span>
  <span class="free">c</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'p</span><span class="main">,</span> <span class="tfree">'v</span><span class="main">,</span> <span class="tfree">'s</span><span class="main">)</span> configuration"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">v</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"bool"</span></span>
<span class="keyword2"><span class="keyword">assumes</span></span>
  AllAgree<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">cfg</span> <span class="main">.</span> reachable <span class="free">c</span> <span class="bound">cfg</span> <span class="main">⟶</span> agreement <span class="bound">cfg</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  Termination<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">cc</span> <span class="bound">Q</span> <span class="main">.</span> terminationPseudo <span class="main">1</span> <span class="bound">cc</span> <span class="bound">Q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  VDec<span class="main">:</span> <span class="quoted"><span class="quoted">"vDecided <span class="free">v</span> <span class="free">c</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span>
  <span class="quoted"><span class="quoted">"vUniform <span class="free">v</span> <span class="free">c</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> AllAgree VDec <span class="keyword1"><span class="command">unfolding</span></span> agreement_def vUniform_def pSilDecVal_def 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">simp</span> 
  <span class="keyword3"><span class="command">assume</span></span> 
    Agree<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">cfg</span><span class="main">.</span> reachable <span class="free">c</span> <span class="bound">cfg</span> <span class="main">⟶</span>
      <span class="main">(</span><span class="main">∀</span><span class="bound">v1</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> msgs <span class="bound">cfg</span> <span class="main">&lt;⊥,</span> <span class="keyword1">outM</span> <span class="bound">v1</span><span class="main">&gt;</span> 
      <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">v2</span><span class="main">.</span> <span class="main">(</span><span class="main">0</span> <span class="main">&lt;</span> msgs <span class="bound">cfg</span> <span class="main">&lt;⊥,</span> <span class="keyword1">outM</span> <span class="bound">v2</span><span class="main">&gt;</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">v2</span> <span class="main">=</span> <span class="bound">v1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
    vDec<span class="main">:</span> <span class="quoted"><span class="quoted">"initReachable <span class="free">c</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">&lt;</span> msgs <span class="free">c</span> <span class="main">&lt;⊥,</span> <span class="keyword1">outM</span> <span class="free">v</span><span class="main">&gt;</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> 
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">p</span><span class="main">.</span> <span class="main">{</span><span class="bound">v</span><span class="main">.</span> <span class="main">∃</span><span class="bound">c'</span><span class="main">.</span> qReachable <span class="free">c</span> <span class="main">(</span>Proc <span class="main">-</span> <span class="main">{</span><span class="bound">p</span><span class="main">}</span><span class="main">)</span> <span class="bound">c'</span> <span class="main">∧</span> initReachable <span class="bound">c'</span> <span class="main">∧</span> 
      <span class="main">0</span> <span class="main">&lt;</span> msgs <span class="bound">c'</span> <span class="main">&lt;⊥,</span> <span class="keyword1">outM</span> <span class="bound">v</span><span class="main">&gt;</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="free">v</span><span class="main">}</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">clarify</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span> 
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">val[</span><span class="skolem">p</span><span class="main">,</span><span class="free">c</span><span class="main">]</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Termination DecisionValuesExist vDec 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> NotEmpty<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">v</span><span class="main">.</span> <span class="main">∃</span><span class="bound">c'</span><span class="main">.</span> qReachable <span class="free">c</span> <span class="main">(</span>UNIV <span class="main">-</span> <span class="main">{</span><span class="skolem">p</span><span class="main">}</span><span class="main">)</span> <span class="bound">c'</span> 
      <span class="main">∧</span> initReachable <span class="bound">c'</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">&lt;</span> msgs <span class="bound">c'</span> <span class="main">&lt;⊥,</span> <span class="keyword1">outM</span> <span class="bound">v</span><span class="main">&gt;</span><span class="main">}</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> pSilDecVal_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> U<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">u</span> <span class="main">.</span> <span class="bound">u</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">v</span><span class="main">.</span> <span class="main">∃</span><span class="bound">c'</span><span class="main">.</span> qReachable <span class="free">c</span> <span class="main">(</span>UNIV <span class="main">-</span> <span class="main">{</span><span class="skolem">p</span><span class="main">}</span><span class="main">)</span> <span class="bound">c'</span> 
      <span class="main">∧</span> initReachable <span class="bound">c'</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">&lt;</span> msgs <span class="bound">c'</span> <span class="main">&lt;⊥,</span> <span class="keyword1">outM</span> <span class="bound">v</span><span class="main">&gt;</span><span class="main">}</span> <span class="main">⟶</span> <span class="main">(</span><span class="bound">u</span> <span class="main">=</span> <span class="free">v</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">clarify</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">u</span> <span class="skolem">c'</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"qReachable <span class="free">c</span> <span class="main">(</span>UNIV <span class="main">-</span> <span class="main">{</span><span class="skolem">p</span><span class="main">}</span><span class="main">)</span> <span class="skolem">c'</span>"</span></span> <span class="quoted"><span class="quoted">"initReachable <span class="skolem">c'</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> Reach<span class="main">:</span> <span class="quoted"><span class="quoted">"reachable <span class="free">c</span> <span class="skolem">c'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> QReachImplReach <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">from</span></span> VDec <span class="keyword1"><span class="command">have</span></span> Msg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> msgs <span class="free">c</span> <span class="main">&lt;⊥,</span> <span class="keyword1">outM</span> <span class="free">v</span><span class="main">&gt;</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">from</span></span> Reach NoOutMessageLoss <span class="keyword1"><span class="command">have</span></span> 
        <span class="quoted"><span class="quoted">"msgs <span class="free">c</span> <span class="main">&lt;⊥,</span> <span class="keyword1">outM</span> <span class="free">v</span><span class="main">&gt;</span> <span class="main">≤</span> msgs <span class="skolem">c'</span> <span class="main">&lt;⊥,</span> <span class="keyword1">outM</span> <span class="free">v</span><span class="main">&gt;</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> Msg <span class="keyword1"><span class="command">have</span></span> VMsg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> msgs <span class="skolem">c'</span> <span class="main">&lt;⊥,</span> <span class="keyword1">outM</span> <span class="free">v</span><span class="main">&gt;</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> NoOutMessageLoss Reach <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> less_le_trans<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> msgs <span class="skolem">c'</span> <span class="main">&lt;⊥,</span> <span class="keyword1">outM</span> <span class="skolem">u</span><span class="main">&gt;</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> Agree VMsg Reach <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">=</span> <span class="free">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">" <span class="main">{</span><span class="bound">v</span><span class="main">.</span> <span class="main">∃</span><span class="bound">c'</span><span class="main">.</span> qReachable <span class="free">c</span> <span class="main">(</span>UNIV <span class="main">-</span> <span class="main">{</span><span class="skolem">p</span><span class="main">}</span><span class="main">)</span> <span class="bound">c'</span> <span class="main">∧</span> initReachable <span class="bound">c'</span> <span class="main">∧</span> 
      <span class="main">0</span> <span class="main">&lt;</span> msgs <span class="bound">c'</span> <span class="main">&lt;⊥,</span> <span class="keyword1">outM</span> <span class="bound">v</span><span class="main">&gt;</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="free">v</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> NotEmpty U <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> NonUniformImpliesNotDecided<span class="main">:</span>
<span class="keyword2"><span class="keyword">fixes</span></span>
  <span class="free">c</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'p</span><span class="main">,</span> <span class="tfree">'v</span><span class="main">,</span> <span class="tfree">'s</span><span class="main">)</span> configuration"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">v</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"bool"</span></span>
<span class="keyword2"><span class="keyword">assumes</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">cfg</span> <span class="main">.</span> reachable <span class="free">c</span> <span class="bound">cfg</span> <span class="main">⟶</span> agreement <span class="bound">cfg</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">cc</span> <span class="bound">Q</span> <span class="main">.</span> terminationPseudo <span class="main">1</span> <span class="bound">cc</span> <span class="bound">Q</span>"</span></span>
  <span class="quoted"><span class="quoted">"nonUniform <span class="free">c</span>"</span></span>
  <span class="quoted"><span class="quoted">"vDecided <span class="free">v</span> <span class="free">c</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span>
  <span class="quoted"><span class="quoted">"False"</span></span>
<span class="keyword1"><span class="command">using</span></span> DecidedImpliesUniform<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>2<span class="main"><span class="main">,</span></span>4<span class="main"><span class="main">)</span></span><span class="main">]</span> assms<span class="main">(</span>3<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">v</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
      
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  All three parts of Völzer's Proposition 3 consider a single step from an
  arbitrary \isb{initReachable} configuration \var{c} with a message
  $\var{msg}$ to a succeeding configuration \var{c'}.
›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  The silent decision values of a process which is not active in a step only
  decrease or stay the same.
  
  This follows directly from the definitions and the transitivity of the
  reachability properties \isb{reachable} and \isb{qReachable}.

  \voelzer{Proposition 3(a)}
›</span></span>
<span class="keyword1" id="FLPSystem-InactiveProcessSilentDecisionValuesDecrease"><span class="command">lemma</span></span> InactiveProcessSilentDecisionValuesDecrease<span class="main">:</span>
<span class="keyword2"><span class="keyword">fixes</span></span> 
  <span class="free">p</span> <span class="free">q</span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'p</span></span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">c</span> <span class="free">c'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'p</span><span class="main">,</span> <span class="tfree">'v</span><span class="main">,</span> <span class="tfree">'s</span><span class="main">)</span> configuration"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">msg</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'p</span><span class="main">,</span> <span class="tfree">'v</span><span class="main">)</span> message"</span></span>
<span class="keyword2"><span class="keyword">assumes</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="free">q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">⊢</span> <span class="free">msg</span> <span class="main">↦</span> <span class="free">c'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="quoted"><span class="quoted">"isReceiverOf <span class="free">p</span> <span class="free">msg</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="quoted"><span class="quoted">"initReachable <span class="free">c</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> 
  <span class="quoted"><span class="quoted">"<span class="keyword1">val[</span><span class="free">q</span><span class="main">,</span><span class="free">c'</span><span class="main">]</span> <span class="main">⊆</span> <span class="keyword1">val[</span><span class="free">q</span><span class="main">,</span><span class="free">c</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pSilDecVal_def assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">cfg'</span>
  <span class="keyword3"><span class="command">assume</span></span> 
    Msg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> msgs <span class="skolem">cfg'</span> <span class="main">&lt;⊥,</span> <span class="keyword1">outM</span> <span class="skolem">x</span><span class="main">&gt;</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
    Cfg'<span class="main">:</span> <span class="quoted"><span class="quoted">"qReachable <span class="free">c'</span> <span class="main">(</span>Proc <span class="main">-</span> <span class="main">{</span><span class="free">q</span><span class="main">}</span><span class="main">)</span> <span class="skolem">cfg'</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"initReachable <span class="free">c'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms initReachable_def reachable.simps 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> Init<span class="main">:</span> <span class="quoted"><span class="quoted">"initReachable <span class="skolem">cfg'</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> Cfg' initReachable_def QReachImplReach<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">c'</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Proc <span class="main">-</span> <span class="main">{</span><span class="free">q</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="skolem">cfg'</span></span><span class="main">]</span> 
    ReachableTrans <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> Proc <span class="main">-</span> <span class="main">{</span><span class="free">q</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"qReachable <span class="free">c</span> <span class="main">(</span>Proc <span class="main">-</span> <span class="main">{</span><span class="free">q</span><span class="main">}</span><span class="main">)</span> <span class="free">c'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms qReachable.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"qReachable <span class="free">c</span> <span class="main">(</span>Proc <span class="main">-</span> <span class="main">{</span><span class="free">q</span><span class="main">}</span><span class="main">)</span> <span class="skolem">cfg'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Cfg' QReachableTrans
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">with</span></span> Msg Init <span class="keyword3"><span class="command">show</span></span> 
    <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">c'a</span><span class="main">.</span> qReachable <span class="free">c</span> <span class="main">(</span>Proc <span class="main">-</span> <span class="main">{</span><span class="free">q</span><span class="main">}</span><span class="main">)</span> <span class="bound">c'a</span> 
      <span class="main">∧</span> initReachable <span class="bound">c'a</span> <span class="main">∧</span> 
      <span class="main">0</span> <span class="main">&lt;</span> msgs <span class="bound">c'a</span> <span class="main">&lt;⊥,</span> <span class="keyword1">outM</span> <span class="skolem">x</span><span class="main">&gt;</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  ...while the silent decision values of the process which is active in
  a step may only increase or stay the same.
  
  This follows as stated in \cite{Voelzer} from the \emph{diamond property}
  for a reachable configuration and a single step, i.e. \isb{DiamondTwo},
  and in addition from the fact that output messages cannot get lost, i.e.
  \isb{NoOutMessageLoss}.

  \voelzer{Proposition 3(b)}
›</span></span>
<span class="keyword1" id="FLPSystem-ActiveProcessSilentDecisionValuesIncrease"><span class="command">lemma</span></span> ActiveProcessSilentDecisionValuesIncrease <span class="main">:</span>
<span class="keyword2"><span class="keyword">fixes</span></span> 
  <span class="free">p</span> <span class="free">q</span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'p</span></span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">c</span> <span class="free">c'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'p</span><span class="main">,</span> <span class="tfree">'v</span><span class="main">,</span> <span class="tfree">'s</span><span class="main">)</span> configuration"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">msg</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'p</span><span class="main">,</span> <span class="tfree">'v</span><span class="main">)</span> message"</span></span>
<span class="keyword2"><span class="keyword">assumes</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="free">q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">⊢</span> <span class="free">msg</span> <span class="main">↦</span> <span class="free">c'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="quoted"><span class="quoted">"isReceiverOf <span class="free">p</span> <span class="free">msg</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="quoted"><span class="quoted">"initReachable <span class="free">c</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">val[</span><span class="free">q</span><span class="main">,</span><span class="free">c</span><span class="main">]</span> <span class="main">⊆</span> <span class="keyword1">val[</span><span class="free">q</span><span class="main">,</span><span class="free">c'</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pSilDecVal_def assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms initReachable_def reachable.simps <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"initReachable <span class="free">c'</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">meson</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">cv</span> 
  <span class="keyword3"><span class="command">assume</span></span> Cv<span class="main">:</span> <span class="quoted"><span class="quoted">"qReachable <span class="free">c</span> <span class="main">(</span>Proc <span class="main">-</span> <span class="main">{</span><span class="free">q</span><span class="main">}</span><span class="main">)</span> <span class="skolem">cv</span>"</span></span> <span class="quoted"><span class="quoted">"initReachable <span class="skolem">cv</span>"</span></span> 
    <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> msgs <span class="skolem">cv</span> <span class="main">&lt;⊥,</span> <span class="keyword1">outM</span> <span class="skolem">x</span><span class="main">&gt;</span>"</span></span> 
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">c'a</span><span class="main">.</span> <span class="main">(</span><span class="skolem">cv</span> <span class="main">⊢</span> <span class="free">msg</span> <span class="main">↦</span> <span class="bound">c'a</span><span class="main">)</span> <span class="main">∧</span> qReachable <span class="free">c'</span> <span class="main">(</span>Proc <span class="main">-</span> <span class="main">{</span><span class="free">q</span><span class="main">}</span><span class="main">)</span> <span class="bound">c'a</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> DiamondTwo Cv<span class="main">(</span>1<span class="main">)</span> assms 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c''</span></span> <span class="keyword2"><span class="keyword">where</span></span> C''<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">cv</span> <span class="main">⊢</span> <span class="free">msg</span> <span class="main">↦</span> <span class="skolem">c''</span><span class="main">)</span>"</span></span> 
    <span class="quoted"><span class="quoted">"qReachable <span class="free">c'</span> <span class="main">(</span>Proc <span class="main">-</span> <span class="main">{</span><span class="free">q</span><span class="main">}</span><span class="main">)</span> <span class="skolem">c''</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> Cv<span class="main">(</span>2<span class="main">)</span> initReachable_def reachable.simps
    <span class="keyword1"><span class="command">have</span></span> Init<span class="main">:</span> <span class="quoted"><span class="quoted">"initReachable <span class="skolem">c''</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"reachable <span class="skolem">cv</span> <span class="skolem">c''</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> C''<span class="main">(</span>1<span class="main">)</span> reachable.intros <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>      
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"msgs <span class="skolem">cv</span> <span class="main">&lt;⊥,</span> <span class="keyword1">outM</span> <span class="skolem">x</span><span class="main">&gt;</span> <span class="main">≤</span> msgs <span class="skolem">c''</span> <span class="main">&lt;⊥,</span> <span class="keyword1">outM</span> <span class="skolem">x</span><span class="main">&gt;</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> NoOutMessageLoss 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> msgs <span class="skolem">c''</span> <span class="main">&lt;⊥,</span> <span class="keyword1">outM</span> <span class="skolem">x</span><span class="main">&gt;</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Cv<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">c'a</span><span class="main">.</span> qReachable <span class="free">c'</span> <span class="main">(</span>Proc <span class="main">-</span> <span class="main">{</span><span class="free">q</span><span class="main">}</span><span class="main">)</span> <span class="bound">c'a</span>  
    <span class="main">∧</span> initReachable <span class="bound">c'a</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">&lt;</span> msgs <span class="bound">c'a</span> <span class="main">&lt;⊥,</span> <span class="keyword1">outM</span> <span class="skolem">x</span><span class="main">&gt;</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> C''<span class="main">(</span>2<span class="main">)</span> Init <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  As a result from the previous two propositions, the silent decision values
  of a process cannot go from {0} to {1} or vice versa in a step.

  This is a slightly more generic version of Proposition 3 (c) from
  \cite{Voelzer} since it is proven for both values, while Völzer is only
  interested in the situation starting with $\var{val(q,c) = \{0\}}$.

  \voelzer{Proposition 3(c)}
›</span></span>
<span class="keyword1" id="FLPSystem-SilentDecisionValueNotInverting"><span class="command">lemma</span></span> SilentDecisionValueNotInverting<span class="main">:</span>
<span class="keyword2"><span class="keyword">fixes</span></span> 
  <span class="free">p</span> <span class="free">q</span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'p</span></span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">c</span> <span class="free">c'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'p</span><span class="main">,</span> <span class="tfree">'v</span><span class="main">,</span> <span class="tfree">'s</span><span class="main">)</span> configuration"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">msg</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'p</span><span class="main">,</span> <span class="tfree">'v</span><span class="main">)</span> message"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">v</span> <span class="main">::</span> <span class="quoted">bool</span>
<span class="keyword2"><span class="keyword">assumes</span></span> 
  Val<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">val[</span><span class="free">q</span><span class="main">,</span><span class="free">c</span><span class="main">]</span> <span class="main">=</span> <span class="main">{</span><span class="free">v</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  Step<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">⊢</span> <span class="free">msg</span> <span class="main">↦</span> <span class="free">c'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  Rec<span class="main">:</span>  <span class="quoted"><span class="quoted">"isReceiverOf <span class="free">p</span> <span class="free">msg</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  Init<span class="main">:</span> <span class="quoted"><span class="quoted">"initReachable <span class="free">c</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> 
  <span class="quoted"><span class="quoted">"<span class="keyword1">val[</span><span class="free">q</span><span class="main">,</span><span class="free">c'</span><span class="main">]</span> <span class="main">≠</span> <span class="main">{</span><span class="main">¬</span> <span class="free">v</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="free">q</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">val[</span><span class="free">q</span><span class="main">,</span><span class="free">c'</span><span class="main">]</span> <span class="main">⊆</span> <span class="keyword1">val[</span><span class="free">q</span><span class="main">,</span><span class="free">c</span><span class="main">]</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Step Rec InactiveProcessSilentDecisionValuesDecrease Init <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> Val <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">val[</span><span class="free">q</span><span class="main">,</span><span class="free">c'</span><span class="main">]</span> <span class="main">≠</span> <span class="main">{</span><span class="main">¬</span> <span class="free">v</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">val[</span><span class="free">q</span><span class="main">,</span><span class="free">c</span><span class="main">]</span> <span class="main">⊆</span> <span class="keyword1">val[</span><span class="free">q</span><span class="main">,</span><span class="free">c'</span><span class="main">]</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Step Rec ActiveProcessSilentDecisionValuesIncrease Init <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> Val <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">val[</span><span class="free">q</span><span class="main">,</span><span class="free">c'</span><span class="main">]</span> <span class="main">≠</span> <span class="main">{</span><span class="main">¬</span> <span class="free">v</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Towards a proof of FLP›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  There is an \isb{initial} configuration that is \isb{nonUniform} under
  the assumption of \isb{validity}, \isb{agreement} and \isb{terminationPseudo}.

  The lemma is used in the proof of the main theorem to construct the
  \isb{non\-Uni\-form} and \isb{initial} configuration that leads to the
  final contradiction.

  \voelzer{Lemma 1}
›</span></span>
<span class="keyword1" id="FLPSystem-InitialNonUniformCfg"><span class="command">lemma</span></span> InitialNonUniformCfg<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span>
  Termination<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">cc</span> <span class="bound">Q</span> <span class="main">.</span> terminationPseudo <span class="main">1</span> <span class="bound">cc</span> <span class="bound">Q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  Validity<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">i</span> <span class="bound">c</span> <span class="main">.</span> validity <span class="bound">i</span> <span class="bound">c</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  Agreement<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">i</span> <span class="bound">c</span> <span class="main">.</span> agreementInit <span class="bound">i</span> <span class="bound">c</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> 
  <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">cfg</span> <span class="main">.</span> initial <span class="bound">cfg</span> <span class="main">∧</span> nonUniform <span class="bound">cfg</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span><span class="main">::</span><span class="quoted">nat</span> <span class="keyword2"><span class="keyword">where</span></span> N<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> card Proc"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">procList</span><span class="main">::</span><span class="main">(</span><span class="tfree">'p</span> list<span class="main">)</span><span class="main">.</span> length <span class="bound">procList</span> <span class="main">=</span> <span class="skolem">n</span> <span class="main">∧</span> set <span class="bound">procList</span> <span class="main">=</span> Proc 
    <span class="main">∧</span> distinct <span class="bound">procList</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> finiteProcs 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> distinct_card finite_distinct_list<span class="main">)</span>  
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">procList</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
    ProcList<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="skolem">procList</span> <span class="main">=</span> <span class="skolem">n</span>"</span></span> <span class="quoted"><span class="quoted">"set <span class="skolem">procList</span> <span class="main">=</span> Proc"</span></span> 
      <span class="quoted"><span class="quoted">"distinct <span class="skolem">procList</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> AllPInProclist<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">p</span><span class="main">.</span> <span class="main">∃</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span><span class="skolem">n</span><span class="main">.</span> <span class="skolem">procList</span> <span class="main">!</span> <span class="bound">i</span> <span class="main">=</span> <span class="bound">p</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ProcList N 
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span>
    <span class="keyword3"><span class="command">assume</span></span> Asm<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">procList</span> <span class="main">=</span> Proc"</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">procList</span> <span class="main">=</span> card Proc"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> set <span class="skolem">procList</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ProcList <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> Asm in_set_conv_nth
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span>card Proc<span class="main">.</span> <span class="skolem">procList</span> <span class="main">!</span> <span class="bound">i</span> <span class="main">=</span> <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> NGr0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> N finiteProcs minimalProcs <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">initMsg</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'p</span><span class="main">,</span> <span class="tfree">'v</span><span class="main">)</span> message <span class="main">⇒</span> nat"</span></span>
    <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">initMsg</span> <span class="skolem">ind</span> <span class="skolem">m</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">∃</span><span class="bound">p</span><span class="main">.</span> <span class="skolem">m</span> <span class="main">=</span> <span class="main">&lt;</span><span class="bound">p</span><span class="main">,</span> <span class="keyword1">inM</span> <span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span><span class="skolem">ind</span><span class="main">.</span> <span class="skolem">procList</span><span class="main">!</span><span class="bound">i</span> <span class="main">=</span> <span class="bound">p</span><span class="main">)</span><span class="main">&gt;</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">ind</span> <span class="skolem">m</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">initCfgList</span></span>
    <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">initCfgList</span> <span class="main">=</span> map <span class="main">(</span><span class="main">λ</span><span class="bound">ind</span><span class="main">.</span> <span class="main">⦇</span>states <span class="main">=</span> <span class="free">start</span><span class="main">,</span> msgs <span class="main">=</span> <span class="skolem">initMsg</span> <span class="bound">ind</span><span class="main">⦈</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="main">(</span><span class="skolem">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> InitCfgLength<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="skolem">initCfgList</span> <span class="main">=</span> <span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> initCfgList_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> InitCfgNonEmpty<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">initCfgList</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>  
    <span class="keyword1"><span class="command">unfolding</span></span> initCfgList_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> InitCfgStart<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">c</span> <span class="main">∈</span> set <span class="skolem">initCfgList</span><span class="main">.</span> states <span class="bound">c</span> <span class="main">=</span> <span class="free">start</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> initCfgList_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> InitCfgSet<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">initCfgList</span> <span class="main">=</span> 
    <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">∃</span><span class="bound"><span class="bound">ind</span></span> <span class="main">&lt;</span> <span class="skolem">n</span><span class="main">+</span><span class="main">1</span><span class="main">.</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">⦇</span>states <span class="main">=</span> <span class="free">start</span><span class="main">,</span> msgs <span class="main">=</span> <span class="skolem">initMsg</span> <span class="bound">ind</span><span class="main">⦈</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> initCfgList_def
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ind</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ind</span> <span class="main">&lt;</span> <span class="skolem">n</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">inda</span></span><span class="main">&lt;</span>Suc <span class="skolem">n</span><span class="main">.</span> <span class="bound">inda</span> <span class="main">=</span> <span class="skolem">ind</span> <span class="main">∧</span> <span class="skolem">initMsg</span> <span class="skolem">ind</span> <span class="main">=</span> <span class="skolem">initMsg</span> <span class="bound">inda</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">inda</span></span><span class="main">&lt;</span>Suc <span class="skolem">n</span><span class="main">.</span> <span class="skolem">initMsg</span> <span class="skolem">ind</span> <span class="main">=</span> <span class="skolem">initMsg</span> <span class="bound">inda</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ind</span>
    <span class="keyword3"><span class="command">assume</span></span> Asm<span class="main">:</span>
      <span class="quoted"><span class="quoted">"<span class="main">⦇</span>states <span class="main">=</span> <span class="free">start</span><span class="main">,</span> msgs <span class="main">=</span> <span class="skolem">initMsg</span> <span class="skolem">ind</span><span class="main">⦈</span> <span class="main">∉</span> <span class="main">(</span><span class="main">λ</span><span class="bound">ind</span><span class="main">::</span>nat<span class="main">.</span> <span class="main">⦇</span>states <span class="main">=</span> <span class="free">start</span><span class="main">,</span> msgs <span class="main">=</span> <span class="skolem">initMsg</span> <span class="bound">ind</span><span class="main">⦈</span><span class="main">)</span> <span class="main">`</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="skolem">n</span><span class="main">}</span>"</span></span>
      <span class="quoted"><span class="quoted">"<span class="skolem">ind</span> <span class="main">&lt;</span> Suc <span class="skolem">n</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ind</span> <span class="main">≥</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> Asm <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ind</span> <span class="main">=</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">initMsg</span> <span class="skolem">ind</span> <span class="main">=</span> <span class="skolem">initMsg</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> InitInitial<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">c</span> <span class="main">∈</span> set <span class="skolem">initCfgList</span> <span class="main">.</span> initial <span class="bound">c</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> initial_def initCfgList_def initMsg_def <span class="keyword1"><span class="command">using</span></span> InitCfgStart
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> InitCfgSet <span class="keyword1"><span class="command">have</span></span> InitInitReachable<span class="main">:</span> 
    <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">c</span> <span class="main">∈</span> set <span class="skolem">initCfgList</span> <span class="main">.</span> initReachable <span class="bound">c</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> reachable.simps
    <span class="keyword1"><span class="command">unfolding</span></span> initReachable_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">c0</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c0</span> <span class="main">=</span> <span class="skolem">initCfgList</span> <span class="main">!</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c0</span> <span class="main">=</span> <span class="main">⦇</span> states <span class="main">=</span> <span class="free">start</span><span class="main">,</span> msgs <span class="main">=</span> <span class="skolem">initMsg</span> <span class="main">0</span> <span class="main">⦈</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> InitCfgLength nth_map_upt<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">0</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">+</span><span class="main">1</span>"</span></span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">unfolding</span></span> initCfgList_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> MsgC0<span class="main">:</span> <span class="quoted"><span class="quoted">"msgs <span class="skolem">c0</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">m</span><span class="main">.</span> <span class="keyword1">if</span> <span class="main">∃</span><span class="bound">p</span><span class="main">.</span> <span class="bound">m</span> <span class="main">=</span> <span class="main">&lt;</span><span class="bound">p</span><span class="main">,</span> <span class="keyword1">inM</span> False<span class="main">&gt;</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> initMsg_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">cN</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">cN</span> <span class="main">=</span> <span class="skolem">initCfgList</span> <span class="main">!</span> <span class="skolem">n</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">cN</span> <span class="main">=</span> <span class="main">⦇</span> states <span class="main">=</span> <span class="free">start</span><span class="main">,</span> msgs <span class="main">=</span> <span class="skolem">initMsg</span> <span class="skolem">n</span><span class="main">⦈</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> InitCfgLength nth_map_upt<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">n</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">+</span><span class="main">1</span>"</span></span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">unfolding</span></span> initCfgList_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> MsgCN<span class="main">:</span> <span class="quoted"><span class="quoted">"msgs <span class="skolem">cN</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">m</span><span class="main">.</span> <span class="keyword1">if</span> <span class="main">∃</span><span class="bound">p</span><span class="main">.</span> <span class="bound">m</span> <span class="main">=</span> <span class="main">&lt;</span><span class="bound">p</span><span class="main">,</span> <span class="keyword1">inM</span> True<span class="main">&gt;</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> initMsg_def
    <span class="keyword1"><span class="command">using</span></span> AllPInProclist
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">have</span></span> C0NotCN<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c0</span> <span class="main">≠</span> <span class="skolem">cN</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c0</span> <span class="main">=</span> <span class="skolem">cN</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> StrangeEq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">m</span><span class="main">::</span><span class="main">(</span><span class="tfree">'p</span><span class="main">,</span> <span class="tfree">'v</span><span class="main">)</span> message<span class="main">.</span>
        <span class="keyword1">if</span> <span class="main">∃</span><span class="bound">p</span><span class="main">.</span> <span class="bound">m</span> <span class="main">=</span> <span class="main">&lt;</span><span class="bound">p</span><span class="main">,</span> <span class="keyword1">inM</span> False<span class="main">&gt;</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span> <span class="main">::</span> nat<span class="main">)</span> <span class="main">=</span>
      <span class="main">(</span><span class="main">λ</span><span class="bound">m</span><span class="main">.</span> <span class="keyword1">if</span> <span class="main">∃</span><span class="bound">p</span><span class="main">.</span> <span class="bound">m</span> <span class="main">=</span> <span class="main">&lt;</span><span class="bound">p</span><span class="main">,</span> <span class="keyword1">inM</span> True<span class="main">&gt;</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> InitCfgLength N minimalProcs MsgC0 MsgCN 
      <span class="keyword1"><span class="command">unfolding</span></span> c0_def cN_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"False"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> message.inject<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> zero_neq_one<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">have</span></span> C0NAreUniform<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">cX</span> <span class="main">.</span> <span class="main">(</span><span class="bound">cX</span> <span class="main">=</span> <span class="skolem">c0</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="bound">cX</span> <span class="main">=</span> <span class="skolem">cN</span><span class="main">)</span> 
                      <span class="main">⟹</span> vUniform <span class="main">(</span><span class="bound">cX</span> <span class="main">=</span> <span class="skolem">cN</span><span class="main">)</span> <span class="bound">cX</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">cX</span>
    <span class="keyword3"><span class="command">assume</span></span> xIs0OrN<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">cX</span> <span class="main">=</span> <span class="skolem">c0</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="skolem">cX</span> <span class="main">=</span> <span class="skolem">cN</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> xInit<span class="main">:</span> <span class="quoted"><span class="quoted">"initial <span class="skolem">cX</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> InitCfgLength InitCfgSet set_conv_nth<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">initCfgList</span></span><span class="main">]</span> xIs0OrN
      <span class="keyword1"><span class="command">unfolding</span></span> c0_def cN_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> InitInitial<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> Validity
      <span class="keyword1"><span class="command">have</span></span> COnlyReachesOneDecision<span class="main">:</span>
        <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">c</span> <span class="main">.</span> reachable <span class="skolem">cX</span> <span class="bound">c</span> <span class="main">∧</span> decided <span class="bound">c</span> <span class="main">⟶</span> <span class="main">(</span>vDecided <span class="main">(</span><span class="skolem">cX</span> <span class="main">=</span> <span class="skolem">cN</span><span class="main">)</span> <span class="bound">c</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> validity_def initReachable_def
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c</span> <span class="skolem">cfg0</span> <span class="skolem">v</span>
      <span class="keyword3"><span class="command">assume</span></span>
        Validity<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">i</span> <span class="bound">c</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span>initial <span class="bound">i</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>reachable <span class="bound">i</span> <span class="bound">c</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span>
          <span class="main">(</span><span class="main">∀</span><span class="bound">v</span><span class="main">.</span> <span class="main">(</span><span class="main">0</span> <span class="main">&lt;</span> msgs <span class="bound">c</span> <span class="main">(</span><span class="main">&lt;⊥,</span> <span class="keyword1">outM</span> <span class="bound">v</span><span class="main">&gt;</span><span class="main">)</span><span class="main">)</span> 
          <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">p</span><span class="main">.</span> <span class="main">(</span><span class="main">0</span> <span class="main">&lt;</span> msgs <span class="bound">i</span> <span class="main">(</span><span class="main">&lt;</span><span class="bound">p</span><span class="main">,</span> <span class="keyword1">inM</span> <span class="bound">v</span><span class="main">&gt;</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
        OutMsg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> msgs <span class="skolem">c</span> <span class="main">&lt;⊥,</span> <span class="keyword1">outM</span> <span class="skolem">v</span><span class="main">&gt;</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
        InitCXReachable<span class="main">:</span> <span class="quoted"><span class="quoted">"reachable <span class="skolem">cX</span> <span class="skolem">c</span>"</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> msgs <span class="skolem">c</span> <span class="main">&lt;⊥,</span> <span class="keyword1">outM</span> <span class="main">(</span><span class="skolem">cX</span> <span class="main">=</span> <span class="skolem">cN</span><span class="main">)</span><span class="main">&gt;</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> xIs0OrN 
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">cX</span> <span class="main">=</span> <span class="skolem">cN</span><span class="main">)</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">≠</span> <span class="main">(</span><span class="skolem">cX</span> <span class="main">=</span> <span class="skolem">cN</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> vDef<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">cX</span> <span class="main">≠</span> <span class="skolem">cN</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">with</span></span> Validity InitCXReachable OutMsg xInit
          <span class="keyword1"><span class="command">have</span></span> ExistMsg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">p</span><span class="main">.</span> <span class="main">(</span><span class="main">0</span> <span class="main">&lt;</span> msgs <span class="skolem">cX</span> <span class="main">(</span><span class="main">&lt;</span><span class="bound">p</span><span class="main">,</span> <span class="keyword1">inM</span> <span class="main">(</span><span class="skolem">cX</span> <span class="main">≠</span> <span class="skolem">cN</span><span class="main">)</span><span class="main">&gt;</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">with</span></span> initMsg_def <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span>
          <span class="keyword1"><span class="command">using</span></span> xIs0OrN
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> MsgC0 MsgCN C0NotCN<span class="main">)</span> 
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> msgs <span class="skolem">c</span> <span class="main">&lt;⊥,</span> <span class="keyword1">outM</span> <span class="skolem">cX</span> <span class="main">=</span> <span class="skolem">cN</span><span class="main">&gt;</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">have</span></span> InitRInitC<span class="main">:</span> <span class="quoted"><span class="quoted">"initReachable <span class="skolem">cX</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> xInit InitialIsInitReachable 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> NoWrongDecs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">v</span> <span class="bound">p</span> <span class="bound">cc</span><span class="main">::</span><span class="main">(</span><span class="tfree">'p</span><span class="main">,</span> <span class="tfree">'v</span><span class="main">,</span> <span class="tfree">'s</span><span class="main">)</span> configuration<span class="main">.</span>
      qReachable <span class="skolem">cX</span> <span class="main">(</span>Proc <span class="main">-</span> <span class="main">{</span><span class="bound">p</span><span class="main">}</span><span class="main">)</span> <span class="bound">cc</span> <span class="main">∧</span> initReachable <span class="bound">cc</span> 
      <span class="main">∧</span> <span class="main">0</span> <span class="main">&lt;</span> msgs <span class="bound">cc</span> <span class="main">&lt;⊥,</span> <span class="keyword1">outM</span> <span class="bound">v</span><span class="main">&gt;</span> 
        <span class="main">⟹</span> <span class="bound">v</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">cX</span> <span class="main">=</span> <span class="skolem">cN</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">clarify</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">v</span> <span class="skolem">p</span> <span class="skolem">cc</span>
      <span class="keyword3"><span class="command">assume</span></span> Asm<span class="main">:</span> <span class="quoted"><span class="quoted">"qReachable <span class="skolem">cX</span> <span class="main">(</span>Proc <span class="main">-</span> <span class="main">{</span><span class="skolem">p</span><span class="main">}</span><span class="main">)</span> <span class="skolem">cc</span>"</span></span> <span class="quoted"><span class="quoted">"initReachable <span class="skolem">cc</span>"</span></span> 
      <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> msgs <span class="skolem">cc</span> <span class="main">&lt;⊥,</span> <span class="keyword1">outM</span> <span class="skolem">v</span><span class="main">&gt;</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"reachable <span class="skolem">cX</span> <span class="skolem">cc</span>"</span></span> <span class="quoted"><span class="quoted">"decided <span class="skolem">cc</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> QReachImplReach <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span>vDecided <span class="main">(</span><span class="skolem">cX</span> <span class="main">≠</span> <span class="skolem">cN</span><span class="main">)</span> <span class="skolem">cc</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> COnlyReachesOneDecision Agreement Asm C0NotCN xInit xIs0OrN
        <span class="keyword1"><span class="command">unfolding</span></span> agreementInit_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
      <span class="keyword1"><span class="command">with</span></span> Asm C0NotCN xIs0OrN <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">cX</span> <span class="main">=</span> <span class="skolem">cN</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> neq0_conv<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">have</span></span> ExRightDecs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">p</span><span class="main">.</span> <span class="main">∃</span><span class="bound">cc</span><span class="main">.</span> qReachable <span class="main">(</span><span class="skolem">cX</span><span class="main">)</span> <span class="main">(</span>Proc <span class="main">-</span> <span class="main">{</span><span class="bound">p</span><span class="main">}</span><span class="main">)</span> <span class="bound">cc</span>
      <span class="main">∧</span> initReachable <span class="bound">cc</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">&lt;</span> msgs <span class="bound">cc</span> <span class="main">&lt;⊥,</span> <span class="keyword1">outM</span> <span class="main">(</span><span class="skolem">cX</span> <span class="main">=</span> <span class="skolem">cN</span><span class="main">)</span><span class="main">&gt;</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">cc</span><span class="main">::</span><span class="main">(</span><span class="tfree">'p</span><span class="main">,</span> <span class="tfree">'v</span><span class="main">,</span> <span class="tfree">'s</span><span class="main">)</span> configuration<span class="main">.</span>
           qReachable <span class="skolem">cX</span> <span class="main">(</span>Proc <span class="main">-</span> <span class="main">{</span><span class="skolem">p</span><span class="main">}</span><span class="main">)</span> <span class="bound">cc</span> <span class="main">∧</span> initReachable <span class="bound">cc</span> 
           <span class="main">∧</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">&lt;</span> msgs <span class="bound">cc</span> <span class="main">&lt;⊥,</span> <span class="keyword1">outM</span> <span class="skolem">cX</span> <span class="main">=</span> <span class="skolem">cN</span><span class="main">&gt;</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> Termination<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">cX</span>"</span></span> <span class="quoted"><span class="quoted">"Proc <span class="main">-</span> <span class="main">{</span><span class="skolem">p</span><span class="main">}</span>"</span></span><span class="main">]</span> finiteProcs minimalProcs 
          InitRInitC
        <span class="keyword1"><span class="command">unfolding</span></span> terminationPseudo_def
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">auto</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">cc</span> <span class="skolem">v</span>
        <span class="keyword3"><span class="command">assume</span></span> 
          Asm<span class="main">:</span> <span class="quoted"><span class="quoted">"initReachable <span class="skolem">cX</span>"</span></span> <span class="quoted"><span class="quoted">"qReachable <span class="main">(</span><span class="skolem">cX</span><span class="main">)</span> <span class="main">(</span>Proc <span class="main">-</span> <span class="main">{</span><span class="skolem">p</span><span class="main">}</span><span class="main">)</span> <span class="skolem">cc</span>"</span></span>
          <span class="quoted"><span class="quoted">"initReachable <span class="skolem">cc</span>"</span></span>  <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> msgs <span class="skolem">cc</span> <span class="main">&lt;⊥,</span> <span class="keyword1">outM</span> <span class="skolem">v</span><span class="main">&gt;</span>"</span></span>
        <span class="keyword1"><span class="command">with</span></span> COnlyReachesOneDecision<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">cc</span>"</span></span><span class="main">]</span> QReachImplReach
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> msgs <span class="skolem">cc</span> <span class="main">&lt;⊥,</span> <span class="keyword1">outM</span> <span class="skolem">cX</span> <span class="main">=</span> <span class="skolem">cN</span><span class="main">&gt;</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">with</span></span> Asm
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">cc</span><span class="main">::</span><span class="main">(</span><span class="tfree">'p</span><span class="main">,</span> <span class="tfree">'v</span><span class="main">,</span> <span class="tfree">'s</span><span class="main">)</span> configuration<span class="main">.</span> 
            qReachable <span class="skolem">cX</span> <span class="main">(</span>Proc <span class="main">-</span> <span class="main">{</span><span class="skolem">p</span><span class="main">}</span><span class="main">)</span> <span class="bound">cc</span>
            <span class="main">∧</span> initReachable <span class="bound">cc</span> <span class="main">∧</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">&lt;</span> msgs <span class="bound">cc</span> <span class="main">&lt;⊥,</span> <span class="keyword1">outM</span> <span class="skolem">cX</span> <span class="main">=</span> <span class="skolem">cN</span><span class="main">&gt;</span>"</span></span> 
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">have</span></span> ZeroinPSilent<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">p</span> <span class="bound">v</span> <span class="main">.</span> <span class="bound">v</span> <span class="main">∈</span> <span class="keyword1">val[</span><span class="bound">p</span><span class="main">,</span> <span class="skolem">cX</span><span class="main">]</span> <span class="main">⟷</span> <span class="bound">v</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">cX</span> <span class="main">=</span> <span class="skolem">cN</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">clarify</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span> <span class="skolem">v</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> <span class="keyword1">val[</span><span class="skolem">p</span><span class="main">,</span> <span class="skolem">cX</span><span class="main">]</span> <span class="main">⟷</span> <span class="skolem">v</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">cX</span> <span class="main">=</span> <span class="skolem">cN</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> pSilDecVal_def
        <span class="keyword1"><span class="command">using</span></span> InitRInitC xIs0OrN C0NotCN NoWrongDecs ExRightDecs <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"vUniform <span class="main">(</span><span class="skolem">cX</span> <span class="main">=</span> <span class="skolem">cN</span><span class="main">)</span> <span class="skolem">cX</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> InitRInitC 
      <span class="keyword1"><span class="command">unfolding</span></span> vUniform_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">hence</span></span>
    C0Is0Uniform<span class="main">:</span> <span class="quoted"><span class="quoted">"vUniform False <span class="skolem">c0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    CNNot0Uniform<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> vUniform False <span class="skolem">cN</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> C0NAreUniform <span class="keyword1"><span class="command">unfolding</span></span> vUniform_def <span class="keyword1"><span class="command">using</span></span> C0NotCN <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound"><span class="bound">j</span></span> <span class="main">&lt;</span> <span class="skolem">n</span><span class="main">.</span> vUniform False <span class="main">(</span><span class="skolem">initCfgList</span> <span class="main">!</span> <span class="bound">j</span><span class="main">)</span> 
    <span class="main">∧</span> <span class="main">¬</span><span class="main">(</span>vUniform False <span class="main">(</span><span class="skolem">initCfgList</span> <span class="main">!</span> Suc <span class="bound">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> c0_def cN_def
    <span class="keyword1"><span class="command">using</span></span> NatPredicateTippingPoint
      <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">n</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> vUniform False <span class="main">(</span><span class="skolem">initCfgList</span> <span class="main">!</span> <span class="bound">x</span><span class="main">)</span>"</span></span><span class="main">]</span> NGr0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">j</span></span>
    <span class="keyword2"><span class="keyword">where</span></span> J<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> <span class="skolem">n</span>"</span></span>
      <span class="quoted"><span class="quoted">"vUniform False <span class="main">(</span><span class="skolem">initCfgList</span> <span class="main">!</span> <span class="skolem">j</span><span class="main">)</span>"</span></span>
      <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span>vUniform False <span class="main">(</span><span class="skolem">initCfgList</span> <span class="main">!</span> Suc <span class="skolem">j</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">pJ</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">pJ</span> <span class="main">=</span> <span class="skolem">procList</span> <span class="main">!</span> <span class="skolem">j</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">cJ</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">cJ</span> <span class="main">=</span> <span class="skolem">initCfgList</span> <span class="main">!</span> <span class="skolem">j</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> cJDef<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">cJ</span> <span class="main">=</span> <span class="main">⦇</span> states <span class="main">=</span> <span class="free">start</span><span class="main">,</span> msgs <span class="main">=</span> <span class="skolem">initMsg</span> <span class="skolem">j</span><span class="main">⦈</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> J<span class="main">(</span>1<span class="main">)</span> InitCfgLength nth_map_upt<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">0</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span><span class="main">-</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span> 
      nth_map_upt<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">unfolding</span></span> initCfgList_def 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> MsgCJ<span class="main">:</span> <span class="quoted"><span class="quoted">"msgs <span class="skolem">cJ</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">m</span><span class="main">::</span><span class="main">(</span><span class="tfree">'p</span><span class="main">,</span> <span class="tfree">'v</span><span class="main">)</span> message<span class="main">.</span>
    <span class="keyword1">if</span> <span class="main">∃</span><span class="bound">p</span><span class="main">::</span><span class="tfree">'p</span><span class="main">.</span> <span class="bound">m</span> <span class="main">=</span> <span class="main">&lt;</span><span class="bound">p</span><span class="main">,</span> <span class="keyword1">inM</span> <span class="main">∃</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span><span class="skolem">j</span><span class="main">.</span> <span class="skolem">procList</span> <span class="main">!</span> <span class="bound">i</span> <span class="main">=</span> <span class="bound">p</span><span class="main">&gt;</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span>nat
    <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> initMsg_def
    <span class="keyword1"><span class="command">using</span></span> AllPInProclist
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">cJ1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">cJ1</span> <span class="main">=</span> <span class="skolem">initCfgList</span> <span class="main">!</span> <span class="main">(</span>Suc <span class="skolem">j</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> cJ1Def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">cJ1</span> <span class="main">=</span> <span class="main">⦇</span> states <span class="main">=</span> <span class="free">start</span><span class="main">,</span> msgs <span class="main">=</span> <span class="skolem">initMsg</span> <span class="main">(</span>Suc <span class="skolem">j</span><span class="main">)</span><span class="main">⦈</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> J<span class="main">(</span>1<span class="main">)</span> InitCfgLength nth_map_upt<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">0</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span>"</span></span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span> 
    nth_map_upt<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">+</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">unfolding</span></span> initCfgList_def 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> MsgCJ1<span class="main">:</span> <span class="quoted"><span class="quoted">"msgs <span class="skolem">cJ1</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">m</span><span class="main">::</span><span class="main">(</span><span class="tfree">'p</span><span class="main">,</span> <span class="tfree">'v</span><span class="main">)</span> message<span class="main">.</span>
    <span class="keyword1">if</span> <span class="main">∃</span><span class="bound">p</span><span class="main">::</span><span class="tfree">'p</span><span class="main">.</span> <span class="bound">m</span> <span class="main">=</span> <span class="main">&lt;</span><span class="bound">p</span><span class="main">,</span> <span class="keyword1">inM</span> <span class="main">∃</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span><span class="main">(</span>Suc <span class="skolem">j</span><span class="main">)</span><span class="main">.</span> <span class="skolem">procList</span> <span class="main">!</span> <span class="bound">i</span> <span class="main">=</span> <span class="bound">p</span><span class="main">&gt;</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span>nat
    <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> initMsg_def
    <span class="keyword1"><span class="command">using</span></span> AllPInProclist
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> CJ1Init<span class="main">:</span> <span class="quoted"><span class="quoted">"initial <span class="skolem">cJ1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> InitInitial<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">cJ1</span></span><span class="main">]</span>  J<span class="main">(</span>1<span class="main">)</span> InitCfgLength 
    <span class="keyword1"><span class="command">unfolding</span></span> cJ1_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> CJ1InitR<span class="main">:</span> <span class="quoted"><span class="quoted">"initReachable <span class="skolem">cJ1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> InitialIsInitReachable <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> ValPj0<span class="main">:</span> <span class="quoted"><span class="quoted">"False <span class="main">∈</span> <span class="keyword1">val[</span><span class="skolem">pJ</span><span class="main">,</span> <span class="skolem">cJ</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> J<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> cJ_def vUniform_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">cc</span><span class="main">.</span> vDecided False <span class="bound">cc</span> <span class="main">∧</span> withoutQReachable <span class="skolem">cJ</span> <span class="main">{</span><span class="skolem">pJ</span><span class="main">}</span> <span class="bound">cc</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> pSilDecVal_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">cc</span></span>
    <span class="keyword2"><span class="keyword">where</span></span> CC<span class="main">:</span> <span class="quoted"><span class="quoted">"vDecided False <span class="skolem">cc</span>"</span></span> <span class="quoted"><span class="quoted">"withoutQReachable <span class="skolem">cJ</span> <span class="main">{</span><span class="skolem">pJ</span><span class="main">}</span> <span class="skolem">cc</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">Q</span><span class="main">.</span> qReachable <span class="skolem">cJ</span> <span class="bound">Q</span> <span class="skolem">cc</span> <span class="main">∧</span> <span class="bound">Q</span> <span class="main">=</span> Proc <span class="main">-</span> <span class="main">{</span><span class="skolem">pJ</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ccQ</span></span> <span class="keyword2"><span class="keyword">where</span></span> CCQ<span class="main">:</span> <span class="quoted"><span class="quoted">"qReachable <span class="skolem">cJ</span> <span class="skolem">ccQ</span> <span class="skolem">cc</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ccQ</span> <span class="main">=</span> Proc <span class="main">-</span> <span class="main">{</span><span class="skolem">pJ</span><span class="main">}</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> StatescJcJ1<span class="main">:</span> <span class="quoted"><span class="quoted">"states <span class="skolem">cJ</span> <span class="main">=</span> states <span class="skolem">cJ1</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span>  cJ_def cJ1_def initCfgList_def  
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> InitCfgLength InitCfgStart J<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> Suc_eq_plus1 Suc_mono 
      less_SucI nth_mem<span class="main">)</span> 
  <span class="keyword1"><span class="command">have</span></span> Distinct<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">i</span> <span class="main">.</span> distinct <span class="skolem">procList</span> <span class="main">⟹</span> <span class="bound">i</span><span class="main">&lt;</span><span class="skolem">j</span> 
    <span class="main">⟹</span> <span class="skolem">procList</span> <span class="main">!</span> <span class="bound">i</span> <span class="main">=</span> <span class="skolem">procList</span> <span class="main">!</span> <span class="skolem">j</span> <span class="main">⟹</span> False"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> J<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> ProcList<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> distinct_conv_nth less_trans 
       not_less_iff_gr_or_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"msgs <span class="skolem">cJ</span> <span class="main">(</span><span class="main">&lt;</span><span class="skolem">pJ</span> <span class="main">,</span><span class="keyword1">inM</span> False<span class="main">&gt;</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> pJ_def ProcList J<span class="main">(</span>1<span class="main">)</span> MsgCJ <span class="keyword1"><span class="command">using</span></span> Distinct <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"msgs <span class="skolem">cJ1</span> <span class="main">(</span><span class="main">&lt;</span><span class="skolem">pJ</span> <span class="main">,</span><span class="keyword1">inM</span> True<span class="main">&gt;</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> pJ_def ProcList J<span class="main">(</span>1<span class="main">)</span> MsgCJ1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> C<span class="main">:</span> <span class="quoted"><span class="quoted">"msgs <span class="skolem">cJ</span> <span class="main">(</span><span class="main">&lt;</span><span class="skolem">pJ</span> <span class="main">,</span><span class="keyword1">inM</span> True<span class="main">&gt;</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> pJ_def ProcList J<span class="main">(</span>1<span class="main">)</span> MsgCJ <span class="keyword1"><span class="command">using</span></span> Distinct <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
  <span class="keyword1"><span class="command">have</span></span> D<span class="main">:</span> <span class="quoted"><span class="quoted">"msgs <span class="skolem">cJ1</span> <span class="main">(</span><span class="main">&lt;</span><span class="skolem">pJ</span> <span class="main">,</span><span class="keyword1">inM</span> False<span class="main">&gt;</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> pJ_def ProcList J<span class="main">(</span>1<span class="main">)</span> MsgCJ1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">msgsCJ'</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="skolem">msgsCJ'</span> <span class="skolem">m</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">m</span> <span class="main">=</span> <span class="main">(</span><span class="main">&lt;</span><span class="skolem">pJ</span> <span class="main">,</span><span class="keyword1">inM</span> False<span class="main">&gt;</span><span class="main">)</span> <span class="main">∨</span> <span class="skolem">m</span> <span class="main">=</span> <span class="main">(</span><span class="main">&lt;</span><span class="skolem">pJ</span> <span class="main">,</span><span class="keyword1">inM</span> True<span class="main">&gt;</span><span class="main">)</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="main">(</span>msgs <span class="skolem">cJ</span><span class="main">)</span> <span class="skolem">m</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">m</span>
  <span class="keyword1"><span class="command">have</span></span> MsgsCJ'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">msgsCJ'</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>msgs <span class="skolem">cJ</span><span class="main">)</span> <span class="main">-#</span> <span class="main">(</span><span class="main">&lt;</span><span class="skolem">pJ</span> <span class="main">,</span><span class="keyword1">inM</span> False<span class="main">&gt;</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> A C msgsCJ'_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> AllOther<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">m</span> <span class="main">.</span> <span class="skolem">msgsCJ'</span> <span class="bound">m</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>msgs <span class="skolem">cJ1</span><span class="main">)</span> <span class="main">-#</span> <span class="main">(</span><span class="main">&lt;</span><span class="skolem">pJ</span> <span class="main">,</span><span class="keyword1">inM</span> True<span class="main">&gt;</span><span class="main">)</span><span class="main">)</span> <span class="bound">m</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> B D MsgCJ1 MsgCJ  J<span class="main">(</span>1<span class="main">)</span> N ProcList AllPInProclist 
    <span class="keyword1"><span class="command">unfolding</span></span> msgsCJ'_def pJ_def
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">m</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">if</span> <span class="skolem">m</span> <span class="main">=</span> <span class="main">&lt;</span><span class="skolem">procList</span> <span class="main">!</span> <span class="skolem">j</span><span class="main">,</span> <span class="keyword1">inM</span> False<span class="main">&gt;</span> <span class="main">∨</span> 
        <span class="skolem">m</span> <span class="main">=</span> <span class="main">&lt;</span><span class="skolem">procList</span> <span class="main">!</span> <span class="skolem">j</span><span class="main">,</span> <span class="keyword1">inM</span> True<span class="main">&gt;</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> msgs <span class="skolem">cJ</span> <span class="skolem">m</span><span class="main">)</span> 
      <span class="main">=</span> <span class="main">(</span>msgs <span class="skolem">cJ1</span> <span class="main">-#</span> <span class="main">&lt;</span><span class="skolem">procList</span> <span class="main">!</span> <span class="skolem">j</span><span class="main">,</span> <span class="keyword1">inM</span> True<span class="main">&gt;</span><span class="main">)</span> <span class="skolem">m</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">=</span> <span class="main">&lt;</span><span class="skolem">procList</span> <span class="main">!</span> <span class="skolem">j</span><span class="main">,</span> <span class="keyword1">inM</span> False<span class="main">&gt;</span> <span class="main">∨</span> <span class="skolem">m</span> 
      <span class="main">=</span> <span class="main">&lt;</span><span class="skolem">procList</span> <span class="main">!</span> <span class="skolem">j</span><span class="main">,</span> <span class="keyword1">inM</span> True<span class="main">&gt;</span>"</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span><span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="main">(</span>msgs <span class="skolem">cJ1</span> <span class="main">&lt;</span><span class="skolem">procList</span> <span class="main">!</span> <span class="skolem">j</span><span class="main">,</span> <span class="keyword1">inM</span> False<span class="main">&gt;</span><span class="main">)</span>"</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> D pJ_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> less_nat_zero_code<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"msgs <span class="skolem">cJ1</span> <span class="main">&lt;</span><span class="skolem">procList</span> <span class="main">!</span> <span class="skolem">j</span><span class="main">,</span> <span class="keyword1">inM</span> True<span class="main">&gt;</span> <span class="main">≤</span> Suc <span class="main">0</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> B One_nat_def order_refl pJ_def<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> AssumpMJ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">≠</span> <span class="main">&lt;</span><span class="skolem">procList</span> <span class="main">!</span> <span class="skolem">j</span><span class="main">,</span> <span class="keyword1">inM</span> False<span class="main">&gt;</span>"</span></span> 
                       <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">≠</span> <span class="main">&lt;</span><span class="skolem">procList</span> <span class="main">!</span> <span class="skolem">j</span><span class="main">,</span> <span class="keyword1">inM</span> True<span class="main">&gt;</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">if</span> <span class="main">∃</span><span class="bound">p</span><span class="main">.</span> <span class="skolem">m</span> <span class="main">=</span> <span class="main">&lt;</span><span class="bound">p</span><span class="main">,</span> <span class="keyword1">inM</span> <span class="main">∃</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span><span class="skolem">j</span><span class="main">.</span> <span class="skolem">procList</span> <span class="main">!</span> <span class="bound">i</span> <span class="main">=</span> <span class="bound">p</span><span class="main">&gt;</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>
           <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">∃</span><span class="bound">p</span><span class="main">.</span> <span class="skolem">m</span> <span class="main">=</span> <span class="main">&lt;</span><span class="bound">p</span><span class="main">,</span> <span class="keyword1">inM</span> <span class="main">∃</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span>Suc <span class="skolem">j</span><span class="main">.</span> <span class="skolem">procList</span> <span class="main">!</span> <span class="bound">i</span> <span class="main">=</span> <span class="bound">p</span><span class="main">&gt;</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">m</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_Suc_eq<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"msgs <span class="skolem">cJ</span> <span class="skolem">m</span> <span class="main">=</span> msgs <span class="skolem">cJ1</span> <span class="skolem">m</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> MsgCJ MsgCJ1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="comment1">― ‹of AllOther›</span>

  <span class="keyword1"><span class="command">with</span></span> MsgsCJ' <span class="keyword1"><span class="command">have</span></span> InitMsgs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>msgs <span class="skolem">cJ</span><span class="main">)</span> <span class="main">-#</span> <span class="main">(</span><span class="main">&lt;</span><span class="skolem">pJ</span> <span class="main">,</span><span class="keyword1">inM</span> False<span class="main">&gt;</span><span class="main">)</span><span class="main">)</span> 
    <span class="main">=</span> <span class="main">(</span><span class="main">(</span>msgs <span class="skolem">cJ1</span><span class="main">)</span> <span class="main">-#</span> <span class="main">(</span><span class="main">&lt;</span><span class="skolem">pJ</span><span class="main">,</span> <span class="keyword1">inM</span> True<span class="main">&gt;</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
  <span class="keyword1"><span class="command">hence</span></span> F<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">(</span>msgs <span class="skolem">cJ</span><span class="main">)</span> <span class="main">-#</span> <span class="main">(</span><span class="main">&lt;</span><span class="skolem">pJ</span> <span class="main">,</span><span class="keyword1">inM</span> False<span class="main">&gt;</span><span class="main">)</span><span class="main">)</span> <span class="main">∪#</span> <span class="main">(</span><span class="main">{#</span><span class="main">&lt;</span><span class="skolem">pJ</span><span class="main">,</span> <span class="keyword1">inM</span> True<span class="main">&gt;</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
    <span class="main">(</span><span class="main">(</span><span class="main">(</span>msgs <span class="skolem">cJ1</span><span class="main">)</span> <span class="main">-#</span> <span class="main">(</span><span class="main">&lt;</span><span class="skolem">pJ</span><span class="main">,</span> <span class="keyword1">inM</span> True<span class="main">&gt;</span><span class="main">)</span><span class="main">)</span>  <span class="main">∪#</span> <span class="main">(</span><span class="main">{#</span><span class="main">&lt;</span><span class="skolem">pJ</span><span class="main">,</span> <span class="keyword1">inM</span> True<span class="main">&gt;</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> B <span class="keyword1"><span class="command">have</span></span> One<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">(</span>msgs <span class="skolem">cJ1</span><span class="main">)</span> <span class="main">-#</span> <span class="main">(</span><span class="main">&lt;</span><span class="skolem">pJ</span><span class="main">,</span> <span class="keyword1">inM</span> True<span class="main">&gt;</span><span class="main">)</span><span class="main">)</span> 
    <span class="main">∪#</span> <span class="main">(</span><span class="main">{#</span><span class="main">&lt;</span><span class="skolem">pJ</span><span class="main">,</span> <span class="keyword1">inM</span> True<span class="main">&gt;</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span><span class="skolem">pJ</span><span class="main">,</span> <span class="keyword1">inM</span> True<span class="main">&gt;</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> B <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">m</span> <span class="main">::</span> <span class="main">(</span><span class="tfree">'p</span><span class="main">,</span> <span class="tfree">'v</span><span class="main">)</span> message <span class="main">.</span> <span class="main">(</span>msgs <span class="skolem">cJ1</span><span class="main">)</span> <span class="bound">m</span> 
    <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span>msgs <span class="skolem">cJ1</span><span class="main">)</span> <span class="main">-#</span> <span class="main">(</span><span class="main">&lt;</span><span class="skolem">pJ</span><span class="main">,</span> <span class="keyword1">inM</span> True<span class="main">&gt;</span><span class="main">)</span><span class="main">)</span>  <span class="main">∪#</span> 
    <span class="main">(</span><span class="main">{#</span><span class="main">&lt;</span><span class="skolem">pJ</span><span class="main">,</span> <span class="keyword1">inM</span> True<span class="main">&gt;</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="bound">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> B <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">(</span>msgs <span class="skolem">cJ1</span><span class="main">)</span> <span class="main">-#</span> <span class="main">(</span><span class="main">&lt;</span><span class="skolem">pJ</span><span class="main">,</span> <span class="keyword1">inM</span> True<span class="main">&gt;</span><span class="main">)</span><span class="main">)</span>  <span class="main">∪#</span> <span class="main">(</span><span class="main">{#</span><span class="main">&lt;</span><span class="skolem">pJ</span><span class="main">,</span> <span class="keyword1">inM</span> True<span class="main">&gt;</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> 
    <span class="main">=</span> <span class="main">(</span>msgs <span class="skolem">cJ1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> F <span class="keyword1"><span class="command">have</span></span> InitMsgs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">(</span>msgs <span class="skolem">cJ</span><span class="main">)</span> <span class="main">-#</span> <span class="main">(</span><span class="main">&lt;</span><span class="skolem">pJ</span> <span class="main">,</span><span class="keyword1">inM</span> False<span class="main">&gt;</span><span class="main">)</span><span class="main">)</span> 
    <span class="main">∪#</span> <span class="main">(</span><span class="main">{#</span><span class="main">&lt;</span><span class="skolem">pJ</span><span class="main">,</span> <span class="keyword1">inM</span> True<span class="main">&gt;</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>msgs <span class="skolem">cJ1</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">cc'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">cc'</span> <span class="main">=</span> <span class="main">⦇</span>states <span class="main">=</span> <span class="main">(</span>states <span class="skolem">cc</span><span class="main">)</span><span class="main">,</span>
    msgs <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span>msgs <span class="skolem">cc</span><span class="main">)</span> <span class="main">-#</span> <span class="main">(</span><span class="main">&lt;</span><span class="skolem">pJ</span><span class="main">,</span><span class="keyword1">inM</span> False<span class="main">&gt;</span><span class="main">)</span><span class="main">)</span> <span class="main">∪#</span> <span class="main">{#</span> <span class="main">(</span><span class="main">&lt;</span><span class="skolem">pJ</span><span class="main">,</span> <span class="keyword1">inM</span> True<span class="main">&gt;</span><span class="main">)</span><span class="main">}</span><span class="main">)</span><span class="main">⦈</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>qReachable <span class="skolem">cJ</span> <span class="skolem">ccQ</span> <span class="skolem">cc</span><span class="main">;</span> <span class="skolem">ccQ</span> <span class="main">=</span> Proc <span class="main">-</span> <span class="main">{</span><span class="skolem">pJ</span><span class="main">}</span><span class="main">;</span> 
    <span class="main">(</span><span class="main">(</span><span class="main">(</span>msgs <span class="skolem">cJ</span><span class="main">)</span> <span class="main">-#</span> <span class="main">(</span><span class="main">&lt;</span><span class="skolem">pJ</span> <span class="main">,</span><span class="keyword1">inM</span> False<span class="main">&gt;</span><span class="main">)</span><span class="main">)</span> <span class="main">∪#</span> <span class="main">(</span><span class="main">{#</span><span class="main">&lt;</span><span class="skolem">pJ</span><span class="main">,</span> <span class="keyword1">inM</span> True<span class="main">&gt;</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> 
      <span class="main">=</span> <span class="main">(</span>msgs <span class="skolem">cJ1</span><span class="main">)</span><span class="main">;</span> states <span class="skolem">cJ</span> <span class="main">=</span> states <span class="skolem">cJ1</span><span class="main">⟧</span> 
      <span class="main">⟹</span> withoutQReachable <span class="skolem">cJ1</span> <span class="main">{</span><span class="skolem">pJ</span><span class="main">}</span> <span class="main">⦇</span>states <span class="main">=</span> <span class="main">(</span>states <span class="skolem">cc</span><span class="main">)</span><span class="main">,</span> 
      msgs <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span>msgs <span class="skolem">cc</span><span class="main">)</span> <span class="main">-#</span> <span class="main">(</span><span class="main">&lt;</span><span class="skolem">pJ</span><span class="main">,</span><span class="keyword1">inM</span> False<span class="main">&gt;</span><span class="main">)</span><span class="main">)</span> <span class="main">∪#</span> <span class="main">{#</span> <span class="main">(</span><span class="main">&lt;</span><span class="skolem">pJ</span><span class="main">,</span> <span class="keyword1">inM</span> True<span class="main">&gt;</span><span class="main">)</span><span class="main">}</span><span class="main">)</span> <span class="main">⦈</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> qReachable.induct<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">cfg1</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'p</span><span class="main">,</span> <span class="tfree">'v</span><span class="main">,</span> <span class="tfree">'s</span><span class="main">)</span> configuration"</span></span> 
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">Q</span>
      <span class="keyword3"><span class="command">assume</span></span> 
        Assm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">(</span>msgs <span class="skolem">cfg1</span><span class="main">)</span> <span class="main">-#</span><span class="main">(</span><span class="main">&lt;</span><span class="skolem">pJ</span><span class="main">,</span> <span class="keyword1">inM</span> False<span class="main">&gt;</span><span class="main">)</span><span class="main">)</span> <span class="main">∪#</span> <span class="main">{#</span> <span class="main">&lt;</span><span class="skolem">pJ</span><span class="main">,</span> <span class="keyword1">inM</span> True<span class="main">&gt;</span> <span class="main">}</span><span class="main">)</span>
        <span class="main">=</span> msgs <span class="skolem">cJ1</span>"</span></span> 
        <span class="quoted"><span class="quoted">"states <span class="skolem">cfg1</span> <span class="main">=</span> states <span class="skolem">cJ1</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> CJ1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">cJ1</span> <span class="main">=</span> <span class="main">⦇</span>states <span class="main">=</span> states <span class="skolem">cfg1</span><span class="main">,</span> 
        msgs <span class="main">=</span> <span class="main">(</span><span class="main">(</span>msgs <span class="skolem">cfg1</span><span class="main">)</span> <span class="main">-#</span> <span class="main">&lt;</span><span class="skolem">pJ</span><span class="main">,</span> <span class="keyword1">inM</span> False<span class="main">&gt;</span><span class="main">)</span> <span class="main">∪#</span> <span class="main">{#</span> <span class="main">&lt;</span><span class="skolem">pJ</span><span class="main">,</span> <span class="keyword1">inM</span> True<span class="main">&gt;</span> <span class="main">}</span><span class="main">⦈</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"qReachable <span class="skolem">cJ1</span>  <span class="main">(</span>Proc <span class="main">-</span> <span class="main">{</span><span class="skolem">pJ</span><span class="main">}</span><span class="main">)</span> <span class="skolem">cJ1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> qReachable.simps 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">with</span></span> Assm <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"qReachable <span class="skolem">cJ1</span> <span class="main">(</span>Proc <span class="main">-</span> <span class="main">{</span><span class="skolem">pJ</span><span class="main">}</span><span class="main">)</span>
        <span class="main">⦇</span>states <span class="main">=</span> states <span class="skolem">cfg1</span><span class="main">,</span> msgs <span class="main">=</span> <span class="main">(</span><span class="main">(</span>msgs <span class="skolem">cfg1</span><span class="main">)</span> <span class="main">-#</span> <span class="main">&lt;</span><span class="skolem">pJ</span><span class="main">,</span> <span class="keyword1">inM</span> False<span class="main">&gt;</span><span class="main">)</span> 
        <span class="main">∪#</span> <span class="main">{#</span> <span class="main">&lt;</span><span class="skolem">pJ</span><span class="main">,</span> <span class="keyword1">inM</span> True<span class="main">&gt;</span> <span class="main">}</span><span class="main">⦈</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> CJ1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">cfg1</span> <span class="skolem">cfg2</span> <span class="skolem">cfg3</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'p</span><span class="main">,</span> <span class="tfree">'v</span><span class="main">,</span> <span class="tfree">'s</span><span class="main">)</span> configuration"</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">msg</span>
      <span class="keyword3"><span class="command">assume</span></span> Q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Q</span> <span class="main">=</span> <span class="main">(</span>Proc <span class="main">-</span> <span class="main">{</span><span class="skolem">pJ</span><span class="main">}</span><span class="main">)</span>"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">(</span>msgs <span class="skolem">cfg1</span><span class="main">)</span> <span class="main">-#</span> <span class="main">&lt;</span><span class="skolem">pJ</span><span class="main">,</span> <span class="keyword1">inM</span> False<span class="main">&gt;</span><span class="main">)</span> <span class="main">∪#</span> <span class="main">{#</span> <span class="main">&lt;</span><span class="skolem">pJ</span><span class="main">,</span> <span class="keyword1">inM</span> True<span class="main">&gt;</span> <span class="main">}</span><span class="main">)</span> 
        <span class="main">=</span> <span class="main">(</span>msgs <span class="skolem">cJ1</span><span class="main">)</span>"</span></span>
        <span class="quoted"><span class="quoted">"<span class="main">(</span>states <span class="skolem">cfg1</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>states <span class="skolem">cJ1</span><span class="main">)</span>"</span></span>
        <span class="quoted"><span class="quoted">"<span class="skolem">Q</span> <span class="main">=</span> <span class="main">(</span>Proc <span class="main">-</span> <span class="main">{</span><span class="skolem">pJ</span><span class="main">}</span><span class="main">)</span> <span class="main">⟹</span>
          <span class="main">(</span><span class="main">(</span><span class="main">(</span>msgs <span class="skolem">cfg1</span><span class="main">)</span> <span class="main">-#</span> <span class="main">&lt;</span><span class="skolem">pJ</span><span class="main">,</span> <span class="keyword1">inM</span> False<span class="main">&gt;</span><span class="main">)</span> <span class="main">∪#</span> <span class="main">{#</span> <span class="main">&lt;</span><span class="skolem">pJ</span><span class="main">,</span> <span class="keyword1">inM</span> True<span class="main">&gt;</span> <span class="main">}</span><span class="main">)</span> 
            <span class="main">=</span> <span class="main">(</span>msgs <span class="skolem">cJ1</span><span class="main">)</span> 
          <span class="main">⟹</span> <span class="main">(</span>states <span class="skolem">cfg1</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>states <span class="skolem">cJ1</span><span class="main">)</span> 
          <span class="main">⟹</span> qReachable <span class="skolem">cJ1</span> <span class="main">(</span>Proc <span class="main">-</span> <span class="main">{</span><span class="skolem">pJ</span><span class="main">}</span><span class="main">)</span>
          <span class="main">⦇</span>states <span class="main">=</span> <span class="main">(</span>states <span class="skolem">cfg2</span><span class="main">)</span><span class="main">,</span>
          msgs <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span>msgs <span class="skolem">cfg2</span><span class="main">)</span> <span class="main">-#</span> <span class="main">&lt;</span><span class="skolem">pJ</span><span class="main">,</span> <span class="keyword1">inM</span> False<span class="main">&gt;</span><span class="main">)</span> <span class="main">∪#</span> <span class="main">{#</span> <span class="main">&lt;</span><span class="skolem">pJ</span><span class="main">,</span> <span class="keyword1">inM</span> True<span class="main">&gt;</span> <span class="main">}</span><span class="main">)</span><span class="main">⦈</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> Q <span class="keyword1"><span class="command">have</span></span> Cfg2<span class="main">:</span> 
        <span class="quoted"><span class="quoted">"qReachable <span class="skolem">cJ1</span> <span class="main">(</span>Proc <span class="main">-</span> <span class="main">{</span><span class="skolem">pJ</span><span class="main">}</span><span class="main">)</span> <span class="main">⦇</span>states <span class="main">=</span> <span class="main">(</span>states <span class="skolem">cfg2</span><span class="main">)</span><span class="main">,</span>
        msgs <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span>msgs <span class="skolem">cfg2</span><span class="main">)</span> <span class="main">-#</span> <span class="main">&lt;</span><span class="skolem">pJ</span><span class="main">,</span> <span class="keyword1">inM</span> False<span class="main">&gt;</span><span class="main">)</span> <span class="main">∪#</span> <span class="main">{#</span> <span class="main">&lt;</span><span class="skolem">pJ</span><span class="main">,</span> <span class="keyword1">inM</span> True<span class="main">&gt;</span> <span class="main">}</span><span class="main">)</span><span class="main">⦈</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"qReachable <span class="skolem">cfg1</span> <span class="skolem">Q</span> <span class="skolem">cfg2</span>"</span></span> 
        <span class="quoted"><span class="quoted">"<span class="skolem">cfg2</span> <span class="main">⊢</span> <span class="skolem">msg</span> <span class="main">↦</span> <span class="skolem">cfg3</span>"</span></span>
        <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="main">(</span><span class="bound">p</span><span class="main">::</span><span class="tfree">'p</span><span class="main">)</span><span class="main">∈</span><span class="skolem">Q</span><span class="main">.</span> <span class="main">(</span>isReceiverOf <span class="bound">p</span> <span class="skolem">msg</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> Q <span class="keyword1"><span class="command">have</span></span> Step<span class="main">:</span> <span class="quoted"><span class="quoted">"qReachable <span class="skolem">cfg1</span> <span class="main">(</span>Proc <span class="main">-</span> <span class="main">{</span><span class="skolem">pJ</span><span class="main">}</span><span class="main">)</span> <span class="skolem">cfg2</span>"</span></span> 
        <span class="quoted"><span class="quoted">"<span class="skolem">cfg2</span> <span class="main">⊢</span> <span class="skolem">msg</span> <span class="main">↦</span> <span class="skolem">cfg3</span>"</span></span>
        <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="main">(</span><span class="bound">p</span><span class="main">::</span><span class="tfree">'p</span><span class="main">)</span><span class="main">∈</span><span class="main">(</span>Proc <span class="main">-</span> <span class="main">{</span><span class="skolem">pJ</span><span class="main">}</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span>isReceiverOf <span class="bound">p</span> <span class="skolem">msg</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> P<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span><span class="main">∈</span><span class="main">(</span>Proc <span class="main">-</span> <span class="main">{</span><span class="skolem">pJ</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"isReceiverOf <span class="skolem">p</span> <span class="skolem">msg</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">hence</span></span> NotEq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">pJ</span> <span class="main">≠</span> <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">with</span></span> UniqueReceiverOf<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">msg</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">pJ</span>"</span></span><span class="main">]</span> P<span class="main">(</span>2<span class="main">)</span> 
        <span class="keyword1"><span class="command">have</span></span> notRec<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span>isReceiverOf <span class="skolem">pJ</span> <span class="skolem">msg</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">hence</span></span> MsgNoIn<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">msg</span> <span class="main">≠</span>  <span class="main">&lt;</span><span class="skolem">pJ</span><span class="main">,</span> <span class="keyword1">inM</span> False<span class="main">&gt;</span> <span class="main">∧</span> <span class="skolem">msg</span> <span class="main">≠</span>  <span class="main">&lt;</span><span class="skolem">pJ</span><span class="main">,</span> <span class="keyword1">inM</span> True<span class="main">&gt;</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
      <span class="keyword1"><span class="command">from</span></span> Step<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"enabled <span class="skolem">cfg2</span> <span class="skolem">msg</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> steps.simps 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">msg</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> MsgEnabled<span class="main">:</span> <span class="quoted"><span class="quoted">"enabled <span class="main">⦇</span>states <span class="main">=</span> <span class="main">(</span>states <span class="skolem">cfg2</span><span class="main">)</span><span class="main">,</span>
        msgs <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span>msgs <span class="skolem">cfg2</span><span class="main">)</span> <span class="main">-#</span> <span class="main">&lt;</span><span class="skolem">pJ</span><span class="main">,</span> <span class="keyword1">inM</span> False<span class="main">&gt;</span><span class="main">)</span> 
        <span class="main">∪#</span> <span class="main">{#</span> <span class="main">&lt;</span><span class="skolem">pJ</span><span class="main">,</span> <span class="keyword1">inM</span> True<span class="main">&gt;</span> <span class="main">}</span><span class="main">)</span><span class="main">⦈</span> <span class="skolem">msg</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> MsgNoIn <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> enabled_def<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span>  <span class="quoted"><span class="quoted">"<span class="main">⦇</span>states <span class="main">=</span> <span class="main">(</span>states <span class="skolem">cfg2</span><span class="main">)</span><span class="main">,</span>
              msgs <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span>msgs <span class="skolem">cfg2</span><span class="main">)</span> <span class="main">-#</span> <span class="main">&lt;</span><span class="skolem">pJ</span><span class="main">,</span> <span class="keyword1">inM</span> False<span class="main">&gt;</span><span class="main">)</span> 
              <span class="main">∪#</span> <span class="main">{#</span> <span class="main">&lt;</span><span class="skolem">pJ</span><span class="main">,</span> <span class="keyword1">inM</span> True<span class="main">&gt;</span> <span class="main">}</span><span class="main">)</span><span class="main">⦈</span>
                <span class="main">⊢</span> <span class="skolem">msg</span> <span class="main">↦</span> <span class="main">⦇</span>states <span class="main">=</span> <span class="main">(</span>states <span class="skolem">cfg3</span><span class="main">)</span><span class="main">,</span>
                msgs <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span>msgs <span class="skolem">cfg3</span><span class="main">)</span> <span class="main">-#</span> <span class="main">&lt;</span><span class="skolem">pJ</span><span class="main">,</span> <span class="keyword1">inM</span> False<span class="main">&gt;</span><span class="main">)</span> 
                <span class="main">∪#</span> <span class="main">{#</span> <span class="main">&lt;</span><span class="skolem">pJ</span><span class="main">,</span> <span class="keyword1">inM</span> True<span class="main">&gt;</span> <span class="main">}</span><span class="main">)</span><span class="main">⦈</span>"</span></span> 
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">msg</span></span><span class="main">)</span> 
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p'</span> <span class="skolem">bool</span>
        <span class="keyword3"><span class="command">assume</span></span> MsgIn <span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">msg</span> <span class="main">=</span> <span class="main">&lt;</span><span class="skolem">p'</span><span class="main">,</span> <span class="keyword1">inM</span> <span class="skolem">bool</span><span class="main">&gt;</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">with</span></span> noInSends MsgIn MsgNoIn MsgEnabled 
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⦇</span>states <span class="main">=</span> <span class="main">(</span>states <span class="skolem">cfg2</span><span class="main">)</span><span class="main">,</span>
          msgs <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span>msgs <span class="skolem">cfg2</span><span class="main">)</span> <span class="main">-#</span> <span class="main">&lt;</span><span class="skolem">pJ</span><span class="main">,</span> <span class="keyword1">inM</span> False<span class="main">&gt;</span><span class="main">)</span> <span class="main">∪#</span> <span class="main">{#</span> <span class="main">&lt;</span><span class="skolem">pJ</span><span class="main">,</span> <span class="keyword1">inM</span> True<span class="main">&gt;</span> <span class="main">}</span><span class="main">)</span><span class="main">⦈</span>
            <span class="main">⊢</span> <span class="skolem">msg</span> <span class="main">↦</span> <span class="main">⦇</span>states <span class="main">=</span> <span class="main">(</span>states <span class="skolem">cfg3</span><span class="main">)</span><span class="main">,</span>
              msgs <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span>msgs <span class="skolem">cfg3</span><span class="main">)</span> <span class="main">-#</span> <span class="main">&lt;</span><span class="skolem">pJ</span><span class="main">,</span> <span class="keyword1">inM</span> False<span class="main">&gt;</span><span class="main">)</span> 
              <span class="main">∪#</span> <span class="main">{#</span> <span class="main">&lt;</span><span class="skolem">pJ</span><span class="main">,</span> <span class="keyword1">inM</span> True<span class="main">&gt;</span> <span class="main">}</span><span class="main">)</span><span class="main">⦈</span>"</span></span>  
          <span class="keyword1"><span class="command">using</span></span> steps.simps<span class="main">(</span>1<span class="main">)</span> Step<span class="main">(</span>2<span class="main">)</span> select_convs<span class="main">(</span>2<span class="main">)</span> select_convs<span class="main">(</span>1<span class="main">)</span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">bool</span>   
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">msg</span> <span class="main">=</span> <span class="main">&lt;⊥,</span> <span class="keyword1">outM</span> <span class="skolem">bool</span><span class="main">&gt;</span><span class="main">)</span>"</span></span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">⦇</span>states <span class="main">=</span> <span class="main">(</span>states <span class="skolem">cfg2</span><span class="main">)</span><span class="main">,</span>
          msgs <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span>msgs <span class="skolem">cfg2</span><span class="main">)</span> <span class="main">-#</span> <span class="main">&lt;</span><span class="skolem">pJ</span><span class="main">,</span> <span class="keyword1">inM</span> False<span class="main">&gt;</span><span class="main">)</span> <span class="main">∪#</span> <span class="main">{#</span> <span class="main">&lt;</span><span class="skolem">pJ</span><span class="main">,</span> <span class="keyword1">inM</span> True<span class="main">&gt;</span> <span class="main">}</span><span class="main">)</span><span class="main">⦈</span>
            <span class="main">⊢</span> <span class="skolem">msg</span> <span class="main">↦</span> <span class="main">⦇</span>states <span class="main">=</span> <span class="main">(</span>states <span class="skolem">cfg3</span><span class="main">)</span><span class="main">,</span>
              msgs <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span>msgs <span class="skolem">cfg3</span><span class="main">)</span> <span class="main">-#</span> <span class="main">&lt;</span><span class="skolem">pJ</span><span class="main">,</span> <span class="keyword1">inM</span> False<span class="main">&gt;</span><span class="main">)</span> 
              <span class="main">∪#</span> <span class="main">{#</span> <span class="main">&lt;</span><span class="skolem">pJ</span><span class="main">,</span> <span class="keyword1">inM</span> True<span class="main">&gt;</span> <span class="main">}</span><span class="main">)</span><span class="main">⦈</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> steps_def Step<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span> <span class="skolem">v</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">msg</span> <span class="main">=</span> <span class="main">&lt;</span><span class="skolem">p</span><span class="main">,</span> <span class="skolem">v</span><span class="main">&gt;</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">with</span></span> noInSends MsgNoIn MsgEnabled <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⦇</span>states <span class="main">=</span> <span class="main">(</span>states <span class="skolem">cfg2</span><span class="main">)</span><span class="main">,</span>
          msgs <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span>msgs <span class="skolem">cfg2</span><span class="main">)</span> <span class="main">-#</span> <span class="main">&lt;</span><span class="skolem">pJ</span><span class="main">,</span> <span class="keyword1">inM</span> False<span class="main">&gt;</span><span class="main">)</span> <span class="main">∪#</span> <span class="main">{#</span> <span class="main">&lt;</span><span class="skolem">pJ</span><span class="main">,</span> <span class="keyword1">inM</span> True<span class="main">&gt;</span> <span class="main">}</span><span class="main">)</span><span class="main">⦈</span>
            <span class="main">⊢</span> <span class="skolem">msg</span> <span class="main">↦</span> <span class="main">⦇</span>states <span class="main">=</span> <span class="main">(</span>states <span class="skolem">cfg3</span><span class="main">)</span><span class="main">,</span>
              msgs <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span>msgs <span class="skolem">cfg3</span><span class="main">)</span> <span class="main">-#</span> <span class="main">&lt;</span><span class="skolem">pJ</span><span class="main">,</span> <span class="keyword1">inM</span> False<span class="main">&gt;</span><span class="main">)</span> 
              <span class="main">∪#</span> <span class="main">{#</span> <span class="main">&lt;</span><span class="skolem">pJ</span><span class="main">,</span> <span class="keyword1">inM</span> True<span class="main">&gt;</span> <span class="main">}</span><span class="main">)</span><span class="main">⦈</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> steps.simps<span class="main">(</span>1<span class="main">)</span> Step<span class="main">(</span>2<span class="main">)</span> select_convs<span class="main">(</span>2<span class="main">)</span> select_convs<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>            
      <span class="keyword1"><span class="command">with</span></span> Cfg2 Step<span class="main">(</span>3<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"qReachable <span class="skolem">cJ1</span> <span class="main">(</span>Proc <span class="main">-</span> <span class="main">{</span><span class="skolem">pJ</span><span class="main">}</span><span class="main">)</span>
        <span class="main">⦇</span>states <span class="main">=</span> <span class="main">(</span>states <span class="skolem">cfg3</span><span class="main">)</span><span class="main">,</span>
          msgs <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span>msgs <span class="skolem">cfg3</span><span class="main">)</span> <span class="main">-#</span> <span class="main">&lt;</span><span class="skolem">pJ</span><span class="main">,</span> <span class="keyword1">inM</span> False<span class="main">&gt;</span><span class="main">)</span> <span class="main">∪#</span> <span class="main">{#</span> <span class="main">&lt;</span><span class="skolem">pJ</span><span class="main">,</span> <span class="keyword1">inM</span> True<span class="main">&gt;</span> <span class="main">}</span><span class="main">)</span><span class="main">⦈</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span>
          qReachable.simps<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">cJ1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Proc <span class="main">-</span> <span class="main">{</span><span class="skolem">pJ</span><span class="main">}</span><span class="main">)</span>"</span></span> 
          <span class="quoted"><span class="quoted">"<span class="main">⦇</span>states <span class="main">=</span> <span class="main">(</span>states <span class="skolem">cfg3</span><span class="main">)</span><span class="main">,</span>
          msgs <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span>msgs <span class="skolem">cfg3</span><span class="main">)</span> <span class="main">-#</span> <span class="main">&lt;</span><span class="skolem">pJ</span><span class="main">,</span> <span class="keyword1">inM</span> False<span class="main">&gt;</span><span class="main">)</span> 
          <span class="main">∪#</span> <span class="main">{#</span> <span class="main">&lt;</span><span class="skolem">pJ</span><span class="main">,</span> <span class="keyword1">inM</span> True<span class="main">&gt;</span> <span class="main">}</span><span class="main">)</span><span class="main">⦈</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">with</span></span> CCQ<span class="main">(</span>1<span class="main">)</span> CCQ<span class="main">(</span>2<span class="main">)</span> InitMsgs StatescJcJ1 <span class="keyword1"><span class="command">have</span></span> CC'<span class="main">:</span>
    <span class="quoted"><span class="quoted">"withoutQReachable <span class="skolem">cJ1</span> <span class="main">{</span><span class="skolem">pJ</span><span class="main">}</span> <span class="main">⦇</span>states <span class="main">=</span> <span class="main">(</span>states <span class="skolem">cc</span><span class="main">)</span><span class="main">,</span> 
      msgs <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span>msgs <span class="skolem">cc</span><span class="main">)</span> <span class="main">-#</span> <span class="main">(</span><span class="main">&lt;</span><span class="skolem">pJ</span><span class="main">,</span><span class="keyword1">inM</span> False<span class="main">&gt;</span><span class="main">)</span><span class="main">)</span> 
      <span class="main">∪#</span> <span class="main">{#</span> <span class="main">(</span><span class="main">&lt;</span><span class="skolem">pJ</span><span class="main">,</span> <span class="keyword1">inM</span> True<span class="main">&gt;</span><span class="main">)</span><span class="main">}</span><span class="main">)</span> <span class="main">⦈</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> QReachImplReach CJ1InitR initReachable_def reachable.simps 
    ReachableTrans
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"initReachable <span class="main">⦇</span>states <span class="main">=</span> <span class="main">(</span>states <span class="skolem">cc</span><span class="main">)</span><span class="main">,</span> 
      msgs <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span>msgs <span class="skolem">cc</span><span class="main">)</span> <span class="main">-#</span> <span class="main">(</span><span class="main">&lt;</span><span class="skolem">pJ</span><span class="main">,</span><span class="keyword1">inM</span> False<span class="main">&gt;</span><span class="main">)</span><span class="main">)</span> 
      <span class="main">∪#</span> <span class="main">{#</span> <span class="main">(</span><span class="main">&lt;</span><span class="skolem">pJ</span><span class="main">,</span> <span class="keyword1">inM</span> True<span class="main">&gt;</span><span class="main">)</span><span class="main">}</span><span class="main">)</span> <span class="main">⦈</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">meson</span>
  <span class="keyword1"><span class="command">with</span></span> CC' <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"False <span class="main">∈</span> <span class="keyword1">val[</span><span class="skolem">pJ</span><span class="main">,</span> <span class="skolem">cJ1</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> pSilDecVal_def
    <span class="keyword1"><span class="command">using</span></span> CJ1InitR CC<span class="main">(</span>1<span class="main">)</span> select_convs<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span>vUniform True <span class="main">(</span><span class="skolem">cJ1</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> vUniform_def
    <span class="keyword1"><span class="command">using</span></span> CJ1InitR <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"nonUniform <span class="skolem">cJ1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> J<span class="main">(</span>3<span class="main">)</span> CJ1InitR <span class="keyword1"><span class="command">unfolding</span></span> cJ1_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> CJ1Init <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  Völzer's Lemma 2 proves that for every process $p$ in the consensus setting 
  \isb{nonUniform} configurations can reach a configuration where the silent
  decision values of $p$ are True and False. This is key to the construction of
  non-deciding executions.

  \voelzer{Lemma 2}
›</span></span>
<span class="keyword1" id="FLPSystem-NonUniformCanReachSilentBivalence"><span class="command">lemma</span></span> NonUniformCanReachSilentBivalence<span class="main">:</span>
<span class="keyword2"><span class="keyword">fixes</span></span> 
  <span class="free">p</span><span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'p</span></span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">c</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'p</span><span class="main">,</span> <span class="tfree">'v</span><span class="main">,</span> <span class="tfree">'s</span><span class="main">)</span> configuration"</span></span>
<span class="keyword2"><span class="keyword">assumes</span></span> 
  NonUni<span class="main">:</span> <span class="quoted"><span class="quoted">"nonUniform <span class="free">c</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  PseudoTermination<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">cc</span> <span class="bound">Q</span> <span class="main">.</span> terminationPseudo <span class="main">1</span> <span class="bound">cc</span> <span class="bound">Q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  Agree<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">cfg</span> <span class="main">.</span> reachable <span class="free">c</span> <span class="bound">cfg</span> <span class="main">⟶</span> agreement <span class="bound">cfg</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> 
   <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">c'</span> <span class="main">.</span> reachable <span class="free">c</span> <span class="bound">c'</span> <span class="main">∧</span> <span class="keyword1">val[</span><span class="free">p</span><span class="main">,</span><span class="bound">c'</span><span class="main">]</span> <span class="main">=</span> <span class="main">{</span>True<span class="main">,</span> False<span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="keyword1">val[</span><span class="free">p</span><span class="main">,</span><span class="free">c</span><span class="main">]</span> <span class="main">=</span> <span class="main">{</span>True<span class="main">,</span> False<span class="main">}</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True 
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"reachable <span class="free">c</span> <span class="free">c</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> reachable.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">hence</span></span> notEq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">val[</span><span class="free">p</span><span class="main">,</span><span class="free">c</span><span class="main">]</span> <span class="main">≠</span> <span class="main">{</span>True<span class="main">,</span> False<span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> NonUni PseudoTermination DecisionValuesExist 
  <span class="keyword1"><span class="command">have</span></span> notE<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">q</span><span class="main">.</span> <span class="keyword1">val[</span><span class="bound">q</span><span class="main">,</span><span class="free">c</span><span class="main">]</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>  
  <span class="keyword1"><span class="command">hence</span></span> notEP<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">val[</span><span class="free">p</span><span class="main">,</span><span class="free">c</span><span class="main">]</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> valType<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">q</span><span class="main">.</span> <span class="keyword1">val[</span><span class="bound">q</span><span class="main">,</span><span class="free">c</span><span class="main">]</span> <span class="main">⊆</span> <span class="main">{</span>True<span class="main">,</span> False<span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> pSilDecVal_def 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> insertCI subsetI<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">val[</span><span class="free">p</span><span class="main">,</span><span class="free">c</span><span class="main">]</span> <span class="main">⊆</span> <span class="main">{</span>True<span class="main">,</span> False<span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">with</span></span> notEq notEP  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">b</span><span class="main">::</span> bool<span class="main">.</span> <span class="keyword1">val[</span><span class="free">p</span><span class="main">,</span><span class="free">c</span><span class="main">]</span> <span class="main">=</span> <span class="main">{</span><span class="bound">b</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">val[</span><span class="free">p</span><span class="main">,</span><span class="free">c</span><span class="main">]</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">b</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> NonUni vUniform_def <span class="keyword1"><span class="command">have</span></span> 
    NonUni<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">q</span><span class="main">.</span> <span class="keyword1">val[</span><span class="bound">q</span><span class="main">,</span><span class="free">c</span><span class="main">]</span> <span class="main">≠</span> <span class="main">{</span>True<span class="main">}</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">q</span><span class="main">.</span> <span class="keyword1">val[</span><span class="bound">q</span><span class="main">,</span><span class="free">c</span><span class="main">]</span> <span class="main">≠</span> <span class="main">{</span>False<span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> Bool<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">=</span> True <span class="main">∨</span> <span class="skolem">b</span> <span class="main">=</span> False"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> NonUni <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">q</span><span class="main">.</span> <span class="keyword1">val[</span><span class="bound">q</span><span class="main">,</span><span class="free">c</span><span class="main">]</span> <span class="main">≠</span> <span class="main">{</span><span class="skolem">b</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> Q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">val[</span><span class="skolem">q</span><span class="main">,</span><span class="free">c</span><span class="main">]</span> <span class="main">≠</span> <span class="main">{</span><span class="skolem">b</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> notE valType 
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">val[</span><span class="skolem">q</span><span class="main">,</span><span class="free">c</span><span class="main">]</span> <span class="main">=</span> <span class="main">{</span>True<span class="main">}</span> <span class="main">∨</span> <span class="keyword1">val[</span><span class="skolem">q</span><span class="main">,</span><span class="free">c</span><span class="main">]</span> <span class="main">=</span> <span class="main">{</span>False<span class="main">}</span> <span class="main">∨</span> <span class="keyword1">val[</span><span class="skolem">q</span><span class="main">,</span><span class="free">c</span><span class="main">]</span> <span class="main">=</span> <span class="main">{</span>True<span class="main">,</span> False<span class="main">}</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> Bool Q <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">val[</span><span class="skolem">q</span><span class="main">,</span><span class="free">c</span><span class="main">]</span> <span class="main">=</span> <span class="main">{</span><span class="main">¬</span><span class="skolem">b</span><span class="main">}</span> <span class="main">∨</span> <span class="keyword1">val[</span><span class="skolem">q</span><span class="main">,</span><span class="free">c</span><span class="main">]</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">b</span><span class="main">,</span> <span class="main">¬</span><span class="skolem">b</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">¬</span><span class="skolem">b</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">val[</span><span class="skolem">q</span><span class="main">,</span><span class="free">c</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">with</span></span> pSilDecVal_def 
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">c'</span><span class="main">::</span><span class="main">(</span><span class="tfree">'p</span><span class="main">,</span> <span class="tfree">'v</span><span class="main">,</span> <span class="tfree">'s</span><span class="main">)</span> configuration <span class="main">.</span> <span class="main">(</span>withoutQReachable <span class="free">c</span> <span class="main">{</span><span class="skolem">q</span><span class="main">}</span> <span class="bound">c'</span><span class="main">)</span> <span class="main">∧</span>
    vDecided <span class="main">(</span><span class="main">¬</span><span class="skolem">b</span><span class="main">)</span> <span class="bound">c'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c'</span></span> <span class="keyword2"><span class="keyword">where</span></span> C'<span class="main">:</span> <span class="quoted"><span class="quoted">"withoutQReachable <span class="free">c</span> <span class="main">{</span><span class="skolem">q</span><span class="main">}</span> <span class="skolem">c'</span>"</span></span> <span class="quoted"><span class="quoted">"vDecided <span class="main">(</span><span class="main">¬</span><span class="skolem">b</span><span class="main">)</span> <span class="skolem">c'</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> Reach<span class="main">:</span> <span class="quoted"><span class="quoted">"reachable <span class="free">c</span> <span class="skolem">c'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> QReachImplReach <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">cfg</span> <span class="main">.</span> reachable <span class="skolem">c'</span> <span class="bound">cfg</span> <span class="main">⟶</span> agreement <span class="bound">cfg</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">clarify</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">cfg</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"reachable <span class="skolem">c'</span> <span class="skolem">cfg</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> Reach <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"reachable <span class="free">c</span> <span class="skolem">cfg</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> ReachableTrans<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">c</span></span> <span class="quoted"><span class="skolem">c'</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> Agree <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"agreement <span class="skolem">cfg</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>      
  <span class="keyword1"><span class="command">with</span></span> PseudoTermination C'<span class="main">(</span>2<span class="main">)</span> DecidedImpliesUniform <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vUniform <span class="main">(</span><span class="main">¬</span><span class="skolem">b</span><span class="main">)</span> <span class="skolem">c'</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> notB<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">val[</span><span class="free">p</span><span class="main">,</span><span class="skolem">c'</span><span class="main">]</span> <span class="main">=</span> <span class="main">{</span><span class="main">¬</span><span class="skolem">b</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> vUniform_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> Reach B <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">cfg</span><span class="main">.</span> reachable <span class="free">c</span> <span class="bound">cfg</span> <span class="main">∧</span> <span class="keyword1">val[</span><span class="free">p</span><span class="main">,</span><span class="bound">cfg</span><span class="main">]</span> <span class="main">=</span> <span class="main">{</span>True<span class="main">,</span> False<span class="main">}</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> reachable.induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">cfg1</span> <span class="skolem">cfg2</span> <span class="skolem">cfg3</span> <span class="skolem">msg</span>
    <span class="keyword3"><span class="command">assume</span></span>
      IV<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">val[</span><span class="free">p</span><span class="main">,</span><span class="skolem">cfg1</span><span class="main">]</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">b</span><span class="main">}</span> <span class="main">⟹</span>
        <span class="keyword1">val[</span><span class="free">p</span><span class="main">,</span><span class="skolem">cfg2</span><span class="main">]</span> <span class="main">=</span> <span class="main">{</span><span class="main">¬</span> <span class="skolem">b</span><span class="main">}</span> <span class="main">⟹</span>
          <span class="main">∃</span><span class="bound">cfg</span><span class="main">::</span><span class="main">(</span><span class="tfree">'p</span><span class="main">,</span> <span class="tfree">'v</span><span class="main">,</span> <span class="tfree">'s</span><span class="main">)</span> configuration<span class="main">.</span> reachable <span class="skolem">cfg1</span> <span class="bound">cfg</span> 
          <span class="main">∧</span> <span class="keyword1">val[</span><span class="free">p</span><span class="main">,</span><span class="bound">cfg</span><span class="main">]</span> <span class="main">=</span> <span class="main">{</span>True<span class="main">,</span> False<span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      Reach<span class="main">:</span>  <span class="quoted"><span class="quoted">"reachable <span class="skolem">cfg1</span> <span class="skolem">cfg2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      Step<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">cfg2</span> <span class="main">⊢</span> <span class="skolem">msg</span> <span class="main">↦</span> <span class="skolem">cfg3</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      ValCfg1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">val[</span><span class="free">p</span><span class="main">,</span><span class="skolem">cfg1</span><span class="main">]</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">b</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      ValCfg3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">val[</span><span class="free">p</span><span class="main">,</span><span class="skolem">cfg3</span><span class="main">]</span> <span class="main">=</span> <span class="main">{</span><span class="main">¬</span> <span class="skolem">b</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> ValCfg1 <span class="keyword1"><span class="command">have</span></span> InitCfg1<span class="main">:</span> <span class="quoted"><span class="quoted">"initReachable <span class="skolem">cfg1</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> pSilDecVal_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> Reach InitCfg1 initReachable_def reachable.simps ReachableTrans
      <span class="keyword1"><span class="command">have</span></span> InitCfg2<span class="main">:</span> <span class="quoted"><span class="quoted">"initReachable <span class="skolem">cfg2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">with</span></span> PseudoTermination DecisionValuesExist 
    <span class="keyword1"><span class="command">have</span></span> notE<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">q</span><span class="main">.</span> <span class="keyword1">val[</span><span class="bound">q</span><span class="main">,</span><span class="skolem">cfg2</span><span class="main">]</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> valType<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">q</span><span class="main">.</span> <span class="keyword1">val[</span><span class="bound">q</span><span class="main">,</span><span class="skolem">cfg2</span><span class="main">]</span> <span class="main">⊆</span> <span class="main">{</span>True<span class="main">,</span> False<span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> pSilDecVal_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> insertCI subsetI<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> notE valType 
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">val[</span><span class="free">p</span><span class="main">,</span><span class="skolem">cfg2</span><span class="main">]</span> <span class="main">=</span> <span class="main">{</span>True<span class="main">}</span> <span class="main">∨</span> <span class="keyword1">val[</span><span class="free">p</span><span class="main">,</span><span class="skolem">cfg2</span><span class="main">]</span> <span class="main">=</span> <span class="main">{</span>False<span class="main">}</span> 
        <span class="main">∨</span> <span class="keyword1">val[</span><span class="free">p</span><span class="main">,</span><span class="skolem">cfg2</span><span class="main">]</span> <span class="main">=</span> <span class="main">{</span>True<span class="main">,</span> False<span class="main">}</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> Bool <span class="keyword1"><span class="command">have</span></span> Val<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">val[</span><span class="free">p</span><span class="main">,</span><span class="skolem">cfg2</span><span class="main">]</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">b</span><span class="main">}</span> <span class="main">∨</span> <span class="keyword1">val[</span><span class="free">p</span><span class="main">,</span><span class="skolem">cfg2</span><span class="main">]</span> <span class="main">=</span> <span class="main">{</span><span class="main">¬</span><span class="skolem">b</span><span class="main">}</span> 
      <span class="main">∨</span> <span class="keyword1">val[</span><span class="free">p</span><span class="main">,</span><span class="skolem">cfg2</span><span class="main">]</span> <span class="main">=</span> <span class="main">{</span>True<span class="main">,</span> False<span class="main">}</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">cfg</span><span class="main">::</span><span class="main">(</span><span class="tfree">'p</span><span class="main">,</span> <span class="tfree">'v</span><span class="main">,</span> <span class="tfree">'s</span><span class="main">)</span> configuration<span class="main">.</span> reachable <span class="skolem">cfg1</span> <span class="bound">cfg</span> 
      <span class="main">∧</span> <span class="keyword1">val[</span><span class="free">p</span><span class="main">,</span><span class="bound">cfg</span><span class="main">]</span> <span class="main">=</span> <span class="main">{</span>True<span class="main">,</span> False<span class="main">}</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="keyword1">val[</span><span class="free">p</span><span class="main">,</span><span class="skolem">cfg2</span><span class="main">]</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">b</span><span class="main">}</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">hence</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">val[</span><span class="free">p</span><span class="main">,</span><span class="skolem">cfg2</span><span class="main">]</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">b</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">from</span></span> Step <span class="keyword1"><span class="command">have</span></span> RecOrOut<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">q</span><span class="main">.</span> isReceiverOf <span class="bound">q</span> <span class="skolem">msg</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">msg</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> Rec<span class="main">:</span> <span class="quoted"><span class="quoted">"isReceiverOf <span class="skolem">q</span> <span class="skolem">msg</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> B Step InitCfg2 SilentDecisionValueNotInverting 
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">val[</span><span class="free">p</span><span class="main">,</span><span class="skolem">cfg3</span><span class="main">]</span> <span class="main">≠</span> <span class="main">{</span><span class="main">¬</span><span class="skolem">b</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> ValCfg3 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"False"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">cfg</span><span class="main">::</span><span class="main">(</span><span class="tfree">'p</span><span class="main">,</span> <span class="tfree">'v</span><span class="main">,</span> <span class="tfree">'s</span><span class="main">)</span> configuration<span class="main">.</span> reachable <span class="skolem">cfg1</span> <span class="bound">cfg</span> <span class="main">∧</span> 
        <span class="keyword1">val[</span><span class="free">p</span><span class="main">,</span><span class="bound">cfg</span><span class="main">]</span> <span class="main">=</span> <span class="main">{</span>True<span class="main">,</span> False<span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span> 
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">with</span></span> Val <span class="keyword1"><span class="command">have</span></span> Val<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">val[</span><span class="free">p</span><span class="main">,</span><span class="skolem">cfg2</span><span class="main">]</span> <span class="main">=</span> <span class="main">{</span><span class="main">¬</span><span class="skolem">b</span><span class="main">}</span> <span class="main">∨</span> <span class="keyword1">val[</span><span class="free">p</span><span class="main">,</span><span class="skolem">cfg2</span><span class="main">]</span> <span class="main">=</span> <span class="main">{</span>True<span class="main">,</span> False<span class="main">}</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">cfg</span><span class="main">::</span><span class="main">(</span><span class="tfree">'p</span><span class="main">,</span> <span class="tfree">'v</span><span class="main">,</span> <span class="tfree">'s</span><span class="main">)</span> configuration<span class="main">.</span> reachable <span class="skolem">cfg1</span> <span class="bound">cfg</span> <span class="main">∧</span> 
            <span class="keyword1">val[</span><span class="free">p</span><span class="main">,</span><span class="bound">cfg</span><span class="main">]</span> <span class="main">=</span> <span class="main">{</span>True<span class="main">,</span> False<span class="main">}</span>"</span></span> 
      <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="keyword1">val[</span><span class="free">p</span><span class="main">,</span><span class="skolem">cfg2</span><span class="main">]</span> <span class="main">=</span> <span class="main">{</span><span class="main">¬</span><span class="skolem">b</span><span class="main">}</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">val[</span><span class="free">p</span><span class="main">,</span><span class="skolem">cfg2</span><span class="main">]</span> <span class="main">=</span> <span class="main">{</span><span class="main">¬</span><span class="skolem">b</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">with</span></span> ValCfg1 IV <span class="keyword3"><span class="command">show</span></span> 
          <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">cfg</span><span class="main">::</span><span class="main">(</span><span class="tfree">'p</span><span class="main">,</span> <span class="tfree">'v</span><span class="main">,</span> <span class="tfree">'s</span><span class="main">)</span> configuration<span class="main">.</span> 
          reachable <span class="skolem">cfg1</span> <span class="bound">cfg</span> <span class="main">∧</span> <span class="keyword1">val[</span><span class="free">p</span><span class="main">,</span><span class="bound">cfg</span><span class="main">]</span> <span class="main">=</span> <span class="main">{</span>True<span class="main">,</span> False<span class="main">}</span>"</span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">with</span></span> Val <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">val[</span><span class="free">p</span><span class="main">,</span><span class="skolem">cfg2</span><span class="main">]</span> <span class="main">=</span> <span class="main">{</span>True<span class="main">,</span> False<span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">with</span></span> Reach <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"reachable <span class="skolem">cfg1</span> <span class="skolem">cfg2</span> <span class="main">∧</span> <span class="keyword1">val[</span><span class="free">p</span><span class="main">,</span><span class="skolem">cfg2</span><span class="main">]</span> <span class="main">=</span> <span class="main">{</span>True<span class="main">,</span> False<span class="main">}</span>"</span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">cfg</span><span class="main">::</span><span class="main">(</span><span class="tfree">'p</span><span class="main">,</span> <span class="tfree">'v</span><span class="main">,</span> <span class="tfree">'s</span><span class="main">)</span> configuration<span class="main">.</span> 
          reachable <span class="skolem">cfg1</span> <span class="bound">cfg</span> <span class="main">∧</span> <span class="keyword1">val[</span><span class="free">p</span><span class="main">,</span><span class="bound">cfg</span><span class="main">]</span> <span class="main">=</span> <span class="main">{</span>True<span class="main">,</span> False<span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="FLPTheorem">
<div class="head">
<h1>Theory FLPTheorem</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹FLPTheorem›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  \file{FLPTheorem} combines the results of \file{FLPSystem} with the concept
  of fair infinite executions and culminates in showing the impossibility
  of a consensus algorithm in the proposed setting.
›</span></span>

<span class="keyword1"><span class="command">theory</span></span> FLPTheorem
<span class="keyword2"><span class="keyword">imports</span></span> <a href="Execution.html">Execution</a> <a href="FLPSystem.html">FLPSystem</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">locale</span></span> flpPseudoConsensus <span class="main">=</span>
  flpSystem <span class="quoted"><span class="free">trans</span></span> <span class="quoted"><span class="free">sends</span></span> <span class="quoted"><span class="free">start</span></span>
<span class="keyword2"><span class="keyword">for</span></span>
  <span class="free">trans</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'p</span> <span class="main">⇒</span> <span class="tfree">'s</span> <span class="main">⇒</span> <span class="tfree">'v</span> messageValue <span class="main">⇒</span><span class="tfree">'s</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">sends</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'p</span> <span class="main">⇒</span> <span class="tfree">'s</span> <span class="main">⇒</span> <span class="tfree">'v</span> messageValue <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'p</span><span class="main">,</span> <span class="tfree">'v</span><span class="main">)</span> message multiset"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">start</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'p</span> <span class="main">⇒</span> <span class="tfree">'s</span>"</span></span> <span class="main">+</span>
<span class="keyword2"><span class="keyword">assumes</span></span>
  Agreement<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">i</span> <span class="bound">c</span> <span class="main">.</span> agreementInit <span class="bound">i</span> <span class="bound">c</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  PseudoTermination<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">cc</span> <span class="bound">Q</span> <span class="main">.</span> terminationPseudo <span class="main">1</span> <span class="bound">cc</span> <span class="bound">Q</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Obtaining non-uniform executions›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Executions which end with a \isb{nonUniform} configuration can be expanded
  to a strictly longer execution consuming a particular message.

  This lemma connects the previous results to the world of executions,
  thereby paving the way to the final contradiction. It covers a big part of
  the original proof of the theorem, i.e.\ finding the expansion to a longer
  execution where the decision for both values is still possible.
  \voelzer{constructing executions using Lemma 2}
›</span></span>
<span class="keyword1" id="FLPTheorem-NonUniformExecutionsConstructable"><span class="command">lemma</span></span> NonUniformExecutionsConstructable<span class="main">:</span>
<span class="keyword2"><span class="keyword">fixes</span></span>
  <span class="free">exec</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'p</span><span class="main">,</span> <span class="tfree">'v</span><span class="main">,</span> <span class="tfree">'s</span> <span class="main">)</span> configuration list "</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">trace</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'p</span><span class="main">,</span> <span class="tfree">'v</span><span class="main">)</span> message list"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
  <span class="free">msg</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'p</span><span class="main">,</span> <span class="tfree">'v</span><span class="main">)</span> message"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="free">p</span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'p</span></span></span>  
<span class="keyword2"><span class="keyword">assumes</span></span>
  MsgEnabled<span class="main">:</span> <span class="quoted"><span class="quoted">"enabled <span class="main">(</span>last <span class="free">exec</span><span class="main">)</span> <span class="free">msg</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  PisReceiverOf<span class="main">:</span> <span class="quoted"><span class="quoted">"isReceiverOf <span class="free">p</span> <span class="free">msg</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  ExecIsExecution<span class="main">:</span> <span class="quoted"><span class="quoted">"execution <span class="free">trans</span> <span class="free">sends</span> <span class="free">start</span> <span class="free">exec</span> <span class="free">trace</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  NonUniformLexec<span class="main">:</span> <span class="quoted"><span class="quoted">"nonUniform <span class="main">(</span>last <span class="free">exec</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  Agree<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">cfg</span> <span class="main">.</span> reachable <span class="main">(</span>last <span class="free">exec</span><span class="main">)</span> <span class="bound">cfg</span> <span class="main">⟶</span> agreement <span class="bound">cfg</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">exec'</span> <span class="bound">trace'</span> <span class="main">.</span> <span class="main">(</span>execution <span class="free">trans</span> <span class="free">sends</span> <span class="free">start</span> <span class="bound">exec'</span> <span class="bound">trace'</span><span class="main">)</span> 
    <span class="main">∧</span> nonUniform <span class="main">(</span>last <span class="bound">exec'</span><span class="main">)</span>
    <span class="main">∧</span> prefixList <span class="free">exec</span> <span class="bound">exec'</span> <span class="main">∧</span> prefixList <span class="free">trace</span> <span class="bound">trace'</span> 
    <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">cfg</span> <span class="main">.</span> reachable <span class="main">(</span>last <span class="bound">exec'</span><span class="main">)</span> <span class="bound">cfg</span> <span class="main">⟶</span> agreement <span class="bound">cfg</span><span class="main">)</span>
    <span class="main">∧</span> stepReachable <span class="main">(</span>last <span class="free">exec</span><span class="main">)</span> <span class="free">msg</span> <span class="main">(</span>last <span class="bound">exec'</span><span class="main">)</span> 
    <span class="main">∧</span> <span class="main">(</span><span class="free">msg</span> <span class="main">∈</span> set <span class="main">(</span>drop <span class="main">(</span>length <span class="free">trace</span><span class="main">)</span> <span class="bound">trace'</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> NonUniformCanReachSilentBivalence<span class="main">[</span><span class="operator">OF</span> NonUniformLexec PseudoTermination Agree<span class="main">]</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c'</span></span> <span class="keyword2"><span class="keyword">where</span></span> C'<span class="main">:</span>
      <span class="quoted"><span class="quoted">"reachable <span class="main">(</span>last <span class="free">exec</span><span class="main">)</span> <span class="skolem">c'</span>"</span></span> 
      <span class="quoted"><span class="quoted">"<span class="keyword1">val[</span><span class="free">p</span><span class="main">,</span><span class="skolem">c'</span><span class="main">]</span> <span class="main">=</span> <span class="main">{</span>True<span class="main">,</span> False<span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"stepReachable <span class="main">(</span>last <span class="free">exec</span><span class="main">)</span> <span class="free">msg</span> <span class="skolem">c'</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">hence</span></span> IsStepReachable<span class="main">:</span> <span class="quoted"><span class="quoted">"stepReachable <span class="main">(</span>last <span class="free">exec</span><span class="main">)</span> <span class="free">msg</span> <span class="skolem">c'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">exec'</span> <span class="bound">trace'</span><span class="main">.</span> <span class="main">(</span>execution <span class="free">trans</span> <span class="free">sends</span> <span class="free">start</span> <span class="bound">exec'</span> <span class="bound">trace'</span><span class="main">)</span> 
      <span class="main">∧</span> prefixList <span class="free">exec</span> <span class="bound">exec'</span> 
      <span class="main">∧</span> prefixList <span class="free">trace</span> <span class="bound">trace'</span> <span class="main">∧</span> <span class="main">(</span>last <span class="bound">exec'</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">c'</span> 
      <span class="main">∧</span> <span class="free">msg</span> <span class="main">∈</span> set <span class="main">(</span>drop <span class="main">(</span>length <span class="free">trace</span><span class="main">)</span> <span class="bound">trace'</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> ExecIsExecution expandExecution
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">exec'</span></span> <span class="skolem"><span class="skolem">trace'</span></span> <span class="keyword2"><span class="keyword">where</span></span> NewExec<span class="main">:</span> 
      <span class="quoted"><span class="quoted">"<span class="main">(</span>execution <span class="free">trans</span> <span class="free">sends</span> <span class="free">start</span> <span class="skolem">exec'</span> <span class="skolem">trace'</span><span class="main">)</span>"</span></span> 
      <span class="quoted"><span class="quoted">"prefixList <span class="free">exec</span> <span class="skolem">exec'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>last <span class="skolem">exec'</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">c'</span>"</span></span> <span class="quoted"><span class="quoted">"prefixList <span class="free">trace</span> <span class="skolem">trace'</span>"</span></span> 
      <span class="quoted"><span class="quoted">"<span class="free">msg</span> <span class="main">∈</span> set <span class="main">(</span>drop <span class="main">(</span>length <span class="free">trace</span><span class="main">)</span> <span class="skolem">trace'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">hence</span></span> lastExecExec'Reachable<span class="main">:</span> <span class="quoted"><span class="quoted">"reachable <span class="main">(</span>last <span class="free">exec</span><span class="main">)</span> <span class="main">(</span>last <span class="skolem">exec'</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> C'<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> InitReachLastExec'<span class="main">:</span>  <span class="quoted"><span class="quoted">"initReachable <span class="main">(</span>last <span class="skolem">exec'</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> NonUniformLexec 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ReachableTrans initReachable_def<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> nonUniformC'<span class="main">:</span> <span class="quoted"><span class="quoted">"nonUniform <span class="main">(</span>last <span class="skolem">exec'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> C'<span class="main">(</span>2<span class="main">)</span> NewExec<span class="main">(</span>3<span class="main">)</span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vUniform_def<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> isAgreementPreventing<span class="main">:</span> 
      <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span> <span class="bound">cfg</span> <span class="main">.</span> reachable <span class="main">(</span>last <span class="skolem">exec'</span><span class="main">)</span> <span class="bound">cfg</span> <span class="main">⟶</span> agreement <span class="bound">cfg</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> lastExecExec'Reachable Agree <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ReachableTrans<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> NewExec nonUniformC' IsStepReachable <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">hence</span></span> NotStepReachable<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span>stepReachable <span class="main">(</span>last <span class="free">exec</span><span class="main">)</span> <span class="free">msg</span> <span class="skolem">c'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> C'<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">exec'</span></span> <span class="skolem"><span class="skolem">trace'</span></span> <span class="keyword2"><span class="keyword">where</span></span> NewExec<span class="main">:</span> 
      <span class="quoted"><span class="quoted">"execution <span class="free">trans</span> <span class="free">sends</span> <span class="free">start</span> <span class="skolem">exec'</span> <span class="skolem">trace'</span>"</span></span>
      <span class="quoted"><span class="quoted">"<span class="main">(</span>prefixList <span class="free">exec</span> <span class="skolem">exec'</span> <span class="main">∧</span> prefixList <span class="free">trace</span> <span class="skolem">trace'</span><span class="main">)</span> 
      <span class="main">∨</span> <span class="main">(</span><span class="free">exec</span> <span class="main">=</span> <span class="skolem">exec'</span> <span class="main">∧</span> <span class="free">trace</span> <span class="main">=</span> <span class="skolem">trace'</span><span class="main">)</span>"</span></span>
      <span class="quoted"><span class="quoted">"last <span class="skolem">exec'</span> <span class="main">=</span> <span class="skolem">c'</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> ExecIsExecution expandExecutionReachable <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> lastExecExec'Reachable<span class="main">:</span> <span class="quoted"><span class="quoted">"reachable <span class="main">(</span>last <span class="free">exec</span><span class="main">)</span> <span class="main">(</span>last <span class="skolem">exec'</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> C'<span class="main">(</span>1<span class="main">)</span> NewExec<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> NonUniformLexec <span class="keyword1"><span class="command">have</span></span> InitReachLastExec'<span class="main">:</span> 
      <span class="quoted"><span class="quoted">"initReachable <span class="main">(</span>last <span class="skolem">exec'</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ReachableTrans initReachable_def<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> C'<span class="main">(</span>2<span class="main">)</span> NewExec<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> nonUniformC'<span class="main">:</span> <span class="quoted"><span class="quoted">"nonUniform <span class="main">(</span>last <span class="skolem">exec'</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vUniform_def<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">exec1</span> <span class="bound">trace1</span> <span class="main">.</span> <span class="main">(</span>execution <span class="free">trans</span> <span class="free">sends</span> <span class="free">start</span> <span class="bound">exec1</span> <span class="bound">trace1</span><span class="main">)</span> 
      <span class="main">∧</span> nonUniform <span class="main">(</span>last <span class="bound">exec1</span><span class="main">)</span>
      <span class="main">∧</span> prefixList <span class="free">exec</span> <span class="bound">exec1</span> <span class="main">∧</span> prefixList <span class="free">trace</span> <span class="bound">trace1</span> 
      <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">cfg</span> <span class="main">.</span> reachable <span class="main">(</span>last <span class="bound">exec1</span><span class="main">)</span> <span class="bound">cfg</span> <span class="main">⟶</span> agreement <span class="bound">cfg</span><span class="main">)</span>
      <span class="main">∧</span> stepReachable <span class="main">(</span>last <span class="free">exec</span><span class="main">)</span> <span class="free">msg</span> <span class="main">(</span>last <span class="bound">exec1</span><span class="main">)</span> 
      <span class="main">∧</span> <span class="main">(</span><span class="free">msg</span> <span class="main">∈</span> set <span class="main">(</span>drop <span class="main">(</span>length <span class="free">trace</span><span class="main">)</span> <span class="bound">trace1</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"enabled <span class="main">(</span>last <span class="skolem">exec'</span><span class="main">)</span> <span class="free">msg</span>"</span></span><span class="main">)</span> 
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">hence</span></span> EnabledMsg<span class="main">:</span> <span class="quoted"><span class="quoted">"enabled <span class="main">(</span>last <span class="skolem">exec'</span><span class="main">)</span> <span class="free">msg</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">cMsg</span> <span class="main">.</span> <span class="main">(</span><span class="main">(</span>last <span class="skolem">exec'</span><span class="main">)</span> <span class="main">⊢</span> <span class="free">msg</span> <span class="main">↦</span> <span class="bound">cMsg</span> <span class="main">)</span>"</span></span>  
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">msg</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>InMsg <span class="skolem">p'</span> <span class="skolem">b</span><span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> PisReceiverOf <span class="keyword1"><span class="command">have</span></span> MsgIsInMsg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">msg</span> <span class="main">=</span> <span class="main">&lt;</span><span class="free">p</span><span class="main">,</span> <span class="keyword1">inM</span> <span class="skolem">b</span><span class="main">&gt;</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">cfgInM</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">cfgInM</span> <span class="main">=</span> <span class="main">⦇</span>states <span class="main">=</span> <span class="main">λ</span><span class="bound">proc</span><span class="main">.</span> <span class="main">(</span>
        <span class="keyword1">if</span> <span class="bound">proc</span> <span class="main">=</span> <span class="free">p</span> <span class="keyword1">then</span>
          <span class="free">trans</span> <span class="free">p</span> <span class="main">(</span>states <span class="main">(</span>last <span class="skolem">exec'</span><span class="main">)</span> <span class="free">p</span><span class="main">)</span> <span class="main">(</span>Bool <span class="skolem">b</span><span class="main">)</span>
        <span class="keyword1">else</span> states <span class="main">(</span>last <span class="skolem">exec'</span><span class="main">)</span> <span class="bound">proc</span><span class="main">)</span><span class="main">,</span>
        msgs <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free">sends</span> <span class="free">p</span> <span class="main">(</span>states <span class="main">(</span>last <span class="skolem">exec'</span><span class="main">)</span> <span class="free">p</span><span class="main">)</span> <span class="main">(</span>Bool <span class="skolem">b</span><span class="main">)</span><span class="main">)</span>
              <span class="main">∪#</span> <span class="main">(</span>msgs <span class="main">(</span>last <span class="skolem">exec'</span><span class="main">)</span><span class="main">-#</span> <span class="free">msg</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">⦈</span> "</span></span>
          <span class="keyword1"><span class="command">with</span></span> UniqueReceiverOf MsgIsInMsg EnabledMsg <span class="keyword1"><span class="command">have</span></span> 
          <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>last <span class="skolem">exec'</span><span class="main">)</span> <span class="main">⊢</span> <span class="free">msg</span> <span class="main">↦</span> <span class="skolem">cfgInM</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">cMsg</span> <span class="main">.</span> <span class="main">(</span><span class="main">(</span>last <span class="skolem">exec'</span><span class="main">)</span> <span class="main">⊢</span> <span class="free">msg</span> <span class="main">↦</span> <span class="bound">cMsg</span> <span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">next</span></span> 
        <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>OutMsg <span class="skolem">b</span><span class="main">)</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">cMsg</span> <span class="main">.</span> <span class="main">(</span><span class="main">(</span>last <span class="skolem">exec'</span><span class="main">)</span> <span class="main">⊢</span> <span class="free">msg</span> <span class="main">↦</span> <span class="bound">cMsg</span> <span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> PisReceiverOf 
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">next</span></span> 
        <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Msg <span class="skolem">p'</span> <span class="skolem">v'</span><span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> PisReceiverOf <span class="keyword1"><span class="command">have</span></span> MsgIsVMsg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">msg</span> <span class="main">=</span> <span class="main">&lt;</span><span class="free">p</span><span class="main">,</span> <span class="skolem">v'</span><span class="main">&gt;</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">cfgVMsg</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">cfgVMsg</span> <span class="main">=</span>
          <span class="main">⦇</span>states <span class="main">=</span> <span class="main">λ</span><span class="bound">proc</span><span class="main">.</span> <span class="main">(</span>
              <span class="keyword1">if</span> <span class="bound">proc</span> <span class="main">=</span> <span class="free">p</span> <span class="keyword1">then</span>
               <span class="free">trans</span> <span class="free">p</span> <span class="main">(</span>states <span class="main">(</span>last <span class="skolem">exec'</span><span class="main">)</span> <span class="free">p</span><span class="main">)</span> <span class="main">(</span>Value <span class="skolem">v'</span><span class="main">)</span>
               <span class="keyword1">else</span> states <span class="main">(</span>last <span class="skolem">exec'</span><span class="main">)</span> <span class="bound">proc</span><span class="main">)</span><span class="main">,</span>
            msgs <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free">sends</span> <span class="free">p</span> <span class="main">(</span>states <span class="main">(</span>last <span class="skolem">exec'</span><span class="main">)</span> <span class="free">p</span><span class="main">)</span> <span class="main">(</span>Value <span class="skolem">v'</span><span class="main">)</span><span class="main">)</span>
                <span class="main">∪#</span> <span class="main">(</span>msgs <span class="main">(</span>last <span class="skolem">exec'</span><span class="main">)</span> <span class="main">-#</span> <span class="free">msg</span> <span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">⦈</span> "</span></span>
        <span class="keyword1"><span class="command">with</span></span> UniqueReceiverOf MsgIsVMsg EnabledMsg noInSends <span class="keyword1"><span class="command">have</span></span> 
          <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>last <span class="skolem">exec'</span><span class="main">)</span> <span class="main">⊢</span> <span class="free">msg</span> <span class="main">↦</span> <span class="skolem">cfgVMsg</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">cMsg</span> <span class="main">.</span> <span class="main">(</span><span class="main">(</span>last <span class="skolem">exec'</span><span class="main">)</span> <span class="main">⊢</span> <span class="free">msg</span> <span class="main">↦</span> <span class="bound">cMsg</span> <span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">qed</span></span>  
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">cMsg</span></span> <span class="keyword2"><span class="keyword">where</span></span>  CMsg<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>last <span class="skolem">exec'</span><span class="main">)</span> <span class="main">⊢</span> <span class="free">msg</span> <span class="main">↦</span> <span class="skolem">cMsg</span> <span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">execMsg</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">execMsg</span> <span class="main">=</span> <span class="skolem">exec'</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">cMsg</span><span class="main">]</span>"</span></span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">traceMsg</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">traceMsg</span> <span class="main">=</span> <span class="skolem">trace'</span> <span class="main">@</span> <span class="main">[</span><span class="free">msg</span><span class="main">]</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> NewExec<span class="main">(</span>1<span class="main">)</span> CMsg <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">execMsg</span></span> <span class="skolem"><span class="skolem">traceMsg</span></span> <span class="keyword2"><span class="keyword">where</span></span> isExecution<span class="main">:</span> 
        <span class="quoted"><span class="quoted">"execution <span class="free">trans</span> <span class="free">sends</span> <span class="free">start</span> <span class="skolem">execMsg</span> <span class="skolem">traceMsg</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> ExecMsg<span class="main">:</span> <span class="quoted"><span class="quoted">"prefixList <span class="skolem">exec'</span> <span class="skolem">execMsg</span>"</span></span> <span class="quoted"><span class="quoted">"prefixList <span class="skolem">trace'</span> <span class="skolem">traceMsg</span>"</span></span>
        <span class="quoted"><span class="quoted">"last <span class="skolem">execMsg</span> <span class="main">=</span> <span class="skolem">cMsg</span>"</span></span> <span class="quoted"><span class="quoted">"last <span class="skolem">traceMsg</span> <span class="main">=</span> <span class="free">msg</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> expandExecutionStep <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">have</span></span> isPrefixListExec<span class="main">:</span> <span class="quoted"><span class="quoted">"prefixList <span class="free">exec</span> <span class="skolem">execMsg</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> PrefixListTransitive NewExec<span class="main">(</span>2<span class="main">)</span> ExecMsg<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
      <span class="keyword1"><span class="command">have</span></span> isPrefixListTrace<span class="main">:</span> <span class="quoted"><span class="quoted">"prefixList <span class="free">trace</span> <span class="skolem">traceMsg</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> PrefixListTransitive NewExec<span class="main">(</span>2<span class="main">)</span> ExecMsg<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> cMsgLastReachable<span class="main">:</span> <span class="quoted"><span class="quoted">"reachable <span class="skolem">cMsg</span> <span class="main">(</span>last <span class="skolem">execMsg</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ExecMsg reachable.init<span class="main">)</span> 
      <span class="keyword1"><span class="command">hence</span></span> isStepReachable<span class="main">:</span> <span class="quoted"><span class="quoted">"stepReachable <span class="main">(</span>last <span class="free">exec</span><span class="main">)</span> <span class="free">msg</span> <span class="main">(</span>last <span class="skolem">execMsg</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> CMsg lastExecExec'Reachable   
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> stepReachable_def<span class="main">)</span> 
      <span class="keyword1"><span class="command">have</span></span> InitReachLastExecMsg<span class="main">:</span> <span class="quoted"><span class="quoted">"initReachable <span class="main">(</span>last <span class="skolem">execMsg</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> CMsg InitReachLastExec' cMsgLastReachable 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ReachableTrans initReachable_def step<span class="main">)</span> 
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">val[</span><span class="free">p</span><span class="main">,</span> <span class="main">(</span>last <span class="skolem">exec'</span><span class="main">)</span><span class="main">]</span> <span class="main">⊆</span> <span class="keyword1">val[</span><span class="free">p</span><span class="main">,</span> <span class="skolem">cMsg</span><span class="main">]</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> CMsg PisReceiverOf InitReachLastExec'
          ActiveProcessSilentDecisionValuesIncrease<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="quoted">"last <span class="skolem">exec'</span>"</span></span> <span class="quoted"><span class="free">msg</span></span> <span class="quoted"><span class="skolem">cMsg</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> ExecMsg C'<span class="main">(</span>2<span class="main">)</span> NewExec<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> 
        <span class="quoted"><span class="quoted">"<span class="keyword1">val[</span><span class="free">p</span><span class="main">,</span> <span class="main">(</span>last <span class="skolem">execMsg</span><span class="main">)</span><span class="main">]</span> <span class="main">=</span> <span class="main">{</span>True<span class="main">,</span> False<span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> InitReachLastExecMsg <span class="keyword1"><span class="command">have</span></span> isNonUniform<span class="main">:</span> 
        <span class="quoted"><span class="quoted">"nonUniform <span class="main">(</span>last <span class="skolem">execMsg</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vUniform_def<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"reachable <span class="main">(</span>last <span class="free">exec</span><span class="main">)</span> <span class="main">(</span>last <span class="skolem">execMsg</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> lastExecExec'Reachable cMsgLastReachable CMsg 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ReachableTrans step<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> isAgreementPreventing<span class="main">:</span> 
        <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span> <span class="bound">cfg</span> <span class="main">.</span> reachable <span class="main">(</span>last <span class="skolem">execMsg</span><span class="main">)</span> <span class="bound">cfg</span> <span class="main">⟶</span> agreement <span class="bound">cfg</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> Agree <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ReachableTrans<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">msg</span> <span class="main">∈</span> set <span class="main">(</span>drop <span class="main">(</span>length <span class="free">trace</span><span class="main">)</span> <span class="skolem">traceMsg</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ExecMsg<span class="main">(</span>4<span class="main">)</span> 
        isPrefixListTrace 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> PrefixListMonotonicity last_drop last_in_set
          length_0_conv length_drop less_zeroE zero_less_diff<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> isExecution isNonUniform isPrefixListExec 
        isPrefixListTrace isAgreementPreventing isStepReachable <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">hence</span></span> notEnabled<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span>enabled <span class="main">(</span>last <span class="skolem">exec'</span><span class="main">)</span> <span class="free">msg</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> isStepReachable<span class="main">:</span> <span class="quoted"><span class="quoted">"stepReachable <span class="main">(</span>last <span class="free">exec</span><span class="main">)</span> <span class="free">msg</span> <span class="main">(</span>last <span class="skolem">exec'</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> MsgEnabled notEnabled lastExecExec'Reachable StepReachable 
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">with</span></span> NotStepReachable NewExec<span class="main">(</span>3<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span> 
  <span class="keyword1"><span class="command">qed</span></span> 
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="FLPTheorem-NonUniformExecutionBase"><span class="command">lemma</span></span> NonUniformExecutionBase<span class="main">:</span>
<span class="keyword2"><span class="keyword">fixes</span></span>
  <span class="free">cfg</span>
<span class="keyword2"><span class="keyword">assumes</span></span>
  Cfg<span class="main">:</span> <span class="quoted"><span class="quoted">"initial <span class="free">cfg</span>"</span></span> <span class="quoted"><span class="quoted">"nonUniform <span class="free">cfg</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> 
  <span class="quoted"><span class="quoted">"execution <span class="free">trans</span> <span class="free">sends</span> <span class="free">start</span> <span class="main">[</span><span class="free">cfg</span><span class="main">]</span> <span class="main">[]</span> 
  <span class="main">∧</span> nonUniform <span class="main">(</span>last <span class="main">[</span><span class="free">cfg</span><span class="main">]</span><span class="main">)</span> 
  <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">cfgList'</span> <span class="bound">msgList'</span><span class="main">.</span>  nonUniform <span class="main">(</span>last <span class="bound">cfgList'</span><span class="main">)</span> 
    <span class="main">∧</span> prefixList <span class="main">[</span><span class="free">cfg</span><span class="main">]</span> <span class="bound">cfgList'</span> 
    <span class="main">∧</span> prefixList <span class="main">[]</span> <span class="bound">msgList'</span>
    <span class="main">∧</span> <span class="main">(</span>execution <span class="free">trans</span> <span class="free">sends</span> <span class="free">start</span> <span class="bound">cfgList'</span> <span class="bound">msgList'</span><span class="main">)</span>
     <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">msg'</span><span class="main">.</span> execution.minimalEnabled <span class="main">[</span><span class="free">cfg</span><span class="main">]</span> <span class="main">[]</span> <span class="bound">msg'</span> 
         <span class="main">∧</span> <span class="bound">msg'</span> <span class="main">∈</span> set <span class="bound">msgList'</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> NonUniListCfg<span class="main">:</span> <span class="quoted"><span class="quoted">"nonUniform <span class="main">(</span>last <span class="main">[</span><span class="free">cfg</span><span class="main">]</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Cfg<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> AgreeCfg'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">cfg'</span> <span class="main">.</span> 
    reachable <span class="main">(</span>last <span class="main">[</span><span class="free">cfg</span><span class="main">]</span><span class="main">)</span> <span class="bound">cfg'</span> <span class="main">⟶</span> agreement <span class="bound">cfg'</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> Agreement Cfg<span class="main">(</span>1<span class="main">)</span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> agreementInit_def reachable.init agreement_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> StartExec<span class="main">:</span> <span class="quoted"><span class="quoted">"execution <span class="free">trans</span> <span class="free">sends</span> <span class="free">start</span> <span class="main">[</span><span class="free">cfg</span><span class="main">]</span> <span class="main">[]</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> Cfg<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">msg</span> <span class="main">.</span> execution.minimalEnabled <span class="main">[</span><span class="free">cfg</span><span class="main">]</span> <span class="main">[]</span> <span class="bound">msg</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> Cfg execution.ExistImpliesMinEnabled
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> enabled_def initial_def isReceiverOf.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> 
       last.simps zero_less_one<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">msg</span></span> <span class="keyword2"><span class="keyword">where</span></span> MinEnabledMsg<span class="main">:</span> 
    <span class="quoted"><span class="quoted">"execution.minimalEnabled <span class="main">[</span><span class="free">cfg</span><span class="main">]</span> <span class="main">[]</span> <span class="skolem">msg</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">pMin</span> <span class="main">.</span> isReceiverOf <span class="bound">pMin</span> <span class="skolem">msg</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> StartExec 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> execution.minimalEnabled_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">pMin</span></span> <span class="keyword2"><span class="keyword">where</span></span> PMin<span class="main">:</span> <span class="quoted"><span class="quoted">"isReceiverOf <span class="skolem">pMin</span> <span class="skolem">msg</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"enabled <span class="main">(</span>last <span class="main">[</span><span class="free">cfg</span><span class="main">]</span><span class="main">)</span> <span class="skolem">msg</span> <span class="main">∧</span> isReceiverOf <span class="skolem">pMin</span> <span class="skolem">msg</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> MinEnabledMsg StartExec 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> execution.minimalEnabled_def<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> Enabled<span class="main">:</span> <span class="quoted"><span class="quoted">"enabled <span class="main">(</span>last <span class="main">[</span><span class="free">cfg</span><span class="main">]</span><span class="main">)</span> <span class="skolem">msg</span>"</span></span> <span class="quoted"><span class="quoted">"isReceiverOf <span class="skolem">pMin</span> <span class="skolem">msg</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> Enabled StartExec NonUniListCfg PseudoTermination AgreeCfg' 
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">exec'</span> <span class="bound">trace'</span> <span class="main">.</span> <span class="main">(</span>execution <span class="free">trans</span> <span class="free">sends</span> <span class="free">start</span> <span class="bound">exec'</span> <span class="bound">trace'</span><span class="main">)</span> 
    <span class="main">∧</span> nonUniform <span class="main">(</span>last <span class="bound">exec'</span><span class="main">)</span>
    <span class="main">∧</span> prefixList <span class="main">[</span><span class="free">cfg</span><span class="main">]</span> <span class="bound">exec'</span> <span class="main">∧</span> prefixList <span class="main">[]</span> <span class="bound">trace'</span> 
    <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">cfg'</span> <span class="main">.</span> reachable <span class="main">(</span>last <span class="bound">exec'</span><span class="main">)</span> <span class="bound">cfg'</span> <span class="main">⟶</span> agreement <span class="bound">cfg'</span><span class="main">)</span>
    <span class="main">∧</span> stepReachable <span class="main">(</span>last <span class="main">[</span><span class="free">cfg</span><span class="main">]</span><span class="main">)</span> <span class="skolem">msg</span> <span class="main">(</span>last <span class="bound">exec'</span><span class="main">)</span> 
    <span class="main">∧</span> <span class="main">(</span><span class="skolem">msg</span> <span class="main">∈</span> set <span class="main">(</span>drop <span class="main">(</span>length <span class="main">[]</span><span class="main">)</span> <span class="bound">trace'</span><span class="main">)</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> NonUniformExecutionsConstructable<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">cfg</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">msg</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">pMin</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="main">[]</span><span class="main">::</span><span class="main">(</span><span class="tfree">'p</span><span class="main">,</span><span class="tfree">'v</span><span class="main">)</span> message list"</span></span><span class="main">]</span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> StartExec NonUniListCfg MinEnabledMsg <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="FLPTheorem-NonUniformExecutionStep"><span class="command">lemma</span></span> NonUniformExecutionStep<span class="main">:</span>
<span class="keyword2"><span class="keyword">fixes</span></span>
 <span class="free">cfgList</span> <span class="free">msgList</span>
<span class="keyword2"><span class="keyword">assumes</span></span>
  Init<span class="main">:</span> <span class="quoted"><span class="quoted">"initial <span class="main">(</span>hd <span class="free">cfgList</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  NonUni<span class="main">:</span> <span class="quoted"><span class="quoted">"nonUniform <span class="main">(</span>last <span class="free">cfgList</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  Execution<span class="main">:</span> <span class="quoted"><span class="quoted">"execution <span class="free">trans</span> <span class="free">sends</span> <span class="free">start</span> <span class="free">cfgList</span> <span class="free">msgList</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span> <span class="bound">cfgList'</span> <span class="bound">msgList'</span> <span class="main">.</span>
      nonUniform <span class="main">(</span>last <span class="bound">cfgList'</span><span class="main">)</span> 
      <span class="main">∧</span> prefixList <span class="free">cfgList</span> <span class="bound">cfgList'</span> 
      <span class="main">∧</span> prefixList <span class="free">msgList</span> <span class="bound">msgList'</span>
      <span class="main">∧</span> <span class="main">(</span>execution <span class="free">trans</span> <span class="free">sends</span> <span class="free">start</span> <span class="bound">cfgList'</span> <span class="bound">msgList'</span><span class="main">)</span> 
      <span class="main">∧</span> <span class="main">(</span>initial <span class="main">(</span>hd <span class="bound">cfgList'</span><span class="main">)</span><span class="main">)</span>
      <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">msg'</span><span class="main">.</span> execution.minimalEnabled <span class="free">cfgList</span> <span class="free">msgList</span> <span class="bound">msg'</span> 
        <span class="main">∧</span> <span class="bound">msg'</span> <span class="main">∈</span> <span class="main">(</span>set <span class="main">(</span>drop <span class="main">(</span>length <span class="free">msgList</span> <span class="main">)</span> <span class="bound">msgList'</span><span class="main">)</span><span class="main">)</span> <span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> ReachImplAgree<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">cfg</span> <span class="main">.</span> reachable <span class="main">(</span>last <span class="free">cfgList</span><span class="main">)</span> <span class="bound">cfg</span> 
    <span class="main">⟶</span> agreement <span class="bound">cfg</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Agreement Init NonUni ReachableTrans
    <span class="keyword1"><span class="command">unfolding</span></span> agreementInit_def agreement_def initReachable_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">msg</span> <span class="bound">p</span><span class="main">.</span> enabled <span class="main">(</span>last <span class="free">cfgList</span><span class="main">)</span> <span class="bound">msg</span> <span class="main">∧</span> isReceiverOf <span class="bound">p</span> <span class="bound">msg</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> PseudoTermination NonUni <span class="keyword1"><span class="command">have</span></span> 
      <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">c'</span><span class="main">.</span> qReachable <span class="main">(</span>last <span class="free">cfgList</span><span class="main">)</span> Proc <span class="bound">c'</span> <span class="main">∧</span> decided <span class="bound">c'</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> terminationPseudo_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c'</span></span> <span class="keyword2"><span class="keyword">where</span></span> C'<span class="main">:</span> <span class="quoted"><span class="quoted">"reachable <span class="main">(</span>last <span class="free">cfgList</span><span class="main">)</span> <span class="skolem">c'</span>"</span></span> 
        <span class="quoted"><span class="quoted">"decided <span class="skolem">c'</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> QReachImplReach <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
    <span class="keyword1"><span class="command">have</span></span> NoOut<span class="main">:</span> 
      <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">=</span> msgs <span class="main">(</span>last <span class="free">cfgList</span><span class="main">)</span> <span class="main">&lt;⊥,</span> <span class="keyword1">outM</span> False<span class="main">&gt;</span>"</span></span>  
      <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">=</span> msgs <span class="main">(</span>last <span class="free">cfgList</span><span class="main">)</span> <span class="main">&lt;⊥,</span> <span class="keyword1">outM</span> True<span class="main">&gt;</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> NonUni ReachImplAgree PseudoTermination 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> NonUniformImpliesNotDecided neq0_conv<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">with</span></span> C'<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>last <span class="free">cfgList</span><span class="main">)</span> <span class="main">≠</span> <span class="skolem">c'</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> less_zeroE<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> C'<span class="main">(</span>1<span class="main">)</span> ReachableStepFirst <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">msg</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> Enabled<span class="main">:</span> 
    <span class="quoted"><span class="quoted">"enabled <span class="main">(</span>last <span class="free">cfgList</span><span class="main">)</span> <span class="skolem">msg</span>"</span></span> <span class="quoted"><span class="quoted">"isReceiverOf <span class="skolem">p</span> <span class="skolem">msg</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">msg</span> <span class="main">.</span> execution.minimalEnabled <span class="free">cfgList</span> <span class="free">msgList</span> <span class="bound">msg</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> Init execution.ExistImpliesMinEnabled<span class="main">[</span><span class="operator">OF</span> Execution<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>        
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">msg'</span></span> <span class="keyword2"><span class="keyword">where</span></span> MinEnabledMsg<span class="main">:</span> 
    <span class="quoted"><span class="quoted">"execution.minimalEnabled <span class="free">cfgList</span> <span class="free">msgList</span> <span class="skolem">msg'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">p'</span> <span class="main">.</span> isReceiverOf <span class="bound">p'</span> <span class="skolem">msg'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Execution
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> execution.minimalEnabled_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p'</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    P'<span class="main">:</span> <span class="quoted"><span class="quoted">"isReceiverOf <span class="skolem">p'</span> <span class="skolem">msg'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> Enabled'<span class="main">:</span>
    <span class="quoted"><span class="quoted">"enabled <span class="main">(</span>last <span class="free">cfgList</span><span class="main">)</span> <span class="skolem">msg'</span>"</span></span> <span class="quoted"><span class="quoted">"isReceiverOf <span class="skolem">p'</span> <span class="skolem">msg'</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> MinEnabledMsg Execution
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> execution.minimalEnabled_def<span class="main">)</span>     
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">exec'</span> <span class="bound">trace'</span> <span class="main">.</span> <span class="main">(</span>execution <span class="free">trans</span> <span class="free">sends</span> <span class="free">start</span> <span class="bound">exec'</span> <span class="bound">trace'</span><span class="main">)</span> 
    <span class="main">∧</span> nonUniform <span class="main">(</span>last <span class="bound">exec'</span><span class="main">)</span>
    <span class="main">∧</span> prefixList <span class="free">cfgList</span> <span class="bound">exec'</span> <span class="main">∧</span> prefixList <span class="free">msgList</span> <span class="bound">trace'</span> 
    <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">cfg</span> <span class="main">.</span> reachable <span class="main">(</span>last <span class="bound">exec'</span><span class="main">)</span> <span class="bound">cfg</span> <span class="main">⟶</span> agreement <span class="bound">cfg</span><span class="main">)</span>
    <span class="main">∧</span> stepReachable <span class="main">(</span>last <span class="free">cfgList</span><span class="main">)</span> <span class="skolem">msg'</span> <span class="main">(</span>last <span class="bound">exec'</span><span class="main">)</span> 
    <span class="main">∧</span> <span class="main">(</span><span class="skolem">msg'</span> <span class="main">∈</span> set <span class="main">(</span>drop <span class="main">(</span>length <span class="free">msgList</span><span class="main">)</span> <span class="bound">trace'</span><span class="main">)</span><span class="main">)</span> "</span></span>
    <span class="keyword1"><span class="command">using</span></span> NonUniformExecutionsConstructable<span class="main">[</span><span class="operator">OF</span> Enabled' Execution
          NonUni<span class="main">]</span> ReachImplAgree <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> MinEnabledMsg <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> execution.base<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Non-uniformity even when demanding fairness›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Using \isb{NonUniformExecutionBase} and \isb{NonUniformExecutionStep} one can obtain
  non-uniform executions which are fair.

  Proving the fairness turned out quite cumbersome.
›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  These two functions construct infinite series of configurations lists
  and message lists from two extension functions. 
›</span></span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">infiniteExecutionCfg</span> <span class="main">::</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'p</span><span class="main">,</span> <span class="tfree">'v</span><span class="main">,</span> <span class="tfree">'s</span><span class="main">)</span> configuration <span class="main">⇒</span>
   <span class="main">(</span><span class="main">(</span><span class="tfree">'p</span><span class="main">,</span> <span class="tfree">'v</span><span class="main">,</span> <span class="tfree">'s</span><span class="main">)</span> configuration list <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'p</span><span class="main">,</span> <span class="tfree">'v</span><span class="main">)</span> message list 
    <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'p</span><span class="main">,</span> <span class="tfree">'v</span><span class="main">,</span> <span class="tfree">'s</span><span class="main">)</span> configuration list<span class="main">)</span> <span class="main">⇒</span>
   <span class="main">(</span><span class="main">(</span><span class="tfree">'p</span><span class="main">,</span> <span class="tfree">'v</span><span class="main">,</span> <span class="tfree">'s</span><span class="main">)</span> configuration list <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'p</span><span class="main">,</span> <span class="tfree">'v</span><span class="main">)</span> message list 
    <span class="main">⇒</span><span class="main">(</span><span class="tfree">'p</span><span class="main">,</span> <span class="tfree">'v</span><span class="main">)</span> message list<span class="main">)</span> 
  <span class="main">⇒</span> nat
  <span class="main">⇒</span> <span class="main">(</span><span class="main">(</span><span class="tfree">'p</span><span class="main">,</span> <span class="tfree">'v</span><span class="main">,</span> <span class="tfree">'s</span><span class="main">)</span> configuration list<span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span>  <span class="entity">infiniteExecutionMsg</span> <span class="main">::</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'p</span><span class="main">,</span> <span class="tfree">'v</span><span class="main">,</span> <span class="tfree">'s</span><span class="main">)</span> configuration <span class="main">⇒</span>
   <span class="main">(</span><span class="main">(</span><span class="tfree">'p</span><span class="main">,</span> <span class="tfree">'v</span><span class="main">,</span> <span class="tfree">'s</span><span class="main">)</span> configuration list <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'p</span><span class="main">,</span> <span class="tfree">'v</span><span class="main">)</span> message list 
    <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'p</span><span class="main">,</span> <span class="tfree">'v</span><span class="main">,</span> <span class="tfree">'s</span><span class="main">)</span> configuration list<span class="main">)</span> <span class="main">⇒</span>
   <span class="main">(</span><span class="main">(</span><span class="tfree">'p</span><span class="main">,</span> <span class="tfree">'v</span><span class="main">,</span> <span class="tfree">'s</span><span class="main">)</span> configuration list <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'p</span><span class="main">,</span> <span class="tfree">'v</span><span class="main">)</span> message list 
    <span class="main">⇒</span><span class="main">(</span><span class="tfree">'p</span><span class="main">,</span> <span class="tfree">'v</span><span class="main">)</span> message list<span class="main">)</span> 
  <span class="main">⇒</span> nat
  <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'p</span><span class="main">,</span> <span class="tfree">'v</span><span class="main">)</span> message list"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">infiniteExecutionCfg</span> <span class="free"><span class="bound"><span class="entity">cfg</span></span></span> <span class="free"><span class="bound"><span class="entity">fStepCfg</span></span></span> <span class="free"><span class="bound"><span class="entity">fStepMsg</span></span></span> <span class="main">0</span> <span class="main">=</span> <span class="main">[</span><span class="free"><span class="bound"><span class="entity">cfg</span></span></span><span class="main">]</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">infiniteExecutionCfg</span> <span class="free"><span class="bound"><span class="entity">cfg</span></span></span> <span class="free"><span class="bound"><span class="entity">fStepCfg</span></span></span> <span class="free"><span class="bound"><span class="entity">fStepMsg</span></span></span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">=</span>
    <span class="free"><span class="bound"><span class="entity">fStepCfg</span></span></span> <span class="main">(</span><span class="free">infiniteExecutionCfg</span> <span class="free"><span class="bound"><span class="entity">cfg</span></span></span> <span class="free"><span class="bound"><span class="entity">fStepCfg</span></span></span> <span class="free"><span class="bound"><span class="entity">fStepMsg</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> 
             <span class="main">(</span><span class="free">infiniteExecutionMsg</span> <span class="free"><span class="bound"><span class="entity">cfg</span></span></span> <span class="free"><span class="bound"><span class="entity">fStepCfg</span></span></span> <span class="free"><span class="bound"><span class="entity">fStepMsg</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">infiniteExecutionMsg</span> <span class="free"><span class="bound"><span class="entity">cfg</span></span></span> <span class="free"><span class="bound"><span class="entity">fStepCfg</span></span></span> <span class="free"><span class="bound"><span class="entity">fStepMsg</span></span></span> <span class="main">0</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">infiniteExecutionMsg</span> <span class="free"><span class="bound"><span class="entity">cfg</span></span></span> <span class="free"><span class="bound"><span class="entity">fStepCfg</span></span></span> <span class="free"><span class="bound"><span class="entity">fStepMsg</span></span></span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">=</span>
    <span class="free"><span class="bound"><span class="entity">fStepMsg</span></span></span> <span class="main">(</span><span class="free">infiniteExecutionCfg</span> <span class="free"><span class="bound"><span class="entity">cfg</span></span></span> <span class="free"><span class="bound"><span class="entity">fStepCfg</span></span></span> <span class="free"><span class="bound"><span class="entity">fStepMsg</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> 
             <span class="main">(</span><span class="free">infiniteExecutionMsg</span> <span class="free"><span class="bound"><span class="entity">cfg</span></span></span> <span class="free"><span class="bound"><span class="entity">fStepCfg</span></span></span> <span class="free"><span class="bound"><span class="entity">fStepMsg</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="FLPTheorem-FairNonUniformExecution"><span class="command">lemma</span></span> FairNonUniformExecution<span class="main">:</span>
<span class="keyword2"><span class="keyword">fixes</span></span>
  <span class="free">cfg</span>
<span class="keyword2"><span class="keyword">assumes</span></span>
  Cfg<span class="main">:</span> <span class="quoted"><span class="quoted">"initial <span class="free">cfg</span>"</span></span> <span class="quoted"><span class="quoted">"nonUniform <span class="free">cfg</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">fe</span> <span class="bound">ft</span><span class="main">.</span>
  <span class="main">(</span><span class="bound">fe</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span><span class="free">cfg</span><span class="main">]</span>
  <span class="main">∧</span> fairInfiniteExecution <span class="bound">fe</span> <span class="bound">ft</span>
  <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">n</span> <span class="main">.</span> nonUniform <span class="main">(</span>last <span class="main">(</span><span class="bound">fe</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span>
       <span class="main">∧</span> prefixList <span class="main">(</span><span class="bound">fe</span> <span class="bound">n</span><span class="main">)</span> <span class="main">(</span><span class="bound">fe</span> <span class="main">(</span><span class="bound">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> 
       <span class="main">∧</span> prefixList <span class="main">(</span><span class="bound">ft</span> <span class="bound">n</span><span class="main">)</span> <span class="main">(</span><span class="bound">ft</span> <span class="main">(</span><span class="bound">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>
       <span class="main">∧</span> <span class="main">(</span>execution <span class="free">trans</span> <span class="free">sends</span> <span class="free">start</span> <span class="main">(</span><span class="bound">fe</span> <span class="bound">n</span><span class="main">)</span> <span class="main">(</span><span class="bound">ft</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> BC<span class="main">:</span> 
    <span class="quoted"><span class="quoted">"execution <span class="free">trans</span> <span class="free">sends</span> <span class="free">start</span> <span class="main">[</span><span class="free">cfg</span><span class="main">]</span> <span class="main">[]</span> 
    <span class="main">∧</span> nonUniform <span class="main">(</span>last <span class="main">[</span><span class="free">cfg</span><span class="main">]</span><span class="main">)</span> 
    <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">cfgList'</span> <span class="bound">msgList'</span><span class="main">.</span>  nonUniform <span class="main">(</span>last <span class="bound">cfgList'</span><span class="main">)</span> 
    <span class="main">∧</span> prefixList <span class="main">[</span><span class="free">cfg</span><span class="main">]</span> <span class="bound">cfgList'</span> 
    <span class="main">∧</span> prefixList <span class="main">[]</span> <span class="bound">msgList'</span>
    <span class="main">∧</span> <span class="main">(</span>execution <span class="free">trans</span> <span class="free">sends</span> <span class="free">start</span> <span class="bound">cfgList'</span> <span class="bound">msgList'</span><span class="main">)</span>
    <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">msg'</span><span class="main">.</span> execution.minimalEnabled <span class="main">[</span><span class="free">cfg</span><span class="main">]</span> <span class="main">[]</span> <span class="bound">msg'</span> 
       <span class="main">∧</span> <span class="bound">msg'</span> <span class="main">∈</span> set <span class="bound">msgList'</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> NonUniformExecutionBase<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
  <span class="comment1">― ‹fStep ... a step leading to a fair execution.›</span> 
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">fStepCfg</span></span> <span class="skolem"><span class="skolem">fStepMsg</span></span> <span class="keyword2"><span class="keyword">where</span></span> FStep<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">cfgList</span> <span class="bound">msgList</span> <span class="main">.</span> <span class="main">∃</span><span class="bound">cfgList'</span> <span class="bound">msgList'</span> <span class="main">.</span>
          <span class="skolem">fStepCfg</span> <span class="bound">cfgList</span> <span class="bound">msgList</span> <span class="main">=</span> <span class="bound">cfgList'</span> <span class="main">∧</span>
          <span class="skolem">fStepMsg</span> <span class="bound">cfgList</span> <span class="bound">msgList</span> <span class="main">=</span> <span class="bound">msgList'</span> <span class="main">∧</span>
          <span class="main">(</span>initial <span class="main">(</span>hd <span class="bound">cfgList</span><span class="main">)</span> <span class="main">∧</span>
          nonUniform <span class="main">(</span>last <span class="bound">cfgList</span><span class="main">)</span> <span class="main">∧</span>
          execution <span class="free">trans</span> <span class="free">sends</span> <span class="free">start</span> <span class="bound">cfgList</span> <span class="bound">msgList</span> <span class="main">⟶</span> 
          <span class="main">(</span>nonUniform <span class="main">(</span>last <span class="main">(</span><span class="skolem">fStepCfg</span> <span class="bound">cfgList</span> <span class="bound">msgList</span><span class="main">)</span><span class="main">)</span> 
          <span class="main">∧</span> prefixList <span class="bound">cfgList</span> <span class="main">(</span><span class="skolem">fStepCfg</span> <span class="bound">cfgList</span> <span class="bound">msgList</span><span class="main">)</span> 
          <span class="main">∧</span> prefixList <span class="bound">msgList</span> <span class="main">(</span><span class="skolem">fStepMsg</span> <span class="bound">cfgList</span> <span class="bound">msgList</span><span class="main">)</span> 
          <span class="main">∧</span> execution <span class="free">trans</span> <span class="free">sends</span> <span class="free">start</span> <span class="main">(</span><span class="skolem">fStepCfg</span> <span class="bound">cfgList</span> <span class="bound">msgList</span><span class="main">)</span> 
              <span class="main">(</span><span class="skolem">fStepMsg</span> <span class="bound">cfgList</span> <span class="bound">msgList</span><span class="main">)</span> 
          <span class="main">∧</span> <span class="main">(</span>initial <span class="main">(</span>hd <span class="main">(</span><span class="skolem">fStepCfg</span> <span class="bound">cfgList</span> <span class="bound">msgList</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
          <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">msg'</span><span class="main">.</span> execution.minimalEnabled <span class="bound">cfgList</span> <span class="bound">msgList</span> <span class="bound">msg'</span> 
            <span class="main">∧</span> <span class="bound">msg'</span> <span class="main">∈</span> <span class="main">(</span>set <span class="main">(</span>drop <span class="main">(</span>length <span class="bound">msgList</span><span class="main">)</span> 
                                <span class="main">(</span><span class="skolem">fStepMsg</span> <span class="bound">cfgList</span> <span class="bound">msgList</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">using</span></span> NonUniformExecutionStep
      PredicatePairFunctions2<span class="main">[</span><span class="operator">of</span> 
        <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">cfgList</span> <span class="bound">msgList</span> <span class="bound">cfgList'</span> <span class="bound">msgList'</span><span class="main">.</span> 
          <span class="main">(</span>initial <span class="main">(</span>hd <span class="bound">cfgList</span><span class="main">)</span> 
          <span class="main">∧</span> nonUniform <span class="main">(</span>last <span class="bound">cfgList</span><span class="main">)</span> 
          <span class="main">∧</span> execution <span class="free">trans</span> <span class="free">sends</span> <span class="free">start</span> <span class="bound">cfgList</span> <span class="bound">msgList</span> 
            <span class="main">⟶</span> <span class="main">(</span>nonUniform <span class="main">(</span>last <span class="bound">cfgList'</span><span class="main">)</span> 
            <span class="main">∧</span> prefixList <span class="bound">cfgList</span> <span class="bound">cfgList'</span> 
            <span class="main">∧</span> prefixList <span class="bound">msgList</span> <span class="bound">msgList'</span> 
            <span class="main">∧</span> execution <span class="free">trans</span> <span class="free">sends</span> <span class="free">start</span> <span class="bound">cfgList'</span> <span class="bound">msgList'</span>
            <span class="main">∧</span> <span class="main">(</span>initial <span class="main">(</span>hd <span class="bound">cfgList'</span><span class="main">)</span><span class="main">)</span>
            <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">msg'</span><span class="main">.</span> execution.minimalEnabled <span class="bound">cfgList</span> <span class="bound">msgList</span> <span class="bound">msg'</span> 
              <span class="main">∧</span> <span class="bound">msg'</span> <span class="main">∈</span> <span class="main">(</span>set <span class="main">(</span>drop <span class="main">(</span>length <span class="bound">msgList</span> <span class="main">)</span> <span class="bound">msgList'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"False"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">fe</span></span> <span class="skolem"><span class="skolem">ft</span></span>
    <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">fe</span> <span class="main">=</span> infiniteExecutionCfg <span class="free">cfg</span> <span class="skolem">fStepCfg</span> <span class="skolem">fStepMsg</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ft</span> <span class="main">=</span> infiniteExecutionMsg <span class="free">cfg</span> <span class="skolem">fStepCfg</span> <span class="skolem">fStepMsg</span>"</span></span>
  
  <span class="keyword1"><span class="command">have</span></span> BasicProperties<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">n</span><span class="main">.</span> nonUniform <span class="main">(</span>last <span class="main">(</span><span class="skolem">fe</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> 
    <span class="main">∧</span> prefixList <span class="main">(</span><span class="skolem">fe</span> <span class="bound">n</span><span class="main">)</span> <span class="main">(</span><span class="skolem">fe</span> <span class="main">(</span><span class="bound">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> prefixList <span class="main">(</span><span class="skolem">ft</span> <span class="bound">n</span><span class="main">)</span> <span class="main">(</span><span class="skolem">ft</span> <span class="main">(</span><span class="bound">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> 
    <span class="main">∧</span> execution <span class="free">trans</span> <span class="free">sends</span> <span class="free">start</span> <span class="main">(</span><span class="skolem">fe</span> <span class="bound">n</span><span class="main">)</span> <span class="main">(</span><span class="skolem">ft</span> <span class="bound">n</span><span class="main">)</span> 
    <span class="main">∧</span> initial <span class="main">(</span>hd <span class="main">(</span><span class="skolem">fe</span> <span class="main">(</span><span class="bound">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"nonUniform <span class="main">(</span>last <span class="main">(</span><span class="skolem">fe</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
          prefixList <span class="main">(</span><span class="skolem">fe</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span><span class="skolem">fe</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span><span class="main">)</span> 
          <span class="main">∧</span> prefixList <span class="main">(</span><span class="skolem">ft</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span><span class="skolem">ft</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span><span class="main">)</span> 
          <span class="main">∧</span> execution <span class="free">trans</span> <span class="free">sends</span> <span class="free">start</span> <span class="main">(</span><span class="skolem">fe</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span><span class="skolem">ft</span> <span class="skolem">n</span><span class="main">)</span> 
          <span class="main">∧</span> initial <span class="main">(</span>hd <span class="main">(</span><span class="skolem">fe</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">n</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> 0
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">fe</span> <span class="main">0</span> <span class="main">=</span> <span class="main">[</span><span class="free">cfg</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ft</span> <span class="main">0</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">fe</span> <span class="main">1</span> <span class="main">=</span> <span class="skolem">fStepCfg</span> <span class="main">(</span><span class="skolem">fe</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="skolem">ft</span> <span class="main">0</span><span class="main">)</span>"</span></span> 
        <span class="quoted"><span class="quoted">"<span class="skolem">ft</span> <span class="main">1</span> <span class="main">=</span> <span class="skolem">fStepMsg</span> <span class="main">(</span><span class="skolem">fe</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="skolem">ft</span> <span class="main">0</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> fe_def ft_def
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> BC FStep
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> execution.base<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> fe_def ft_def
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">metis</span> FStep execution.base<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> Fair<span class="main">:</span> <span class="quoted"><span class="quoted">"fairInfiniteExecution <span class="skolem">fe</span> <span class="skolem">ft</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> BasicProperties
    <span class="keyword1"><span class="command">unfolding</span></span> fairInfiniteExecution_def infiniteExecution_def 
      execution_def flpSystem_def
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> finiteProcs minimalProcs finiteSends noInSends<span class="main">)</span> 
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span> <span class="skolem">n0</span> <span class="skolem">p</span> <span class="skolem">msg</span>
    <span class="keyword3"><span class="command">assume</span></span> AssumptionFair<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> initReachable <span class="main">(</span>last <span class="main">(</span><span class="skolem">fe</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
       <span class="main">¬</span> vUniform False <span class="main">(</span>last <span class="main">(</span><span class="skolem">fe</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
       <span class="main">¬</span> vUniform True <span class="main">(</span>last <span class="main">(</span><span class="skolem">fe</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
       prefixList <span class="main">(</span><span class="skolem">fe</span> <span class="bound">n</span><span class="main">)</span> <span class="main">(</span><span class="skolem">fe</span> <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
       prefixList <span class="main">(</span><span class="skolem">ft</span> <span class="bound">n</span><span class="main">)</span> <span class="main">(</span><span class="skolem">ft</span> <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
       Suc <span class="main">0</span> <span class="main">≤</span> length <span class="main">(</span><span class="skolem">fe</span> <span class="bound">n</span><span class="main">)</span> <span class="main">∧</span>
       length <span class="main">(</span><span class="skolem">fe</span> <span class="bound">n</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span> <span class="main">=</span> length <span class="main">(</span><span class="skolem">ft</span> <span class="bound">n</span><span class="main">)</span> <span class="main">∧</span>
       initial <span class="main">(</span>hd <span class="main">(</span><span class="skolem">fe</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> 
       <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span>length <span class="main">(</span><span class="skolem">fe</span> <span class="bound">n</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="skolem">fe</span> <span class="bound">n</span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span> <span class="main">⊢</span> <span class="main">(</span><span class="skolem">ft</span> <span class="bound">n</span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span> 
       <span class="main">↦</span> <span class="main">(</span><span class="skolem">fe</span> <span class="bound">n</span> <span class="main">!</span> Suc <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> initial <span class="main">(</span>hd <span class="main">(</span><span class="skolem">fe</span> <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="quoted"><span class="quoted">"<span class="skolem">n0</span> <span class="main">&lt;</span> length <span class="main">(</span><span class="skolem">fe</span> <span class="skolem">n</span><span class="main">)</span>"</span></span>
      <span class="quoted"><span class="quoted">"enabled <span class="main">(</span><span class="skolem">fe</span> <span class="skolem">n</span> <span class="main">!</span> <span class="skolem">n0</span><span class="main">)</span> <span class="skolem">msg</span>"</span></span> 
      <span class="quoted"><span class="quoted">"isReceiverOf <span class="skolem">p</span> <span class="skolem">msg</span>"</span></span> 
      <span class="quoted"><span class="quoted">"correctInfinite <span class="skolem">fe</span> <span class="skolem">ft</span> <span class="skolem">p</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> MessageStaysOrConsumed<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">n</span> <span class="bound">n1</span> <span class="bound">n2</span> <span class="bound">msg</span><span class="main">.</span> 
      <span class="main">(</span><span class="bound">n1</span> <span class="main">≤</span> <span class="bound">n2</span> <span class="main">∧</span> <span class="bound">n2</span> <span class="main">&lt;</span> length <span class="main">(</span><span class="skolem">fe</span> <span class="bound">n</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>enabled <span class="main">(</span><span class="skolem">fe</span> <span class="bound">n</span> <span class="main">!</span> <span class="bound">n1</span><span class="main">)</span> <span class="bound">msg</span><span class="main">)</span><span class="main">)</span> 
      <span class="main">⟶</span> <span class="main">(</span>enabled <span class="main">(</span><span class="skolem">fe</span> <span class="bound">n</span> <span class="main">!</span> <span class="bound">n2</span><span class="main">)</span> <span class="bound">msg</span><span class="main">)</span> 
          <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span> <span class="bound"><span class="bound">n0'</span></span> <span class="main">≥</span> <span class="bound">n1</span><span class="main">.</span> <span class="bound">n0'</span> <span class="main">&lt;</span> length <span class="main">(</span><span class="skolem">ft</span> <span class="bound">n</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">ft</span> <span class="bound">n</span> <span class="main">!</span> <span class="bound">n0'</span> <span class="main">=</span> <span class="bound">msg</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span> <span class="skolem">n1</span> <span class="skolem">n2</span> <span class="skolem">msg</span>
      <span class="keyword3"><span class="command">assume</span></span> Ass<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n1</span> <span class="main">≤</span> <span class="skolem">n2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n2</span> <span class="main">&lt;</span> length <span class="main">(</span><span class="skolem">fe</span> <span class="skolem">n</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"enabled <span class="main">(</span><span class="skolem">fe</span> <span class="skolem">n</span> <span class="main">!</span> <span class="skolem">n1</span><span class="main">)</span> <span class="skolem">msg</span>"</span></span>
        <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">index</span></span><span class="main">&lt;</span>length <span class="main">(</span><span class="skolem">ft</span> <span class="skolem">n</span><span class="main">)</span><span class="main">.</span> <span class="skolem">n1</span> <span class="main">≤</span> <span class="bound">index</span> <span class="main">⟶</span> <span class="skolem">ft</span> <span class="skolem">n</span> <span class="main">!</span> <span class="bound">index</span> <span class="main">≠</span> <span class="skolem">msg</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound"><span class="bound">k</span></span> <span class="main">≤</span> <span class="skolem">n2</span> <span class="main">-</span> <span class="skolem">n1</span> <span class="main">.</span> 
        msgs <span class="main">(</span><span class="skolem">fe</span> <span class="skolem">n</span> <span class="main">!</span> <span class="skolem">n1</span><span class="main">)</span> <span class="skolem">msg</span> <span class="main">≤</span> msgs <span class="main">(</span><span class="skolem">fe</span> <span class="skolem">n</span> <span class="main">!</span> <span class="main">(</span><span class="skolem">n1</span> <span class="main">+</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="skolem">msg</span>"</span></span> 
      <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">k</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">≤</span> <span class="skolem">n2</span> <span class="main">-</span> <span class="skolem">n1</span> <span class="main">⟹</span> 
          msgs <span class="main">(</span><span class="skolem">fe</span> <span class="skolem">n</span> <span class="main">!</span> <span class="skolem">n1</span><span class="main">)</span> <span class="skolem">msg</span> <span class="main">≤</span> msgs <span class="main">(</span><span class="skolem">fe</span> <span class="skolem">n</span> <span class="main">!</span> <span class="main">(</span><span class="skolem">n1</span> <span class="main">+</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="skolem">msg</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">k</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">k</span>
          <span class="keyword3"><span class="command">assume</span></span> IV<span class="main">:</span> <span class="quoted"><span class="quoted">"msgs <span class="main">(</span><span class="skolem">fe</span> <span class="skolem">n</span> <span class="main">!</span> <span class="skolem">n1</span><span class="main">)</span> <span class="skolem">msg</span> <span class="main">≤</span> msgs <span class="main">(</span><span class="skolem">fe</span> <span class="skolem">n</span> <span class="main">!</span> <span class="main">(</span><span class="skolem">n1</span> <span class="main">+</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="skolem">msg</span>"</span></span> 
            <span class="quoted"><span class="quoted">"Suc <span class="skolem">k</span> <span class="main">≤</span> <span class="skolem">n2</span> <span class="main">-</span> <span class="skolem">n1</span>"</span></span>
          <span class="keyword1"><span class="command">from</span></span> BasicProperties <span class="keyword1"><span class="command">have</span></span> Exec<span class="main">:</span> 
            <span class="quoted"><span class="quoted">"execution <span class="free">trans</span> <span class="free">sends</span> <span class="free">start</span> <span class="main">(</span><span class="skolem">fe</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span><span class="skolem">ft</span> <span class="skolem">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n2</span> <span class="main">≤</span> length <span class="main">(</span><span class="skolem">ft</span> <span class="skolem">n</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> Exec Ass<span class="main">(</span>2<span class="main">)</span>
            execution.length<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">trans</span></span> <span class="quoted"><span class="free">sends</span></span> <span class="quoted"><span class="free">start</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">fe</span> <span class="skolem">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ft</span> <span class="skolem">n</span>"</span></span><span class="main">]</span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">hence</span></span> RightIndex<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n1</span> <span class="main">+</span> <span class="skolem">k</span> <span class="main">≥</span> <span class="skolem">n1</span> <span class="main">∧</span> <span class="skolem">n1</span> <span class="main">+</span> <span class="skolem">k</span> <span class="main">&lt;</span> length <span class="main">(</span><span class="skolem">ft</span> <span class="skolem">n</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> IV<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">have</span></span>  Step<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">fe</span> <span class="skolem">n</span> <span class="main">!</span> <span class="main">(</span><span class="skolem">n1</span> <span class="main">+</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="main">⊢</span> <span class="main">(</span><span class="skolem">ft</span> <span class="skolem">n</span> <span class="main">!</span> <span class="main">(</span><span class="skolem">n1</span> <span class="main">+</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> 
                      <span class="main">↦</span> <span class="main">(</span><span class="skolem">fe</span> <span class="skolem">n</span> <span class="main">!</span> Suc <span class="main">(</span><span class="skolem">n1</span> <span class="main">+</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> Exec execution.step<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">trans</span></span> <span class="quoted"><span class="free">sends</span></span> <span class="quoted"><span class="free">start</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">fe</span> <span class="skolem">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ft</span> <span class="skolem">n</span>"</span></span> 
              <span class="quoted"><span class="quoted">"<span class="skolem">n1</span> <span class="main">+</span> <span class="skolem">k</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">fe</span> <span class="skolem">n</span> <span class="main">!</span> <span class="main">(</span><span class="skolem">n1</span> <span class="main">+</span> <span class="skolem">k</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">fe</span> <span class="skolem">n</span> <span class="main">!</span> <span class="main">(</span><span class="skolem">n1</span> <span class="main">+</span> <span class="skolem">k</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span><span class="main">]</span> IV<span class="main">(</span>2<span class="main">)</span> 
              Ass<span class="main">(</span>2<span class="main">)</span> 
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">msg</span> <span class="main">≠</span> <span class="main">(</span><span class="skolem">ft</span> <span class="skolem">n</span> <span class="main">!</span> <span class="main">(</span><span class="skolem">n1</span> <span class="main">+</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> Ass<span class="main">(</span>4<span class="main">)</span> Ass<span class="main">(</span>2<span class="main">)</span> IV<span class="main">(</span>2<span class="main">)</span> RightIndex Exec 
            execution.length<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">trans</span></span> <span class="quoted"><span class="free">sends</span></span> <span class="quoted"><span class="free">start</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">fe</span> <span class="skolem">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ft</span> <span class="skolem">n</span>"</span></span><span class="main">]</span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"msgs <span class="main">(</span><span class="skolem">fe</span> <span class="skolem">n</span> <span class="main">!</span> <span class="skolem">n1</span><span class="main">)</span> <span class="skolem">msg</span> <span class="main">≤</span> msgs <span class="main">(</span><span class="skolem">fe</span> <span class="skolem">n</span> <span class="main">!</span> Suc <span class="main">(</span><span class="skolem">n1</span> <span class="main">+</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="skolem">msg</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> Step OtherMessagesOnlyGrowing<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">fe</span> <span class="skolem">n</span> <span class="main">!</span> <span class="main">(</span><span class="skolem">n1</span> <span class="main">+</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span>"</span></span> 
              <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">ft</span> <span class="skolem">n</span> <span class="main">!</span> <span class="main">(</span><span class="skolem">n1</span> <span class="main">+</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">fe</span> <span class="skolem">n</span> <span class="main">!</span> Suc <span class="main">(</span><span class="skolem">n1</span> <span class="main">+</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">msg</span>"</span></span><span class="main">]</span> IV<span class="main">(</span>1<span class="main">)</span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"msgs <span class="main">(</span><span class="skolem">fe</span> <span class="skolem">n</span> <span class="main">!</span> <span class="skolem">n1</span><span class="main">)</span> <span class="skolem">msg</span> <span class="main">≤</span> msgs <span class="main">(</span><span class="skolem">fe</span> <span class="skolem">n</span> <span class="main">!</span> <span class="skolem">n2</span><span class="main">)</span> <span class="skolem">msg</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Ass<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> le_add_diff_inverse order_refl<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"enabled <span class="main">(</span><span class="skolem">fe</span> <span class="skolem">n</span> <span class="main">!</span> <span class="skolem">n2</span><span class="main">)</span> <span class="skolem">msg</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Ass<span class="main">(</span>3<span class="main">)</span> enabled_def 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> gr0I leD<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">have</span></span> EnabledOrConsumed<span class="main">:</span> <span class="quoted"><span class="quoted">"enabled <span class="main">(</span><span class="skolem">fe</span> <span class="skolem">n</span> <span class="main">!</span> <span class="main">(</span>length <span class="main">(</span><span class="skolem">fe</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="skolem">msg</span> 
      <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">n0'</span></span><span class="main">≥</span><span class="skolem">n0</span><span class="main">.</span> <span class="bound">n0'</span> <span class="main">&lt;</span> length <span class="main">(</span><span class="skolem">ft</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">ft</span> <span class="skolem">n</span> <span class="main">!</span> <span class="bound">n0'</span> <span class="main">=</span> <span class="skolem">msg</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> AssumptionFair<span class="main">(</span>3<span class="main">)</span> AssumptionFair<span class="main">(</span>2<span class="main">)</span> 
        MessageStaysOrConsumed<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">n0</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="skolem">fe</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">msg</span>"</span></span><span class="main">]</span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> EnabledOrConsumedAtLast<span class="main">:</span> <span class="quoted"><span class="quoted">"enabled <span class="main">(</span>last <span class="main">(</span><span class="skolem">fe</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="skolem">msg</span> <span class="main">∨</span> 
      <span class="main">(</span><span class="main">∃</span> <span class="bound">n0'</span> <span class="main">.</span> <span class="bound">n0'</span> <span class="main">≥</span> <span class="skolem">n0</span> <span class="main">∧</span> <span class="bound">n0'</span> <span class="main">&lt;</span> length <span class="main">(</span><span class="skolem">ft</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">ft</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">!</span> <span class="bound">n0'</span> <span class="main">=</span> <span class="skolem">msg</span> <span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> EnabledOrConsumed last_conv_nth AssumptionFair<span class="main">(</span>2<span class="main">)</span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> length_0_conv less_nat_zero_code<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> Case2ImplThesis<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span> <span class="bound">n0'</span> <span class="main">.</span> <span class="bound">n0'</span> <span class="main">≥</span> <span class="skolem">n0</span> <span class="main">∧</span> <span class="bound">n0'</span> <span class="main">&lt;</span> length <span class="main">(</span><span class="skolem">ft</span> <span class="skolem">n</span><span class="main">)</span> 
      <span class="main">∧</span> <span class="skolem">ft</span> <span class="skolem">n</span> <span class="main">!</span> <span class="bound">n0'</span> <span class="main">=</span> <span class="skolem">msg</span><span class="main">)</span> 
      <span class="main">⟹</span> <span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">n'</span></span><span class="main">≥</span><span class="skolem">n</span><span class="main">.</span> <span class="main">∃</span><span class="bound"><span class="bound">n0'</span></span><span class="main">≥</span><span class="skolem">n0</span><span class="main">.</span> <span class="bound">n0'</span> <span class="main">&lt;</span> length <span class="main">(</span><span class="skolem">ft</span> <span class="bound">n'</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">msg</span> <span class="main">=</span> <span class="skolem">ft</span> <span class="bound">n'</span> <span class="main">!</span> <span class="bound">n0'</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> Case1ImplThesis'<span class="main">:</span> <span class="quoted"><span class="quoted">"enabled <span class="main">(</span>last <span class="main">(</span><span class="skolem">fe</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="skolem">msg</span> 
      <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">n'</span></span><span class="main">≥</span><span class="skolem">n</span><span class="main">.</span> <span class="main">∃</span><span class="bound"><span class="bound">n0'</span></span><span class="main">≥</span> <span class="main">(</span>length <span class="main">(</span><span class="skolem">ft</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="bound">n0'</span> <span class="main">&lt;</span> length <span class="main">(</span><span class="skolem">ft</span> <span class="bound">n'</span><span class="main">)</span> 
          <span class="main">∧</span> <span class="skolem">msg</span> <span class="main">=</span> <span class="skolem">ft</span> <span class="bound">n'</span> <span class="main">!</span> <span class="bound">n0'</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> AssumptionCase1ImplThesis'<span class="main">:</span> <span class="quoted"><span class="quoted">"enabled <span class="main">(</span>last <span class="main">(</span><span class="skolem">fe</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="skolem">msg</span>"</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">n'</span></span><span class="main">≥</span><span class="skolem">n</span><span class="main">.</span> <span class="main">∃</span><span class="bound"><span class="bound">n0'</span></span><span class="main">≥</span>length <span class="main">(</span><span class="skolem">ft</span> <span class="skolem">n</span><span class="main">)</span><span class="main">.</span> <span class="bound">n0'</span> <span class="main">&lt;</span> length <span class="main">(</span><span class="skolem">ft</span> <span class="bound">n'</span><span class="main">)</span> 
        <span class="main">∧</span> <span class="skolem">msg</span> <span class="main">=</span> <span class="skolem">ft</span> <span class="bound">n'</span> <span class="main">!</span> <span class="bound">n0'</span>"</span></span> 
      <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span> ccontr<span class="main"><span class="keyword3">,</span></span><span class="operator">simp</span><span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> AssumptionFairContr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">n'</span></span><span class="main">≥</span><span class="skolem">n</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">n0'</span></span><span class="main">&lt;</span>length <span class="main">(</span><span class="skolem">ft</span> <span class="bound">n'</span><span class="main">)</span><span class="main">.</span> 
          length <span class="main">(</span><span class="skolem">ft</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">≤</span> <span class="bound">n0'</span> <span class="main">⟶</span> <span class="skolem">msg</span> <span class="main">≠</span> <span class="skolem">ft</span> <span class="bound">n'</span> <span class="main">!</span> <span class="bound">n0'</span>"</span></span>
        <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">firstOccSet</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">firstOccSet</span> <span class="skolem">n</span> <span class="main">=</span> <span class="main">{</span> <span class="bound">msg1</span> <span class="main">.</span> <span class="main">∃</span> <span class="bound">nMsg</span> <span class="main">.</span> 
          <span class="main">∃</span> <span class="bound"><span class="bound">n1</span></span> <span class="main">≤</span> <span class="bound">nMsg</span> <span class="main">.</span> 
          execution.firstOccurrence <span class="main">(</span><span class="skolem">fe</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span><span class="skolem">ft</span> <span class="skolem">n</span><span class="main">)</span> <span class="bound">msg1</span> <span class="bound">n1</span> 
          <span class="main">∧</span> execution.firstOccurrence <span class="main">(</span><span class="skolem">fe</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span><span class="skolem">ft</span> <span class="skolem">n</span><span class="main">)</span> <span class="skolem">msg</span> <span class="bound">nMsg</span> <span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
        <span class="keyword1"><span class="command">have</span></span> NotEmpty<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">fe</span> <span class="skolem">n</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">using</span></span>  AssumptionFair<span class="main">(</span>2<span class="main">)</span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> less_nat_zero_code list.size<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> FirstToLast'<span class="main">:</span> 
          <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">n</span> <span class="main">.</span> reachable <span class="main">(</span><span class="main">(</span><span class="skolem">fe</span> <span class="bound">n</span><span class="main">)</span> <span class="main">!</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="skolem">fe</span> <span class="bound">n</span><span class="main">)</span> <span class="main">!</span> <span class="main">(</span>length <span class="main">(</span><span class="skolem">fe</span> <span class="bound">n</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> execution.ReachableInExecution BasicProperties execution.notEmpty
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> diff_less less_or_eq_imp_le not_gr0 not_one_le_zero<span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> FirstToLast<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">n</span> <span class="main">.</span> reachable <span class="main">(</span>hd <span class="main">(</span><span class="skolem">fe</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>last <span class="main">(</span><span class="skolem">fe</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> NotEmpty hd_conv_nth last_conv_nth AssumptionFair<span class="main">(</span>1<span class="main">)</span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> One_nat_def length_0_conv 
            not_one_le_zero<span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> InitToLast<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">n</span> <span class="main">.</span> initReachable <span class="main">(</span>last <span class="main">(</span><span class="skolem">fe</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> BasicProperties <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">msg</span> <span class="bound">n0</span> <span class="main">.</span> <span class="main">∀</span> <span class="bound">n</span> <span class="main">.</span> 
          <span class="main">(</span>execution.firstOccurrence <span class="main">(</span><span class="skolem">fe</span> <span class="bound">n</span><span class="main">)</span> <span class="main">(</span><span class="skolem">ft</span> <span class="bound">n</span><span class="main">)</span> <span class="bound">msg</span> <span class="bound">n0</span><span class="main">)</span> 
          <span class="main">⟶</span>  <span class="main">0</span> <span class="main">&lt;</span> msgs <span class="main">(</span>last <span class="main">(</span><span class="skolem">fe</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="bound">msg</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> BasicProperties execution.firstOccurrence_def 
            enabled_def
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">n</span> <span class="main">.</span> <span class="main">∀</span> <span class="bound">msg'</span> <span class="main">∈</span> <span class="main">(</span><span class="skolem">firstOccSet</span> <span class="bound">n</span><span class="main">)</span> <span class="main">.</span> 
          <span class="main">0</span> <span class="main">&lt;</span> msgs <span class="main">(</span>last <span class="main">(</span><span class="skolem">fe</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="bound">msg'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> firstOccSet_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">n</span> <span class="main">.</span> <span class="skolem">firstOccSet</span> <span class="bound">n</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound">msg</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> msgs <span class="main">(</span>last <span class="main">(</span><span class="skolem">fe</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="bound">msg</span><span class="main">}</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>lifting<span class="main"><span class="main">,</span></span> full_types<span class="main"><span class="main">)</span></span> mem_Collect_eq subsetI<span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> FiniteMsgs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">n</span> <span class="main">.</span> finite <span class="main">(</span><span class="skolem">firstOccSet</span> <span class="bound">n</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> FiniteMessages<span class="main">[</span><span class="operator">OF</span> finiteProcs finiteSends<span class="main">]</span> InitToLast
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> rev_finite_subset<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> FirstOccSetDecrOrConsumed<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">index</span> <span class="main">.</span> 
          <span class="main">(</span>enabled <span class="main">(</span>last <span class="main">(</span><span class="skolem">fe</span> <span class="bound">index</span><span class="main">)</span><span class="main">)</span> <span class="skolem">msg</span><span class="main">)</span> 
          <span class="main">⟶</span> <span class="main">(</span><span class="skolem">firstOccSet</span> <span class="main">(</span>Suc <span class="bound">index</span><span class="main">)</span> <span class="main">⊂</span> <span class="skolem">firstOccSet</span> <span class="bound">index</span> 
          <span class="main">∧</span> <span class="main">(</span>enabled <span class="main">(</span>last <span class="main">(</span><span class="skolem">fe</span> <span class="main">(</span>Suc <span class="bound">index</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="skolem">msg</span><span class="main">)</span>
            <span class="main">∨</span> <span class="skolem">msg</span> <span class="main">∈</span> <span class="main">(</span>set <span class="main">(</span>drop <span class="main">(</span>length <span class="main">(</span><span class="skolem">ft</span> <span class="bound">index</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">ft</span> <span class="main">(</span>Suc <span class="bound">index</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">index</span>
          <span class="keyword3"><span class="command">assume</span></span> AssumptionFirstOccSetDecrOrConsumed<span class="main">:</span>
            <span class="quoted"><span class="quoted">"enabled <span class="main">(</span>last <span class="main">(</span><span class="skolem">fe</span> <span class="skolem">index</span><span class="main">)</span><span class="main">)</span> <span class="skolem">msg</span>"</span></span> 
            <span class="quoted"><span class="quoted">"<span class="skolem">msg</span> <span class="main">∉</span> set <span class="main">(</span>drop <span class="main">(</span>length <span class="main">(</span><span class="skolem">ft</span> <span class="skolem">index</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">ft</span> <span class="main">(</span>Suc <span class="skolem">index</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">have</span></span> NotEmpty<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">fe</span> <span class="main">(</span>Suc <span class="skolem">index</span><span class="main">)</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">fe</span> <span class="skolem">index</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> BasicProperties 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> AssumptionFair<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> One_nat_def list.size<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> 
              not_one_le_zero<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
          <span class="keyword1"><span class="command">have</span></span> LengthStep<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="skolem">ft</span> <span class="main">(</span>Suc <span class="skolem">index</span><span class="main">)</span><span class="main">)</span> <span class="main">&gt;</span> length <span class="main">(</span><span class="skolem">ft</span> <span class="skolem">index</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> AssumptionFair<span class="main">(</span>1<span class="main">)</span> 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> PrefixListMonotonicity<span class="main">)</span>              
          <span class="keyword1"><span class="command">have</span></span> IPrefixList<span class="main">:</span>
            <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">i</span><span class="main">::</span>nat <span class="main">.</span> prefixList <span class="main">(</span><span class="skolem">ft</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="skolem">ft</span> <span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> AssumptionFair<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">have</span></span> IPrefixListEx<span class="main">:</span>
            <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">i</span><span class="main">::</span>nat <span class="main">.</span> prefixList <span class="main">(</span><span class="skolem">fe</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="skolem">fe</span> <span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> AssumptionFair<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">have</span></span> LastOfIndex<span class="main">:</span>
            <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">fe</span> <span class="main">(</span>Suc <span class="skolem">index</span><span class="main">)</span> <span class="main">!</span> <span class="main">(</span>length <span class="main">(</span><span class="skolem">fe</span> <span class="skolem">index</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span> 
            <span class="main">=</span> <span class="main">(</span>last <span class="main">(</span><span class="skolem">fe</span> <span class="skolem">index</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> PrefixSameOnLow<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">fe</span> <span class="skolem">index</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">fe</span> <span class="main">(</span>Suc <span class="skolem">index</span><span class="main">)</span>"</span></span><span class="main">]</span>
              IPrefixListEx<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">index</span></span><span class="main">]</span>
              NotEmpty LengthStep 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> last_conv_nth<span class="main">)</span>
          <span class="keyword1"><span class="command">have</span></span> NotConsumedIntermediate<span class="main">:</span> 
            <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound"><span class="bound">i</span></span><span class="main">::</span>nat <span class="main">&lt;</span> length <span class="main">(</span><span class="skolem">ft</span> <span class="main">(</span>Suc <span class="skolem">index</span><span class="main">)</span><span class="main">)</span> <span class="main">.</span> 
              <span class="main">(</span><span class="bound">i</span> <span class="main">≥</span> length <span class="main">(</span><span class="skolem">ft</span> <span class="skolem">index</span><span class="main">)</span>
              <span class="main">⟶</span> <span class="skolem">ft</span> <span class="main">(</span>Suc <span class="skolem">index</span><span class="main">)</span> <span class="main">!</span> <span class="bound">i</span> <span class="main">≠</span> <span class="skolem">msg</span><span class="main">)</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> AssumptionFirstOccSetDecrOrConsumed<span class="main">(</span>2<span class="main">)</span> ListLenDrop 
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">hence</span></span> 
            <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="main">∃</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> length <span class="main">(</span><span class="skolem">ft</span> <span class="main">(</span>Suc <span class="skolem">index</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">≥</span> length <span class="main">(</span><span class="skolem">ft</span> <span class="skolem">index</span><span class="main">)</span>
            <span class="main">∧</span> <span class="skolem">msg</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">ft</span> <span class="main">(</span>Suc <span class="skolem">index</span><span class="main">)</span><span class="main">)</span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> execution.length BasicProperties
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="main">∃</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> length <span class="main">(</span><span class="skolem">fe</span> <span class="main">(</span>Suc <span class="skolem">index</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span> 
            <span class="main">∧</span> <span class="bound">i</span> <span class="main">≥</span> length <span class="main">(</span><span class="skolem">fe</span> <span class="skolem">index</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span> 
            <span class="main">∧</span> <span class="skolem">msg</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">ft</span> <span class="main">(</span>Suc <span class="skolem">index</span><span class="main">)</span><span class="main">)</span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> BasicProperties<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">index</span>"</span></span><span class="main">]</span>
              BasicProperties<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">index</span>"</span></span><span class="main">]</span>
              execution.length<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">trans</span></span> <span class="quoted"><span class="free">sends</span></span> <span class="quoted"><span class="free">start</span></span><span class="main">]</span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">hence</span></span> EnabledIntermediate<span class="main">:</span> 
            <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound"><span class="bound">i</span></span> <span class="main">&lt;</span> length <span class="main">(</span><span class="skolem">fe</span> <span class="main">(</span>Suc <span class="skolem">index</span><span class="main">)</span><span class="main">)</span> <span class="main">.</span> <span class="main">(</span><span class="bound">i</span> <span class="main">≥</span> length <span class="main">(</span><span class="skolem">fe</span> <span class="skolem">index</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span>
              <span class="main">⟶</span> enabled <span class="main">(</span><span class="skolem">fe</span> <span class="main">(</span>Suc <span class="skolem">index</span><span class="main">)</span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span> <span class="skolem">msg</span><span class="main">)</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> BasicProperties<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">index</span>"</span></span><span class="main">]</span>
              BasicProperties<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">index</span>"</span></span><span class="main">]</span>
              execution.StaysEnabled<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">trans</span></span> <span class="quoted"><span class="free">sends</span></span> <span class="quoted"><span class="free">start</span></span>
              <span class="quoted"><span class="quoted">"<span class="skolem">fe</span> <span class="main">(</span>Suc <span class="skolem">index</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ft</span> <span class="main">(</span>Suc <span class="skolem">index</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"last <span class="main">(</span><span class="skolem">fe</span> <span class="skolem">index</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="skolem">msg</span></span> 
              <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="skolem">fe</span> <span class="skolem">index</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span> "</span></span><span class="main">]</span>
              AssumptionFirstOccSetDecrOrConsumed<span class="main">(</span>1<span class="main">)</span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> AssumptionFair<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> LastOfIndex 
              MessageStaysOrConsumed<span class="main">)</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="skolem">fe</span> <span class="main">(</span>Suc <span class="skolem">index</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span> <span class="main">≥</span> length <span class="main">(</span><span class="skolem">fe</span> <span class="skolem">index</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> PrefixListMonotonicity NotEmpty BasicProperties 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> AssumptionFair<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> diff_le_mono less_imp_le<span class="main">)</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"enabled <span class="main">(</span><span class="skolem">fe</span> <span class="main">(</span>Suc <span class="skolem">index</span><span class="main">)</span> 
            <span class="main">!</span> <span class="main">(</span>length <span class="main">(</span><span class="skolem">fe</span> <span class="main">(</span>Suc <span class="skolem">index</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="skolem">msg</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> EnabledIntermediate NotEmpty<span class="main">(</span>1<span class="main">)</span> 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> diff_less length_greater_0_conv zero_less_one<span class="main">)</span>
          <span class="keyword1"><span class="command">hence</span></span> EnabledInSuc<span class="main">:</span> <span class="quoted"><span class="quoted">"enabled <span class="main">(</span>last <span class="main">(</span><span class="skolem">fe</span> <span class="main">(</span>Suc <span class="skolem">index</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="skolem">msg</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> NotEmpty last_conv_nth<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">fe</span> <span class="main">(</span>Suc <span class="skolem">index</span><span class="main">)</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">have</span></span> IndexIsExec<span class="main">:</span> 
            <span class="quoted"><span class="quoted">"execution <span class="free">trans</span> <span class="free">sends</span> <span class="free">start</span> <span class="main">(</span><span class="skolem">fe</span> <span class="skolem">index</span><span class="main">)</span> <span class="main">(</span><span class="skolem">ft</span> <span class="skolem">index</span><span class="main">)</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> BasicProperties <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">have</span></span> SucIndexIsExec<span class="main">:</span> 
            <span class="quoted"><span class="quoted">"execution <span class="free">trans</span> <span class="free">sends</span> <span class="free">start</span> <span class="main">(</span><span class="skolem">fe</span> <span class="main">(</span>Suc <span class="skolem">index</span><span class="main">)</span><span class="main">)</span> 
              <span class="main">(</span><span class="skolem">ft</span> <span class="main">(</span>Suc <span class="skolem">index</span><span class="main">)</span><span class="main">)</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> BasicProperties <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">have</span></span> SameCfgOnLow<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound"><span class="bound">i</span></span> <span class="main">&lt;</span> length <span class="main">(</span><span class="skolem">fe</span> <span class="skolem">index</span><span class="main">)</span> <span class="main">.</span> <span class="main">(</span><span class="skolem">fe</span> <span class="skolem">index</span><span class="main">)</span> <span class="main">!</span> <span class="bound">i</span>
            <span class="main">=</span> <span class="main">(</span><span class="skolem">fe</span> <span class="main">(</span>Suc <span class="skolem">index</span><span class="main">)</span><span class="main">)</span> <span class="main">!</span> <span class="bound">i</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> BasicProperties PrefixSameOnLow <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">have</span></span> SameMsgOnLow<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound"><span class="bound">i</span></span> <span class="main">&lt;</span> length <span class="main">(</span><span class="skolem">ft</span> <span class="skolem">index</span><span class="main">)</span> <span class="main">.</span> <span class="main">(</span><span class="skolem">ft</span> <span class="skolem">index</span><span class="main">)</span> <span class="main">!</span> <span class="bound">i</span>
            <span class="main">=</span> <span class="main">(</span><span class="skolem">ft</span> <span class="main">(</span>Suc <span class="skolem">index</span><span class="main">)</span><span class="main">)</span> <span class="main">!</span> <span class="bound">i</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> BasicProperties PrefixSameOnLow <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">have</span></span> SmallIndex<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">nMsg</span> <span class="main">.</span> execution.firstOccurrence
            <span class="main">(</span><span class="skolem">fe</span> <span class="main">(</span>Suc <span class="skolem">index</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">ft</span> <span class="main">(</span>Suc <span class="skolem">index</span><span class="main">)</span><span class="main">)</span> <span class="skolem">msg</span> <span class="bound">nMsg</span> 
            <span class="main">⟹</span> <span class="bound">nMsg</span> <span class="main">&lt;</span> length <span class="main">(</span><span class="skolem">fe</span> <span class="skolem">index</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">-</span><span class="main">)</span>
            <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">nMsg</span>
            <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"execution.firstOccurrence <span class="main">(</span><span class="skolem">fe</span> <span class="main">(</span>Suc <span class="skolem">index</span><span class="main">)</span><span class="main">)</span> 
              <span class="main">(</span><span class="skolem">ft</span> <span class="main">(</span>Suc <span class="skolem">index</span><span class="main">)</span><span class="main">)</span> <span class="skolem">msg</span> <span class="skolem">nMsg</span>"</span></span>
            <span class="keyword1"><span class="command">hence</span></span> AssumptionSubset3<span class="main">:</span> 
              <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">p</span><span class="main">.</span> isReceiverOf <span class="bound">p</span> <span class="skolem">msg</span>"</span></span>
                <span class="quoted"><span class="quoted">"enabled <span class="main">(</span>last <span class="main">(</span><span class="skolem">fe</span> <span class="main">(</span>Suc <span class="skolem">index</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="skolem">msg</span>"</span></span>
                <span class="quoted"><span class="quoted">"<span class="skolem">nMsg</span> <span class="main">&lt;</span> length <span class="main">(</span><span class="skolem">fe</span> <span class="main">(</span>Suc <span class="skolem">index</span><span class="main">)</span><span class="main">)</span>"</span></span>
                <span class="quoted"><span class="quoted">"enabled <span class="main">(</span><span class="skolem">fe</span> <span class="main">(</span>Suc <span class="skolem">index</span><span class="main">)</span> <span class="main">!</span> <span class="skolem">nMsg</span><span class="main">)</span> <span class="skolem">msg</span>"</span></span>
                <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">n'</span></span><span class="main">≥</span><span class="skolem">nMsg</span><span class="main">.</span> <span class="bound">n'</span> <span class="main">&lt;</span> length <span class="main">(</span><span class="skolem">ft</span> <span class="main">(</span>Suc <span class="skolem">index</span><span class="main">)</span><span class="main">)</span> 
                <span class="main">⟶</span> <span class="skolem">msg</span> <span class="main">≠</span> <span class="skolem">ft</span> <span class="main">(</span>Suc <span class="skolem">index</span><span class="main">)</span> <span class="main">!</span> <span class="bound">n'</span>"</span></span>
                <span class="quoted"><span class="quoted">"<span class="skolem">nMsg</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟶</span> <span class="main">¬</span> enabled <span class="main">(</span><span class="skolem">fe</span> <span class="main">(</span>Suc <span class="skolem">index</span><span class="main">)</span> <span class="main">!</span> <span class="main">(</span><span class="skolem">nMsg</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> 
                <span class="skolem">msg</span> <span class="main">∨</span> <span class="skolem">msg</span> <span class="main">=</span> <span class="skolem">ft</span> <span class="main">(</span>Suc <span class="skolem">index</span><span class="main">)</span> <span class="main">!</span> <span class="main">(</span><span class="skolem">nMsg</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> execution.firstOccurrence_def<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">trans</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">sends</span>"</span></span> 
                <span class="quoted"><span class="quoted">"<span class="free">start</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">fe</span> <span class="main">(</span>Suc <span class="skolem">index</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ft</span> <span class="main">(</span>Suc <span class="skolem">index</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">msg</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">nMsg</span>"</span></span><span class="main">]</span>
                SucIndexIsExec <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">nMsg</span> <span class="main">&lt;</span> length <span class="main">(</span><span class="skolem">fe</span> <span class="skolem">index</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
              <span class="keyword3"><span class="command">assume</span></span> AssumpSmallIndex<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">nMsg</span> <span class="main">&lt;</span> length <span class="main">(</span><span class="skolem">fe</span> <span class="skolem">index</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">fe</span> <span class="skolem">index</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> BasicProperties 
                AssumptionFair<span class="main">(</span>1<span class="main">)</span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> One_nat_def list.size<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> not_one_le_zero<span class="main">)</span>
              <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="skolem">fe</span> <span class="skolem">index</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> 
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> length_greater_0_conv<span class="main">)</span>
              <span class="keyword1"><span class="command">hence</span></span> nMsgNotZero<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">nMsg</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> 
                <span class="keyword1"><span class="command">using</span></span> AssumpSmallIndex <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
              <span class="keyword1"><span class="command">hence</span></span> SucCases<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> enabled <span class="main">(</span><span class="main">(</span><span class="skolem">fe</span> <span class="main">(</span>Suc <span class="skolem">index</span><span class="main">)</span><span class="main">)</span> <span class="main">!</span> <span class="main">(</span><span class="skolem">nMsg</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>
                <span class="skolem">msg</span> <span class="main">∨</span> <span class="skolem">msg</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">ft</span> <span class="main">(</span>Suc <span class="skolem">index</span><span class="main">)</span><span class="main">)</span> <span class="main">!</span> <span class="main">(</span><span class="skolem">nMsg</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> AssumptionSubset3<span class="main">(</span>6<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
              <span class="keyword1"><span class="command">have</span></span> Cond1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">nMsg</span> <span class="main">-</span> <span class="main">1</span> <span class="main">≥</span> length <span class="main">(</span><span class="skolem">fe</span> <span class="skolem">index</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> AssumpSmallIndex <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> diff_le_mono leI<span class="main">)</span>
              <span class="keyword1"><span class="command">hence</span></span> Enabled<span class="main">:</span> <span class="quoted"><span class="quoted">"enabled <span class="main">(</span><span class="skolem">fe</span> <span class="main">(</span>Suc <span class="skolem">index</span><span class="main">)</span> <span class="main">!</span> <span class="main">(</span><span class="skolem">nMsg</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="skolem">msg</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> EnabledIntermediate AssumptionSubset3<span class="main">(</span>3<span class="main">)</span> 
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> less_imp_diff_less<span class="main">)</span>
              <span class="keyword1"><span class="command">have</span></span> Cond2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">nMsg</span> <span class="main">-</span> <span class="main">1</span> <span class="main">≥</span> length <span class="main">(</span><span class="skolem">ft</span> <span class="skolem">index</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">nMsg</span> <span class="main">-</span> <span class="main">1</span>
                <span class="main">&lt;</span> length <span class="main">(</span><span class="skolem">ft</span> <span class="main">(</span>Suc <span class="skolem">index</span><span class="main">)</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> Cond1 execution.length<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">trans</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">sends</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">start</span>"</span></span>
                  <span class="quoted"><span class="quoted">"<span class="skolem">fe</span> <span class="skolem">index</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ft</span> <span class="skolem">index</span>"</span></span><span class="main">]</span>
                  IndexIsExec AssumptionSubset3<span class="main">(</span>3<span class="main">)</span> 
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> AssumptionFair<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> One_nat_def Suc_diff_1 
                    Suc_eq_plus1 less_diff_conv nMsgNotZero neq0_conv<span class="main">)</span>
              <span class="keyword1"><span class="command">hence</span></span> NotConsumed<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ft</span> <span class="main">(</span>Suc <span class="skolem">index</span><span class="main">)</span> <span class="main">!</span> <span class="main">(</span><span class="skolem">nMsg</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">≠</span> <span class="skolem">msg</span>"</span></span> 
                <span class="keyword1"><span class="command">using</span></span> NotConsumedIntermediate <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
              <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> SucCases Enabled NotConsumed
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">have</span></span> Subset<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">msgInSet</span> <span class="main">.</span> <span class="bound">msgInSet</span> <span class="main">∈</span> <span class="skolem">firstOccSet</span> <span class="main">(</span>Suc <span class="skolem">index</span><span class="main">)</span>
            <span class="main">⟹</span> <span class="bound">msgInSet</span> <span class="main">∈</span> <span class="skolem">firstOccSet</span> <span class="skolem">index</span>"</span></span> 
          <span class="keyword1"><span class="command">unfolding</span></span> firstOccSet_def
          <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
            <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">msgInSet</span> <span class="skolem">nMsg</span> <span class="skolem">n1</span>
            <span class="keyword3"><span class="command">assume</span></span> AssumptionSubset<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n1</span> <span class="main">≤</span> <span class="skolem">nMsg</span>"</span></span>
              <span class="quoted"><span class="quoted">"execution.firstOccurrence <span class="main">(</span><span class="skolem">fe</span> <span class="main">(</span>Suc <span class="skolem">index</span><span class="main">)</span><span class="main">)</span> 
                <span class="main">(</span><span class="skolem">ft</span> <span class="main">(</span>Suc <span class="skolem">index</span><span class="main">)</span><span class="main">)</span> <span class="skolem">msgInSet</span> <span class="skolem">n1</span>"</span></span>
              <span class="quoted"><span class="quoted">"execution.firstOccurrence <span class="main">(</span><span class="skolem">fe</span> <span class="main">(</span>Suc <span class="skolem">index</span><span class="main">)</span><span class="main">)</span> 
                <span class="main">(</span><span class="skolem">ft</span> <span class="main">(</span>Suc <span class="skolem">index</span><span class="main">)</span><span class="main">)</span> <span class="skolem">msg</span> <span class="skolem">nMsg</span>"</span></span>
            <span class="keyword1"><span class="command">have</span></span> AssumptionSubset2<span class="main">:</span> 
              <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">p</span><span class="main">.</span> isReceiverOf <span class="bound">p</span> <span class="skolem">msgInSet</span>"</span></span>
                <span class="quoted"><span class="quoted">"enabled <span class="main">(</span>last <span class="main">(</span><span class="skolem">fe</span> <span class="main">(</span>Suc <span class="skolem">index</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="skolem">msgInSet</span>"</span></span>
                <span class="quoted"><span class="quoted">"<span class="skolem">n1</span> <span class="main">&lt;</span> length <span class="main">(</span><span class="skolem">fe</span> <span class="main">(</span>Suc <span class="skolem">index</span><span class="main">)</span><span class="main">)</span>"</span></span>
                <span class="quoted"><span class="quoted">"enabled <span class="main">(</span><span class="skolem">fe</span> <span class="main">(</span>Suc <span class="skolem">index</span><span class="main">)</span> <span class="main">!</span> <span class="skolem">n1</span><span class="main">)</span> <span class="skolem">msgInSet</span>"</span></span>
                <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">n'</span></span><span class="main">≥</span><span class="skolem">n1</span><span class="main">.</span> <span class="bound">n'</span> <span class="main">&lt;</span> length <span class="main">(</span><span class="skolem">ft</span> <span class="main">(</span>Suc <span class="skolem">index</span><span class="main">)</span><span class="main">)</span> 
                  <span class="main">⟶</span> <span class="skolem">msgInSet</span> <span class="main">≠</span> <span class="skolem">ft</span> <span class="main">(</span>Suc <span class="skolem">index</span><span class="main">)</span> <span class="main">!</span> <span class="bound">n'</span>"</span></span>
                <span class="quoted"><span class="quoted">"<span class="skolem">n1</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟶</span> <span class="main">¬</span> enabled <span class="main">(</span><span class="skolem">fe</span> <span class="main">(</span>Suc <span class="skolem">index</span><span class="main">)</span> <span class="main">!</span> <span class="main">(</span><span class="skolem">n1</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> 
                  <span class="skolem">msgInSet</span> <span class="main">∨</span> <span class="skolem">msgInSet</span> <span class="main">=</span> <span class="skolem">ft</span> <span class="main">(</span>Suc <span class="skolem">index</span><span class="main">)</span> <span class="main">!</span> <span class="main">(</span><span class="skolem">n1</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> execution.firstOccurrence_def<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">trans</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">sends</span>"</span></span> 
                <span class="quoted"><span class="quoted">"<span class="free">start</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">fe</span> <span class="main">(</span>Suc <span class="skolem">index</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ft</span> <span class="main">(</span>Suc <span class="skolem">index</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">msgInSet</span>"</span></span> 
                <span class="quoted"><span class="quoted">"<span class="skolem">n1</span>"</span></span><span class="main">]</span> AssumptionSubset<span class="main">(</span>2<span class="main">)</span> SucIndexIsExec <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
            <span class="keyword1"><span class="command">have</span></span> AssumptionSubset3<span class="main">:</span> 
              <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">p</span><span class="main">.</span> isReceiverOf <span class="bound">p</span> <span class="skolem">msg</span>"</span></span>
                <span class="quoted"><span class="quoted">"enabled <span class="main">(</span>last <span class="main">(</span><span class="skolem">fe</span> <span class="main">(</span>Suc <span class="skolem">index</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="skolem">msg</span>"</span></span>
                <span class="quoted"><span class="quoted">"<span class="skolem">nMsg</span> <span class="main">&lt;</span> length <span class="main">(</span><span class="skolem">fe</span> <span class="main">(</span>Suc <span class="skolem">index</span><span class="main">)</span><span class="main">)</span>"</span></span>
                <span class="quoted"><span class="quoted">"enabled <span class="main">(</span><span class="skolem">fe</span> <span class="main">(</span>Suc <span class="skolem">index</span><span class="main">)</span> <span class="main">!</span> <span class="skolem">nMsg</span><span class="main">)</span> <span class="skolem">msg</span>"</span></span>
                <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">n'</span></span><span class="main">≥</span><span class="skolem">nMsg</span><span class="main">.</span> <span class="bound">n'</span> <span class="main">&lt;</span> length <span class="main">(</span><span class="skolem">ft</span> <span class="main">(</span>Suc <span class="skolem">index</span><span class="main">)</span><span class="main">)</span> 
                  <span class="main">⟶</span> <span class="skolem">msg</span> <span class="main">≠</span> <span class="skolem">ft</span> <span class="main">(</span>Suc <span class="skolem">index</span><span class="main">)</span> <span class="main">!</span> <span class="bound">n'</span>"</span></span>
                <span class="quoted"><span class="quoted">"<span class="skolem">nMsg</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟶</span> <span class="main">¬</span> enabled <span class="main">(</span><span class="skolem">fe</span> <span class="main">(</span>Suc <span class="skolem">index</span><span class="main">)</span> <span class="main">!</span> <span class="main">(</span><span class="skolem">nMsg</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> 
                  <span class="skolem">msg</span> <span class="main">∨</span> <span class="skolem">msg</span> <span class="main">=</span> <span class="skolem">ft</span> <span class="main">(</span>Suc <span class="skolem">index</span><span class="main">)</span> <span class="main">!</span> <span class="main">(</span><span class="skolem">nMsg</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> execution.firstOccurrence_def<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">trans</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">sends</span>"</span></span> 
                <span class="quoted"><span class="quoted">"<span class="free">start</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">fe</span> <span class="main">(</span>Suc <span class="skolem">index</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ft</span> <span class="main">(</span>Suc <span class="skolem">index</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">msg</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">nMsg</span>"</span></span><span class="main">]</span>
                AssumptionSubset<span class="main">(</span>3<span class="main">)</span> SucIndexIsExec <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">have</span></span> ShorterTrace<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="skolem">ft</span> <span class="skolem">index</span><span class="main">)</span> 
                                <span class="main">&lt;</span> length <span class="main">(</span><span class="skolem">ft</span> <span class="main">(</span>Suc <span class="skolem">index</span><span class="main">)</span><span class="main">)</span>"</span></span> 
              <span class="keyword1"><span class="command">using</span></span> PrefixListMonotonicity BasicProperties <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

            <span class="keyword1"><span class="command">have</span></span> FirstOccurrenceMsg<span class="main">:</span> <span class="quoted"><span class="quoted">"execution.firstOccurrence 
              <span class="main">(</span><span class="skolem">fe</span> <span class="skolem">index</span><span class="main">)</span> <span class="main">(</span><span class="skolem">ft</span> <span class="skolem">index</span><span class="main">)</span> <span class="skolem">msg</span> <span class="skolem">nMsg</span>"</span></span>
            <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
              <span class="keyword1"><span class="command">have</span></span> Occ1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">p</span> <span class="main">.</span> isReceiverOf <span class="bound">p</span> <span class="skolem">msg</span>"</span></span> 
                <span class="keyword1"><span class="command">using</span></span> AssumptionSubset3<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
              <span class="keyword1"><span class="command">have</span></span> Occ2<span class="main">:</span> <span class="quoted"><span class="quoted">"enabled <span class="main">(</span>last <span class="main">(</span><span class="skolem">fe</span> <span class="skolem">index</span><span class="main">)</span><span class="main">)</span> <span class="skolem">msg</span>"</span></span> 
                <span class="keyword1"><span class="command">using</span></span> AssumptionFirstOccSetDecrOrConsumed <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">fe</span> <span class="skolem">index</span><span class="main">)</span> <span class="main">!</span> <span class="skolem">nMsg</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">fe</span> <span class="main">(</span>Suc <span class="skolem">index</span><span class="main">)</span><span class="main">)</span> <span class="main">!</span> <span class="skolem">nMsg</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> SmallIndex AssumptionSubset<span class="main">(</span>3<span class="main">)</span> 
                  PrefixSameOnLow<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">fe</span> <span class="skolem">index</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">fe</span> <span class="main">(</span>Suc <span class="skolem">index</span><span class="main">)</span>"</span></span><span class="main">]</span> 
                  BasicProperties 
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
              <span class="keyword1"><span class="command">hence</span></span> Occ4<span class="main">:</span> <span class="quoted"><span class="quoted">"enabled <span class="main">(</span><span class="main">(</span><span class="skolem">fe</span> <span class="skolem">index</span><span class="main">)</span> <span class="main">!</span> <span class="skolem">nMsg</span><span class="main">)</span> <span class="skolem">msg</span>"</span></span> 
                <span class="keyword1"><span class="command">using</span></span> AssumptionSubset3<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
              <span class="keyword1"><span class="command">have</span></span> OccSameMsg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound"><span class="bound">n'</span></span> <span class="main">≥</span> <span class="skolem">nMsg</span> <span class="main">.</span> <span class="bound">n'</span> <span class="main">&lt;</span> length <span class="main">(</span><span class="skolem">ft</span> <span class="skolem">index</span><span class="main">)</span> 
                <span class="main">⟶</span> <span class="main">(</span><span class="skolem">ft</span> <span class="skolem">index</span><span class="main">)</span> <span class="main">!</span> <span class="bound">n'</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">ft</span> <span class="main">(</span>Suc <span class="skolem">index</span><span class="main">)</span><span class="main">)</span> <span class="main">!</span> <span class="bound">n'</span>"</span></span> 
                <span class="keyword1"><span class="command">using</span></span> PrefixSameOnLow BasicProperties <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">hence</span></span> Occ5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound"><span class="bound">n'</span></span> <span class="main">≥</span> <span class="skolem">nMsg</span> <span class="main">.</span> <span class="bound">n'</span> <span class="main">&lt;</span> length <span class="main">(</span><span class="skolem">ft</span> <span class="skolem">index</span><span class="main">)</span> 
                <span class="main">⟶</span> <span class="skolem">msg</span> <span class="main">≠</span> <span class="main">(</span><span class="main">(</span><span class="skolem">ft</span> <span class="skolem">index</span><span class="main">)</span> <span class="main">!</span> <span class="bound">n'</span><span class="main">)</span>"</span></span> 
                <span class="keyword1"><span class="command">using</span></span> AssumptionSubset3<span class="main">(</span>5<span class="main">)</span> ShorterTrace <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

              <span class="keyword1"><span class="command">have</span></span> Occ6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">nMsg</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">¬</span> enabled <span class="main">(</span><span class="main">(</span><span class="skolem">fe</span> <span class="skolem">index</span><span class="main">)</span> <span class="main">!</span> 
                <span class="main">(</span><span class="skolem">nMsg</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="skolem">msg</span> <span class="main">∨</span> <span class="skolem">msg</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">ft</span> <span class="skolem">index</span> <span class="main">)</span> <span class="main">!</span> <span class="main">(</span><span class="skolem">nMsg</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span> 
              <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
                <span class="keyword3"><span class="command">assume</span></span> AssumpOcc6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">nMsg</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">msg</span> <span class="main">≠</span> <span class="skolem">ft</span> <span class="skolem">index</span> <span class="main">!</span> 
                  <span class="main">(</span><span class="skolem">nMsg</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"enabled <span class="main">(</span><span class="skolem">fe</span> <span class="skolem">index</span> <span class="main">!</span> <span class="main">(</span><span class="skolem">nMsg</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="skolem">msg</span>"</span></span>
                <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">nMsg</span> <span class="main">-</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="main">&lt;</span> length <span class="main">(</span><span class="skolem">fe</span> <span class="skolem">index</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span>"</span></span> 
                  <span class="keyword1"><span class="command">using</span></span> SmallIndex AssumptionSubset<span class="main">(</span>3<span class="main">)</span> AssumpOcc6<span class="main">(</span>1<span class="main">)</span> 
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc_le_eq diff_less_mono<span class="main">)</span>
                <span class="keyword1"><span class="command">hence</span></span> SmallIndexTrace<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">nMsg</span> <span class="main">-</span> <span class="main">1</span> <span class="main">&lt;</span> length <span class="main">(</span><span class="skolem">ft</span> <span class="skolem">index</span><span class="main">)</span>"</span></span> 
                  <span class="keyword1"><span class="command">using</span></span> IndexIsExec execution.length 
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> One_nat_def<span class="main">)</span>
                <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> enabled <span class="main">(</span><span class="skolem">fe</span> <span class="main">(</span>Suc <span class="skolem">index</span><span class="main">)</span> <span class="main">!</span> <span class="main">(</span><span class="skolem">nMsg</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="skolem">msg</span> 
                  <span class="main">∨</span> <span class="skolem">msg</span> <span class="main">=</span> <span class="skolem">ft</span> <span class="main">(</span>Suc <span class="skolem">index</span><span class="main">)</span> <span class="main">!</span> <span class="main">(</span><span class="skolem">nMsg</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> AssumptionSubset3<span class="main">(</span>6<span class="main">)</span> AssumpOcc6<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
                <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">fe</span> <span class="main">(</span>Suc <span class="skolem">index</span><span class="main">)</span> <span class="main">!</span> <span class="main">(</span><span class="skolem">nMsg</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> 
                  <span class="main">=</span> <span class="skolem">fe</span> <span class="skolem">index</span> <span class="main">!</span> <span class="main">(</span><span class="skolem">nMsg</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> SameCfgOnLow SmallIndex AssumptionSubset<span class="main">(</span>3<span class="main">)</span> 
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> less_imp_diff_less<span class="main">)</span>
                <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ft</span> <span class="main">(</span>Suc <span class="skolem">index</span><span class="main">)</span> <span class="main">!</span> <span class="main">(</span><span class="skolem">nMsg</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> 
                  <span class="main">=</span> <span class="skolem">ft</span> <span class="skolem">index</span> <span class="main">!</span> <span class="main">(</span><span class="skolem">nMsg</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> SameMsgOnLow SmallIndexTrace <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span> 
                <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> enabled <span class="main">(</span><span class="skolem">fe</span> <span class="skolem">index</span> <span class="main">!</span> <span class="main">(</span><span class="skolem">nMsg</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="skolem">msg</span> 
                  <span class="main">∨</span> <span class="skolem">msg</span> <span class="main">=</span> <span class="skolem">ft</span> <span class="skolem">index</span> <span class="main">!</span> <span class="main">(</span><span class="skolem">nMsg</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> AssumpOcc6 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
              <span class="keyword1"><span class="command">qed</span></span>

              <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> IndexIsExec Occ1 Occ2 SmallIndex 
                AssumptionSubset<span class="main">(</span>3<span class="main">)</span> Occ4 Occ5 Occ6
                execution.firstOccurrence_def<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">trans</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">sends</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">start</span>"</span></span>
                  <span class="quoted"><span class="quoted">"<span class="skolem">fe</span> <span class="skolem">index</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ft</span> <span class="skolem">index</span>"</span></span><span class="main">]</span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
            <span class="keyword1"><span class="command">qed</span></span>

            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"execution.firstOccurrence <span class="main">(</span><span class="skolem">fe</span> <span class="skolem">index</span><span class="main">)</span> <span class="main">(</span><span class="skolem">ft</span> <span class="skolem">index</span><span class="main">)</span> 
              <span class="skolem">msgInSet</span> <span class="skolem">n1</span>"</span></span> 
              <span class="keyword1"><span class="command">using</span></span> AssumptionSubset2 AssumptionSubset<span class="main">(</span>1<span class="main">)</span>
            <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
              <span class="keyword1"><span class="command">have</span></span> Occ1'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">p</span><span class="main">.</span> isReceiverOf <span class="bound">p</span> <span class="skolem">msgInSet</span>"</span></span> 
                <span class="keyword1"><span class="command">using</span></span> AssumptionSubset2<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>                 
              <span class="keyword1"><span class="command">have</span></span> Occ3'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n1</span> <span class="main">&lt;</span> length <span class="main">(</span><span class="skolem">fe</span> <span class="skolem">index</span><span class="main">)</span>"</span></span> 
                <span class="keyword1"><span class="command">using</span></span> SmallIndex AssumptionSubset<span class="main">(</span>3<span class="main">)</span> AssumptionSubset<span class="main">(</span>1<span class="main">)</span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> le_less_trans<span class="main">)</span>
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">fe</span> <span class="skolem">index</span><span class="main">)</span> <span class="main">!</span> <span class="skolem">n1</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">fe</span> <span class="main">(</span>Suc <span class="skolem">index</span><span class="main">)</span><span class="main">)</span> <span class="main">!</span> <span class="skolem">n1</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> Occ3' PrefixSameOnLow<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">fe</span> <span class="skolem">index</span>"</span></span> 
                  <span class="quoted"><span class="quoted">"<span class="skolem">fe</span> <span class="main">(</span>Suc <span class="skolem">index</span><span class="main">)</span>"</span></span><span class="main">]</span> BasicProperties <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
              <span class="keyword1"><span class="command">hence</span></span> Occ4'<span class="main">:</span> <span class="quoted"><span class="quoted">"enabled <span class="main">(</span><span class="skolem">fe</span> <span class="skolem">index</span> <span class="main">!</span> <span class="skolem">n1</span><span class="main">)</span> <span class="skolem">msgInSet</span>"</span></span> 
                <span class="keyword1"><span class="command">using</span></span> AssumptionSubset2<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
              <span class="keyword1"><span class="command">have</span></span> OccSameMsg'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound"><span class="bound">n'</span></span> <span class="main">≥</span> <span class="skolem">n1</span> <span class="main">.</span> <span class="bound">n'</span> <span class="main">&lt;</span> length <span class="main">(</span><span class="skolem">ft</span> <span class="skolem">index</span><span class="main">)</span> 
                <span class="main">⟶</span> <span class="main">(</span><span class="skolem">ft</span> <span class="skolem">index</span><span class="main">)</span> <span class="main">!</span> <span class="bound">n'</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">ft</span> <span class="main">(</span>Suc <span class="skolem">index</span><span class="main">)</span><span class="main">)</span> <span class="main">!</span> <span class="bound">n'</span>"</span></span> 
                <span class="keyword1"><span class="command">using</span></span> PrefixSameOnLow BasicProperties <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">hence</span></span> Occ5'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">n'</span></span> <span class="main">≥</span> <span class="skolem">n1</span><span class="main">.</span> <span class="bound">n'</span> <span class="main">&lt;</span> length <span class="main">(</span><span class="skolem">ft</span> <span class="skolem">index</span><span class="main">)</span> 
                <span class="main">⟶</span> <span class="skolem">msgInSet</span> <span class="main">≠</span> <span class="skolem">ft</span> <span class="skolem">index</span> <span class="main">!</span> <span class="bound">n'</span>"</span></span> 
                <span class="keyword1"><span class="command">using</span></span> AssumptionSubset2<span class="main">(</span>5<span class="main">)</span> ShorterTrace <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="skolem">fe</span> <span class="skolem">index</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> NotEmpty<span class="main">(</span>2<span class="main">)</span> 
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> length_greater_0_conv<span class="main">)</span>
              <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="skolem">fe</span> <span class="skolem">index</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span> <span class="main">&lt;</span> length <span class="main">(</span><span class="skolem">fe</span> <span class="skolem">index</span><span class="main">)</span>"</span></span> 
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> One_nat_def diff_Suc_less<span class="main">)</span>                  
              <span class="keyword1"><span class="command">hence</span></span> 
                <span class="quoted"><span class="quoted">"enabled <span class="main">(</span><span class="skolem">fe</span> <span class="skolem">index</span> <span class="main">!</span> <span class="main">(</span>length <span class="main">(</span><span class="skolem">fe</span> <span class="skolem">index</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="skolem">msgInSet</span>
                <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">n0'</span></span><span class="main">≥</span><span class="skolem">n1</span><span class="main">.</span> <span class="bound">n0'</span> <span class="main">&lt;</span> length <span class="main">(</span><span class="skolem">ft</span> <span class="skolem">index</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">ft</span> <span class="skolem">index</span> <span class="main">!</span> <span class="bound">n0'</span>
                  <span class="main">=</span> <span class="skolem">msgInSet</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> Occ4' Occ3' MessageStaysOrConsumed<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">n1</span>"</span></span> 
                  <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="skolem">fe</span> <span class="skolem">index</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">index</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">msgInSet</span>"</span></span><span class="main">]</span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc_pred' <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> length <span class="main">(</span><span class="skolem">fe</span> <span class="skolem">index</span><span class="main">)</span>›</span></span> 
                  not_le not_less_eq_eq<span class="main">)</span>
              <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"enabled <span class="main">(</span><span class="main">(</span><span class="skolem">fe</span> <span class="skolem">index</span><span class="main">)</span> <span class="main">!</span> <span class="main">(</span>length <span class="main">(</span><span class="skolem">fe</span> <span class="skolem">index</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> 
                <span class="skolem">msgInSet</span>"</span></span> 
                <span class="keyword1"><span class="command">using</span></span> Occ5' <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">hence</span></span> Occ2'<span class="main">:</span> <span class="quoted"><span class="quoted">"enabled <span class="main">(</span>last <span class="main">(</span><span class="skolem">fe</span> <span class="skolem">index</span><span class="main">)</span><span class="main">)</span> <span class="skolem">msgInSet</span>"</span></span> 
                <span class="keyword1"><span class="command">using</span></span> last_conv_nth<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">fe</span> <span class="skolem">index</span>"</span></span><span class="main">]</span> NotEmpty<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

              <span class="keyword1"><span class="command">have</span></span> Occ6'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n1</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟶</span> <span class="main">¬</span> enabled <span class="main">(</span><span class="skolem">fe</span> <span class="skolem">index</span> <span class="main">!</span> <span class="main">(</span><span class="skolem">n1</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> 
                <span class="skolem">msgInSet</span> <span class="main">∨</span> <span class="skolem">msgInSet</span> <span class="main">=</span> <span class="skolem">ft</span> <span class="skolem">index</span> <span class="main">!</span> <span class="main">(</span><span class="skolem">n1</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
                <span class="keyword3"><span class="command">assume</span></span> AssumpOcc6'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">n1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">msgInSet</span> <span class="main">≠</span> <span class="skolem">ft</span> <span class="skolem">index</span> <span class="main">!</span> 
                  <span class="main">(</span><span class="skolem">n1</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"enabled <span class="main">(</span><span class="skolem">fe</span> <span class="skolem">index</span> <span class="main">!</span> <span class="main">(</span><span class="skolem">n1</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="skolem">msgInSet</span>"</span></span>
                <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n1</span> <span class="main">-</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="main">&lt;</span> length <span class="main">(</span><span class="skolem">fe</span> <span class="skolem">index</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span>"</span></span> 
                  <span class="keyword1"><span class="command">using</span></span> Occ3' AssumpOcc6'<span class="main">(</span>1<span class="main">)</span> 
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc_le_eq diff_less_mono<span class="main">)</span>
                <span class="keyword1"><span class="command">hence</span></span> SmallIndexTrace'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n1</span> <span class="main">-</span> <span class="main">1</span> <span class="main">&lt;</span> length <span class="main">(</span><span class="skolem">ft</span> <span class="skolem">index</span><span class="main">)</span>"</span></span> 
                  <span class="keyword1"><span class="command">using</span></span> IndexIsExec execution.length 
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> One_nat_def<span class="main">)</span>
                <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> enabled <span class="main">(</span><span class="skolem">fe</span> <span class="main">(</span>Suc <span class="skolem">index</span><span class="main">)</span> <span class="main">!</span> <span class="main">(</span><span class="skolem">n1</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="skolem">msgInSet</span> 
                  <span class="main">∨</span> <span class="skolem">msgInSet</span> <span class="main">=</span> <span class="skolem">ft</span> <span class="main">(</span>Suc <span class="skolem">index</span><span class="main">)</span> <span class="main">!</span> <span class="main">(</span><span class="skolem">n1</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> AssumptionSubset2<span class="main">(</span>6<span class="main">)</span> AssumpOcc6'<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
                <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">fe</span> <span class="main">(</span>Suc <span class="skolem">index</span><span class="main">)</span> <span class="main">!</span> <span class="main">(</span><span class="skolem">n1</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> 
                  <span class="main">=</span> <span class="skolem">fe</span> <span class="skolem">index</span> <span class="main">!</span> <span class="main">(</span><span class="skolem">n1</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> SameCfgOnLow Occ3' <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> less_imp_diff_less<span class="main">)</span>
                <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ft</span> <span class="main">(</span>Suc <span class="skolem">index</span><span class="main">)</span> <span class="main">!</span> <span class="main">(</span><span class="skolem">n1</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> 
                  <span class="main">=</span> <span class="skolem">ft</span> <span class="skolem">index</span> <span class="main">!</span> <span class="main">(</span><span class="skolem">n1</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> SameMsgOnLow SmallIndexTrace' <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span> 
                <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> enabled <span class="main">(</span><span class="skolem">fe</span> <span class="skolem">index</span> <span class="main">!</span> 
                  <span class="main">(</span><span class="skolem">n1</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="skolem">msgInSet</span> <span class="main">∨</span> <span class="skolem">msgInSet</span> <span class="main">=</span> <span class="skolem">ft</span> <span class="skolem">index</span> <span class="main">!</span> <span class="main">(</span><span class="skolem">n1</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> AssumpOcc6' <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
              <span class="keyword1"><span class="command">qed</span></span>

              <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> IndexIsExec Occ1' Occ2' Occ3' Occ4' 
                Occ5' Occ6'
                execution.firstOccurrence_def<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">trans</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">sends</span>"</span></span> 
                  <span class="quoted"><span class="quoted">"<span class="free">start</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">fe</span> <span class="skolem">index</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ft</span> <span class="skolem">index</span>"</span></span><span class="main">]</span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>  
            <span class="keyword1"><span class="command">qed</span></span>
            
            <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">nMsg'</span> <span class="bound">n1'</span><span class="main">.</span> <span class="bound">n1'</span> <span class="main">≤</span> <span class="bound">nMsg'</span> 
              <span class="main">∧</span> execution.firstOccurrence <span class="main">(</span><span class="skolem">fe</span> <span class="skolem">index</span><span class="main">)</span> <span class="main">(</span><span class="skolem">ft</span> <span class="skolem">index</span><span class="main">)</span> 
                <span class="skolem">msgInSet</span> <span class="bound">n1'</span> 
              <span class="main">∧</span> execution.firstOccurrence <span class="main">(</span><span class="skolem">fe</span> <span class="skolem">index</span><span class="main">)</span> <span class="main">(</span><span class="skolem">ft</span> <span class="skolem">index</span><span class="main">)</span> 
                <span class="skolem">msg</span> <span class="bound">nMsg'</span>"</span></span> 
              <span class="keyword1"><span class="command">using</span></span> FirstOccurrenceMsg AssumptionSubset<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">qed</span></span>

          <span class="keyword1"><span class="command">have</span></span> ProperSubset<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">msg'</span> <span class="main">.</span><span class="bound">msg'</span> <span class="main">∈</span> <span class="skolem">firstOccSet</span> <span class="skolem">index</span> 
            <span class="main">∧</span> <span class="bound">msg'</span> <span class="main">∉</span> <span class="skolem">firstOccSet</span> <span class="main">(</span>Suc <span class="skolem">index</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>               
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"initial <span class="main">(</span>hd <span class="main">(</span><span class="skolem">fe</span> <span class="skolem">index</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> AssumptionFair<span class="main">(</span>1<span class="main">)</span> 
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">msg'</span><span class="main">.</span> execution.minimalEnabled <span class="main">(</span><span class="skolem">fe</span> <span class="skolem">index</span><span class="main">)</span> <span class="main">(</span><span class="skolem">ft</span> <span class="skolem">index</span><span class="main">)</span>
              <span class="bound">msg'</span> <span class="main">∧</span>  <span class="bound">msg'</span> <span class="main">∈</span> set <span class="main">(</span>drop <span class="main">(</span>length <span class="main">(</span><span class="skolem">ft</span> <span class="skolem">index</span><span class="main">)</span><span class="main">)</span> 
                <span class="main">(</span><span class="skolem">fStepMsg</span> <span class="main">(</span><span class="skolem">fe</span> <span class="skolem">index</span><span class="main">)</span> <span class="main">(</span><span class="skolem">ft</span> <span class="skolem">index</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
              <span class="keyword1"><span class="command">using</span></span> FStep fe_def ft_def
                BasicProperties <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">consumedMsg</span></span> <span class="keyword2"><span class="keyword">where</span></span> ConsumedMsg<span class="main">:</span> 
              <span class="quoted"><span class="quoted">"execution.minimalEnabled <span class="main">(</span><span class="skolem">fe</span> <span class="skolem">index</span><span class="main">)</span> <span class="main">(</span><span class="skolem">ft</span> <span class="skolem">index</span><span class="main">)</span> 
                <span class="skolem">consumedMsg</span>"</span></span>
              <span class="quoted"><span class="quoted">"<span class="skolem">consumedMsg</span> <span class="main">∈</span> set <span class="main">(</span>drop <span class="main">(</span>length <span class="main">(</span><span class="skolem">ft</span> <span class="skolem">index</span><span class="main">)</span><span class="main">)</span> 
                <span class="main">(</span><span class="skolem">fStepMsg</span> <span class="main">(</span><span class="skolem">fe</span> <span class="skolem">index</span><span class="main">)</span> <span class="main">(</span><span class="skolem">ft</span> <span class="skolem">index</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command">hence</span></span> ConsumedIsInDrop<span class="main">:</span>
              <span class="quoted"><span class="quoted">"<span class="skolem">consumedMsg</span> <span class="main">∈</span> set <span class="main">(</span>drop <span class="main">(</span>length <span class="main">(</span><span class="skolem">ft</span> <span class="skolem">index</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">ft</span> <span class="main">(</span>Suc <span class="skolem">index</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> fe_def ft_def FStep
                BasicProperties<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">index</span></span><span class="main">]</span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            
            <span class="keyword1"><span class="command">have</span></span> MinImplAllBigger<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">msg'</span> <span class="main">.</span> execution.minimalEnabled
            <span class="main">(</span><span class="skolem">fe</span> <span class="skolem">index</span><span class="main">)</span> <span class="main">(</span><span class="skolem">ft</span> <span class="skolem">index</span><span class="main">)</span> <span class="bound">msg'</span> 
             <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">OccM'</span> <span class="main">.</span> <span class="main">(</span>execution.firstOccurrence <span class="main">(</span><span class="skolem">fe</span> <span class="skolem">index</span><span class="main">)</span> 
              <span class="main">(</span><span class="skolem">ft</span> <span class="skolem">index</span><span class="main">)</span> <span class="bound">msg'</span> <span class="bound">OccM'</span> <span class="main">)</span>
                <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">msg</span> <span class="main">.</span> <span class="main">∀</span> <span class="bound">OccM</span> <span class="main">.</span> execution.firstOccurrence <span class="main">(</span><span class="skolem">fe</span> <span class="skolem">index</span><span class="main">)</span>
                  <span class="main">(</span><span class="skolem">ft</span> <span class="skolem">index</span><span class="main">)</span> <span class="bound">msg</span> <span class="bound">OccM</span> 
                <span class="main">⟶</span> <span class="bound">OccM'</span> <span class="main">≤</span> <span class="bound">OccM</span><span class="main">)</span><span class="main">)</span>"</span></span> 
            <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
              <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">msg'</span>
              <span class="keyword3"><span class="command">assume</span></span> AssumpMinImplAllBigger<span class="main">:</span> <span class="quoted"><span class="quoted">"execution.minimalEnabled 
                <span class="main">(</span><span class="skolem">fe</span> <span class="skolem">index</span><span class="main">)</span> <span class="main">(</span><span class="skolem">ft</span> <span class="skolem">index</span><span class="main">)</span> <span class="skolem">msg'</span>"</span></span>
              <span class="keyword1"><span class="command">have</span></span> IsExecIndex<span class="main">:</span> <span class="quoted"><span class="quoted">"execution <span class="free">trans</span> <span class="free">sends</span> <span class="free">start</span> 
                <span class="main">(</span><span class="skolem">fe</span> <span class="skolem">index</span><span class="main">)</span> <span class="main">(</span><span class="skolem">ft</span> <span class="skolem">index</span><span class="main">)</span>"</span></span> 
                <span class="keyword1"><span class="command">using</span></span>  BasicProperties<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">index</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span> <span class="bound">p</span> <span class="main">.</span> isReceiverOf <span class="bound">p</span> <span class="skolem">msg'</span><span class="main">)</span> <span class="main">∧</span> 
                <span class="main">(</span>enabled <span class="main">(</span>last <span class="main">(</span><span class="skolem">fe</span> <span class="skolem">index</span><span class="main">)</span><span class="main">)</span> <span class="skolem">msg'</span><span class="main">)</span>
                <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">n</span> <span class="main">.</span>  <span class="bound">n</span> <span class="main">&lt;</span> length <span class="main">(</span><span class="skolem">fe</span> <span class="skolem">index</span><span class="main">)</span> 
                  <span class="main">∧</span> enabled <span class="main">(</span> <span class="main">(</span><span class="skolem">fe</span> <span class="skolem">index</span><span class="main">)</span> <span class="main">!</span> <span class="bound">n</span><span class="main">)</span> <span class="skolem">msg'</span> 
                  <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span> <span class="bound"><span class="bound">n'</span></span> <span class="main">≥</span> <span class="bound">n</span> <span class="main">.</span> <span class="bound">n'</span> <span class="main">&lt;</span> length <span class="main">(</span><span class="skolem">ft</span> <span class="skolem">index</span><span class="main">)</span> 
                  <span class="main">⟶</span> <span class="skolem">msg'</span> <span class="main">≠</span> <span class="main">(</span><span class="main">(</span><span class="skolem">ft</span> <span class="skolem">index</span><span class="main">)</span><span class="main">!</span> <span class="bound">n'</span><span class="main">)</span><span class="main">)</span>
                  <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">n'</span> <span class="bound">msg'</span> <span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="main">∃</span> <span class="bound">p</span> <span class="main">.</span> isReceiverOf <span class="bound">p</span> <span class="bound">msg'</span><span class="main">)</span> 
                    <span class="main">∧</span> <span class="main">(</span>enabled <span class="main">(</span>last <span class="main">(</span><span class="skolem">fe</span> <span class="skolem">index</span><span class="main">)</span><span class="main">)</span> <span class="bound">msg'</span><span class="main">)</span> 
                    <span class="main">∧</span> <span class="bound">n'</span> <span class="main">&lt;</span> length <span class="main">(</span><span class="skolem">ft</span> <span class="skolem">index</span><span class="main">)</span> 
                    <span class="main">∧</span> enabled <span class="main">(</span><span class="main">(</span><span class="skolem">fe</span> <span class="skolem">index</span><span class="main">)</span><span class="main">!</span> <span class="bound">n'</span><span class="main">)</span> <span class="bound">msg'</span> 
                    <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span> <span class="bound"><span class="bound">n''</span></span> <span class="main">≥</span> <span class="bound">n'</span> <span class="main">.</span> <span class="bound">n''</span> <span class="main">&lt;</span> length <span class="main">(</span><span class="skolem">ft</span> <span class="skolem">index</span><span class="main">)</span> 
                    <span class="main">⟶</span> <span class="bound">msg'</span> <span class="main">≠</span> <span class="main">(</span><span class="main">(</span><span class="skolem">ft</span> <span class="skolem">index</span><span class="main">)</span> <span class="main">!</span> <span class="bound">n''</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> <span class="bound">n'</span> <span class="main">≥</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span> 
              <span class="keyword1"><span class="command">using</span></span> execution.minimalEnabled_def<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">trans</span></span> <span class="quoted"><span class="free">sends</span></span> <span class="quoted"><span class="free">start</span></span> 
                <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">fe</span> <span class="skolem">index</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">ft</span> <span class="skolem">index</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="skolem">msg'</span></span><span class="main">]</span> 
                AssumpMinImplAllBigger IsExecIndex <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">OccM'</span></span> <span class="keyword2"><span class="keyword">where</span></span> OccM'<span class="main">:</span> 
                <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span> <span class="bound">p</span> <span class="main">.</span> isReceiverOf <span class="bound">p</span> <span class="skolem">msg'</span><span class="main">)</span>"</span></span> 
                <span class="quoted"><span class="quoted">"<span class="main">(</span>enabled <span class="main">(</span>last <span class="main">(</span><span class="skolem">fe</span> <span class="skolem">index</span><span class="main">)</span><span class="main">)</span> <span class="skolem">msg'</span><span class="main">)</span>"</span></span>
                <span class="quoted"><span class="quoted">"<span class="skolem">OccM'</span> <span class="main">&lt;</span> length <span class="main">(</span><span class="skolem">fe</span> <span class="skolem">index</span><span class="main">)</span>"</span></span> 
                <span class="quoted"><span class="quoted">"enabled <span class="main">(</span> <span class="main">(</span><span class="skolem">fe</span> <span class="skolem">index</span><span class="main">)</span> <span class="main">!</span> <span class="skolem">OccM'</span><span class="main">)</span> <span class="skolem">msg'</span>"</span></span>  
                <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span> <span class="bound"><span class="bound">n'</span></span> <span class="main">≥</span> <span class="skolem">OccM'</span> <span class="main">.</span> <span class="bound">n'</span> <span class="main">&lt;</span> length <span class="main">(</span><span class="skolem">ft</span> <span class="skolem">index</span><span class="main">)</span> 
                <span class="main">⟶</span> <span class="skolem">msg'</span> <span class="main">≠</span> <span class="main">(</span><span class="main">(</span><span class="skolem">ft</span> <span class="skolem">index</span><span class="main">)</span><span class="main">!</span> <span class="bound">n'</span><span class="main">)</span><span class="main">)</span>"</span></span>
                <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span> <span class="bound">n'</span> <span class="bound">msg'</span> <span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="main">∃</span> <span class="bound">p</span> <span class="main">.</span> isReceiverOf <span class="bound">p</span> <span class="bound">msg'</span><span class="main">)</span> 
                  <span class="main">∧</span> <span class="main">(</span>enabled <span class="main">(</span>last <span class="main">(</span><span class="skolem">fe</span> <span class="skolem">index</span><span class="main">)</span><span class="main">)</span> <span class="bound">msg'</span><span class="main">)</span> 
                  <span class="main">∧</span> <span class="bound">n'</span> <span class="main">&lt;</span> length <span class="main">(</span><span class="skolem">ft</span> <span class="skolem">index</span><span class="main">)</span> 
                  <span class="main">∧</span> enabled <span class="main">(</span><span class="main">(</span><span class="skolem">fe</span> <span class="skolem">index</span><span class="main">)</span><span class="main">!</span> <span class="bound">n'</span><span class="main">)</span> <span class="bound">msg'</span> 
                  <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span> <span class="bound"><span class="bound">n''</span></span> <span class="main">≥</span> <span class="bound">n'</span> <span class="main">.</span> <span class="bound">n''</span> <span class="main">&lt;</span> length <span class="main">(</span><span class="skolem">ft</span> <span class="skolem">index</span><span class="main">)</span> 
                  <span class="main">⟶</span> <span class="bound">msg'</span> <span class="main">≠</span> <span class="main">(</span><span class="main">(</span><span class="skolem">ft</span> <span class="skolem">index</span><span class="main">)</span> <span class="main">!</span> <span class="bound">n''</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> <span class="bound">n'</span> <span class="main">≥</span> <span class="skolem">OccM'</span><span class="main">)</span>"</span></span> 
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>                  
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">OccM'</span> <span class="main">⟹</span> enabled <span class="main">(</span><span class="skolem">fe</span> <span class="skolem">index</span> <span class="main">!</span> <span class="main">(</span><span class="skolem">OccM'</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="skolem">msg'</span> 
                      <span class="main">⟹</span> <span class="skolem">msg'</span> <span class="main">≠</span> <span class="skolem">ft</span> <span class="skolem">index</span> <span class="main">!</span> <span class="main">(</span><span class="skolem">OccM'</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="main">⟹</span> False"</span></span>
              <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">-</span><span class="main">)</span>
                <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span>
                <span class="keyword3"><span class="command">assume</span></span> AssumpContr<span class="main">:</span> 
                  <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">OccM'</span>"</span></span>
                  <span class="quoted"><span class="quoted">"enabled <span class="main">(</span><span class="skolem">fe</span> <span class="skolem">index</span> <span class="main">!</span> <span class="main">(</span><span class="skolem">OccM'</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="skolem">msg'</span>"</span></span>
                  <span class="quoted"><span class="quoted">"<span class="skolem">msg'</span> <span class="main">≠</span> <span class="skolem">ft</span> <span class="skolem">index</span> <span class="main">!</span> <span class="main">(</span><span class="skolem">OccM'</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">have</span></span> LengthOccM'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">OccM'</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">&lt;</span> length <span class="main">(</span><span class="skolem">ft</span> <span class="skolem">index</span><span class="main">)</span>"</span></span> 
                <span class="keyword1"><span class="command">using</span></span> OccM'<span class="main">(</span>3<span class="main">)</span> IndexIsExec AssumpContr<span class="main">(</span>1<span class="main">)</span>   
                  AssumptionFair<span class="main">(</span>1<span class="main">)</span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span>  One_nat_def Suc_diff_1 Suc_eq_plus1_left 
                    Suc_less_eq le_add_diff_inverse<span class="main">)</span>
                <span class="keyword1"><span class="command">have</span></span> BiggerIndices<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">n''</span></span><span class="main">≥</span><span class="main">(</span><span class="skolem">OccM'</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">.</span> 
                  <span class="bound">n''</span> <span class="main">&lt;</span> length <span class="main">(</span><span class="skolem">ft</span> <span class="skolem">index</span><span class="main">)</span> <span class="main">⟶</span> <span class="skolem">msg'</span> <span class="main">≠</span> <span class="skolem">ft</span> <span class="skolem">index</span> <span class="main">!</span> <span class="bound">n''</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> OccM'<span class="main">(</span>5<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> AssumpContr<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> One_nat_def 
                      Suc_eq_plus1 diff_Suc_1 le_SucE le_diff_conv<span class="main">)</span>
                <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">p</span><span class="main">.</span> isReceiverOf <span class="bound">p</span> <span class="skolem">msg'</span><span class="main">)</span> <span class="main">∧</span> enabled <span class="main">(</span>last 
                  <span class="main">(</span><span class="skolem">fe</span> <span class="skolem">index</span><span class="main">)</span><span class="main">)</span> <span class="skolem">msg'</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">OccM'</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">&lt;</span> length <span class="main">(</span><span class="skolem">ft</span> <span class="skolem">index</span><span class="main">)</span>
                    <span class="main">∧</span> enabled <span class="main">(</span><span class="skolem">fe</span> <span class="skolem">index</span> <span class="main">!</span> <span class="main">(</span><span class="skolem">OccM'</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="skolem">msg'</span> 
                    <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">n''</span></span><span class="main">≥</span><span class="main">(</span><span class="skolem">OccM'</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">.</span> <span class="bound">n''</span> <span class="main">&lt;</span> length <span class="main">(</span><span class="skolem">ft</span> <span class="skolem">index</span><span class="main">)</span> 
                      <span class="main">⟶</span> <span class="skolem">msg'</span> <span class="main">≠</span> <span class="skolem">ft</span> <span class="skolem">index</span> <span class="main">!</span> <span class="bound">n''</span><span class="main">)</span>"</span></span> 
                  <span class="keyword1"><span class="command">using</span></span> OccM' LengthOccM' AssumpContr BiggerIndices 
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">OccM'</span> <span class="main">≤</span> <span class="skolem">OccM'</span> <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> OccM'<span class="main">(</span>6<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
                <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> AssumpContr<span class="main">(</span>1<span class="main">)</span> diff_less leD zero_less_one <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
              <span class="keyword1"><span class="command">qed</span></span>
              <span class="keyword1"><span class="command">hence</span></span> FirstOccMsg'<span class="main">:</span> <span class="quoted"><span class="quoted">"execution.firstOccurrence <span class="main">(</span><span class="skolem">fe</span> <span class="skolem">index</span><span class="main">)</span>
                  <span class="main">(</span><span class="skolem">ft</span> <span class="skolem">index</span><span class="main">)</span> <span class="skolem">msg'</span> <span class="skolem">OccM'</span>"</span></span>   
                <span class="keyword1"><span class="command">unfolding</span></span> execution_def
                  execution.firstOccurrence_def<span class="main">[</span><span class="operator">OF</span> IsExecIndex<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">msg'</span></span> <span class="quoted"><span class="skolem">OccM'</span></span><span class="main">]</span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> OccM'<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>2<span class="main"><span class="main">,</span></span>3<span class="main"><span class="main">,</span></span>4<span class="main"><span class="main">,</span></span>5<span class="main"><span class="main">)</span></span><span class="main">)</span>
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">msg</span> <span class="bound">OccM</span><span class="main">.</span> execution.firstOccurrence <span class="main">(</span><span class="skolem">fe</span> <span class="skolem">index</span><span class="main">)</span> 
                <span class="main">(</span><span class="skolem">ft</span> <span class="skolem">index</span><span class="main">)</span> <span class="bound">msg</span> <span class="bound">OccM</span> <span class="main">⟶</span> <span class="skolem">OccM'</span> <span class="main">≤</span> <span class="bound">OccM</span>"</span></span> 
              <span class="keyword1"><span class="command">proof</span></span> <span class="operator">clarify</span>
                <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">msg</span> <span class="skolem">OccM</span>
                <span class="keyword3"><span class="command">assume</span></span>  <span class="quoted"><span class="quoted">"execution.firstOccurrence <span class="main">(</span><span class="skolem">fe</span> <span class="skolem">index</span><span class="main">)</span> 
                  <span class="main">(</span><span class="skolem">ft</span> <span class="skolem">index</span><span class="main">)</span> <span class="skolem">msg</span> <span class="skolem">OccM</span>"</span></span>
                <span class="keyword1"><span class="command">hence</span></span> AssumpOccMFirstOccurrence<span class="main">:</span> 
                  <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">p</span> <span class="main">.</span> isReceiverOf <span class="bound">p</span> <span class="skolem">msg</span>"</span></span> 
                  <span class="quoted"><span class="quoted">"enabled <span class="main">(</span>last <span class="main">(</span><span class="skolem">fe</span> <span class="skolem">index</span><span class="main">)</span><span class="main">)</span> <span class="skolem">msg</span>"</span></span> 
                  <span class="quoted"><span class="quoted">"<span class="skolem">OccM</span> <span class="main">&lt;</span> <span class="main">(</span>length <span class="main">(</span><span class="skolem">fe</span> <span class="skolem">index</span><span class="main">)</span><span class="main">)</span>"</span></span>
                  <span class="quoted"><span class="quoted">"enabled <span class="main">(</span><span class="main">(</span><span class="skolem">fe</span> <span class="skolem">index</span><span class="main">)</span> <span class="main">!</span> <span class="skolem">OccM</span><span class="main">)</span> <span class="skolem">msg</span>"</span></span> 
                  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span> <span class="bound"><span class="bound">n'</span></span> <span class="main">≥</span> <span class="skolem">OccM</span> <span class="main">.</span> <span class="bound">n'</span> <span class="main">&lt;</span> length <span class="main">(</span><span class="skolem">ft</span> <span class="skolem">index</span><span class="main">)</span> 
                  <span class="main">⟶</span> <span class="skolem">msg</span> <span class="main">≠</span> <span class="main">(</span><span class="main">(</span><span class="skolem">ft</span> <span class="skolem">index</span><span class="main">)</span> <span class="main">!</span> <span class="bound">n'</span><span class="main">)</span><span class="main">)</span>"</span></span>
                  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">OccM</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">¬</span> enabled <span class="main">(</span><span class="main">(</span><span class="skolem">fe</span> <span class="skolem">index</span><span class="main">)</span> <span class="main">!</span> <span class="main">(</span><span class="skolem">OccM</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> 
                  <span class="skolem">msg</span> <span class="main">∨</span> <span class="skolem">msg</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">ft</span> <span class="skolem">index</span><span class="main">)</span><span class="main">!</span><span class="main">(</span><span class="skolem">OccM</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> execution.firstOccurrence_def<span class="main"><span class="main">[</span></span><span class="operator">of</span> 
                      <span class="quoted"><span class="free">trans</span></span> <span class="quoted"><span class="free">sends</span></span> <span class="quoted"><span class="free">start</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">fe</span> <span class="skolem">index</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">ft</span> <span class="skolem">index</span><span class="main">)</span>"</span></span> 
                      <span class="quoted"><span class="skolem">msg</span></span> <span class="quoted"><span class="skolem">OccM</span></span><span class="main"><span class="main">]</span></span> IsExecIndex<span class="main">)</span>
                <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">p</span><span class="main">.</span> isReceiverOf <span class="bound">p</span> <span class="skolem">msg</span><span class="main">)</span> <span class="main">∧</span>
                  enabled <span class="main">(</span>last <span class="main">(</span><span class="skolem">fe</span> <span class="skolem">index</span><span class="main">)</span><span class="main">)</span> <span class="skolem">msg</span> <span class="main">∧</span>
                  enabled <span class="main">(</span><span class="skolem">fe</span> <span class="skolem">index</span> <span class="main">!</span> <span class="skolem">OccM</span><span class="main">)</span> <span class="skolem">msg</span> <span class="main">∧</span> 
                  <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">n''</span></span><span class="main">≥</span> <span class="skolem">OccM</span><span class="main">.</span> <span class="bound">n''</span> <span class="main">&lt;</span> length <span class="main">(</span><span class="skolem">ft</span> <span class="skolem">index</span><span class="main">)</span> 
                    <span class="main">⟶</span> <span class="skolem">msg</span> <span class="main">≠</span> <span class="skolem">ft</span> <span class="skolem">index</span> <span class="main">!</span> <span class="bound">n''</span><span class="main">)</span>"</span></span> 
                 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">OccM'</span> <span class="main">≤</span> <span class="skolem">OccM</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> OccM' 
                <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">OccM</span> <span class="main">&lt;</span> length <span class="main">(</span><span class="skolem">ft</span> <span class="skolem">index</span><span class="main">)</span>"</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span><span class="main">)</span>
                  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">OccM</span> <span class="main">&lt;</span> length <span class="main">(</span><span class="skolem">ft</span> <span class="skolem">index</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">OccM</span> <span class="main">≥</span> length <span class="main">(</span><span class="skolem">fe</span> <span class="skolem">index</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span>"</span></span> 
                    <span class="keyword1"><span class="command">using</span></span> AssumptionFair<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> One_nat_def leI<span class="main">)</span>
                  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">OccM</span> <span class="main">=</span> length <span class="main">(</span><span class="skolem">fe</span> <span class="skolem">index</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
                    <span class="keyword1"><span class="command">using</span></span> AssumpOccMFirstOccurrence<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">OccM'</span> <span class="main">≤</span> <span class="skolem">OccM</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> OccM'<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                <span class="keyword1"><span class="command">qed</span></span>
              <span class="keyword1"><span class="command">qed</span></span>
              <span class="keyword1"><span class="command">with</span></span> FirstOccMsg' <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">OccM'</span><span class="main">.</span> 
                execution.firstOccurrence <span class="main">(</span><span class="skolem">fe</span> <span class="skolem">index</span><span class="main">)</span> <span class="main">(</span><span class="skolem">ft</span> <span class="skolem">index</span><span class="main">)</span> 
                  <span class="skolem">msg'</span> <span class="bound">OccM'</span> 
                <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">msg</span> <span class="bound">OccM</span><span class="main">.</span> execution.firstOccurrence <span class="main">(</span><span class="skolem">fe</span> <span class="skolem">index</span><span class="main">)</span> 
                  <span class="main">(</span><span class="skolem">ft</span> <span class="skolem">index</span><span class="main">)</span> <span class="bound">msg</span> <span class="bound">OccM</span> <span class="main">⟶</span> <span class="bound">OccM'</span> <span class="main">≤</span> <span class="bound">OccM</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command">qed</span></span>

            <span class="keyword1"><span class="command">have</span></span> MinImplFirstOcc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">msg'</span> <span class="main">.</span> execution.minimalEnabled 
              <span class="main">(</span><span class="skolem">fe</span> <span class="skolem">index</span><span class="main">)</span> <span class="main">(</span><span class="skolem">ft</span> <span class="skolem">index</span><span class="main">)</span> <span class="bound">msg'</span> 
              <span class="main">⟹</span> <span class="bound">msg'</span> <span class="main">∈</span> <span class="skolem">firstOccSet</span> <span class="skolem">index</span>"</span></span>
            <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
              <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">msg'</span>
              <span class="keyword3"><span class="command">assume</span></span> AssumpMinImplFirstOcc<span class="main">:</span> 
                <span class="quoted"><span class="quoted">"execution.minimalEnabled <span class="main">(</span><span class="skolem">fe</span> <span class="skolem">index</span><span class="main">)</span> <span class="main">(</span><span class="skolem">ft</span> <span class="skolem">index</span><span class="main">)</span> <span class="skolem">msg'</span>"</span></span>
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">OccM'</span></span> <span class="keyword2"><span class="keyword">where</span></span> OccM'<span class="main">:</span> 
                <span class="quoted"><span class="quoted">"execution.firstOccurrence <span class="main">(</span><span class="skolem">fe</span> <span class="skolem">index</span><span class="main">)</span> <span class="main">(</span><span class="skolem">ft</span> <span class="skolem">index</span><span class="main">)</span> 
                  <span class="skolem">msg'</span> <span class="skolem">OccM'</span>"</span></span>
                <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">msg</span> <span class="main">.</span> <span class="main">∀</span> <span class="bound">OccM</span> <span class="main">.</span> execution.firstOccurrence 
                <span class="main">(</span><span class="skolem">fe</span> <span class="skolem">index</span><span class="main">)</span> <span class="main">(</span><span class="skolem">ft</span> <span class="skolem">index</span><span class="main">)</span> <span class="bound">msg</span> <span class="bound">OccM</span> 
              <span class="main">⟶</span> <span class="skolem">OccM'</span> <span class="main">≤</span> <span class="bound">OccM</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> MinImplAllBigger <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
              <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">msg'</span> <span class="main">∈</span> <span class="skolem">firstOccSet</span> <span class="skolem">index</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> OccM' 
              <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> firstOccSet_def<span class="main">)</span>
                <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"enabled <span class="main">(</span>last <span class="main">(</span><span class="skolem">fe</span> <span class="skolem">index</span><span class="main">)</span><span class="main">)</span> <span class="skolem">msg</span>"</span></span> 
                  <span class="keyword1"><span class="command">using</span></span> AssumptionFirstOccSetDecrOrConsumed<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
                <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">nMsg</span> <span class="main">.</span>  execution.firstOccurrence <span class="main">(</span><span class="skolem">fe</span> <span class="skolem">index</span><span class="main">)</span> 
                  <span class="main">(</span><span class="skolem">ft</span> <span class="skolem">index</span><span class="main">)</span> <span class="skolem">msg</span> <span class="bound">nMsg</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> execution.FirstOccurrenceExists IndexIsExec 
                  AssumptionFair<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
                <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">nMsg</span></span> <span class="keyword2"><span class="keyword">where</span></span> NMsg<span class="main">:</span> <span class="quoted"><span class="quoted">"execution.firstOccurrence
                  <span class="main">(</span><span class="skolem">fe</span> <span class="skolem">index</span><span class="main">)</span> <span class="main">(</span><span class="skolem">ft</span> <span class="skolem">index</span><span class="main">)</span> <span class="skolem">msg</span> <span class="skolem">nMsg</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
                <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">OccM'</span> <span class="main">≤</span> <span class="skolem">nMsg</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> OccM' <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">nMsg</span> <span class="main">.</span> <span class="skolem">OccM'</span> <span class="main">≤</span> <span class="bound">nMsg</span> <span class="main">∧</span>
                  execution.firstOccurrence <span class="main">(</span><span class="skolem">fe</span> <span class="skolem">index</span><span class="main">)</span> <span class="main">(</span><span class="skolem">ft</span> <span class="skolem">index</span><span class="main">)</span> <span class="skolem">msg'</span>
                    <span class="skolem">OccM'</span> <span class="main">∧</span>
                  execution.firstOccurrence <span class="main">(</span><span class="skolem">fe</span> <span class="skolem">index</span><span class="main">)</span> <span class="main">(</span><span class="skolem">ft</span> <span class="skolem">index</span><span class="main">)</span> <span class="skolem">msg</span> 
                    <span class="bound">nMsg</span>"</span></span> 
                  <span class="keyword1"><span class="command">using</span></span> OccM'<span class="main">(</span>1<span class="main">)</span> NMsg <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
                <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">nMsg</span> <span class="bound">n1</span> <span class="main">.</span> <span class="bound">n1</span> <span class="main">≤</span> <span class="bound">nMsg</span> <span class="main">∧</span>
                  execution.firstOccurrence <span class="main">(</span><span class="skolem">fe</span> <span class="skolem">index</span><span class="main">)</span> <span class="main">(</span><span class="skolem">ft</span> <span class="skolem">index</span><span class="main">)</span> 
                    <span class="skolem">msg'</span> <span class="bound">n1</span> <span class="main">∧</span>
                  execution.firstOccurrence <span class="main">(</span><span class="skolem">fe</span> <span class="skolem">index</span><span class="main">)</span> <span class="main">(</span><span class="skolem">ft</span> <span class="skolem">index</span><span class="main">)</span> 
                    <span class="skolem">msg</span> <span class="bound">nMsg</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
              <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword1"><span class="command">hence</span></span> ConsumedInSet<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">consumedMsg</span> <span class="main">∈</span> <span class="skolem">firstOccSet</span> <span class="skolem">index</span>"</span></span> 
              <span class="keyword1"><span class="command">using</span></span> ConsumedMsg <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">have</span></span> GreaterOccurrence<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">nMsg</span> <span class="bound">n1</span> <span class="main">.</span> 
                execution.firstOccurrence <span class="main">(</span><span class="skolem">fe</span> <span class="main">(</span>Suc <span class="skolem">index</span><span class="main">)</span><span class="main">)</span> 
                  <span class="main">(</span><span class="skolem">ft</span> <span class="main">(</span>Suc <span class="skolem">index</span><span class="main">)</span><span class="main">)</span> <span class="skolem">consumedMsg</span> <span class="bound">n1</span> <span class="main">∧</span> 
                execution.firstOccurrence <span class="main">(</span><span class="skolem">fe</span> <span class="main">(</span>Suc <span class="skolem">index</span><span class="main">)</span><span class="main">)</span> 
                  <span class="main">(</span><span class="skolem">ft</span> <span class="main">(</span>Suc <span class="skolem">index</span><span class="main">)</span><span class="main">)</span> <span class="skolem">msg</span> <span class="bound">nMsg</span> 
                <span class="main">⟹</span> <span class="bound">nMsg</span> <span class="main">&lt;</span> <span class="bound">n1</span>"</span></span> 
            <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span> ccontr<span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span><span class="main">)</span>
              <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">nMsg</span> <span class="skolem">n1</span>
              <span class="keyword3"><span class="command">assume</span></span> AssumpGreaterOccurrence<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">nMsg</span> <span class="main">&lt;</span> <span class="skolem">n1</span>"</span></span>
                <span class="quoted"><span class="quoted">"execution.firstOccurrence <span class="main">(</span><span class="skolem">fe</span> <span class="main">(</span>Suc <span class="skolem">index</span><span class="main">)</span><span class="main">)</span> 
                  <span class="main">(</span><span class="skolem">ft</span> <span class="main">(</span>Suc <span class="skolem">index</span><span class="main">)</span><span class="main">)</span> <span class="skolem">consumedMsg</span> <span class="skolem">n1</span>"</span></span>
                <span class="quoted"><span class="quoted">"execution.firstOccurrence <span class="main">(</span><span class="skolem">fe</span> <span class="main">(</span>Suc <span class="skolem">index</span><span class="main">)</span><span class="main">)</span> 
                  <span class="main">(</span><span class="skolem">ft</span> <span class="main">(</span>Suc <span class="skolem">index</span><span class="main">)</span><span class="main">)</span> <span class="skolem">msg</span> <span class="skolem">nMsg</span>"</span></span> 
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">nMsg</span> <span class="main">&lt;</span> length <span class="main">(</span><span class="skolem">fe</span> <span class="skolem">index</span><span class="main">)</span>"</span></span> 
                <span class="keyword1"><span class="command">using</span></span> SmallIndex AssumpGreaterOccurrence<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
              <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n1</span> <span class="main">&lt;</span> length <span class="main">(</span><span class="skolem">fe</span> <span class="skolem">index</span><span class="main">)</span>"</span></span> 
                <span class="keyword1"><span class="command">using</span></span> AssumpGreaterOccurrence<span class="main">(</span>1<span class="main">)</span> 
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> less_trans nat_neq_iff<span class="main">)</span>
              <span class="keyword1"><span class="command">hence</span></span> N1Small<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n1</span> <span class="main">≤</span> length <span class="main">(</span><span class="skolem">ft</span> <span class="skolem">index</span><span class="main">)</span>"</span></span> 
                <span class="keyword1"><span class="command">using</span></span> IndexIsExec AssumptionFair<span class="main">(</span>1<span class="main">)</span> 
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span>  One_nat_def Suc_eq_plus1 le_diff_conv2 
                  not_le not_less_eq_eq<span class="main">)</span>
              <span class="keyword1"><span class="command">have</span></span> NotConsumed<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound"><span class="bound">i</span></span> <span class="main">≥</span> <span class="skolem">n1</span> <span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> length <span class="main">(</span><span class="skolem">ft</span> <span class="main">(</span>Suc <span class="skolem">index</span><span class="main">)</span><span class="main">)</span>
                <span class="main">⟶</span> <span class="skolem">consumedMsg</span> <span class="main">≠</span> <span class="main">(</span><span class="skolem">ft</span> <span class="main">(</span>Suc <span class="skolem">index</span><span class="main">)</span><span class="main">)</span> <span class="main">!</span> <span class="bound">i</span>"</span></span> 
                <span class="keyword1"><span class="command">using</span></span> execution.firstOccurrence_def<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">trans</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">sends</span>"</span></span>
                  <span class="quoted"><span class="quoted">"<span class="free">start</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">fe</span> <span class="main">(</span>Suc <span class="skolem">index</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ft</span> <span class="main">(</span>Suc <span class="skolem">index</span><span class="main">)</span>"</span></span> 
                  <span class="quoted"><span class="quoted">"<span class="skolem">consumedMsg</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n1</span>"</span></span><span class="main">]</span>
                  AssumpGreaterOccurrence<span class="main">(</span>2<span class="main">)</span> SucIndexIsExec <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound"><span class="bound">i</span></span> <span class="main">≥</span> length <span class="main">(</span><span class="skolem">ft</span> <span class="skolem">index</span><span class="main">)</span> <span class="main">.</span> 
                <span class="bound">i</span> <span class="main">&lt;</span> length <span class="main">(</span><span class="skolem">ft</span> <span class="main">(</span>Suc <span class="skolem">index</span><span class="main">)</span><span class="main">)</span> 
                <span class="main">∧</span> <span class="skolem">consumedMsg</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">ft</span> <span class="main">(</span>Suc <span class="skolem">index</span><span class="main">)</span><span class="main">)</span> <span class="main">!</span> <span class="bound">i</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> DropToIndex<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">consumedMsg</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="skolem">ft</span> <span class="skolem">index</span><span class="main">)</span>"</span></span><span class="main">]</span>
                ConsumedIsInDrop <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span> IDef<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≥</span> length <span class="main">(</span><span class="skolem">ft</span> <span class="skolem">index</span><span class="main">)</span>"</span></span>
                <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="main">(</span><span class="skolem">ft</span> <span class="main">(</span>Suc <span class="skolem">index</span><span class="main">)</span><span class="main">)</span>"</span></span> 
                <span class="quoted"><span class="quoted">"<span class="skolem">consumedMsg</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">ft</span> <span class="main">(</span>Suc <span class="skolem">index</span><span class="main">)</span><span class="main">)</span> <span class="main">!</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
              <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> NotConsumed N1Small <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">consumedMsg</span> <span class="main">∉</span> <span class="skolem">firstOccSet</span> <span class="main">(</span>Suc <span class="skolem">index</span><span class="main">)</span>"</span></span> 
            <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
              <span class="keyword3"><span class="command">assume</span></span> AssumpConsumedInSucSet<span class="main">:</span> 
                <span class="quoted"><span class="quoted">"<span class="skolem">consumedMsg</span> <span class="main">∈</span> <span class="skolem">firstOccSet</span> <span class="main">(</span>Suc <span class="skolem">index</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">nMsg</span> <span class="bound">n1</span><span class="main">.</span> <span class="bound">n1</span> <span class="main">≤</span> <span class="bound">nMsg</span> <span class="main">∧</span>
                  execution.firstOccurrence <span class="main">(</span><span class="skolem">fe</span> <span class="main">(</span>Suc <span class="skolem">index</span><span class="main">)</span><span class="main">)</span> 
                    <span class="main">(</span><span class="skolem">ft</span> <span class="main">(</span>Suc <span class="skolem">index</span><span class="main">)</span><span class="main">)</span> <span class="skolem">consumedMsg</span> <span class="bound">n1</span> <span class="main">∧</span> 
                  execution.firstOccurrence <span class="main">(</span><span class="skolem">fe</span> <span class="main">(</span>Suc <span class="skolem">index</span><span class="main">)</span><span class="main">)</span> 
                    <span class="main">(</span><span class="skolem">ft</span> <span class="main">(</span>Suc <span class="skolem">index</span><span class="main">)</span><span class="main">)</span> <span class="skolem">msg</span> <span class="bound">nMsg</span>"</span></span> 
                <span class="keyword1"><span class="command">using</span></span> firstOccSet_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
              <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> GreaterOccurrence 
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> less_le_trans less_not_refl3<span class="main">)</span>
            <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> ConsumedInSet <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">qed</span></span>

          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">firstOccSet</span> <span class="main">(</span>Suc <span class="skolem">index</span><span class="main">)</span> <span class="main">⊂</span> <span class="skolem">firstOccSet</span> <span class="skolem">index</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> Subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">firstOccSet</span> <span class="main">(</span>Suc <span class="skolem">index</span><span class="main">)</span> <span class="main">⊂</span> <span class="skolem">firstOccSet</span> <span class="skolem">index</span> 
            <span class="main">∧</span> enabled <span class="main">(</span>last <span class="main">(</span><span class="skolem">fe</span> <span class="main">(</span>Suc <span class="skolem">index</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="skolem">msg</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> EnabledInSuc <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">qed</span></span>

        <span class="keyword1"><span class="command">have</span></span> NotConsumed<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound"><span class="bound">index</span></span> <span class="main">≥</span> <span class="skolem">n</span> <span class="main">.</span> <span class="main">¬</span> <span class="skolem">msg</span> <span class="main">∈</span> 
          <span class="main">(</span>set <span class="main">(</span>drop <span class="main">(</span>length <span class="main">(</span><span class="skolem">ft</span> <span class="bound">index</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">ft</span> <span class="main">(</span>Suc <span class="bound">index</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">index</span>
          <span class="keyword3"><span class="command">assume</span></span> AssumpMsgNotConsumed<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">≤</span> <span class="skolem">index</span>"</span></span> 
            <span class="quoted"><span class="quoted">"<span class="skolem">msg</span> <span class="main">∈</span> set <span class="main">(</span>drop <span class="main">(</span>length <span class="main">(</span><span class="skolem">ft</span> <span class="skolem">index</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">ft</span> <span class="main">(</span>Suc <span class="skolem">index</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound"><span class="bound">n0'</span></span> <span class="main">≥</span> length <span class="main">(</span><span class="skolem">ft</span> <span class="skolem">index</span><span class="main">)</span> <span class="main">.</span> 
            <span class="bound">n0'</span> <span class="main">&lt;</span> length <span class="main">(</span><span class="skolem">ft</span> <span class="main">(</span>Suc <span class="skolem">index</span><span class="main">)</span><span class="main">)</span> 
            <span class="main">∧</span> <span class="skolem">msg</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">ft</span> <span class="main">(</span>Suc <span class="skolem">index</span><span class="main">)</span><span class="main">)</span> <span class="main">!</span> <span class="bound">n0'</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> AssumpMsgNotConsumed<span class="main">(</span>2<span class="main">)</span> DropToIndex<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">msg</span>"</span></span> 
              <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="skolem">ft</span> <span class="skolem">index</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ft</span> <span class="main">(</span>Suc <span class="skolem">index</span><span class="main">)</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n0'</span></span> <span class="keyword2"><span class="keyword">where</span></span> MessageIndex<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n0'</span> <span class="main">≥</span> length <span class="main">(</span><span class="skolem">ft</span> <span class="skolem">index</span><span class="main">)</span>"</span></span> 
            <span class="quoted"><span class="quoted">"<span class="skolem">n0'</span> <span class="main">&lt;</span> length <span class="main">(</span><span class="skolem">ft</span> <span class="main">(</span>Suc <span class="skolem">index</span><span class="main">)</span><span class="main">)</span>"</span></span> 
            <span class="quoted"><span class="quoted">"<span class="skolem">msg</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">ft</span> <span class="main">(</span>Suc <span class="skolem">index</span><span class="main">)</span><span class="main">)</span> <span class="main">!</span> <span class="skolem">n0'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">have</span></span> LengthIncreasing<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="skolem">ft</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">≤</span> length <span class="main">(</span><span class="skolem">ft</span> <span class="skolem">index</span><span class="main">)</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> AssumpMsgNotConsumed<span class="main">(</span>1<span class="main">)</span> 
          <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">index</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span><span class="main">)</span>
            <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">indexa</span>
            <span class="keyword3"><span class="command">assume</span></span> AssumpLengthIncreasing<span class="main">:</span> 
              <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">≤</span> <span class="skolem">indexa</span> <span class="main">⟹</span> length <span class="main">(</span><span class="skolem">ft</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">≤</span> length <span class="main">(</span><span class="skolem">ft</span> <span class="skolem">indexa</span><span class="main">)</span>"</span></span> 
              <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">≤</span> Suc <span class="skolem">indexa</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">≤</span> <span class="skolem">index</span>"</span></span>
            <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="skolem">ft</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">≤</span> length <span class="main">(</span><span class="skolem">ft</span> <span class="main">(</span>Suc <span class="skolem">indexa</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> Suc <span class="skolem">indexa</span>"</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span><span class="main">)</span>
              <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">≠</span> Suc <span class="skolem">indexa</span>"</span></span>
              <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">≤</span> <span class="skolem">indexa</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> AssumpLengthIncreasing<span class="main">(</span>2<span class="main">)</span> 
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> le_SucE<span class="main">)</span>
              <span class="keyword1"><span class="command">hence</span></span> LengthNA<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="skolem">ft</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">≤</span> length <span class="main">(</span><span class="skolem">ft</span> <span class="skolem">indexa</span><span class="main">)</span>"</span></span> 
                <span class="keyword1"><span class="command">using</span></span> AssumpLengthIncreasing<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
              <span class="keyword1"><span class="command">have</span></span> PrefixIndexA<span class="main">:</span> <span class="quoted"><span class="quoted">"prefixList <span class="main">(</span><span class="skolem">ft</span> <span class="skolem">indexa</span><span class="main">)</span> <span class="main">(</span><span class="skolem">ft</span> <span class="main">(</span>Suc <span class="skolem">indexa</span><span class="main">)</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> BasicProperties <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
              <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="skolem">ft</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">≤</span> length <span class="main">(</span><span class="skolem">ft</span> <span class="main">(</span>Suc <span class="skolem">indexa</span><span class="main">)</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> LengthNA PrefixListMonotonicity<span class="main">[</span><span class="operator">OF</span> PrefixIndexA<span class="main">]</span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>hide_lams<span class="main"><span class="main">,</span></span> no_types<span class="main"><span class="main">)</span></span> antisym le_cases 
                  less_imp_le less_le_trans<span class="main">)</span>
            <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> AssumptionFairContr MessageIndex 
            AssumpMsgNotConsumed<span class="main">(</span>1<span class="main">)</span> 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹length <span class="main">(</span><span class="skolem">ft</span> <span class="skolem">index</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">n0'</span>›</span></span> le_SucI le_trans<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>

        <span class="keyword1"><span class="command">hence</span></span> FirstOccSetDecrImpl<span class="main">:</span> 
          <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound"><span class="bound">index</span></span> <span class="main">≥</span> <span class="skolem">n</span> <span class="main">.</span> <span class="main">(</span>enabled <span class="main">(</span>last <span class="main">(</span><span class="skolem">fe</span> <span class="bound">index</span><span class="main">)</span><span class="main">)</span> <span class="skolem">msg</span><span class="main">)</span> 
          <span class="main">⟶</span> <span class="skolem">firstOccSet</span> <span class="main">(</span>Suc <span class="bound">index</span><span class="main">)</span> <span class="main">⊂</span> <span class="skolem">firstOccSet</span> <span class="bound">index</span> 
            <span class="main">∧</span> <span class="main">(</span>enabled <span class="main">(</span>last <span class="main">(</span><span class="skolem">fe</span> <span class="main">(</span>Suc <span class="bound">index</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="skolem">msg</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> FirstOccSetDecrOrConsumed <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">hence</span></span> FirstOccSetDecrImpl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound"><span class="bound">index</span></span> <span class="main">≥</span> <span class="skolem">n</span> <span class="main">.</span> <span class="skolem">firstOccSet</span> 
          <span class="main">(</span>Suc <span class="bound">index</span><span class="main">)</span> <span class="main">⊂</span> <span class="skolem">firstOccSet</span> <span class="bound">index</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> KeepProperty<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span><span class="main">(</span>enabled <span class="main">(</span>last <span class="main">(</span><span class="skolem">fe</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="skolem">msg</span><span class="main">)</span>"</span></span> 
            <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span><span class="main">(</span><span class="skolem">firstOccSet</span> <span class="main">(</span>Suc <span class="bound">x</span><span class="main">)</span> <span class="main">⊂</span> <span class="skolem">firstOccSet</span> <span class="bound">x</span><span class="main">)</span>"</span></span><span class="main">]</span>
            AssumptionCase1ImplThesis' <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">hence</span></span> FirstOccSetDecr'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound"><span class="bound">index</span></span> <span class="main">≥</span> <span class="skolem">n</span> <span class="main">.</span> 
          card <span class="main">(</span><span class="skolem">firstOccSet</span> <span class="main">(</span>Suc <span class="bound">index</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> card <span class="main">(</span><span class="skolem">firstOccSet</span> <span class="bound">index</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> FiniteMsgs psubset_card_mono <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="skolem">firstOccSet</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">+</span> <span class="main">(</span>card <span class="main">(</span><span class="skolem">firstOccSet</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
          <span class="main">≤</span> card <span class="main">(</span><span class="skolem">firstOccSet</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span>card <span class="main">(</span><span class="skolem">firstOccSet</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> SmallerMultipleStepsWithLimit<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span>"</span></span> 
            <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> card <span class="main">(</span><span class="skolem">firstOccSet</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="skolem">firstOccSet</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span>"</span></span><span class="main">]</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">hence</span></span> IsNegative<span class="main">:</span><span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="skolem">firstOccSet</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">+</span> <span class="main">(</span>card 
          <span class="main">(</span><span class="skolem">firstOccSet</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> FirstOccSetDecr' diff_add_zero leD le_add1 
            less_nat_zero_code neq0_conv<span class="main">)</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> less_nat_zero_code<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>

    <span class="keyword1"><span class="command">hence</span></span> Case1ImplThesis<span class="main">:</span> <span class="quoted"><span class="quoted">"enabled <span class="main">(</span>last <span class="main">(</span><span class="skolem">fe</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="skolem">msg</span> 
      <span class="main">⟹</span> <span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">n'</span></span><span class="main">≥</span><span class="skolem">n</span><span class="main">.</span> <span class="main">∃</span><span class="bound"><span class="bound">n0'</span></span><span class="main">≥</span><span class="skolem">n0</span><span class="main">.</span> <span class="bound">n0'</span> <span class="main">&lt;</span> length <span class="main">(</span><span class="skolem">ft</span> <span class="bound">n'</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">msg</span> <span class="main">=</span> <span class="skolem">ft</span> <span class="bound">n'</span> <span class="main">!</span> <span class="bound">n0'</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> AssumptionFair<span class="main">(</span>2<span class="main">)</span> execution.length<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">trans</span></span> <span class="quoted"><span class="free">sends</span></span> <span class="quoted"><span class="free">start</span></span> 
        <span class="quoted"><span class="quoted">"<span class="skolem">fe</span> <span class="skolem">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ft</span> <span class="skolem">n</span>"</span></span><span class="main">]</span> BasicProperties 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> One_nat_def Suc_eq_plus1 Suc_lessI leI le_less_trans 
        less_asym less_diff_conv<span class="main">)</span>

    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">n'</span></span><span class="main">≥</span><span class="skolem">n</span><span class="main">.</span> <span class="main">∃</span><span class="bound"><span class="bound">n0'</span></span><span class="main">≥</span><span class="skolem">n0</span><span class="main">.</span> <span class="bound">n0'</span> <span class="main">&lt;</span> length <span class="main">(</span><span class="skolem">ft</span> <span class="bound">n'</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">msg</span> <span class="main">=</span> <span class="skolem">ft</span> <span class="bound">n'</span> <span class="main">!</span> <span class="bound">n0'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> disjE<span class="main">[</span><span class="operator">OF</span> EnabledOrConsumedAtLast Case1ImplThesis Case2ImplThesis<span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">fe</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">ft</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">fe</span> <span class="main">0</span> <span class="main">=</span> <span class="main">[</span><span class="free">cfg</span><span class="main">]</span> <span class="main">∧</span> fairInfiniteExecution <span class="skolem">fe</span> <span class="skolem">ft</span> 
      <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">n</span><span class="main">.</span> nonUniform <span class="main">(</span>last <span class="main">(</span><span class="skolem">fe</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> prefixList <span class="main">(</span><span class="skolem">fe</span> <span class="bound">n</span><span class="main">)</span> <span class="main">(</span><span class="skolem">fe</span> <span class="main">(</span><span class="bound">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> 
          <span class="main">∧</span> prefixList <span class="main">(</span><span class="skolem">ft</span> <span class="bound">n</span><span class="main">)</span> <span class="main">(</span><span class="skolem">ft</span> <span class="main">(</span><span class="bound">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>
          <span class="main">∧</span> execution <span class="free">trans</span> <span class="free">sends</span> <span class="free">start</span> <span class="main">(</span><span class="skolem">fe</span> <span class="bound">n</span><span class="main">)</span> <span class="main">(</span><span class="skolem">ft</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Fair fe_def FStep BasicProperties <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Contradiction›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  An infinite execution is said to be a terminating FLP execution if each process
  at some point sends a decision message or if it stops, which is expressed
  by the process not processing any further messages.
›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> flpSystem<span class="main">)</span> <span class="entity">terminationFLP</span><span class="main">::</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span>nat <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'p</span><span class="main">,</span> <span class="tfree">'v</span><span class="main">,</span> <span class="tfree">'s</span><span class="main">)</span> configuration list<span class="main">)</span> 
  <span class="main">⇒</span> <span class="main">(</span>nat <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'p</span><span class="main">,</span> <span class="tfree">'v</span><span class="main">)</span> message list<span class="main">)</span> <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">terminationFLP</span> <span class="free"><span class="bound"><span class="entity">fe</span></span></span> <span class="free"><span class="bound"><span class="entity">ft</span></span></span> <span class="main">≡</span> infiniteExecution <span class="free"><span class="bound"><span class="entity">fe</span></span></span> <span class="free"><span class="bound"><span class="entity">ft</span></span></span> <span class="main">⟶</span> 
  <span class="main">(</span><span class="main">∀</span> <span class="bound">p</span> <span class="main">.</span> <span class="main">∃</span> <span class="bound">n</span> <span class="main">.</span>
     <span class="main">(</span><span class="main">∃</span> <span class="bound"><span class="bound">i0</span></span> <span class="main">&lt;</span> length <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ft</span></span></span> <span class="bound">n</span><span class="main">)</span><span class="main">.</span> <span class="main">∃</span> <span class="bound">b</span> <span class="main">.</span> 
      <span class="main">(</span><span class="main">&lt;⊥,</span> <span class="keyword1">outM</span> <span class="bound">b</span><span class="main">&gt;</span> <span class="main">∈#</span> <span class="free">sends</span> <span class="bound">p</span> <span class="main">(</span>states <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">fe</span></span></span> <span class="bound">n</span><span class="main">)</span> <span class="main">!</span> <span class="bound">i0</span><span class="main">)</span> <span class="bound">p</span><span class="main">)</span> <span class="main">(</span>unpackMessage <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">ft</span></span></span> <span class="bound">n</span><span class="main">)</span> <span class="main">!</span> <span class="bound">i0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
      <span class="main">∧</span> isReceiverOf <span class="bound">p</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">ft</span></span></span> <span class="bound">n</span><span class="main">)</span> <span class="main">!</span> <span class="bound">i0</span><span class="main">)</span><span class="main">)</span>
  <span class="main">∨</span> <span class="main">(</span><span class="main">∀</span> <span class="bound"><span class="bound">n1</span></span> <span class="main">&gt;</span> <span class="bound">n</span> <span class="main">.</span> <span class="main">∀</span> <span class="bound">m</span> <span class="main">∈</span> set <span class="main">(</span>drop <span class="main">(</span>length <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ft</span></span></span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ft</span></span></span> <span class="bound">n1</span><span class="main">)</span><span class="main">)</span> <span class="main">.</span> <span class="main">¬</span> isReceiverOf <span class="bound">p</span> <span class="bound">m</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">theorem</span></span> ConsensusFails<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> 
  Termination<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">fe</span> <span class="bound">ft</span> <span class="main">.</span> <span class="main">(</span>fairInfiniteExecution <span class="bound">fe</span> <span class="bound">ft</span> <span class="main">⟹</span> terminationFLP <span class="bound">fe</span> <span class="bound">ft</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  Validity<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">i</span> <span class="bound">c</span> <span class="main">.</span> validity <span class="bound">i</span> <span class="bound">c</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  Agreement<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">i</span> <span class="bound">c</span> <span class="main">.</span> agreementInit <span class="bound">i</span> <span class="bound">c</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span>
  <span class="quoted"><span class="quoted">"False"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">cfg</span></span> <span class="keyword2"><span class="keyword">where</span></span> Cfg<span class="main">:</span> <span class="quoted"><span class="quoted">"initial <span class="skolem">cfg</span>"</span></span> <span class="quoted"><span class="quoted">"nonUniform <span class="skolem">cfg</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> InitialNonUniformCfg<span class="main">[</span><span class="operator">OF</span> PseudoTermination Validity Agreement<span class="main">]</span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">fe</span></span><span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'p</span><span class="main">,</span> <span class="tfree">'v</span><span class="main">,</span> <span class="tfree">'s</span><span class="main">)</span> configuration list"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
              <span class="skolem"><span class="skolem">ft</span></span><span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'p</span><span class="main">,</span> <span class="tfree">'v</span><span class="main">)</span> message list"</span></span>
    <span class="keyword2"><span class="keyword">where</span></span> FE<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">fe</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span><span class="skolem">cfg</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"fairInfiniteExecution <span class="skolem">fe</span> <span class="skolem">ft</span>"</span></span>
        <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">n</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">.</span> nonUniform <span class="main">(</span>last <span class="main">(</span><span class="skolem">fe</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> 
          <span class="main">∧</span> prefixList <span class="main">(</span><span class="skolem">fe</span> <span class="bound">n</span><span class="main">)</span> <span class="main">(</span><span class="skolem">fe</span> <span class="main">(</span><span class="bound">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> 
          <span class="main">∧</span> prefixList <span class="main">(</span><span class="skolem">ft</span> <span class="bound">n</span><span class="main">)</span> <span class="main">(</span><span class="skolem">ft</span> <span class="main">(</span><span class="bound">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>
          <span class="main">∧</span> <span class="main">(</span>execution <span class="free">trans</span> <span class="free">sends</span> <span class="free">start</span> <span class="main">(</span><span class="skolem">fe</span> <span class="bound">n</span><span class="main">)</span> <span class="main">(</span><span class="skolem">ft</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> FairNonUniformExecution<span class="main">[</span><span class="operator">OF</span> Cfg<span class="main">]</span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">have</span></span> AllArePrefixesExec<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">m</span> <span class="main">.</span> <span class="main">∀</span> <span class="bound"><span class="bound">n</span></span> <span class="main">&gt;</span> <span class="bound">m</span> <span class="main">.</span> prefixList <span class="main">(</span><span class="skolem">fe</span> <span class="bound">m</span><span class="main">)</span> <span class="main">(</span><span class="skolem">fe</span> <span class="bound">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">m</span><span class="main">::</span><span class="quoted">nat</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">n</span><span class="main">::</span><span class="quoted">nat</span>
    <span class="keyword3"><span class="command">assume</span></span> MLessN<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">&lt;</span> <span class="skolem">n</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prefixList <span class="main">(</span><span class="skolem">fe</span> <span class="skolem">m</span><span class="main">)</span> <span class="main">(</span><span class="skolem">fe</span> <span class="skolem">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> MLessN 
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">n</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span>
      <span class="keyword3"><span class="command">assume</span></span> IA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">m</span> <span class="main">&lt;</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span>prefixList <span class="main">(</span><span class="skolem">fe</span> <span class="skolem">m</span><span class="main">)</span> <span class="main">(</span><span class="skolem">fe</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">&lt;</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">=</span> <span class="skolem">n</span> <span class="main">∨</span> <span class="skolem">m</span> <span class="main">&lt;</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> IA<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> less_SucE<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"prefixList <span class="main">(</span><span class="skolem">fe</span> <span class="skolem">m</span><span class="main">)</span> <span class="main">(</span><span class="skolem">fe</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">=</span> <span class="skolem">n</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"prefixList <span class="main">(</span><span class="skolem">fe</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span><span class="skolem">fe</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> FE <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">&lt;</span> <span class="skolem">n</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> IA2<span class="main">:</span> <span class="quoted"><span class="quoted">"prefixList <span class="main">(</span><span class="skolem">fe</span> <span class="skolem">m</span><span class="main">)</span> <span class="main">(</span><span class="skolem">fe</span> <span class="skolem">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> IA<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prefixList <span class="main">(</span><span class="skolem">fe</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span><span class="skolem">fe</span> <span class="main">(</span><span class="skolem">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> FE <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"prefixList <span class="main">(</span><span class="skolem">fe</span> <span class="skolem">m</span><span class="main">)</span> <span class="main">(</span><span class="skolem">fe</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> PrefixListTransitive 
          IA2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"prefixList <span class="main">(</span><span class="skolem">fe</span> <span class="skolem">m</span><span class="main">)</span> <span class="main">(</span><span class="skolem">fe</span> <span class="skolem">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">have</span></span> AllArePrefixesTrace<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">m</span> <span class="main">.</span> <span class="main">∀</span> <span class="bound"><span class="bound">n</span></span> <span class="main">&gt;</span> <span class="bound">m</span> <span class="main">.</span> prefixList <span class="main">(</span><span class="skolem">ft</span> <span class="bound">m</span><span class="main">)</span> <span class="main">(</span><span class="skolem">ft</span> <span class="bound">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">m</span><span class="main">::</span><span class="quoted">nat</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">n</span><span class="main">::</span><span class="quoted">nat</span>
    <span class="keyword3"><span class="command">assume</span></span> MLessN<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">&lt;</span> <span class="skolem">n</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prefixList <span class="main">(</span><span class="skolem">ft</span> <span class="skolem">m</span><span class="main">)</span> <span class="main">(</span><span class="skolem">ft</span> <span class="skolem">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> MLessN
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">n</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span>
      <span class="keyword3"><span class="command">assume</span></span> IA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">m</span> <span class="main">&lt;</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span>prefixList <span class="main">(</span><span class="skolem">ft</span> <span class="skolem">m</span><span class="main">)</span> <span class="main">(</span><span class="skolem">ft</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">&lt;</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">=</span> <span class="skolem">n</span> <span class="main">∨</span> <span class="skolem">m</span> <span class="main">&lt;</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> IA<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> less_SucE<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"prefixList <span class="main">(</span><span class="skolem">ft</span> <span class="skolem">m</span><span class="main">)</span> <span class="main">(</span><span class="skolem">ft</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">=</span> <span class="skolem">n</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"prefixList <span class="main">(</span><span class="skolem">ft</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span><span class="skolem">ft</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> FE <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">&lt;</span> <span class="skolem">n</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> IA2<span class="main">:</span> <span class="quoted"><span class="quoted">"prefixList <span class="main">(</span><span class="skolem">ft</span> <span class="skolem">m</span><span class="main">)</span> <span class="main">(</span><span class="skolem">ft</span> <span class="skolem">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> IA<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prefixList <span class="main">(</span><span class="skolem">ft</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span><span class="skolem">ft</span> <span class="main">(</span><span class="skolem">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> FE <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"prefixList <span class="main">(</span><span class="skolem">ft</span> <span class="skolem">m</span><span class="main">)</span> <span class="main">(</span><span class="skolem">ft</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> PrefixListTransitive 
          IA2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"prefixList <span class="main">(</span><span class="skolem">ft</span> <span class="skolem">m</span><span class="main">)</span> <span class="main">(</span><span class="skolem">ft</span> <span class="skolem">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">have</span></span> Length<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">n</span> <span class="main">.</span> length <span class="main">(</span><span class="skolem">fe</span> <span class="bound">n</span><span class="main">)</span> <span class="main">≥</span> <span class="bound">n</span> <span class="main">+</span> <span class="main">1</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="skolem">fe</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">≥</span> <span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">n</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> FE<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span>
      <span class="keyword3"><span class="command">assume</span></span> IH<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">n</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span>length <span class="main">(</span><span class="skolem">fe</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="skolem">fe</span> <span class="main">(</span><span class="skolem">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">≥</span> length <span class="main">(</span><span class="skolem">fe</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> FE<span class="main">(</span>3<span class="main">)</span> 
        PrefixListMonotonicity
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc_eq_plus1 Suc_le_eq<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">≤</span> <span class="main">(</span>length <span class="main">(</span><span class="skolem">fe</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> IH <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">have</span></span> AllExecsFromInit<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">n</span> <span class="main">.</span> <span class="main">∀</span> <span class="bound"><span class="bound">n0</span></span> <span class="main">&lt;</span> length <span class="main">(</span><span class="skolem">fe</span> <span class="bound">n</span><span class="main">)</span> <span class="main">.</span> 
    reachable <span class="skolem">cfg</span> <span class="main">(</span><span class="main">(</span><span class="skolem">fe</span> <span class="bound">n</span><span class="main">)</span> <span class="main">!</span> <span class="bound">n0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span><span class="main">::</span><span class="quoted">nat</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">n0</span><span class="main">::</span><span class="quoted">nat</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n0</span> <span class="main">&lt;</span> length <span class="main">(</span><span class="skolem">fe</span> <span class="skolem">n</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"reachable <span class="skolem">cfg</span> <span class="main">(</span><span class="main">(</span><span class="skolem">fe</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">!</span> <span class="skolem">n0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">=</span> <span class="skolem">n</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> N0Less<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n0</span> <span class="main">&lt;</span> length <span class="main">(</span><span class="skolem">fe</span> <span class="main">0</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> NoStep<span class="main">:</span> <span class="quoted"><span class="quoted">"reachable <span class="skolem">cfg</span> <span class="skolem">cfg</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> reachable.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="skolem">fe</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> FE<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">hence</span></span> N0Zero<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n0</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> N0Less FE <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">fe</span> <span class="main">0</span><span class="main">)</span> <span class="main">!</span> <span class="skolem">n0</span> <span class="main">=</span> <span class="skolem">cfg</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> FE<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"reachable <span class="skolem">cfg</span> <span class="main">(</span><span class="main">(</span><span class="skolem">fe</span> <span class="main">0</span><span class="main">)</span> <span class="main">!</span> <span class="skolem">n0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> FE<span class="main">(</span>1<span class="main">)</span> NoStep N0Zero <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> NNotZero<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n0</span> <span class="main">&lt;</span> <span class="main">(</span>length <span class="main">(</span><span class="skolem">fe</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> ZeroCfg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">fe</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span><span class="skolem">cfg</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> FE <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prefixList <span class="main">(</span><span class="skolem">fe</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="skolem">fe</span> <span class="skolem">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> AllArePrefixesExec NNotZero 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">hence</span></span> PrList<span class="main">:</span> <span class="quoted"><span class="quoted">"prefixList <span class="main">[</span><span class="skolem">cfg</span><span class="main">]</span> <span class="main">(</span><span class="skolem">fe</span> <span class="skolem">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ZeroCfg <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">have</span></span> CfgFirst<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">cfg</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">fe</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">!</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> prefixList.cases<span class="main">[</span><span class="operator">OF</span> PrList<span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> ZeroCfg list.distinct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> nth_Cons_0<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"reachable <span class="main">(</span><span class="main">(</span><span class="skolem">fe</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">!</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="skolem">fe</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">!</span> <span class="skolem">n0</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> execution.ReachableInExecution FE NNotZero<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> le0<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>reachable <span class="skolem">cfg</span> <span class="main">(</span><span class="main">(</span><span class="skolem">fe</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">!</span> <span class="skolem">n0</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms CfgFirst <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">have</span></span> NoDecided<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span> <span class="bound">n</span> <span class="bound">n0</span> <span class="bound">v</span> <span class="main">.</span> <span class="main">(</span><span class="bound">n0</span> <span class="main">&lt;</span> length <span class="main">(</span><span class="skolem">fe</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> 
                  <span class="main">⟶</span> <span class="main">¬</span> vDecided <span class="bound">v</span> <span class="main">(</span><span class="main">(</span><span class="skolem">fe</span> <span class="bound">n</span><span class="main">)</span> <span class="main">!</span> <span class="bound">n0</span><span class="main">)</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span> <span class="skolem">n0</span> <span class="skolem">v</span>
    <span class="keyword3"><span class="command">assume</span></span> AssmNoDecided<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n0</span> <span class="main">&lt;</span> length <span class="main">(</span><span class="skolem">fe</span> <span class="skolem">n</span><span class="main">)</span>"</span></span> 
      <span class="quoted"><span class="quoted">"initReachable <span class="main">(</span><span class="main">(</span><span class="skolem">fe</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">!</span> <span class="skolem">n0</span><span class="main">)</span>"</span></span>
      <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="main">(</span>msgs <span class="main">(</span><span class="main">(</span><span class="skolem">fe</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">!</span> <span class="skolem">n0</span><span class="main">)</span> <span class="main">&lt;⊥,</span> <span class="keyword1">outM</span> <span class="skolem">v</span><span class="main">&gt;</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> LastNonUniform<span class="main">:</span> <span class="quoted"><span class="quoted">"nonUniform <span class="main">(</span>last <span class="main">(</span><span class="skolem">fe</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> FE <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> LastIsLastIndex<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">l</span> <span class="main">.</span> <span class="bound">l</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟶</span> last <span class="bound">l</span> <span class="main">=</span> <span class="bound">l</span> <span class="main">!</span> <span class="main">(</span><span class="main">(</span>length <span class="bound">l</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> last_conv_nth<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> Fou<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n0</span> <span class="main">≤</span> length <span class="main">(</span><span class="skolem">fe</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> AssmNoDecided <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> FeNNotEmpty<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">fe</span> <span class="skolem">n</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> FE<span class="main">(</span>1<span class="main">)</span> AllArePrefixesExec 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> AssmNoDecided<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> less_nat_zero_code list.size<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> Fou2<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="skolem">fe</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span> <span class="main">&lt;</span> length <span class="main">(</span><span class="skolem">fe</span> <span class="skolem">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"last <span class="main">(</span><span class="skolem">fe</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">fe</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">!</span> <span class="main">(</span>length <span class="main">(</span><span class="skolem">fe</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> LastIsLastIndex FeNNotEmpty <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> LastNonUniform<span class="main">:</span> <span class="quoted"><span class="quoted">"nonUniform <span class="main">(</span>last <span class="main">(</span><span class="skolem">fe</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> FE <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"reachable <span class="main">(</span><span class="main">(</span><span class="skolem">fe</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">!</span> <span class="skolem">n0</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="skolem">fe</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">!</span> <span class="main">(</span>length <span class="main">(</span><span class="skolem">fe</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> FE execution.ReachableInExecution Fou Fou2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">hence</span></span> N0ToLast<span class="main">:</span> <span class="quoted"><span class="quoted">"reachable <span class="main">(</span><span class="main">(</span><span class="skolem">fe</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">!</span> <span class="skolem">n0</span><span class="main">)</span> <span class="main">(</span>last <span class="main">(</span><span class="skolem">fe</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> LastIsLastIndex<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">fe</span> <span class="skolem">n</span>"</span></span><span class="main">]</span> FeNNotEmpty <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> LastVDecided<span class="main">:</span> <span class="quoted"><span class="quoted">"vDecided <span class="skolem">v</span> <span class="main">(</span>last <span class="main">(</span><span class="skolem">fe</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> NoOutMessageLoss<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="skolem">fe</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">!</span> <span class="skolem">n0</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>last <span class="main">(</span><span class="skolem">fe</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">]</span> 
        AssmNoDecided
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span>
        <span class="operator">metis</span> LastNonUniform le_neq_implies_less less_nat_zero_code neq0_conv<span class="main">)</span>

    <span class="keyword1"><span class="command">have</span></span> AllAgree<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">cfg'</span> <span class="main">.</span> reachable <span class="main">(</span>last <span class="main">(</span><span class="skolem">fe</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="bound">cfg'</span> 
      <span class="main">⟶</span> agreement <span class="bound">cfg'</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">cfg'</span>
      <span class="keyword3"><span class="command">assume</span></span> LastToNext<span class="main">:</span> <span class="quoted"><span class="quoted">"reachable <span class="main">(</span>last <span class="main">(</span><span class="skolem">fe</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="skolem">cfg'</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"reachable <span class="skolem">cfg</span>  <span class="main">(</span><span class="main">(</span><span class="skolem">fe</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">!</span> <span class="main">(</span>length <span class="main">(</span><span class="skolem">fe</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> AllExecsFromInit AssmNoDecided<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"reachable <span class="skolem">cfg</span> <span class="main">(</span>last <span class="main">(</span><span class="skolem">fe</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> LastIsLastIndex<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">fe</span> <span class="skolem">n</span>"</span></span><span class="main">]</span> 
        FeNNotEmpty <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">hence</span></span> FirstToLast<span class="main">:</span> <span class="quoted"><span class="quoted">"reachable <span class="skolem">cfg</span> <span class="skolem">cfg'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> initReachable_def Cfg 
        LastToNext ReachableTrans <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"agreementInit <span class="skolem">cfg</span> <span class="skolem">cfg'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Agreement <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">v1</span><span class="main">.</span> <span class="main">(</span><span class="main">&lt;⊥,</span> <span class="keyword1">outM</span> <span class="bound">v1</span><span class="main">&gt;</span> <span class="main">∈#</span> msgs <span class="skolem">cfg'</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">v2</span><span class="main">.</span> <span class="main">(</span><span class="main">&lt;⊥,</span> <span class="keyword1">outM</span> <span class="bound">v2</span><span class="main">&gt;</span> <span class="main">∈#</span> 
        msgs <span class="skolem">cfg'</span><span class="main">)</span> <span class="main">⟷</span> <span class="bound">v2</span> <span class="main">=</span> <span class="bound">v1</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> Cfg FirstToLast
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> agreementInit_def<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"agreement <span class="skolem">cfg'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> agreement_def<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"False"</span></span> <span class="keyword1"><span class="command">using</span></span> NonUniformImpliesNotDecided LastNonUniform 
      PseudoTermination LastVDecided <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">have</span></span> Termination<span class="main">:</span> <span class="quoted"><span class="quoted">"terminationFLP <span class="skolem">fe</span> <span class="skolem">ft</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> FE<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>

  <span class="keyword1"><span class="command">hence</span></span> AllDecideOrCrash<span class="main">:</span> 
    <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">p</span><span class="main">.</span> <span class="main">∃</span><span class="bound">n</span> <span class="main">.</span> 
       <span class="main">(</span><span class="main">∃</span> <span class="bound"><span class="bound">i0</span></span> <span class="main">&lt;</span> length <span class="main">(</span><span class="skolem">ft</span> <span class="bound">n</span><span class="main">)</span> <span class="main">.</span> <span class="main">∃</span><span class="bound">b</span><span class="main">.</span> 
          <span class="main">(</span><span class="main">&lt;⊥,</span> <span class="keyword1">outM</span> <span class="bound">b</span><span class="main">&gt;</span> <span class="main">∈#</span> 
            <span class="free">sends</span> <span class="bound">p</span> <span class="main">(</span>states <span class="main">(</span><span class="skolem">fe</span> <span class="bound">n</span> <span class="main">!</span> <span class="bound">i0</span><span class="main">)</span> <span class="bound">p</span><span class="main">)</span> <span class="main">(</span>unpackMessage <span class="main">(</span><span class="skolem">ft</span> <span class="bound">n</span> <span class="main">!</span> <span class="bound">i0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
          <span class="main">∧</span> isReceiverOf <span class="bound">p</span> <span class="main">(</span><span class="skolem">ft</span> <span class="bound">n</span> <span class="main">!</span> <span class="bound">i0</span><span class="main">)</span><span class="main">)</span> 
      <span class="main">∨</span> <span class="main">(</span><span class="main">∀</span> <span class="bound"><span class="bound">n1</span></span> <span class="main">&gt;</span> <span class="bound">n</span> <span class="main">.</span> <span class="main">∀</span> <span class="bound">m</span> <span class="main">∈</span> <span class="main">(</span>set <span class="main">(</span>drop <span class="main">(</span>length <span class="main">(</span><span class="skolem">ft</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">ft</span> <span class="bound">n1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">.</span>
          <span class="main">¬</span> isReceiverOf <span class="bound">p</span> <span class="bound">m</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> FE<span class="main">(</span>2<span class="main">)</span>
    <span class="keyword1"><span class="command">unfolding</span></span> terminationFLP_def fairInfiniteExecution_def 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">p</span> <span class="main">.</span> <span class="main">∃</span> <span class="bound">n</span> <span class="main">.</span> <span class="main">(</span><span class="main">∀</span> <span class="bound"><span class="bound">n1</span></span> <span class="main">&gt;</span> <span class="bound">n</span> <span class="main">.</span> <span class="main">∀</span> <span class="bound">m</span> <span class="main">∈</span> <span class="main">(</span>set <span class="main">(</span>drop <span class="main">(</span>length <span class="main">(</span><span class="skolem">ft</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">ft</span> <span class="bound">n1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">.</span>
    <span class="main">¬</span> isReceiverOf <span class="bound">p</span> <span class="bound">m</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span>
    <span class="keyword1"><span class="command">from</span></span> AllDecideOrCrash <span class="keyword1"><span class="command">have</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">n</span> <span class="main">.</span> 
       <span class="main">(</span><span class="main">∃</span> <span class="bound"><span class="bound">i0</span></span> <span class="main">&lt;</span> length <span class="main">(</span><span class="skolem">ft</span> <span class="bound">n</span><span class="main">)</span> <span class="main">.</span> <span class="main">∃</span><span class="bound">b</span><span class="main">.</span> 
        <span class="main">(</span><span class="main">&lt;⊥,</span> <span class="keyword1">outM</span> <span class="bound">b</span><span class="main">&gt;</span> <span class="main">∈#</span> <span class="free">sends</span> <span class="skolem">p</span> <span class="main">(</span>states <span class="main">(</span><span class="skolem">fe</span> <span class="bound">n</span> <span class="main">!</span> <span class="bound">i0</span><span class="main">)</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">(</span>unpackMessage <span class="main">(</span><span class="skolem">ft</span> <span class="bound">n</span> <span class="main">!</span> <span class="bound">i0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
       <span class="main">∧</span> isReceiverOf <span class="skolem">p</span> <span class="main">(</span><span class="skolem">ft</span> <span class="bound">n</span> <span class="main">!</span> <span class="bound">i0</span><span class="main">)</span><span class="main">)</span> 
      <span class="main">∨</span> <span class="main">(</span><span class="main">∀</span> <span class="bound"><span class="bound">n1</span></span> <span class="main">&gt;</span> <span class="bound">n</span> <span class="main">.</span> <span class="main">∀</span> <span class="bound">m</span> <span class="main">∈</span> <span class="main">(</span>set <span class="main">(</span>drop <span class="main">(</span>length <span class="main">(</span><span class="skolem">ft</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">ft</span> <span class="bound">n1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> 
        <span class="main">¬</span> isReceiverOf <span class="skolem">p</span> <span class="bound">m</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span> <span class="bound">n</span> <span class="main">.</span> <span class="main">∃</span> <span class="bound"><span class="bound">i0</span></span> <span class="main">&lt;</span> length <span class="main">(</span><span class="skolem">ft</span> <span class="bound">n</span><span class="main">)</span> <span class="main">.</span> 
         <span class="main">(</span><span class="main">∃</span><span class="bound">b</span><span class="main">.</span> <span class="main">(</span><span class="main">&lt;⊥,</span> <span class="keyword1">outM</span> <span class="bound">b</span><span class="main">&gt;</span> <span class="main">∈#</span> 
            <span class="free">sends</span> <span class="skolem">p</span> <span class="main">(</span>states <span class="main">(</span><span class="skolem">fe</span> <span class="bound">n</span> <span class="main">!</span> <span class="bound">i0</span><span class="main">)</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">(</span>unpackMessage <span class="main">(</span><span class="skolem">ft</span> <span class="bound">n</span> <span class="main">!</span> <span class="bound">i0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
          <span class="main">∧</span> isReceiverOf <span class="skolem">p</span> <span class="main">(</span><span class="skolem">ft</span> <span class="bound">n</span> <span class="main">!</span> <span class="bound">i0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
         <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">n</span> <span class="main">.</span><span class="main">∀</span> <span class="bound"><span class="bound">n1</span></span> <span class="main">&gt;</span> <span class="bound">n</span> <span class="main">.</span> <span class="main">∀</span> <span class="bound">m</span> <span class="main">∈</span> <span class="main">(</span>set <span class="main">(</span>drop <span class="main">(</span>length <span class="main">(</span><span class="skolem">ft</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">ft</span> <span class="bound">n1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">.</span>
           <span class="main">¬</span> isReceiverOf <span class="skolem">p</span> <span class="bound">m</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">n1</span></span><span class="main">&gt;</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">m</span> <span class="main">∈</span> <span class="main">(</span>set <span class="main">(</span>drop <span class="main">(</span>length <span class="main">(</span><span class="skolem">ft</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">ft</span> <span class="bound">n1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">.</span>
      <span class="main">(</span><span class="main">¬</span> <span class="main">(</span>isReceiverOf <span class="skolem">p</span> <span class="bound">m</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">elim</span> disjE<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span> <span class="skolem">i0</span> <span class="skolem">b</span>
      <span class="keyword3"><span class="command">assume</span></span> DecidingPoint<span class="main">:</span>
        <span class="quoted"><span class="quoted">"<span class="skolem">i0</span> <span class="main">&lt;</span> length <span class="main">(</span><span class="skolem">ft</span> <span class="skolem">n</span><span class="main">)</span>"</span></span>
        <span class="quoted"><span class="quoted">"isReceiverOf <span class="skolem">p</span> <span class="main">(</span><span class="skolem">ft</span> <span class="skolem">n</span> <span class="main">!</span> <span class="skolem">i0</span><span class="main">)</span>"</span></span>
        <span class="quoted"><span class="quoted">"<span class="main">&lt;⊥,</span> <span class="keyword1">outM</span> <span class="skolem">b</span><span class="main">&gt;</span> <span class="main">∈#</span> <span class="free">sends</span> <span class="skolem">p</span> <span class="main">(</span>states <span class="main">(</span><span class="skolem">fe</span> <span class="skolem">n</span> <span class="main">!</span> <span class="skolem">i0</span><span class="main">)</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">(</span>unpackMessage <span class="main">(</span><span class="skolem">ft</span> <span class="skolem">n</span> <span class="main">!</span> <span class="skolem">i0</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i0</span> <span class="main">&lt;</span> length <span class="main">(</span><span class="skolem">fe</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> DecidingPoint<span class="main">(</span>1<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> FE<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> execution.length<span class="main">)</span> 
      <span class="keyword1"><span class="command">hence</span></span> StepN0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="skolem">fe</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">!</span> <span class="skolem">i0</span><span class="main">)</span> <span class="main">⊢</span> <span class="main">(</span><span class="main">(</span><span class="skolem">ft</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">!</span> <span class="skolem">i0</span><span class="main">)</span> <span class="main">↦</span> <span class="main">(</span><span class="main">(</span><span class="skolem">fe</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">!</span> <span class="main">(</span><span class="skolem">i0</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> FE <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> execution.step<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"msgs <span class="main">(</span><span class="main">(</span><span class="skolem">fe</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">!</span> <span class="main">(</span><span class="skolem">i0</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;⊥,</span> <span class="keyword1">outM</span> <span class="skolem">b</span><span class="main">&gt;</span> 
        <span class="main">=</span> <span class="main">(</span>msgs <span class="main">(</span><span class="main">(</span><span class="skolem">fe</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">!</span> <span class="skolem">i0</span><span class="main">)</span> <span class="main">&lt;⊥,</span> <span class="keyword1">outM</span> <span class="skolem">b</span><span class="main">&gt;</span><span class="main">)</span> <span class="main">+</span>
        <span class="main">(</span><span class="free">sends</span> <span class="skolem">p</span> <span class="main">(</span>states <span class="main">(</span><span class="main">(</span><span class="skolem">fe</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">!</span> <span class="skolem">i0</span><span class="main">)</span> <span class="skolem">p</span><span class="main">)</span> 
        <span class="main">(</span>unpackMessage <span class="main">(</span><span class="main">(</span><span class="skolem">ft</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">!</span> <span class="skolem">i0</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;⊥,</span> <span class="keyword1">outM</span> <span class="skolem">b</span><span class="main">&gt;</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> DecidingPoint<span class="main">(</span>2<span class="main">)</span> OutOnlyGrowing<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">fe</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">!</span> <span class="skolem">i0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">ft</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">!</span> <span class="skolem">i0</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">fe</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">!</span> <span class="main">(</span><span class="skolem">i0</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span>"</span></span><span class="main">]</span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">sends</span> <span class="skolem">p</span> <span class="main">(</span>states <span class="main">(</span><span class="main">(</span><span class="skolem">fe</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">!</span> <span class="skolem">i0</span><span class="main">)</span> <span class="skolem">p</span><span class="main">)</span> 
        <span class="main">(</span>unpackMessage <span class="main">(</span><span class="main">(</span><span class="skolem">ft</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">!</span> <span class="skolem">i0</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;⊥,</span> <span class="keyword1">outM</span> <span class="skolem">b</span><span class="main">&gt;</span><span class="main">)</span> 
        <span class="main">≤</span> msgs <span class="main">(</span><span class="main">(</span><span class="skolem">fe</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">!</span> <span class="main">(</span><span class="skolem">i0</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;⊥,</span> <span class="keyword1">outM</span> <span class="skolem">b</span><span class="main">&gt;</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> asynchronousSystem.steps_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> OutMsgEx<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> msgs <span class="main">(</span><span class="main">(</span><span class="skolem">fe</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">!</span> <span class="main">(</span><span class="skolem">i0</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;⊥,</span> <span class="keyword1">outM</span> <span class="skolem">b</span><span class="main">&gt;</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> asynchronousSystem.steps_def DecidingPoint<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">i0</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">&lt;</span> length <span class="main">(</span><span class="skolem">fe</span> <span class="skolem">n</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> DecidingPoint<span class="main">(</span>1<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="skolem">i0</span> <span class="main">&lt;</span> length <span class="main">(</span><span class="skolem">fe</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"initReachable <span class="main">(</span><span class="main">(</span><span class="skolem">fe</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">!</span> <span class="main">(</span><span class="skolem">i0</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> AllExecsFromInit Cfg<span class="main">(</span>1<span class="main">)</span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> asynchronousSystem.initReachable_def<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> Decided<span class="main">:</span> <span class="quoted"><span class="quoted">"vDecided <span class="skolem">b</span> <span class="main">(</span><span class="main">(</span><span class="skolem">fe</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">!</span> <span class="main">(</span><span class="skolem">i0</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> OutMsgEx 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i0</span> <span class="main">+</span> <span class="main">1</span> <span class="main">&lt;</span> length <span class="main">(</span><span class="skolem">fe</span> <span class="skolem">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> DecidingPoint<span class="main">(</span>1<span class="main">)</span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="skolem">i0</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">(</span>length <span class="main">(</span>
          <span class="main">(</span><span class="skolem">fe</span><span class="main">::</span><span class="main">(</span>nat <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'p</span><span class="main">,</span> <span class="tfree">'v</span><span class="main">,</span> <span class="tfree">'s</span><span class="main">)</span> configuration list<span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">n</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>›</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> vDecided <span class="skolem">b</span> <span class="main">(</span><span class="main">(</span><span class="skolem">fe</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">!</span> <span class="main">(</span><span class="skolem">i0</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> NoDecided <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"False"</span></span> <span class="keyword1"><span class="command">using</span></span> Decided <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">n1</span></span><span class="main">&gt;</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">m</span> <span class="main">∈</span> <span class="main">(</span>set <span class="main">(</span>drop <span class="main">(</span>length <span class="main">(</span><span class="skolem">ft</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">ft</span> <span class="bound">n1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> 
        <span class="main">(</span><span class="main">¬</span> <span class="main">(</span>isReceiverOf <span class="skolem">p</span> <span class="bound">m</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="main">(</span><span class="bound">crashPoint</span><span class="main">::</span><span class="tfree">'p</span> <span class="main">⇒</span> nat<span class="main">)</span> <span class="main">.</span> 
    <span class="main">∀</span> <span class="bound">p</span> <span class="main">.</span> <span class="main">∃</span>  <span class="bound">n</span> <span class="main">.</span> <span class="bound">crashPoint</span> <span class="bound">p</span> <span class="main">=</span> <span class="bound">n</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span> <span class="bound"><span class="bound">n1</span></span> <span class="main">&gt;</span> <span class="bound">n</span> <span class="main">.</span> <span class="main">∀</span> <span class="bound">m</span> <span class="main">∈</span> <span class="main">(</span>set <span class="main">(</span>drop 
    <span class="main">(</span>length <span class="main">(</span><span class="skolem">ft</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">ft</span> <span class="bound">n1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">.</span> <span class="main">(</span><span class="main">¬</span> isReceiverOf <span class="bound">p</span> <span class="bound">m</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>  
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">crashPoint</span></span> <span class="keyword2"><span class="keyword">where</span></span> CrashPoint<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">p</span> <span class="main">.</span> <span class="main">(</span><span class="main">∀</span> <span class="bound"><span class="bound">n1</span></span> <span class="main">&gt;</span> <span class="main">(</span><span class="skolem">crashPoint</span> <span class="bound">p</span><span class="main">)</span> <span class="main">.</span> <span class="main">∀</span> <span class="bound">m</span> <span class="main">∈</span> <span class="main">(</span>set <span class="main">(</span>drop <span class="main">(</span>length 
    <span class="main">(</span><span class="skolem">ft</span> <span class="main">(</span><span class="skolem">crashPoint</span> <span class="bound">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">ft</span> <span class="bound">n1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">.</span> <span class="main">(</span><span class="main">¬</span> isReceiverOf <span class="bound">p</span> <span class="bound">m</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">limitSet</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">limitSet</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">crashPoint</span> <span class="bound">p</span> <span class="main">|</span> <span class="bound">p</span> <span class="main">.</span> <span class="bound">p</span> <span class="main">∈</span> Proc<span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound">p</span><span class="main">.</span> <span class="bound">p</span> <span class="main">∈</span> Proc<span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> finiteProcs <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">limitSet</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> limitSet_def finite_image_set<span class="main">[</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">limit</span> <span class="main">.</span> <span class="main">∀</span> <span class="bound">l</span> <span class="main">∈</span> <span class="skolem">limitSet</span> <span class="main">.</span> <span class="bound">l</span> <span class="main">&lt;</span> <span class="bound">limit</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> 
    finite_nat_set_iff_bounded <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">limit</span> <span class="main">.</span> <span class="main">∀</span> <span class="bound">p</span> <span class="main">.</span> <span class="main">(</span><span class="skolem">crashPoint</span> <span class="bound">p</span><span class="main">)</span> <span class="main">&lt;</span> <span class="bound">limit</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> limitSet_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">limit</span></span> <span class="keyword2"><span class="keyword">where</span></span> Limit<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">p</span> <span class="main">.</span> <span class="main">(</span><span class="skolem">crashPoint</span> <span class="bound">p</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">limit</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">lengthLimit</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">lengthLimit</span> <span class="main">=</span> length <span class="main">(</span><span class="skolem">ft</span> <span class="skolem">limit</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">lateMessage</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">lateMessage</span> <span class="main">=</span> last <span class="main">(</span><span class="skolem">ft</span> <span class="skolem">limit</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">lateMessage</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">ft</span> <span class="skolem">limit</span><span class="main">)</span> <span class="main">!</span> <span class="main">(</span>length <span class="main">(</span><span class="skolem">ft</span> <span class="skolem">limit</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> AllArePrefixesTrace Limit last_conv_nth less_nat_zero_code 
      list.size<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> PrefixListMonotonicity<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> LateIsLast<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">lateMessage</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">ft</span> <span class="skolem">limit</span><span class="main">)</span> <span class="main">!</span> <span class="skolem">lengthLimit</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> lateMessage_def lengthLimit_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">p</span> <span class="main">.</span> isReceiverOf <span class="bound">p</span> <span class="skolem">lateMessage</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="main">(</span><span class="bound">p</span><span class="main">::</span><span class="tfree">'p</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span>isReceiverOf <span class="bound">p</span> <span class="skolem">lateMessage</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> IsOutMsg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">v</span> <span class="main">.</span> <span class="skolem">lateMessage</span> <span class="main">=</span> <span class="main">&lt;⊥,</span> <span class="keyword1">outM</span> <span class="bound">v</span><span class="main">&gt;</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> isReceiverOf.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> isReceiverOf.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> message.exhaust<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"execution <span class="free">trans</span> <span class="free">sends</span> <span class="free">start</span> <span class="main">(</span><span class="skolem">fe</span> <span class="skolem">limit</span><span class="main">)</span> <span class="main">(</span><span class="skolem">ft</span> <span class="skolem">limit</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> FE 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="skolem">fe</span> <span class="skolem">limit</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span> <span class="main">=</span> length <span class="main">(</span><span class="skolem">ft</span> <span class="skolem">limit</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> execution.length <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">lengthLimit</span> <span class="main">&lt;</span> length <span class="main">(</span><span class="skolem">fe</span> <span class="skolem">limit</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> lengthLimit_def 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>hide_lams<span class="main"><span class="main">,</span></span> no_types<span class="main"><span class="main">)</span></span> Length Limit One_nat_def Suc_eq_plus1
        Suc_le_eq diff_less 
        diffs0_imp_equal gr_implies_not0 less_Suc0 neq0_conv<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="skolem">fe</span> <span class="skolem">limit</span><span class="main">)</span> <span class="main">!</span> <span class="skolem">lengthLimit</span><span class="main">)</span> <span class="main">⊢</span> <span class="main">(</span><span class="main">(</span><span class="skolem">ft</span> <span class="skolem">limit</span><span class="main">)</span> <span class="main">!</span> <span class="skolem">lengthLimit</span><span class="main">)</span> 
      <span class="main">↦</span> <span class="main">(</span><span class="main">(</span><span class="skolem">fe</span> <span class="skolem">limit</span><span class="main">)</span> <span class="main">!</span> <span class="main">(</span><span class="skolem">lengthLimit</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> FE <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> execution.step<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="skolem">fe</span> <span class="skolem">limit</span><span class="main">)</span> <span class="main">!</span> <span class="skolem">lengthLimit</span><span class="main">)</span> <span class="main">⊢</span> <span class="skolem">lateMessage</span> <span class="main">↦</span> <span class="main">(</span><span class="main">(</span><span class="skolem">fe</span> <span class="skolem">limit</span><span class="main">)</span> <span class="main">!</span> 
      <span class="main">(</span><span class="skolem">lengthLimit</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> LateIsLast <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> IsOutMsg steps_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> ReceiverOfLate<span class="main">:</span> <span class="quoted"><span class="quoted">"isReceiverOf <span class="skolem">p</span> <span class="skolem">lateMessage</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound"><span class="bound">n1</span></span> <span class="main">&gt;</span> <span class="main">(</span><span class="skolem">crashPoint</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">.</span> 
    <span class="main">∀</span> <span class="bound">m</span> <span class="main">∈</span> <span class="main">(</span>set <span class="main">(</span>drop <span class="main">(</span>length <span class="main">(</span><span class="skolem">ft</span> <span class="main">(</span><span class="skolem">crashPoint</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">ft</span> <span class="bound">n1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">.</span> 
      <span class="main">(</span><span class="main">¬</span> isReceiverOf <span class="skolem">p</span> <span class="bound">m</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> CrashPoint
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> NoMsgAfterLimit<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">m</span> <span class="main">∈</span> <span class="main">(</span>set <span class="main">(</span>drop <span class="main">(</span>length <span class="main">(</span><span class="skolem">ft</span> <span class="main">(</span><span class="skolem">crashPoint</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
    <span class="main">(</span><span class="skolem">ft</span> <span class="skolem">limit</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">.</span> <span class="main">(</span><span class="main">¬</span> isReceiverOf <span class="skolem">p</span> <span class="bound">m</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Limit
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">lateMessage</span> <span class="main">∈</span> set <span class="main">(</span>drop <span class="main">(</span>length<span class="main">(</span><span class="skolem">ft</span> <span class="main">(</span><span class="skolem">crashPoint</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">ft</span> <span class="skolem">limit</span><span class="main">)</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">crashPoint</span> <span class="skolem">p</span> <span class="main">&lt;</span> <span class="skolem">limit</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Limit <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"prefixList <span class="main">(</span><span class="skolem">ft</span> <span class="main">(</span><span class="skolem">crashPoint</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">ft</span> <span class="skolem">limit</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> AllArePrefixesTrace <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> CrashShorterLimit<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="skolem">ft</span> <span class="main">(</span><span class="skolem">crashPoint</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> 
      <span class="main">&lt;</span> length <span class="main">(</span><span class="skolem">ft</span> <span class="skolem">limit</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> PrefixListMonotonicity <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"last <span class="main">(</span>drop <span class="main">(</span>length <span class="main">(</span><span class="skolem">ft</span> <span class="main">(</span><span class="skolem">crashPoint</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">ft</span> <span class="skolem">limit</span><span class="main">)</span><span class="main">)</span> 
      <span class="main">=</span> last <span class="main">(</span><span class="skolem">ft</span> <span class="skolem">limit</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> last_drop<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">lateMessage</span> <span class="main">=</span> last <span class="main">(</span>drop <span class="main">(</span>length <span class="main">(</span><span class="skolem">ft</span> <span class="main">(</span><span class="skolem">crashPoint</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
      <span class="main">(</span><span class="skolem">ft</span> <span class="skolem">limit</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> lateMessage_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">lateMessage</span> <span class="main">∈</span> set <span class="main">(</span>drop <span class="main">(</span>length<span class="main">(</span><span class="skolem">ft</span> <span class="main">(</span><span class="skolem">crashPoint</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">ft</span> <span class="skolem">limit</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> CrashShorterLimit drop_eq_Nil last_in_set not_le<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> isReceiverOf <span class="skolem">p</span> <span class="skolem">lateMessage</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> NoMsgAfterLimit <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"False"</span></span> <span class="keyword1"><span class="command">using</span></span> ReceiverOfLate <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="FLPExistingSystem">
<div class="head">
<h1>Theory FLPExistingSystem</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹An Existing FLPSystem›</span></span>

<span class="keyword1"><span class="command">theory</span></span> FLPExistingSystem
<span class="keyword2"><span class="keyword">imports</span></span> <a href="FLPTheorem.html">FLPTheorem</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  We define an example FLPSystem with some example execution to show that the
  locales employed are not void. (If they were, the consensus impossibility
  result would be trivial.)
›</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹System definition›</span></span>

<span class="keyword1"><span class="command">datatype</span></span> proc <span class="main">=</span> p0 <span class="main">|</span> p1
<span class="keyword1"><span class="command">datatype</span></span> state <span class="main">=</span> s0 <span class="main">|</span> s1
<span class="keyword1"><span class="command">datatype</span></span> val <span class="main">=</span> v0 <span class="main">|</span> v1

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">trans</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"proc <span class="main">⇒</span> state <span class="main">⇒</span> val messageValue <span class="main">⇒</span> state"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">trans</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> s0 <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">=</span> s1"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">trans</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> s1 <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">=</span> s0"</span></span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">sends</span> <span class="main">::</span>
  <span class="quoted"><span class="quoted">"proc <span class="main">⇒</span> state <span class="main">⇒</span> val messageValue <span class="main">⇒</span> <span class="main">(</span>proc<span class="main">,</span> val<span class="main">)</span> message multiset"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">sends</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> s0 <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">=</span> <span class="main">{#</span> <span class="main">&lt;</span>p0<span class="main">,</span> v1<span class="main">&gt;</span> <span class="main">}</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">sends</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> s1 <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">=</span> <span class="main">{#</span> <span class="main">&lt;</span>p1<span class="main">,</span> v0<span class="main">&gt;</span> <span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">start</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"proc <span class="main">⇒</span> state"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">start</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span>  <span class="main">≡</span> s0"</span></span>

<span class="comment1">― ‹An example execution›</span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">exec</span> <span class="main">::</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span>proc<span class="main">,</span> val<span class="main">,</span> state <span class="main">)</span> configuration list"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  exec_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">exec</span> <span class="main">≡</span> <span class="main">[</span> <span class="main">⦇</span> 
    states <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> s0<span class="main">)</span><span class="main">,</span>
    msgs <span class="main">=</span> <span class="main">(</span><span class="main">{#</span> <span class="main">&lt;</span>p0<span class="main">,</span> <span class="keyword1">inM</span> True<span class="main">&gt;</span> <span class="main">}</span> <span class="main">∪#</span> <span class="main">{#</span> <span class="main">&lt;</span>p1<span class="main">,</span> <span class="keyword1">inM</span> True<span class="main">&gt;</span> <span class="main">}</span><span class="main">)</span> <span class="main">⦈</span> <span class="main">]</span>"</span></span>

<span class="keyword1" id="FLPExistingSystem-ProcUniv"><span class="command">lemma</span></span> ProcUniv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>UNIV <span class="main">::</span> proc set<span class="main">)</span> <span class="main">=</span> <span class="main">{</span>p0<span class="main">,</span> p1<span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> UNIV_eq_I insert_iff proc.exhaust<span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Interpretation as FLP Locale›</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> FLPSys<span class="main">:</span> flpSystem <span class="quoted">trans</span> <span class="quoted">sends</span> <span class="quoted">start</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="comment1">― ‹finiteProcs›</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>UNIV <span class="main">::</span> proc set<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> ProcUniv <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="comment1">― ‹minimalProcs›</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>UNIV <span class="main">::</span> proc set<span class="main">)</span> <span class="main">=</span> <span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> ProcUniv <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">≤</span> card <span class="main">(</span>UNIV <span class="main">::</span> proc set<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="comment1">― ‹finiteSends›</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span> <span class="skolem">s</span> <span class="skolem">m</span>
  <span class="keyword1"><span class="command">have</span></span> FinExplSends<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="main">&lt;</span>p0<span class="main">,</span> v1<span class="main">&gt;</span><span class="main">,</span> <span class="main">&lt;</span>p1<span class="main">,</span> v0<span class="main">&gt;</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">v</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> sends <span class="skolem">p</span> <span class="skolem">s</span> <span class="skolem">m</span> <span class="bound">v</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">&lt;</span>p0<span class="main">,</span> v1<span class="main">&gt;</span><span class="main">,</span> <span class="main">&lt;</span>p1<span class="main">,</span> v0<span class="main">&gt;</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≠</span> <span class="main">&lt;</span>p0<span class="main">,</span> v1<span class="main">&gt;</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> sends <span class="skolem">p</span> <span class="skolem">s</span> <span class="skolem">m</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="main">&lt;</span>p1<span class="main">,</span> v0<span class="main">&gt;</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> neq0_conv sends.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>2<span class="main"><span class="main">)</span></span> state.exhaust<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound">v</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> sends <span class="skolem">p</span> <span class="skolem">s</span> <span class="skolem">m</span> <span class="bound">v</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> FinExplSends finite_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="comment1">― ‹noInSends›</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span> <span class="skolem">s</span> <span class="skolem">m</span> <span class="skolem">p2</span> <span class="skolem">v</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"sends <span class="skolem">p</span> <span class="skolem">s</span> <span class="skolem">m</span> <span class="main">&lt;</span><span class="skolem">p2</span><span class="main">,</span> <span class="keyword1">inM</span> <span class="skolem">v</span><span class="main">&gt;</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">s</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> FLPExec<span class="main">:</span> execution <span class="quoted">trans</span> <span class="quoted">sends</span> <span class="quoted">start</span> <span class="quoted">exec</span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="comment1">― ‹notEmpty›</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">≤</span> length exec"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>exec_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="comment1">― ‹length›</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"length exec <span class="main">-</span> <span class="main">1</span> <span class="main">=</span> length <span class="main">[]</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>exec_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="comment1">― ‹base›</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"asynchronousSystem.initial start <span class="main">(</span>hd exec<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> asynchronousSystem.initial_def isReceiverOf_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> start_def exec_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> proc.exhaust<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="comment1">― ‹step›</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">cfg1</span> <span class="skolem">cfg2</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length exec <span class="main">-</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"False"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>exec_def<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"asynchronousSystem.steps FLPExistingSystem.trans sends <span class="skolem">cfg1</span> <span class="main">(</span><span class="main">[]</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span> <span class="skolem">cfg2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">rule</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div>