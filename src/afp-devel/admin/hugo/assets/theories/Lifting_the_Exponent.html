<div id="LTE">
<div class="head">
<h1>Theory LTE</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> LTE
  <span class="keyword2"><span class="keyword">imports</span></span>
    <span class="quoted">"<a href="https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL-Number_Theory/Number_Theory.html">HOL-Number_Theory.Number_Theory</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">"Library additions"</span></span>

<span class="keyword1" id="LTE-cong_sum_mono_neutral_right"><span class="command">lemma</span></span> cong_sum_mono_neutral_right<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">T</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">⊆</span> <span class="free">T</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> zeros<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span> <span class="main">∈</span> <span class="free">T</span> <span class="main">-</span> <span class="free">S</span><span class="main">.</span> <span class="main">[</span><span class="free">g</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">0</span><span class="main">]</span> <span class="main">(</span><span class="keyword1">mod</span> <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span>sum <span class="free">g</span> <span class="free">T</span> <span class="main">=</span> sum <span class="free">g</span> <span class="free">S</span><span class="main">]</span> <span class="main">(</span><span class="keyword1">mod</span> <span class="free">n</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span>sum <span class="free">g</span> <span class="free">T</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="free">T</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">S</span> <span class="keyword1">then</span> <span class="free">g</span> <span class="bound">x</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span><span class="main">]</span> <span class="main">(</span><span class="keyword1">mod</span> <span class="free">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> zeros <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> cong_sum<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="free">T</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">S</span> <span class="keyword1">then</span> <span class="free">g</span> <span class="bound">x</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="free">S</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">S</span> <span class="keyword1">then</span> <span class="free">g</span> <span class="bound">x</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.mono_neutral_right<span class="main"><span class="keyword3">;</span></span> <span class="operator">fact</span><span class="main"><span class="keyword3">?</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> sum <span class="free">g</span> <span class="free">S</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> sum.cong<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span><span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="LTE-power_odd_inj"><span class="command">lemma</span></span> power_odd_inj<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">a</span> <span class="free">b</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>linordered_idom"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"odd <span class="free">k</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">^</span><span class="free">k</span> <span class="main">=</span> <span class="free">b</span><span class="main">^</span><span class="free">k</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> <span class="free">b</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≥</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms zero_le_odd_power <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">`odd <span class="free">k</span>`</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> power_eq_imp_eq_base<span class="main"><span class="keyword3">;</span></span> <span class="operator">fact</span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms power_less_zero_eq not_less <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span> 
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">`<span class="free">a</span><span class="main">^</span><span class="free">k</span> <span class="main">=</span> <span class="free">b</span><span class="main">^</span><span class="free">k</span>`</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">-</span><span class="free">a</span><span class="main">)</span><span class="main">^</span><span class="free">k</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span><span class="free">b</span><span class="main">)</span><span class="main">^</span><span class="free">k</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">`odd <span class="free">k</span>`</span></span> power_minus_odd <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="free">a</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="free">b</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">`<span class="main">¬</span> <span class="free">a</span> <span class="main">≥</span> <span class="main">0</span>`</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">`<span class="free">b</span> <span class="main">&lt;</span> <span class="main">0</span>`</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">`odd <span class="free">k</span>`</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="free">a</span> <span class="main">=</span> <span class="main">-</span><span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> power_eq_imp_eq_base<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="LTE-power_eq_abs"><span class="command">lemma</span></span> power_eq_abs<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">a</span> <span class="free">b</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>linordered_idom"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">^</span><span class="free">k</span> <span class="main">=</span> <span class="free">b</span><span class="main">^</span><span class="free">k</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="free">a</span><span class="main">¦</span> <span class="main">=</span> <span class="main">¦</span><span class="free">b</span><span class="main">¦</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">`<span class="free">a</span><span class="main">^</span><span class="free">k</span> <span class="main">=</span> <span class="free">b</span><span class="main">^</span><span class="free">k</span>`</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="free">a</span><span class="main">¦</span><span class="main">^</span><span class="free">k</span> <span class="main">=</span> <span class="main">¦</span><span class="free">b</span><span class="main">¦</span><span class="main">^</span><span class="free">k</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> power_abs <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="free">a</span><span class="main">¦</span> <span class="main">=</span> <span class="main">¦</span><span class="free">b</span><span class="main">¦</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> power_eq_imp_eq_base<span class="main"><span class="keyword3">;</span></span> <span class="operator">fact</span><span class="main"><span class="keyword3">?</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="LTE-cong_scale"><span class="command">lemma</span></span> cong_scale<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> <span class="main">[</span><span class="free">a</span> <span class="main">=</span> <span class="free">b</span><span class="main">]</span> <span class="main">(</span><span class="keyword1">mod</span> <span class="free">c</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">[</span><span class="free">k</span><span class="main">*</span><span class="free">a</span> <span class="main">=</span> <span class="free">k</span><span class="main">*</span><span class="free">b</span><span class="main">]</span> <span class="main">(</span><span class="keyword1">mod</span> <span class="free">k</span><span class="main">*</span><span class="free">c</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> cong_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="LTE-odd_square_mod_4"><span class="command">lemma</span></span> odd_square_mod_4<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="main">::</span> <span class="quoted">int</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"odd <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">x</span><span class="main">^</span><span class="numeral">2</span> <span class="main">=</span> <span class="main">1</span><span class="main">]</span> <span class="main">(</span><span class="keyword1">mod</span> <span class="numeral">4</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">^</span><span class="numeral">2</span> <span class="main">-</span> <span class="main">1</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ring_distribs power2_eq_square<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">`odd <span class="free">x</span>`</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="keyword1">dvd</span> <span class="free">x</span> <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="keyword1">dvd</span> <span class="free">x</span> <span class="main">+</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">4</span> <span class="keyword1">dvd</span> <span class="free">x</span><span class="main">^</span><span class="numeral">2</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cong_iff_dvd_diff<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹The <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>p &gt; 2›</span></span></span></span> case›</span></span>

<span class="keyword1"><span class="command">context</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="free">y</span> <span class="main">::</span> <span class="quoted">int</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">p</span> <span class="main">::</span> <span class="quoted">nat</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"prime <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="keyword1">dvd</span> <span class="free">x</span> <span class="main">-</span> <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="free">p</span> <span class="keyword1">dvd</span> <span class="free">x</span>"</span></span>   <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="free">p</span> <span class="keyword1">dvd</span> <span class="free">y</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="LTE-decompose_mod_p"><span class="command">lemma</span></span> decompose_mod_p<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> <span class="free">y</span><span class="main">^</span><span class="main">(</span><span class="free">n</span> <span class="main">-</span> Suc <span class="bound">i</span><span class="main">)</span> <span class="main">*</span> <span class="free">x</span><span class="main">^</span><span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="free">n</span><span class="main">*</span><span class="free">x</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">]</span> <span class="main">(</span><span class="keyword1">mod</span> <span class="free">p</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">`<span class="free">p</span> <span class="keyword1">dvd</span> <span class="free">x</span> <span class="main">-</span> <span class="free">y</span>`</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">x</span> <span class="main">=</span> <span class="free">y</span><span class="main">]</span> <span class="main">(</span><span class="keyword1">mod</span> <span class="free">p</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cong_iff_dvd_diff<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">y</span><span class="main">^</span><span class="main">(</span><span class="free">n</span> <span class="main">-</span> Suc <span class="skolem">i</span><span class="main">)</span> <span class="main">*</span> <span class="free">x</span><span class="main">^</span><span class="skolem">i</span> <span class="main">=</span> <span class="free">x</span><span class="main">^</span><span class="main">(</span><span class="free">n</span> <span class="main">-</span> Suc <span class="skolem">i</span><span class="main">)</span> <span class="main">*</span> <span class="free">x</span><span class="main">^</span><span class="skolem">i</span><span class="main">]</span> <span class="main">(</span><span class="keyword1">mod</span> <span class="free">p</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> cong_scalar_right cong_pow<span class="main"><span class="keyword3">;</span></span> <span class="operator">rule</span> cong_sym<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">^</span><span class="main">(</span><span class="free">n</span> <span class="main">-</span> Suc <span class="skolem">i</span><span class="main">)</span> <span class="main">*</span> <span class="free">x</span><span class="main">^</span><span class="skolem">i</span> <span class="main">=</span> <span class="free">x</span><span class="main">^</span><span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">`<span class="skolem">i</span> <span class="main">&lt;</span> <span class="free">n</span>`</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> power_add<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">y</span><span class="main">^</span><span class="main">(</span><span class="free">n</span> <span class="main">-</span> Suc <span class="skolem">i</span><span class="main">)</span> <span class="main">*</span> <span class="free">x</span><span class="main">^</span><span class="skolem">i</span> <span class="main">=</span> <span class="free">x</span><span class="main">^</span><span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">]</span> <span class="main">(</span><span class="keyword1">mod</span> <span class="free">p</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> <span class="free">y</span><span class="main">^</span><span class="main">(</span><span class="free">n</span> <span class="main">-</span> Suc <span class="bound">i</span><span class="main">)</span> <span class="main">*</span> <span class="free">x</span><span class="main">^</span><span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> <span class="free">x</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">]</span> <span class="main">(</span><span class="keyword1">mod</span> <span class="free">p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> cong_sum<span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> <span class="free">y</span><span class="main">^</span><span class="main">(</span><span class="free">n</span> <span class="main">-</span> Suc <span class="bound">i</span><span class="main">)</span> <span class="main">*</span> <span class="free">x</span><span class="main">^</span><span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="free">n</span> <span class="main">*</span> <span class="free">x</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">]</span> <span class="main">(</span><span class="keyword1">mod</span> <span class="free">p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Lemma 1:›</span></span>

<span class="keyword1" id="LTE-multiplicity_diff_pow_coprime"><span class="command">lemma</span></span> multiplicity_diff_pow_coprime<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"coprime <span class="free">p</span> <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"multiplicity <span class="free">p</span> <span class="main">(</span><span class="free">x</span><span class="main">^</span><span class="free">n</span> <span class="main">-</span> <span class="free">y</span><span class="main">^</span><span class="free">n</span><span class="main">)</span> <span class="main">=</span> multiplicity <span class="free">p</span> <span class="main">(</span><span class="free">x</span> <span class="main">-</span> <span class="free">y</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> factor<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">^</span><span class="free">n</span> <span class="main">-</span> <span class="free">y</span><span class="main">^</span><span class="free">n</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> <span class="free">y</span><span class="main">^</span><span class="main">(</span><span class="free">n</span> <span class="main">-</span> Suc <span class="bound">i</span><span class="main">)</span> <span class="main">*</span> <span class="free">x</span><span class="main">^</span><span class="bound">i</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="main">-</span> <span class="free">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power_diff_sumr2<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">p</span> <span class="keyword1">dvd</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> <span class="free">y</span><span class="main">^</span><span class="main">(</span><span class="free">n</span> <span class="main">-</span> Suc <span class="bound">i</span><span class="main">)</span> <span class="main">*</span> <span class="free">x</span><span class="main">^</span><span class="bound">i</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="keyword1">dvd</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> <span class="free">y</span><span class="main">^</span><span class="main">(</span><span class="free">n</span> <span class="main">-</span> Suc <span class="bound">i</span><span class="main">)</span> <span class="main">*</span> <span class="free">x</span><span class="main">^</span><span class="bound">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> decompose_mod_p <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="keyword1">dvd</span> <span class="free">n</span> <span class="main">*</span> <span class="free">x</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="main">1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> cong_dvd_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">`prime <span class="free">p</span>`</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="keyword1">dvd</span> <span class="free">n</span> <span class="main">∨</span> <span class="free">p</span> <span class="keyword1">dvd</span> <span class="free">x</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="main">1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prime_dvd_mult_eq_int<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">`coprime <span class="free">p</span> <span class="free">n</span>`</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">`prime <span class="free">p</span>`</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="free">p</span> <span class="keyword1">dvd</span> <span class="free">n</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> coprime_absorb_right not_prime_unit <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="keyword1">dvd</span> <span class="free">x</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="main">1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="keyword1">dvd</span> <span class="free">x</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">`prime <span class="free">p</span>`</span></span> prime_dvd_power_int prime_nat_int_transfer <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">`<span class="main">¬</span><span class="free">p</span> <span class="keyword1">dvd</span> <span class="free">x</span>`</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"multiplicity <span class="free">p</span> <span class="main">(</span><span class="free">x</span><span class="main">^</span><span class="free">n</span> <span class="main">-</span> <span class="free">y</span><span class="main">^</span><span class="free">n</span><span class="main">)</span> <span class="main">=</span> multiplicity <span class="free">p</span> <span class="main">(</span><span class="free">x</span> <span class="main">-</span> <span class="free">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">`prime <span class="free">p</span>`</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> multiplicity_prime_elem_times_other<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>  

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The inductive step:›</span></span>

<span class="keyword1" id="LTE-multiplicity_diff_self_pow"><span class="command">lemma</span></span> multiplicity_diff_self_pow<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">&gt;</span> <span class="numeral">2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"multiplicity <span class="free">p</span> <span class="main">(</span><span class="free">x</span><span class="main">^</span><span class="free">p</span> <span class="main">-</span> <span class="free">y</span><span class="main">^</span><span class="free">p</span><span class="main">)</span> <span class="main">=</span> Suc <span class="main">(</span>multiplicity <span class="free">p</span> <span class="main">(</span><span class="free">x</span> <span class="main">-</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"multiplicity <span class="free">p</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="free">p</span><span class="main">.</span> <span class="free">y</span><span class="main">^</span><span class="main">(</span><span class="free">p</span> <span class="main">-</span> Suc <span class="bound">i</span><span class="main">)</span> <span class="main">*</span> <span class="free">x</span><span class="main">^</span><span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> multiplicity_eqI<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="main">(</span><span class="main">∑</span><span class="bound">t</span><span class="main">&lt;</span><span class="free">p</span><span class="main">.</span> <span class="free">y</span><span class="main">^</span><span class="main">(</span><span class="free">p</span> <span class="main">-</span> Suc <span class="bound">t</span><span class="main">)</span> <span class="main">*</span> <span class="free">x</span><span class="main">^</span><span class="bound">t</span><span class="main">)</span> <span class="main">=</span> <span class="free">p</span> <span class="main">*</span> <span class="free">x</span><span class="main">^</span><span class="main">(</span><span class="free">p</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">]</span> <span class="main">(</span><span class="keyword1">mod</span> <span class="free">p</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> decompose_mod_p<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">p</span> <span class="main">*</span> <span class="free">x</span><span class="main">^</span><span class="main">(</span><span class="free">p</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span><span class="main">]</span> <span class="main">(</span><span class="keyword1">mod</span> <span class="free">p</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cong_mult_self_left<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>int <span class="free">p</span><span class="main">)</span><span class="main">^</span><span class="main">1</span> <span class="keyword1">dvd</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="free">p</span><span class="main">.</span> <span class="free">y</span><span class="main">^</span><span class="main">(</span><span class="free">p</span> <span class="main">-</span> Suc <span class="bound">i</span><span class="main">)</span> <span class="main">*</span> <span class="free">x</span><span class="main">^</span><span class="bound">i</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cong_0_iff<span class="main">)</span>

    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">`<span class="free">p</span> <span class="keyword1">dvd</span> <span class="free">x</span> <span class="main">-</span> <span class="free">y</span>`</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span><span class="main">::</span><span class="quoted">int</span> <span class="keyword2"><span class="keyword">where</span></span> kp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="free">y</span> <span class="main">+</span> <span class="skolem">k</span> <span class="main">*</span> <span class="free">p</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add.commute diff_add_cancel dvd_def mult.commute<span class="main">)</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">y</span><span class="main">^</span><span class="main">(</span><span class="free">p</span> <span class="main">-</span> Suc <span class="skolem">t</span><span class="main">)</span> <span class="main">*</span> <span class="free">x</span><span class="main">^</span><span class="skolem">t</span> <span class="main">=</span> <span class="free">y</span><span class="main">^</span><span class="main">(</span><span class="free">p</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">t</span><span class="main">*</span><span class="skolem">k</span><span class="main">*</span><span class="free">p</span><span class="main">*</span><span class="free">y</span><span class="main">^</span><span class="main">(</span><span class="free">p</span><span class="main">-</span><span class="numeral">2</span><span class="main">)</span><span class="main">]</span> <span class="main">(</span><span class="keyword1">mod</span> <span class="free">p</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">&lt;</span> <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">t</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span><span class="main">^</span><span class="main">(</span><span class="free">p</span> <span class="main">-</span> Suc <span class="skolem">t</span><span class="main">)</span> <span class="main">*</span> <span class="free">x</span><span class="main">^</span><span class="skolem">t</span> <span class="main">=</span> <span class="free">y</span><span class="main">^</span><span class="main">(</span><span class="free">p</span> <span class="main">-</span> Suc <span class="skolem">t</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">y</span> <span class="main">+</span> <span class="skolem">k</span><span class="main">*</span><span class="free">p</span><span class="main">)</span><span class="main">^</span><span class="skolem">t</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> kp<span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">y</span><span class="main">^</span><span class="main">(</span><span class="free">p</span> <span class="main">-</span> Suc <span class="skolem">t</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">≤</span><span class="skolem">t</span><span class="main">.</span> <span class="main">(</span><span class="skolem">t</span> <span class="keyword1">choose</span> <span class="bound">i</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">k</span><span class="main">*</span><span class="free">p</span><span class="main">)</span><span class="main">^</span><span class="bound">i</span> <span class="main">*</span> <span class="free">y</span><span class="main">^</span><span class="main">(</span><span class="skolem">t</span><span class="main">-</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> binomial_ring <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add.commute<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="main">...</span> <span class="main">=</span> <span class="free">y</span><span class="main">^</span><span class="main">(</span><span class="free">p</span> <span class="main">-</span> Suc <span class="skolem">t</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">≤</span><span class="main">1</span><span class="main">.</span> <span class="main">(</span><span class="skolem">t</span> <span class="keyword1">choose</span> <span class="bound">i</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">k</span><span class="main">*</span><span class="free">p</span><span class="main">)</span><span class="main">^</span><span class="bound">i</span> <span class="main">*</span> <span class="free">y</span><span class="main">^</span><span class="main">(</span><span class="skolem">t</span><span class="main">-</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">]</span> <span class="main">(</span><span class="keyword1">mod</span> <span class="free">p</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span>"</span></span>
        <span class="comment1">― ‹discard <span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>i &gt; 1›</span></span>›</span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> cong_scalar_left cong_sum_mono_neutral_right<span class="main"><span class="keyword3">;</span></span> <span class="operator">rule</span><span class="main">)</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="main">{..</span><span class="skolem">t</span><span class="main">}</span> <span class="main">-</span> <span class="main">{..</span><span class="main">1</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≥</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">=</span> <span class="skolem">i'</span> <span class="main">+</span> <span class="numeral">2</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> add.commute le_Suc_ex <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">k</span><span class="main">*</span><span class="free">p</span><span class="main">)</span><span class="main">^</span><span class="skolem">i</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">k</span><span class="main">*</span><span class="free">p</span><span class="main">)</span><span class="main">^</span><span class="skolem">i'</span> <span class="main">*</span> <span class="skolem">k</span><span class="main">^</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">p</span><span class="main">^</span><span class="numeral">2</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">ac_simps</span></span> power2_eq_square<span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="main">(</span><span class="skolem">k</span><span class="main">*</span><span class="free">p</span><span class="main">)</span><span class="main">^</span><span class="skolem">i</span> <span class="main">=</span> <span class="main">0</span><span class="main">]</span> <span class="main">(</span><span class="keyword1">mod</span> <span class="free">p</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cong_mult_self_right<span class="main">)</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="main">(</span><span class="skolem">t</span> <span class="keyword1">choose</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">k</span><span class="main">*</span><span class="free">p</span><span class="main">)</span><span class="main">^</span><span class="skolem">i</span> <span class="main">*</span> <span class="free">y</span><span class="main">^</span><span class="main">(</span><span class="skolem">t</span><span class="main">-</span><span class="skolem">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span><span class="main">]</span> <span class="main">(</span><span class="keyword1">mod</span> <span class="free">p</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cong_0_iff<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> <span class="quoted"><span class="quoted">`<span class="skolem">t</span> <span class="main">≠</span> <span class="main">0</span>`</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">≤</span><span class="main">1</span><span class="main">.</span> <span class="main">(</span><span class="skolem">t</span> <span class="keyword1">choose</span> <span class="bound">i</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">k</span><span class="main">*</span><span class="free">p</span><span class="main">)</span><span class="main">^</span><span class="bound">i</span> <span class="main">*</span> <span class="free">y</span><span class="main">^</span><span class="main">(</span><span class="skolem">t</span><span class="main">-</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">y</span><span class="main">^</span><span class="skolem">t</span> <span class="main">+</span> <span class="skolem">t</span><span class="main">*</span><span class="skolem">k</span><span class="main">*</span><span class="free">p</span><span class="main">*</span><span class="free">y</span><span class="main">^</span><span class="main">(</span><span class="skolem">t</span><span class="main">-</span><span class="main">1</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span><span class="main">^</span><span class="main">(</span><span class="free">p</span> <span class="main">-</span> Suc <span class="skolem">t</span><span class="main">)</span> <span class="main">*</span> <span class="main">...</span> <span class="main">=</span> <span class="free">y</span><span class="main">^</span><span class="main">(</span><span class="free">p</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">t</span><span class="main">*</span><span class="skolem">k</span><span class="main">*</span><span class="free">p</span><span class="main">*</span><span class="free">y</span><span class="main">^</span><span class="main">(</span><span class="free">p</span><span class="main">-</span><span class="numeral">2</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">`<span class="skolem">t</span> <span class="main">&lt;</span> <span class="free">p</span>`</span></span> <span class="quoted"><span class="quoted">`<span class="skolem">t</span> <span class="main">≠</span> <span class="main">0</span>`</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span> numeral_eq_Suc <span class="quasi_keyword">simp</span> <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> power_add<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span><span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>

    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="main">(</span><span class="main">∑</span><span class="bound">t</span><span class="main">&lt;</span><span class="free">p</span><span class="main">.</span> <span class="free">y</span><span class="main">^</span><span class="main">(</span><span class="free">p</span> <span class="main">-</span> Suc <span class="bound">t</span><span class="main">)</span> <span class="main">*</span> <span class="free">x</span><span class="main">^</span><span class="bound">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">t</span><span class="main">&lt;</span><span class="free">p</span><span class="main">.</span> <span class="free">y</span><span class="main">^</span><span class="main">(</span><span class="free">p</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">+</span> <span class="bound">t</span><span class="main">*</span><span class="skolem">k</span><span class="main">*</span><span class="free">p</span><span class="main">*</span><span class="free">y</span><span class="main">^</span><span class="main">(</span><span class="free">p</span><span class="main">-</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">]</span> <span class="main">(</span><span class="keyword1">mod</span> <span class="free">p</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> cong_sum<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">t</span><span class="main">&lt;</span><span class="free">p</span><span class="main">.</span> <span class="free">y</span><span class="main">^</span><span class="main">(</span><span class="free">p</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">+</span> <span class="bound">t</span><span class="main">*</span><span class="skolem">k</span><span class="main">*</span><span class="free">p</span><span class="main">*</span><span class="free">y</span><span class="main">^</span><span class="main">(</span><span class="free">p</span><span class="main">-</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">p</span><span class="main">*</span><span class="free">y</span><span class="main">^</span><span class="main">(</span><span class="free">p</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">t</span><span class="main">&lt;</span><span class="free">p</span><span class="main">.</span> <span class="bound">t</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">k</span><span class="main">*</span><span class="free">p</span><span class="main">*</span><span class="free">y</span><span class="main">^</span><span class="main">(</span><span class="free">p</span><span class="main">-</span><span class="numeral">2</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum.distrib sum_distrib_right<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">t</span><span class="main">&lt;</span><span class="free">p</span><span class="main">.</span> <span class="bound">t</span><span class="main">)</span> <span class="main">=</span> <span class="free">p</span><span class="main">*</span><span class="main">(</span><span class="free">p</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">div</span> <span class="numeral">2</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Sum_Ico_nat lessThan_atLeast0<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="main">(</span><span class="main">∑</span><span class="bound">t</span><span class="main">&lt;</span><span class="free">p</span><span class="main">.</span> <span class="free">y</span><span class="main">^</span><span class="main">(</span><span class="free">p</span> <span class="main">-</span> Suc <span class="bound">t</span><span class="main">)</span> <span class="main">*</span> <span class="free">x</span><span class="main">^</span><span class="bound">t</span><span class="main">)</span> <span class="main">=</span> <span class="free">p</span><span class="main">*</span><span class="free">y</span><span class="main">^</span><span class="main">(</span><span class="free">p</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="free">p</span><span class="main">*</span><span class="main">(</span><span class="free">p</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">k</span><span class="main">*</span><span class="free">p</span><span class="main">*</span><span class="free">y</span><span class="main">^</span><span class="main">(</span><span class="free">p</span><span class="main">-</span><span class="numeral">2</span><span class="main">)</span><span class="main">]</span> <span class="main">(</span><span class="keyword1">mod</span> <span class="free">p</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span>"</span></span><span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="main">(</span><span class="free">p</span><span class="main">*</span><span class="main">(</span><span class="free">p</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">k</span><span class="main">*</span><span class="free">p</span><span class="main">*</span><span class="free">y</span><span class="main">^</span><span class="main">(</span><span class="free">p</span><span class="main">-</span><span class="numeral">2</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span><span class="main">]</span> <span class="main">(</span><span class="keyword1">mod</span> <span class="free">p</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="main">(</span><span class="free">p</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="free">p</span> <span class="main">=</span> <span class="main">0</span><span class="main">]</span> <span class="main">(</span><span class="keyword1">mod</span> <span class="free">p</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">`<span class="free">p</span> <span class="main">&gt;</span> <span class="numeral">2</span>`</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">`prime <span class="free">p</span>`</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"odd <span class="free">p</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> prime_odd_nat <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> cong_0_iff div_mult_swap dvd_times_left_cancel_iff
              dvd_triv_left le_0_eq linorder_not_less mult.commute odd_pos odd_two_times_div_two_nat
              one_add_one power_add power_one_right<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span>int <span class="main">(</span><span class="main">(</span><span class="free">p</span><span class="main">*</span><span class="main">(</span><span class="free">p</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="free">p</span><span class="main">)</span><span class="main">*</span><span class="skolem">k</span><span class="main">*</span><span class="free">y</span><span class="main">^</span><span class="main">(</span><span class="free">p</span><span class="main">-</span><span class="numeral">2</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span><span class="main">]</span> <span class="main">(</span><span class="keyword1">mod</span> <span class="free">p</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> cong_0_iff <span class="keyword1"><span class="command">using</span></span> int_dvd_int_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="main">(</span><span class="main">∑</span><span class="bound">t</span><span class="main">&lt;</span><span class="free">p</span><span class="main">.</span> <span class="free">y</span><span class="main">^</span><span class="main">(</span><span class="free">p</span> <span class="main">-</span> Suc <span class="bound">t</span><span class="main">)</span> <span class="main">*</span> <span class="free">x</span><span class="main">^</span><span class="bound">t</span><span class="main">)</span> <span class="main">=</span> <span class="free">p</span><span class="main">*</span><span class="free">y</span><span class="main">^</span><span class="main">(</span><span class="free">p</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">]</span> <span class="main">(</span><span class="keyword1">mod</span> <span class="free">p</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> cong_add cong_iff_dvd_diff<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">p</span><span class="main">^</span><span class="numeral">2</span> <span class="keyword1">dvd</span> <span class="free">p</span><span class="main">*</span><span class="free">y</span><span class="main">^</span><span class="main">(</span><span class="free">p</span><span class="main">-</span><span class="main">1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">`<span class="free">p</span> <span class="main">&gt;</span> <span class="numeral">2</span>`</span></span> <span class="quoted"><span class="quoted">`prime <span class="free">p</span>`</span></span> <span class="quoted"><span class="quoted">`<span class="main">¬</span> <span class="free">p</span> <span class="keyword1">dvd</span> <span class="free">y</span>`</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power2_eq_square prime_dvd_power_int_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> int <span class="free">p</span><span class="main">^</span><span class="main">(</span>Suc <span class="main">1</span><span class="main">)</span> <span class="keyword1">dvd</span> <span class="main">(</span><span class="main">∑</span><span class="bound">t</span><span class="main">&lt;</span><span class="free">p</span><span class="main">.</span> <span class="free">y</span><span class="main">^</span><span class="main">(</span><span class="free">p</span> <span class="main">-</span> Suc <span class="bound">t</span><span class="main">)</span> <span class="main">*</span> <span class="free">x</span><span class="main">^</span><span class="bound">t</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Suc_1 of_nat_power cong_dvd_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"multiplicity <span class="free">p</span> <span class="main">(</span><span class="free">x</span><span class="main">^</span><span class="free">p</span> <span class="main">-</span> <span class="free">y</span><span class="main">^</span><span class="free">p</span><span class="main">)</span> <span class="main">=</span> multiplicity <span class="free">p</span> <span class="main">(</span><span class="free">x</span> <span class="main">-</span> <span class="free">y</span><span class="main">)</span> <span class="main">+</span> multiplicity <span class="free">p</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="free">p</span><span class="main">.</span> <span class="free">y</span><span class="main">^</span><span class="main">(</span><span class="free">p</span> <span class="main">-</span> Suc <span class="bound">i</span><span class="main">)</span> <span class="main">*</span> <span class="free">x</span><span class="main">^</span><span class="bound">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> power_diff_sumr2<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> prime_elem_multiplicity_mult_distrib<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">`prime <span class="free">p</span>`</span></span> <span class="quoted"><span class="quoted">`<span class="free">x</span> <span class="main">≠</span> <span class="free">y</span>`</span></span> multiplicity_zero * <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Theorem 1:›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> multiplicity_diff_pow<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">&gt;</span> <span class="numeral">2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="free">y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"multiplicity <span class="free">p</span> <span class="main">(</span><span class="free">x</span><span class="main">^</span><span class="free">n</span> <span class="main">-</span> <span class="free">y</span><span class="main">^</span><span class="free">n</span><span class="main">)</span> <span class="main">=</span> multiplicity <span class="free">p</span> <span class="main">(</span><span class="free">x</span> <span class="main">-</span> <span class="free">y</span><span class="main">)</span> <span class="main">+</span> multiplicity <span class="free">p</span> <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">=</span> <span class="free">p</span><span class="main">^</span>multiplicity <span class="free">p</span> <span class="free">n</span> <span class="main">*</span> <span class="skolem">k</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">p</span> <span class="keyword1">dvd</span> <span class="skolem">k</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">`<span class="free">n</span> <span class="main">&gt;</span> <span class="main">0</span>`</span></span> <span class="quoted"><span class="quoted">`prime <span class="free">p</span>`</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> neq0_conv not_prime_unit multiplicity_decompose'<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"multiplicity <span class="free">p</span> <span class="main">(</span><span class="free">x</span><span class="main">^</span><span class="main">(</span><span class="free">p</span><span class="main">^</span><span class="skolem">a</span> <span class="main">*</span> <span class="skolem">k</span><span class="main">)</span> <span class="main">-</span> <span class="free">y</span><span class="main">^</span><span class="main">(</span><span class="free">p</span><span class="main">^</span><span class="skolem">a</span> <span class="main">*</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> multiplicity <span class="free">p</span> <span class="main">(</span><span class="free">x</span> <span class="main">-</span> <span class="free">y</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">a</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">a</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">a</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 0
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">`<span class="main">¬</span> <span class="free">p</span> <span class="keyword1">dvd</span> <span class="skolem">k</span>`</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coprime <span class="free">p</span> <span class="skolem">k</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">`prime <span class="free">p</span>`</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> prime_imp_coprime<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> multiplicity_diff_pow_coprime<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">a</span><span class="main">)</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?x'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">^</span><span class="main">(</span><span class="free">p</span><span class="main">^</span><span class="skolem">a</span><span class="main">*</span><span class="skolem">k</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?y'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">y</span><span class="main">^</span><span class="main">(</span><span class="free">p</span><span class="main">^</span><span class="skolem">a</span><span class="main">*</span><span class="skolem">k</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">p</span> <span class="keyword1">dvd</span> <span class="var">?x'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">p</span> <span class="keyword1">dvd</span> <span class="var">?y'</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">`<span class="main">¬</span> <span class="free">p</span> <span class="keyword1">dvd</span> <span class="free">x</span>`</span></span>  <span class="quoted"><span class="quoted">`<span class="main">¬</span> <span class="free">p</span> <span class="keyword1">dvd</span> <span class="free">y</span>`</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">`prime <span class="free">p</span>`</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> prime_dvd_power prime_nat_int_transfer<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="keyword1">dvd</span> <span class="var">?x'</span> <span class="main">-</span> <span class="var">?y'</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">`<span class="free">p</span> <span class="keyword1">dvd</span> <span class="free">x</span> <span class="main">-</span> <span class="free">y</span>`</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power_diff_sumr2<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?x'</span> <span class="main">≠</span> <span class="var">?y'</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="var">?x'</span> <span class="main">=</span> <span class="var">?y'</span>"</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">p</span><span class="main">^</span><span class="skolem">a</span> <span class="main">*</span> <span class="skolem">k</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">`prime <span class="free">p</span>`</span></span> <span class="quoted"><span class="quoted">`<span class="free">n</span> <span class="main">&gt;</span> <span class="main">0</span>`</span></span> n
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> gr0I mult_is_0 power_not_zero prime_gt_0_nat<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="free">x</span><span class="main">¦</span> <span class="main">=</span> <span class="main">¦</span><span class="free">y</span><span class="main">¦</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> power_eq_abs<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">`<span class="free">x</span> <span class="main">≠</span> <span class="free">y</span>`</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="main">-</span><span class="free">y</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> abs_eq_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">`<span class="free">p</span> <span class="keyword1">dvd</span> <span class="free">x</span> <span class="main">-</span> <span class="free">y</span>`</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="keyword1">dvd</span> <span class="numeral">2</span><span class="main">*</span><span class="free">x</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">`prime <span class="free">p</span>`</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="keyword1">dvd</span> <span class="numeral">2</span> <span class="main">∨</span> <span class="free">p</span> <span class="keyword1">dvd</span> <span class="free">x</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> int_dvd_int_iff of_nat_numeral prime_dvd_mult_iff prime_nat_int_transfer<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">`<span class="free">p</span> <span class="main">&gt;</span> <span class="numeral">2</span>`</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="keyword1">dvd</span> <span class="free">x</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">`<span class="main">¬</span> <span class="free">p</span> <span class="keyword1">dvd</span> <span class="free">x</span>`</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span><span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">^</span>Suc <span class="skolem">a</span> <span class="main">*</span> <span class="skolem">k</span> <span class="main">=</span> <span class="free">p</span><span class="main">^</span><span class="skolem">a</span> <span class="main">*</span> <span class="skolem">k</span> <span class="main">*</span> <span class="free">p</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> LTE.multiplicity_diff_self_pow<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="var">?x'</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> y<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="var">?y'</span>"</span></span><span class="main">,</span> <span class="operator">OF</span> <span class="quoted"><span class="quoted">`prime <span class="free">p</span>`</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">`<span class="free">p</span> <span class="main">&gt;</span> <span class="numeral">2</span>`</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> Suc.IH
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_Suc_right power_mult<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">with</span></span> n <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Theorem 2:›</span></span>

<span class="keyword1"><span class="command">corollary</span></span> multiplicity_add_pow<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="free">y</span> <span class="main">::</span> <span class="quoted">int</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">p</span> <span class="free">n</span> <span class="main">::</span> <span class="quoted">nat</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"odd <span class="free">n</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"prime <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">&gt;</span> <span class="numeral">2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="keyword1">dvd</span> <span class="free">x</span> <span class="main">+</span> <span class="free">y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">p</span> <span class="keyword1">dvd</span> <span class="free">x</span>"</span></span>  <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">p</span> <span class="keyword1">dvd</span> <span class="free">y</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="main">-</span><span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"multiplicity <span class="free">p</span> <span class="main">(</span><span class="free">x</span><span class="main">^</span><span class="free">n</span> <span class="main">+</span> <span class="free">y</span><span class="main">^</span><span class="free">n</span><span class="main">)</span> <span class="main">=</span> multiplicity <span class="free">p</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span> <span class="main">+</span> multiplicity <span class="free">p</span> <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">-</span><span class="free">y</span><span class="main">)</span><span class="main">^</span><span class="free">n</span> <span class="main">=</span> <span class="main">-</span><span class="main">(</span><span class="free">y</span><span class="main">^</span><span class="free">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">`odd <span class="free">n</span>`</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> power_minus_odd<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">`odd <span class="free">n</span>`</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> multiplicity_diff_pow<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">x</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> y<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">-</span><span class="free">y</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> n<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">n</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹The <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>p = 2›</span></span></span></span> case›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Theorem 3:›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> multiplicity_2_diff_pow_4div<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="free">y</span> <span class="main">::</span> <span class="quoted">int</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"odd <span class="free">x</span>"</span></span>  <span class="quoted"><span class="quoted">"odd <span class="free">y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">4</span> <span class="keyword1">dvd</span> <span class="free">x</span> <span class="main">-</span> <span class="free">y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"multiplicity <span class="numeral">2</span> <span class="main">(</span><span class="free">x</span><span class="main">^</span><span class="free">n</span> <span class="main">-</span> <span class="free">y</span><span class="main">^</span><span class="free">n</span><span class="main">)</span> <span class="main">=</span> multiplicity <span class="numeral">2</span> <span class="main">(</span><span class="free">x</span> <span class="main">-</span> <span class="free">y</span><span class="main">)</span> <span class="main">+</span> multiplicity <span class="numeral">2</span> <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prime <span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">^</span>multiplicity <span class="numeral">2</span> <span class="free">n</span> <span class="main">*</span> <span class="skolem">k</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="numeral">2</span> <span class="keyword1">dvd</span> <span class="skolem">k</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">`<span class="free">n</span> <span class="main">&gt;</span> <span class="main">0</span>`</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> neq0_conv not_prime_unit multiplicity_decompose'<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> pow2<span class="main">:</span> <span class="quoted"><span class="quoted">"multiplicity <span class="numeral">2</span> <span class="main">(</span><span class="free">x</span><span class="main">^</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">k</span><span class="main">)</span> <span class="main">-</span> <span class="free">y</span><span class="main">^</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> multiplicity <span class="numeral">2</span> <span class="main">(</span><span class="free">x</span> <span class="main">-</span> <span class="free">y</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">k</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">k</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">^</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="main">-</span> <span class="free">y</span><span class="main">^</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span><span class="main">^</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">k</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span> <span class="main">-</span> <span class="main">(</span><span class="free">y</span><span class="main">^</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">k</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> power_mult <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span><span class="main">^</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">k</span> <span class="main">-</span> <span class="free">y</span><span class="main">^</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">k</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="free">x</span><span class="main">^</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">k</span> <span class="main">+</span> <span class="free">y</span><span class="main">^</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">k</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power2_eq_square <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> factor<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">^</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="main">-</span> <span class="free">y</span><span class="main">^</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span><span class="main">^</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">k</span> <span class="main">-</span> <span class="free">y</span><span class="main">^</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">k</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="free">x</span><span class="main">^</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">k</span> <span class="main">+</span> <span class="free">y</span><span class="main">^</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">k</span><span class="main">)</span>"</span></span><span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> m_plus<span class="main">:</span> <span class="quoted"><span class="quoted">"multiplicity <span class="numeral">2</span> <span class="main">(</span><span class="free">x</span><span class="main">^</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">k</span> <span class="main">+</span> <span class="free">y</span><span class="main">^</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> multiplicity_eqI<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span><span class="main">^</span><span class="main">1</span> <span class="keyword1">dvd</span> <span class="free">x</span><span class="main">^</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">k</span> <span class="main">+</span> <span class="free">y</span><span class="main">^</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">k</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">`odd <span class="free">x</span>`</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">`odd <span class="free">y</span>`</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">x</span><span class="main">^</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">k</span> <span class="main">+</span> <span class="free">y</span><span class="main">^</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">k</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">]</span> <span class="main">(</span><span class="keyword1">mod</span> <span class="numeral">4</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">k</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> 0
        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">`odd <span class="free">y</span>`</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">y</span> <span class="main">=</span> <span class="main">1</span><span class="main">]</span> <span class="main">(</span><span class="keyword1">mod</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> cong_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="numeral">2</span><span class="main">*</span><span class="free">y</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">]</span> <span class="main">(</span><span class="keyword1">mod</span> <span class="numeral">4</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> cong_scale<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> k<span class="main"><span class="main">=</span></span><span class="quoted"><span class="numeral">2</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> b<span class="main"><span class="main">=</span></span><span class="quoted"><span class="main">1</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> c<span class="main"><span class="main">=</span></span><span class="quoted"><span class="numeral">2</span></span><span class="main">,</span> <span class="operator">simplified</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">`<span class="numeral">4</span> <span class="keyword1">dvd</span> <span class="free">x</span> <span class="main">-</span> <span class="free">y</span>`</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">x</span> <span class="main">-</span> <span class="free">y</span> <span class="main">=</span> <span class="main">0</span><span class="main">]</span> <span class="main">(</span><span class="keyword1">mod</span> <span class="numeral">4</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cong_0_iff<span class="main">)</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">]</span> <span class="main">(</span><span class="keyword1">mod</span> <span class="numeral">4</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> cong_add<span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">`<span class="skolem">k</span> <span class="main">=</span> <span class="main">0</span>`</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">k'</span><span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">x</span><span class="main">^</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">k</span> <span class="main">=</span> <span class="main">1</span><span class="main">]</span> <span class="main">(</span><span class="keyword1">mod</span> <span class="numeral">4</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">y</span><span class="main">^</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">k</span> <span class="main">=</span> <span class="main">1</span><span class="main">]</span> <span class="main">(</span><span class="keyword1">mod</span> <span class="numeral">4</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">`odd <span class="free">x</span>`</span></span> <span class="quoted"><span class="quoted">`odd <span class="free">y</span>`</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power_mult power_Suc2 <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> power_Suc <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> odd_square_mod_4<span class="main">)</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">x</span><span class="main">^</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">k</span> <span class="main">+</span> <span class="free">y</span><span class="main">^</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">k</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">]</span> <span class="main">(</span><span class="keyword1">mod</span> <span class="numeral">4</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> cong_add<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="numeral">2</span><span class="main">^</span>Suc <span class="main">1</span> <span class="keyword1">dvd</span> <span class="free">x</span><span class="main">^</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">k</span> <span class="main">+</span> <span class="free">y</span><span class="main">^</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">k</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cong_dvd_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">^</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">k</span> <span class="main">+</span> <span class="free">y</span><span class="main">^</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">k</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> m_plus multiplicity_zero <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">^</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">k</span> <span class="main">-</span> <span class="free">y</span><span class="main">^</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">k</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">^</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">k</span> <span class="main">-</span> <span class="free">y</span><span class="main">^</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">k</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="free">x</span><span class="main">¦</span> <span class="main">=</span> <span class="main">¦</span><span class="free">y</span><span class="main">¦</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> power_eq_abs<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="free">y</span> <span class="main">∨</span> <span class="free">x</span> <span class="main">=</span> <span class="main">-</span><span class="free">y</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> abs_eq_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">`<span class="free">x</span> <span class="main">≠</span> <span class="free">y</span>`</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="main">-</span><span class="free">y</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">`<span class="numeral">4</span> <span class="keyword1">dvd</span> <span class="free">x</span> <span class="main">-</span> <span class="free">y</span>`</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">4</span> <span class="keyword1">dvd</span> <span class="numeral">2</span><span class="main">*</span><span class="free">x</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="keyword1">dvd</span> <span class="free">x</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">`odd <span class="free">x</span>`</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span><span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"multiplicity <span class="numeral">2</span> <span class="main">(</span><span class="free">x</span><span class="main">^</span><span class="numeral">2</span><span class="main">^</span>Suc <span class="skolem">k</span> <span class="main">-</span> <span class="free">y</span><span class="main">^</span><span class="numeral">2</span><span class="main">^</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="main">=</span>
            multiplicity <span class="numeral">2</span> <span class="main">(</span><span class="free">x</span><span class="main">^</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">k</span> <span class="main">-</span> <span class="free">y</span><span class="main">^</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">k</span><span class="main">)</span> <span class="main">+</span> multiplicity <span class="numeral">2</span> <span class="main">(</span><span class="free">x</span><span class="main">^</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">k</span> <span class="main">+</span> <span class="free">y</span><span class="main">^</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">k</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> factor<span class="main"><span class="keyword3">;</span></span> <span class="operator">intro</span> prime_elem_multiplicity_mult_distrib<span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> m_plus Suc.IH <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> even_diff<span class="main">:</span> <span class="quoted"><span class="quoted">"int <span class="numeral">2</span> <span class="keyword1">dvd</span> <span class="free">x</span><span class="main">^</span><span class="numeral">2</span><span class="main">^</span>multiplicity <span class="numeral">2</span> <span class="free">n</span> <span class="main">-</span> <span class="free">y</span><span class="main">^</span><span class="numeral">2</span><span class="main">^</span>multiplicity <span class="numeral">2</span> <span class="free">n</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">`odd <span class="free">x</span>`</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">`odd <span class="free">y</span>`</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> odd_parts<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> int <span class="numeral">2</span> <span class="keyword1">dvd</span> <span class="free">x</span><span class="main">^</span><span class="numeral">2</span><span class="main">^</span>multiplicity <span class="numeral">2</span> <span class="free">n</span>"</span></span>   <span class="quoted"><span class="quoted">"<span class="main">¬</span> int <span class="numeral">2</span> <span class="keyword1">dvd</span> <span class="free">y</span><span class="main">^</span><span class="numeral">2</span><span class="main">^</span>multiplicity <span class="numeral">2</span> <span class="free">n</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">`odd <span class="free">x</span>`</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">`odd <span class="free">y</span>`</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> coprime<span class="main">:</span> <span class="quoted"><span class="quoted">"coprime <span class="numeral">2</span> <span class="skolem">k</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">`<span class="main">¬</span> <span class="numeral">2</span> <span class="keyword1">dvd</span> <span class="skolem">k</span>`</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> n<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> n<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> power_mult<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> multiplicity_diff_pow_coprime<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">`prime <span class="numeral">2</span>`</span></span> even_diff odd_parts coprime<span class="main"><span class="main">,</span></span> <span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pow2<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Theorem 4:›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> multiplicity_2_diff_even_pow<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="free">y</span> <span class="main">::</span> <span class="quoted">int</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"odd <span class="free">x</span>"</span></span>  <span class="quoted"><span class="quoted">"odd <span class="free">y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"even <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="free">x</span><span class="main">¦</span> <span class="main">≠</span> <span class="main">¦</span><span class="free">y</span><span class="main">¦</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"multiplicity <span class="numeral">2</span> <span class="main">(</span><span class="free">x</span><span class="main">^</span><span class="free">n</span> <span class="main">-</span> <span class="free">y</span><span class="main">^</span><span class="free">n</span><span class="main">)</span> <span class="main">=</span> multiplicity <span class="numeral">2</span> <span class="main">(</span><span class="free">x</span> <span class="main">-</span> <span class="free">y</span><span class="main">)</span> <span class="main">+</span> multiplicity <span class="numeral">2</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span> <span class="main">+</span> multiplicity <span class="numeral">2</span> <span class="free">n</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">*</span><span class="skolem">n'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">`even <span class="free">n</span>`</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">`<span class="free">n</span> <span class="main">&gt;</span> <span class="main">0</span>`</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n'</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">4</span> <span class="keyword1">dvd</span> <span class="free">x</span><span class="main">^</span><span class="numeral">2</span> <span class="main">-</span> <span class="free">y</span><span class="main">^</span><span class="numeral">2</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">^</span><span class="numeral">2</span> <span class="main">-</span> <span class="free">y</span><span class="main">^</span><span class="numeral">2</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="main">-</span> <span class="free">y</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span> power2_eq_square<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="keyword1">dvd</span> <span class="free">x</span> <span class="main">+</span> <span class="free">y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="keyword1">dvd</span> <span class="free">x</span> <span class="main">-</span> <span class="free">y</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">`odd <span class="free">x</span>`</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">`odd <span class="free">y</span>`</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">4</span> <span class="keyword1">dvd</span> <span class="free">x</span><span class="main">^</span><span class="numeral">2</span> <span class="main">-</span> <span class="free">y</span><span class="main">^</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"odd <span class="main">(</span><span class="free">x</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"odd <span class="main">(</span><span class="free">y</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">`odd <span class="free">x</span>`</span></span> <span class="quoted"><span class="quoted">`odd <span class="free">y</span>`</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">`<span class="main">¦</span><span class="free">x</span><span class="main">¦</span> <span class="main">≠</span> <span class="main">¦</span><span class="free">y</span><span class="main">¦</span>`</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">^</span><span class="numeral">2</span> <span class="main">≠</span> <span class="free">y</span><span class="main">^</span><span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> diff_0 diff_0_right power2_eq_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"multiplicity <span class="numeral">2</span> <span class="main">(</span><span class="main">(</span><span class="free">x</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="skolem">n'</span> <span class="main">-</span> <span class="main">(</span><span class="free">y</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="skolem">n'</span><span class="main">)</span> <span class="main">=</span> multiplicity <span class="numeral">2</span> <span class="main">(</span><span class="free">x</span><span class="main">^</span><span class="numeral">2</span> <span class="main">-</span> <span class="free">y</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span> <span class="main">+</span> multiplicity <span class="numeral">2</span> <span class="skolem">n'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> multiplicity_2_diff_pow_4div<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"multiplicity <span class="numeral">2</span> <span class="main">(</span><span class="main">(</span><span class="free">x</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="skolem">n'</span> <span class="main">-</span> <span class="main">(</span><span class="free">y</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="skolem">n'</span><span class="main">)</span> <span class="main">=</span> multiplicity <span class="numeral">2</span> <span class="main">(</span><span class="free">x</span><span class="main">^</span><span class="free">n</span> <span class="main">-</span> <span class="free">y</span><span class="main">^</span><span class="free">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> <span class="quoted"><span class="quoted">`<span class="free">n</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">*</span><span class="skolem">n'</span>`</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power_mult<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"multiplicity <span class="numeral">2</span> <span class="main">(</span><span class="free">x</span><span class="main">^</span><span class="numeral">2</span> <span class="main">-</span> <span class="free">y</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span> <span class="main">=</span> multiplicity <span class="numeral">2</span> <span class="main">(</span><span class="main">(</span><span class="free">x</span> <span class="main">-</span> <span class="free">y</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span> power2_eq_square<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> multiplicity <span class="numeral">2</span> <span class="main">(</span><span class="free">x</span> <span class="main">-</span> <span class="free">y</span><span class="main">)</span> <span class="main">+</span> multiplicity <span class="numeral">2</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">`<span class="main">¦</span><span class="free">x</span><span class="main">¦</span> <span class="main">≠</span> <span class="main">¦</span><span class="free">y</span><span class="main">¦</span>`</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> prime_elem_multiplicity_mult_distrib<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"multiplicity <span class="numeral">2</span> <span class="free">n</span> <span class="main">=</span> Suc <span class="main">(</span>multiplicity <span class="numeral">2</span> <span class="skolem">n'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> <span class="quoted"><span class="quoted">`<span class="free">n</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">*</span><span class="skolem">n'</span>`</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">`<span class="skolem">n'</span> <span class="main">&gt;</span> <span class="main">0</span>`</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> multiplicity_times_same<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</div>