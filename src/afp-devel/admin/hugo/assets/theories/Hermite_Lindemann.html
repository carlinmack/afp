<div id="Algebraic_Integer_Divisibility">
<div class="head">
<h1>Theory Algebraic_Integer_Divisibility</h1>
</div>
<pre class="source"><span class="comment1">(*
  File:     Algebraic_Integer_Divisibility.thy
  Author:   Manuel Eberl, TU München
*)</span>
<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Divisibility of algebraic integers›</span></span>
<span class="keyword1"><span class="command">theory</span></span> Algebraic_Integer_Divisibility
  <span class="keyword2"><span class="keyword">imports</span></span> <span class="quoted">"<a href="../../algebraic_numbers/theories/#Algebraic_Numbers">Algebraic_Numbers.Algebraic_Numbers</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  In this section, we define a notion of divisibility of algebraic integers: <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>y›</span></span></span></span> is divisible
  by <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>x›</span></span></span></span> if <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>y / x›</span></span></span></span> is an algebraic integer (or if <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>x›</span></span></span></span> and <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>y›</span></span></span></span> are both zero).

  Technically, the definition does not require <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>x›</span></span></span></span> and <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>y›</span></span></span></span> to be algebraic integers themselves,
  but we will always use it that way (in fact, in our case <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>x›</span></span></span></span> will always be a rational integer).
›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">alg_dvd</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> field <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">alg'_dvd</span>"</span> 50<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="keyword1"><span class="free">alg_dvd</span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">⟷</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟶</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">∧</span> algebraic_int <span class="main">(</span><span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">/</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Algebraic_Integer_Divisibility-alg_dvd_imp_algebraic_int"><span class="command">lemma</span></span> alg_dvd_imp_algebraic_int<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="free">y</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> field_char_0"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">alg_dvd</span> <span class="free">y</span> <span class="main">⟹</span> algebraic_int <span class="free">x</span> <span class="main">⟹</span> algebraic_int <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> algebraic_int_times<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">/</span> <span class="free">x</span>"</span></span> <span class="quoted"><span class="free">x</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> alg_dvd_def<span class="main">)</span>

<span class="keyword1" id="Algebraic_Integer_Divisibility-alg_dvd_0_left_iff"><span class="command">lemma</span></span> alg_dvd_0_left_iff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="keyword1">alg_dvd</span> <span class="free">x</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> alg_dvd_def<span class="main">)</span>

<span class="keyword1" id="Algebraic_Integer_Divisibility-alg_dvd_0_right"><span class="command">lemma</span></span> alg_dvd_0_right <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">alg_dvd</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> alg_dvd_def<span class="main">)</span>

<span class="keyword1" id="Algebraic_Integer_Divisibility-one_alg_dvd_iff"><span class="command">lemma</span></span> one_alg_dvd_iff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="keyword1">alg_dvd</span> <span class="free">x</span> <span class="main">⟷</span> algebraic_int <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> alg_dvd_def<span class="main">)</span>

<span class="keyword1" id="Algebraic_Integer_Divisibility-alg_dvd_of_int"><span class="command">lemma</span></span> alg_dvd_of_int <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">dvd</span> <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"of_int <span class="free">x</span> <span class="keyword1">alg_dvd</span> of_int <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"of_int <span class="free">x</span> <span class="main">=</span> <span class="main">(</span><span class="main">0</span> <span class="main">::</span> <span class="tfree">'a</span><span class="main">)</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">z</span></span> <span class="keyword2"><span class="keyword">where</span></span> z<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">=</span> <span class="free">x</span> <span class="main">*</span> <span class="skolem">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">elim</span> dvdE<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"algebraic_int <span class="main">(</span>of_int <span class="skolem">z</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"of_int <span class="skolem">z</span> <span class="main">=</span> of_int <span class="free">y</span> <span class="main">/</span> <span class="main">(</span>of_int <span class="free">x</span> <span class="main">::</span> <span class="tfree">'a</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> z <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> alg_dvd_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> assms <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="quoted">‹<span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main">:</span> alg_dvd_def›</span><span class="main">)</span>

<span class="keyword1" id="Algebraic_Integer_Divisibility-alg_dvd_of_nat"><span class="command">lemma</span></span> alg_dvd_of_nat <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">dvd</span> <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"of_nat <span class="free">x</span> <span class="keyword1">alg_dvd</span> of_nat <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> alg_dvd_of_int<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"int <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"int <span class="free">y</span>"</span></span><span class="main">]</span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Algebraic_Integer_Divisibility-alg_dvd_of_int_iff"><span class="command">lemma</span></span> alg_dvd_of_int_iff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span>of_int <span class="free">x</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> field_char_0<span class="main">)</span> <span class="keyword1">alg_dvd</span> of_int <span class="free">y</span> <span class="main">⟷</span> <span class="free">x</span> <span class="keyword1">dvd</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>of_int <span class="free">x</span> <span class="main">::</span> <span class="tfree">'a</span><span class="main">)</span> <span class="keyword1">alg_dvd</span> of_int <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"of_int <span class="free">y</span> <span class="main">/</span> <span class="main">(</span>of_int <span class="free">x</span> <span class="main">::</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">∈</span> <span class="main">ℤ</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> nz<span class="main">:</span> <span class="quoted"><span class="quoted">"of_int <span class="free">x</span> <span class="main">=</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">⟶</span> of_int <span class="free">y</span> <span class="main">=</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> alg_dvd_def <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> rational_algebraic_int_is_int<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"of_int <span class="free">y</span> <span class="main">/</span> of_int <span class="free">x</span> <span class="main">=</span> <span class="main">(</span>of_int <span class="skolem">n</span> <span class="main">::</span> <span class="tfree">'a</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">elim</span> Ints_cases<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"of_int <span class="free">y</span> <span class="main">=</span> <span class="main">(</span>of_int <span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">::</span> <span class="tfree">'a</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> of_int_mult <span class="keyword1"><span class="command">using</span></span> nz <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">=</span> <span class="free">x</span> <span class="main">*</span> <span class="skolem">n</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> of_int_eq_iff<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">dvd</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Algebraic_Integer_Divisibility-alg_dvd_of_nat_iff"><span class="command">lemma</span></span> alg_dvd_of_nat_iff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span>of_nat <span class="free">x</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> field_char_0<span class="main">)</span> <span class="keyword1">alg_dvd</span> of_nat <span class="free">y</span> <span class="main">⟷</span> <span class="free">x</span> <span class="keyword1">dvd</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>of_int <span class="main">(</span>int <span class="free">x</span><span class="main">)</span> <span class="main">::</span> <span class="tfree">'a</span><span class="main">)</span> <span class="keyword1">alg_dvd</span> of_int <span class="main">(</span>int <span class="free">y</span><span class="main">)</span> <span class="main">⟷</span> <span class="free">x</span> <span class="keyword1">dvd</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> alg_dvd_of_int_iff<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> of_int_of_nat_eq <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Algebraic_Integer_Divisibility-alg_dvd_add"><span class="command">lemma</span></span> alg_dvd_add <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="free">y</span> <span class="free">z</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> field_char_0"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">alg_dvd</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">x</span> <span class="keyword1">alg_dvd</span> <span class="free">z</span> <span class="main">⟹</span> <span class="free">x</span> <span class="keyword1">alg_dvd</span> <span class="main">(</span><span class="free">y</span> <span class="main">+</span> <span class="free">z</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> alg_dvd_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> add_divide_distrib<span class="main">)</span>

<span class="keyword1" id="Algebraic_Integer_Divisibility-alg_dvd_uminus_right"><span class="command">lemma</span></span> alg_dvd_uminus_right <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">alg_dvd</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">x</span> <span class="keyword1">alg_dvd</span> <span class="main">-</span><span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> alg_dvd_def<span class="main">)</span>

<span class="keyword1" id="Algebraic_Integer_Divisibility-alg_dvd_uminus_right_iff"><span class="command">lemma</span></span> alg_dvd_uminus_right_iff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">alg_dvd</span> <span class="main">-</span><span class="free">y</span> <span class="main">⟷</span> <span class="free">x</span> <span class="keyword1">alg_dvd</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> alg_dvd_uminus_right<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="free">y</span></span><span class="main">]</span> alg_dvd_uminus_right<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="free">y</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Algebraic_Integer_Divisibility-alg_dvd_diff"><span class="command">lemma</span></span> alg_dvd_diff <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="free">y</span> <span class="free">z</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> field_char_0"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">alg_dvd</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">x</span> <span class="keyword1">alg_dvd</span> <span class="free">z</span> <span class="main">⟹</span> <span class="free">x</span> <span class="keyword1">alg_dvd</span> <span class="main">(</span><span class="free">y</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> alg_dvd_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> diff_divide_distrib<span class="main">)</span>

<span class="keyword1" id="Algebraic_Integer_Divisibility-alg_dvd_triv_left"><span class="command">lemma</span></span> alg_dvd_triv_left <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"algebraic_int <span class="free">y</span> <span class="main">⟹</span> <span class="free">x</span> <span class="keyword1">alg_dvd</span> <span class="free">x</span> <span class="main">*</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> alg_dvd_def<span class="main">)</span>

<span class="keyword1" id="Algebraic_Integer_Divisibility-alg_dvd_triv_right"><span class="command">lemma</span></span> alg_dvd_triv_right <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"algebraic_int <span class="free">x</span> <span class="main">⟹</span> <span class="free">y</span> <span class="keyword1">alg_dvd</span> <span class="free">x</span> <span class="main">*</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> alg_dvd_def<span class="main">)</span>

<span class="keyword1" id="Algebraic_Integer_Divisibility-alg_dvd_triv_left_iff"><span class="command">lemma</span></span> alg_dvd_triv_left_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">alg_dvd</span> <span class="free">x</span> <span class="main">*</span> <span class="free">y</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> algebraic_int <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> alg_dvd_def<span class="main">)</span>

<span class="keyword1" id="Algebraic_Integer_Divisibility-alg_dvd_triv_right_iff"><span class="command">lemma</span></span> alg_dvd_triv_right_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="keyword1">alg_dvd</span> <span class="free">x</span> <span class="main">*</span> <span class="free">y</span> <span class="main">⟷</span> <span class="free">y</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> algebraic_int <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> alg_dvd_def<span class="main">)</span>

<span class="keyword1" id="Algebraic_Integer_Divisibility-alg_dvd_triv_left_iff'"><span class="command">lemma</span></span> alg_dvd_triv_left_iff' <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> <span class="free">x</span> <span class="keyword1">alg_dvd</span> <span class="free">x</span> <span class="main">*</span> <span class="free">y</span> <span class="main">⟷</span> algebraic_int <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> alg_dvd_triv_left_iff<span class="main">)</span>

<span class="keyword1" id="Algebraic_Integer_Divisibility-alg_dvd_triv_right_iff'"><span class="command">lemma</span></span> alg_dvd_triv_right_iff' <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> <span class="free">y</span> <span class="keyword1">alg_dvd</span> <span class="free">x</span> <span class="main">*</span> <span class="free">y</span> <span class="main">⟷</span> algebraic_int <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> alg_dvd_triv_right_iff<span class="main">)</span>

<span class="keyword1" id="Algebraic_Integer_Divisibility-alg_dvd_trans"><span class="command">lemma</span></span> alg_dvd_trans <span class="main">[</span><span class="operator">trans</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="free">y</span> <span class="free">z</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> field_char_0"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">alg_dvd</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">y</span> <span class="keyword1">alg_dvd</span> <span class="free">z</span> <span class="main">⟹</span> <span class="free">x</span> <span class="keyword1">alg_dvd</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> algebraic_int_times<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">/</span> <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">/</span> <span class="free">y</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> alg_dvd_def<span class="main">)</span>

<span class="keyword1" id="Algebraic_Integer_Divisibility-alg_dvd_mono"><span class="command">lemma</span></span> alg_dvd_mono <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">a</span> <span class="free">b</span> <span class="free">c</span> <span class="free">d</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> field_char_0"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="keyword1">alg_dvd</span> <span class="free">c</span> <span class="main">⟹</span> <span class="free">b</span> <span class="keyword1">alg_dvd</span> <span class="free">d</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">a</span> <span class="main">*</span> <span class="free">b</span><span class="main">)</span> <span class="keyword1">alg_dvd</span> <span class="main">(</span><span class="free">c</span> <span class="main">*</span> <span class="free">d</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> algebraic_int_times<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">/</span> <span class="free">a</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">/</span> <span class="free">b</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> alg_dvd_def<span class="main">)</span>

<span class="keyword1" id="Algebraic_Integer_Divisibility-alg_dvd_mult"><span class="command">lemma</span></span> alg_dvd_mult <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">a</span> <span class="free">b</span> <span class="free">c</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> field_char_0"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="keyword1">alg_dvd</span> <span class="free">c</span> <span class="main">⟹</span> algebraic_int <span class="free">b</span> <span class="main">⟹</span> <span class="free">a</span> <span class="keyword1">alg_dvd</span> <span class="main">(</span><span class="free">b</span> <span class="main">*</span> <span class="free">c</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> alg_dvd_mono<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">c</span></span> <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="free">b</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mult.commute<span class="main">)</span>

<span class="keyword1" id="Algebraic_Integer_Divisibility-alg_dvd_mult2"><span class="command">lemma</span></span> alg_dvd_mult2 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">a</span> <span class="free">b</span> <span class="free">c</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> field_char_0"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="keyword1">alg_dvd</span> <span class="free">b</span> <span class="main">⟹</span> algebraic_int <span class="free">c</span> <span class="main">⟹</span> <span class="free">a</span> <span class="keyword1">alg_dvd</span> <span class="main">(</span><span class="free">b</span> <span class="main">*</span> <span class="free">c</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> alg_dvd_mult<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">b</span></span> <span class="quoted"><span class="free">c</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult.commute<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  A crucial theorem: if an integer <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>x›</span></span></span></span> divides a rational number <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>y›</span></span></span></span>, then <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>y›</span></span></span></span> is in fact
  also an integer, and that integer is a multiple of <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>x›</span></span></span></span>.
›</span></span>
<span class="keyword1" id="Algebraic_Integer_Divisibility-alg_dvd_int_rat"><span class="command">lemma</span></span> alg_dvd_int_rat<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">y</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> field_char_0"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"of_int <span class="free">x</span> <span class="keyword1">alg_dvd</span> <span class="free">y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> <span class="main">ℚ</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">n</span><span class="main">.</span> <span class="free">y</span> <span class="main">=</span> of_int <span class="bound">n</span> <span class="main">∧</span> <span class="free">x</span> <span class="keyword1">dvd</span> <span class="bound">n</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">/</span> of_int <span class="free">x</span> <span class="main">∈</span> <span class="main">ℤ</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> rational_algebraic_int_is_int<span class="main">)</span> <span class="main">(</span><span class="operator">use</span> assms <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="quoted">‹<span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main">:</span> alg_dvd_def›</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"of_int <span class="skolem">n</span> <span class="main">=</span> <span class="free">y</span> <span class="main">/</span> <span class="main">(</span>of_int <span class="free">x</span> <span class="main">::</span> <span class="tfree">'a</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">elim</span> Ints_cases<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">=</span> of_int <span class="main">(</span><span class="skolem">n</span> <span class="main">*</span> <span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free"><span class="free">x</span></span></span> <span class="main"><span class="main"><span class="main">*</span></span></span> <span class="skolem"><span class="skolem"><span class="skolem">n</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> assms <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="Algebraic_Integer_Divisibility-prod_alg_dvd_prod"><span class="command">lemma</span></span> prod_alg_dvd_prod<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span> <span class="main">::</span> field_char_0"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="free">f</span> <span class="bound">x</span> <span class="keyword1">alg_dvd</span> <span class="free">g</span> <span class="bound">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"prod <span class="free">f</span> <span class="free">A</span> <span class="keyword1">alg_dvd</span> prod <span class="free">g</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">A</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> infinite_finite_induct<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Algebraic_Integer_Divisibility-alg_dvd_sum"><span class="command">lemma</span></span> alg_dvd_sum<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span> <span class="main">::</span> field_char_0"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="free">y</span> <span class="keyword1">alg_dvd</span> <span class="free">f</span> <span class="bound">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="keyword1">alg_dvd</span> sum <span class="free">f</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">A</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> infinite_finite_induct<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Algebraic_Integer_Divisibility-not_alg_dvd_sum"><span class="command">lemma</span></span> not_alg_dvd_sum<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span> <span class="main">::</span> field_char_0"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span><span class="main">-</span><span class="main">{</span><span class="free">x'</span><span class="main">}</span> <span class="main">⟹</span> <span class="free">y</span> <span class="keyword1">alg_dvd</span> <span class="free">f</span> <span class="bound">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="free">y</span> <span class="keyword1">alg_dvd</span> <span class="free">f</span> <span class="free">x'</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x'</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="free">y</span> <span class="keyword1">alg_dvd</span> sum <span class="free">f</span> <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="keyword1">alg_dvd</span> sum <span class="free">f</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="keyword1">alg_dvd</span> sum <span class="free">f</span> <span class="free">A</span> <span class="main">-</span> sum <span class="free">f</span> <span class="main">(</span><span class="free">A</span> <span class="main">-</span> <span class="main">{</span><span class="free">x'</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">x'</span> <span class="main">∈</span> <span class="free">A</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> alg_dvd_diff<span class="main"><span class="main">[</span></span><span class="operator">OF</span> * alg_dvd_sum<span class="main"><span class="main">]</span></span> assms<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> sum <span class="free">f</span> <span class="main">(</span><span class="free">A</span> <span class="main">-</span> <span class="main">(</span><span class="free">A</span> <span class="main">-</span> <span class="main">{</span><span class="free">x'</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> sum_diff<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">-</span> <span class="main">(</span><span class="free">A</span> <span class="main">-</span> <span class="main">{</span><span class="free">x'</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="free">x'</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Algebraic_Integer_Divisibility-fact_dvd_pochhammer"><span class="command">lemma</span></span> fact_dvd_pochhammer<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">≤</span> <span class="free">n</span> <span class="main">+</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"fact <span class="free">m</span> <span class="keyword1">dvd</span> pochhammer <span class="main">(</span>int <span class="free">n</span> <span class="main">-</span> int <span class="free">m</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="free">m</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>real <span class="free">n</span> <span class="keyword1">gchoose</span> <span class="free">m</span><span class="main">)</span> <span class="main">*</span> fact <span class="free">m</span> <span class="main">=</span> of_int <span class="main">(</span>pochhammer <span class="main">(</span>int <span class="free">n</span> <span class="main">-</span> int <span class="free">m</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="free">m</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> gbinomial_pochhammer' pochhammer_of_int <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>real <span class="free">n</span> <span class="keyword1">gchoose</span> <span class="free">m</span><span class="main">)</span> <span class="main">*</span> fact <span class="free">m</span> <span class="main">=</span> of_int <span class="main">(</span>int <span class="main">(</span><span class="free">n</span> <span class="keyword1">choose</span> <span class="free">m</span><span class="main">)</span> <span class="main">*</span> fact <span class="free">m</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> binomial_gbinomial<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"int <span class="main">(</span><span class="free">n</span> <span class="keyword1">choose</span> <span class="free">m</span><span class="main">)</span> <span class="main">*</span> fact <span class="free">m</span> <span class="main">=</span> pochhammer <span class="main">(</span>int <span class="free">n</span> <span class="main">-</span> int <span class="free">m</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="free">m</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> of_int_eq_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Algebraic_Integer_Divisibility-coeff_higher_pderiv"><span class="command">lemma</span></span> coeff_higher_pderiv<span class="main">:</span>
  <span class="quoted"><span class="quoted">"coeff <span class="main">(</span><span class="main">(</span>pderiv <span class="main">^^</span> <span class="free">m</span><span class="main">)</span> <span class="free">f</span><span class="main">)</span> <span class="free">n</span> <span class="main">=</span> pochhammer <span class="main">(</span>of_nat <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="free">m</span> <span class="main">*</span> coeff <span class="free">f</span> <span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="free">m</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">m</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> coeff_pderiv pochhammer_rec <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>

<span class="keyword1" id="Algebraic_Integer_Divisibility-fact_alg_dvd_poly_higher_pderiv"><span class="command">lemma</span></span> fact_alg_dvd_poly_higher_pderiv<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> field_char_0 poly"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> algebraic_int <span class="main">(</span>poly.coeff <span class="free">p</span> <span class="bound">i</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"algebraic_int <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">≤</span> <span class="free">k</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"fact <span class="free">m</span> <span class="keyword1">alg_dvd</span> poly <span class="main">(</span><span class="main">(</span>pderiv <span class="main">^^</span> <span class="free">k</span><span class="main">)</span> <span class="free">p</span><span class="main">)</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> poly_altdef
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> alg_dvd_sum<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">i</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>of_int <span class="main">(</span>fact <span class="free">m</span><span class="main">)</span> <span class="main">::</span> <span class="tfree">'a</span><span class="main">)</span> <span class="keyword1">alg_dvd</span> <span class="main">(</span>of_int <span class="main">(</span>fact <span class="free">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> alg_dvd_of_int fact_dvd assms<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>of_int <span class="main">(</span>fact <span class="free">k</span><span class="main">)</span> <span class="main">::</span> <span class="tfree">'a</span><span class="main">)</span> <span class="keyword1">alg_dvd</span> of_int <span class="main">(</span>pochhammer <span class="main">(</span>int <span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="free">k</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> fact_dvd_pochhammer<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">k</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">+</span> <span class="free">k</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> alg_dvd_of_int fact_dvd_pochhammer<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fact <span class="free">m</span> <span class="keyword1">alg_dvd</span> <span class="main">(</span>pochhammer <span class="main">(</span>of_nat <span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="free">k</span> <span class="main">::</span> <span class="tfree">'a</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> pochhammer_of_int<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="keyword1">alg_dvd</span> pochhammer <span class="main">(</span>of_nat <span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="free">k</span> <span class="main">*</span> poly.coeff <span class="free">p</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="free">k</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> alg_dvd_triv_left<span class="main">)</span> <span class="main">(</span><span class="operator">rule</span> assms<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> poly.coeff <span class="main">(</span><span class="main">(</span>pderiv <span class="main">^^</span> <span class="free">k</span><span class="main">)</span> <span class="free">p</span><span class="main">)</span> <span class="skolem">i</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> coeff_higher_pderiv <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_ac <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> pochhammer_of_int<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="keyword1">alg_dvd</span> poly.coeff <span class="main">(</span><span class="main">(</span>pderiv <span class="main">^^</span> <span class="free">k</span><span class="main">)</span> <span class="free">p</span><span class="main">)</span> <span class="skolem">i</span> <span class="main">*</span> <span class="free">x</span> <span class="main">^</span> <span class="skolem">i</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> alg_dvd_triv_left algebraic_int_power assms<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="More_Polynomial_HLW">
<div class="head">
<h1>Theory More_Polynomial_HLW</h1>
</div>
<pre class="source"><span class="comment1">(*
  File:     More_Polynomial_HLW.thy
  Author:   Manuel Eberl, TU München
*)</span>
<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Auxiliary facts about univariate polynomials›</span></span>
<span class="keyword1"><span class="command">theory</span></span> More_Polynomial_HLW
<span class="keyword2"><span class="keyword">imports</span></span>
  <span class="quoted">"<a href="https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL-Computational_Algebra/Computational_Algebra.html">HOL-Computational_Algebra.Computational_Algebra</a>"</span>
  <span class="quoted">"<a href="../../polynomial_factorization/theories/#Gauss_Lemma">Polynomial_Factorization.Gauss_Lemma</a>"</span>
  <span class="quoted">"<a href="../../power_sum_polynomials/theories/#Power_Sum_Polynomials_Library">Power_Sum_Polynomials.Power_Sum_Polynomials_Library</a>"</span>
  <span class="quoted">"<a href="../../algebraic_numbers/theories/#Algebraic_Numbers">Algebraic_Numbers.Algebraic_Numbers</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">instance</span></span> poly <span class="main">::</span> <span class="main">(</span><span class="quoted"><span class="quoted">"<span class="main">{</span>idom_divide<span class="main">,</span>normalization_semidom_multiplicative<span class="main">,</span>factorial_ring_gcd<span class="main">,</span>
                    semiring_gcd_mult_normalize<span class="main">}</span>"</span></span><span class="main">)</span> <span class="quoted">factorial_semiring_multiplicative</span> <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1" id="More_Polynomial_HLW-lead_coeff_prod_mset"><span class="command">lemma</span></span> lead_coeff_prod_mset<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>comm_semiring_1<span class="main">,</span> semiring_no_zero_divisors<span class="main">}</span> poly multiset"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Polynomial.lead_coeff <span class="main">(</span>prod_mset <span class="free">A</span><span class="main">)</span> <span class="main">=</span> prod_mset <span class="main">(</span>image_mset Polynomial.lead_coeff <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">A</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Polynomial.lead_coeff_mult<span class="main">)</span>

<span class="keyword1" id="More_Polynomial_HLW-content_normalize"><span class="command">lemma</span></span> content_normalize <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>factorial_semiring<span class="main">,</span> idom_divide<span class="main">,</span> semiring_gcd<span class="main">,</span> normalization_semidom_multiplicative<span class="main">}</span> poly"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"content <span class="main">(</span>normalize <span class="free">p</span><span class="main">)</span> <span class="main">=</span> content <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> False
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"content <span class="free">p</span> <span class="main">=</span> content <span class="main">(</span>unit_factor <span class="free">p</span> <span class="main">*</span> normalize <span class="free">p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> content <span class="main">(</span>unit_factor <span class="free">p</span><span class="main">)</span> <span class="main">*</span> content <span class="main">(</span>normalize <span class="free">p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> content_mult<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"content <span class="main">(</span>unit_factor <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> unit_factor_poly_def<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1" id="More_Polynomial_HLW-rat_to_normalized_int_poly_exists"><span class="command">lemma</span></span> rat_to_normalized_int_poly_exists<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"rat poly"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">q</span> <span class="free">lc</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> Polynomial.smult <span class="free">lc</span> <span class="main">(</span>of_int_poly <span class="free">q</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">lc</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"content <span class="free">q</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">lc</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">lc</span> <span class="main">=</span> fst <span class="main">(</span>rat_to_normalized_int_poly <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">=</span> snd <span class="main">(</span>rat_to_normalized_int_poly <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"rat_to_normalized_int_poly <span class="free">p</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">lc</span><span class="main">,</span> <span class="skolem">q</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lc_def q_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> rat_to_normalized_int_poly<span class="main">[</span><span class="operator">OF</span> eq<span class="main">]</span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> that<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">lc</span></span></span></span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">q</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="More_Polynomial_HLW-irreducible_imp_squarefree"><span class="command">lemma</span></span> irreducible_imp_squarefree<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"irreducible <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"squarefree <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> squarefreeI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">q</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">^</span> <span class="numeral">2</span> <span class="keyword1">dvd</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="keyword2"><span class="keyword">where</span></span> qr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="skolem">q</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">*</span> <span class="skolem">r</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">elim</span> dvdE<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="keyword1">dvd</span> <span class="main">1</span> <span class="main">∨</span> <span class="skolem">q</span> <span class="main">*</span> <span class="skolem">r</span> <span class="keyword1">dvd</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> irreducibleD<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">use</span> qr <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="quoted">‹<span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main">:</span> power2_eq_square mult_ac›</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="keyword1">dvd</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> dvd_mult_left<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="More_Polynomial_HLW-squarefree_imp_rsquarefree"><span class="command">lemma</span></span> squarefree_imp_rsquarefree<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> idom poly"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"squarefree <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"rsquarefree <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> rsquarefree_def
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> conjI allI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Polynomial.order <span class="skolem">x</span> <span class="free">p</span> <span class="main">&lt;</span> <span class="numeral">2</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span>Polynomial.order <span class="skolem">x</span> <span class="free">p</span> <span class="main">&lt;</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">[:</span><span class="main">-</span><span class="skolem">x</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">^</span> <span class="numeral">2</span> <span class="keyword1">dvd</span> <span class="free">p</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> order_divides<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword2"><span class="keyword">and</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">[:</span><span class="main">-</span><span class="skolem">x</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="keyword1">dvd</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> squarefreeD<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Polynomial.degree <span class="main">[:</span><span class="main">-</span><span class="skolem">x</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">≤</span> Polynomial.degree <span class="main">(</span><span class="main">1</span> <span class="main">::</span> <span class="tfree">'a</span> poly<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> dvd_imp_degree_le<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"Polynomial.order <span class="skolem">x</span> <span class="free">p</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> Polynomial.order <span class="skolem">x</span> <span class="free">p</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> assms <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="More_Polynomial_HLW-squarefree_imp_coprime_pderiv"><span class="command">lemma</span></span> squarefree_imp_coprime_pderiv<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>factorial_ring_gcd<span class="main">,</span>semiring_gcd_mult_normalize<span class="main">,</span>semiring_char_0<span class="main">}</span> poly"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"squarefree <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"content <span class="free">p</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"Rings.coprime <span class="free">p</span> <span class="main">(</span>pderiv <span class="free">p</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> coprimeI_primes<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">d</span> <span class="keyword3"><span class="command">assume</span></span> d<span class="main">:</span> <span class="quoted"><span class="quoted">"prime <span class="skolem">d</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="keyword1">dvd</span> <span class="free">p</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="keyword1">dvd</span> pderiv <span class="free">p</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"Polynomial.degree <span class="skolem">d</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> deg<span class="main">:</span> False
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> dq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="skolem">d</span> <span class="main">*</span> <span class="skolem">q</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> d <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">elim</span> dvdE<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">d</span> <span class="keyword1">dvd</span> <span class="skolem">q</span> <span class="main">*</span> pderiv <span class="skolem">d</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> d <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dq pderiv_mult dvd_add_right_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="skolem">d</span> <span class="keyword1">dvd</span> pderiv <span class="skolem">d</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="keyword1">dvd</span> pderiv <span class="skolem">d</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Polynomial.degree <span class="skolem">d</span> <span class="main">≤</span> Polynomial.degree <span class="main">(</span>pderiv <span class="skolem">d</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> d deg <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> dvd_imp_degree_le<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> pderiv_eq_0_iff<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Polynomial.degree <span class="skolem">d</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> degree_pderiv<span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> deg <span class="keyword1"><span class="command">by</span></span> <span class="operator">contradiction</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="keyword1">dvd</span> <span class="skolem">q</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> d<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prime_dvd_mult_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">^</span> <span class="numeral">2</span> <span class="keyword1">dvd</span> <span class="free">p</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> dq power2_eq_square<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_unit <span class="skolem">d</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> squarefreeD<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹prime <span class="skolem">d</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">d'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> <span class="main">[:</span><span class="skolem">d'</span><span class="main">:]</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">elim</span> degree_eq_zeroE<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> d <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d'</span> <span class="keyword1">dvd</span> content <span class="free">p</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> const_poly_dvd_iff_dvd_content<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword2"><span class="keyword">and</span></span> prime_imp_prime_elem<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹prime <span class="skolem">d</span>›</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> prime_elem_const_poly_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> assms <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="More_Polynomial_HLW-irreducible_imp_coprime_pderiv"><span class="command">lemma</span></span> irreducible_imp_coprime_pderiv<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>idom_divide<span class="main">,</span>semiring_char_0<span class="main">}</span> poly"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"irreducible <span class="free">p</span>"</span></span> <span class="quoted"><span class="quoted">"Polynomial.degree <span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"Rings.coprime <span class="free">p</span> <span class="main">(</span>pderiv <span class="free">p</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Rings.coprimeI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">d</span> <span class="keyword3"><span class="command">assume</span></span> d<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="keyword1">dvd</span> <span class="free">p</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="keyword1">dvd</span> pderiv <span class="free">p</span>"</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> dq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="skolem">d</span> <span class="main">*</span> <span class="skolem">q</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> d <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">elim</span> dvdE<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_unit <span class="skolem">d</span> <span class="main">∨</span> is_unit <span class="skolem">q</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms dq <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> irreducible_def<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"is_unit <span class="skolem">d</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> unit<span class="main">:</span> <span class="quoted"><span class="quoted">"is_unit <span class="skolem">q</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> d <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="keyword1">dvd</span> pderiv <span class="free">p</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> algebraic_semidom_class.mult_unit_dvd_iff dq <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Polynomial.degree <span class="free">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> not_dvd_pderiv<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">contradiction</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="More_Polynomial_HLW-poly_gcd_eq_0I"><span class="command">lemma</span></span> poly_gcd_eq_0I<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">q</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"poly <span class="main">(</span>gcd <span class="free">p</span> <span class="free">q</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> poly_eq_0_iff_dvd<span class="main">)</span>

<span class="keyword1" id="More_Polynomial_HLW-poly_eq_0_coprime"><span class="command">lemma</span></span> poly_eq_0_coprime<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Rings.coprime <span class="free">p</span> <span class="free">q</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="free">x</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∨</span> poly <span class="free">q</span> <span class="free">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">q</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">[:</span><span class="main">-</span><span class="free">x</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="keyword1">dvd</span> <span class="free">p</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[:</span><span class="main">-</span><span class="free">x</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="keyword1">dvd</span> <span class="free">q</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> poly_eq_0_iff_dvd<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">[:</span><span class="main">-</span><span class="free">x</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="keyword1">dvd</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Rings.coprime <span class="free">p</span> <span class="free">q</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> not_coprimeI<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_unit_poly_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="More_Polynomial_HLW-coprime_of_int_polyI"><span class="command">lemma</span></span> coprime_of_int_polyI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Rings.coprime <span class="free">p</span> <span class="free">q</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"Rings.coprime <span class="main">(</span>of_int_poly <span class="free">p</span><span class="main">)</span> <span class="main">(</span>of_int_poly <span class="free">q</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>field_char_0<span class="main">,</span>field_gcd<span class="main">}</span> poly<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms gcd_of_int_poly<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="free">q</span></span><span class="main">,</span> <span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="tvar">?'a</span> <span class="main"><span class="main">=</span></span> <span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> coprime_iff_gcd_eq_1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="More_Polynomial_HLW-irreducible_imp_rsquarefree_of_int_poly"><span class="command">lemma</span></span> irreducible_imp_rsquarefree_of_int_poly<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"int poly"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"irreducible <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"Polynomial.degree <span class="free">p</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"rsquarefree <span class="main">(</span>of_int_poly <span class="free">p</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>field_gcd<span class="main">,</span> field_char_0<span class="main">}</span> poly<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span>
    <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"poly <span class="main">(</span>of_int_poly <span class="free">p</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"poly <span class="main">(</span>pderiv <span class="main">(</span>of_int_poly <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">d</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> gcd <span class="main">(</span>of_int_poly <span class="free">p</span><span class="main">)</span> <span class="main">(</span>pderiv <span class="main">(</span>of_int_poly <span class="free">p</span><span class="main">)</span> <span class="main">::</span> <span class="tfree">'a</span> poly<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="skolem">d</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> x <span class="keyword1"><span class="command">unfolding</span></span> d_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> poly_gcd_eq_0I<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> d_def<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> Polynomial.degree <span class="skolem">d</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> Nat.gr0I<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> degree_eq_zeroE<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Polynomial.degree <span class="skolem">d</span> <span class="main">=</span> Polynomial.degree <span class="main">(</span>gcd <span class="free">p</span> <span class="main">(</span>pderiv <span class="free">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> d_def of_int_hom.map_poly_pderiv<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> gcd_of_int_poly <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> deg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"gcd <span class="free">p</span> <span class="main">(</span>pderiv <span class="free">p</span><span class="main">)</span> <span class="keyword1">dvd</span> <span class="free">p</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> irreducibleD'<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> this<span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> deg <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="keyword1">dvd</span> gcd <span class="free">p</span> <span class="main">(</span>pderiv <span class="free">p</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="keyword1">dvd</span> pderiv <span class="free">p</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Polynomial.degree <span class="free">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> rsquarefree_roots<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="More_Polynomial_HLW-squarefree_of_int_polyI"><span class="command">lemma</span></span> squarefree_of_int_polyI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"squarefree <span class="free">p</span>"</span></span> <span class="quoted"><span class="quoted">"content <span class="free">p</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"squarefree <span class="main">(</span>of_int_poly <span class="free">p</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>field_char_0<span class="main">,</span>field_gcd<span class="main">}</span> poly<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Rings.coprime <span class="free">p</span> <span class="main">(</span>pderiv <span class="free">p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> squarefree_imp_coprime_pderiv<span class="main">)</span> <span class="operator">fact</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Rings.coprime <span class="main">(</span>of_int_poly <span class="free">p</span> <span class="main">::</span> <span class="tfree">'a</span> poly<span class="main">)</span> <span class="main">(</span>of_int_poly <span class="main">(</span>pderiv <span class="free">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> coprime_of_int_polyI<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"of_int_poly <span class="main">(</span>pderiv <span class="free">p</span><span class="main">)</span> <span class="main">=</span> pderiv <span class="main">(</span>of_int_poly <span class="free">p</span> <span class="main">::</span> <span class="tfree">'a</span> poly<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> of_int_hom.map_poly_pderiv<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> coprime_pderiv_imp_squarefree <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="More_Polynomial_HLW-higher_pderiv_pcompose_linear"><span class="command">lemma</span></span> higher_pderiv_pcompose_linear<span class="main">:</span>
   <span class="quoted"><span class="quoted">"<span class="main">(</span>pderiv <span class="main">^^</span> <span class="free">n</span><span class="main">)</span> <span class="main">(</span>pcompose <span class="free">p</span> <span class="main">[:</span><span class="main">0</span><span class="main">,</span> <span class="free">c</span><span class="main">:]</span><span class="main">)</span> <span class="main">=</span>
    Polynomial.smult <span class="main">(</span><span class="free">c</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span> <span class="main">(</span>pcompose <span class="main">(</span><span class="main">(</span>pderiv <span class="main">^^</span> <span class="free">n</span><span class="main">)</span> <span class="free">p</span><span class="main">)</span> <span class="main">[:</span><span class="main">0</span><span class="main">,</span> <span class="free">c</span><span class="main">:]</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span>  <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pderiv_pcompose pderiv_smult pderiv_pCons pcompose_smult mult_ac<span class="main">)</span>

<span class="keyword1" id="More_Polynomial_HLW-poly_poly_eq"><span class="command">lemma</span></span> poly_poly_eq<span class="main">:</span>
  <span class="quoted"><span class="quoted">"poly <span class="main">(</span>poly <span class="free">p</span> <span class="main">[:</span><span class="free">x</span><span class="main">:]</span><span class="main">)</span> <span class="free">y</span> <span class="main">=</span> poly <span class="main">(</span>eval_poly <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="main">[:</span>poly <span class="bound">p</span> <span class="free">y</span><span class="main">:]</span><span class="main">)</span> <span class="free">p</span> <span class="main">[:</span><span class="main">0</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> eval_poly_def<span class="main">)</span>

<span class="keyword1" id="More_Polynomial_HLW-poly_poly_poly_y_x"><span class="command">lemma</span></span> poly_poly_poly_y_x <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> idom poly poly"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"poly <span class="main">(</span>poly <span class="main">(</span>poly_y_x <span class="free">p</span><span class="main">)</span> <span class="main">[:</span><span class="free">y</span><span class="main">:]</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> poly <span class="main">(</span>poly <span class="free">p</span> <span class="main">[:</span><span class="free">x</span><span class="main">:]</span><span class="main">)</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>pCons <span class="skolem">a</span> <span class="skolem">p</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="main">(</span>poly <span class="main">(</span>poly_y_x <span class="main">(</span>pCons <span class="skolem">a</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="main">[:</span><span class="free">y</span><span class="main">:]</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> 
          poly <span class="skolem">a</span> <span class="free">y</span> <span class="main">+</span> poly <span class="main">(</span>poly <span class="main">(</span>map_poly <span class="main">(</span>pCons <span class="main">0</span><span class="main">)</span> <span class="main">(</span>poly_y_x <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="main">[:</span><span class="free">y</span><span class="main">:]</span><span class="main">)</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> poly_y_x_pCons eval_poly_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"pCons <span class="main">0</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">::</span><span class="tfree">'a</span> poly<span class="main">.</span> Polynomial.monom <span class="main">1</span> <span class="main">1</span> <span class="main">*</span> <span class="bound">p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Polynomial.monom_altdef<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"map_poly <span class="main">…</span> <span class="main">(</span>poly_y_x <span class="skolem">p</span><span class="main">)</span> <span class="main">=</span> Polynomial.smult <span class="main">(</span>Polynomial.monom <span class="main">1</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>poly_y_x <span class="skolem">p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> smult_conv_map_poly<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="main">…</span> <span class="main">[:</span><span class="free">y</span><span class="main">:]</span> <span class="main">=</span> Polynomial.monom <span class="main">1</span> <span class="main">1</span> <span class="main">*</span> poly <span class="main">(</span>poly_y_x <span class="skolem">p</span><span class="main">)</span> <span class="main">[:</span><span class="free">y</span><span class="main">:]</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="skolem">a</span> <span class="free">y</span> <span class="main">+</span> poly <span class="main">…</span> <span class="free">x</span> <span class="main">=</span> poly <span class="main">(</span>poly <span class="main">(</span>pCons <span class="skolem">a</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">[:</span><span class="free">x</span><span class="main">:]</span><span class="main">)</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pCons poly_monom<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> idom_hom<span class="main">)</span> map_poly_higher_pderiv <span class="main">[</span><span class="operator">hom_distribs</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"map_poly <span class="free">hom</span> <span class="main">(</span><span class="main">(</span>pderiv <span class="main">^^</span> <span class="free">n</span><span class="main">)</span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>pderiv <span class="main">^^</span> <span class="free">n</span><span class="main">)</span> <span class="main">(</span>map_poly <span class="free">hom</span> <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> map_poly_pderiv<span class="main">)</span>

<span class="keyword1" id="More_Polynomial_HLW-coeff_prod_linear_factors"><span class="command">lemma</span></span> coeff_prod_linear_factors<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span> <span class="main">::</span> comm_ring_1"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Polynomial.coeff <span class="main">(</span><span class="main">∏</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="main">[:</span><span class="main">-</span><span class="free">f</span> <span class="bound">x</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">^</span> <span class="free">e</span> <span class="bound">x</span><span class="main">)</span> <span class="free">i</span> <span class="main">=</span>
           <span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">X</span></span> <span class="main">|</span> <span class="bound">X</span> <span class="main">∈</span> Pow <span class="main">(</span><span class="keyword1">SIGMA</span> <span class="bound">x</span><span class="main">:</span><span class="free">A</span><span class="main">.</span> <span class="main">{..&lt;</span><span class="free">e</span> <span class="bound">x</span><span class="main">}</span><span class="main">)</span> <span class="main">∧</span> <span class="free">i</span> <span class="main">=</span> sum <span class="free">e</span> <span class="free">A</span> <span class="main">-</span> card <span class="bound">X</span><span class="main">.</span>
             <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">^</span> card <span class="bound">X</span> <span class="main">*</span> <span class="main">(</span><span class="main">∏</span><span class="bound">x</span><span class="main">∈</span><span class="bound">X</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span>fst <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">poly_X</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">poly_X</span> <span class="main">=</span> <span class="main">(</span>Polynomial.monom <span class="main">1</span> <span class="main">1</span> <span class="main">::</span> <span class="tfree">'b</span> poly<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="skolem">n</span> <span class="main">=</span> <span class="main">[:</span><span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="skolem">n</span> <span class="main">::</span> <span class="tfree">'b</span><span class="main">:]</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span> <span class="main">::</span> <span class="quoted">nat</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> pCons_one <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> poly_const_pow<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∏</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="main">[:</span><span class="main">-</span><span class="free">f</span> <span class="bound">x</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">^</span> <span class="free">e</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="main"><span class="bound">_</span></span><span class="main">)</span><span class="main">∈</span>Sigma <span class="free">A</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">{..&lt;</span><span class="free">e</span> <span class="bound">x</span><span class="main">}</span><span class="main">)</span><span class="main">.</span> <span class="main">[:</span><span class="main">-</span><span class="free">f</span> <span class="bound">x</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> prod.Sigma <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="main"><span class="bound">_</span></span><span class="main">)</span><span class="main">∈</span>Sigma <span class="free">A</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">{..&lt;</span><span class="free">e</span> <span class="bound">x</span><span class="main">}</span><span class="main">)</span><span class="main">.</span> <span class="skolem">poly_X</span> <span class="main">-</span> <span class="main">[:</span><span class="free">f</span> <span class="bound">x</span><span class="main">:]</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> prod.cong<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> poly_X_def monom_altdef<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">X</span><span class="main">∈</span>Pow <span class="main">(</span><span class="keyword1">SIGMA</span> <span class="bound">x</span><span class="main">:</span><span class="free">A</span><span class="main">.</span> <span class="main">{..&lt;</span><span class="free">e</span> <span class="bound">x</span><span class="main">}</span><span class="main">)</span><span class="main">.</span>
                    Polynomial.smult <span class="main">(</span><span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">^</span> card <span class="bound">X</span> <span class="main">*</span> <span class="main">(</span><span class="main">∏</span><span class="bound">x</span><span class="main">∈</span><span class="bound">X</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span>fst <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                    <span class="main">(</span><span class="skolem">poly_X</span> <span class="main">^</span> card <span class="main">(</span><span class="main">(</span><span class="keyword1">SIGMA</span> <span class="bound">x</span><span class="main">:</span><span class="free">A</span><span class="main">.</span> <span class="main">{..&lt;</span><span class="free">e</span> <span class="bound">x</span><span class="main">}</span><span class="main">)</span> <span class="main">-</span> <span class="bound">X</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> case_prod_unfold 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> prod_diff1<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mult_ac <span class="quasi_keyword">simp</span> <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> coeff_lift_hom.hom_prod<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">X</span><span class="main">∈</span>Pow <span class="main">(</span><span class="keyword1">SIGMA</span> <span class="bound">x</span><span class="main">:</span><span class="free">A</span><span class="main">.</span> <span class="main">{..&lt;</span><span class="free">e</span> <span class="bound">x</span><span class="main">}</span><span class="main">)</span><span class="main">.</span>
       Polynomial.monom <span class="main">(</span><span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> card <span class="bound">X</span> <span class="main">*</span> <span class="main">(</span><span class="main">∏</span><span class="bound">x</span><span class="main">∈</span><span class="bound">X</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span>fst <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>card <span class="main">(</span><span class="main">(</span><span class="keyword1">SIGMA</span> <span class="bound">x</span><span class="main">:</span><span class="free">A</span><span class="main">.</span> <span class="main">{..&lt;</span><span class="free">e</span> <span class="bound">x</span><span class="main">}</span><span class="main">)</span> <span class="main">-</span> <span class="bound">X</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> poly_X_def monom_power Polynomial.smult_monom <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Polynomial.coeff <span class="main">…</span> <span class="free">i</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">X</span><span class="main">∈</span><span class="main">{</span><span class="bound"><span class="bound">X</span></span><span class="main">∈</span>Pow <span class="main">(</span><span class="keyword1">SIGMA</span> <span class="bound">x</span><span class="main">:</span><span class="free">A</span><span class="main">.</span> <span class="main">{..&lt;</span><span class="free">e</span> <span class="bound">x</span><span class="main">}</span><span class="main">)</span><span class="main">.</span> <span class="free">i</span> <span class="main">=</span>
               sum <span class="free">e</span> <span class="free">A</span> <span class="main">-</span> card <span class="bound">X</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> card <span class="bound">X</span> <span class="main">*</span> <span class="main">(</span><span class="main">∏</span><span class="bound">x</span><span class="main">∈</span><span class="bound">X</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span>fst <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> Polynomial.coeff_sum
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> sum.mono_neutral_cong_right ballI<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>3 <span class="skolem">X</span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> X<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">⊆</span> <span class="main">(</span><span class="keyword1">SIGMA</span> <span class="bound">x</span><span class="main">:</span><span class="free">A</span><span class="main">.</span> <span class="main">{..&lt;</span><span class="free">e</span> <span class="bound">x</span><span class="main">}</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> card_le<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="skolem">X</span> <span class="main">≤</span> card <span class="main">(</span><span class="keyword1">SIGMA</span> <span class="bound">x</span><span class="main">:</span><span class="free">A</span><span class="main">.</span> <span class="main">{..&lt;</span><span class="free">e</span> <span class="bound">x</span><span class="main">}</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> X <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> card_mono<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">X</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> finite_subset<span class="main"><span class="main">[</span></span><span class="operator">OF</span> X<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="main">(</span><span class="keyword1">SIGMA</span> <span class="bound">x</span><span class="main">:</span><span class="free">A</span><span class="main">.</span> <span class="main">{..&lt;</span><span class="free">e</span> <span class="bound">x</span><span class="main">}</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">X</span><span class="main">)</span> <span class="main">=</span> card <span class="main">(</span><span class="keyword1">SIGMA</span> <span class="bound">x</span><span class="main">:</span><span class="free">A</span><span class="main">.</span> <span class="main">{..&lt;</span><span class="free">e</span> <span class="bound">x</span><span class="main">}</span><span class="main">)</span> <span class="main">-</span> card <span class="skolem">X</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 3 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> card_Diff_subset<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> card_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="keyword1">SIGMA</span> <span class="bound">x</span><span class="main">:</span><span class="free">A</span><span class="main">.</span> <span class="main">{..&lt;</span><span class="free">e</span> <span class="bound">x</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> sum <span class="free">e</span> <span class="free">A</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> card_SigmaI<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> 3 card_le card_eq <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>4 <span class="skolem">X</span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> X<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">⊆</span> <span class="main">(</span><span class="keyword1">SIGMA</span> <span class="bound">x</span><span class="main">:</span><span class="free">A</span><span class="main">.</span> <span class="main">{..&lt;</span><span class="free">e</span> <span class="bound">x</span><span class="main">}</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">X</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> finite_subset<span class="main"><span class="main">[</span></span><span class="operator">OF</span> X<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="main">(</span><span class="keyword1">SIGMA</span> <span class="bound">x</span><span class="main">:</span><span class="free">A</span><span class="main">.</span> <span class="main">{..&lt;</span><span class="free">e</span> <span class="bound">x</span><span class="main">}</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">X</span><span class="main">)</span> <span class="main">=</span> card <span class="main">(</span><span class="keyword1">SIGMA</span> <span class="bound">x</span><span class="main">:</span><span class="free">A</span><span class="main">.</span> <span class="main">{..&lt;</span><span class="free">e</span> <span class="bound">x</span><span class="main">}</span><span class="main">)</span> <span class="main">-</span> card <span class="skolem">X</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 4 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> card_Diff_subset<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> card_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="keyword1">SIGMA</span> <span class="bound">x</span><span class="main">:</span><span class="free">A</span><span class="main">.</span> <span class="main">{..&lt;</span><span class="free">e</span> <span class="bound">x</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> sum <span class="free">e</span> <span class="free">A</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> card_SigmaI<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> 4 card_eq <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> comm_ring_hom<span class="main">)</span> synthetic_div_hom<span class="main">:</span>
  <span class="quoted"><span class="quoted">"synthetic_div <span class="main">(</span>map_poly <span class="free">hom</span> <span class="free">p</span><span class="main">)</span> <span class="main">(</span><span class="free">hom</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> map_poly <span class="free">hom</span> <span class="main">(</span>synthetic_div <span class="free">p</span> <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> map_poly_pCons_hom<span class="main">)</span>

<span class="keyword1" id="More_Polynomial_HLW-synthetic_div_altdef"><span class="command">lemma</span></span> synthetic_div_altdef<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> field poly"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"synthetic_div <span class="free">p</span> <span class="free">c</span> <span class="main">=</span> <span class="free">p</span> <span class="keyword1">div</span> <span class="main">[:</span><span class="main">-</span><span class="free">c</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">=</span> <span class="free">p</span> <span class="keyword1">div</span> <span class="main">[:</span><span class="main">-</span> <span class="free">c</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Polynomial.degree <span class="main">(</span><span class="free">p</span> <span class="keyword1">mod</span> <span class="main">[:</span><span class="main">-</span><span class="free">c</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="keyword1">mod</span> <span class="main">[:</span><span class="main">-</span><span class="free">c</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Polynomial.degree <span class="main">(</span><span class="free">p</span> <span class="keyword1">mod</span> <span class="main">[:</span><span class="main">-</span><span class="free">c</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span> <span class="main">&lt;</span> Polynomial.degree <span class="main">[:</span><span class="main">-</span><span class="free">c</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> degree_mod_less'<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">d</span></span> <span class="keyword2"><span class="keyword">where</span></span> d<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="keyword1">mod</span> <span class="main">[:</span><span class="main">-</span><span class="free">c</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">=</span> <span class="main">[:</span><span class="skolem">d</span><span class="main">:]</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">elim</span> degree_eq_zeroE<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> p_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="skolem">q</span> <span class="main">*</span> <span class="main">[:</span><span class="main">-</span><span class="free">c</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">+</span> <span class="main">[:</span><span class="skolem">d</span><span class="main">:]</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> q_def d <span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="free">c</span> <span class="main">=</span> <span class="skolem">d</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">+</span> Polynomial.smult <span class="free">c</span> <span class="skolem">q</span> <span class="main">=</span> pCons <span class="main">(</span>poly <span class="free">p</span> <span class="free">c</span><span class="main">)</span> <span class="skolem">q</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> p_eq<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> synthetic_div_unique<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> q_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> ring_closed<span class="main">)</span> poly_closed <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> poly.coeff <span class="free">p</span> <span class="bound">i</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> poly_altdef <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum_closed mult_closed power_closed assms<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> ring_closed<span class="main">)</span> coeff_pCons_closed <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> poly.coeff <span class="free">p</span> <span class="bound">i</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"poly.coeff <span class="main">(</span>pCons <span class="free">x</span> <span class="free">p</span><span class="main">)</span> <span class="free">i</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> poly_altdef <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> coeff_pCons <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> nat.splits<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> ring_closed<span class="main">)</span> coeff_poly_mult_closed <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> poly.coeff <span class="free">p</span> <span class="bound">i</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> poly.coeff <span class="free">q</span> <span class="bound">i</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"poly.coeff <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span> <span class="free">i</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> coeff_mult <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> ring_closed<span class="main">)</span> coeff_poly_prod_closed <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">i</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">⟹</span> poly.coeff <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="bound">i</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"poly.coeff <span class="main">(</span>prod <span class="free">f</span> <span class="free">X</span><span class="main">)</span> <span class="free">i</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">X</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">i</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> infinite_finite_induct<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> ring_closed<span class="main">)</span> coeff_poly_power_closed <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> poly.coeff <span class="free">p</span> <span class="bound">i</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"poly.coeff <span class="main">(</span><span class="free">p</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span> <span class="free">i</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> coeff_poly_prod_closed<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{..&lt;</span><span class="free">n</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="free">p</span>"</span></span> <span class="quoted"><span class="free">i</span></span><span class="main">]</span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> ring_closed<span class="main">)</span> synthetic_div_closed<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> poly.coeff <span class="free">p</span> <span class="bound">i</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"poly.coeff <span class="main">(</span>synthetic_div <span class="free">p</span> <span class="free">x</span><span class="main">)</span> <span class="free">i</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">.</span> poly.coeff <span class="free">p</span> <span class="bound">i</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">i</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> coeff_pCons <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> nat.splits<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="More_Polynomial_HLW-pcompose_monom"><span class="command">lemma</span></span> pcompose_monom<span class="main">:</span> <span class="quoted"><span class="quoted">"pcompose <span class="main">(</span>Polynomial.monom <span class="free">c</span> <span class="free">n</span><span class="main">)</span> <span class="free">p</span> <span class="main">=</span> Polynomial.smult <span class="free">c</span> <span class="main">(</span><span class="free">p</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> monom_altdef pcompose_hom.hom_power pcompose_smult<span class="main">)</span>

<span class="keyword1" id="More_Polynomial_HLW-poly_roots_uminus"><span class="command">lemma</span></span> poly_roots_uminus <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"poly_roots <span class="main">(</span><span class="main">-</span><span class="free">p</span><span class="main">)</span> <span class="main">=</span> poly_roots <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> poly_roots_smult<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">1</span>"</span></span> <span class="quoted"><span class="free">p</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> poly_roots_smult<span class="main">)</span>

<span class="keyword1" id="More_Polynomial_HLW-poly_roots_normalize"><span class="command">lemma</span></span> poly_roots_normalize <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>normalization_semidom<span class="main">,</span> idom_divide<span class="main">}</span> poly"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"poly_roots <span class="main">(</span>normalize <span class="free">p</span><span class="main">)</span> <span class="main">=</span> poly_roots <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> False
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly_roots <span class="free">p</span> <span class="main">=</span> poly_roots <span class="main">(</span>unit_factor <span class="free">p</span> <span class="main">*</span> normalize <span class="free">p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> poly_roots <span class="main">(</span>normalize <span class="free">p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> unit_factor_poly_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>


<span class="keyword1" id="More_Polynomial_HLW-poly_roots_of_int_normalize"><span class="command">lemma</span></span> poly_roots_of_int_normalize <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"poly_roots <span class="main">(</span>of_int_poly <span class="main">(</span>normalize <span class="free">p</span><span class="main">)</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>idom<span class="main">,</span> ring_char_0<span class="main">}</span> poly<span class="main">)</span> <span class="main">=</span>
   poly_roots <span class="main">(</span>of_int_poly <span class="free">p</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> False
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly_roots <span class="main">(</span>of_int_poly <span class="free">p</span> <span class="main">::</span> <span class="tfree">'a</span> poly<span class="main">)</span> <span class="main">=</span> poly_roots <span class="main">(</span>of_int_poly <span class="main">(</span>unit_factor <span class="free">p</span> <span class="main">*</span> normalize <span class="free">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> poly_roots <span class="main">(</span>Polynomial.smult <span class="main">(</span>of_int <span class="main">(</span>sgn <span class="main">(</span>Polynomial.lead_coeff <span class="free">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                    <span class="main">(</span>of_int_poly <span class="main">(</span>normalize <span class="free">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> unit_factor_poly_def of_int_hom.map_poly_hom_smult<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> poly_roots <span class="main">(</span>Ring_Hom_Poly.of_int_poly <span class="main">(</span>normalize <span class="free">p</span><span class="main">)</span> <span class="main">::</span> <span class="tfree">'a</span> poly<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> poly_roots_smult<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sgn_if<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1" id="More_Polynomial_HLW-poly_roots_power"><span class="command">lemma</span></span> poly_roots_power <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"poly_roots <span class="main">(</span><span class="free">p</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> repeat_mset <span class="free">n</span> <span class="main">(</span>poly_roots <span class="free">p</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> poly_roots_mult<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="More_Polynomial_HLW-poly_roots_conv_sum_prime_factors"><span class="command">lemma</span></span> poly_roots_conv_sum_prime_factors<span class="main">:</span>
  <span class="quoted"><span class="quoted">"poly_roots <span class="free">q</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">p</span><span class="main">∈#</span>prime_factorization <span class="free">q</span><span class="main">.</span> poly_roots <span class="bound">p</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> False

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">p</span><span class="main">∈#</span>prime_factorization <span class="free">q</span><span class="main">.</span> poly_roots <span class="bound">p</span><span class="main">)</span> <span class="main">=</span>
        poly_roots <span class="main">(</span>prod_mset <span class="main">(</span>prime_factorization <span class="free">q</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> poly_roots_prod_mset <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> poly_roots <span class="main">(</span>normalize <span class="main">(</span>prod_mset <span class="main">(</span>prime_factorization <span class="free">q</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"normalize <span class="main">(</span>prod_mset <span class="main">(</span>prime_factorization <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> normalize <span class="free">q</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> prod_mset_prime_factorization_weak<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly_roots <span class="main">…</span> <span class="main">=</span> poly_roots <span class="free">q</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1" id="More_Polynomial_HLW-poly_roots_of_int_conv_sum_prime_factors"><span class="command">lemma</span></span> poly_roots_of_int_conv_sum_prime_factors<span class="main">:</span>
  <span class="quoted"><span class="quoted">"poly_roots <span class="main">(</span>of_int_poly <span class="free">q</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>idom<span class="main">,</span> ring_char_0<span class="main">}</span> poly<span class="main">)</span> <span class="main">=</span>
   <span class="main">(</span><span class="main">∑</span><span class="bound">p</span><span class="main">∈#</span>prime_factorization <span class="free">q</span><span class="main">.</span> poly_roots <span class="main">(</span>of_int_poly <span class="bound">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> False

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">p</span><span class="main">∈#</span>prime_factorization <span class="free">q</span><span class="main">.</span> poly_roots <span class="main">(</span>of_int_poly <span class="bound">p</span> <span class="main">::</span> <span class="tfree">'a</span> poly<span class="main">)</span><span class="main">)</span> <span class="main">=</span>
        poly_roots <span class="main">(</span><span class="main">∏</span><span class="bound">p</span><span class="main">∈#</span>prime_factorization <span class="free">q</span><span class="main">.</span> of_int_poly <span class="bound">p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> poly_roots_prod_mset<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> multiset.map_comp o_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∏</span><span class="bound">p</span><span class="main">∈#</span>prime_factorization <span class="free">q</span><span class="main">.</span> of_int_poly <span class="bound">p</span> <span class="main">::</span> <span class="tfree">'a</span> poly<span class="main">)</span> <span class="main">=</span>
               of_int_poly <span class="main">(</span>prod_mset <span class="main">(</span>prime_factorization <span class="free">q</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly_roots <span class="main">…</span> <span class="main">=</span> poly_roots <span class="main">(</span>of_int_poly <span class="main">(</span>normalize <span class="main">(</span>prod_mset <span class="main">(</span>prime_factorization <span class="free">q</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> poly_roots_of_int_normalize <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"normalize <span class="main">(</span>prod_mset <span class="main">(</span>prime_factorization <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> normalize <span class="free">q</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> prod_mset_prime_factorization_weak<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly_roots <span class="main">(</span>of_int_poly <span class="main">…</span> <span class="main">::</span> <span class="tfree">'a</span> poly<span class="main">)</span> <span class="main">=</span> poly_roots <span class="main">(</span>of_int_poly <span class="free">q</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1" id="More_Polynomial_HLW-dvd_imp_poly_roots_subset"><span class="command">lemma</span></span> dvd_imp_poly_roots_subset<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="keyword1">dvd</span> <span class="free">q</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"poly_roots <span class="free">p</span> <span class="main">⊆#</span> poly_roots <span class="free">q</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mset_subset_eqI<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> dvd_imp_order_le<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="More_Polynomial_HLW-abs_prod_mset"><span class="command">lemma</span></span> abs_prod_mset<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¦</span>prod_mset <span class="main">(</span><span class="free">A</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> idom_abs_sgn multiset<span class="main">)</span><span class="main">¦</span> <span class="main">=</span> prod_mset <span class="main">(</span>image_mset abs <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">A</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> abs_mult<span class="main">)</span>

<span class="keyword1" id="More_Polynomial_HLW-content_1_imp_nonconstant_prime_factors"><span class="command">lemma</span></span> content_1_imp_nonconstant_prime_factors<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"content <span class="main">(</span><span class="free">p</span> <span class="main">::</span> int poly<span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">∈</span> prime_factors <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"Polynomial.degree <span class="free">q</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?d</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Polynomial.degree <span class="main">::</span> int poly <span class="main">⇒</span> nat"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?lc</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Polynomial.lead_coeff <span class="main">::</span> int poly <span class="main">⇒</span> int"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">P</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="main">=</span> prime_factorization <span class="free">p</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">P1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P1</span> <span class="main">=</span> filter_mset <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="var">?d</span> <span class="bound">p</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="skolem">P</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">P2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P2</span> <span class="main">=</span> filter_mset <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="var">?d</span> <span class="bound">p</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span> <span class="skolem">P</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">=</span> content <span class="main">(</span>normalize <span class="free">p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"normalize <span class="free">p</span> <span class="main">=</span> prod_mset <span class="skolem">P</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> P_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> prod_mset_prime_factorization <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="main">=</span> filter_mset <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="var">?d</span> <span class="bound">p</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="skolem">P</span> <span class="main">+</span> filter_mset <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="var">?d</span> <span class="bound">p</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span> <span class="skolem">P</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">P</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prod_mset <span class="main">…</span> <span class="main">=</span> prod_mset <span class="skolem">P1</span> <span class="main">*</span> prod_mset <span class="skolem">P2</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> P1_def P2_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> prod_mset.union<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"content <span class="main">…</span> <span class="main">=</span> content <span class="main">(</span>prod_mset <span class="skolem">P1</span><span class="main">)</span> <span class="main">*</span> content <span class="main">(</span>prod_mset <span class="skolem">P2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> content_mult <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"image_mset id <span class="skolem">P1</span> <span class="main">=</span> image_mset <span class="main">(</span><span class="main">λ</span><span class="bound">q</span><span class="main">.</span> <span class="main">[:</span><span class="var">?lc</span> <span class="bound">q</span><span class="main">:]</span><span class="main">)</span> <span class="skolem">P1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> image_mset_cong<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> P1_def <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> degree_eq_zeroE<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P1</span> <span class="main">=</span> image_mset <span class="main">(</span><span class="main">λ</span><span class="bound">q</span><span class="main">.</span> <span class="main">[:</span><span class="var">?lc</span> <span class="bound">q</span><span class="main">:]</span><span class="main">)</span> <span class="skolem">P1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"content <span class="main">(</span>prod_mset <span class="main">…</span><span class="main">)</span> <span class="main">=</span> <span class="main">¦</span><span class="main">(</span><span class="main">∏</span><span class="bound">q</span><span class="main">∈#</span><span class="skolem">P1</span><span class="main">.</span> <span class="var">?lc</span> <span class="bound">q</span><span class="main">)</span><span class="main">¦</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> content_prod_mset multiset.map_comp o_def abs_prod_mset<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="main">(</span><span class="main">∏</span><span class="bound">q</span><span class="main">∈#</span><span class="skolem">P1</span><span class="main">.</span> <span class="var">?lc</span> <span class="bound">q</span><span class="main">)</span><span class="main">¦</span> <span class="main">*</span> content <span class="main">(</span>prod_mset <span class="skolem">P2</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="main">(</span><span class="main">∏</span><span class="bound">q</span><span class="main">∈#</span><span class="skolem">P1</span><span class="main">.</span> <span class="var">?lc</span> <span class="bound">q</span><span class="main">)</span><span class="main">¦</span> <span class="keyword1">dvd</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> dvd_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set_mset <span class="skolem">P1</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"set_mset <span class="skolem">P1</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈#</span> <span class="skolem">P1</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="var">?lc</span> <span class="skolem">q</span><span class="main">¦</span> <span class="keyword1">dvd</span> <span class="main">(</span><span class="main">∏</span><span class="bound">q</span><span class="main">∈#</span><span class="skolem">P1</span><span class="main">.</span> <span class="main">¦</span><span class="var">?lc</span> <span class="bound">q</span><span class="main">¦</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> dvd_prod_mset<span class="main">)</span> <span class="main">(</span><span class="operator">use</span> q <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">¦</span><span class="main">(</span><span class="main">∏</span><span class="bound">q</span><span class="main">∈#</span><span class="skolem">P1</span><span class="main">.</span> <span class="var">?lc</span> <span class="bound">q</span><span class="main">)</span><span class="main">¦</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> abs_prod_mset multiset.map_comp o_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="keyword1">dvd</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_unit <span class="main">(</span><span class="var">?lc</span> <span class="skolem">q</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"is_unit <span class="skolem">q</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> q <span class="keyword1"><span class="command">unfolding</span></span> P1_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> degree_eq_zeroE<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prime <span class="skolem">q</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> q <span class="keyword1"><span class="command">unfolding</span></span> P1_def P_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> P1_def P_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="Min_Int_Poly">
<div class="head">
<h1>Theory Min_Int_Poly</h1>
</div>
<pre class="source"><span class="comment1">(*
  File:     Min_Int_Poly.thy
  Author:   Manuel Eberl, TU München
*)</span>
<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹The minimal polynomial of an algebraic number›</span></span>
<span class="keyword1"><span class="command">theory</span></span> Min_Int_Poly
<span class="keyword2"><span class="keyword">imports</span></span>
  <span class="quoted">"<a href="../../algebraic_numbers/theories/#Algebraic_Numbers">Algebraic_Numbers.Algebraic_Numbers</a>"</span>
  <span class="quoted">"<a href="https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL-Computational_Algebra/Computational_Algebra.html">HOL-Computational_Algebra.Computational_Algebra</a>"</span>
  <a href="#More_Polynomial_HLW">More_Polynomial_HLW</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Given an algebraic number <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>x›</span></span></span></span> in a field, the minimal polynomial is the unique irreducible
  integer polynomial with positive leading coefficient that has <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>x›</span></span></span></span> as a root.

  Note that we assume characteristic 0 since the material upon which all of this builds also
  assumes it.
›</span></span>

<span class="comment1">(* TODO Move *)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">min_int_poly</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> field_char_0 <span class="main">⇒</span> int poly"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">min_int_poly</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span>
     <span class="main">(</span><span class="keyword1">if</span> algebraic <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="keyword1">then</span> <span class="keyword1">THE</span> <span class="bound">p</span><span class="main">.</span> <span class="bound">p</span> <span class="keyword1">represents</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∧</span> irreducible <span class="bound">p</span> <span class="main">∧</span> Polynomial.lead_coeff <span class="bound">p</span> <span class="main">&gt;</span> <span class="main">0</span>
      <span class="keyword1">else</span> <span class="main">[:</span><span class="main">0</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>field_char_0<span class="main">,</span> field_gcd<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> min_int_poly_represents <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"algebraic <span class="free">x</span> <span class="main">⟹</span> min_int_poly <span class="free">x</span> <span class="keyword1">represents</span> <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>   min_int_poly_irreducible <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"irreducible <span class="main">(</span>min_int_poly <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>   lead_coeff_min_int_poly_pos<span class="main">:</span> <span class="quoted"><span class="quoted">"Polynomial.lead_coeff <span class="main">(</span>min_int_poly <span class="free">x</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">note</span></span> * <span class="main">=</span> theI'<span class="main">[</span><span class="operator">OF</span> algebraic_imp_represents_unique<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">x</span></span><span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"min_int_poly <span class="free">x</span> <span class="keyword1">represents</span> <span class="free">x</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"algebraic <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> *<span class="main">[</span><span class="operator">OF</span> that<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> that min_int_poly_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"irreducible <span class="main">[:</span><span class="main">0</span><span class="main">,</span> <span class="main">1</span><span class="main">::</span>int<span class="main">:]</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> irreducible_linear_poly<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"irreducible <span class="main">(</span>min_int_poly <span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> min_int_poly_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Polynomial.lead_coeff <span class="main">(</span>min_int_poly <span class="free">x</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> min_int_poly_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>field_char_0<span class="main">,</span> field_gcd<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> degree_min_int_poly_pos <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Polynomial.degree <span class="main">(</span>min_int_poly <span class="free">x</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> degree_min_int_poly_nonzero <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Polynomial.degree <span class="main">(</span>min_int_poly <span class="free">x</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Polynomial.degree <span class="main">(</span>min_int_poly <span class="free">x</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"algebraic <span class="free">x</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"min_int_poly <span class="free">x</span> <span class="keyword1">represents</span> <span class="free">x</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> min_int_poly_def<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"Polynomial.degree <span class="main">(</span>min_int_poly <span class="free">x</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Min_Int_Poly-min_int_poly_squarefree"><span class="command">lemma</span></span> min_int_poly_squarefree <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>field_char_0<span class="main">,</span> field_gcd<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"squarefree <span class="main">(</span>min_int_poly <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> irreducible_imp_squarefree<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Min_Int_Poly-min_int_poly_primitive"><span class="command">lemma</span></span> min_int_poly_primitive <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>field_char_0<span class="main">,</span> field_gcd<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"primitive <span class="main">(</span>min_int_poly <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> irreducible_imp_primitive<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Min_Int_Poly-min_int_poly_content"><span class="command">lemma</span></span> min_int_poly_content <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>field_char_0<span class="main">,</span> field_gcd<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"content <span class="main">(</span>min_int_poly <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> min_int_poly_primitive<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> primitive_def<span class="main">)</span>

<span class="keyword1" id="Min_Int_Poly-ipoly_min_int_poly"><span class="command">lemma</span></span> ipoly_min_int_poly <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"algebraic <span class="free">x</span> <span class="main">⟹</span> ipoly <span class="main">(</span>min_int_poly <span class="free">x</span><span class="main">)</span> <span class="main">(</span><span class="free">x</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>field_gcd<span class="main">,</span> field_char_0<span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> min_int_poly_represents<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> represents_def<span class="main">)</span>

<span class="keyword1" id="Min_Int_Poly-min_int_poly_nonzero"><span class="command">lemma</span></span> min_int_poly_nonzero <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>field_char_0<span class="main">,</span> field_gcd<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"min_int_poly <span class="free">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> lead_coeff_min_int_poly_pos<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Min_Int_Poly-min_int_poly_normalize"><span class="command">lemma</span></span> min_int_poly_normalize <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>field_char_0<span class="main">,</span> field_gcd<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"normalize <span class="main">(</span>min_int_poly <span class="free">x</span><span class="main">)</span> <span class="main">=</span> min_int_poly <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> normalize_poly_def <span class="keyword1"><span class="command">using</span></span> lead_coeff_min_int_poly_pos<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Min_Int_Poly-min_int_poly_prime_elem"><span class="command">lemma</span></span> min_int_poly_prime_elem <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>field_char_0<span class="main">,</span> field_gcd<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"prime_elem <span class="main">(</span>min_int_poly <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> min_int_poly_irreducible<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Min_Int_Poly-min_int_poly_prime"><span class="command">lemma</span></span> min_int_poly_prime <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>field_char_0<span class="main">,</span> field_gcd<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"prime <span class="main">(</span>min_int_poly <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> min_int_poly_prime_elem<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> prime_normalize_iff <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> min_int_poly_normalize<span class="main">)</span>

<span class="keyword1" id="Min_Int_Poly-min_int_poly_unique"><span class="command">lemma</span></span> min_int_poly_unique<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>field_char_0<span class="main">,</span> field_gcd<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="keyword1">represents</span> <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"irreducible <span class="free">p</span>"</span></span> <span class="quoted"><span class="quoted">"Polynomial.lead_coeff <span class="free">p</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"min_int_poly <span class="free">x</span> <span class="main">=</span> <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"algebraic <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> algebraic_iff_represents <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> the1_equality<span class="main">[</span><span class="operator">OF</span> algebraic_imp_represents_unique<span class="main"><span class="main">[</span></span><span class="operator">OF</span> x<span class="main"><span class="main">]</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">p</span></span><span class="main">]</span> assms
    <span class="keyword1"><span class="command">unfolding</span></span> min_int_poly_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Min_Int_Poly-min_int_poly_of_int"><span class="command">lemma</span></span> min_int_poly_of_int <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"min_int_poly <span class="main">(</span>of_int <span class="free">n</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>field_char_0<span class="main">,</span> field_gcd<span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="main">[:</span><span class="main">-</span>of_int <span class="free">n</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> min_int_poly_unique irreducible_linear_poly<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Min_Int_Poly-min_int_poly_of_nat"><span class="command">lemma</span></span> min_int_poly_of_nat <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"min_int_poly <span class="main">(</span>of_nat <span class="free">n</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>field_char_0<span class="main">,</span> field_gcd<span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="main">[:</span><span class="main">-</span>of_nat <span class="free">n</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> min_int_poly_of_int<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"int <span class="free">n</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> min_int_poly_of_int<span class="main">)</span>

<span class="keyword1" id="Min_Int_Poly-min_int_poly_0"><span class="command">lemma</span></span> min_int_poly_0 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"min_int_poly <span class="main">(</span><span class="main">0</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>field_char_0<span class="main">,</span> field_gcd<span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="main">[:</span><span class="main">0</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> min_int_poly_of_int<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> of_int_0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Min_Int_Poly-min_int_poly_1"><span class="command">lemma</span></span> min_int_poly_1 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"min_int_poly <span class="main">(</span><span class="main">1</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>field_char_0<span class="main">,</span> field_gcd<span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="main">[:</span><span class="main">-</span><span class="main">1</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> min_int_poly_of_int<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> of_int_1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Min_Int_Poly-poly_min_int_poly_0_eq_0_iff"><span class="command">lemma</span></span> poly_min_int_poly_0_eq_0_iff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>field_char_0<span class="main">,</span> field_gcd<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"algebraic <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"poly <span class="main">(</span>min_int_poly <span class="free">x</span><span class="main">)</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"poly <span class="main">(</span>min_int_poly <span class="free">x</span><span class="main">)</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"poly <span class="main">(</span>min_int_poly <span class="free">x</span><span class="main">)</span> <span class="main">0</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> represents_irr_non_0<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> * <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">contradiction</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Min_Int_Poly-min_int_poly_conv_Gcd"><span class="command">lemma</span></span> min_int_poly_conv_Gcd<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>field_char_0<span class="main">,</span> field_gcd<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"algebraic <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"min_int_poly <span class="free">x</span> <span class="main">=</span> Gcd <span class="main">{</span><span class="bound">p</span><span class="main">.</span> <span class="bound">p</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="bound">p</span> <span class="keyword1">represents</span> <span class="free">x</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sym<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> Gcd_eqI<span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">safe</span><span class="main">)</span><span class="main"><span class="keyword3">?</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span> <span class="keyword3"><span class="command">assume</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">q</span><span class="main">.</span> <span class="bound">q</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">p</span><span class="main">.</span> <span class="bound">p</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="bound">p</span> <span class="keyword1">represents</span> <span class="free">x</span><span class="main">}</span> <span class="main">⟹</span> <span class="skolem">p</span> <span class="keyword1">dvd</span> <span class="bound">q</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="keyword1">dvd</span> min_int_poly <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> p<span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span> <span class="keyword3"><span class="command">assume</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="keyword1">represents</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"min_int_poly <span class="free">x</span> <span class="keyword1">represents</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"poly <span class="main">(</span>gcd <span class="main">(</span>of_int_poly <span class="main">(</span>min_int_poly <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>of_int_poly <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> p <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> poly_gcd_eq_0I<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"ipoly <span class="main">(</span>gcd <span class="main">(</span>min_int_poly <span class="free">x</span><span class="main">)</span> <span class="skolem">p</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> gcd_of_int_poly<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"gcd <span class="main">(</span>min_int_poly <span class="free">x</span><span class="main">)</span> <span class="skolem">p</span> <span class="keyword1">represents</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> p <span class="keyword1"><span class="command">unfolding</span></span> represents_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"min_int_poly <span class="free">x</span> <span class="keyword1">dvd</span> gcd <span class="main">(</span>min_int_poly <span class="free">x</span><span class="main">)</span> <span class="skolem">p</span> <span class="main">∨</span> is_unit <span class="main">(</span>gcd <span class="main">(</span>min_int_poly <span class="free">x</span><span class="main">)</span> <span class="skolem">p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> irreducibleD'<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹gcd <span class="main">(</span>min_int_poly <span class="free">x</span><span class="main">)</span> <span class="skolem">p</span> <span class="keyword1">represents</span> <span class="free">x</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>is_unit <span class="main">(</span>gcd <span class="main">(</span>min_int_poly <span class="free">x</span><span class="main">)</span> <span class="skolem">p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> represents_def<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"min_int_poly <span class="free">x</span> <span class="keyword1">dvd</span> gcd <span class="main">(</span>min_int_poly <span class="free">x</span><span class="main">)</span> <span class="skolem">p</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="keyword1">dvd</span> <span class="skolem">p</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"min_int_poly <span class="free">x</span> <span class="keyword1">dvd</span> <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Min_Int_Poly-min_int_poly_eqI"><span class="command">lemma</span></span> min_int_poly_eqI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>field_char_0<span class="main">,</span> field_gcd<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="keyword1">represents</span> <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"irreducible <span class="free">p</span>"</span></span> <span class="quoted"><span class="quoted">"Polynomial.lead_coeff <span class="free">p</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"min_int_poly <span class="free">x</span> <span class="main">=</span> <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Polynomial.lead_coeff <span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Polynomial.lead_coeff <span class="free">p</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"algebraic <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="keyword1">represents</span> <span class="free">x</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> algebraic_iff_represents<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> min_int_poly_def
    <span class="keyword1"><span class="command">using</span></span> the1_equality<span class="main">[</span><span class="operator">OF</span> algebraic_imp_represents_unique<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹algebraic <span class="free">x</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">p</span></span><span class="main">]</span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="Complex_Lexorder">
<div class="head">
<h1>Theory Complex_Lexorder</h1>
</div>
<pre class="source"><span class="comment1">(*
  File:     Complex_Lexorder.thy
  Author:   Manuel Eberl, TU München
*)</span>
<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹The lexicographic ordering on complex numbers›</span></span>
<span class="keyword1"><span class="command">theory</span></span> Complex_Lexorder
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL/Complex_Main.html">Complex_Main</a> <span class="quoted">"<a href="https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL-Library/Multiset.html">HOL-Library.Multiset</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  We define a lexicographic order on the complex numbers, comparing first the real parts
  and, if they are equal, the imaginary parts. This ordering is of course not compatible with
  multiplication, but it is compatible with addition.
›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">less_eq_complex_lex</span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">≤<span class="hidden">⇩</span><sub>ℂ</sub></span>"</span> 50<span class="main">)</span>  <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">less_eq_complex_lex</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">⟷</span> Re <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">&lt;</span> Re <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">∨</span> Re <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> Re <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">∧</span> Im <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≤</span> Im <span class="free"><span class="bound"><span class="entity">y</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">less_complex_lex</span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">&lt;<span class="hidden">⇩</span><sub>ℂ</sub></span>"</span> 50<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">less_complex_lex</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">⟷</span> Re <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">&lt;</span> Re <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">∨</span> Re <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> Re <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">∧</span> Im <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">&lt;</span> Im <span class="free"><span class="bound"><span class="entity">y</span></span></span>"</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> complex_lex<span class="main">:</span>
  linordered_ab_group_add <span class="quoted"><span class="quoted">"<span class="main">(+)</span>"</span></span> <span class="quoted"><span class="main">0</span></span> <span class="quoted"><span class="quoted">"<span class="main">(-)</span>"</span></span> <span class="quoted"><span class="quoted">"uminus"</span></span> <span class="quoted">less_eq_complex_lex</span> <span class="quoted">less_complex_lex</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">standard</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> less_eq_complex_lex_def less_complex_lex_def complex_eq_iff<span class="main">)</span>

<span class="keyword1"><span class="command">lemmas</span></span> <span class="main">[</span><span class="operator">trans</span><span class="main">]</span> <span class="main">=</span>
  complex_lex.order.trans complex_lex.less_le_trans
  complex_lex.less_trans complex_lex.le_less_trans

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> ordered_comm_monoid_add<span class="main">)</span> sum_mono_complex_lex<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span><span class="main">∈</span><span class="free">K</span> <span class="main">⟹</span> <span class="free">f</span> <span class="bound">i</span> <span class="main">≤<span class="hidden">⇩</span><sub>ℂ</sub></span> <span class="free">g</span> <span class="bound">i</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="free">K</span><span class="main">.</span> <span class="free">f</span> <span class="bound">i</span><span class="main">)</span> <span class="main">≤<span class="hidden">⇩</span><sub>ℂ</sub></span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="free">K</span><span class="main">.</span> <span class="free">g</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">K</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> infinite_finite_induct<span class="main">)</span> <span class="main">(</span><span class="operator">use</span> complex_lex.add_mono <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="Complex_Lexorder-sum_strict_mono_ex1_complex_lex"><span class="command">lemma</span></span> sum_strict_mono_ex1_complex_lex<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="free">g</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'i</span> <span class="main">⇒</span> complex"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">≤<span class="hidden">⇩</span><sub>ℂ</sub></span> <span class="free">g</span> <span class="bound">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">a</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">a</span> <span class="main">&lt;<span class="hidden">⇩</span><sub>ℂ</sub></span> <span class="free">g</span> <span class="bound">a</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"sum <span class="free">f</span> <span class="free">A</span> <span class="main">&lt;<span class="hidden">⇩</span><sub>ℂ</sub></span> sum <span class="free">g</span> <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword">where</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">a</span> <span class="main">&lt;<span class="hidden">⇩</span><sub>ℂ</sub></span> <span class="free">g</span> <span class="skolem">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum <span class="free">f</span> <span class="free">A</span> <span class="main">=</span> sum <span class="free">f</span> <span class="main">(</span><span class="main">(</span><span class="free">A</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">a</span><span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">a</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> insert_absorb<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">∈</span> <span class="free">A</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> sum <span class="free">f</span> <span class="main">(</span><span class="free">A</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">a</span><span class="main">}</span><span class="main">)</span> <span class="main">+</span> sum <span class="free">f</span> <span class="main">{</span><span class="skolem">a</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">A</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> sum.union_disjoint<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤<span class="hidden">⇩</span><sub>ℂ</sub></span> sum <span class="free">g</span> <span class="main">(</span><span class="free">A</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">a</span><span class="main">}</span><span class="main">)</span> <span class="main">+</span> sum <span class="free">f</span> <span class="main">{</span><span class="skolem">a</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> complex_lex.add_mono sum_mono_complex_lex<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">&lt;<span class="hidden">⇩</span><sub>ℂ</sub></span> sum <span class="free">g</span> <span class="main">(</span><span class="free">A</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">a</span><span class="main">}</span><span class="main">)</span> <span class="main">+</span> sum <span class="free">g</span> <span class="main">{</span><span class="skolem">a</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> a <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> complex_lex.add_strict_left_mono<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> sum <span class="free">g</span> <span class="main">(</span><span class="main">(</span><span class="free">A</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">a</span><span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">a</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">A</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> sum.union_disjoint<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> sum <span class="free">g</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> insert_absorb<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">∈</span> <span class="free">A</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Complex_Lexorder-sum_list_mono_complex_lex"><span class="command">lemma</span></span> sum_list_mono_complex_lex<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"list_all2 <span class="main">(≤<span class="hidden">⇩</span><sub>ℂ</sub>)</span> <span class="free">xs</span> <span class="free">ys</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"sum_list <span class="free">xs</span> <span class="main">≤<span class="hidden">⇩</span><sub>ℂ</sub></span> sum_list <span class="free">ys</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">induction</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> complex_lex.add_mono<span class="main">)</span>

<span class="keyword1" id="Complex_Lexorder-sum_mset_mono_complex_lex"><span class="command">lemma</span></span> sum_mset_mono_complex_lex<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"rel_mset <span class="main">(≤<span class="hidden">⇩</span><sub>ℂ</sub>)</span> <span class="free">A</span> <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"sum_mset <span class="free">A</span> <span class="main">≤<span class="hidden">⇩</span><sub>ℂ</sub></span> sum_mset <span class="free">B</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> rel_mset_def sum_mset_sum_list <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> sum_list_mono_complex_lex<span class="main">)</span>

<span class="keyword1" id="Complex_Lexorder-rel_msetI"><span class="command">lemma</span></span> rel_msetI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"list_all2 <span class="free">R</span> <span class="free">xs</span> <span class="free">ys</span>"</span></span> <span class="quoted"><span class="quoted">"mset <span class="free">xs</span> <span class="main">=</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"mset <span class="free">ys</span> <span class="main">=</span> <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"rel_mset <span class="free">R</span> <span class="free">A</span> <span class="free">B</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> rel_mset_def<span class="main">)</span>

<span class="keyword1" id="Complex_Lexorder-mset_replicate"><span class="command">lemma</span></span> mset_replicate <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"mset <span class="main">(</span>replicate <span class="free">n</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> replicate_mset <span class="free">n</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Complex_Lexorder-rel_mset_replicate_mset_right"><span class="command">lemma</span></span> rel_mset_replicate_mset_right<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈#</span> <span class="free">A</span> <span class="main">⟹</span> <span class="free">R</span> <span class="bound">x</span> <span class="free">y</span>"</span></span> <span class="quoted"><span class="quoted">"size <span class="free">A</span> <span class="main">=</span> <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"rel_mset <span class="free">R</span> <span class="free">A</span> <span class="main">(</span>replicate_mset <span class="free">n</span> <span class="free">y</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">xs</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">=</span> mset <span class="skolem">xs</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ex_mset<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>set <span class="skolem">xs</span><span class="main">.</span> <span class="free">R</span> <span class="bound">x</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"list_all2 <span class="free">R</span> <span class="skolem">xs</span> <span class="main">(</span>replicate <span class="main">(</span>length <span class="skolem">xs</span><span class="main">)</span> <span class="free">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">xs</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> rel_msetI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">R</span></span></span></span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">xs</span></span></span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"replicate <span class="free"><span class="free"><span class="free">n</span></span></span> <span class="free"><span class="free"><span class="free">y</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="More_Multivariate_Polynomial_HLW">
<div class="head">
<h1>Theory More_Multivariate_Polynomial_HLW</h1>
</div>
<pre class="source"><span class="comment1">(*
  File:     More_Multivariate_Polynomial_HLW.thy
  Author:   Manuel Eberl, TU München
*)</span>
<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Additional facts about multivariate polynomials›</span></span>
<span class="keyword1"><span class="command">theory</span></span> More_Multivariate_Polynomial_HLW
  <span class="keyword2"><span class="keyword">imports</span></span> <span class="quoted">"<a href="../../power_sum_polynomials/theories/#Power_Sum_Polynomials_Library">Power_Sum_Polynomials.Power_Sum_Polynomials_Library</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Miscellaneous›</span></span>

<span class="keyword1" id="More_Multivariate_Polynomial_HLW-Var_altdef"><span class="command">lemma</span></span> Var_altdef<span class="main">:</span> <span class="quoted"><span class="quoted">"Var <span class="free">i</span> <span class="main">=</span> monom <span class="main">(</span>Poly_Mapping.single <span class="free">i</span> <span class="main">1</span><span class="main">)</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer'</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Var<span class="hidden">⇩</span><sub>0</sub>_def<span class="main">)</span>

<span class="keyword1" id="More_Multivariate_Polynomial_HLW-Const_conv_monom"><span class="command">lemma</span></span> Const_conv_monom<span class="main">:</span> <span class="quoted"><span class="quoted">"Const <span class="free">c</span> <span class="main">=</span> monom <span class="main">0</span> <span class="free">c</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer'</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Const<span class="hidden">⇩</span><sub>0</sub>_def<span class="main">)</span>

<span class="keyword1" id="More_Multivariate_Polynomial_HLW-smult_conv_mult_Const"><span class="command">lemma</span></span> smult_conv_mult_Const<span class="main">:</span> <span class="quoted"><span class="quoted">"smult <span class="free">c</span> <span class="free">p</span> <span class="main">=</span> Const <span class="free">c</span> <span class="main">*</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> smult_conv_mult Const_conv_monom<span class="main">)</span>

<span class="keyword1" id="More_Multivariate_Polynomial_HLW-mpoly_map_vars_Var"><span class="command">lemma</span></span> mpoly_map_vars_Var <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"bij <span class="free">f</span> <span class="main">⟹</span> mpoly_map_vars <span class="free">f</span> <span class="main">(</span>Var <span class="free">i</span><span class="main">)</span> <span class="main">=</span> Var <span class="main">(</span><span class="free">f</span> <span class="free">i</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Var_altdef
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> mpoly_map_vars_monom<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> permutep_single bij_imp_bij_inv inv_inv_eq<span class="main">)</span>

<span class="keyword1" id="More_Multivariate_Polynomial_HLW-symmetric_mpoly_symmetric_prod'"><span class="command">lemma</span></span> symmetric_mpoly_symmetric_prod'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">π</span><span class="main">.</span> <span class="bound">π</span> <span class="keyword1">permutes</span> <span class="free">A</span> <span class="main">⟹</span> <span class="free">g</span> <span class="bound">π</span> <span class="keyword1">permutes</span> <span class="free">X</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">π</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">⟹</span> <span class="bound">π</span> <span class="keyword1">permutes</span> <span class="free">A</span> <span class="main">⟹</span> mpoly_map_vars <span class="bound">π</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="main">(</span><span class="free">g</span> <span class="bound">π</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"symmetric_mpoly <span class="free">A</span> <span class="main">(</span><span class="main">∏</span><span class="bound">x</span><span class="main">∈</span><span class="free">X</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> symmetric_mpoly_def
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">π</span> <span class="keyword3"><span class="command">assume</span></span> π<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">π</span> <span class="keyword1">permutes</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"mpoly_map_vars <span class="skolem">π</span> <span class="main">(</span>prod <span class="free">f</span> <span class="free">X</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">x</span><span class="main">∈</span><span class="free">X</span><span class="main">.</span> mpoly_map_vars <span class="skolem">π</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">x</span><span class="main">∈</span><span class="free">X</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="free">g</span> <span class="skolem">π</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> prod.cong assms π refl<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">x</span><span class="main">∈</span><span class="free">g</span> <span class="skolem">π</span><span class="main">`</span><span class="free">X</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> π<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> prod.reindex<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> permutes_inj_on<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="skolem">π</span> <span class="main">`</span> <span class="free">X</span> <span class="main">=</span> <span class="free">X</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> π<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> permutes_image<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"mpoly_map_vars <span class="skolem">π</span> <span class="main">(</span>prod <span class="free">f</span> <span class="free">X</span><span class="main">)</span> <span class="main">=</span> prod <span class="free">f</span> <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>



<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Converting a univariate polynomial into a multivariate one›</span></span>

<span class="keyword1"><span class="command">lift_definition</span></span> mpoly_of_poly_aux <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">::</span> zero poly <span class="main">⇒</span> <span class="main">(</span>nat <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> nat<span class="main">)</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'a</span>"</span></span> <span class="keyword2"><span class="keyword">is</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">i</span> <span class="bound">c</span> <span class="bound">m</span><span class="main">.</span> <span class="keyword1">if</span> Poly_Mapping.keys <span class="bound">m</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound">i</span><span class="main">}</span> <span class="keyword1">then</span> <span class="bound">c</span> <span class="main">(</span>Poly_Mapping.lookup <span class="bound">m</span> <span class="bound">i</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">goal_cases</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">i</span> <span class="skolem">c</span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> fin<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">c</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> eventually_cofinite<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> keys <span class="bound">x</span> <span class="main">⊆</span> <span class="main">{</span><span class="skolem">i</span><span class="main">}</span> <span class="keyword1">then</span> <span class="skolem">c</span> <span class="main">(</span>lookup <span class="bound">x</span> <span class="skolem">i</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> finite_subset<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>Poly_Mapping.single <span class="skolem">i</span> <span class="main">`</span> <span class="main">{</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">c</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">}</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> finite_imageI fin<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> keys <span class="bound">x</span> <span class="main">⊆</span> <span class="main">{</span><span class="skolem">i</span><span class="main">}</span> <span class="keyword1">then</span> <span class="skolem">c</span> <span class="main">(</span>lookup <span class="bound">x</span> <span class="skolem">i</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span><span class="main">}</span> <span class="main">⊆</span>
            Poly_Mapping.single <span class="skolem">i</span> <span class="main">`</span> <span class="main">{</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">c</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">safe</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">split</span> if_splits<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>nat <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> nat<span class="main">)</span>"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"keys <span class="skolem">x</span> <span class="main">⊆</span> <span class="main">{</span><span class="skolem">i</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">(</span>lookup <span class="skolem">x</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> Poly_Mapping.single <span class="skolem">i</span> <span class="main">(</span>lookup <span class="skolem">x</span> <span class="skolem">i</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Diff_eq_empty_iff keys_empty_iff lookup_single_eq
                  remove_key_keys remove_key_single remove_key_sum<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> Poly_Mapping.single <span class="skolem">i</span> <span class="main">`</span> <span class="main">{</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">c</span> <span class="bound">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> x <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lift_definition</span></span> mpoly_of_poly <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">::</span> zero poly <span class="main">⇒</span> <span class="tfree">'a</span> mpoly"</span></span> <span class="keyword2"><span class="keyword">is</span></span>
  <span class="quoted"><span class="quoted">"mpoly_of_poly_aux"</span></span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1" id="More_Multivariate_Polynomial_HLW-mpoly_of_poly_0"><span class="command">lemma</span></span> mpoly_of_poly_0 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"mpoly_of_poly <span class="free">i</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer'</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">transfer</span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="More_Multivariate_Polynomial_HLW-coeff_mpoly_of_poly1"><span class="command">lemma</span></span> coeff_mpoly_of_poly1 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"coeff <span class="main">(</span>mpoly_of_poly <span class="free">i</span> <span class="free">p</span><span class="main">)</span> <span class="main">(</span>Poly_Mapping.single <span class="free">i</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> poly.coeff <span class="free">p</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer'</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">transfer'</span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="More_Multivariate_Polynomial_HLW-coeff_mpoly_of_poly2"><span class="command">lemma</span></span> coeff_mpoly_of_poly2 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>keys <span class="free">x</span> <span class="main">⊆</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"coeff <span class="main">(</span>mpoly_of_poly <span class="free">i</span> <span class="free">p</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer'</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">transfer'</span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="More_Multivariate_Polynomial_HLW-coeff_mpoly_of_poly"><span class="command">lemma</span></span> coeff_mpoly_of_poly<span class="main">:</span>
  <span class="quoted"><span class="quoted">"coeff <span class="main">(</span>mpoly_of_poly <span class="free">i</span> <span class="free">p</span><span class="main">)</span> <span class="free">m</span> <span class="main">=</span>
     <span class="main">(</span>poly.coeff <span class="free">p</span> <span class="main">(</span>Poly_Mapping.lookup <span class="free">m</span> <span class="free">i</span><span class="main">)</span> <span class="keyword1">when</span> keys <span class="free">m</span> <span class="main">⊆</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer'</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">transfer'</span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="More_Multivariate_Polynomial_HLW-poly_mapping_single_eq_0_iff"><span class="command">lemma</span></span> poly_mapping_single_eq_0_iff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Poly_Mapping.single <span class="free">i</span> <span class="free">n</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="free">n</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> lookup_single_eq single_zero<span class="main">)</span>

<span class="keyword1" id="More_Multivariate_Polynomial_HLW-mpoly_of_poly_pCons"><span class="command">lemma</span></span> mpoly_of_poly_pCons <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> semiring_1 poly"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"mpoly_of_poly <span class="free">i</span> <span class="main">(</span>pCons <span class="free">c</span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span> Const <span class="free">c</span> <span class="main">+</span> Var <span class="free">i</span> <span class="main">*</span> mpoly_of_poly <span class="free">i</span> <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> mpoly_eqI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">mon</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> nat"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">moni</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> nat"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">moni</span> <span class="main">=</span> Poly_Mapping.single <span class="free">i</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coeff <span class="main">(</span>Var <span class="free">i</span> <span class="main">*</span> mpoly_of_poly <span class="free">i</span> <span class="free">p</span><span class="main">)</span> <span class="skolem">mon</span> <span class="main">=</span>
          <span class="main">(</span><span class="main">∑</span><span class="bound">l</span><span class="main">.</span> <span class="main">(</span><span class="main">1</span> <span class="keyword1">when</span> <span class="bound">l</span> <span class="main">=</span> <span class="skolem">moni</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∑</span><span class="bound">q</span><span class="main">.</span> coeff <span class="main">(</span>mpoly_of_poly <span class="free">i</span> <span class="free">p</span><span class="main">)</span> <span class="bound">q</span> <span class="keyword1">when</span> <span class="skolem">mon</span> <span class="main">=</span> <span class="skolem">moni</span> <span class="main">+</span> <span class="bound">q</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> coeff_mpoly_times prod_fun_def coeff_Var moni_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Sum_any.cong<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> when_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">a</span><span class="main">.</span> coeff <span class="main">(</span>mpoly_of_poly <span class="free">i</span> <span class="free">p</span><span class="main">)</span> <span class="bound">a</span> <span class="keyword1">when</span> <span class="skolem">mon</span> <span class="main">=</span> <span class="skolem">moni</span> <span class="main">+</span> <span class="bound">a</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> Sum_any_left_distrib <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"coeff <span class="main">(</span>Var <span class="free">i</span> <span class="main">*</span> mpoly_of_poly <span class="free">i</span> <span class="free">p</span><span class="main">)</span> <span class="skolem">mon</span> <span class="main">=</span> <span class="main">…</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>

  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"coeff <span class="main">(</span>mpoly_of_poly <span class="free">i</span> <span class="main">(</span>pCons <span class="free">c</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="skolem">mon</span> <span class="main">=</span> coeff <span class="main">(</span>Const <span class="free">c</span> <span class="main">+</span> Var <span class="free">i</span> <span class="main">*</span> mpoly_of_poly <span class="free">i</span> <span class="free">p</span><span class="main">)</span> <span class="skolem">mon</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"keys <span class="skolem">mon</span> <span class="main">⊆</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">hence</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">mon</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="keyword2"><span class="keyword">where</span></span> j<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">∈</span> keys <span class="skolem">mon</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">≠</span> <span class="free">i</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coeff <span class="main">(</span>mpoly_of_poly <span class="free">i</span> <span class="free">p</span><span class="main">)</span> <span class="skolem">mon'</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> mon_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">mon</span> <span class="main">=</span> <span class="skolem">moni</span> <span class="main">+</span> <span class="skolem">mon'</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">mon'</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Poly_Mapping.lookup <span class="skolem">mon</span> <span class="skolem">j</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> j <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> lookup_eq_zero_in_keys_contradict<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Poly_Mapping.lookup <span class="skolem">mon</span> <span class="skolem">j</span> <span class="main">=</span> Poly_Mapping.lookup <span class="skolem">mon'</span> <span class="skolem">j</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> mon_eq moni_def <span class="keyword1"><span class="command">using</span></span> j <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lookup_add lookup_single<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">∈</span> keys <span class="skolem">mon'</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> lookup_not_eq_zero_eq_in_keys<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> j <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>keys <span class="skolem">mon'</span> <span class="main">⊆</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"coeff <span class="main">(</span>Var <span class="free">i</span> <span class="main">*</span> mpoly_of_poly <span class="free">i</span> <span class="free">p</span><span class="main">)</span> <span class="skolem">mon</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> eq <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> Sum_any_zeroI<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> when_def<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> False
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mpoly_coeff_Const<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> Poly_Mapping.lookup <span class="skolem">mon</span> <span class="free">i</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> mon_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">mon</span> <span class="main">=</span> Poly_Mapping.single <span class="free">i</span> <span class="skolem">n</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">unfolding</span></span> n_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Diff_eq_empty_iff add_cancel_right_left keys_empty_iff remove_key_keys remove_key_sum<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> eq'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">mon</span> <span class="main">=</span> <span class="skolem">moni</span> <span class="main">+</span> <span class="skolem">mon'</span> <span class="main">⟷</span> <span class="skolem">n</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∧</span> <span class="skolem">mon'</span> <span class="main">=</span> Poly_Mapping.single <span class="free">i</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">mon'</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
      <span class="keyword3"><span class="command">assume</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">mon</span> <span class="main">=</span> <span class="skolem">moni</span> <span class="main">+</span> <span class="skolem">mon'</span>"</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">mon'</span> <span class="main">=</span> Poly_Mapping.single <span class="free">i</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> moni_def mon_eq <span class="keyword1"><span class="command">using</span></span> gr0I <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> single_diff<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">mon'</span> <span class="main">=</span> Poly_Mapping.single <span class="free">i</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">mon</span> <span class="main">=</span> <span class="skolem">moni</span> <span class="main">+</span> Poly_Mapping.single <span class="free">i</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> mon_eq moni_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> single_add <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coeff <span class="main">(</span>Var <span class="free">i</span> <span class="main">*</span> mpoly_of_poly <span class="free">i</span> <span class="free">p</span><span class="main">)</span> <span class="skolem">mon</span> <span class="main">=</span> <span class="main">(</span>poly.coeff <span class="free">p</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">when</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> eq eq' <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> when_def<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mon_eq when_def mpoly_coeff_Const coeff_pCons <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> nat.splits<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="More_Multivariate_Polynomial_HLW-mpoly_of_poly_1"><span class="command">lemma</span></span> mpoly_of_poly_1 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"mpoly_of_poly <span class="free">i</span> <span class="main">1</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> one_pCons mpoly_of_poly_pCons mpoly_of_poly_0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="More_Multivariate_Polynomial_HLW-mpoly_of_poly_uminus"><span class="command">lemma</span></span> mpoly_of_poly_uminus <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"mpoly_of_poly <span class="free">i</span> <span class="main">(</span><span class="main">-</span><span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span>mpoly_of_poly <span class="free">i</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> mpoly_eqI<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> coeff_mpoly_of_poly when_def<span class="main">)</span>

<span class="keyword1" id="More_Multivariate_Polynomial_HLW-mpoly_of_poly_add"><span class="command">lemma</span></span> mpoly_of_poly_add <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"mpoly_of_poly <span class="free">i</span> <span class="main">(</span><span class="free">p</span> <span class="main">+</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> mpoly_of_poly <span class="free">i</span> <span class="free">p</span> <span class="main">+</span> mpoly_of_poly <span class="free">i</span> <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> mpoly_eqI<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> coeff_mpoly_of_poly when_def<span class="main">)</span>

<span class="keyword1" id="More_Multivariate_Polynomial_HLW-mpoly_of_poly_diff"><span class="command">lemma</span></span> mpoly_of_poly_diff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"mpoly_of_poly <span class="free">i</span> <span class="main">(</span><span class="free">p</span> <span class="main">-</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> mpoly_of_poly <span class="free">i</span> <span class="free">p</span> <span class="main">-</span> mpoly_of_poly <span class="free">i</span> <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> mpoly_eqI<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> coeff_mpoly_of_poly when_def<span class="main">)</span>

<span class="keyword1" id="More_Multivariate_Polynomial_HLW-mpoly_of_poly_smult"><span class="command">lemma</span></span> mpoly_of_poly_smult <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"mpoly_of_poly <span class="free">i</span> <span class="main">(</span>Polynomial.smult <span class="free">c</span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span> smult <span class="free">c</span> <span class="main">(</span>mpoly_of_poly <span class="free">i</span> <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> mpoly_eqI<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> coeff_mpoly_of_poly when_def<span class="main">)</span>

<span class="keyword1" id="More_Multivariate_Polynomial_HLW-mpoly_of_poly_mult"><span class="command">lemma</span></span> mpoly_of_poly_mult <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="free">q</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> comm_semiring_1 poly"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"mpoly_of_poly <span class="free">i</span> <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> mpoly_of_poly <span class="free">i</span> <span class="free">p</span> <span class="main">*</span> mpoly_of_poly <span class="free">i</span> <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span> smult_conv_mult_Const<span class="main">)</span>

<span class="keyword1" id="More_Multivariate_Polynomial_HLW-insertion_mpoly_of_poly"><span class="command">lemma</span></span> insertion_mpoly_of_poly <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"insertion <span class="free">f</span> <span class="main">(</span>mpoly_of_poly <span class="free">i</span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span> poly <span class="free">p</span> <span class="main">(</span><span class="free">f</span> <span class="free">i</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> insertion_add insertion_mult<span class="main">)</span>

<span class="keyword1" id="More_Multivariate_Polynomial_HLW-mapping_of_mpoly_of_poly"><span class="command">lemma</span></span> mapping_of_mpoly_of_poly <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"mapping_of <span class="main">(</span>mpoly_of_poly <span class="free">i</span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span> mpoly_of_poly_aux <span class="free">i</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer'</span> <span class="operator">simp</span>

<span class="keyword1" id="More_Multivariate_Polynomial_HLW-vars_mpoly_of_poly"><span class="command">lemma</span></span> vars_mpoly_of_poly<span class="main">:</span> <span class="quoted"><span class="quoted">"vars <span class="main">(</span>mpoly_of_poly <span class="free">i</span> <span class="free">p</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="free">i</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xa</span> <span class="main">∈</span> keys <span class="main">(</span>mpoly_of_poly_aux <span class="free">i</span> <span class="free">p</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> keys <span class="skolem">xa</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="skolem">xa</span>
    <span class="keyword1"><span class="command">using</span></span> that
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> in_mono lookup_eq_zero_in_keys_contradict mpoly_of_poly_aux.rep_eq singletonD<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> vars_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="More_Multivariate_Polynomial_HLW-mpoly_map_vars_mpoly_of_poly"><span class="command">lemma</span></span> mpoly_map_vars_mpoly_of_poly <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"bij <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"mpoly_map_vars <span class="free">f</span> <span class="main">(</span>mpoly_of_poly <span class="free">i</span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span> mpoly_of_poly <span class="main">(</span><span class="free">f</span> <span class="free">i</span><span class="main">)</span> <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> mpoly_eqI<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">mon</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">-`</span> keys <span class="skolem">mon</span> <span class="main">⊆</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="main">⟷</span> keys <span class="skolem">mon</span> <span class="main">⊆</span> <span class="main">{</span><span class="free">f</span> <span class="free">i</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vimage_subset_eq<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> coeff_mpoly_map_vars coeff_mpoly_of_poly lookup_permutep keys_permutep when_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="More_Algebraic_Numbers_HLW">
<div class="head">
<h1>Theory More_Algebraic_Numbers_HLW</h1>
</div>
<pre class="source"><span class="comment1">(*
  File:     More_Algebraic_Numbers_HLW.thy
  Author:   Manuel Eberl, TU München
*)</span>
<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹More facts about algebraic numbers›</span></span>
<span class="keyword1"><span class="command">theory</span></span> More_Algebraic_Numbers_HLW
  <span class="keyword2"><span class="keyword">imports</span></span> <span class="quoted">"<a href="../../algebraic_numbers/theories/#Algebraic_Numbers">Algebraic_Numbers.Algebraic_Numbers</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Miscellaneous›</span></span>

<span class="comment1">(* TODO: Move! All of this belongs in Algebraic_Numbers *)</span>

<span class="keyword1" id="More_Algebraic_Numbers_HLW-in_Ints_imp_algebraic"><span class="command">lemma</span></span> in_Ints_imp_algebraic <span class="main">[</span><span class="operator">simp</span><span class="main">,</span> <span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="main">ℤ</span> <span class="main">⟹</span> algebraic <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> algebraic_int_imp_algebraic int_imp_algebraic_int<span class="main">)</span>

<span class="keyword1" id="More_Algebraic_Numbers_HLW-in_Rats_imp_algebraic"><span class="command">lemma</span></span> in_Rats_imp_algebraic <span class="main">[</span><span class="operator">simp</span><span class="main">,</span> <span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="main">ℚ</span> <span class="main">⟹</span> algebraic <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> Rats_cases' <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> algebraic_div<span class="main">)</span>

<span class="keyword1" id="More_Algebraic_Numbers_HLW-algebraic_uminus_iff"><span class="command">lemma</span></span> algebraic_uminus_iff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"algebraic <span class="main">(</span><span class="main">-</span><span class="free">x</span><span class="main">)</span> <span class="main">⟷</span> algebraic <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> algebraic_uminus<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span><span class="main">]</span> algebraic_uminus<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="free">x</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="More_Algebraic_Numbers_HLW-algebraic_0"><span class="command">lemma</span></span> algebraic_0 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"algebraic <span class="main">(</span><span class="main">0</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> field_char_0<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> algebraic_1 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"algebraic <span class="main">(</span><span class="main">1</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> field_char_0<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  

<span class="keyword1" id="More_Algebraic_Numbers_HLW-algebraic_sum"><span class="command">lemma</span></span> algebraic_sum <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> algebraic <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> algebraic <span class="main">(</span>sum <span class="free">f</span> <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">A</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> infinite_finite_induct<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> algebraic_plus<span class="main">)</span>

<span class="keyword1" id="More_Algebraic_Numbers_HLW-algebraic_prod"><span class="command">lemma</span></span> algebraic_prod <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> algebraic <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> algebraic <span class="main">(</span>prod <span class="free">f</span> <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">A</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> infinite_finite_induct<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> algebraic_times<span class="main">)</span>

<span class="keyword1" id="More_Algebraic_Numbers_HLW-algebraic_sum_list"><span class="command">lemma</span></span> algebraic_sum_list <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> set <span class="free">xs</span> <span class="main">⟹</span> algebraic <span class="bound">x</span><span class="main">)</span> <span class="main">⟹</span> algebraic <span class="main">(</span>sum_list <span class="free">xs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> algebraic_plus<span class="main">)</span>

<span class="keyword1" id="More_Algebraic_Numbers_HLW-algebraic_prod_list"><span class="command">lemma</span></span> algebraic_prod_list <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> set <span class="free">xs</span> <span class="main">⟹</span> algebraic <span class="bound">x</span><span class="main">)</span> <span class="main">⟹</span> algebraic <span class="main">(</span>prod_list <span class="free">xs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> algebraic_times<span class="main">)</span>

<span class="keyword1" id="More_Algebraic_Numbers_HLW-algebraic_sum_mset"><span class="command">lemma</span></span> algebraic_sum_mset <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈#</span> <span class="free">A</span> <span class="main">⟹</span> algebraic <span class="bound">x</span><span class="main">)</span> <span class="main">⟹</span> algebraic <span class="main">(</span>sum_mset <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">A</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> algebraic_plus<span class="main">)</span>

<span class="keyword1" id="More_Algebraic_Numbers_HLW-algebraic_prod_mset"><span class="command">lemma</span></span> algebraic_prod_mset <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈#</span> <span class="free">A</span> <span class="main">⟹</span> algebraic <span class="bound">x</span><span class="main">)</span> <span class="main">⟹</span> algebraic <span class="main">(</span>prod_mset <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">A</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> algebraic_times<span class="main">)</span>

<span class="keyword1" id="More_Algebraic_Numbers_HLW-algebraic_power"><span class="command">lemma</span></span> algebraic_power <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"algebraic <span class="free">x</span> <span class="main">⟹</span> algebraic <span class="main">(</span><span class="free">x</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> algebraic_times<span class="main">)</span>

<span class="keyword1" id="More_Algebraic_Numbers_HLW-algebraic_csqrt"><span class="command">lemma</span></span> algebraic_csqrt <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"algebraic <span class="free">x</span> <span class="main">⟹</span> algebraic <span class="main">(</span>csqrt <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> algebraic_nth_root<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="numeral"><span class="quoted"><span class="numeral"><span class="quoted"><span class="numeral">2</span></span></span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">x</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="More_Algebraic_Numbers_HLW-algebraic_csqrt_iff"><span class="command">lemma</span></span> algebraic_csqrt_iff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"algebraic <span class="main">(</span>csqrt <span class="free">x</span><span class="main">)</span> <span class="main">⟷</span> algebraic <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"algebraic <span class="main">(</span>csqrt <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"algebraic <span class="main">(</span>csqrt <span class="free">x</span> <span class="main">^</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> algebraic_power<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"csqrt <span class="free">x</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"algebraic <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemmas</span></span> <span class="main">[</span><span class="operator">intro</span><span class="main">]</span> <span class="main">=</span> algebraic_plus algebraic_times algebraic_uminus algebraic_div

<span class="keyword1" id="More_Algebraic_Numbers_HLW-algebraic_power_iff"><span class="command">lemma</span></span> algebraic_power_iff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"algebraic <span class="main">(</span><span class="free">x</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span> <span class="main">⟷</span> algebraic <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> algebraic_nth_root<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">n</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">^</span> <span class="free">n</span>"</span></span> <span class="quoted"><span class="free">x</span></span><span class="main">]</span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="More_Algebraic_Numbers_HLW-algebraic_ii"><span class="command">lemma</span></span> algebraic_ii <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"algebraic <span class="keyword1">𝗂</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> algebraic_int_imp_algebraic<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="More_Algebraic_Numbers_HLW-algebraic_int_fact"><span class="command">lemma</span></span> algebraic_int_fact <span class="main">[</span><span class="operator">simp</span><span class="main">,</span> <span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"algebraic_int <span class="main">(</span>fact <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> int_imp_algebraic_int fact_in_Ints<span class="main">)</span>

<span class="keyword1" id="More_Algebraic_Numbers_HLW-algebraic_minus"><span class="command">lemma</span></span> algebraic_minus <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"algebraic <span class="free">x</span> <span class="main">⟹</span> algebraic <span class="free">y</span> <span class="main">⟹</span> algebraic <span class="main">(</span><span class="free">x</span> <span class="main">-</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> algebraic_plus<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="free">y</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="More_Algebraic_Numbers_HLW-algebraic_add_cancel_left"><span class="command">lemma</span></span> algebraic_add_cancel_left <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"algebraic <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"algebraic <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span> <span class="main">⟷</span> algebraic <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"algebraic <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"algebraic <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span> <span class="main">-</span> <span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> algebraic_minus<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"algebraic <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> algebraic_plus assms<span class="main">)</span>

<span class="keyword1" id="More_Algebraic_Numbers_HLW-algebraic_add_cancel_right"><span class="command">lemma</span></span> algebraic_add_cancel_right <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"algebraic <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"algebraic <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span> <span class="main">⟷</span> algebraic <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> algebraic_add_cancel_left<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">y</span></span> <span class="quoted"><span class="free">x</span></span><span class="main">]</span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add.commute <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> algebraic_add_cancel_left<span class="main">)</span>

<span class="keyword1" id="More_Algebraic_Numbers_HLW-algebraic_diff_cancel_left"><span class="command">lemma</span></span> algebraic_diff_cancel_left <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"algebraic <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"algebraic <span class="main">(</span><span class="free">x</span> <span class="main">-</span> <span class="free">y</span><span class="main">)</span> <span class="main">⟷</span> algebraic <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> algebraic_add_cancel_left<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="free">y</span>"</span></span><span class="main">]</span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> algebraic_add_cancel_left<span class="main">)</span>

<span class="keyword1" id="More_Algebraic_Numbers_HLW-algebraic_diff_cancel_right"><span class="command">lemma</span></span> algebraic_diff_cancel_right <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"algebraic <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"algebraic <span class="main">(</span><span class="free">x</span> <span class="main">-</span> <span class="free">y</span><span class="main">)</span> <span class="main">⟷</span> algebraic <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> algebraic_add_cancel_right<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="free">y</span>"</span></span> <span class="quoted"><span class="free">x</span></span><span class="main">]</span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> algebraic_add_cancel_right<span class="main">)</span>

<span class="keyword1" id="More_Algebraic_Numbers_HLW-algebraic_mult_cancel_left"><span class="command">lemma</span></span> algebraic_mult_cancel_left <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"algebraic <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"algebraic <span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="free">y</span><span class="main">)</span> <span class="main">⟷</span> algebraic <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"algebraic <span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"algebraic <span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="free">y</span> <span class="main">/</span> <span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> algebraic_div<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="free">y</span> <span class="main">/</span> <span class="free">x</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"algebraic <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> algebraic_times assms<span class="main">)</span>

<span class="keyword1" id="More_Algebraic_Numbers_HLW-algebraic_mult_cancel_right"><span class="command">lemma</span></span> algebraic_mult_cancel_right <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"algebraic <span class="free">y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"algebraic <span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="free">y</span><span class="main">)</span> <span class="main">⟷</span> algebraic <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> algebraic_mult_cancel_left<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">y</span></span> <span class="quoted"><span class="free">x</span></span><span class="main">]</span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult.commute <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> algebraic_mult_cancel_left<span class="main">)</span>

<span class="keyword1" id="More_Algebraic_Numbers_HLW-algebraic_inverse_iff"><span class="command">lemma</span></span> algebraic_inverse_iff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"algebraic <span class="main">(</span>inverse <span class="free">y</span><span class="main">)</span> <span class="main">⟷</span> algebraic <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"algebraic <span class="main">(</span>inverse <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"algebraic <span class="main">(</span>inverse <span class="main">(</span>inverse <span class="free">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> algebraic_inverse<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"algebraic <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> algebraic_inverse<span class="main">)</span>

<span class="keyword1" id="More_Algebraic_Numbers_HLW-algebraic_divide_cancel_left"><span class="command">lemma</span></span> algebraic_divide_cancel_left <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"algebraic <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"algebraic <span class="main">(</span><span class="free">x</span> <span class="main">/</span> <span class="free">y</span><span class="main">)</span> <span class="main">⟷</span> algebraic <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"algebraic <span class="main">(</span><span class="free">x</span> <span class="main">*</span> inverse <span class="free">y</span><span class="main">)</span> <span class="main">⟷</span> algebraic <span class="main">(</span>inverse <span class="free">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> algebraic_mult_cancel_left assms<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⟷</span> algebraic <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> algebraic_inverse_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="More_Algebraic_Numbers_HLW-algebraic_divide_cancel_right"><span class="command">lemma</span></span> algebraic_divide_cancel_right <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"algebraic <span class="free">y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"algebraic <span class="main">(</span><span class="free">x</span> <span class="main">/</span> <span class="free">y</span><span class="main">)</span> <span class="main">⟷</span> algebraic <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"algebraic <span class="main">(</span><span class="free">x</span> <span class="main">*</span> inverse <span class="free">y</span><span class="main">)</span> <span class="main">⟷</span> algebraic <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> algebraic_mult_cancel_right<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Turning an algebraic number into an algebraic integer›</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹
  Multiplying an algebraic number with a suitable integer turns it into an algebraic integer.
›</span></span>

<span class="keyword1" id="More_Algebraic_Numbers_HLW-algebraic_imp_algebraic_int"><span class="command">lemma</span></span> algebraic_imp_algebraic_int<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> field_char_0"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"ipoly <span class="free">p</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">≡</span> Polynomial.lead_coeff <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"algebraic_int <span class="main">(</span>of_int <span class="free">c</span> <span class="main">*</span> <span class="free">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> Polynomial.degree <span class="free">p</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">p'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p'</span> <span class="main">=</span> Abs_poly <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">i</span> <span class="main">=</span> <span class="skolem">n</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="free">c</span> <span class="main">^</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">-</span> <span class="bound">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> poly.coeff <span class="free">p</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> n_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> Nat.gr0I<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> degree_eq_zeroE<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> coeff_p'<span class="main">:</span> <span class="quoted"><span class="quoted">"poly.coeff <span class="skolem">p'</span> <span class="skolem">i</span> <span class="main">=</span>
                    <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">i</span> <span class="main">=</span> <span class="skolem">n</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="free">c</span> <span class="main">^</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">-</span> <span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> poly.coeff <span class="free">p</span> <span class="skolem">i</span><span class="main">)</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> <span class="var">?f</span> <span class="skolem">i</span>"</span></span><span class="main">)</span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span> <span class="keyword1"><span class="command">unfolding</span></span> p'_def
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">subst</span> poly.Abs_poly_inverse<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> poly.coeff <span class="free">p</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> cofinite"</span></span>
      <span class="keyword1"><span class="command">using</span></span> MOST_coeff_eq_0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="var">?f</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> cofinite"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">eventually_elim</span> <span class="main">(</span><span class="operator">use</span> assms <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="quoted">‹<span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main">:</span> n_def›</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="var">?f</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">f</span><span class="main">.</span> eventually <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="bound">f</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> cofinite<span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">have</span></span> deg_p'<span class="main">:</span> <span class="quoted"><span class="quoted">"Polynomial.degree <span class="skolem">p'</span> <span class="main">=</span> <span class="skolem">n</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">&gt;</span><span class="bound">n</span><span class="main">.</span> poly.coeff <span class="skolem">p'</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">&gt;</span><span class="bound">n</span><span class="main">.</span> poly.coeff <span class="free">p</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> coeff_p' fun_eq_iff n_def<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Polynomial.degree_def n_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">have</span></span> lead_coeff_p'<span class="main">:</span> <span class="quoted"><span class="quoted">"Polynomial.lead_coeff <span class="skolem">p'</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> coeff_p' deg_p'<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">=</span> of_int <span class="main">(</span><span class="free">c</span> <span class="main">^</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">≤</span><span class="skolem">n</span><span class="main">.</span> of_int <span class="main">(</span>poly.coeff <span class="free">p</span> <span class="bound">i</span><span class="main">)</span> <span class="main">*</span> <span class="free">x</span> <span class="main">^</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> n_def poly_altdef <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">≤</span><span class="skolem">n</span><span class="main">.</span> of_int <span class="main">(</span><span class="free">c</span> <span class="main">^</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> poly.coeff <span class="free">p</span> <span class="bound">i</span><span class="main">)</span> <span class="main">*</span> <span class="free">x</span> <span class="main">^</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_distrib_left sum_distrib_right mult_ac<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">≤</span><span class="skolem">n</span><span class="main">.</span> of_int <span class="main">(</span>poly.coeff <span class="skolem">p'</span> <span class="bound">i</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>of_int <span class="free">c</span> <span class="main">*</span> <span class="free">x</span><span class="main">)</span> <span class="main">^</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> sum.cong<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">i</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"of_int <span class="main">(</span>poly.coeff <span class="skolem">p'</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>of_int <span class="free">c</span> <span class="main">*</span> <span class="free">x</span><span class="main">)</span> <span class="main">^</span> <span class="skolem">i</span> <span class="main">=</span>
          of_int <span class="main">(</span><span class="free">c</span> <span class="main">^</span> <span class="skolem">i</span> <span class="main">*</span> poly.coeff <span class="skolem">p'</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">*</span> <span class="free">x</span> <span class="main">^</span> <span class="skolem">i</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">^</span> <span class="skolem">i</span> <span class="main">*</span> poly.coeff <span class="skolem">p'</span> <span class="skolem">i</span> <span class="main">=</span> <span class="free">c</span> <span class="main">^</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> poly.coeff <span class="free">p</span> <span class="skolem">i</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">=</span> <span class="skolem">n</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">^</span> <span class="skolem">i</span> <span class="main">*</span> poly.coeff <span class="skolem">p'</span> <span class="skolem">i</span> <span class="main">=</span> <span class="free">c</span> <span class="main">^</span> <span class="skolem">n</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> coeff_p' <span class="quasi_keyword">simp</span> <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> power_Suc<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> Suc <span class="main">(</span><span class="skolem">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">^</span> <span class="main">…</span> <span class="main">=</span> <span class="free">c</span> <span class="main">*</span> <span class="free">c</span> <span class="main">^</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> c_def n_def<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> 2
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> coeff_p' <span class="quasi_keyword">simp</span> <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> power_add<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> ipoly <span class="skolem">p'</span> <span class="main">(</span>of_int <span class="free">c</span> <span class="main">*</span> <span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> poly_altdef n_def deg_p'<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ipoly <span class="skolem">p'</span> <span class="main">(</span>of_int <span class="free">c</span> <span class="main">*</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>

  <span class="keyword1"><span class="command">with</span></span> lead_coeff_p' <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> algebraic_int_altdef_ipoly <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="More_Algebraic_Numbers_HLW-algebraic_imp_algebraic_int'"><span class="command">lemma</span></span> algebraic_imp_algebraic_int'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> field_char_0"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"ipoly <span class="free">p</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"Polynomial.lead_coeff <span class="free">p</span> <span class="keyword1">dvd</span> <span class="free">c</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"algebraic_int <span class="main">(</span>of_int <span class="free">c</span> <span class="main">*</span> <span class="free">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c'</span></span> <span class="keyword2"><span class="keyword">where</span></span> c_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">=</span> Polynomial.lead_coeff <span class="free">p</span> <span class="main">*</span> <span class="skolem">c'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"algebraic_int <span class="main">(</span>of_int <span class="skolem">c'</span> <span class="main">*</span> <span class="main">(</span>of_int <span class="main">(</span>Polynomial.lead_coeff <span class="free">p</span><span class="main">)</span> <span class="main">*</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> algebraic_int_times<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ algebraic_imp_algebraic_int<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">use</span> assms <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"of_int <span class="skolem">c'</span> <span class="main">*</span> <span class="main">(</span>of_int <span class="main">(</span>Polynomial.lead_coeff <span class="free">p</span><span class="main">)</span> <span class="main">*</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> of_int <span class="free">c</span> <span class="main">*</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> c_eq mult_ac<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="Misc_HLW">
<div class="head">
<h1>Theory Misc_HLW</h1>
</div>
<pre class="source"><span class="comment1">(*
  File:     Misc_HLW.thy
  Author:   Manuel Eberl, TU München
*)</span>
<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Miscellaneous facts›</span></span>
<span class="keyword1"><span class="command">theory</span></span> Misc_HLW
<span class="keyword2"><span class="keyword">imports</span></span>
  <a href="https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL/Complex_Main.html">Complex_Main</a>
  <span class="quoted">"<a href="https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL-Library/Multiset.html">HOL-Library.Multiset</a>"</span>
  <span class="quoted">"<a href="https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL-Library/FuncSet.html">HOL-Library.FuncSet</a>"</span>
  <span class="quoted">"<a href="https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL-Library/Groups_Big_Fun.html">HOL-Library.Groups_Big_Fun</a>"</span>
  <span class="quoted">"<a href="https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL-Library/Poly_Mapping.html">HOL-Library.Poly_Mapping</a>"</span>
  <span class="quoted">"<a href="https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL-Library/Landau_Symbols.html">HOL-Library.Landau_Symbols</a>"</span>
  <span class="quoted">"<a href="https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL-Combinatorics/Permutations.html">HOL-Combinatorics.Permutations</a>"</span>
  <span class="quoted">"<a href="https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL-Computational_Algebra/Computational_Algebra.html">HOL-Computational_Algebra.Computational_Algebra</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Misc_HLW-set_mset_subset_singletonD"><span class="command">lemma</span></span> set_mset_subset_singletonD<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"set_mset <span class="free">A</span> <span class="main">⊆</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">=</span> replicate_mset <span class="main">(</span>size <span class="free">A</span><span class="main">)</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">A</span></span><span class="main">)</span> <span class="operator">auto</span>
  
<span class="keyword1" id="Misc_HLW-image_mset_eq_replicate_msetD"><span class="command">lemma</span></span> image_mset_eq_replicate_msetD<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"image_mset <span class="free">f</span> <span class="free">A</span> <span class="main">=</span> replicate_mset <span class="free">n</span> <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈#</span><span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">`</span> set_mset <span class="free">A</span> <span class="main">=</span> set_mset <span class="main">(</span>image_mset <span class="free">f</span> <span class="free">A</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">note</span></span> assms
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Misc_HLW-bij_betw_permutes_compose_left"><span class="command">lemma</span></span> bij_betw_permutes_compose_left<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">π</span> <span class="keyword1">permutes</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"bij_betw <span class="main">(</span><span class="main">λ</span><span class="bound">σ</span><span class="main">.</span> <span class="free">π</span> <span class="main">∘</span> <span class="bound">σ</span><span class="main">)</span> <span class="main">{</span><span class="bound">σ</span><span class="main">.</span> <span class="bound">σ</span> <span class="keyword1">permutes</span> <span class="free">A</span><span class="main">}</span> <span class="main">{</span><span class="bound">σ</span><span class="main">.</span> <span class="bound">σ</span> <span class="keyword1">permutes</span> <span class="free">A</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> bij_betwI<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(∘)</span> <span class="free">π</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">σ</span><span class="main">.</span> <span class="bound">σ</span> <span class="keyword1">permutes</span> <span class="free">A</span><span class="main">}</span> <span class="main">→</span> <span class="main">{</span><span class="bound">σ</span><span class="main">.</span> <span class="bound">σ</span> <span class="keyword1">permutes</span> <span class="free">A</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> permutes_compose assms<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(∘)</span> <span class="main">(</span>inv_into UNIV <span class="free">π</span><span class="main">)</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">σ</span><span class="main">.</span> <span class="bound">σ</span> <span class="keyword1">permutes</span> <span class="free">A</span><span class="main">}</span> <span class="main">→</span> <span class="main">{</span><span class="bound">σ</span><span class="main">.</span> <span class="bound">σ</span> <span class="keyword1">permutes</span> <span class="free">A</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> permutes_compose assms permutes_inv<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> permutes_inverses<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">]</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="Misc_HLW-bij_betw_compose_left_perm_Pi"><span class="command">lemma</span></span> bij_betw_compose_left_perm_Pi<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">π</span> <span class="keyword1">permutes</span> <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"bij_betw <span class="main">(</span><span class="main">λ</span><span class="bound">f</span><span class="main">.</span> <span class="main">(</span><span class="free">π</span> <span class="main">∘</span> <span class="bound">f</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">A</span> <span class="main">→</span> <span class="free">B</span><span class="main">)</span> <span class="main">(</span><span class="free">A</span> <span class="main">→</span> <span class="free">B</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> bij_betwI<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">f</span><span class="main">.</span> <span class="main">(</span><span class="skolem">π</span> <span class="main">∘</span> <span class="bound">f</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span><span class="free">A</span> <span class="main">→</span> <span class="free">B</span><span class="main">)</span> <span class="main">→</span> <span class="free">A</span> <span class="main">→</span> <span class="free">B</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> π<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">π</span> <span class="keyword1">permutes</span> <span class="free">B</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">π</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> permutes_in_image<span class="main"><span class="main">[</span></span><span class="operator">OF</span> π<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">f</span><span class="main">.</span> <span class="main">(</span><span class="free">π</span> <span class="main">∘</span> <span class="bound">f</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span><span class="free">A</span> <span class="main">→</span> <span class="free">B</span><span class="main">)</span> <span class="main">→</span> <span class="free">A</span> <span class="main">→</span> <span class="free">B</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> *<span class="main">)</span> <span class="operator">fact</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">f</span><span class="main">.</span> <span class="main">(</span>inv_into UNIV <span class="free">π</span> <span class="main">∘</span> <span class="bound">f</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span><span class="free">A</span> <span class="main">→</span> <span class="free">B</span><span class="main">)</span> <span class="main">→</span> <span class="free">A</span> <span class="main">→</span> <span class="free">B</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> * permutes_inv<span class="main">)</span> <span class="operator">fact</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> permutes_inverses<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">]</span></span> fun_eq_iff<span class="main">)</span>

<span class="keyword1" id="Misc_HLW-bij_betw_compose_left_perm_PiE"><span class="command">lemma</span></span> bij_betw_compose_left_perm_PiE<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">π</span> <span class="keyword1">permutes</span> <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"bij_betw <span class="main">(</span><span class="main">λ</span><span class="bound">f</span><span class="main">.</span> restrict <span class="main">(</span><span class="free">π</span> <span class="main">∘</span> <span class="bound">f</span><span class="main">)</span> <span class="free">A</span><span class="main">)</span> <span class="main">(</span><span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">)</span> <span class="main">(</span><span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> bij_betwI<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">f</span><span class="main">.</span> restrict <span class="main">(</span><span class="skolem">π</span> <span class="main">∘</span> <span class="bound">f</span><span class="main">)</span> <span class="free">A</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span><span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">)</span> <span class="main">→</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> π<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">π</span> <span class="keyword1">permutes</span> <span class="free">B</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">π</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> permutes_in_image<span class="main"><span class="main">[</span></span><span class="operator">OF</span> π<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">f</span><span class="main">.</span> restrict <span class="main">(</span><span class="free">π</span> <span class="main">∘</span> <span class="bound">f</span><span class="main">)</span> <span class="free">A</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span><span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">)</span> <span class="main">→</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> *<span class="main">)</span> <span class="operator">fact</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">f</span><span class="main">.</span> restrict <span class="main">(</span>inv_into UNIV <span class="free">π</span> <span class="main">∘</span> <span class="bound">f</span><span class="main">)</span> <span class="free">A</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span><span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span><span class="main">)</span> <span class="main">→</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">B</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> * permutes_inv<span class="main">)</span> <span class="operator">fact</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> permutes_inverses<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">]</span></span> fun_eq_iff<span class="main">)</span>

<span class="keyword1" id="Misc_HLW-bij_betw_image_mset_set"><span class="command">lemma</span></span> bij_betw_image_mset_set<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="free">f</span> <span class="free">A</span> <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"image_mset <span class="free">f</span> <span class="main">(</span>mset_set <span class="free">A</span><span class="main">)</span> <span class="main">=</span> mset_set <span class="free">B</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bij_betw_def image_mset_mset_set<span class="main">)</span>

<span class="keyword1" id="Misc_HLW-finite_multisets_of_size"><span class="command">lemma</span></span> finite_multisets_of_size<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound">X</span><span class="main">.</span> set_mset <span class="bound">X</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">∧</span> size <span class="bound">X</span> <span class="main">=</span> <span class="free">n</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> finite_subset<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">X</span><span class="main">.</span> set_mset <span class="bound">X</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">∧</span> size <span class="bound">X</span> <span class="main">=</span> <span class="free">n</span><span class="main">}</span> <span class="main">⊆</span> mset <span class="main">`</span> <span class="main">{</span><span class="bound">xs</span><span class="main">.</span> set <span class="bound">xs</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">∧</span> length <span class="bound">xs</span> <span class="main">=</span> <span class="free">n</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">X</span> <span class="keyword3"><span class="command">assume</span></span> X<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">X</span><span class="main">.</span> set_mset <span class="bound">X</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">∧</span> size <span class="bound">X</span> <span class="main">=</span> <span class="free">n</span><span class="main">}</span>"</span></span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">xs</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">=</span> mset <span class="skolem">xs</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ex_mset<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">∈</span> mset <span class="main">`</span> <span class="main">{</span><span class="bound">xs</span><span class="main">.</span> set <span class="bound">xs</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">∧</span> length <span class="bound">xs</span> <span class="main">=</span> <span class="free">n</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> X <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>mset <span class="main">`</span> <span class="main">{</span><span class="bound">xs</span><span class="main">.</span> set <span class="bound">xs</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">∧</span> length <span class="bound">xs</span> <span class="main">=</span> <span class="free">n</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> finite_imageI finite_lists_length_eq assms<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Misc_HLW-sum_mset_image_mset_sum_mset_image_mset"><span class="command">lemma</span></span> sum_mset_image_mset_sum_mset_image_mset<span class="main">:</span>
   <span class="quoted"><span class="quoted">"sum_mset <span class="main">(</span>image_mset <span class="free">g</span> <span class="main">(</span>sum_mset <span class="main">(</span>image_mset <span class="free">f</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
    sum_mset <span class="main">(</span>image_mset <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> sum_mset <span class="main">(</span>image_mset <span class="free">g</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">A</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Misc_HLW-sum_mset_image_mset_singleton"><span class="command">lemma</span></span> sum_mset_image_mset_singleton<span class="main">:</span> <span class="quoted"><span class="quoted">"sum_mset <span class="main">(</span>image_mset <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">{#</span><span class="free">f</span> <span class="bound">x</span><span class="main">#}</span><span class="main">)</span> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> image_mset <span class="free">f</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">A</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Misc_HLW-sum_mset_conv_sum"><span class="command">lemma</span></span> sum_mset_conv_sum<span class="main">:</span>
  <span class="quoted"><span class="quoted">"sum_mset <span class="main">(</span>image_mset <span class="free">f</span> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span>set_mset <span class="free">A</span><span class="main">.</span> of_nat <span class="main">(</span>count <span class="free">A</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">A</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> full_multiset_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>less <span class="skolem">A</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">=</span> <span class="main">{#}</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈#</span> <span class="skolem">A</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> count <span class="skolem">A</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">A'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A'</span> <span class="main">=</span> filter_mset <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">≠</span> <span class="skolem">x</span><span class="main">)</span> <span class="skolem">A</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> A_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">=</span> replicate_mset <span class="skolem">n</span> <span class="skolem">x</span> <span class="main">+</span> <span class="skolem">A'</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> multiset_eqI<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> A'_def n_def<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∉#</span> <span class="skolem">A'</span>"</span></span> <span class="quoted"><span class="quoted">"count <span class="skolem">A'</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> A'_def<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> x <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> n_def<span class="main">)</span>
    
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum_mset <span class="main">(</span>image_mset <span class="free">f</span> <span class="skolem">A</span><span class="main">)</span> <span class="main">=</span> of_nat <span class="skolem">n</span> <span class="main">*</span> <span class="free">f</span> <span class="skolem">x</span> <span class="main">+</span> sum_mset <span class="main">(</span>image_mset <span class="free">f</span> <span class="skolem">A'</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> A_eq<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A'</span> <span class="main">⊂#</span> <span class="skolem">A</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> A'_def <span class="keyword1"><span class="command">using</span></span> x <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> filter_mset_eq_conv subset_mset_def<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> less.IH <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum_mset <span class="main">(</span>image_mset <span class="free">f</span> <span class="skolem">A'</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span>set_mset <span class="skolem">A'</span><span class="main">.</span> of_nat <span class="main">(</span>count <span class="skolem">A'</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span>set_mset <span class="skolem">A'</span><span class="main">.</span> of_nat <span class="main">(</span>count <span class="skolem">A</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.cong<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> A_eq<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"of_nat <span class="skolem">n</span> <span class="main">*</span> <span class="free">f</span> <span class="skolem">x</span> <span class="main">+</span> <span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span>insert <span class="skolem">x</span> <span class="main">(</span>set_mset <span class="skolem">A'</span><span class="main">)</span><span class="main">.</span> of_nat <span class="main">(</span>count <span class="skolem">A</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> sum.insert<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> A_eq<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"insert <span class="skolem">x</span> <span class="main">(</span>set_mset <span class="skolem">A'</span><span class="main">)</span> <span class="main">=</span> set_mset <span class="skolem">A</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> A_eq<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Misc_HLW-sum_mset_conv_Sum_any"><span class="command">lemma</span></span> sum_mset_conv_Sum_any<span class="main">:</span>
  <span class="quoted"><span class="quoted">"sum_mset <span class="main">(</span>image_mset <span class="free">f</span> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> Sum_any <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> of_nat <span class="main">(</span>count <span class="free">A</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum_mset <span class="main">(</span>image_mset <span class="free">f</span> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span>set_mset <span class="free">A</span><span class="main">.</span> of_nat <span class="main">(</span>count <span class="free">A</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum_mset_conv_sum<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> Sum_any <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> of_nat <span class="main">(</span>count <span class="free">A</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Sum_any.expand_superset <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> of_nat <span class="main">(</span>count <span class="free">A</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span><span class="main">}</span> <span class="main">⊆</span> set_mset <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> of_nat <span class="main">(</span>count <span class="free">A</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"count <span class="free">A</span> <span class="skolem">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> notI<span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈#</span> <span class="free">A</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Misc_HLW-Sum_any_sum_swap"><span class="command">lemma</span></span> Sum_any_sum_swap<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">y</span><span class="main">.</span> finite <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">≠</span> <span class="main">0</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"Sum_any <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> sum <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">y</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> Sum_any <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Sum_any <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> sum <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> Sum_any <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> Sum_any <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="bound">y</span> <span class="keyword1">when</span> <span class="bound">y</span> <span class="main">∈</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> when_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> Sum_any.conditionalize<span class="main">)</span> <span class="main">(</span><span class="operator">use</span> assms <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> Sum_any <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> Sum_any <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="bound">y</span> <span class="keyword1">when</span> <span class="bound">y</span> <span class="main">∈</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> Sum_any.swap<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">(</span></span></span><span class="main"><span class="main"><span class="main">⋃</span></span></span><span class="bound"><span class="bound"><span class="bound">y</span></span></span><span class="main"><span class="main"><span class="main">∈</span></span></span><span class="free"><span class="free"><span class="free">A</span></span></span><span class="main"><span class="main"><span class="main">.</span></span></span> <span class="main"><span class="main"><span class="main">{</span></span></span><span class="bound"><span class="bound"><span class="bound">x</span></span></span><span class="main"><span class="main"><span class="main">.</span></span></span> <span class="free"><span class="free"><span class="free">f</span></span></span> <span class="bound"><span class="bound"><span class="bound">x</span></span></span> <span class="bound"><span class="bound"><span class="bound">y</span></span></span> <span class="main"><span class="main"><span class="main">≠</span></span></span> <span class="main"><span class="main"><span class="main">0</span></span></span><span class="main"><span class="main"><span class="main">}</span></span></span><span class="main"><span class="main"><span class="main">)</span></span></span> <span class="main"><span class="main"><span class="main">×</span></span></span> <span class="free"><span class="free"><span class="free">A</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span> finite_SigmaI finite_UN_I assms<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> Sum_any <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="bound">y</span> <span class="keyword1">when</span> <span class="bound">y</span> <span class="main">∈</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> Sum_any <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span> <span class="keyword1">when</span> <span class="bound">y</span> <span class="main">∈</span> <span class="free">A</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> when_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Sum_any <span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">y</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> Sum_any <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> when_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> Sum_any.conditionalize<span class="main">)</span> <span class="main">(</span><span class="operator">use</span> assms <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> landau_pair<span class="main">)</span> big_power<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> <span class="free">L</span> <span class="free">F</span> <span class="free">g</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span> <span class="main">∈</span> <span class="free">L</span> <span class="free">F</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">g</span> <span class="bound">x</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> big_prod<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{..&lt;</span><span class="free">n</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="free">f</span>"</span></span> <span class="quoted"><span class="free">F</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="free">g</span>"</span></span><span class="main">]</span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> landau_pair<span class="main">)</span> small_power<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> <span class="free">l</span> <span class="free">F</span> <span class="free">g</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span> <span class="main">∈</span> <span class="free">l</span> <span class="free">F</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">g</span> <span class="bound">x</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">,</span>1<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> nat_induct_non_zero<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> small.mult<span class="main">)</span>

<span class="keyword1" id="Misc_HLW-pairwise_imp_disjoint_family_on"><span class="command">lemma</span></span> pairwise_imp_disjoint_family_on<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"pairwise <span class="free">R</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">m</span> <span class="bound">n</span><span class="main">.</span> <span class="bound">m</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="bound">n</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="free">R</span> <span class="bound">m</span> <span class="bound">n</span> <span class="main">⟹</span> <span class="free">f</span> <span class="bound">m</span> <span class="main">∩</span> <span class="free">f</span> <span class="bound">n</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"disjoint_family_on <span class="free">f</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">unfolding</span></span> disjoint_family_on_def pairwise_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> comm_monoid_set<span class="main">)</span> If_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"F <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">g</span> <span class="bound">x</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">y</span> <span class="keyword1">then</span> <span class="free">h1</span> <span class="bound">x</span> <span class="keyword1">else</span> <span class="free">h2</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="free">A</span> <span class="main">=</span> <span class="free">f</span> <span class="main">(</span><span class="free">g</span> <span class="free">y</span> <span class="main">(</span><span class="free">h1</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>F <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">g</span> <span class="bound">x</span> <span class="main">(</span><span class="free">h2</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">A</span><span class="main">-</span><span class="main">{</span><span class="free">y</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"F <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">g</span> <span class="bound">x</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">y</span> <span class="keyword1">then</span> <span class="free">h1</span> <span class="bound">x</span> <span class="keyword1">else</span> <span class="free">h2</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="free">A</span> <span class="main">=</span>
          <span class="free">f</span> <span class="main">(</span><span class="free">g</span> <span class="free">y</span> <span class="main">(</span><span class="free">h1</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>F <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">g</span> <span class="bound">x</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">y</span> <span class="keyword1">then</span> <span class="free">h1</span> <span class="bound">x</span> <span class="keyword1">else</span> <span class="free">h2</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">A</span><span class="main">-</span><span class="main">{</span><span class="free">y</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> remove<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">y</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"F <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">g</span> <span class="bound">x</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">y</span> <span class="keyword1">then</span> <span class="free">h1</span> <span class="bound">x</span> <span class="keyword1">else</span> <span class="free">h2</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">A</span><span class="main">-</span><span class="main">{</span><span class="free">y</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> F <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">g</span> <span class="bound">x</span> <span class="main">(</span><span class="free">h2</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">A</span><span class="main">-</span><span class="main">{</span><span class="free">y</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> cong<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Misc_HLW-prod_nonzeroI"><span class="command">lemma</span></span> prod_nonzeroI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span> <span class="main">::</span> <span class="main">{</span>semiring_no_zero_divisors<span class="main">,</span> comm_semiring_1<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"prod <span class="free">f</span> <span class="free">A</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> infinite_finite_induct<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Misc_HLW-frequently_prime_cofinite"><span class="command">lemma</span></span> frequently_prime_cofinite<span class="main">:</span> <span class="quoted"><span class="quoted">"frequently <span class="main">(</span>prime <span class="main">::</span> nat <span class="main">⇒</span> bool<span class="main">)</span> cofinite"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> INFM_nat_le <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> bigger_prime less_imp_le<span class="main">)</span>

<span class="keyword1" id="Misc_HLW-frequently_eventually_mono"><span class="command">lemma</span></span> frequently_eventually_mono<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"frequently <span class="free">Q</span> <span class="free">F</span>"</span></span> <span class="quoted"><span class="quoted">"eventually <span class="free">P</span> <span class="free">F</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="main">⟹</span> <span class="free">Q</span> <span class="bound">x</span> <span class="main">⟹</span> <span class="free">R</span> <span class="bound">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"frequently <span class="free">R</span> <span class="free">F</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> frequently_mp<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">x</span> <span class="main">⟶</span> <span class="free">R</span> <span class="bound">x</span><span class="main">)</span> <span class="free">F</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eventually_elim</span> <span class="main">(</span><span class="operator">use</span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">blast</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Misc_HLW-bij_betw_Diff"><span class="command">lemma</span></span> bij_betw_Diff<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="free">f</span> <span class="free">A</span> <span class="free">B</span>"</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="free">f</span> <span class="free">A'</span> <span class="free">B'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">A'</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">B'</span> <span class="main">⊆</span> <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"bij_betw <span class="free">f</span> <span class="main">(</span><span class="free">A</span> <span class="main">-</span> <span class="free">A'</span><span class="main">)</span> <span class="main">(</span><span class="free">B</span> <span class="main">-</span> <span class="free">B'</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> bij_betw_def
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="free">f</span> <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> bij_betw_def<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="free">f</span> <span class="main">(</span><span class="free">A</span> <span class="main">-</span> <span class="free">A'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> inj_on_subset<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">`</span> <span class="main">(</span><span class="free">A</span> <span class="main">-</span> <span class="free">A'</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="main">`</span> <span class="free">A</span> <span class="main">-</span> <span class="free">f</span> <span class="main">`</span> <span class="free">A'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> inj_on_image_set_diff<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹inj_on <span class="free">f</span> <span class="free">A</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">use</span> <span class="quoted"><span class="quoted">‹<span class="free">A'</span> <span class="main">⊆</span> <span class="free">A</span>›</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">B</span> <span class="main">-</span> <span class="free">B'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> bij_betw_def<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span><span class="main">`</span> <span class="main">(</span><span class="free">A</span> <span class="main">-</span> <span class="free">A'</span><span class="main">)</span> <span class="main">=</span> <span class="free">B</span> <span class="main">-</span> <span class="free">B'</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>
    
<span class="keyword1" id="Misc_HLW-bij_betw_singleton"><span class="command">lemma</span></span> bij_betw_singleton<span class="main">:</span> <span class="quoted"><span class="quoted">"bij_betw <span class="free">f</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span> <span class="main">{</span><span class="free">y</span><span class="main">}</span> <span class="main">⟷</span> <span class="free">f</span> <span class="free">x</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> bij_betw_def<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="Hermite_Lindemann">
<div class="head">
<h1>Theory Hermite_Lindemann</h1>
</div>
<pre class="source"><span class="comment1">(*
  File:     Hermite_Lindemann.thy
  Author:   Manuel Eberl, TU München
*)</span>
<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹The Hermite--Lindemann--Weierstraß Transcendence Theorem›</span></span>
<span class="keyword1"><span class="command">theory</span></span> Hermite_Lindemann
<span class="keyword2"><span class="keyword">imports</span></span> 
  <a href="../../pi_transcendental/theories/#Pi_Transcendental">Pi_Transcendental.Pi_Transcendental</a>
  <a href="../../algebraic_numbers/theories/#Algebraic_Numbers">Algebraic_Numbers.Algebraic_Numbers</a>
  <a href="#Algebraic_Integer_Divisibility">Algebraic_Integer_Divisibility</a>
  <a href="#Min_Int_Poly">Min_Int_Poly</a>
  <a href="#Complex_Lexorder">Complex_Lexorder</a>
  <a href="#More_Polynomial_HLW">More_Polynomial_HLW</a>
  <a href="#More_Multivariate_Polynomial_HLW">More_Multivariate_Polynomial_HLW</a>
  <a href="#More_Algebraic_Numbers_HLW">More_Algebraic_Numbers_HLW</a>
  <a href="#Misc_HLW">Misc_HLW</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The Hermite--Lindemann--Weierstraß theorem answers questions about the transcendence of
  the exponential function and other related complex functions. It proves that a large number of
  combinations of exponentials is always transcendental.

  A first (much weaker) version of the theorem was proven by Hermite. Lindemann and Weierstraß then
  successively generalised it shortly afterwards, and finally Baker gave another, arguably more
  elegant formulation (which is the one that we will prove, and then derive the traditional version
  from it).

  To honour the contributions of all three of these 19th-century mathematicians, I refer to the
  theorem as the Hermite--Lindemann--Weierstraß theorem, even though in other literature it is
  often called Hermite--Lindemann or Lindemann--Weierstraß. To keep things short, the Isabelle
  name of the theorem, however, will omit Weierstraß's name.
›</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Main proof›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Following Baker, We first prove the following special form of the theorem:
  Let $m &gt; 0$ and $q_1, \ldots, q_m \in\mathbb{Z}[X]$ be irreducible, non-constant,
  and pairwise coprime polynomials. Let $\beta_1, \ldots, \beta_m$ be non-zero integers. Then
  \[\sum_{i=1}^m \beta_i \sum_{q_i(\alpha) = 0} e^\alpha \neq 0\]

  The difference to the final theorem is that

    <span class="antiquoted"><span class="antiquoted">▸</span></span> The coefficients $\beta_i$ are non-zero integers (as opposed to arbitrary algebraic numbers)

    <span class="antiquoted"><span class="antiquoted">▸</span></span> The exponents $\alpha_i$ occur in full sets of conjugates, and each set has the same
      coefficient.

  In a similar fashion to the proofs of the transcendence of <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>e›</span></span></span></span> and <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>π›</span></span></span></span>, we define some number
  $J$ depending on the $\alpha_i$ and $\beta_i$ and an arbitrary sufficiently large prime <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>p›</span></span></span></span>. We
  then show that, on one hand, $J$ is an integer multiple of $(p-1)!$, but on the other hand it
  is bounded from above by a term of the form $C_1 \cdot C_2^p$. This is then clearly a
  contradiction if <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>p›</span></span></span></span> is chosen large enough.
›</span></span>

<span class="keyword1" id="Hermite_Lindemann-Hermite_Lindemann_aux1"><span class="command">lemma</span></span> Hermite_Lindemann_aux1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">P</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"int poly set"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">β</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"int poly <span class="main">⇒</span> int"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">P</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> distinct<span class="main">:</span> <span class="quoted"><span class="quoted">"pairwise Rings.coprime <span class="free">P</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> irred<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">p</span><span class="main">.</span> <span class="bound">p</span> <span class="main">∈</span> <span class="free">P</span> <span class="main">⟹</span> irreducible <span class="bound">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> nonconstant<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">p</span><span class="main">.</span> <span class="bound">p</span> <span class="main">∈</span> <span class="free">P</span> <span class="main">⟹</span> Polynomial.degree <span class="bound">p</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> β_nz<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">p</span><span class="main">.</span> <span class="bound">p</span> <span class="main">∈</span> <span class="free">P</span> <span class="main">⟹</span> <span class="free">β</span> <span class="bound">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">Roots</span> <span class="main">≡</span> <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="main">{</span><span class="bound">α</span><span class="main">::</span>complex<span class="main">.</span> poly <span class="main">(</span>of_int_poly <span class="bound">p</span><span class="main">)</span> <span class="bound">α</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">p</span><span class="main">∈</span><span class="free">P</span><span class="main">.</span> of_int <span class="main">(</span><span class="free">β</span> <span class="bound">p</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∑</span><span class="bound">α</span><span class="main">∈</span><span class="free">Roots</span> <span class="bound">p</span><span class="main">.</span> exp <span class="bound">α</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword1"><span class="command">note</span></span> <span class="main">[</span><span class="operator">intro</span><span class="main">]</span> <span class="main">=</span> <span class="quoted"><span class="quoted">‹finite <span class="free">P</span>›</span></span>
  <span class="keyword3"><span class="command">assume</span></span> sum_eq_0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">p</span><span class="main">∈</span><span class="free">P</span><span class="main">.</span> of_int <span class="main">(</span><span class="free">β</span> <span class="bound">p</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∑</span><span class="bound">α</span><span class="main">∈</span><span class="free">Roots</span> <span class="bound">p</span><span class="main">.</span> exp <span class="bound">α</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>

  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">Roots'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Roots'</span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">p</span><span class="main">∈</span><span class="free">P</span><span class="main">.</span> <span class="free">Roots</span> <span class="bound">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> finite_Roots <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="free">Roots</span> <span class="skolem">p</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> <span class="free">P</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">p</span>
    <span class="keyword1"><span class="command">using</span></span> nonconstant<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">p</span></span><span class="main">]</span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> poly_roots_finite <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Roots_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="skolem">Roots'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Roots'_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∉</span> <span class="free">P</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> nonconstant<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> <span class="free">P</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">p</span>
    <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
    The polynomials in <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span class="quoted">‹<span class="free"><span class="free">P</span></span>›</span></span></span></span> do not have multiple roots:
  ›</span></span>
  <span class="keyword1"><span class="command">have</span></span> rsquarefree<span class="main">:</span> <span class="quoted"><span class="quoted">"rsquarefree <span class="main">(</span>of_int_poly <span class="skolem">q</span> <span class="main">::</span> complex poly<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> <span class="free">P</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">q</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> irreducible_imp_rsquarefree_of_int_poly<span class="main">)</span> <span class="main">(</span><span class="operator">use</span> that <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="quoted">‹<span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main">:</span> irred nonconstant›</span><span class="main">)</span>

  <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
    No two different polynomials in <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span class="quoted">‹<span class="free"><span class="free">P</span></span>›</span></span></span></span> have roots in common:
  ›</span></span>
  <span class="keyword1"><span class="command">have</span></span> disjoint<span class="main">:</span> <span class="quoted"><span class="quoted">"disjoint_family_on <span class="free">Roots</span> <span class="free">P</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> distinct
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> pairwise_imp_disjoint_family_on<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span> <span class="skolem">q</span> <span class="keyword3"><span class="command">assume</span></span> P<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> <span class="free">P</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> <span class="free">P</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"Rings.coprime <span class="skolem">p</span> <span class="skolem">q</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Rings.coprime <span class="main">(</span>of_int_poly <span class="skolem">p</span> <span class="main">::</span> complex poly<span class="main">)</span> <span class="main">(</span>of_int_poly <span class="skolem">q</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> coprime_of_int_polyI<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">Roots</span> <span class="skolem">p</span> <span class="main">∩</span> <span class="free">Roots</span> <span class="skolem">q</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> poly_eq_0_coprime<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"of_int_poly <span class="skolem">p</span>"</span></span> <span class="quoted"><span class="quoted">"of_int_poly <span class="skolem">q</span> <span class="main">::</span> complex poly"</span></span><span class="main">]</span> P
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Roots_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">n_roots</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"int poly <span class="main">⇒</span> nat"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">♯</span>_"</span><span class="main">)</span>
    <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n_roots</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> card <span class="main">(</span><span class="free">Roots</span> <span class="bound">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">p</span><span class="main">∈</span><span class="free">P</span><span class="main">.</span> <span class="main"><span class="skolem">♯</span></span><span class="bound">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> n_altdef<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> card <span class="skolem">Roots'</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> n_def Roots'_def n_roots_def <span class="keyword1"><span class="command">using</span></span> disjoint
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> card_UN_disjoint<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> disjoint_family_on_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> Roots_nonempty<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Roots</span> <span class="skolem">p</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> <span class="free">P</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">p</span>
    <span class="keyword1"><span class="command">using</span></span> nonconstant<span class="main">[</span><span class="operator">OF</span> that<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Roots_def fundamental_theorem_of_algebra constant_degree<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Roots'</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Roots_nonempty <span class="quoted"><span class="quoted">‹<span class="free">P</span> <span class="main">≠</span> <span class="main">{}</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Roots'_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">Roots'</span> <span class="main">≠</span> <span class="main">{}</span>›</span></span> <span class="quoted"><span class="quoted">‹finite <span class="skolem">Roots'</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> n_altdef<span class="main">)</span>

  <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
    We can split each polynomial in <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>P›</span></span></span></span> into a product of linear factors:
  ›</span></span>
  <span class="keyword1"><span class="command">have</span></span> of_int_poly_P<span class="main">:</span>
     <span class="quoted"><span class="quoted">"of_int_poly <span class="skolem">q</span> <span class="main">=</span> Polynomial.smult <span class="main">(</span>Polynomial.lead_coeff <span class="skolem">q</span><span class="main">)</span> <span class="main">(</span><span class="main">∏</span><span class="bound">x</span><span class="main">∈</span><span class="free">Roots</span> <span class="skolem">q</span><span class="main">.</span> <span class="main">[:</span><span class="main">-</span><span class="bound">x</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span>"</span></span>
     <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> <span class="free">P</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">q</span>
    <span class="keyword1"><span class="command">using</span></span> complex_poly_decompose_rsquarefree<span class="main">[</span><span class="operator">OF</span> rsquarefree<span class="main"><span class="main">[</span></span><span class="operator">OF</span> that<span class="main"><span class="main">]</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Roots_def<span class="main">)</span>

  <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
    We let <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>l›</span></span></span></span> be an integer such that $l\alpha$ is an algebraic integer for all our roots <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>α›</span></span></span></span>:
  ›</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">l</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">LCM</span> <span class="bound">q</span><span class="main">∈</span><span class="free">P</span><span class="main">.</span> Polynomial.lead_coeff <span class="bound">q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> alg_int<span class="main">:</span> <span class="quoted"><span class="quoted">"algebraic_int <span class="main">(</span>of_int <span class="skolem">l</span> <span class="main">*</span> <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">Roots'</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> that <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> <span class="free">P</span>"</span></span> <span class="quoted"><span class="quoted">"ipoly <span class="skolem">q</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Roots'_def Roots_def<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> algebraic_imp_algebraic_int'<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">q</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">use</span> q <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="quoted">‹<span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main">:</span> l_def›</span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">P</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> l_def Lcm_0_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> l_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Lcm_int_greater_eq_0<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>

  <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
    We can split the product of all the polynomials in <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>P›</span></span></span></span> into linear factors:
  ›</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">lc_factor</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">lc_factor</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">q</span><span class="main">∈</span><span class="free">P</span><span class="main">.</span> <span class="skolem">l</span> <span class="main">^</span> Polynomial.degree <span class="bound">q</span> <span class="keyword1">div</span> Polynomial.lead_coeff <span class="bound">q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> lc_factor<span class="main">:</span> <span class="quoted"><span class="quoted">"Polynomial.smult <span class="main">(</span>of_int <span class="skolem">l</span> <span class="main">^</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span><span class="main">∏</span><span class="bound">α'</span><span class="main">∈</span><span class="skolem">Roots'</span><span class="main">.</span> <span class="main">[:</span><span class="main">-</span><span class="bound">α'</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span><span class="main">)</span> <span class="main">=</span>
                      of_int_poly <span class="main">(</span>Polynomial.smult <span class="skolem">lc_factor</span> <span class="main">(</span><span class="main">∏</span><span class="free">P</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">lc</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">lc</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">q</span><span class="main">.</span> Polynomial.lead_coeff <span class="bound">q</span> <span class="main">::</span> int<span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">d</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> <span class="main">(</span>Polynomial.degree <span class="main">::</span> int poly <span class="main">⇒</span> nat<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∏</span><span class="bound">q</span><span class="main">∈</span><span class="free">P</span><span class="main">.</span> of_int_poly <span class="bound">q</span><span class="main">)</span> <span class="main">=</span>
          <span class="main">(</span><span class="main">∏</span><span class="bound">q</span><span class="main">∈</span><span class="free">P</span><span class="main">.</span> Polynomial.smult <span class="main">(</span><span class="skolem">lc</span> <span class="bound">q</span><span class="main">)</span> <span class="main">(</span><span class="main">∏</span><span class="bound">x</span><span class="main">∈</span><span class="free">Roots</span> <span class="bound">q</span><span class="main">.</span> <span class="main">[:</span><span class="main">-</span><span class="bound">x</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span> <span class="main">::</span> complex poly<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> lc_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> prod.cong of_int_poly_P refl<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> Polynomial.smult <span class="main">(</span><span class="main">∏</span><span class="bound">q</span><span class="main">∈</span><span class="free">P</span><span class="main">.</span> <span class="skolem">lc</span> <span class="bound">q</span><span class="main">)</span> <span class="main">(</span><span class="main">∏</span><span class="bound">q</span><span class="main">∈</span><span class="free">P</span><span class="main">.</span> <span class="main">(</span><span class="main">∏</span><span class="bound">x</span><span class="main">∈</span><span class="free">Roots</span> <span class="bound">q</span><span class="main">.</span> <span class="main">[:</span><span class="main">-</span><span class="bound">x</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prod_smult<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∏</span><span class="bound">q</span><span class="main">∈</span><span class="free">P</span><span class="main">.</span> <span class="main">(</span><span class="main">∏</span><span class="bound">x</span><span class="main">∈</span><span class="free">Roots</span> <span class="bound">q</span><span class="main">.</span> <span class="main">[:</span><span class="main">-</span><span class="bound">x</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">x</span><span class="main">∈</span><span class="skolem">Roots'</span><span class="main">.</span> <span class="main">[:</span><span class="main">-</span><span class="bound">x</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> Roots'_def <span class="keyword1"><span class="command">using</span></span> disjoint
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> prod.UNION_disjoint <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> disjoint_family_on_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Polynomial.smult <span class="main">(</span>of_int <span class="skolem">lc_factor</span><span class="main">)</span> <span class="main">(</span>Polynomial.smult <span class="main">(</span><span class="main">∏</span><span class="bound">q</span><span class="main">∈</span><span class="free">P</span><span class="main">.</span> <span class="skolem">lc</span> <span class="bound">q</span><span class="main">)</span> <span class="main">…</span><span class="main">)</span> <span class="main">=</span>
               Polynomial.smult <span class="main">(</span><span class="main">∏</span><span class="bound">q</span><span class="main">∈</span><span class="free">P</span><span class="main">.</span> of_int <span class="main">(</span><span class="skolem">l</span> <span class="main">^</span> <span class="skolem">d</span> <span class="bound">q</span> <span class="keyword1">div</span> <span class="skolem">lc</span> <span class="bound">q</span> <span class="main">*</span> <span class="skolem">lc</span> <span class="bound">q</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">∏</span><span class="bound">x</span><span class="main">∈</span><span class="skolem">Roots'</span><span class="main">.</span> pCons <span class="main">(</span><span class="main">-</span> <span class="bound">x</span><span class="main">)</span> <span class="main">1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lc_factor_def prod.distrib lc_def d_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∏</span><span class="bound">q</span><span class="main">∈</span><span class="free">P</span><span class="main">.</span> of_int <span class="main">(</span><span class="skolem">l</span> <span class="main">^</span> <span class="skolem">d</span> <span class="bound">q</span> <span class="keyword1">div</span> <span class="skolem">lc</span> <span class="bound">q</span> <span class="main">*</span> <span class="skolem">lc</span> <span class="bound">q</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">q</span><span class="main">∈</span><span class="free">P</span><span class="main">.</span> of_int <span class="skolem">l</span> <span class="main">^</span> <span class="skolem">d</span> <span class="bound">q</span> <span class="main">::</span> complex<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> prod.cong<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">q</span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">lc</span> <span class="skolem">q</span> <span class="keyword1">dvd</span> <span class="skolem">l</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> l_def lc_def <span class="keyword1"><span class="command">using</span></span> 2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="keyword1">dvd</span> <span class="skolem">l</span> <span class="main">^</span> <span class="skolem">d</span> <span class="skolem">q</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> 2 nonconstant<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">q</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> dvd_power<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> d_def<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">l</span> <span class="main">^</span> <span class="main">(</span><span class="main">∑</span><span class="bound">q</span><span class="main">∈</span><span class="free">P</span><span class="main">.</span> <span class="skolem">d</span> <span class="bound">q</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power_sum<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">q</span><span class="main">∈</span><span class="free">P</span><span class="main">.</span> <span class="skolem">d</span> <span class="bound">q</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">q</span><span class="main">∈</span><span class="free">P</span><span class="main">.</span> <span class="skolem">n_roots</span> <span class="bound">q</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> sum.cong<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">q</span><span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> rsquarefree<span class="main">[</span><span class="operator">OF</span> 2<span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> rsquarefree_card_degree<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> d_def n_roots_def Roots_def<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">n</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> n_def<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> of_int_hom.map_poly_hom_smult of_int_poly_hom.hom_prod<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
    We define <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>R›</span></span></span></span> to be the radius of the smallest circle around the origin in which all our
    roots lie:
  ›</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">R</span></span> <span class="main">::</span> <span class="quoted">real</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">R</span> <span class="main">=</span> Max <span class="main">(</span>norm <span class="main">`</span> <span class="skolem">Roots'</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> R_ge<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">R</span> <span class="main">≥</span> norm <span class="skolem">α</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">α</span> <span class="main">∈</span> <span class="skolem">Roots'</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">α</span>
    <span class="keyword1"><span class="command">unfolding</span></span> R_def <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> Max_ge<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">R</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">Roots'</span> <span class="main">≠</span> <span class="main">{}</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">α</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">α</span> <span class="main">∈</span> <span class="skolem">Roots'</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> norm <span class="skolem">α</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="skolem">R</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> R_ge<span class="main">)</span> <span class="operator">fact</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">R</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
    Now the main part of the proof: for any sufficiently large prime <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>p›</span></span></span></span>, our assumptions
    imply $(p-1)! ^ n \leq C' l^{np} (2R)^{np-1}$ for some constant $C'$:    
  ›</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">C</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> real"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="skolem">l</span> <span class="main">^</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">*</span> <span class="bound">p</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="skolem">R</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">*</span> <span class="bound">p</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">C'</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="skolem">C'</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">x</span><span class="main">∈</span><span class="skolem">Roots'</span><span class="main">.</span> <span class="main">∑</span><span class="bound">q</span><span class="main">∈</span><span class="free">P</span><span class="main">.</span> real_of_int <span class="main">¦</span><span class="free">β</span> <span class="bound">q</span><span class="main">¦</span> <span class="main">*</span> <span class="main">(</span><span class="main">∑</span><span class="bound">α</span><span class="main">∈</span><span class="free">Roots</span> <span class="bound">q</span><span class="main">.</span> cmod <span class="bound">α</span> <span class="main">*</span> exp <span class="main">(</span>cmod <span class="bound">α</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
    We commence with the proof of the main inequality.
  ›</span></span>
  <span class="keyword1"><span class="command">have</span></span> ineq<span class="main">:</span> <span class="quoted"><span class="quoted">"fact <span class="main">(</span><span class="skolem">p</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="skolem">n</span> <span class="main">≤</span> <span class="skolem">C'</span> <span class="main">*</span> <span class="skolem">C</span> <span class="skolem">p</span> <span class="main">^</span> <span class="skolem">n</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"prime <span class="skolem">p</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> p_ineqs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">q</span><span class="main">∈</span><span class="free">P</span><span class="main">.</span> <span class="skolem">p</span> <span class="main">&gt;</span> <span class="main">¦</span><span class="free">β</span> <span class="bound">q</span><span class="main">¦</span>"</span></span>
                 <span class="quoted"><span class="quoted">"real <span class="skolem">p</span> <span class="main">&gt;</span> norm <span class="main">(</span><span class="main">∏</span><span class="bound">α</span><span class="main">∈</span><span class="skolem">Roots'</span><span class="main">.</span> of_int <span class="main">(</span><span class="skolem">l</span><span class="main">^</span><span class="skolem">n</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∏</span><span class="bound">x</span><span class="main">∈</span><span class="skolem">Roots'</span><span class="main">-</span><span class="main">{</span><span class="bound">α</span><span class="main">}</span><span class="main">.</span> <span class="bound">α</span> <span class="main">-</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">p</span> <span class="main">::</span> <span class="quoted">nat</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> prime_gt_1_nat<span class="main">[</span><span class="operator">OF</span> p<span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>

    <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
      We define the polynomial function
        \[f_i(X) = l^{np} \frac{\prod_\alpha (X-\alpha)^p}{X - \alpha_i}\]
      where the product runs over all roots $\alpha$.
    ›</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">f_poly</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"complex <span class="main">⇒</span> complex poly"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
      <span class="quoted"><span class="quoted">"<span class="skolem">f_poly</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">α</span><span class="main">.</span> Polynomial.smult <span class="main">(</span><span class="skolem">l</span><span class="main">^</span><span class="main">(</span><span class="skolem">n</span><span class="main">*</span><span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="main">∏</span><span class="bound">α'</span><span class="main">∈</span><span class="skolem">Roots'</span><span class="main">.</span> <span class="main">[:</span><span class="main">-</span><span class="bound">α'</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">^</span><span class="skolem">p</span><span class="main">)</span> <span class="keyword1">div</span> <span class="main">[:</span><span class="main">-</span><span class="bound">α</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> f_poly_altdef<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f_poly</span> <span class="skolem">α</span> <span class="main">=</span> Polynomial.smult <span class="main">(</span><span class="skolem">l</span><span class="main">^</span><span class="main">(</span><span class="skolem">n</span><span class="main">*</span><span class="skolem">p</span><span class="main">)</span><span class="main">)</span>
                           <span class="main">(</span><span class="main">(</span><span class="main">∏</span><span class="bound">α'</span><span class="main">∈</span><span class="skolem">Roots'</span><span class="main">.</span> <span class="main">[:</span><span class="main">-</span><span class="bound">α'</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">^</span><span class="main">(</span><span class="keyword1">if</span> <span class="bound">α'</span> <span class="main">=</span> <span class="skolem">α</span> <span class="keyword1">then</span> <span class="skolem">p</span> <span class="main">-</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">α</span> <span class="main">∈</span> <span class="skolem">Roots'</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">α</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∏</span><span class="bound">α'</span><span class="main">∈</span><span class="skolem">Roots'</span><span class="main">.</span> <span class="main">[:</span><span class="main">-</span><span class="bound">α'</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">^</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">α'</span><span class="main">=</span><span class="skolem">α</span> <span class="keyword1">then</span> <span class="skolem">p</span><span class="main">-</span><span class="main">1</span> <span class="keyword1">else</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">[:</span><span class="main">-</span><span class="skolem">α</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">=</span>
            <span class="main">[:</span><span class="main">-</span> <span class="skolem">α</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">^</span> <span class="main">(</span><span class="skolem">p</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∏</span><span class="bound">x</span><span class="main">∈</span><span class="skolem">Roots'</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">α</span><span class="main">}</span><span class="main">.</span> <span class="main">[:</span><span class="main">-</span> <span class="bound">x</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">^</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">*</span> <span class="main">[:</span><span class="main">-</span> <span class="skolem">α</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> prod.If_eq<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">x</span><span class="main">∈</span><span class="skolem">Roots'</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">α</span><span class="main">}</span><span class="main">.</span> <span class="main">[:</span><span class="main">-</span> <span class="bound">x</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">^</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">*</span> <span class="main">[:</span><span class="main">-</span> <span class="skolem">α</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">^</span> Suc <span class="main">(</span><span class="skolem">p</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> power_Suc mult_ac<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span><span class="skolem">p</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">p</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">&gt;</span> <span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∏</span><span class="bound">x</span><span class="main">∈</span><span class="skolem">Roots'</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">α</span><span class="main">}</span><span class="main">.</span> <span class="main">[:</span><span class="main">-</span> <span class="bound">x</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">^</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">*</span> <span class="main">[:</span><span class="main">-</span> <span class="skolem">α</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">^</span> <span class="skolem">p</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">x</span><span class="main">∈</span><span class="skolem">Roots'</span><span class="main">.</span> <span class="main">[:</span><span class="main">-</span> <span class="bound">x</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">^</span> <span class="skolem">p</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> prod.remove<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">α</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∏</span><span class="bound">α'</span><span class="main">∈</span><span class="skolem">Roots'</span><span class="main">.</span> <span class="main">[:</span><span class="main">-</span><span class="bound">α'</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">^</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">α'</span><span class="main">=</span><span class="skolem">α</span> <span class="keyword1">then</span> <span class="skolem">p</span><span class="main">-</span><span class="main">1</span> <span class="keyword1">else</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">[:</span><span class="main">-</span><span class="skolem">α</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">=</span>
                        <span class="main">(</span><span class="main">∏</span><span class="bound">x</span><span class="main">∈</span><span class="skolem">Roots'</span><span class="main">.</span> <span class="main">[:</span><span class="main">-</span> <span class="bound">x</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">^</span> <span class="skolem">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> f_poly_def eq<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> nonzero_mult_div_cancel_right<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"complex <span class="main">⇒</span> complex <span class="main">⇒</span> complex"</span></span>
      <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">α</span> <span class="bound">x</span><span class="main">.</span> <span class="skolem">l</span><span class="main">^</span><span class="main">(</span><span class="skolem">n</span><span class="main">*</span><span class="skolem">p</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∏</span><span class="bound">α'</span><span class="main">∈</span><span class="skolem">Roots'</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span> <span class="main">-</span> <span class="bound">α'</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="keyword1">if</span> <span class="bound">α'</span> <span class="main">=</span> <span class="bound">α</span> <span class="keyword1">then</span> <span class="skolem">p</span> <span class="main">-</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> eval_f<span class="main">:</span> <span class="quoted"><span class="quoted">"poly <span class="main">(</span><span class="skolem">f_poly</span> <span class="skolem">α</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">f</span> <span class="skolem">α</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">α</span> <span class="main">∈</span> <span class="skolem">Roots'</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">α</span> <span class="skolem">x</span>
      <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_poly_altdef poly_prod f_def<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> deg_f<span class="main">:</span> <span class="quoted"><span class="quoted">"Polynomial.degree <span class="main">(</span><span class="skolem">f_poly</span> <span class="skolem">α</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">n</span> <span class="main">*</span> <span class="skolem">p</span> <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">α</span> <span class="main">∈</span> <span class="skolem">Roots'</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">α</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Polynomial.degree <span class="main">(</span><span class="skolem">f_poly</span> <span class="skolem">α</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">p</span> <span class="main">-</span> <span class="main">1</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">p</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> f_poly_altdef<span class="main">[</span><span class="operator">OF</span> that<span class="main">]</span> <span class="keyword1"><span class="command">using</span></span> that <span class="quoted"><span class="quoted">‹<span class="skolem">l</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹finite <span class="skolem">Roots'</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> prod.If_eq<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> degree_prod_eq degree_power_eq degree_mult_eq n_altdef<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">-</span> <span class="main">1</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">p</span> <span class="main">=</span> <span class="skolem">n</span> <span class="main">*</span> <span class="skolem">p</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">&gt;</span> <span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">n</span></span><span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>

    <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
      Next, we define the function $I_i(z) = \int_0^z e^{z-t} f_i(t) \text{d}t$, and,
      based on that, the numbers $J_i = \sum_{i=1}^m \beta_i \sum_{q_i(x) = 0} I_i(x)$,
      and the number $J$, which is the product of all the $J_i$:
    ›</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">I</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"complex <span class="main">⇒</span> complex <span class="main">⇒</span> complex"</span></span>
      <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">I</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">α</span> <span class="bound">x</span><span class="main">.</span> lindemann_weierstrass_aux.I <span class="main">(</span><span class="skolem">f_poly</span> <span class="bound">α</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">J</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"complex <span class="main">⇒</span> complex"</span></span>
      <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">J</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">α</span><span class="main">.</span> <span class="main">∑</span><span class="bound">q</span><span class="main">∈</span><span class="free">P</span><span class="main">.</span> <span class="free">β</span> <span class="bound">q</span> <span class="main">*</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="free">Roots</span> <span class="bound">q</span><span class="main">.</span> <span class="skolem">I</span> <span class="bound">α</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>

    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">J'</span></span> <span class="main">::</span> <span class="quoted">complex</span>
      <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">J'</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">α</span><span class="main">∈</span><span class="skolem">Roots'</span><span class="main">.</span> <span class="skolem">J</span> <span class="bound">α</span><span class="main">)</span>"</span></span>

    <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
      Reusing some of the machinery from the proof that <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>e›</span></span></span></span> is transcendental,
      we find the following equality for $J_i$:
    ›</span></span>
    <span class="keyword1"><span class="command">have</span></span> J_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">J</span> <span class="skolem">α</span> <span class="main">=</span> <span class="main">-</span><span class="main">(</span><span class="main">∑</span><span class="bound">q</span><span class="main">∈</span><span class="free">P</span><span class="main">.</span> of_int <span class="main">(</span><span class="free">β</span> <span class="bound">q</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="free">Roots</span> <span class="bound">q</span><span class="main">.</span> <span class="main">∑</span><span class="bound">j</span><span class="main">&lt;</span><span class="skolem">n</span><span class="main">*</span><span class="skolem">p</span><span class="main">.</span> poly <span class="main">(</span><span class="main">(</span>pderiv <span class="main">^^</span> <span class="bound">j</span><span class="main">)</span> <span class="main">(</span><span class="skolem">f_poly</span> <span class="skolem">α</span><span class="main">)</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">α</span> <span class="main">∈</span> <span class="skolem">Roots'</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">α</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">*</span> <span class="skolem">p</span> <span class="main">≥</span> <span class="main">1</span> <span class="main">*</span> <span class="numeral">2</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">&gt;</span> <span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_mono<span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{..</span><span class="skolem">n</span><span class="main">*</span><span class="skolem">p</span><span class="main">-</span>Suc <span class="main">0</span><span class="main">}</span> <span class="main">=</span> <span class="main">{..&lt;</span><span class="skolem">n</span><span class="main">*</span><span class="skolem">p</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">J</span> <span class="skolem">α</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">q</span><span class="main">∈</span><span class="free">P</span><span class="main">.</span> <span class="free">β</span> <span class="bound">q</span> <span class="main">*</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="free">Roots</span> <span class="bound">q</span><span class="main">.</span> <span class="skolem">I</span> <span class="skolem">α</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> J_def <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">q</span><span class="main">∈</span><span class="free">P</span><span class="main">.</span> of_int <span class="main">(</span><span class="free">β</span> <span class="bound">q</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="free">Roots</span> <span class="bound">q</span><span class="main">.</span> exp <span class="bound">x</span> <span class="main">*</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">&lt;</span><span class="skolem">n</span><span class="main">*</span><span class="skolem">p</span><span class="main">.</span> poly <span class="main">(</span><span class="main">(</span>pderiv <span class="main">^^</span> <span class="bound">j</span><span class="main">)</span> <span class="main">(</span><span class="skolem">f_poly</span> <span class="skolem">α</span><span class="main">)</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span>
                      <span class="main">(</span><span class="main">∑</span><span class="bound">q</span><span class="main">∈</span><span class="free">P</span><span class="main">.</span> of_int <span class="main">(</span><span class="free">β</span> <span class="bound">q</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="free">Roots</span> <span class="bound">q</span><span class="main">.</span> <span class="main">∑</span><span class="bound">j</span><span class="main">&lt;</span><span class="skolem">n</span><span class="main">*</span><span class="skolem">p</span><span class="main">.</span> poly <span class="main">(</span><span class="main">(</span>pderiv <span class="main">^^</span> <span class="bound">j</span><span class="main">)</span> <span class="main">(</span><span class="skolem">f_poly</span> <span class="skolem">α</span><span class="main">)</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> I_def lindemann_weierstrass_aux.I_def
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> deg_f that ring_distribs sum_subtractf sum_distrib_left sum_distrib_right mult_ac<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">-</span><span class="main">(</span><span class="main">∑</span><span class="bound">q</span><span class="main">∈</span><span class="free">P</span><span class="main">.</span> of_int <span class="main">(</span><span class="free">β</span> <span class="bound">q</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="free">Roots</span> <span class="bound">q</span><span class="main">.</span> <span class="main">∑</span><span class="bound">j</span><span class="main">&lt;</span><span class="skolem">n</span><span class="main">*</span><span class="skolem">p</span><span class="main">.</span> poly <span class="main">(</span><span class="main">(</span>pderiv <span class="main">^^</span> <span class="bound">j</span><span class="main">)</span> <span class="main">(</span><span class="skolem">f_poly</span> <span class="skolem">α</span><span class="main">)</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> sum_distrib_right <span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> mult.assoc <span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> sum_eq_0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>

    <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
      The next big step is to show that $(p-1)! \mid J_i$ as an algebraic integer (i.e.
      $J_i / (p-1)!$ is an algebraic integer), but $p \not\mid J_i$. This is done by brute force:
      We show that every summand in the above sum has $p!$ as a factor, except for
      the one corresponding to $x = \alpha_i$, $j = p - 1$, which has $(p-1)!$ as a factor but
      not <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>p›</span></span></span></span>.
    ›</span></span>
    <span class="keyword1"><span class="command">have</span></span> J<span class="main">:</span> <span class="quoted"><span class="quoted">"fact <span class="main">(</span><span class="skolem">p</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">alg_dvd</span> <span class="skolem">J</span> <span class="skolem">α</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>of_nat <span class="skolem">p</span> <span class="keyword1">alg_dvd</span> <span class="skolem">J</span> <span class="skolem">α</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> α<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">α</span> <span class="main">∈</span> <span class="skolem">Roots'</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">α</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">h</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">α'</span> <span class="bound">j</span><span class="main">.</span> poly <span class="main">(</span><span class="main">(</span>pderiv <span class="main">^^</span> <span class="bound">j</span><span class="main">)</span> <span class="main">(</span><span class="skolem">f_poly</span> <span class="skolem">α</span><span class="main">)</span><span class="main">)</span> <span class="bound">α'</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> α <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> <span class="free">P</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">α</span> <span class="main">∈</span> <span class="free">Roots</span> <span class="skolem">q</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Roots'_def<span class="main">)</span>
  
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">J</span> <span class="skolem">α</span> <span class="main">=</span> <span class="main">-</span><span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">q</span><span class="main">,</span> <span class="bound">α'</span><span class="main">)</span><span class="main">∈</span>Sigma <span class="free">P</span> <span class="free">Roots</span><span class="main">.</span> <span class="main">∑</span><span class="bound">j</span><span class="main">&lt;</span><span class="skolem">n</span><span class="main">*</span><span class="skolem">p</span><span class="main">.</span> of_int <span class="main">(</span><span class="free">β</span> <span class="bound">q</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">h</span> <span class="bound">α'</span> <span class="bound">j</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> J_eq<span class="main">[</span><span class="operator">OF</span> α<span class="main">]</span> h_def sum_distrib_left <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> sum.Sigma<span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">-</span><span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="main">(</span><span class="bound">q</span><span class="main">,</span><span class="bound">α'</span><span class="main">)</span><span class="main">,</span><span class="bound">i</span><span class="main">)</span><span class="main">∈</span>Sigma <span class="free">P</span> <span class="free">Roots</span><span class="main">×</span><span class="main">{..&lt;</span><span class="skolem">n</span><span class="main">*</span><span class="skolem">p</span><span class="main">}</span><span class="main">.</span> of_int <span class="main">(</span><span class="free">β</span> <span class="bound">q</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">h</span> <span class="bound">α'</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> sum.Sigma <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> case_prod_unfold<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> J_eq'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">J</span> <span class="skolem">α</span> <span class="main">=</span> <span class="main">-</span> <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="main">(</span><span class="bound">q</span><span class="main">,</span> <span class="bound">α'</span><span class="main">)</span><span class="main">,</span> <span class="bound">i</span><span class="main">)</span><span class="main">∈</span>Sigma <span class="free">P</span> <span class="free">Roots</span> <span class="main">×</span> <span class="main">{..&lt;</span><span class="skolem">n</span> <span class="main">*</span> <span class="skolem">p</span><span class="main">}</span><span class="main">.</span> of_int <span class="main">(</span><span class="free">β</span> <span class="bound">q</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">h</span> <span class="bound">α'</span> <span class="bound">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  
      <span class="keyword1"><span class="command">have</span></span> h_α_pm1_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="skolem">α</span> <span class="main">(</span><span class="skolem">p</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">=</span> of_int <span class="main">(</span><span class="skolem">l</span><span class="main">^</span><span class="main">(</span><span class="skolem">n</span><span class="main">*</span><span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> fact <span class="main">(</span><span class="skolem">p</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∏</span><span class="bound">α'</span><span class="main">∈</span><span class="skolem">Roots'</span><span class="main">-</span><span class="main">{</span><span class="skolem">α</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="skolem">α</span><span class="main">-</span><span class="bound">α'</span><span class="main">)</span><span class="main">^</span><span class="skolem">p</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="skolem">α</span> <span class="main">(</span><span class="skolem">p</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> of_int <span class="main">(</span><span class="skolem">l</span> <span class="main">^</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">*</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span>
                poly <span class="main">(</span><span class="main">(</span>pderiv <span class="main">^^</span> <span class="main">(</span><span class="skolem">p</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">∏</span><span class="bound">α'</span><span class="main">∈</span><span class="skolem">Roots'</span><span class="main">.</span> <span class="main">[:</span><span class="main">-</span><span class="bound">α'</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span> <span class="main">^</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">α'</span> <span class="main">=</span> <span class="skolem">α</span> <span class="keyword1">then</span> <span class="skolem">p</span> <span class="main">-</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="skolem">α</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> h_def f_poly_altdef<span class="main">[</span><span class="operator">OF</span> α<span class="main">]</span> higher_pderiv_smult poly_smult <span class="keyword1"><span class="command">..</span></span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∏</span><span class="bound">α'</span><span class="main">∈</span><span class="skolem">Roots'</span><span class="main">.</span> <span class="main">[:</span><span class="main">-</span><span class="bound">α'</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span> <span class="main">^</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">α'</span> <span class="main">=</span> <span class="skolem">α</span> <span class="keyword1">then</span> <span class="skolem">p</span> <span class="main">-</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
                    <span class="main">[:</span><span class="main">-</span><span class="skolem">α</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span><span class="main">^</span><span class="main">(</span><span class="skolem">p</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∏</span><span class="bound">α'</span><span class="main">∈</span><span class="skolem">Roots'</span><span class="main">-</span><span class="main">{</span><span class="skolem">α</span><span class="main">}</span><span class="main">.</span> <span class="main">[:</span><span class="main">-</span><span class="bound">α'</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span><span class="main">^</span><span class="skolem">p</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> α <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> prod.If_eq<span class="main">)</span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="main">(</span><span class="main">(</span>pderiv <span class="main">^^</span> <span class="main">(</span><span class="skolem">p</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">…</span><span class="main">)</span> <span class="skolem">α</span> <span class="main">=</span> fact <span class="main">(</span><span class="skolem">p</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∏</span><span class="bound">α'</span><span class="main">∈</span><span class="skolem">Roots'</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">α</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="skolem">α</span> <span class="main">-</span> <span class="bound">α'</span><span class="main">)</span> <span class="main">^</span> <span class="skolem">p</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> poly_higher_pderiv_aux2<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> poly_prod<span class="main">)</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> mult.assoc<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
  
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fact <span class="main">(</span><span class="skolem">p</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="keyword1">alg_dvd</span> <span class="skolem">h</span> <span class="skolem">α</span> <span class="main">(</span><span class="skolem">p</span><span class="main">-</span><span class="main">1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fact <span class="main">(</span><span class="skolem">p</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="keyword1">alg_dvd</span> fact <span class="main">(</span><span class="skolem">p</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>of_int <span class="main">(</span><span class="skolem">l</span><span class="main">^</span><span class="skolem">p</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∏</span><span class="bound">α'</span><span class="main">∈</span><span class="skolem">Roots'</span><span class="main">-</span><span class="main">{</span><span class="skolem">α</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="skolem">l</span><span class="main">*</span><span class="skolem">α</span><span class="main">-</span><span class="skolem">l</span><span class="main">*</span><span class="bound">α'</span><span class="main">)</span><span class="main">^</span><span class="skolem">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> alg_dvd_triv_left algebraic_int_times<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"of_int <span class="main"><span class="main"><span class="main">(</span></span></span><span class="skolem"><span class="skolem"><span class="skolem">l</span></span></span><span class="main"><span class="main"><span class="main">^</span></span></span><span class="skolem"><span class="skolem"><span class="skolem">p</span></span></span><span class="main"><span class="main"><span class="main">)</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span>
                    algebraic_int_prod algebraic_int_power algebraic_int_diff
                    alg_int α algebraic_int_of_int<span class="main">)</span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∏</span><span class="bound">α'</span><span class="main">∈</span><span class="skolem">Roots'</span><span class="main">-</span><span class="main">{</span><span class="skolem">α</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="skolem">l</span><span class="main">*</span><span class="skolem">α</span><span class="main">-</span><span class="skolem">l</span><span class="main">*</span><span class="bound">α'</span><span class="main">)</span><span class="main">^</span><span class="skolem">p</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">α'</span><span class="main">∈</span><span class="skolem">Roots'</span><span class="main">-</span><span class="main">{</span><span class="skolem">α</span><span class="main">}</span><span class="main">.</span> of_int <span class="skolem">l</span><span class="main">^</span><span class="skolem">p</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">α</span><span class="main">-</span><span class="bound">α'</span><span class="main">)</span><span class="main">^</span><span class="skolem">p</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> power_mult_distrib <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> of_int <span class="main">(</span><span class="skolem">l</span> <span class="main">^</span> <span class="main">(</span><span class="skolem">p</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">n</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∏</span><span class="bound">α'</span><span class="main">∈</span><span class="skolem">Roots'</span><span class="main">-</span><span class="main">{</span><span class="skolem">α</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="skolem">α</span><span class="main">-</span><span class="bound">α'</span><span class="main">)</span><span class="main">^</span><span class="skolem">p</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> α <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> prod.distrib<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> card_Diff_subset n_altdef <span class="quasi_keyword">simp</span> <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> power_mult<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"of_int <span class="main">(</span><span class="skolem">l</span><span class="main">^</span><span class="skolem">p</span><span class="main">)</span> <span class="main">*</span> <span class="main">…</span> <span class="main">=</span> of_int <span class="main">(</span><span class="skolem">l</span><span class="main">^</span><span class="main">(</span><span class="skolem">p</span><span class="main">+</span><span class="skolem">p</span><span class="main">*</span><span class="main">(</span><span class="skolem">n</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∏</span><span class="bound">α'</span><span class="main">∈</span><span class="skolem">Roots'</span><span class="main">-</span><span class="main">{</span><span class="skolem">α</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="skolem">α</span><span class="main">-</span><span class="bound">α'</span><span class="main">)</span><span class="main">^</span><span class="skolem">p</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> mult.assoc <span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> power_add <span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> of_int_power <span class="keyword1"><span class="command">..</span></span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">+</span> <span class="skolem">p</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">n</span> <span class="main">*</span> <span class="skolem">p</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">n</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mult_ac<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fact <span class="main">(</span><span class="skolem">p</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>of_int <span class="main">(</span><span class="skolem">l</span><span class="main">^</span><span class="main">(</span><span class="skolem">n</span><span class="main">*</span><span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∏</span><span class="bound">α'</span><span class="main">∈</span><span class="skolem">Roots'</span><span class="main">-</span><span class="main">{</span><span class="skolem">α</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="skolem">α</span><span class="main">-</span><span class="bound">α'</span><span class="main">)</span><span class="main">^</span><span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">h</span> <span class="skolem">α</span> <span class="main">(</span><span class="skolem">p</span><span class="main">-</span><span class="main">1</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> h_α_pm1_eq <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_ac<span class="main">)</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
 
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>of_nat <span class="skolem">p</span> <span class="keyword1">alg_dvd</span> of_int <span class="main">(</span><span class="free">β</span> <span class="skolem">q</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">h</span> <span class="skolem">α</span> <span class="main">(</span><span class="skolem">p</span><span class="main">-</span><span class="main">1</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> h_α_pm1_eq mult.assoc <span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> of_int_mult <span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
      <span class="keyword1"><span class="command">proof</span></span>
        <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">α</span><span class="main">.</span> of_int <span class="main">(</span><span class="skolem">l</span><span class="main">^</span><span class="skolem">n</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∏</span><span class="bound">α'</span><span class="main">∈</span><span class="skolem">Roots'</span><span class="main">-</span><span class="main">{</span><span class="bound">α</span><span class="main">}</span><span class="main">.</span> <span class="bound">α</span><span class="main">-</span><span class="bound">α'</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> alg_int_r<span class="main">:</span> <span class="quoted"><span class="quoted">"algebraic_int <span class="main">(</span><span class="skolem">r</span> <span class="skolem">α</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">α</span> <span class="main">∈</span> <span class="skolem">Roots'</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">α</span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"algebraic_int <span class="main">(</span>of_int <span class="skolem">l</span> <span class="main">*</span> <span class="main">(</span><span class="main">∏</span><span class="bound">α'</span><span class="main">∈</span><span class="skolem">Roots'</span><span class="main">-</span><span class="main">{</span><span class="skolem">α</span><span class="main">}</span><span class="main">.</span> of_int <span class="skolem">l</span> <span class="main">*</span> <span class="skolem">α</span> <span class="main">-</span> of_int <span class="skolem">l</span> <span class="main">*</span> <span class="bound">α'</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> algebraic_int_times<span class="main"><span class="main">[</span></span><span class="operator">OF</span> algebraic_int_of_int<span class="main"><span class="main">]</span></span> algebraic_int_prod 
                      algebraic_int_power algebraic_int_diff alg_int that<span class="main">)</span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> of_int <span class="skolem">l</span> <span class="main">*</span> <span class="main">(</span><span class="main">∏</span><span class="bound">α'</span><span class="main">∈</span><span class="skolem">Roots'</span><span class="main">-</span><span class="main">{</span><span class="skolem">α</span><span class="main">}</span><span class="main">.</span> of_int <span class="skolem">l</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">α</span> <span class="main">-</span> <span class="bound">α'</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span> <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> power_mult_distrib<span class="main">)</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> of_int <span class="main">(</span><span class="skolem">l</span><span class="main">^</span><span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">n</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∏</span><span class="bound">α'</span><span class="main">∈</span><span class="skolem">Roots'</span><span class="main">-</span><span class="main">{</span><span class="skolem">α</span><span class="main">}</span><span class="main">.</span> <span class="skolem">α</span> <span class="main">-</span> <span class="bound">α'</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> r_def prod.distrib card_Diff_subset
                                     n_altdef power_add mult_ac <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> power_mult<span class="main">)</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">n</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"algebraic_int <span class="main">(</span><span class="skolem">r</span> <span class="skolem">α</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">unfolding</span></span> r_def <span class="keyword1"><span class="command">.</span></span>
        <span class="keyword1"><span class="command">qed</span></span>

        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∏</span><span class="bound">α'</span><span class="main">∈</span><span class="skolem">Roots'</span><span class="main">.</span> <span class="skolem">r</span> <span class="bound">α'</span><span class="main">)</span> <span class="main">∈</span> <span class="main">ℚ</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Root</span></span> <span class="keyword2"><span class="keyword">where</span></span> Root_bij<span class="main">:</span> <span class="quoted"><span class="quoted">"bij_betw <span class="skolem">Root</span> <span class="main">{..&lt;</span><span class="skolem">n</span><span class="main">}</span> <span class="skolem">Roots'</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> ex_bij_betw_nat_finite<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹finite <span class="skolem">Roots'</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> n_altdef atLeast0LessThan <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
          <span class="keyword1"><span class="command">have</span></span> Root_in_Roots'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Root</span> <span class="skolem">i</span> <span class="main">∈</span> <span class="skolem">Roots'</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="skolem">n</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span>
            <span class="keyword1"><span class="command">using</span></span> Root_bij that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> bij_betw_def<span class="main">)</span>

          <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">R</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"complex mpoly"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
            <span class="quoted"><span class="quoted">"<span class="skolem">R</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">i</span><span class="main">&lt;</span><span class="skolem">n</span><span class="main">.</span> Const <span class="main">(</span>of_int <span class="main">(</span><span class="skolem">l</span><span class="main">^</span><span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∏</span><span class="bound">j</span><span class="main">∈</span><span class="main">{..&lt;</span><span class="skolem">n</span><span class="main">}</span><span class="main">-</span><span class="main">{</span><span class="bound">i</span><span class="main">}</span><span class="main">.</span> Var <span class="bound">i</span> <span class="main">-</span> Var <span class="bound">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"insertion <span class="skolem">Root</span> <span class="skolem">R</span> <span class="main">∈</span> <span class="main">ℚ</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> symmetric_poly_of_roots_in_subring<span class="main">)</span>
            <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"symmetric_mpoly <span class="main">{..&lt;</span><span class="skolem">n</span><span class="main">}</span> <span class="skolem">R</span>"</span></span>
              <span class="keyword1"><span class="command">unfolding</span></span> R_def
            <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> symmetric_mpoly_symmetric_prod'<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">π</span></span><span class="main"><span class="main">.</span></span> <span class="bound"><span class="bound">π</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
              <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">i</span> <span class="skolem">π</span><span class="main">)</span>
              <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">π</span> <span class="keyword1">permutes</span> <span class="main">{..&lt;</span><span class="skolem">n</span><span class="main">}</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"bij <span class="skolem">π</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> permutes_bij<span class="main">)</span>
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"mpoly_map_vars <span class="skolem">π</span> <span class="main">(</span>Const <span class="main">(</span>of_int <span class="main">(</span><span class="skolem">l</span> <span class="main">^</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span>
                      <span class="main">(</span><span class="main">∏</span><span class="bound">j</span><span class="main">∈</span><span class="main">{..&lt;</span><span class="skolem">n</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">i</span><span class="main">}</span><span class="main">.</span> Var <span class="skolem">i</span> <span class="main">-</span> Var <span class="bound">j</span><span class="main">)</span><span class="main">::</span> complex mpoly<span class="main">)</span> <span class="main">=</span>
                    Const <span class="main">(</span>of_int <span class="skolem">l</span> <span class="main">^</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∏</span><span class="bound">j</span><span class="main">∈</span><span class="main">{..&lt;</span><span class="skolem">n</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">i</span><span class="main">}</span><span class="main">.</span> Var <span class="main">(</span><span class="skolem">π</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">-</span> Var <span class="main">(</span><span class="skolem">π</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
              <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∏</span><span class="bound">j</span><span class="main">∈</span><span class="main">{..&lt;</span><span class="skolem">n</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">i</span><span class="main">}</span><span class="main">.</span> Var <span class="main">(</span><span class="skolem">π</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">-</span> Var <span class="main">(</span><span class="skolem">π</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
                         <span class="main">(</span><span class="main">∏</span><span class="bound">j</span><span class="main">∈</span><span class="main">{..&lt;</span><span class="skolem">n</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">π</span> <span class="skolem">i</span><span class="main">}</span><span class="main">.</span> Var <span class="main">(</span><span class="skolem">π</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">-</span> Var <span class="bound">j</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> 2 permutes_in_image<span class="main">[</span><span class="operator">OF</span> 2<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">i</span></span><span class="main">]</span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> prod.reindex_bij_betw bij_betw_Diff permutes_imp_bij<span class="main"><span class="main">[</span></span><span class="operator">OF</span> 2<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
                   <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> bij_betw_singleton<span class="main">)</span>
              <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"vars <span class="skolem">R</span> <span class="main">⊆</span> <span class="main">{..&lt;</span><span class="skolem">n</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> R_def
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> order.trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> vars_prod<span class="main"><span class="main">]</span></span> UN_least order.trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> vars_mult<span class="main"><span class="main">]</span></span>
                        Un_least order.trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> vars_power<span class="main"><span class="main">]</span></span> order.trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> vars_diff<span class="main"><span class="main">]</span></span><span class="main">)</span>
                 <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> vars_Var<span class="main">)</span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"ring_closed <span class="main">(</span><span class="main">ℚ</span> <span class="main">::</span> complex set<span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">interpret</span></span> ring_closed <span class="quoted"><span class="quoted">"<span class="main">ℚ</span> <span class="main">::</span> complex set"</span></span> <span class="keyword1"><span class="command">.</span></span>              
            <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">m</span><span class="main">.</span> MPoly_Type.coeff <span class="skolem">R</span> <span class="bound">m</span> <span class="main">∈</span> <span class="main">ℚ</span>"</span></span>
              <span class="keyword1"><span class="command">unfolding</span></span> R_def
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> allI coeff_prod_closed coeff_mult_closed coeff_power_closed<span class="main">)</span>
                 <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mpoly_coeff_Const coeff_Var when_def<span class="main">)</span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?lc</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"of_int <span class="main">(</span><span class="main">∏</span><span class="bound">p</span><span class="main">∈</span><span class="free">P</span><span class="main">.</span> Polynomial.lead_coeff <span class="bound">p</span><span class="main">)</span> <span class="main">::</span> complex"</span></span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∏</span><span class="bound">q</span><span class="main">∈</span><span class="free">P</span><span class="main">.</span> of_int_poly <span class="bound">q</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">q</span><span class="main">∈</span><span class="free">P</span><span class="main">.</span> Polynomial.smult
                    <span class="main">(</span>of_int <span class="main">(</span>Polynomial.lead_coeff <span class="bound">q</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">∏</span><span class="bound">x</span><span class="main">∈</span><span class="free">Roots</span> <span class="bound">q</span><span class="main">.</span> <span class="main">[:</span><span class="main">-</span><span class="bound">x</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> prod.cong of_int_poly_P refl<span class="main">)</span>
            <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> Polynomial.smult <span class="var">?lc</span> <span class="main">(</span><span class="main">∏</span><span class="bound">q</span><span class="main">∈</span><span class="free">P</span><span class="main">.</span> <span class="main">∏</span><span class="bound">x</span><span class="main">∈</span><span class="free">Roots</span> <span class="bound">q</span><span class="main">.</span> <span class="main">[:</span><span class="main">-</span><span class="bound">x</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prod_smult<span class="main">)</span>
            <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∏</span><span class="bound">q</span><span class="main">∈</span><span class="free">P</span><span class="main">.</span> <span class="main">∏</span><span class="bound">x</span><span class="main">∈</span><span class="free">Roots</span> <span class="bound">q</span><span class="main">.</span> <span class="main">[:</span><span class="main">-</span><span class="bound">x</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">x</span><span class="main">∈</span><span class="skolem">Roots'</span><span class="main">.</span> <span class="main">[:</span><span class="main">-</span><span class="bound">x</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">unfolding</span></span> Roots'_def <span class="keyword1"><span class="command">using</span></span> disjoint
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> prod.UNION_disjoint <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> disjoint_family_on_def<span class="main">)</span>
            <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">i</span><span class="main">&lt;</span><span class="skolem">n</span><span class="main">.</span> <span class="main">[:</span><span class="main">-</span> <span class="skolem">Root</span> <span class="bound">i</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> prod.reindex_bij_betw <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> Root_bij<span class="main">)</span>
            <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"of_int_poly <span class="main">(</span><span class="main">∏</span><span class="free">P</span><span class="main">)</span> <span class="main">=</span> Polynomial.smult <span class="var">?lc</span> <span class="main">(</span><span class="main">∏</span><span class="bound">i</span><span class="main">&lt;</span><span class="skolem">n</span><span class="main">.</span> <span class="main">[:</span><span class="main">-</span> <span class="skolem">Root</span> <span class="bound">i</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> of_int_poly_hom.hom_prod<span class="main">)</span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prod Polynomial.lead_coeff <span class="free">P</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> prod_nonzeroI<span class="main">)</span> <span class="operator">auto</span>
            <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"inverse <span class="var">?lc</span> <span class="main">*</span> <span class="var">?lc</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"inverse <span class="var">?lc</span> <span class="main">∈</span> <span class="main">ℚ</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> of_int_prod<span class="main">)</span>
          <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"insertion <span class="skolem">Root</span> <span class="skolem">R</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">i</span><span class="main">&lt;</span><span class="skolem">n</span><span class="main">.</span> of_int <span class="main">(</span><span class="skolem">l</span><span class="main">^</span><span class="skolem">n</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∏</span><span class="bound">j</span><span class="main">∈</span><span class="main">{..&lt;</span><span class="skolem">n</span><span class="main">}</span><span class="main">-</span><span class="main">{</span><span class="bound">i</span><span class="main">}</span><span class="main">.</span> <span class="skolem">Root</span> <span class="bound">i</span> <span class="main">-</span> <span class="skolem">Root</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> R_def insertion_prod insertion_mult insertion_power insertion_diff<span class="main">)</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">i</span><span class="main">&lt;</span><span class="skolem">n</span><span class="main">.</span> of_int <span class="main">(</span><span class="skolem">l</span><span class="main">^</span><span class="skolem">n</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∏</span><span class="bound">α'</span><span class="main">∈</span><span class="skolem">Roots'</span><span class="main">-</span><span class="main">{</span><span class="skolem">Root</span> <span class="bound">i</span><span class="main">}</span><span class="main">.</span> <span class="skolem">Root</span> <span class="bound">i</span> <span class="main">-</span> <span class="bound">α'</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> prod.cong<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
            <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">i</span><span class="main">)</span>
            <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∏</span><span class="bound">j</span><span class="main">∈</span><span class="main">{..&lt;</span><span class="skolem">n</span><span class="main">}</span><span class="main">-</span><span class="main">{</span><span class="skolem">i</span><span class="main">}</span><span class="main">.</span> <span class="skolem">Root</span> <span class="skolem">i</span> <span class="main">-</span> <span class="skolem">Root</span> <span class="bound">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">α'</span><span class="main">∈</span><span class="skolem">Roots'</span><span class="main">-</span><span class="main">{</span><span class="skolem">Root</span> <span class="skolem">i</span><span class="main">}</span><span class="main">.</span> <span class="skolem">Root</span> <span class="skolem">i</span> <span class="main">-</span> <span class="bound">α'</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> prod.reindex_bij_betw bij_betw_Diff Root_bij<span class="main">)</span>
                 <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> Root_in_Roots' <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> bij_betw_singleton<span class="main">)</span>
            <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">α'</span><span class="main">∈</span><span class="skolem">Roots'</span><span class="main">.</span> <span class="skolem">r</span> <span class="bound">α'</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">unfolding</span></span> r_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> prod.reindex_bij_betw Root_bij<span class="main">)</span>
          <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∏</span><span class="bound">α'</span><span class="main">∈</span><span class="skolem">Roots'</span><span class="main">.</span> <span class="skolem">r</span> <span class="bound">α'</span><span class="main">)</span> <span class="main">∈</span> <span class="main">ℚ</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"algebraic_int <span class="main">(</span><span class="main">∏</span><span class="bound">α'</span><span class="main">∈</span><span class="skolem">Roots'</span><span class="main">.</span> <span class="skolem">r</span> <span class="bound">α'</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> algebraic_int_prod alg_int_r<span class="main">)</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> is_int<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∏</span><span class="bound">α'</span><span class="main">∈</span><span class="skolem">Roots'</span><span class="main">.</span> <span class="skolem">r</span> <span class="bound">α'</span><span class="main">)</span> <span class="main">∈</span> <span class="main">ℤ</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> rational_algebraic_int_is_int <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">R'</span></span> <span class="keyword2"><span class="keyword">where</span></span> R'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∏</span><span class="bound">α'</span><span class="main">∈</span><span class="skolem">Roots'</span><span class="main">.</span> <span class="skolem">r</span> <span class="bound">α'</span><span class="main">)</span> <span class="main">=</span> of_int <span class="skolem">R'</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">elim</span> Ints_cases<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∏</span><span class="bound">α'</span><span class="main">∈</span><span class="skolem">Roots'</span><span class="main">.</span> <span class="skolem">r</span> <span class="bound">α'</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">l</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> prod_nonzeroI<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> r_def <span class="quoted"><span class="quoted">‹finite <span class="skolem">Roots'</span>›</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> R' <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">R'</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"of_nat <span class="skolem">p</span> <span class="keyword1">alg_dvd</span> of_int <span class="main">(</span><span class="free">β</span> <span class="skolem">q</span> <span class="main">*</span> <span class="skolem">l</span><span class="main">^</span><span class="main">(</span><span class="skolem">n</span><span class="main">*</span><span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> fact <span class="main">(</span><span class="skolem">p</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∏</span><span class="bound">α'</span><span class="main">∈</span><span class="skolem">Roots'</span><span class="main">-</span><span class="main">{</span><span class="skolem">α</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="skolem">α</span><span class="main">-</span><span class="bound">α'</span><span class="main">)</span> <span class="main">^</span> <span class="skolem">p</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> of_int <span class="main">(</span><span class="free">β</span> <span class="skolem">q</span><span class="main">)</span> <span class="main">*</span> fact <span class="main">(</span><span class="skolem">p</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">r</span> <span class="skolem">α</span> <span class="main">^</span> <span class="skolem">p</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> r_def mult_ac power_mult_distrib power_mult prod_power_distrib<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="keyword1">alg_dvd</span> of_int <span class="main">(</span><span class="free">β</span> <span class="skolem">q</span><span class="main">)</span> <span class="main">*</span> fact <span class="main">(</span><span class="skolem">p</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">r</span> <span class="skolem">α</span> <span class="main">^</span> <span class="skolem">p</span> <span class="main">*</span> <span class="main">(</span><span class="main">∏</span><span class="bound">α'</span><span class="main">∈</span><span class="skolem">Roots'</span><span class="main">-</span><span class="main">{</span><span class="skolem">α</span><span class="main">}</span><span class="main">.</span> <span class="skolem">r</span> <span class="bound">α'</span><span class="main">)</span> <span class="main">^</span> <span class="skolem">p</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> alg_dvd_triv_left algebraic_int_prod alg_int_r algebraic_int_power<span class="main">)</span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> of_int <span class="main">(</span><span class="free">β</span> <span class="skolem">q</span><span class="main">)</span> <span class="main">*</span> fact <span class="main">(</span><span class="skolem">p</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∏</span><span class="bound">α'</span><span class="main">∈</span><span class="skolem">Roots'</span><span class="main">.</span> <span class="skolem">r</span> <span class="bound">α'</span><span class="main">)</span> <span class="main">^</span> <span class="skolem">p</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> α <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> prod.remove<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem"><span class="skolem">α</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mult_ac power_mult_distrib<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> of_int <span class="main">(</span><span class="free">β</span> <span class="skolem">q</span> <span class="main">*</span> fact <span class="main">(</span><span class="skolem">p</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">R'</span> <span class="main">^</span> <span class="skolem">p</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> R'<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"of_nat <span class="skolem">p</span> <span class="main">=</span> of_int <span class="main">(</span>int <span class="skolem">p</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"int <span class="skolem">p</span> <span class="keyword1">dvd</span> <span class="free">β</span> <span class="skolem">q</span> <span class="main">*</span> fact <span class="main">(</span><span class="skolem">p</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">R'</span> <span class="main">^</span> <span class="skolem">p</span>"</span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> alg_dvd_of_int_iff<span class="main">)</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prime <span class="main">(</span>int <span class="skolem">p</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹prime <span class="skolem">p</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"int <span class="skolem">p</span> <span class="keyword1">dvd</span> <span class="free">β</span> <span class="skolem">q</span> <span class="main">∨</span> int <span class="skolem">p</span> <span class="keyword1">dvd</span> fact <span class="main">(</span><span class="skolem">p</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">∨</span> int <span class="skolem">p</span> <span class="keyword1">dvd</span> <span class="skolem">R'</span> <span class="main">^</span> <span class="skolem">p</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prime_dvd_mult_iff<span class="main">)</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>int <span class="skolem">p</span> <span class="keyword1">dvd</span> <span class="free">β</span> <span class="skolem">q</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"int <span class="skolem">p</span> <span class="keyword1">dvd</span> <span class="free">β</span> <span class="skolem">q</span>"</span></span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"int <span class="skolem">p</span> <span class="main">≤</span> <span class="main">¦</span><span class="free">β</span> <span class="skolem">q</span><span class="main">¦</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> β_nz<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">q</span></span><span class="main">]</span> dvd_imp_le_int<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">β</span> <span class="skolem">q</span>"</span></span> <span class="quoted"><span class="quoted">"int <span class="skolem">p</span>"</span></span><span class="main">]</span> q <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">with</span></span> p_ineqs<span class="main">(</span>1<span class="main">)</span> q <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>int <span class="skolem">p</span> <span class="keyword1">dvd</span> fact <span class="main">(</span><span class="skolem">p</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="skolem">p</span> <span class="keyword1">dvd</span> fact <span class="main">(</span><span class="skolem">p</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">&gt;</span> <span class="main">1</span>›</span></span> p <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> prime_dvd_fact_iff<span class="main">)</span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>int <span class="skolem">p</span> <span class="keyword1">dvd</span> int <span class="main">(</span>fact <span class="main">(</span><span class="skolem">p</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> int_dvd_int_iff<span class="main">)</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> of_nat_fact <span class="keyword1"><span class="command">.</span></span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>int <span class="skolem">p</span> <span class="keyword1">dvd</span> <span class="skolem">R'</span> <span class="main">^</span> <span class="skolem">p</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"int <span class="skolem">p</span> <span class="keyword1">dvd</span> <span class="skolem">R'</span> <span class="main">^</span> <span class="skolem">p</span>"</span></span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"int <span class="skolem">p</span> <span class="keyword1">dvd</span> <span class="skolem">R'</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹prime <span class="main">(</span>int <span class="skolem">p</span><span class="main">)</span>›</span></span> prime_dvd_power <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"int <span class="skolem">p</span> <span class="main">≤</span> <span class="main">¦</span><span class="skolem">R'</span><span class="main">¦</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> β_nz<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">q</span></span><span class="main">]</span> dvd_imp_le_int<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">R'</span></span> <span class="quoted"><span class="quoted">"int <span class="skolem">p</span>"</span></span><span class="main">]</span> q <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"real <span class="skolem">p</span> <span class="main">≤</span> real_of_int <span class="main">¦</span><span class="skolem">R'</span><span class="main">¦</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> norm <span class="main">(</span><span class="main">∏</span><span class="bound">α</span><span class="main">∈</span><span class="skolem">Roots'</span><span class="main">.</span> <span class="skolem">r</span> <span class="bound">α</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">unfolding</span></span> R' <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">unfolding</span></span> r_def <span class="keyword1"><span class="command">using</span></span> p_ineqs<span class="main">(</span>2<span class="main">)</span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">qed</span></span>
  
      <span class="keyword1"><span class="command">have</span></span> fact_p_dvd<span class="main">:</span> <span class="quoted"><span class="quoted">"fact <span class="skolem">p</span> <span class="keyword1">alg_dvd</span> <span class="skolem">h</span> <span class="skolem">α'</span> <span class="skolem">j</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">α'</span> <span class="main">∈</span> <span class="skolem">Roots'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">α'</span> <span class="main">≠</span> <span class="skolem">α</span> <span class="main">∨</span> <span class="skolem">j</span> <span class="main">≠</span> <span class="skolem">p</span> <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">α'</span> <span class="skolem">j</span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">≥</span> <span class="skolem">p</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">with</span></span> that <span class="keyword1"><span class="command">have</span></span> j<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">α'</span> <span class="main">=</span> <span class="skolem">α</span> <span class="keyword1">then</span> <span class="skolem">p</span> <span class="main">-</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="skolem">p</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="skolem">α'</span> <span class="skolem">j</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> h_def f_poly_altdef<span class="main">[</span><span class="operator">OF</span> α<span class="main">]</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> poly_higher_pderiv_aux1'<span class="main"><span class="main">[</span></span><span class="operator">OF</span> j<span class="main"><span class="main">]</span></span> dvd_smult dvd_prodI that<span class="main">)</span> <span class="operator">auto</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">e</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">x</span> <span class="main">=</span> <span class="skolem">α</span> <span class="keyword1">then</span> <span class="skolem">p</span> <span class="main">-</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="skolem">p</span><span class="main">)</span>"</span></span>
        <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">Q</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Q</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">x</span><span class="main">∈</span><span class="skolem">Roots'</span><span class="main">.</span> <span class="main">[:</span><span class="main">-</span><span class="bound">x</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">^</span> <span class="skolem">e</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
        <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">Q'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Q'</span> <span class="main">=</span> Polynomial.smult <span class="main">(</span>of_int <span class="main">(</span><span class="skolem">l</span><span class="main">^</span><span class="main">(</span><span class="skolem">n</span><span class="main">*</span><span class="skolem">p</span><span class="main">+</span><span class="skolem">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>pcompose <span class="skolem">Q</span> <span class="main">[:</span><span class="main">0</span><span class="main">,</span> <span class="main">1</span> <span class="main">/</span> of_int <span class="skolem">l</span><span class="main">:]</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="main">(</span><span class="main">(</span>pderiv <span class="main">^^</span> <span class="skolem">j</span><span class="main">)</span> <span class="skolem">Q</span><span class="main">)</span> <span class="skolem">α'</span> <span class="main">/</span> <span class="skolem">l</span> <span class="main">^</span> <span class="skolem">j</span> <span class="main">=</span>
                poly <span class="main">(</span><span class="main">(</span>pderiv <span class="main">^^</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">(</span>pcompose <span class="skolem">Q</span> <span class="main">[:</span><span class="main">0</span><span class="main">,</span> <span class="main">1</span> <span class="main">/</span> of_int <span class="skolem">l</span><span class="main">:]</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">l</span> <span class="main">*</span> <span class="skolem">α'</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">l</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> higher_pderiv_pcompose_linear poly_pcompose <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>

        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum <span class="skolem">e</span> <span class="skolem">Roots'</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">p</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">p</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> e_def <span class="keyword1"><span class="command">using</span></span> α
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> sum.If_eq<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> card_Diff_subset n_altdef <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">n</span> <span class="main">*</span> <span class="skolem">p</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">&gt;</span> <span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">n</span></span><span class="main">)</span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"sum <span class="skolem">e</span> <span class="skolem">Roots'</span> <span class="main">=</span> <span class="skolem">n</span> <span class="main">*</span> <span class="skolem">p</span> <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>

        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="skolem">α'</span> <span class="skolem">j</span> <span class="main">=</span> of_int <span class="main">(</span><span class="skolem">l</span><span class="main">^</span><span class="main">(</span><span class="skolem">n</span><span class="main">*</span><span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> poly <span class="main">(</span><span class="main">(</span>pderiv <span class="main">^^</span> <span class="skolem">j</span><span class="main">)</span> <span class="skolem">Q</span><span class="main">)</span> <span class="skolem">α'</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> h_def f_poly_altdef<span class="main">[</span><span class="operator">OF</span> α<span class="main">]</span> higher_pderiv_smult poly_smult e_def Q_def <span class="keyword1"><span class="command">..</span></span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="main">(</span><span class="main">(</span>pderiv <span class="main">^^</span> <span class="skolem">j</span><span class="main">)</span> <span class="skolem">Q</span><span class="main">)</span> <span class="skolem">α'</span> <span class="main">=</span>
                     of_int <span class="skolem">l</span> <span class="main">^</span> <span class="skolem">j</span> <span class="main">*</span> poly <span class="main">(</span><span class="main">(</span>pderiv <span class="main">^^</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">(</span>pcompose <span class="skolem">Q</span> <span class="main">[:</span><span class="main">0</span><span class="main">,</span> <span class="main">1</span> <span class="main">/</span> of_int <span class="skolem">l</span><span class="main">:]</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">l</span> <span class="main">*</span> <span class="skolem">α'</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">l</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> higher_pderiv_pcompose_linear poly_pcompose <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"of_int <span class="main">(</span><span class="skolem">l</span> <span class="main">^</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">*</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">…</span> <span class="main">=</span> poly <span class="main">(</span><span class="main">(</span>pderiv <span class="main">^^</span> <span class="skolem">j</span><span class="main">)</span> <span class="skolem">Q'</span><span class="main">)</span> <span class="main">(</span><span class="skolem">l</span> <span class="main">*</span> <span class="skolem">α'</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Q'_def higher_pderiv_smult power_add<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fact <span class="skolem">p</span> <span class="keyword1">alg_dvd</span> <span class="main">…</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> fact_alg_dvd_poly_higher_pderiv<span class="main">)</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">≥</span> <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"algebraic_int <span class="main">(</span>of_int <span class="skolem">l</span> <span class="main">*</span> <span class="skolem">α'</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> alg_int<span class="main">)</span> <span class="operator">fact</span>
          <span class="keyword1"><span class="command">interpret</span></span> alg_int<span class="main">:</span> ring_closed <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">::</span>complex<span class="main">.</span> algebraic_int <span class="bound">x</span><span class="main">}</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">standard</span> <span class="operator">auto</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"algebraic_int <span class="main">(</span>poly.coeff <span class="skolem">Q'</span> <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≤</span> Polynomial.degree <span class="skolem">Q'</span>"</span></span><span class="main">)</span>
            <span class="keyword3"><span class="command">case</span></span> False
            <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> coeff_eq_0<span class="main">)</span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">case</span></span> True
            <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≤</span> <span class="skolem">n</span> <span class="main">*</span> <span class="skolem">p</span> <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">l</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Q'_def degree_prod_eq Q_def degree_power_eq<span class="main">)</span>
            <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">*</span> <span class="skolem">p</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">&gt;</span> <span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">*</span> <span class="skolem">p</span> <span class="main">-</span> <span class="main">1</span> <span class="main">&lt;</span> <span class="skolem">n</span> <span class="main">*</span> <span class="skolem">p</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="skolem">n</span> <span class="main">*</span> <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>

            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly.coeff <span class="skolem">Q'</span> <span class="skolem">i</span> <span class="main">=</span> of_int <span class="skolem">l</span> <span class="main">^</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">*</span> <span class="skolem">p</span> <span class="main">+</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">/</span> of_int <span class="skolem">l</span> <span class="main">^</span> <span class="skolem">i</span> <span class="main">*</span> poly.coeff <span class="skolem">Q</span> <span class="skolem">i</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Q'_def coeff_pcompose_linear <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"of_int <span class="skolem">l</span> <span class="main">^</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">*</span> <span class="skolem">p</span> <span class="main">+</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>of_int <span class="skolem">l</span> <span class="main">^</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">*</span> <span class="skolem">p</span> <span class="main">+</span> <span class="skolem">j</span> <span class="main">-</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">::</span> complex<span class="main">)</span> <span class="main">*</span> of_int <span class="skolem">l</span> <span class="main">^</span> <span class="skolem">i</span>"</span></span>
              <span class="keyword1"><span class="command">unfolding</span></span> power_add <span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">using</span></span> i <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"of_int <span class="skolem">l</span> <span class="main">^</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">*</span> <span class="skolem">p</span> <span class="main">+</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">/</span> of_int <span class="skolem">l</span> <span class="main">^</span> <span class="skolem">i</span> <span class="main">=</span> <span class="main">(</span>of_int <span class="skolem">l</span> <span class="main">^</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">*</span> <span class="skolem">p</span> <span class="main">+</span> <span class="skolem">j</span> <span class="main">-</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">::</span> complex<span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">l</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">*</span> poly.coeff <span class="skolem">Q</span> <span class="skolem">i</span> <span class="main">=</span>
                <span class="main">(</span><span class="main">∑</span><span class="bound">X</span><span class="main">∈</span><span class="main">{</span><span class="bound">X</span><span class="main">.</span> <span class="bound">X</span> <span class="main">⊆</span> <span class="main">(</span><span class="keyword1">SIGMA</span> <span class="bound">x</span><span class="main">:</span><span class="skolem">Roots'</span><span class="main">.</span> <span class="main">{..&lt;</span><span class="skolem">e</span> <span class="bound">x</span><span class="main">}</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">i</span> <span class="main">=</span> <span class="skolem">n</span> <span class="main">*</span> <span class="skolem">p</span> <span class="main">-</span> Suc <span class="main">(</span>card <span class="bound">X</span><span class="main">)</span><span class="main">}</span><span class="main">.</span>
                of_int <span class="skolem">l</span> <span class="main">^</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">*</span> <span class="skolem">p</span> <span class="main">+</span> <span class="skolem">j</span> <span class="main">-</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">*</span> <span class="skolem">p</span> <span class="main">-</span> Suc <span class="main">(</span>card <span class="bound">X</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> card <span class="bound">X</span> <span class="main">*</span> prod fst <span class="bound">X</span><span class="main">)</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">unfolding</span></span> Q_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> coeff_prod_linear_factors<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sum_distrib_left<span class="main">)</span>
            <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"algebraic_int <span class="main">…</span>"</span></span>
            <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> algebraic_int_sum<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
              <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">X</span><span class="main">)</span>
              <span class="keyword1"><span class="command">hence</span></span> X<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">⊆</span> <span class="main">(</span><span class="keyword1">SIGMA</span> <span class="bound">x</span><span class="main">:</span><span class="skolem">Roots'</span><span class="main">.</span> <span class="main">{..&lt;</span><span class="skolem">e</span> <span class="bound">x</span><span class="main">}</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">have</span></span> card_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="keyword1">SIGMA</span> <span class="bound">x</span><span class="main">:</span><span class="skolem">Roots'</span><span class="main">.</span> <span class="main">{..&lt;</span><span class="skolem">e</span> <span class="bound">x</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">n</span> <span class="main">*</span> <span class="skolem">p</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> card_SigmaI<span class="main">)</span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">from</span></span> X <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="skolem">X</span> <span class="main">≤</span> card <span class="main">(</span><span class="keyword1">SIGMA</span> <span class="bound">x</span><span class="main">:</span><span class="skolem">Roots'</span><span class="main">.</span> <span class="main">{..&lt;</span><span class="skolem">e</span> <span class="bound">x</span><span class="main">}</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> card_mono<span class="main">)</span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"card <span class="skolem">X</span> <span class="main">≤</span> <span class="skolem">n</span> <span class="main">*</span> <span class="skolem">p</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> card_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">&lt;</span> <span class="skolem">n</span> <span class="main">*</span> <span class="skolem">p</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span>  <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">*</span> <span class="skolem">p</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
              <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> card_less<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="skolem">X</span> <span class="main">&lt;</span> <span class="skolem">n</span> <span class="main">*</span> <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"algebraic_int <span class="main">(</span><span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">^</span> card <span class="skolem">X</span> <span class="main">*</span> of_int <span class="skolem">l</span> <span class="main">^</span> <span class="main">(</span><span class="skolem">j</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∏</span><span class="bound">x</span><span class="main">∈</span><span class="skolem">X</span><span class="main">.</span> of_int <span class="skolem">l</span> <span class="main">*</span> fst <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> X <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> algebraic_int_times algebraic_int_prod alg_int<span class="main">)</span> <span class="operator">auto</span>
              <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
                <span class="keyword1"><span class="command">using</span></span> card_less <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power_add prod.distrib mult_ac<span class="main">)</span>
            <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
          <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
  
      <span class="keyword1"><span class="command">have</span></span> p_dvd<span class="main">:</span> <span class="quoted"><span class="quoted">"of_nat <span class="skolem">p</span> <span class="keyword1">alg_dvd</span> <span class="skolem">h</span> <span class="skolem">α'</span> <span class="skolem">j</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">α'</span> <span class="main">∈</span> <span class="skolem">Roots'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">α'</span> <span class="main">≠</span> <span class="skolem">α</span> <span class="main">∨</span> <span class="skolem">j</span> <span class="main">≠</span> <span class="skolem">p</span> <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">α'</span> <span class="skolem">j</span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"of_nat <span class="skolem">p</span> <span class="keyword1">alg_dvd</span> <span class="main">(</span>of_nat <span class="main">(</span>fact <span class="skolem">p</span><span class="main">)</span> <span class="main">::</span> complex<span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> alg_dvd_of_nat dvd_fact<span class="main">)</span> <span class="main">(</span><span class="operator">use</span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">&gt;</span> <span class="main">1</span>›</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"of_nat <span class="skolem">p</span> <span class="keyword1">alg_dvd</span> <span class="main">(</span>fact <span class="skolem">p</span> <span class="main">::</span> complex<span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="keyword1">alg_dvd</span> <span class="skolem">h</span> <span class="skolem">α'</span> <span class="skolem">j</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> fact_p_dvd<span class="main">)</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
  
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"fact <span class="main">(</span><span class="skolem">p</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">alg_dvd</span> <span class="skolem">J</span> <span class="skolem">α</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> J_eq'
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> alg_dvd_uminus_right alg_dvd_sum<span class="main"><span class="keyword3">,</span></span> <span class="operator">safe</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> alg_dvd_mult algebraic_int_of_int<span class="main">)</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">q</span> <span class="skolem">α'</span> <span class="skolem">j</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> <span class="free">P</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">α'</span> <span class="main">∈</span> <span class="free">Roots</span> <span class="skolem">q</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> <span class="skolem">n</span> <span class="main">*</span> <span class="skolem">p</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">α'</span> <span class="main">∈</span> <span class="skolem">Roots'</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Roots'_def<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"fact <span class="main">(</span><span class="skolem">p</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">alg_dvd</span> <span class="skolem">h</span> <span class="skolem">α'</span> <span class="skolem">j</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">α'</span> <span class="main">=</span> <span class="skolem">α</span> <span class="main">∧</span> <span class="skolem">j</span> <span class="main">=</span> <span class="skolem">p</span> <span class="main">-</span> <span class="main">1</span>"</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> True
          <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹fact <span class="main">(</span><span class="skolem">p</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">alg_dvd</span> <span class="skolem">h</span> <span class="skolem">α</span> <span class="main">(</span><span class="skolem">p</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>›</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> False
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"of_int <span class="main">(</span>fact <span class="main">(</span><span class="skolem">p</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">alg_dvd</span> <span class="main">(</span>of_int <span class="main">(</span>fact <span class="skolem">p</span><span class="main">)</span> <span class="main">::</span> complex<span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> alg_dvd_of_int fact_dvd<span class="main">)</span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"fact <span class="main">(</span><span class="skolem">p</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">alg_dvd</span> <span class="main">(</span>fact <span class="skolem">p</span> <span class="main">::</span> complex<span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="keyword1">alg_dvd</span> <span class="skolem">h</span> <span class="skolem">α'</span> <span class="skolem">j</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> False <span class="quoted"><span class="quoted">‹<span class="skolem">α'</span> <span class="main">∈</span> <span class="skolem">Roots'</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> fact_p_dvd<span class="main">)</span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
  
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>of_nat <span class="skolem">p</span> <span class="keyword1">alg_dvd</span> <span class="skolem">J</span> <span class="skolem">α</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> J_eq' alg_dvd_uminus_right_iff
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> not_alg_dvd_sum<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">-</span> <span class="main">1</span> <span class="main">&lt;</span> <span class="main">1</span> <span class="main">*</span> <span class="skolem">p</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">&gt;</span> <span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">*</span> <span class="skolem">p</span> <span class="main">≤</span> <span class="skolem">n</span> <span class="main">*</span> <span class="skolem">p</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_right_mono<span class="main">)</span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="skolem">q</span><span class="main">,</span> <span class="skolem">α</span><span class="main">)</span><span class="main">,</span> <span class="skolem">p</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">∈</span> Sigma <span class="free">P</span> <span class="free">Roots</span> <span class="main">×</span> <span class="main">{..&lt;</span><span class="skolem">n</span><span class="main">*</span><span class="skolem">p</span><span class="main">}</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> q <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">z</span> <span class="keyword3"><span class="command">assume</span></span> z<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> Sigma <span class="free">P</span> <span class="free">Roots</span> <span class="main">×</span> <span class="main">{..&lt;</span><span class="skolem">n</span><span class="main">*</span><span class="skolem">p</span><span class="main">}</span><span class="main">-</span><span class="main">{</span><span class="main">(</span><span class="main">(</span><span class="skolem">q</span><span class="main">,</span><span class="skolem">α</span><span class="main">)</span><span class="main">,</span><span class="skolem">p</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">from</span></span> z <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">(</span>fst <span class="skolem">z</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">Roots'</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Roots'_def<span class="main">)</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>fst <span class="skolem">z</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">q</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">α</span> <span class="main">∈</span> <span class="free">Roots</span> <span class="main">(</span>fst <span class="main">(</span>fst <span class="skolem">z</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">α</span> <span class="main">∈</span> <span class="free">Roots</span> <span class="main">(</span>fst <span class="main">(</span>fst <span class="skolem">z</span><span class="main">)</span><span class="main">)</span> <span class="main">∩</span> <span class="free">Roots</span> <span class="skolem">q</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> <span class="free">P</span>"</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>fst <span class="skolem">z</span><span class="main">)</span> <span class="main">∈</span> <span class="free">P</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> that q z <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">with</span></span> disjoint <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">unfolding</span></span> disjoint_family_on_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"of_nat <span class="skolem">p</span> <span class="keyword1">alg_dvd</span> <span class="skolem">h</span> <span class="main">(</span>snd <span class="main">(</span>fst <span class="skolem">z</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>snd <span class="skolem">z</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> z <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> p_dvd<span class="main">)</span> <span class="operator">auto</span>
        <span class="keyword3"><span class="command">thus</span></span>  <span class="quoted"><span class="quoted">"of_nat <span class="skolem">p</span> <span class="keyword1">alg_dvd</span> <span class="main">(</span><span class="keyword1">case</span> <span class="skolem">z</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">xa</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="keyword1">case</span> <span class="bound">x</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">q</span><span class="main">,</span> <span class="bound">α'</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">λ</span><span class="bound">i</span><span class="main">.</span> of_int <span class="main">(</span><span class="free">β</span> <span class="bound">q</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">h</span> <span class="bound">α'</span> <span class="bound">i</span><span class="main">)</span> <span class="bound">xa</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> z <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span>of_nat <span class="skolem">p</span> <span class="keyword1">alg_dvd</span> of_int <span class="main">(</span><span class="free">β</span> <span class="skolem">q</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">h</span> <span class="skolem">α</span> <span class="main">(</span><span class="skolem">p</span><span class="main">-</span><span class="main">1</span><span class="main">)</span>›</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>

    <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
      Our next goal is to show that $J$ is rational. This is done by repeated applications
      of the fundamental theorem of symmetric polynomials, exploiting the fact that $J$ is
      symmetric in all the $\alpha_i$ for each set of conjugates.
    ›</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"int poly poly"</span></span>
      <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">=</span> synthetic_div <span class="main">(</span>map_poly <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">[:</span><span class="bound">x</span><span class="main">:]</span><span class="main">)</span>
                   <span class="main">(</span><span class="main">(</span>Polynomial.smult <span class="skolem">lc_factor</span> <span class="main">(</span><span class="main">∏</span><span class="free">P</span><span class="main">)</span><span class="main">)</span> <span class="main">^</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="main">[:</span><span class="main">0</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> g<span class="main">:</span> <span class="quoted"><span class="quoted">"map_poly <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> ipoly <span class="bound">p</span> <span class="skolem">α</span><span class="main">)</span> <span class="skolem">g</span> <span class="main">=</span> <span class="skolem">f_poly</span> <span class="skolem">α</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> α<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">α</span> <span class="main">∈</span> <span class="skolem">Roots'</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">α</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">interpret</span></span> α<span class="main">:</span> comm_ring_hom <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">p</span><span class="main">.</span> ipoly <span class="bound">p</span> <span class="skolem">α</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">standard</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> of_int_hom.poly_map_poly_eval_poly of_int_poly_hom.hom_mult<span class="main">)</span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">Q</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"int poly"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Q</span> <span class="main">=</span> <span class="main">(</span>Polynomial.smult <span class="skolem">lc_factor</span> <span class="main">(</span><span class="main">∏</span><span class="free">P</span><span class="main">)</span><span class="main">)</span> <span class="main">^</span> <span class="skolem">p</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f_poly</span> <span class="skolem">α</span> <span class="main">=</span> Polynomial.smult <span class="main">(</span>of_int <span class="main">(</span><span class="skolem">l</span><span class="main">^</span><span class="main">(</span><span class="skolem">n</span><span class="main">*</span><span class="skolem">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="main">∏</span><span class="bound">α'</span><span class="main">∈</span><span class="skolem">Roots'</span><span class="main">.</span> <span class="main">[:</span><span class="main">-</span><span class="bound">α'</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span><span class="main">)</span><span class="main">^</span><span class="skolem">p</span><span class="main">)</span> <span class="keyword1">div</span> <span class="main">[:</span><span class="main">-</span><span class="skolem">α</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> f_poly_def div_smult_left <span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> prod_power_distrib<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"of_int <span class="main">(</span><span class="skolem">l</span><span class="main">^</span><span class="main">(</span><span class="skolem">n</span><span class="main">*</span><span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>of_int <span class="skolem">l</span><span class="main">^</span><span class="skolem">n</span><span class="main">)</span><span class="main">^</span><span class="skolem">p</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power_mult<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Polynomial.smult <span class="main">…</span> <span class="main">(</span><span class="main">(</span><span class="main">∏</span><span class="bound">α'</span><span class="main">∈</span><span class="skolem">Roots'</span><span class="main">.</span> <span class="main">[:</span><span class="main">-</span><span class="bound">α'</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span><span class="main">)</span><span class="main">^</span><span class="skolem">p</span><span class="main">)</span> <span class="main">=</span>
                   <span class="main">(</span>Polynomial.smult <span class="main">(</span>of_int <span class="skolem">l</span> <span class="main">^</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span><span class="main">∏</span><span class="bound">α'</span><span class="main">∈</span><span class="skolem">Roots'</span><span class="main">.</span> <span class="main">[:</span><span class="main">-</span><span class="bound">α'</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span><span class="main">)</span><span class="main">)</span> <span class="main">^</span> <span class="skolem">p</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> smult_power<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> of_int_poly <span class="skolem">Q</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> lc_factor<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Q_def of_int_poly_hom.hom_power<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="keyword1">div</span> <span class="main">[:</span><span class="main">-</span><span class="skolem">α</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">=</span> synthetic_div <span class="main">(</span>of_int_poly <span class="skolem">Q</span><span class="main">)</span> <span class="skolem">α</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> synthetic_div_altdef <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> synthetic_div <span class="main">(</span>map_poly <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> ipoly <span class="bound">p</span> <span class="skolem">α</span><span class="main">)</span> <span class="main">(</span>map_poly <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">[:</span><span class="bound">x</span><span class="main">:]</span><span class="main">)</span> <span class="skolem">Q</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>ipoly <span class="main">[:</span><span class="main">0</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="skolem">α</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> map_poly_map_poly o_def<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> map_poly <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> ipoly <span class="bound">p</span> <span class="skolem">α</span><span class="main">)</span> <span class="skolem">g</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> g_def Q_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> α.synthetic_div_hom<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">qed</span></span>

    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Q</span></span> <span class="keyword2"><span class="keyword">where</span></span> Q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">J</span> <span class="skolem">α</span> <span class="main">=</span> <span class="main">-</span><span class="main">(</span><span class="main">∑</span><span class="bound">q</span><span class="main">∈</span><span class="free">P</span><span class="main">.</span> of_int <span class="main">(</span><span class="free">β</span> <span class="bound">q</span><span class="main">)</span> <span class="main">*</span> eval_poly of_rat <span class="main">(</span><span class="skolem">Q</span> <span class="bound">q</span><span class="main">)</span> <span class="skolem">α</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">α</span> <span class="main">∈</span> <span class="skolem">Roots'</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">α</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">g'</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> complex poly poly"</span></span>
        <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g'</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">j</span><span class="main">.</span>  <span class="main">(</span>map_poly of_int_poly <span class="main">(</span><span class="main">(</span>pderiv <span class="main">^^</span> <span class="bound">j</span><span class="main">)</span> <span class="skolem">g</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">root</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"int poly <span class="main">⇒</span> nat <span class="main">⇒</span> complex"</span></span>
        <span class="keyword2"><span class="keyword">where</span></span> root<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">q</span><span class="main">.</span> <span class="bound">q</span> <span class="main">∈</span> <span class="free">P</span> <span class="main">⟹</span> bij_betw <span class="main">(</span><span class="skolem">root</span> <span class="bound">q</span><span class="main">)</span> <span class="main">{..&lt;</span><span class="main"><span class="skolem">♯</span></span><span class="bound">q</span><span class="main">}</span> <span class="main">(</span><span class="free">Roots</span> <span class="bound">q</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> ex_bij_betw_nat_finite<span class="main">[</span><span class="operator">OF</span> finite_Roots<span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> n_roots_def atLeast0LessThan
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">Q'</span><span class="main">.</span> map_poly of_rat <span class="bound">Q'</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="free">Roots</span> <span class="skolem">q</span><span class="main">.</span> poly <span class="main">(</span><span class="skolem">g'</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">[:</span><span class="bound">x</span><span class="main">:]</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> <span class="free">P</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">q</span> <span class="skolem">j</span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">Q</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> complex poly mpoly"</span></span>
          <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Q</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">j</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="main"><span class="skolem">♯</span></span><span class="skolem">q</span><span class="main">.</span> mpoly_of_poly <span class="bound">i</span> <span class="main">(</span><span class="skolem">g'</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">ratpolys</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"complex poly set"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ratpolys</span> <span class="main">=</span> <span class="main">{</span><span class="bound">p</span><span class="main">.</span> <span class="main">∀</span><span class="bound">i</span><span class="main">.</span> poly.coeff <span class="bound">p</span> <span class="bound">i</span> <span class="main">∈</span> <span class="main">ℚ</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"insertion <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">[:</span><span class="bound">x</span><span class="main">:]</span><span class="main">)</span> <span class="main">∘</span> <span class="skolem">root</span> <span class="skolem">q</span><span class="main">)</span> <span class="main">(</span><span class="skolem">Q</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">ratpolys</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> symmetric_poly_of_roots_in_subring<span class="main">)</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"ring_closed <span class="skolem">ratpolys</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">standard</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ratpolys_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> coeff_mult_semiring_closed<span class="main">)</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">m</span><span class="main">.</span> MPoly_Type.coeff <span class="main">(</span><span class="skolem">Q</span> <span class="skolem">j</span><span class="main">)</span> <span class="bound">m</span> <span class="main">∈</span> <span class="skolem">ratpolys</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Q_def ratpolys_def Polynomial.coeff_sum coeff_mpoly_of_poly when_def g'_def
                     <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> sum_in_Rats<span class="main">)</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"vars <span class="main">(</span><span class="skolem">Q</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">{..&lt;</span><span class="main"><span class="skolem">♯</span></span><span class="skolem">q</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> Q_def
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> order.trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> vars_sum<span class="main"><span class="main">]</span></span> UN_least order.trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> vars_mpoly_of_poly<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"symmetric_mpoly <span class="main">{..&lt;</span><span class="main"><span class="skolem">♯</span></span><span class="skolem">q</span><span class="main">}</span> <span class="main">(</span><span class="skolem">Q</span> <span class="skolem">j</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> Q_def
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> symmetric_mpoly_symmetric_sum<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">id</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> permutes_bij<span class="main">)</span>
          <span class="keyword1"><span class="command">interpret</span></span> coeff_lift_hom<span class="main">:</span> map_poly_idom_hom <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">[:</span><span class="bound">x</span><span class="main">:]</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">standard</span>
          <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">lc</span></span> <span class="main">::</span> <span class="quoted">complex</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">lc</span> <span class="main">=</span> of_int <span class="main">(</span>Polynomial.lead_coeff <span class="skolem">q</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"of_int_poly <span class="skolem">q</span> <span class="main">=</span> Polynomial.smult <span class="main">(</span>Polynomial.lead_coeff <span class="skolem">q</span><span class="main">)</span> <span class="main">(</span><span class="main">∏</span><span class="bound">x</span><span class="main">∈</span><span class="free">Roots</span> <span class="skolem">q</span><span class="main">.</span> <span class="main">[:</span><span class="main">-</span><span class="bound">x</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> of_int_poly_P<span class="main">)</span> <span class="operator">fact</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly_lift <span class="main">…</span> <span class="main">=</span> Polynomial.smult <span class="main">[:</span><span class="skolem">lc</span><span class="main">:]</span> <span class="main">(</span><span class="main">∏</span><span class="bound">a</span><span class="main">∈</span><span class="free">Roots</span> <span class="skolem">q</span><span class="main">.</span> <span class="main">[:</span><span class="main">-</span><span class="main">[:</span><span class="bound">a</span><span class="main">:]</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> poly_lift_def map_poly_smult coeff_lift_hom.hom_prod lc_def<span class="main">)</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∏</span><span class="bound">a</span><span class="main">∈</span><span class="free">Roots</span> <span class="skolem">q</span><span class="main">.</span> <span class="main">[:</span><span class="main">-</span><span class="main">[:</span><span class="bound">a</span><span class="main">:]</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">i</span><span class="main">&lt;</span><span class="main"><span class="skolem">♯</span></span><span class="skolem">q</span><span class="main">.</span> <span class="main">[:</span><span class="main">-</span><span class="main">[:</span><span class="skolem">root</span> <span class="skolem">q</span> <span class="bound">i</span><span class="main">:]</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> prod.reindex_bij_betw <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> root q<span class="main">)</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">i</span><span class="main">&lt;</span><span class="main"><span class="skolem">♯</span></span><span class="skolem">q</span><span class="main">.</span> <span class="main">[:</span><span class="main">-</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">[:</span><span class="bound">x</span><span class="main">:]</span><span class="main">)</span> <span class="main">∘</span> <span class="skolem">root</span> <span class="skolem">q</span><span class="main">)</span> <span class="bound">i</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"poly_lift <span class="main">(</span>Ring_Hom_Poly.of_int_poly <span class="skolem">q</span><span class="main">)</span> <span class="main">=</span> Polynomial.smult <span class="main">[:</span><span class="skolem">lc</span><span class="main">:]</span> <span class="main">…</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">lc</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> q <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> lc_def<span class="main">)</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">[:</span>inverse <span class="skolem">lc</span><span class="main">:]</span> <span class="main">*</span> <span class="main">[:</span><span class="skolem">lc</span><span class="main">:]</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ratpolys_def coeff_pCons <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> nat.splits<span class="main">)</span>

        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"insertion <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">[:</span><span class="bound">x</span><span class="main">:]</span><span class="main">)</span> <span class="main">∘</span> <span class="skolem">root</span> <span class="skolem">q</span><span class="main">)</span> <span class="main">(</span><span class="skolem">Q</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="main"><span class="skolem">♯</span></span><span class="skolem">q</span><span class="main">.</span> poly <span class="main">(</span><span class="skolem">g'</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">[:</span><span class="skolem">root</span> <span class="skolem">q</span> <span class="bound">i</span><span class="main">:]</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Q_def insertion_sum poly_sum<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="free">Roots</span> <span class="skolem">q</span><span class="main">.</span> poly <span class="main">(</span><span class="skolem">g'</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">[:</span><span class="bound">x</span><span class="main">:]</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.reindex_bij_betw root q<span class="main">)</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">.</span> poly.coeff <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="free">Roots</span> <span class="skolem">q</span><span class="main">.</span> poly <span class="main">(</span><span class="skolem">g'</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">[:</span><span class="bound">x</span><span class="main">:]</span><span class="main">)</span> <span class="bound">i</span> <span class="main">∈</span> <span class="main">ℚ</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ratpolys_def<span class="main">)</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> ratpolyE <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Q</span></span> <span class="keyword2"><span class="keyword">where</span></span> Q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">q</span> <span class="bound">j</span><span class="main">.</span> <span class="bound">q</span> <span class="main">∈</span> <span class="free">P</span> <span class="main">⟹</span> map_poly of_rat <span class="main">(</span><span class="skolem">Q</span> <span class="bound">q</span> <span class="bound">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="free">Roots</span> <span class="bound">q</span><span class="main">.</span> poly <span class="main">(</span><span class="skolem">g'</span> <span class="bound">j</span><span class="main">)</span> <span class="main">[:</span><span class="bound">x</span><span class="main">:]</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">Q'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Q'</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">q</span><span class="main">.</span> <span class="main">∑</span><span class="bound">j</span><span class="main">&lt;</span><span class="skolem">n</span><span class="main">*</span><span class="skolem">p</span><span class="main">.</span> <span class="skolem">Q</span> <span class="bound">q</span> <span class="bound">j</span><span class="main">)</span>"</span></span>

      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">J</span> <span class="skolem">α</span> <span class="main">=</span> <span class="main">-</span> <span class="main">(</span><span class="main">∑</span><span class="bound">q</span><span class="main">∈</span><span class="free">P</span><span class="main">.</span> of_int <span class="main">(</span><span class="free">β</span> <span class="bound">q</span><span class="main">)</span> <span class="main">*</span> eval_poly of_rat <span class="main">(</span><span class="skolem">Q'</span> <span class="bound">q</span><span class="main">)</span> <span class="skolem">α</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> α<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">α</span> <span class="main">∈</span> <span class="skolem">Roots'</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">α</span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">J</span> <span class="skolem">α</span> <span class="main">=</span> <span class="main">-</span><span class="main">(</span><span class="main">∑</span><span class="bound">q</span><span class="main">∈</span><span class="free">P</span><span class="main">.</span> of_int <span class="main">(</span><span class="free">β</span> <span class="bound">q</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="free">Roots</span> <span class="bound">q</span><span class="main">.</span> <span class="main">∑</span><span class="bound">j</span><span class="main">&lt;</span><span class="skolem">n</span> <span class="main">*</span> <span class="skolem">p</span><span class="main">.</span> poly <span class="main">(</span><span class="main">(</span>pderiv <span class="main">^^</span> <span class="bound">j</span><span class="main">)</span> <span class="main">(</span><span class="skolem">f_poly</span> <span class="skolem">α</span><span class="main">)</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> <span class="main">-</span><span class="var">?S</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> J_eq<span class="main">[</span><span class="operator">OF</span> α<span class="main">]</span> <span class="keyword1"><span class="command">..</span></span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?S</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">q</span><span class="main">∈</span><span class="free">P</span><span class="main">.</span> of_int <span class="main">(</span><span class="free">β</span> <span class="bound">q</span><span class="main">)</span> <span class="main">*</span> eval_poly of_rat <span class="main">(</span><span class="skolem">Q'</span> <span class="bound">q</span><span class="main">)</span> <span class="skolem">α</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sum.cong<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> q<span class="main">:</span> <span class="main">(</span>2 <span class="skolem">q</span><span class="main">)</span>
          <span class="keyword1"><span class="command">interpret</span></span> α<span class="main">:</span> idom_hom <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">p</span><span class="main">.</span> ipoly <span class="bound">p</span> <span class="skolem">α</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">standard</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> of_int_hom.poly_map_poly_eval_poly of_int_poly_hom.hom_mult<span class="main">)</span>
  
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="free">Roots</span> <span class="skolem">q</span><span class="main">.</span> <span class="main">∑</span><span class="bound">j</span><span class="main">&lt;</span><span class="skolem">n</span> <span class="main">*</span> <span class="skolem">p</span><span class="main">.</span> poly <span class="main">(</span><span class="main">(</span>pderiv <span class="main">^^</span> <span class="bound">j</span><span class="main">)</span> <span class="main">(</span><span class="skolem">f_poly</span> <span class="skolem">α</span><span class="main">)</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span>
                <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">&lt;</span><span class="skolem">n</span> <span class="main">*</span> <span class="skolem">p</span><span class="main">.</span> <span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="free">Roots</span> <span class="skolem">q</span><span class="main">.</span> poly <span class="main">(</span><span class="main">(</span>pderiv <span class="main">^^</span> <span class="bound">j</span><span class="main">)</span> <span class="main">(</span><span class="skolem">f_poly</span> <span class="skolem">α</span><span class="main">)</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.swap<span class="main">)</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">&lt;</span><span class="skolem">n</span> <span class="main">*</span> <span class="skolem">p</span><span class="main">.</span> eval_poly of_rat <span class="main">(</span><span class="skolem">Q</span> <span class="skolem">q</span> <span class="bound">j</span><span class="main">)</span> <span class="skolem">α</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sum.cong<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
            <span class="keyword3"><span class="command">case</span></span> j<span class="main">:</span> <span class="main">(</span>2 <span class="skolem">j</span><span class="main">)</span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="free">Roots</span> <span class="skolem">q</span><span class="main">.</span> poly <span class="main">(</span><span class="main">(</span>pderiv <span class="main">^^</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">(</span><span class="skolem">f_poly</span> <span class="skolem">α</span><span class="main">)</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span>
                  <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="free">Roots</span> <span class="skolem">q</span><span class="main">.</span> poly <span class="main">(</span>poly <span class="main">(</span><span class="skolem">g'</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">[:</span><span class="bound">x</span><span class="main">:]</span><span class="main">)</span> <span class="skolem">α</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sum.cong<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
              <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">x</span><span class="main">)</span>
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="main">(</span><span class="main">(</span>pderiv <span class="main">^^</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">(</span><span class="skolem">f_poly</span> <span class="skolem">α</span><span class="main">)</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">=</span>
                    poly <span class="main">(</span><span class="main">(</span>pderiv <span class="main">^^</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">(</span>map_poly <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> ipoly <span class="bound">p</span> <span class="skolem">α</span><span class="main">)</span> <span class="skolem">g</span><span class="main">)</span><span class="main">)</span> <span class="skolem">x</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> g<span class="main"><span class="main">[</span></span><span class="operator">OF</span> α<span class="main"><span class="main">,</span></span> <span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">rule</span> refl<span class="main">)</span>
              <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> poly <span class="main">(</span>eval_poly <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="main">[:</span>poly <span class="bound">p</span> <span class="skolem">α</span><span class="main">:]</span><span class="main">)</span> <span class="main">∘</span> of_int_poly<span class="main">)</span> <span class="main">(</span><span class="main">(</span>pderiv <span class="main">^^</span> <span class="skolem">j</span><span class="main">)</span> <span class="skolem">g</span><span class="main">)</span> <span class="main">[:</span><span class="main">0</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span> <span class="skolem">x</span>"</span></span>
                <span class="keyword1"><span class="command">unfolding</span></span> o_def α.map_poly_higher_pderiv <span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> α.map_poly_eval_poly<span class="main">)</span>
              <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> poly <span class="main">(</span>eval_poly <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="main">[:</span>poly <span class="bound">p</span> <span class="skolem">α</span><span class="main">:]</span><span class="main">)</span>
                                <span class="main">(</span>map_poly of_int_poly <span class="main">(</span><span class="main">(</span>pderiv <span class="main">^^</span> <span class="skolem">j</span><span class="main">)</span> <span class="skolem">g</span><span class="main">)</span><span class="main">)</span> <span class="main">[:</span><span class="main">0</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span> <span class="skolem">x</span>"</span></span>
                <span class="keyword1"><span class="command">unfolding</span></span> eval_poly_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> map_poly_map_poly<span class="main">)</span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> poly <span class="main">(</span>poly <span class="main">(</span>map_poly of_int_poly <span class="main">(</span><span class="main">(</span>pderiv <span class="main">^^</span> <span class="skolem">j</span><span class="main">)</span> <span class="skolem">g</span><span class="main">)</span><span class="main">)</span> <span class="main">[:</span><span class="skolem">x</span><span class="main">:]</span><span class="main">)</span> <span class="skolem">α</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> poly_poly_eq <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
              <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> poly <span class="main">(</span>poly <span class="main">(</span><span class="skolem">g'</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">[:</span><span class="skolem">x</span><span class="main">:]</span><span class="main">)</span> <span class="skolem">α</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> g'_def<span class="main">)</span>
              <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">.</span></span>
            <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> poly <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="free">Roots</span> <span class="skolem">q</span><span class="main">.</span> poly <span class="main">(</span><span class="skolem">g'</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">[:</span><span class="bound">x</span><span class="main">:]</span><span class="main">)</span> <span class="skolem">α</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> poly_sum<span class="main">)</span>
            <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> eval_poly of_rat <span class="main">(</span><span class="skolem">Q</span> <span class="skolem">q</span> <span class="skolem">j</span><span class="main">)</span> <span class="skolem">α</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> q <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Q eval_poly_def<span class="main">)</span>
            <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">.</span></span>
          <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> eval_poly of_rat <span class="main">(</span><span class="skolem">Q'</span> <span class="skolem">q</span><span class="main">)</span> <span class="skolem">α</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Q'_def of_rat_hom.eval_poly_sum<span class="main">)</span>
          <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">J</span> <span class="skolem">α</span> <span class="main">=</span> <span class="main">-</span> <span class="main">(</span><span class="main">∑</span><span class="bound">q</span><span class="main">∈</span><span class="free">P</span><span class="main">.</span> of_int <span class="main">(</span><span class="free">β</span> <span class="bound">q</span><span class="main">)</span> <span class="main">*</span> eval_poly of_rat <span class="main">(</span><span class="skolem">Q'</span> <span class="bound">q</span><span class="main">)</span> <span class="skolem">α</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> that<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">Q'</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">qed</span></span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">J'</span> <span class="main">∈</span> <span class="main">ℚ</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∏</span><span class="bound">α</span><span class="main">∈</span><span class="free">Roots</span> <span class="skolem">q</span><span class="main">.</span> <span class="skolem">J</span> <span class="bound">α</span><span class="main">)</span> <span class="main">∈</span> <span class="main">ℚ</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> <span class="free">P</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">q</span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">root</span></span> <span class="keyword2"><span class="keyword">where</span></span> root<span class="main">:</span> <span class="quoted"><span class="quoted">"bij_betw <span class="skolem">root</span> <span class="main">{..&lt;</span><span class="main"><span class="skolem">♯</span></span><span class="skolem">q</span><span class="main">}</span> <span class="main">(</span><span class="free">Roots</span> <span class="skolem">q</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> ex_bij_betw_nat_finite<span class="main">[</span><span class="operator">OF</span> finite_Roots<span class="main"><span class="main">[</span></span><span class="operator">OF</span> q<span class="main"><span class="main">]</span></span><span class="main">]</span>
          <span class="keyword1"><span class="command">unfolding</span></span> atLeast0LessThan n_roots_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
        <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">Q'</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"complex poly"</span></span>
          <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Q'</span> <span class="main">=</span> <span class="main">-</span><span class="main">(</span><span class="main">∑</span><span class="bound">q</span><span class="main">∈</span><span class="free">P</span><span class="main">.</span> Polynomial.smult <span class="main">(</span>of_int <span class="main">(</span><span class="free">β</span> <span class="bound">q</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>map_poly of_rat <span class="main">(</span><span class="skolem">Q</span> <span class="bound">q</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∏</span><span class="bound">α</span><span class="main">∈</span><span class="free">Roots</span> <span class="skolem">q</span><span class="main">.</span> <span class="skolem">J</span> <span class="bound">α</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">α</span><span class="main">∈</span><span class="free">Roots</span> <span class="skolem">q</span><span class="main">.</span> <span class="main">-</span><span class="main">(</span><span class="main">∑</span><span class="bound">q</span><span class="main">∈</span><span class="free">P</span><span class="main">.</span> of_int <span class="main">(</span><span class="free">β</span> <span class="bound">q</span><span class="main">)</span> <span class="main">*</span> eval_poly of_rat <span class="main">(</span><span class="skolem">Q</span> <span class="bound">q</span><span class="main">)</span> <span class="bound">α</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> prod.cong refl Q<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Roots'_def q<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">α</span><span class="main">∈</span><span class="free">Roots</span> <span class="skolem">q</span><span class="main">.</span> poly <span class="skolem">Q'</span> <span class="bound">α</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Q'_def poly_sum eval_poly_def<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">i</span><span class="main">&lt;</span><span class="main"><span class="skolem">♯</span></span><span class="skolem">q</span><span class="main">.</span> poly <span class="skolem">Q'</span> <span class="main">(</span><span class="skolem">root</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> prod.reindex_bij_betw <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> root<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> insertion <span class="skolem">root</span> <span class="main">(</span><span class="main">∏</span><span class="bound">i</span><span class="main">&lt;</span><span class="main"><span class="skolem">♯</span></span><span class="skolem">q</span><span class="main">.</span> mpoly_of_poly <span class="bound">i</span> <span class="skolem">Q'</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> insertion_prod<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">∈</span> <span class="main">ℚ</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> symmetric_poly_of_roots_in_subring<span class="main">)</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"ring_closed <span class="main">(</span><span class="main">ℚ</span> <span class="main">::</span> complex set<span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">standard</span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">interpret</span></span> Q<span class="main">:</span> ring_closed <span class="quoted"><span class="quoted">"<span class="main">ℚ</span> <span class="main">::</span> complex set"</span></span> <span class="keyword1"><span class="command">.</span></span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">m</span><span class="main">.</span> MPoly_Type.coeff <span class="main">(</span><span class="main">∏</span><span class="bound">i</span><span class="main">&lt;</span><span class="main"><span class="skolem">♯</span></span><span class="skolem">q</span><span class="main">.</span> mpoly_of_poly <span class="bound">i</span> <span class="skolem">Q'</span><span class="main">)</span> <span class="bound">m</span> <span class="main">∈</span> <span class="main">ℚ</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> Q.coeff_prod_closed sum_in_Rats
                     <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> coeff_mpoly_of_poly when_def Q'_def Polynomial.coeff_sum<span class="main">)</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"symmetric_mpoly <span class="main">{..&lt;</span><span class="main"><span class="skolem">♯</span></span><span class="skolem">q</span><span class="main">}</span> <span class="main">(</span><span class="main">∏</span><span class="bound">i</span><span class="main">&lt;</span><span class="main"><span class="skolem">♯</span></span><span class="skolem">q</span><span class="main">.</span> mpoly_of_poly <span class="bound">i</span> <span class="skolem">Q'</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> symmetric_mpoly_symmetric_prod'<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">id</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> permutes_bij<span class="main">)</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"vars <span class="main">(</span><span class="main">∏</span><span class="bound">i</span><span class="main">&lt;</span><span class="main"><span class="skolem">♯</span></span><span class="skolem">q</span><span class="main">.</span> mpoly_of_poly <span class="bound">i</span> <span class="skolem">Q'</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">{..&lt;</span><span class="main"><span class="skolem">♯</span></span><span class="skolem">q</span><span class="main">}</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> order.trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> vars_prod<span class="main"><span class="main">]</span></span> order.trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> vars_mpoly_of_poly<span class="main"><span class="main">]</span></span> UN_least<span class="main">)</span> <span class="operator">auto</span>
          <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">lc</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">lc</span> <span class="main">=</span> <span class="main">(</span>of_int <span class="main">(</span>Polynomial.lead_coeff <span class="skolem">q</span><span class="main">)</span> <span class="main">::</span> complex<span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"of_int_poly <span class="skolem">q</span> <span class="main">=</span> Polynomial.smult <span class="skolem">lc</span> <span class="main">(</span><span class="main">∏</span><span class="bound">x</span><span class="main">∈</span><span class="free">Roots</span> <span class="skolem">q</span><span class="main">.</span> <span class="main">[:</span><span class="main">-</span> <span class="bound">x</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">unfolding</span></span> lc_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> of_int_poly_P<span class="main">)</span> <span class="operator">fact</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∏</span><span class="bound">x</span><span class="main">∈</span><span class="free">Roots</span> <span class="skolem">q</span><span class="main">.</span> <span class="main">[:</span><span class="main">-</span> <span class="bound">x</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">i</span><span class="main">&lt;</span><span class="main"><span class="skolem">♯</span></span><span class="skolem">q</span><span class="main">.</span> <span class="main">[:</span><span class="main">-</span> <span class="skolem">root</span> <span class="bound">i</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> prod.reindex_bij_betw <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> root<span class="main">)</span>
          <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"of_int_poly <span class="skolem">q</span> <span class="main">=</span> Polynomial.smult <span class="skolem">lc</span> <span class="main">(</span><span class="main">∏</span><span class="bound">i</span><span class="main">&lt;</span><span class="main"><span class="skolem">♯</span></span><span class="skolem">q</span><span class="main">.</span> <span class="main">[:</span><span class="main">-</span> <span class="skolem">root</span> <span class="bound">i</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">lc</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> q <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> lc_def<span class="main">)</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"inverse <span class="skolem">lc</span> <span class="main">*</span> <span class="skolem">lc</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"inverse <span class="skolem">lc</span> <span class="main">∈</span> <span class="main">ℚ</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> lc_def<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∏</span><span class="bound">q</span><span class="main">∈</span><span class="free">P</span><span class="main">.</span> <span class="main">∏</span><span class="bound">α</span><span class="main">∈</span><span class="free">Roots</span> <span class="bound">q</span><span class="main">.</span> <span class="skolem">J</span> <span class="bound">α</span><span class="main">)</span> <span class="main">∈</span> <span class="main">ℚ</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> prod_in_Rats<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∏</span><span class="bound">q</span><span class="main">∈</span><span class="free">P</span><span class="main">.</span> <span class="main">∏</span><span class="bound">α</span><span class="main">∈</span><span class="free">Roots</span> <span class="bound">q</span><span class="main">.</span> <span class="skolem">J</span> <span class="bound">α</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">J'</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> Roots'_def J'_def <span class="keyword1"><span class="command">using</span></span> disjoint
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> prod.UNION_disjoint <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> disjoint_family_on_def<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">J'</span> <span class="main">∈</span> <span class="main">ℚ</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>

    <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
      Since <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>J'›</span></span></span></span> is clearly an algebraic integer, we now know that it is in fact an integer.
    ›</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"algebraic_int <span class="skolem">J'</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> J'_def 
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> algebraic_int_prod<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">Roots'</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"fact <span class="main">(</span><span class="skolem">p</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">alg_dvd</span> <span class="skolem">J</span> <span class="skolem">x</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> J<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"algebraic_int <span class="main">(</span><span class="skolem">J</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> alg_dvd_imp_algebraic_int<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">J'</span> <span class="main">∈</span> <span class="main">ℤ</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> rational_algebraic_int_is_int <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

    <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
      It is also non-zero, as none of the $J_i$ have $p$ as a factor and such cannot be zero.
    ›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">J'</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> J'_def
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> prod_nonzeroI<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">α</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">α</span> <span class="main">∈</span> <span class="skolem">Roots'</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>of_nat <span class="skolem">p</span> <span class="keyword1">alg_dvd</span> <span class="skolem">J</span> <span class="skolem">α</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> J<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">α</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">J</span> <span class="skolem">α</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>

    <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
      It then clearly follows that $(p-1)!^n \leq J$:
    ›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fact <span class="main">(</span><span class="skolem">p</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="skolem">n</span> <span class="keyword1">alg_dvd</span> <span class="skolem">J'</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fact <span class="main">(</span><span class="skolem">p</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="skolem">n</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">α</span><span class="main">∈</span><span class="skolem">Roots'</span><span class="main">.</span> fact <span class="main">(</span><span class="skolem">p</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> n_altdef<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="keyword1">alg_dvd</span> <span class="skolem">J'</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> J'_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> prod_alg_dvd_prod J<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fact <span class="main">(</span><span class="skolem">p</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="skolem">n</span> <span class="main">≤</span> norm <span class="skolem">J'</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">J'</span> <span class="main">∈</span> <span class="main">ℤ</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">J''</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">J'</span> <span class="main">=</span> of_int <span class="skolem">J''</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">elim</span> Ints_cases<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"of_int <span class="main">(</span>fact <span class="main">(</span><span class="skolem">p</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>fact <span class="main">(</span><span class="skolem">p</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="skolem">n</span> <span class="main">::</span> complex<span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="keyword1">alg_dvd</span> <span class="skolem">J'</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">J'</span> <span class="main">=</span> of_int <span class="skolem">J''</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fact <span class="main">(</span><span class="skolem">p</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="skolem">n</span> <span class="keyword1">dvd</span> <span class="skolem">J''</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> alg_dvd_of_int_iff<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">J'</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">J''</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="skolem">J''</span><span class="main">¦</span> <span class="main">≥</span> <span class="main">¦</span>fact <span class="main">(</span><span class="skolem">p</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="skolem">n</span><span class="main">¦</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> dvd_imp_le_int<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"real_of_int <span class="main">¦</span><span class="skolem">J''</span><span class="main">¦</span> <span class="main">≥</span> real_of_int <span class="main">¦</span>fact <span class="main">(</span><span class="skolem">p</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="skolem">n</span><span class="main">¦</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"real_of_int <span class="main">¦</span><span class="skolem">J''</span><span class="main">¦</span> <span class="main">=</span> norm <span class="skolem">J'</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>

    <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The standard M-L bound for $I_i(x)$ shows the following inequality:›</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"norm <span class="skolem">J'</span> <span class="main">≤</span> <span class="skolem">C'</span> <span class="main">*</span> <span class="skolem">C</span> <span class="skolem">p</span> <span class="main">^</span> <span class="skolem">n</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"norm <span class="skolem">J'</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">x</span><span class="main">∈</span><span class="skolem">Roots'</span><span class="main">.</span> norm <span class="main">(</span><span class="skolem">J</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> J'_def prod_norm <span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="main">(</span><span class="main">∏</span><span class="bound">x</span><span class="main">∈</span><span class="skolem">Roots'</span><span class="main">.</span> <span class="main">∑</span><span class="bound">q</span><span class="main">∈</span><span class="free">P</span><span class="main">.</span> real_of_int <span class="main">¦</span><span class="free">β</span> <span class="bound">q</span><span class="main">¦</span> <span class="main">*</span> <span class="main">(</span><span class="main">∑</span><span class="bound">α</span><span class="main">∈</span><span class="free">Roots</span> <span class="bound">q</span><span class="main">.</span> cmod <span class="bound">α</span> <span class="main">*</span> exp <span class="main">(</span>cmod <span class="bound">α</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">C</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> prod_mono conjI<span class="main">)</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">Roots'</span>"</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span><span class="skolem">J</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="main">∑</span><span class="bound">q</span><span class="main">∈</span><span class="free">P</span><span class="main">.</span> real_of_int <span class="main">¦</span><span class="free">β</span> <span class="bound">q</span><span class="main">¦</span> <span class="main">*</span> <span class="main">(</span><span class="main">∑</span><span class="bound">α</span><span class="main">∈</span><span class="free">Roots</span> <span class="bound">q</span><span class="main">.</span> norm <span class="bound">α</span> <span class="main">*</span> exp <span class="main">(</span>norm <span class="bound">α</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">C</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> J_def
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> sum_norm_le<span class="main">)</span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">q</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> <span class="free">P</span>"</span></span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span>of_int <span class="main">(</span><span class="free">β</span> <span class="skolem">q</span><span class="main">)</span> <span class="main">*</span> sum <span class="main">(</span><span class="skolem">I</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span><span class="free">Roots</span> <span class="skolem">q</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span>
                  real_of_int <span class="main">¦</span><span class="free">β</span> <span class="skolem">q</span><span class="main">¦</span> <span class="main">*</span> <span class="main">(</span><span class="main">∑</span><span class="bound">α</span><span class="main">∈</span><span class="free">Roots</span> <span class="skolem">q</span><span class="main">.</span> norm <span class="bound">α</span> <span class="main">*</span> exp <span class="main">(</span>norm <span class="bound">α</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">C</span> <span class="skolem">p</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">unfolding</span></span> norm_mult norm_of_int of_int_abs
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> mult_left_mono sum_norm_le<span class="main">)</span>
            <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">α</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">α</span> <span class="main">∈</span> <span class="free">Roots</span> <span class="skolem">q</span>"</span></span>
            <span class="keyword1"><span class="command">hence</span></span> α<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">α</span> <span class="main">∈</span> <span class="skolem">Roots'</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">q</span> <span class="main">∈</span> <span class="free">P</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Roots'_def<span class="main">)</span>
            <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span><span class="skolem">I</span> <span class="skolem">x</span> <span class="skolem">α</span><span class="main">)</span> <span class="main">≤</span> norm <span class="skolem">α</span> <span class="main">*</span> exp <span class="main">(</span>norm <span class="skolem">α</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">C</span> <span class="skolem">p</span>"</span></span>
              <span class="keyword1"><span class="command">unfolding</span></span> I_def
            <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> lindemann_weierstrass_aux.lindemann_weierstrass_integral_bound<span class="main">)</span>
              <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">t</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> closed_segment <span class="main">0</span> <span class="skolem">α</span>"</span></span>
              <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"closed_segment <span class="main">0</span> <span class="skolem">α</span> <span class="main">⊆</span> cball <span class="main">0</span> <span class="skolem">R</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">R</span> <span class="main">≥</span> <span class="main">0</span>›</span></span> R_ge<span class="main">[</span><span class="operator">OF</span> α<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> closed_segment_subset<span class="main">)</span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"norm <span class="skolem">t</span> <span class="main">≤</span> <span class="skolem">R</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  
              <span class="keyword1"><span class="command">have</span></span> norm_diff_le<span class="main">:</span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span><span class="skolem">t</span> <span class="main">-</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">≤</span> <span class="numeral">2</span> <span class="main">*</span> <span class="skolem">R</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="skolem">Roots'</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">y</span>
              <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
                <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span><span class="skolem">t</span> <span class="main">-</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">≤</span> norm <span class="skolem">t</span> <span class="main">+</span> norm <span class="skolem">y</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> norm_triangle_ineq4<span class="main">)</span>
                <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="skolem">R</span> <span class="main">+</span> <span class="skolem">R</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> add_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹norm <span class="skolem">t</span> <span class="main">≤</span> <span class="skolem">R</span>›</span></span> R_ge<span class="main"><span class="main">]</span></span> that<span class="main">)</span>
                <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
              <span class="keyword1"><span class="command">qed</span></span>
  
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span>poly <span class="main">(</span><span class="skolem">f_poly</span> <span class="skolem">x</span><span class="main">)</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span>
                      <span class="main">¦</span>real_of_int <span class="skolem">l</span><span class="main">¦</span> <span class="main">^</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">*</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∏</span><span class="bound">y</span><span class="main">∈</span><span class="skolem">Roots'</span><span class="main">.</span> cmod <span class="main">(</span><span class="skolem">t</span> <span class="main">-</span> <span class="bound">y</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">y</span> <span class="main">=</span> <span class="skolem">x</span> <span class="keyword1">then</span> <span class="skolem">p</span> <span class="main">-</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eval_f x f_def norm_mult norm_power <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> prod_norm<span class="main">)</span>
              <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="main">¦</span>real_of_int <span class="skolem">l</span><span class="main">¦</span> <span class="main">^</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">*</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∏</span><span class="bound">y</span><span class="main">∈</span><span class="skolem">Roots'</span><span class="main">.</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="skolem">R</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">y</span> <span class="main">=</span> <span class="skolem">x</span> <span class="keyword1">then</span> <span class="skolem">p</span> <span class="main">-</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_left_mono prod_mono conjI power_mono norm_diff_le<span class="main">)</span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">¦</span>real_of_int <span class="skolem">l</span><span class="main">¦</span><span class="main">^</span><span class="main">(</span><span class="skolem">n</span><span class="main">*</span><span class="skolem">p</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="skolem">p</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">R</span><span class="main">^</span><span class="main">(</span><span class="skolem">p</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">p</span><span class="main">*</span><span class="skolem">R</span><span class="main">^</span><span class="skolem">p</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="skolem">n</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> x <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> prod.If_eq<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> card_Diff_subset n_altdef<span class="main">)</span>
              <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="skolem">p</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">R</span><span class="main">^</span><span class="main">(</span><span class="skolem">p</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">p</span><span class="main">*</span><span class="skolem">R</span><span class="main">^</span><span class="skolem">p</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="skolem">n</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="main">(</span><span class="skolem">p</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">+</span><span class="skolem">p</span><span class="main">*</span><span class="main">(</span><span class="skolem">n</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">R</span><span class="main">^</span><span class="main">(</span><span class="main">(</span><span class="skolem">p</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">+</span><span class="skolem">p</span><span class="main">*</span><span class="main">(</span><span class="skolem">n</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">unfolding</span></span> power_mult power_mult_distrib power_add <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_ac<span class="main">)</span>
              <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">p</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">+</span><span class="skolem">p</span><span class="main">*</span><span class="main">(</span><span class="skolem">n</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">p</span><span class="main">*</span><span class="skolem">n</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">&gt;</span> <span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">n</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
              <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span><span class="skolem">p</span> <span class="main">*</span> <span class="skolem">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">R</span> <span class="main">^</span> <span class="main">(</span><span class="skolem">p</span> <span class="main">*</span> <span class="skolem">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="skolem">R</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="skolem">n</span> <span class="main">*</span> <span class="skolem">p</span><span class="main">-</span><span class="main">1</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">unfolding</span></span> power_mult_distrib <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_ac<span class="main">)</span>
              <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span>poly <span class="main">(</span><span class="skolem">f_poly</span> <span class="skolem">x</span><span class="main">)</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">C</span> <span class="skolem">p</span>"</span></span>
                <span class="keyword1"><span class="command">unfolding</span></span> C_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">l</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> <span class="quoted"><span class="quoted">‹<span class="skolem">R</span> <span class="main">≥</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">l</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="quoted">‹<span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main">:</span> C_def›</span><span class="main">)</span>
          <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">C'</span> <span class="main">*</span> <span class="skolem">C</span> <span class="skolem">p</span> <span class="main">^</span> <span class="skolem">n</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> C'_def power_mult_distrib n_altdef <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> sum_distrib_right mult.assoc<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>

    <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹And with that, we have our inequality:›</span></span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"fact <span class="main">(</span><span class="skolem">p</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="skolem">n</span> <span class="main">≤</span> <span class="skolem">C'</span> <span class="main">*</span> <span class="skolem">C</span> <span class="skolem">p</span> <span class="main">^</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
    Some simple asymptotic estimates show that this is clearly a contradiction, since
    the left-hand side grows much faster than the right-hand side and there are infinitely many
    sufficiently large primes:
  ›</span></span>
  <span class="keyword1"><span class="command">have</span></span> freq<span class="main">:</span> <span class="quoted"><span class="quoted">"frequently prime sequentially"</span></span>
    <span class="keyword1"><span class="command">using</span></span> frequently_prime_cofinite <span class="keyword1"><span class="command">unfolding</span></span> cofinite_eq_sequentially <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">have</span></span> ev<span class="main">:</span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">q</span><span class="main">∈</span><span class="free">P</span><span class="main">.</span>  int <span class="bound">p</span> <span class="main">&gt;</span> <span class="main">¦</span><span class="free">β</span> <span class="bound">q</span><span class="main">¦</span><span class="main">)</span> <span class="main">∧</span>
              real <span class="bound">p</span> <span class="main">&gt;</span> norm <span class="main">(</span><span class="main">∏</span><span class="bound">α</span><span class="main">∈</span><span class="skolem">Roots'</span><span class="main">.</span> of_int <span class="main">(</span><span class="skolem">l</span><span class="main">^</span><span class="skolem">n</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∏</span><span class="bound">α'</span><span class="main">∈</span><span class="skolem">Roots'</span><span class="main">-</span><span class="main">{</span><span class="bound">α</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="bound">α</span><span class="main">-</span><span class="bound">α'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> sequentially"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> eventually_ball_finite <span class="quoted"><span class="quoted">‹finite <span class="free">P</span>›</span></span> ballI eventually_conj filterlim_real_sequentially
          eventually_compose_filterlim<span class="main"><span class="main">[</span></span><span class="operator">OF</span> eventually_gt_at_top<span class="main"><span class="main">]</span></span> filterlim_int_sequentially<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"frequently <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> fact <span class="main">(</span><span class="bound">p</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="skolem">n</span> <span class="main">≤</span> <span class="skolem">C'</span> <span class="main">*</span> <span class="skolem">C</span> <span class="bound">p</span> <span class="main">^</span> <span class="skolem">n</span><span class="main">)</span> sequentially"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> frequently_eventually_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> freq ev<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">use</span> ineq <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">blast</span><span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> fact <span class="main">(</span><span class="bound">p</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="skolem">n</span> <span class="main">&gt;</span> <span class="skolem">C'</span> <span class="main">*</span> <span class="skolem">C</span> <span class="bound">p</span> <span class="main">^</span> <span class="skolem">n</span><span class="main">)</span> sequentially"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">R</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="bound">p</span> <span class="main">*</span> <span class="skolem">n</span> <span class="main">&gt;</span> <span class="main">1</span><span class="main">)</span> at_top"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> eventually_compose_filterlim<span class="main"><span class="main">[</span></span><span class="operator">OF</span> eventually_gt_at_top<span class="main"><span class="main">]</span></span> mult_nat_right_at_top<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">eventually_elim</span> <span class="main">(</span><span class="operator">use</span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> True <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="quoted">‹<span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main">:</span> C_def power_0_left mult_ac›</span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">R</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">R</span> <span class="main">≥</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">D</span></span> <span class="main">::</span> <span class="quoted">real</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">D</span> <span class="main">=</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="skolem">R</span> <span class="main">*</span> <span class="main">¦</span>real_of_int <span class="skolem">l</span><span class="main">¦</span><span class="main">)</span> <span class="main">^</span> <span class="skolem">n</span>"</span></span> 
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">D</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">R</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">l</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> D_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> zero_less_power<span class="main">)</span> <span class="operator">auto</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="skolem">C'</span> <span class="main">*</span> <span class="skolem">C</span> <span class="bound">p</span> <span class="main">^</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="skolem">C</span> <span class="bound">p</span> <span class="main">^</span> <span class="skolem">n</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="skolem">C</span> <span class="bound">p</span> <span class="main">^</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="skolem">R</span> <span class="main">*</span> <span class="skolem">l</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">*</span> <span class="bound">p</span><span class="main">)</span><span class="main">)</span> <span class="main">^</span> <span class="skolem">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> landau_o.big_power<span class="main"><span class="main">[</span></span><span class="operator">OF</span> bigthetaD1<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> np<span class="main">:</span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="bound">p</span> <span class="main">*</span> <span class="skolem">n</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span> at_top"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> eventually_compose_filterlim<span class="main"><span class="main">[</span></span><span class="operator">OF</span> eventually_gt_at_top<span class="main"><span class="main">]</span></span> mult_nat_right_at_top<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="skolem">R</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">C</span> <span class="bound">p</span> <span class="main">=</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="skolem">R</span> <span class="main">*</span> <span class="skolem">l</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">*</span> <span class="bound">p</span><span class="main">)</span><span class="main">)</span> at_top"</span></span>
        <span class="keyword1"><span class="command">using</span></span> np
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">eventually_elim</span>
        <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>elim <span class="skolem">p</span><span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">*</span> <span class="skolem">R</span> <span class="main">*</span> <span class="skolem">C</span> <span class="skolem">p</span> <span class="main">=</span> <span class="skolem">l</span> <span class="main">^</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">*</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="skolem">R</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span>Suc <span class="main">(</span><span class="skolem">n</span> <span class="main">*</span> <span class="skolem">p</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> C_def <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span><span class="skolem">n</span> <span class="main">*</span> <span class="skolem">p</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">n</span> <span class="main">*</span> <span class="skolem">p</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> elim <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="skolem">R</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">C</span> <span class="bound">p</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">Θ(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="skolem">R</span> <span class="main">*</span> <span class="skolem">l</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">*</span> <span class="bound">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> bigthetaI_cong<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span> <span class="main">∈</span> <span class="keyword1">Θ(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="skolem">R</span> <span class="main">*</span> <span class="skolem">l</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">*</span> <span class="bound">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">R</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="main">(</span><span class="skolem">D</span> <span class="main">^</span> <span class="bound">p</span><span class="main">)</span> <span class="main">^</span> <span class="skolem">n</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">l</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> power_mult <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power2_eq_square mult_ac D_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="main">(</span><span class="skolem">D</span> <span class="main">^</span> <span class="bound">p</span><span class="main">)</span> <span class="main">^</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">o(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> fact <span class="main">(</span><span class="bound">p</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="skolem">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> landau_o.small_power<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="skolem">D</span> <span class="main">^</span> <span class="bound">p</span> <span class="main">=</span> <span class="skolem">D</span> <span class="main">*</span> <span class="skolem">D</span> <span class="main">^</span> <span class="main">(</span><span class="bound">p</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> at_top"</span></span>
        <span class="keyword1"><span class="command">using</span></span> eventually_gt_at_top<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">eventually_elim</span> <span class="main">(</span><span class="operator">use</span> <span class="quoted"><span class="quoted">‹<span class="skolem">D</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="quoted">‹<span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">flip</span><span class="main">:</span> power_Suc›</span><span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="skolem">D</span> <span class="main">^</span> <span class="bound">p</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">Θ(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="skolem">D</span> <span class="main">*</span> <span class="skolem">D</span> <span class="main">^</span> <span class="main">(</span><span class="bound">p</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> bigthetaI_cong<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="skolem">D</span> <span class="main">^</span> <span class="bound">p</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">Θ(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="skolem">D</span> <span class="main">^</span> <span class="main">(</span><span class="bound">p</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">D</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="skolem">D</span> <span class="main">^</span> <span class="main">(</span><span class="bound">p</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">o(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> fact <span class="main">(</span><span class="bound">p</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> smalloI_tendsto<span class="main"><span class="main">[</span></span><span class="operator">OF</span> filterlim_compose<span class="main"><span class="main">[</span></span><span class="operator">OF</span> power_over_fact_tendsto_0<span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span>
                  filterlim_minus_nat_at_top<span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="skolem">D</span> <span class="main">^</span> <span class="bound">p</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">o(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> fact <span class="main">(</span><span class="bound">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">fact</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> smallo<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="skolem">C'</span> <span class="main">*</span> <span class="skolem">C</span> <span class="bound">p</span> <span class="main">^</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">o(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> fact <span class="main">(</span><span class="bound">p</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="skolem">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="main">¦</span><span class="skolem">C'</span> <span class="main">*</span> <span class="skolem">C</span> <span class="bound">p</span> <span class="main">^</span> <span class="skolem">n</span><span class="main">¦</span> <span class="main">≤</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span> <span class="main">*</span> fact <span class="main">(</span><span class="bound">p</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="skolem">n</span><span class="main">)</span> at_top"</span></span>
      <span class="keyword1"><span class="command">using</span></span> landau_o.smallD<span class="main">[</span><span class="operator">OF</span> smallo<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="skolem">C'</span> <span class="main">*</span> <span class="skolem">C</span> <span class="bound">p</span> <span class="main">^</span> <span class="skolem">n</span> <span class="main">&lt;</span> fact <span class="main">(</span><span class="bound">p</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="skolem">n</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">eventually_elim</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>elim <span class="skolem">p</span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">C'</span> <span class="main">*</span> <span class="skolem">C</span> <span class="skolem">p</span> <span class="main">^</span> <span class="skolem">n</span> <span class="main">≤</span> <span class="main">¦</span><span class="skolem">C'</span> <span class="main">*</span> <span class="skolem">C</span> <span class="skolem">p</span> <span class="main">^</span> <span class="skolem">n</span><span class="main">¦</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span> <span class="main">*</span> fact <span class="main">(</span><span class="skolem">p</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="skolem">n</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">&lt;</span> fact <span class="main">(</span><span class="skolem">p</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="skolem">n</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"frequently <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">::</span>nat<span class="main">.</span> False<span class="main">)</span> sequentially"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> frequently_eventually_mono<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Removing the restriction of full sets of conjugates›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  We will now remove the restriction that the $\alpha_i$ must occur in full sets of conjugates
  by multiplying the equality with all permutations of roots.
›</span></span>
<span class="keyword1" id="Hermite_Lindemann-Hermite_Lindemann_aux2"><span class="command">lemma</span></span> Hermite_Lindemann_aux2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">X</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"complex set"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">β</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"complex <span class="main">⇒</span> int"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">X</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> nz<span class="main">:</span>   <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">⟹</span> <span class="free">β</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> alg<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">⟹</span> algebraic <span class="bound">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> sum0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="free">X</span><span class="main">.</span> of_int <span class="main">(</span><span class="free">β</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> exp <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">note</span></span> <span class="main">[</span><span class="operator">intro</span><span class="main">]</span> <span class="main">=</span> <span class="quoted"><span class="quoted">‹finite <span class="free">X</span>›</span></span>

  <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
    Let <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>P›</span></span></span></span> be the smallest integer polynomial whose roots are a superset of <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>X›</span></span></span></span>:
  ›</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">P</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"int poly"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="main">=</span> <span class="main">∏</span><span class="main">(</span>min_int_poly <span class="main">`</span> <span class="free">X</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">Roots</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"complex set"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Roots</span> <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> ipoly <span class="skolem">P</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">X</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> P_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="skolem">Roots</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> Roots_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> poly_roots_finite<span class="main">)</span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">⊆</span> <span class="skolem">Roots</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">X</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"ipoly <span class="main">(</span>min_int_poly <span class="skolem">x</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> ipoly_min_int_poly alg<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">Roots</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">X</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="free">X</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Roots_def P_def of_int_poly_hom.hom_prod poly_prod<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"squarefree <span class="main">(</span>of_int_poly <span class="skolem">P</span> <span class="main">::</span> complex poly<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> P_def of_int_poly_hom.hom_prod
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> squarefree_prod_coprime<span class="main"><span class="keyword3">;</span></span> <span class="operator">safe</span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">X</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"squarefree <span class="main">(</span>of_int_poly <span class="main">(</span>min_int_poly <span class="skolem">x</span><span class="main">)</span> <span class="main">::</span> complex poly<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> squarefree_of_int_polyI<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="keyword3"><span class="command">assume</span></span> xy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">X</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="free">X</span>"</span></span> <span class="quoted"><span class="quoted">"min_int_poly <span class="skolem">x</span> <span class="main">≠</span> min_int_poly <span class="skolem">y</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"Rings.coprime <span class="main">(</span>of_int_poly <span class="main">(</span>min_int_poly <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>of_int_poly <span class="main">(</span>min_int_poly <span class="skolem">y</span><span class="main">)</span> <span class="main">::</span> complex poly<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> coprime_of_int_polyI<span class="main"><span class="main">[</span></span><span class="operator">OF</span> primes_coprime<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
    Since we will need a numbering of these roots, we obtain one:
  ›</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> card <span class="skolem">Roots</span>"</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Root</span></span> <span class="keyword2"><span class="keyword">where</span></span> Root<span class="main">:</span> <span class="quoted"><span class="quoted">"bij_betw <span class="skolem">Root</span> <span class="main">{..&lt;</span><span class="skolem">n</span><span class="main">}</span> <span class="skolem">Roots</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ex_bij_betw_nat_finite<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹finite <span class="skolem">Roots</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> n_def atLeast0LessThan <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">unRoot</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"complex <span class="main">⇒</span> nat"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">unRoot</span> <span class="main">=</span> inv_into <span class="main">{..&lt;</span><span class="skolem">n</span><span class="main">}</span> <span class="skolem">Root</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> unRoot<span class="main">:</span> <span class="quoted"><span class="quoted">"bij_betw <span class="skolem">unRoot</span> <span class="skolem">Roots</span> <span class="main">{..&lt;</span><span class="skolem">n</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> unRoot_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> bij_betw_inv_into Root<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> unRoot_Root <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">unRoot</span> <span class="main">(</span><span class="skolem">Root</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">i</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="skolem">n</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span>
    <span class="keyword1"><span class="command">unfolding</span></span> unRoot_def <span class="keyword1"><span class="command">using</span></span> Root that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> inv_into_f_f<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> bij_betw_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> Root_unRoot <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Root</span> <span class="main">(</span><span class="skolem">unRoot</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">Roots</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
    <span class="keyword1"><span class="command">unfolding</span></span> unRoot_def <span class="keyword1"><span class="command">using</span></span> Root that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> f_inv_into_f<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> bij_betw_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">,</span> <span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Root</span> <span class="skolem">i</span> <span class="main">∈</span> <span class="skolem">Roots</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="skolem">n</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span>
    <span class="keyword1"><span class="command">using</span></span> Root that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> bij_betw_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">,</span> <span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">unRoot</span> <span class="skolem">x</span> <span class="main">&lt;</span> <span class="skolem">n</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">Roots</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
    <span class="keyword1"><span class="command">using</span></span> unRoot that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> bij_betw_def<span class="main">)</span>

  <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
    We will also need to convert between permutations of natural numbers less than <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>n›</span></span></span></span> and
    permutations of the roots:
  ›</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">convert_perm</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>nat <span class="main">⇒</span> nat<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span>complex <span class="main">⇒</span> complex<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="skolem">convert_perm</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">σ</span> <span class="bound">x</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">x</span> <span class="main">∈</span> <span class="skolem">Roots</span> <span class="keyword1">then</span> <span class="skolem">Root</span> <span class="main">(</span><span class="bound">σ</span> <span class="main">(</span><span class="skolem">unRoot</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">else</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> bij_convert<span class="main">:</span> <span class="quoted"><span class="quoted">"bij_betw <span class="skolem">convert_perm</span> <span class="main">{</span><span class="bound">σ</span><span class="main">.</span> <span class="bound">σ</span> <span class="keyword1">permutes</span> <span class="main">{..&lt;</span><span class="skolem">n</span><span class="main">}</span><span class="main">}</span> <span class="main">{</span><span class="bound">σ</span><span class="main">.</span> <span class="bound">σ</span> <span class="keyword1">permutes</span> <span class="skolem">Roots</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> bij_betw_permutations<span class="main">[</span><span class="operator">OF</span> Root<span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> convert_perm_def unRoot_def <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">have</span></span> permutes_convert_perm <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">convert_perm</span> <span class="skolem">σ</span> <span class="keyword1">permutes</span> <span class="skolem">Roots</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">σ</span> <span class="keyword1">permutes</span> <span class="main">{..&lt;</span><span class="skolem">n</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">σ</span>
    <span class="keyword1"><span class="command">using</span></span> that bij_convert <span class="keyword1"><span class="command">unfolding</span></span> bij_betw_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> convert_perm_compose<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">convert_perm</span> <span class="main">(</span><span class="skolem">π</span> <span class="main">∘</span> <span class="skolem">σ</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">convert_perm</span> <span class="skolem">π</span> <span class="main">∘</span> <span class="skolem">convert_perm</span> <span class="skolem">σ</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">π</span> <span class="keyword1">permutes</span> <span class="main">{..&lt;</span><span class="skolem">n</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">σ</span> <span class="keyword1">permutes</span> <span class="main">{..&lt;</span><span class="skolem">n</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">σ</span> <span class="skolem">π</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> ext<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">convert_perm</span> <span class="main">(</span><span class="skolem">π</span> <span class="main">∘</span> <span class="skolem">σ</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">convert_perm</span> <span class="skolem">π</span> <span class="main">∘</span> <span class="skolem">convert_perm</span> <span class="skolem">σ</span><span class="main">)</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">Roots</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> permutes_in_image<span class="main">[</span><span class="operator">OF</span> that<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">unRoot</span> <span class="skolem">x</span>"</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> convert_perm_def bij_betw_def<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> convert_perm_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
    We extend the coefficient vector to the new roots by setting their coefficients to 0:
  ›</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">β'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">β'</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">X</span> <span class="keyword1">then</span> <span class="free">β</span> <span class="bound">x</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
    We now define the set of all permutations of our roots:
  ›</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">perms</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">perms</span> <span class="main">=</span> <span class="main">{</span><span class="bound">π</span><span class="main">.</span> <span class="bound">π</span> <span class="keyword1">permutes</span> <span class="skolem">Roots</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="skolem">perms</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> perms_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> finite_permutations<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="skolem">perms</span> <span class="main">=</span> fact <span class="skolem">n</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> perms_def n_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> card_permutations<span class="main">)</span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
    The following is the set of all <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>n!›</span></span></span></span>-tuples of roots, disregarding permutation of components.
    In other words: all multisets of roots with size <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>n!›</span></span></span></span>.
  ›</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">Roots_ms</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"complex multiset set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="skolem">Roots_ms</span> <span class="main">=</span> <span class="main">{</span><span class="bound">X</span><span class="main">.</span> set_mset <span class="bound">X</span> <span class="main">⊆</span> <span class="skolem">Roots</span> <span class="main">∧</span> size <span class="bound">X</span> <span class="main">=</span> fact <span class="skolem">n</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="skolem">Roots_ms</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> Roots_ms_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> finite_multisets_of_size<span class="main">)</span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
    Next, the following is the set of <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>n!›</span></span></span></span>-tuples whose entries are precisely the multiset <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>X›</span></span></span></span>:
  ›</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">tuples</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"complex multiset <span class="main">⇒</span> <span class="main">(</span><span class="main">(</span>complex <span class="main">⇒</span> complex<span class="main">)</span> <span class="main">⇒</span> complex<span class="main">)</span> set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="skolem">tuples</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">X</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">f</span></span><span class="main">∈</span><span class="skolem">perms</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="skolem">Roots</span><span class="main">.</span> image_mset <span class="bound">f</span> <span class="main">(</span>mset_set <span class="skolem">perms</span><span class="main">)</span> <span class="main">=</span> <span class="bound">X</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> fin_tuples <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="skolem">tuples</span> <span class="skolem">X</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">X</span>
    <span class="keyword1"><span class="command">unfolding</span></span> tuples_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> finite_subset<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem"><span class="skolem">perms</span></span></span> <span class="keyword1"><span class="keyword1"><span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span></span></span> <span class="skolem"><span class="skolem"><span class="skolem">Roots</span></span></span>"</span></span></span></span><span class="main"><span class="main">,</span></span> <span class="operator">OF</span> _ finite_PiE<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">tuples'</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>complex multiset <span class="main">×</span> <span class="main">(</span><span class="main">(</span>complex <span class="main">⇒</span> complex<span class="main">)</span> <span class="main">⇒</span> complex<span class="main">)</span><span class="main">)</span> set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="skolem">tuples'</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">SIGMA</span> <span class="bound">X</span><span class="main">:</span><span class="skolem">Roots_ms</span><span class="main">.</span> <span class="skolem">tuples</span> <span class="bound">X</span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
    The following shows that our <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span class="quoted">‹<span class="skolem"><span class="skolem">tuples</span></span>›</span></span></span></span> definition is stable under permutation of
    the roots.
  ›</span></span>
  <span class="keyword1"><span class="command">have</span></span> bij_convert'<span class="main">:</span> <span class="quoted"><span class="quoted">"bij_betw <span class="main">(</span><span class="main">λ</span><span class="bound">f</span><span class="main">.</span> <span class="bound">f</span> <span class="main">∘</span> <span class="main">(</span><span class="main">λ</span><span class="bound">g</span><span class="main">.</span> <span class="skolem">σ</span> <span class="main">∘</span> <span class="bound">g</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">tuples</span> <span class="skolem">X</span><span class="main">)</span> <span class="main">(</span><span class="skolem">tuples</span> <span class="skolem">X</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> σ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">σ</span> <span class="keyword1">permutes</span> <span class="skolem">Roots</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">σ</span> <span class="skolem">X</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> bij_betwI<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">f</span><span class="main">.</span> <span class="bound">f</span> <span class="main">∘</span> <span class="main">(∘)</span> <span class="skolem">σ</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">tuples</span> <span class="skolem">X</span> <span class="main">→</span> <span class="skolem">tuples</span> <span class="skolem">X</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> σ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">σ</span> <span class="keyword1">permutes</span> <span class="skolem">Roots</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">σ</span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span> <span class="keyword3"><span class="command">assume</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> <span class="skolem">tuples</span> <span class="skolem">X</span>"</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∘</span> <span class="main">(∘)</span> <span class="skolem">σ</span> <span class="main">∈</span> <span class="skolem">tuples</span> <span class="skolem">X</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> tuples_def
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">σ'</span>
        <span class="keyword3"><span class="command">assume</span></span> σ'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">σ'</span> <span class="main">∈</span> <span class="skolem">perms</span>"</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">f</span> <span class="main">∘</span> <span class="main">(∘)</span> <span class="skolem">σ</span><span class="main">)</span> <span class="skolem">σ'</span> <span class="main">∈</span> <span class="skolem">Roots</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> permutes_compose<span class="main">[</span><span class="operator">OF</span> _ σ<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">σ'</span></span><span class="main">]</span> σ σ' f <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> perms_def tuples_def<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">σ'</span>
        <span class="keyword3"><span class="command">assume</span></span> σ'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">σ'</span> <span class="main">∉</span> <span class="skolem">perms</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="skolem">σ</span> <span class="main">∘</span> <span class="skolem">σ'</span><span class="main">)</span> <span class="keyword1">permutes</span> <span class="skolem">Roots</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">σ</span> <span class="main">∘</span> <span class="skolem">σ'</span><span class="main">)</span> <span class="keyword1">permutes</span> <span class="skolem">Roots</span>"</span></span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"inv_into UNIV <span class="skolem">σ</span> <span class="main">∘</span> <span class="main">(</span><span class="skolem">σ</span> <span class="main">∘</span> <span class="skolem">σ'</span><span class="main">)</span> <span class="keyword1">permutes</span> <span class="skolem">Roots</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> permutes_compose<span class="main">)</span> <span class="main">(</span><span class="operator">use</span> permutes_inv<span class="main"><span class="main">[</span></span><span class="operator">OF</span> σ<span class="main"><span class="main">]</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">simp_all</span><span class="main">)</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inv_into UNIV <span class="skolem">σ</span> <span class="main">∘</span> <span class="main">(</span><span class="skolem">σ</span> <span class="main">∘</span> <span class="skolem">σ'</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">σ'</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fun_eq_iff permutes_inverses<span class="main"><span class="main">[</span></span><span class="operator">OF</span> σ<span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> σ' <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> perms_def<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">f</span> <span class="main">∘</span> <span class="main">(∘)</span> <span class="skolem">σ</span><span class="main">)</span> <span class="skolem">σ'</span> <span class="main">=</span> undefined"</span></span>
          <span class="keyword1"><span class="command">using</span></span> f <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> perms_def tuples_def<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"image_mset <span class="main">(</span><span class="skolem">f</span> <span class="main">∘</span> <span class="main">(∘)</span> <span class="skolem">σ</span><span class="main">)</span> <span class="main">(</span>mset_set <span class="skolem">perms</span><span class="main">)</span> <span class="main">=</span>
              image_mset <span class="skolem">f</span> <span class="main">(</span>image_mset <span class="main">(</span><span class="main">(∘)</span> <span class="skolem">σ</span><span class="main">)</span> <span class="main">(</span>mset_set <span class="skolem">perms</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> multiset.map_comp <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"image_mset <span class="main">(</span><span class="main">(∘)</span> <span class="skolem">σ</span><span class="main">)</span> <span class="main">(</span>mset_set <span class="skolem">perms</span><span class="main">)</span> <span class="main">=</span> mset_set <span class="skolem">perms</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> bij_betw_permutes_compose_left<span class="main">[</span><span class="operator">OF</span> σ<span class="main">]</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> image_mset_mset_set<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> bij_betw_def perms_def<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"image_mset <span class="skolem">f</span> <span class="main">…</span> <span class="main">=</span> <span class="skolem">X</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> f <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> tuples_def<span class="main">)</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"image_mset <span class="main">(</span><span class="skolem">f</span> <span class="main">∘</span> <span class="main">(∘)</span> <span class="skolem">σ</span><span class="main">)</span> <span class="main">(</span>mset_set <span class="skolem">perms</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">X</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>

    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">f</span><span class="main">.</span> <span class="bound">f</span> <span class="main">∘</span> <span class="main">(∘)</span> <span class="skolem">σ</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">tuples</span> <span class="skolem">X</span> <span class="main">→</span> <span class="skolem">tuples</span> <span class="skolem">X</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> *<span class="main">)</span> <span class="operator">fact</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">f</span><span class="main">.</span> <span class="bound">f</span> <span class="main">∘</span> <span class="main">(∘)</span> <span class="main">(</span>inv_into UNIV <span class="skolem">σ</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">tuples</span> <span class="skolem">X</span> <span class="main">→</span> <span class="skolem">tuples</span> <span class="skolem">X</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> * permutes_inv<span class="main">)</span> <span class="operator">fact</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∘</span> <span class="main">(∘)</span> <span class="skolem">σ</span> <span class="main">∘</span> <span class="main">(∘)</span> <span class="main">(</span>inv_into UNIV <span class="skolem">σ</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">f</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> <span class="skolem">tuples</span> <span class="skolem">X</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">f</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fun_eq_iff o_def permutes_inverses<span class="main"><span class="main">[</span></span><span class="operator">OF</span> σ<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∘</span> <span class="main">(∘)</span> <span class="main">(</span>inv_into UNIV <span class="skolem">σ</span><span class="main">)</span> <span class="main">∘</span> <span class="main">(∘)</span> <span class="skolem">σ</span> <span class="main">=</span> <span class="skolem">f</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> <span class="skolem">tuples</span> <span class="skolem">X</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">f</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fun_eq_iff o_def permutes_inverses<span class="main"><span class="main">[</span></span><span class="operator">OF</span> σ<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
    Next, we define the multiset of of possible exponents that we can get for a given
    <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>n!›</span></span></span></span>-multiset of roots,
  ›</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">R</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"complex multiset <span class="main">⇒</span> complex multiset"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="skolem">R</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">X</span><span class="main">.</span> image_mset <span class="main">(</span><span class="main">λ</span><span class="bound">f</span><span class="main">.</span> <span class="main">∑</span><span class="bound">σ</span><span class="main">∈</span><span class="skolem">perms</span><span class="main">.</span> <span class="bound">σ</span> <span class="main">(</span><span class="bound">f</span> <span class="bound">σ</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>mset_set <span class="main">(</span><span class="skolem">tuples</span> <span class="bound">X</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
    We show that, for each such multiset, there is a content-free integer polynomial that has
    exactly these exponents as roots. This shows that they form a full set of conjugates (but
    note this polynomial is not necessarily squarefree).

    The proof is yet another application of the fundamental theorem of symmetric polynomials.
  ›</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Q</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"complex multiset <span class="main">⇒</span> int poly"</span></span>
    <span class="keyword2"><span class="keyword">where</span></span> Q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">X</span><span class="main">.</span> <span class="bound">X</span> <span class="main">∈</span> <span class="skolem">Roots_ms</span> <span class="main">⟹</span> poly_roots <span class="main">(</span>of_int_poly <span class="main">(</span><span class="skolem">Q</span> <span class="bound">X</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">R</span> <span class="bound">X</span>"</span></span>
             <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">X</span><span class="main">.</span> <span class="bound">X</span> <span class="main">∈</span> <span class="skolem">Roots_ms</span> <span class="main">⟹</span> content <span class="main">(</span><span class="skolem">Q</span> <span class="bound">X</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">X</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"complex multiset"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> X<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">∈</span> <span class="skolem">Roots_ms</span>"</span></span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">Q</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"complex poly mpoly"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
        <span class="quoted"><span class="quoted">"<span class="skolem">Q</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">f</span><span class="main">∈</span><span class="skolem">tuples</span> <span class="skolem">X</span><span class="main">.</span> Const <span class="main">[:</span><span class="main">0</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">-</span>
                 <span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">σ</span></span> <span class="main">|</span> <span class="bound">σ</span> <span class="keyword1">permutes</span> <span class="main">{..&lt;</span><span class="skolem">n</span><span class="main">}</span><span class="main">.</span> Var <span class="main">(</span><span class="bound">σ</span> <span class="main">(</span><span class="skolem">unRoot</span> <span class="main">(</span><span class="bound">f</span> <span class="main">(</span><span class="skolem">convert_perm</span> <span class="bound">σ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">Q1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Q1</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">f</span><span class="main">∈</span><span class="skolem">tuples</span> <span class="skolem">X</span><span class="main">.</span> <span class="main">[:</span><span class="main">-</span> <span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">σ</span></span> <span class="main">|</span> <span class="bound">σ</span> <span class="keyword1">permutes</span> <span class="skolem">Roots</span><span class="main">.</span> <span class="bound">σ</span> <span class="main">(</span><span class="bound">f</span> <span class="bound">σ</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span>"</span></span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">ratpolys</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"complex poly set"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ratpolys</span> <span class="main">=</span> <span class="main">{</span><span class="bound">p</span><span class="main">.</span> <span class="main">∀</span><span class="bound">i</span><span class="main">.</span> poly.coeff <span class="bound">p</span> <span class="bound">i</span> <span class="main">∈</span> <span class="main">ℚ</span><span class="main">}</span>"</span></span>

      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"insertion <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">[:</span><span class="skolem">Root</span> <span class="bound">x</span><span class="main">:]</span><span class="main">)</span> <span class="skolem">Q</span> <span class="main">∈</span> <span class="skolem">ratpolys</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> symmetric_poly_of_roots_in_subring<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> l <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">.</span></span> <span class="main"><span class="main">[:</span></span><span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">:]</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"ring_closed <span class="skolem">ratpolys</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> ratpolys_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">standard</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> coeff_mult_semiring_closed<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">interpret</span></span> ratpolys<span class="main">:</span> ring_closed <span class="quoted"><span class="skolem">ratpolys</span></span> <span class="keyword1"><span class="command">.</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"pCons <span class="main">0</span> <span class="main">1</span> <span class="main">∈</span> <span class="skolem">ratpolys</span> "</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ratpolys_def coeff_pCons <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> nat.splits<span class="main">)</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">m</span><span class="main">.</span> MPoly_Type.coeff <span class="skolem">Q</span> <span class="bound">m</span> <span class="main">∈</span> <span class="skolem">ratpolys</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> Q_def
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> allI ratpolys.coeff_prod_closed<span class="main">)</span>
             <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> ratpolys.minus_closed ratpolys.sum_closed ratpolys.uminus_closed <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> coeff_Var mpoly_coeff_Const when_def<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"ring_homomorphism <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>complex<span class="main">.</span> <span class="main">[:</span><span class="bound">x</span><span class="main">:]</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">σ</span> <span class="main">(</span><span class="skolem">unRoot</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">(</span><span class="skolem">convert_perm</span> <span class="skolem">σ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">n</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> <span class="skolem">tuples</span> <span class="skolem">X</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">σ</span> <span class="keyword1">permutes</span> <span class="main">{..&lt;</span><span class="skolem">n</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">f</span> <span class="skolem">σ</span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">convert_perm</span> <span class="skolem">σ</span> <span class="main">∈</span> <span class="skolem">perms</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> bij_convert that<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> bij_betw_def perms_def<span class="main">)</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">(</span><span class="skolem">convert_perm</span> <span class="skolem">σ</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">Roots</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> tuples_def<span class="main">)</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">using</span></span> permutes_in_image<span class="main">[</span><span class="operator">OF</span> that<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"vars <span class="skolem">Q</span> <span class="main">⊆</span> <span class="main">{..&lt;</span><span class="skolem">n</span><span class="main">}</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> Q_def
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> order.trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> vars_prod<span class="main"><span class="main">]</span></span> UN_least order.trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> vars_sum<span class="main"><span class="main">]</span></span>
                order.trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> vars_diff<span class="main"><span class="main">]</span></span> Un_least<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> vars_Var<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">lc</span></span> <span class="main">::</span> <span class="quoted">complex</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">lc</span> <span class="main">=</span> of_int <span class="main">(</span>Polynomial.lead_coeff <span class="skolem">P</span><span class="main">)</span>"</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">[:</span>inverse <span class="skolem">lc</span><span class="main">:]</span> <span class="main">∈</span> <span class="skolem">ratpolys</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ratpolys_def coeff_pCons lc_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> nat.splits<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="main">[:</span>poly.coeff <span class="main">(</span>of_int_poly <span class="skolem">P</span><span class="main">)</span> <span class="bound">i</span><span class="main">:]</span> <span class="main">∈</span> <span class="skolem">ratpolys</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ratpolys_def coeff_pCons <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> nat.splits<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">lc</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> lc_def<span class="main">)</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">[:</span>inverse <span class="skolem">lc</span><span class="main">:]</span> <span class="main">*</span> <span class="main">[:</span><span class="skolem">lc</span><span class="main">:]</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rsquarefree <span class="main">(</span>of_int_poly <span class="skolem">P</span> <span class="main">::</span> complex poly<span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹squarefree <span class="main">(</span>of_int_poly <span class="skolem">P</span> <span class="main">::</span> complex poly<span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> squarefree_imp_rsquarefree<span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"of_int_poly <span class="skolem">P</span> <span class="main">=</span> Polynomial.smult <span class="skolem">lc</span> <span class="main">(</span><span class="main">∏</span><span class="bound">x</span><span class="main">∈</span><span class="skolem">Roots</span><span class="main">.</span> <span class="main">[:</span><span class="main">-</span><span class="bound">x</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> lc_def Roots_def of_int_hom.hom_lead_coeff<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> complex_poly_decompose_rsquarefree <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∏</span><span class="bound">x</span><span class="main">∈</span><span class="skolem">Roots</span><span class="main">.</span> <span class="main">[:</span><span class="main">-</span><span class="bound">x</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">i</span><span class="main">&lt;</span><span class="skolem">n</span><span class="main">.</span> <span class="main">[:</span><span class="main">-</span><span class="skolem">Root</span> <span class="bound">i</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> prod.reindex_bij_betw<span class="main"><span class="main">[</span></span><span class="operator">OF</span> Root<span class="main"><span class="main">,</span></span> <span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"of_int_poly <span class="skolem">P</span> <span class="main">=</span> Polynomial.smult <span class="skolem">lc</span> <span class="main">(</span><span class="main">∏</span><span class="bound">i</span><span class="main">&lt;</span><span class="skolem">n</span><span class="main">.</span> <span class="main">[:</span><span class="main">-</span> <span class="skolem">Root</span> <span class="bound">i</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"symmetric_mpoly <span class="main">{..&lt;</span><span class="skolem">n</span><span class="main">}</span> <span class="skolem">Q</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> symmetric_mpoly_def
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">π</span> <span class="keyword3"><span class="command">assume</span></span> π<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">π</span> <span class="keyword1">permutes</span> <span class="main">{..&lt;</span><span class="skolem">n</span><span class="main">}</span>"</span></span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"mpoly_map_vars <span class="skolem">π</span> <span class="skolem">Q</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">f</span><span class="main">∈</span><span class="skolem">tuples</span> <span class="skolem">X</span><span class="main">.</span> Const <span class="main">(</span>pCons <span class="main">0</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="main">∑</span> <span class="bound"><span class="bound">σ</span></span> <span class="main">|</span> <span class="bound">σ</span> <span class="keyword1">permutes</span> <span class="main">{..&lt;</span><span class="skolem">n</span><span class="main">}</span><span class="main">.</span>
                  Var <span class="main">(</span><span class="main">(</span><span class="skolem">π</span> <span class="main">∘</span> <span class="bound">σ</span><span class="main">)</span> <span class="main">(</span><span class="skolem">unRoot</span> <span class="main">(</span><span class="bound">f</span> <span class="main">(</span><span class="skolem">convert_perm</span> <span class="bound">σ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Q_def permutes_bij<span class="main"><span class="main">[</span></span><span class="operator">OF</span> π<span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">f</span><span class="main">∈</span><span class="skolem">tuples</span> <span class="skolem">X</span><span class="main">.</span> Const <span class="main">(</span>pCons <span class="main">0</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="main">∑</span> <span class="bound"><span class="bound">σ</span></span> <span class="main">|</span> <span class="bound">σ</span> <span class="keyword1">permutes</span> <span class="main">{..&lt;</span><span class="skolem">n</span><span class="main">}</span><span class="main">.</span>
                  Var <span class="main">(</span><span class="main">(</span><span class="skolem">π</span> <span class="main">∘</span> <span class="bound">σ</span><span class="main">)</span> <span class="main">(</span><span class="skolem">unRoot</span> <span class="main">(</span><span class="main">(</span><span class="bound">f</span> <span class="main">∘</span> <span class="main">(</span><span class="main">λ</span><span class="bound">σ</span><span class="main">.</span> <span class="skolem">convert_perm</span> <span class="skolem">π</span> <span class="main">∘</span> <span class="bound">σ</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">convert_perm</span> <span class="bound">σ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> π <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> prod.reindex_bij_betw <span class="main"><span class="main">[</span></span><span class="operator">OF</span> bij_convert'<span class="main"><span class="main">,</span></span> <span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">Q</span>"</span></span>
            <span class="keyword1"><span class="command">unfolding</span></span> Q_def
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> prod.cong<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
            <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">f</span><span class="main">)</span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span> <span class="bound"><span class="bound">σ</span></span> <span class="main">|</span> <span class="bound">σ</span> <span class="keyword1">permutes</span> <span class="main">{..&lt;</span><span class="skolem">n</span><span class="main">}</span><span class="main">.</span> Var <span class="main">(</span><span class="main">(</span><span class="skolem">π</span> <span class="main">∘</span> <span class="bound">σ</span><span class="main">)</span> <span class="main">(</span><span class="skolem">unRoot</span> <span class="main">(</span><span class="main">(</span><span class="skolem">f</span> <span class="main">∘</span> <span class="main">(</span><span class="main">λ</span><span class="bound">σ</span><span class="main">.</span> <span class="skolem">convert_perm</span> <span class="skolem">π</span> <span class="main">∘</span> <span class="bound">σ</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">convert_perm</span> <span class="bound">σ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
                  <span class="main">(</span><span class="main">∑</span> <span class="bound"><span class="bound">σ</span></span> <span class="main">|</span> <span class="bound">σ</span> <span class="keyword1">permutes</span> <span class="main">{..&lt;</span><span class="skolem">n</span><span class="main">}</span><span class="main">.</span> Var <span class="main">(</span><span class="main">(</span><span class="skolem">π</span> <span class="main">∘</span> <span class="bound">σ</span><span class="main">)</span> <span class="main">(</span><span class="skolem">unRoot</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">(</span><span class="skolem">convert_perm</span> <span class="main">(</span><span class="skolem">π</span> <span class="main">∘</span> <span class="bound">σ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> π <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.cong refl<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> convert_perm_compose<span class="main">)</span> <span class="operator">simp_all</span>
            <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span> <span class="bound"><span class="bound">σ</span></span> <span class="main">|</span> <span class="bound">σ</span> <span class="keyword1">permutes</span> <span class="main">{..&lt;</span><span class="skolem">n</span><span class="main">}</span><span class="main">.</span> Var <span class="main">(</span><span class="bound">σ</span> <span class="main">(</span><span class="skolem">unRoot</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">(</span><span class="skolem">convert_perm</span> <span class="bound">σ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> π <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> setum_permutations_compose_left <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"mpoly_map_vars <span class="skolem">π</span> <span class="skolem">Q</span> <span class="main">=</span> <span class="skolem">Q</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"insertion <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">[:</span><span class="skolem">Root</span> <span class="bound">x</span><span class="main">:]</span><span class="main">)</span> <span class="skolem">Q</span> <span class="main">=</span> <span class="skolem">Q1</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> Q_def Q1_def insertion_prod insertion_sum insertion_diff insertion_Const insertion_Var
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> prod.cong<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> f<span class="main">:</span> <span class="main">(</span>2 <span class="skolem">f</span><span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">σ</span></span> <span class="main">|</span> <span class="bound">σ</span> <span class="keyword1">permutes</span> <span class="main">{..&lt;</span><span class="skolem">n</span><span class="main">}</span><span class="main">.</span> <span class="main">[:</span><span class="skolem">Root</span> <span class="main">(</span><span class="bound">σ</span> <span class="main">(</span><span class="skolem">unRoot</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">(</span><span class="skolem">convert_perm</span> <span class="bound">σ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">:]</span><span class="main">)</span> <span class="main">=</span>
              <span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">σ</span></span> <span class="main">|</span> <span class="bound">σ</span> <span class="keyword1">permutes</span> <span class="main">{..&lt;</span><span class="skolem">n</span><span class="main">}</span><span class="main">.</span> <span class="main">[:</span><span class="skolem">convert_perm</span> <span class="bound">σ</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">(</span><span class="skolem">convert_perm</span> <span class="bound">σ</span><span class="main">)</span><span class="main">)</span><span class="main">:]</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sum.cong<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">σ</span><span class="main">)</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">convert_perm</span> <span class="skolem">σ</span> <span class="keyword1">permutes</span> <span class="skolem">Roots</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> bij_convert 2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> bij_betw_def<span class="main">)</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">(</span><span class="skolem">convert_perm</span> <span class="skolem">σ</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">Roots</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> f <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> tuples_def perms_def<span class="main">)</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> convert_perm_def<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp_all</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">σ</span></span> <span class="main">|</span> <span class="bound">σ</span> <span class="keyword1">permutes</span> <span class="skolem">Roots</span><span class="main">.</span> <span class="main">[:</span><span class="bound">σ</span> <span class="main">(</span><span class="skolem">f</span> <span class="bound">σ</span><span class="main">)</span><span class="main">:]</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.reindex_bij_betw<span class="main"><span class="main">[</span></span><span class="operator">OF</span> bij_convert<span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> pCons_one coeff_lift_hom.hom_sum<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp_all</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Q1</span> <span class="main">∈</span> <span class="skolem">ratpolys</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Q2</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"rat poly"</span></span> <span class="keyword2"><span class="keyword">where</span></span> Q2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Q1</span> <span class="main">=</span> map_poly of_rat <span class="skolem">Q2</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> ratpolys_def <span class="keyword1"><span class="command">using</span></span> ratpolyE<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">Q1</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Q1</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> Q1_def <span class="keyword1"><span class="command">using</span></span> fin_tuples<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">X</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> Q2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Q2</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Q3</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"int poly"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">lc</span></span> <span class="main">::</span> <span class="quoted">rat</span>
        <span class="keyword2"><span class="keyword">where</span></span> Q3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Q2</span> <span class="main">=</span> Polynomial.smult <span class="skolem">lc</span> <span class="main">(</span>of_int_poly <span class="skolem">Q3</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">lc</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"content <span class="skolem">Q3</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> rat_to_normalized_int_poly_exists<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">Q2</span> <span class="main">≠</span> <span class="main">0</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly_roots <span class="main">(</span>of_int_poly <span class="skolem">Q3</span><span class="main">)</span> <span class="main">=</span> poly_roots <span class="main">(</span>map_poly <span class="main">(</span>of_rat <span class="main">∘</span> of_int<span class="main">)</span> <span class="skolem">Q3</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"map_poly <span class="main">(</span>of_rat <span class="main">∘</span> of_int<span class="main">)</span> <span class="skolem">Q3</span> <span class="main">=</span> map_poly of_rat <span class="main">(</span>map_poly of_int <span class="skolem">Q3</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> map_poly_map_poly<span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly_roots <span class="main">…</span> <span class="main">=</span> poly_roots <span class="main">(</span>Polynomial.smult <span class="main">(</span>of_rat <span class="skolem">lc</span><span class="main">)</span> <span class="main">…</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">lc</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Polynomial.smult <span class="main">(</span>of_rat <span class="skolem">lc</span><span class="main">)</span> <span class="main">(</span>map_poly of_rat <span class="main">(</span>map_poly of_int <span class="skolem">Q3</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
                 map_poly of_rat <span class="main">(</span>Polynomial.smult <span class="skolem">lc</span> <span class="main">(</span>map_poly of_int <span class="skolem">Q3</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> of_rat_hom.map_poly_hom_smult<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">Q1</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> Q3 <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> Q2 <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly_roots <span class="skolem">Q1</span> <span class="main">=</span> <span class="skolem">R</span> <span class="skolem">X</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> Q1_def
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> poly_roots_prod<span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> poly_roots_linear<span class="main">)</span>
           <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> R_def perms_def sum_mset_image_mset_singleton sum_unfold_sum_mset<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">Q</span><span class="main">.</span> poly_roots <span class="main">(</span>of_int_poly <span class="bound">Q</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">R</span> <span class="skolem">X</span> <span class="main">∧</span> content <span class="bound">Q</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹content <span class="skolem">Q3</span> <span class="main">=</span> <span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">Q</span><span class="main">.</span> <span class="main">∀</span><span class="bound">X</span><span class="main">∈</span><span class="skolem">Roots_ms</span><span class="main">.</span> poly_roots <span class="main">(</span>of_int_poly <span class="main">(</span><span class="bound">Q</span> <span class="bound">X</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">R</span> <span class="bound">X</span> <span class="main">∧</span> content <span class="main">(</span><span class="bound">Q</span> <span class="bound">X</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
    We can now collect all the $e^{\sum \alpha_i}$ that happen to be equal and let the following
    be their coefficients:
  ›</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">β''</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"int poly <span class="main">⇒</span> int"</span></span>
    <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">β''</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">q</span><span class="main">.</span> <span class="main">∑</span><span class="bound">X</span><span class="main">∈</span><span class="skolem">Roots_ms</span><span class="main">.</span> int <span class="main">(</span>count <span class="main">(</span>prime_factorization <span class="main">(</span><span class="skolem">Q</span> <span class="bound">X</span><span class="main">)</span><span class="main">)</span> <span class="bound">q</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∏</span><span class="bound">x</span><span class="main">∈#</span><span class="bound">X</span><span class="main">.</span> <span class="skolem">β'</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> supp_β''<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">q</span><span class="main">.</span> <span class="skolem">β''</span> <span class="bound">q</span> <span class="main">≠</span> <span class="main">0</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">X</span><span class="main">∈</span><span class="skolem">Roots_ms</span><span class="main">.</span> prime_factors <span class="main">(</span><span class="skolem">Q</span> <span class="bound">X</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> β''_def <span class="keyword1"><span class="command">using</span></span> sum.not_neutral_contains_not_neutral <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

  <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
    We have to prove that <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>β''›</span></span></span></span> is not zero everywhere. We do this by selecting the nonzero term
    with the maximal exponent (w.r.t. the lexicographic ordering on the complex numbers) in every
    factor of the product and show that there is no other summand corresponding to these, so
    that their non-zero coefficient cannot get cancelled.
  ›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">q</span><span class="main">.</span> <span class="skolem">β''</span> <span class="bound">q</span> <span class="main">≠</span> <span class="main">0</span><span class="main">}</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">=</span> restrict <span class="main">(</span><span class="main">λ</span><span class="bound">σ</span><span class="main">.</span> inv_into UNIV <span class="bound">σ</span> <span class="main">(</span>complex_lex.Max <span class="main">(</span><span class="bound">σ</span> <span class="main">`</span> <span class="free">X</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="skolem">perms</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> <span class="skolem">perms</span> <span class="main">→</span> <span class="free">X</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">σ</span> <span class="keyword3"><span class="command">assume</span></span> σ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">σ</span> <span class="main">∈</span> <span class="skolem">perms</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"complex_lex.Max <span class="main">(</span><span class="skolem">σ</span> <span class="main">`</span> <span class="free">X</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">σ</span> <span class="main">`</span> <span class="free">X</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">X</span> <span class="main">≠</span> <span class="main">{}</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> complex_lex.Max_in finite_imageI<span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="skolem">σ</span> <span class="main">∈</span> <span class="free">X</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> σ <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> f_def permutes_inverses<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">σ</span></span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">Roots</span></span></span></span><span class="main"><span class="main">]</span></span> perms_def<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">hence</span></span> f'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> <span class="skolem">perms</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="skolem">Roots</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">X</span> <span class="main">⊆</span> <span class="skolem">Roots</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> f_def PiE_def<span class="main">)</span>

    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">Y</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Y</span> <span class="main">=</span> image_mset <span class="skolem">f</span> <span class="main">(</span>mset_set <span class="skolem">perms</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Y</span> <span class="main">∈</span> <span class="skolem">Roots_ms</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> f' <span class="quoted"><span class="quoted">‹finite <span class="skolem">perms</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Roots_ms_def Y_def<span class="main">)</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">σ</span><span class="main">∈</span><span class="skolem">perms</span><span class="main">.</span> <span class="bound">σ</span> <span class="main">(</span><span class="skolem">f</span> <span class="bound">σ</span><span class="main">)</span><span class="main">)</span> <span class="main">∈#</span> <span class="skolem">R</span> <span class="skolem">Y</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">from</span></span> f' <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> <span class="skolem">tuples</span> <span class="skolem">Y</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> tuples_def Y_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> R_def <span class="keyword1"><span class="command">using</span></span> fin_tuples<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">Y</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">R</span> <span class="skolem">Y</span> <span class="main">=</span> poly_roots <span class="main">(</span>of_int_poly <span class="main">(</span><span class="skolem">Q</span> <span class="skolem">Y</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Q<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">fact</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">p</span><span class="main">∈#</span>prime_factorization <span class="main">(</span><span class="skolem">Q</span> <span class="skolem">Y</span><span class="main">)</span><span class="main">.</span> poly_roots <span class="main">(</span>of_int_poly <span class="bound">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> poly_roots_of_int_conv_sum_prime_factors<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> prime_factors <span class="main">(</span><span class="skolem">Q</span> <span class="skolem">Y</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">σ</span><span class="main">∈</span><span class="skolem">perms</span><span class="main">.</span> <span class="bound">σ</span> <span class="main">(</span><span class="skolem">f</span> <span class="bound">σ</span><span class="main">)</span><span class="main">)</span> <span class="main">∈#</span> poly_roots <span class="main">(</span>of_int_poly <span class="skolem">q</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">β''</span> <span class="skolem">q</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">X</span><span class="main">∈</span><span class="main">{</span><span class="skolem">Y</span><span class="main">}</span><span class="main">.</span> int <span class="main">(</span>count <span class="main">(</span>prime_factorization <span class="main">(</span><span class="skolem">Q</span> <span class="bound">X</span><span class="main">)</span><span class="main">)</span> <span class="skolem">q</span><span class="main">)</span> <span class="main">*</span> prod_mset <span class="main">(</span>image_mset <span class="skolem">β'</span> <span class="bound">X</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> β''_def
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> sum.mono_neutral_right ballI<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">Y'</span> <span class="keyword3"><span class="command">assume</span></span> Y'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Y'</span> <span class="main">∈</span> <span class="skolem">Roots_ms</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">Y</span><span class="main">}</span>"</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"int <span class="main">(</span>count <span class="main">(</span>prime_factorization <span class="main">(</span><span class="skolem">Q</span> <span class="skolem">Y'</span><span class="main">)</span><span class="main">)</span> <span class="skolem">q</span><span class="main">)</span> <span class="main">*</span> <span class="main">∏<span class="hidden">⇩</span><sub>#</sub></span> <span class="main">(</span>image_mset <span class="skolem">β'</span> <span class="skolem">Y'</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"set_mset <span class="skolem">Y'</span> <span class="main">⊆</span> <span class="free">X</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> Y'_subset<span class="main">:</span> True
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∉</span> prime_factors <span class="main">(</span><span class="skolem">Q</span> <span class="skolem">Y'</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span>
          <span class="keyword3"><span class="command">assume</span></span> q'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> prime_factors <span class="main">(</span><span class="skolem">Q</span> <span class="skolem">Y'</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly_roots <span class="main">(</span>of_int_poly <span class="skolem">q</span> <span class="main">::</span> complex poly<span class="main">)</span> <span class="main">⊆#</span>
                         poly_roots <span class="main">(</span>of_int_poly <span class="main">(</span><span class="skolem">Q</span> <span class="skolem">Y'</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> q' <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> dvd_imp_poly_roots_subset of_int_poly_hom.hom_dvd<span class="main">)</span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">with</span></span> q<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">σ</span><span class="main">∈</span><span class="skolem">perms</span><span class="main">.</span> <span class="bound">σ</span> <span class="main">(</span><span class="skolem">f</span> <span class="bound">σ</span><span class="main">)</span><span class="main">)</span> <span class="main">∈#</span> poly_roots <span class="main">(</span>of_int_poly <span class="main">(</span><span class="skolem">Q</span> <span class="skolem">Y'</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> mset_subset_eqD<span class="main">)</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly_roots <span class="main">(</span>of_int_poly <span class="main">(</span><span class="skolem">Q</span> <span class="skolem">Y'</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">R</span> <span class="skolem">Y'</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> Q<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">Y'</span></span><span class="main">]</span> Y' <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> g<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> <span class="skolem">tuples</span> <span class="skolem">Y'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">σ</span><span class="main">∈</span><span class="skolem">perms</span><span class="main">.</span> <span class="bound">σ</span> <span class="main">(</span><span class="skolem">f</span> <span class="bound">σ</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">σ</span><span class="main">∈</span><span class="skolem">perms</span><span class="main">.</span> <span class="bound">σ</span> <span class="main">(</span><span class="skolem">g</span> <span class="bound">σ</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">unfolding</span></span> R_def <span class="keyword1"><span class="command">using</span></span> fin_tuples<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">Y'</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">σ</span><span class="main">∈</span><span class="skolem">perms</span><span class="main">.</span> <span class="bound">σ</span> <span class="main">(</span><span class="skolem">g</span> <span class="bound">σ</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;<span class="hidden">⇩</span><sub>ℂ</sub></span> <span class="main">(</span><span class="main">∑</span><span class="bound">σ</span><span class="main">∈</span><span class="skolem">perms</span><span class="main">.</span> <span class="bound">σ</span> <span class="main">(</span><span class="skolem">f</span> <span class="bound">σ</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sum_strict_mono_ex1_complex_lex<span class="main">)</span>
            <span class="keyword3"><span class="command">show</span></span> le<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">σ</span><span class="main">∈</span><span class="skolem">perms</span><span class="main">.</span> <span class="bound">σ</span> <span class="main">(</span><span class="skolem">g</span> <span class="bound">σ</span><span class="main">)</span> <span class="main">≤<span class="hidden">⇩</span><sub>ℂ</sub></span> <span class="bound">σ</span> <span class="main">(</span><span class="skolem">f</span> <span class="bound">σ</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">proof</span></span>
              <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">σ</span> <span class="keyword3"><span class="command">assume</span></span> σ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">σ</span> <span class="main">∈</span> <span class="skolem">perms</span>"</span></span>
              <span class="keyword1"><span class="command">hence</span></span> σ'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">σ</span> <span class="keyword1">permutes</span> <span class="skolem">Roots</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> perms_def<span class="main">)</span>
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"image_mset <span class="skolem">g</span> <span class="main">(</span>mset_set <span class="skolem">perms</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">Y'</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> g <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> tuples_def<span class="main">)</span>
              <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set_mset <span class="main">…</span> <span class="main">⊆</span> <span class="free">X</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
              <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">`</span> <span class="skolem">perms</span> <span class="main">⊆</span> <span class="free">X</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="skolem">perms</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">σ</span> <span class="main">(</span><span class="skolem">g</span> <span class="skolem">σ</span><span class="main">)</span> <span class="main">≤<span class="hidden">⇩</span><sub>ℂ</sub></span> complex_lex.Max <span class="main">(</span><span class="skolem">σ</span> <span class="main">`</span> <span class="free">X</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="skolem">perms</span>›</span></span> σ
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> complex_lex.Max.coboundedI finite_imageI imageI<span class="main">)</span>
                   <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> tuples_def<span class="main">)</span>
              <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">σ</span> <span class="main">(</span><span class="skolem">f</span> <span class="skolem">σ</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> σ <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_def permutes_inverses<span class="main"><span class="main">[</span></span><span class="operator">OF</span> σ'<span class="main"><span class="main">]</span></span><span class="main">)</span>
              <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">σ</span> <span class="main">(</span><span class="skolem">g</span> <span class="skolem">σ</span><span class="main">)</span> <span class="main">≤<span class="hidden">⇩</span><sub>ℂ</sub></span> <span class="skolem">σ</span> <span class="main">(</span><span class="skolem">f</span> <span class="skolem">σ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
            <span class="keyword1"><span class="command">qed</span></span>

            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"image_mset <span class="skolem">g</span> <span class="main">(</span>mset_set <span class="skolem">perms</span><span class="main">)</span> <span class="main">≠</span> image_mset <span class="skolem">f</span> <span class="main">(</span>mset_set <span class="skolem">perms</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> Y' g <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> tuples_def Y_def<span class="main">)</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">σ</span></span> <span class="keyword2"><span class="keyword">where</span></span> σ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">σ</span> <span class="main">∈#</span> mset_set <span class="skolem">perms</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="skolem">σ</span> <span class="main">≠</span> <span class="skolem">f</span> <span class="skolem">σ</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> multiset.map_cong<span class="main">)</span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">σ</span> <span class="keyword1">permutes</span> <span class="skolem">Roots</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> σ <span class="quoted"><span class="quoted">‹finite <span class="skolem">perms</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> perms_def<span class="main">)</span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">σ</span> <span class="main">(</span><span class="skolem">g</span> <span class="skolem">σ</span><span class="main">)</span> <span class="main">≠</span> <span class="skolem">σ</span> <span class="main">(</span><span class="skolem">f</span> <span class="skolem">σ</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> permutes_inj<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">σ</span> <span class="keyword1">permutes</span> <span class="skolem">Roots</span>›</span></span><span class="main">]</span> σ <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> inj_def<span class="main">)</span>
            <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">σ</span> <span class="main">(</span><span class="skolem">g</span> <span class="skolem">σ</span><span class="main">)</span> <span class="main">≤<span class="hidden">⇩</span><sub>ℂ</sub></span> <span class="skolem">σ</span> <span class="main">(</span><span class="skolem">f</span> <span class="skolem">σ</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> le σ <span class="quoted"><span class="quoted">‹finite <span class="skolem">perms</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">σ</span> <span class="main">(</span><span class="skolem">g</span> <span class="skolem">σ</span><span class="main">)</span> <span class="main">&lt;<span class="hidden">⇩</span><sub>ℂ</sub></span> <span class="skolem">σ</span> <span class="main">(</span><span class="skolem">f</span> <span class="skolem">σ</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">σ</span><span class="main">∈</span><span class="skolem">perms</span><span class="main">.</span> <span class="bound">σ</span> <span class="main">(</span><span class="skolem">g</span> <span class="bound">σ</span><span class="main">)</span> <span class="main">&lt;<span class="hidden">⇩</span><sub>ℂ</sub></span> <span class="bound">σ</span> <span class="main">(</span><span class="skolem">f</span> <span class="bound">σ</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> σ <span class="quoted"><span class="quoted">‹finite <span class="skolem">perms</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> <span class="quoted"><span class="quoted">‹finite <span class="skolem">perms</span>›</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">simp_all</span><span class="main">)</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> β'_def<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> <span class="quoted"><span class="quoted">‹<span class="skolem">Y</span> <span class="main">∈</span> <span class="skolem">Roots_ms</span>›</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> int <span class="main">(</span>count <span class="main">(</span>prime_factorization <span class="main">(</span><span class="skolem">Q</span> <span class="skolem">Y</span><span class="main">)</span><span class="main">)</span> <span class="skolem">q</span><span class="main">)</span> <span class="main">*</span> prod_mset <span class="main">(</span>image_mset <span class="skolem">β'</span> <span class="skolem">Y</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> q nz <span class="quoted"><span class="quoted">‹finite <span class="free">X</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">X</span> <span class="main">≠</span> <span class="main">{}</span>›</span></span> <span class="quoted"><span class="quoted">‹finite <span class="skolem">perms</span>›</span></span> f <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> β'_def Y_def<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">q</span><span class="main">.</span> <span class="skolem">β''</span> <span class="bound">q</span> <span class="main">≠</span> <span class="main">0</span><span class="main">}</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
    We are now ready for the final push: we start with the original sum that we know to be zero,
    multiply it with the other permutations, and then multiply out the sum.
  ›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="free">X</span><span class="main">.</span> <span class="free">β</span> <span class="bound">x</span> <span class="main">*</span> exp <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> sum0 <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="skolem">Roots</span><span class="main">.</span> <span class="skolem">β'</span> <span class="bound">x</span> <span class="main">*</span> exp <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.mono_neutral_cong_left <span class="quoted"><span class="quoted">‹<span class="free">X</span> <span class="main">⊆</span> <span class="skolem">Roots</span>›</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> β'_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="keyword1">dvd</span> <span class="main">(</span><span class="main">∏</span><span class="bound">σ</span><span class="main">∈</span><span class="skolem">perms</span><span class="main">.</span> <span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="skolem">Roots</span><span class="main">.</span> <span class="skolem">β'</span> <span class="bound">x</span> <span class="main">*</span> exp <span class="main">(</span><span class="bound">σ</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> dvd_prodI<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹finite <span class="skolem">perms</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
       <span class="main">(</span><span class="operator">use</span> permutes_id<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">Roots</span></span></span></span></span></span><span class="main"><span class="main">]</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="quoted">‹<span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main">:</span> id_def perms_def›</span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">f</span><span class="main">∈</span><span class="skolem">perms</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="skolem">Roots</span><span class="main">.</span> <span class="main">∏</span><span class="bound">σ</span><span class="main">∈</span><span class="skolem">perms</span><span class="main">.</span> <span class="skolem">β'</span> <span class="main">(</span><span class="bound">f</span> <span class="bound">σ</span><span class="main">)</span> <span class="main">*</span> exp <span class="main">(</span><span class="bound">σ</span> <span class="main">(</span><span class="bound">f</span> <span class="bound">σ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> prod_sum_PiE<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">f</span><span class="main">∈</span><span class="skolem">perms</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="skolem">Roots</span><span class="main">.</span> <span class="main">(</span><span class="main">∏</span><span class="bound">σ</span><span class="main">∈</span><span class="skolem">perms</span><span class="main">.</span> <span class="skolem">β'</span> <span class="main">(</span><span class="bound">f</span> <span class="bound">σ</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> exp <span class="main">(</span><span class="main">∑</span><span class="bound">σ</span><span class="main">∈</span><span class="skolem">perms</span><span class="main">.</span> <span class="bound">σ</span> <span class="main">(</span><span class="bound">f</span> <span class="bound">σ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="skolem">perms</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prod.distrib exp_sum<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">X</span><span class="main">,</span><span class="bound">f</span><span class="main">)</span><span class="main">∈</span><span class="skolem">tuples'</span><span class="main">.</span> <span class="main">(</span><span class="main">∏</span><span class="bound">σ</span><span class="main">∈</span><span class="skolem">perms</span><span class="main">.</span> <span class="skolem">β'</span> <span class="main">(</span><span class="bound">f</span> <span class="bound">σ</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> exp <span class="main">(</span><span class="main">∑</span><span class="bound">σ</span><span class="main">∈</span><span class="skolem">perms</span><span class="main">.</span> <span class="bound">σ</span> <span class="main">(</span><span class="bound">f</span> <span class="bound">σ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="skolem">perms</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.reindex_bij_witness<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">snd</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">λ</span></span></span><span class="bound"><span class="bound"><span class="bound">f</span></span></span><span class="main"><span class="main"><span class="main">.</span></span></span> <span class="main"><span class="main"><span class="main">(</span></span></span>image_mset <span class="bound"><span class="bound"><span class="bound">f</span></span></span> <span class="main"><span class="main"><span class="main">(</span></span></span>mset_set <span class="skolem"><span class="skolem"><span class="skolem">perms</span></span></span><span class="main"><span class="main"><span class="main">)</span></span></span><span class="main"><span class="main"><span class="main">,</span></span></span> <span class="bound"><span class="bound"><span class="bound">f</span></span></span><span class="main"><span class="main"><span class="main">)</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
       <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> tuples'_def tuples_def Roots_ms_def PiE_def Pi_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">X</span><span class="main">,</span><span class="bound">f</span><span class="main">)</span><span class="main">∈</span><span class="skolem">tuples'</span><span class="main">.</span> <span class="main">(</span><span class="main">∏</span><span class="bound">x</span><span class="main">∈#</span><span class="bound">X</span><span class="main">.</span> <span class="skolem">β'</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> exp <span class="main">(</span><span class="main">∑</span><span class="bound">σ</span><span class="main">∈</span><span class="skolem">perms</span><span class="main">.</span> <span class="bound">σ</span> <span class="main">(</span><span class="bound">f</span> <span class="bound">σ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">safe</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> sum.cong<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">X</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"complex multiset"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>complex <span class="main">⇒</span> complex<span class="main">)</span> <span class="main">⇒</span> complex"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">X</span><span class="main">,</span> <span class="skolem">f</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">tuples'</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> X<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">∈</span> <span class="skolem">Roots_ms</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">=</span> image_mset <span class="skolem">f</span> <span class="main">(</span>mset_set <span class="skolem">perms</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> <span class="skolem">perms</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="skolem">Roots</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> tuples'_def tuples_def<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∏</span><span class="bound">σ</span><span class="main">∈</span><span class="skolem">perms</span><span class="main">.</span> <span class="skolem">β'</span> <span class="main">(</span><span class="skolem">f</span> <span class="bound">σ</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">σ</span><span class="main">∈#</span>mset_set <span class="skolem">perms</span><span class="main">.</span> <span class="skolem">β'</span> <span class="main">(</span><span class="skolem">f</span> <span class="bound">σ</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> prod_unfold_prod_mset<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">x</span><span class="main">∈#</span><span class="skolem">X</span><span class="main">.</span> <span class="skolem">β'</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> X<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> multiset.map_comp o_def<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∏</span><span class="bound">σ</span><span class="main">∈</span><span class="skolem">perms</span><span class="main">.</span> <span class="skolem">β'</span> <span class="main">(</span><span class="skolem">f</span> <span class="bound">σ</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> exp <span class="main">(</span><span class="main">∑</span><span class="bound">σ</span><span class="main">∈</span><span class="skolem">perms</span><span class="main">.</span> <span class="bound">σ</span> <span class="main">(</span><span class="skolem">f</span> <span class="bound">σ</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
                  <span class="main">(</span><span class="main">∏</span><span class="bound">x</span><span class="main">∈#</span><span class="skolem">X</span><span class="main">.</span> <span class="skolem">β'</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> exp <span class="main">(</span><span class="main">∑</span><span class="bound">σ</span><span class="main">∈</span><span class="skolem">perms</span><span class="main">.</span> <span class="bound">σ</span> <span class="main">(</span><span class="skolem">f</span> <span class="bound">σ</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">X</span><span class="main">∈</span><span class="skolem">Roots_ms</span><span class="main">.</span> <span class="main">∑</span><span class="bound">f</span><span class="main">∈</span><span class="skolem">tuples</span> <span class="bound">X</span><span class="main">.</span> <span class="main">(</span><span class="main">∏</span><span class="bound">x</span><span class="main">∈#</span><span class="bound">X</span><span class="main">.</span> <span class="skolem">β'</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> exp <span class="main">(</span><span class="main">∑</span><span class="bound">σ</span><span class="main">∈</span><span class="skolem">perms</span><span class="main">.</span> <span class="bound">σ</span> <span class="main">(</span><span class="bound">f</span> <span class="bound">σ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> tuples'_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.Sigma <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">X</span><span class="main">∈</span><span class="skolem">Roots_ms</span><span class="main">.</span> of_int <span class="main">(</span><span class="main">∏</span><span class="bound">x</span><span class="main">∈#</span><span class="bound">X</span><span class="main">.</span> <span class="skolem">β'</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∑</span><span class="bound">f</span><span class="main">∈</span><span class="skolem">tuples</span> <span class="bound">X</span><span class="main">.</span> exp <span class="main">(</span><span class="main">∑</span><span class="bound">σ</span><span class="main">∈</span><span class="skolem">perms</span><span class="main">.</span> <span class="bound">σ</span> <span class="main">(</span><span class="bound">f</span> <span class="bound">σ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_distrib_left<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">X</span><span class="main">∈</span><span class="skolem">Roots_ms</span><span class="main">.</span> of_int <span class="main">(</span><span class="main">∏</span><span class="bound">x</span><span class="main">∈#</span><span class="bound">X</span><span class="main">.</span> <span class="skolem">β'</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈#</span><span class="skolem">R</span> <span class="bound">X</span><span class="main">.</span> exp <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> R_def multiset.map_comp o_def sum_unfold_sum_mset<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">X</span><span class="main">∈</span><span class="skolem">Roots_ms</span><span class="main">.</span> of_int <span class="main">(</span><span class="main">∏</span><span class="bound">x</span><span class="main">∈#</span><span class="bound">X</span><span class="main">.</span> <span class="skolem">β'</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈#</span>poly_roots <span class="main">(</span>of_int_poly <span class="main">(</span><span class="skolem">Q</span> <span class="bound">X</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> exp <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.cong<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> Q<span class="main">)</span>

  <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
    Our problem now is that the polynomials <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>Q X›</span></span></span></span> can still contain multiple roots and that their
    roots might not be disjoint. We therefore split them all into irreducible factors and collect
    equal terms.
  ›</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">X</span><span class="main">∈</span><span class="skolem">Roots_ms</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">p</span><span class="main">.</span> of_int <span class="main">(</span>int <span class="main">(</span>count <span class="main">(</span>prime_factorization <span class="main">(</span><span class="skolem">Q</span> <span class="bound">X</span><span class="main">)</span><span class="main">)</span> <span class="bound">p</span><span class="main">)</span> <span class="main">*</span>
                      <span class="main">(</span><span class="main">∏</span><span class="bound">x</span><span class="main">∈#</span><span class="bound">X</span><span class="main">.</span> <span class="skolem">β'</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">x</span></span> <span class="main">|</span> ipoly <span class="bound">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">.</span> exp <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sum.cong<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">X</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈#</span>poly_roots <span class="main">(</span>of_int_poly <span class="main">(</span><span class="skolem">Q</span> <span class="skolem">X</span><span class="main">)</span> <span class="main">::</span> complex poly<span class="main">)</span><span class="main">.</span> exp <span class="bound">x</span><span class="main">)</span> <span class="main">=</span>
          <span class="main">(</span><span class="main">∑</span><span class="bound">x</span> <span class="main">∈#</span> <span class="main">(</span><span class="main">∑</span><span class="bound">p</span><span class="main">∈#</span>prime_factorization <span class="main">(</span><span class="skolem">Q</span> <span class="skolem">X</span><span class="main">)</span><span class="main">.</span> poly_roots <span class="main">(</span>of_int_poly <span class="bound">p</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> exp <span class="bound">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> poly_roots_of_int_conv_sum_prime_factors<span class="main">)</span> <span class="main">(</span><span class="operator">rule</span> refl<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">p</span><span class="main">∈#</span>prime_factorization <span class="main">(</span><span class="skolem">Q</span> <span class="skolem">X</span><span class="main">)</span><span class="main">.</span> <span class="main">∑</span><span class="bound">x</span><span class="main">∈#</span>poly_roots <span class="main">(</span>of_int_poly <span class="bound">p</span><span class="main">)</span><span class="main">.</span> exp <span class="bound">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum_mset_image_mset_sum_mset_image_mset<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rsquarefree <span class="main">(</span>of_int_poly <span class="skolem">p</span> <span class="main">::</span> complex poly<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> prime_factors <span class="main">(</span><span class="skolem">Q</span> <span class="skolem">X</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">p</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> irreducible_imp_rsquarefree_of_int_poly<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prime <span class="skolem">p</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"irreducible <span class="skolem">p</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Polynomial.degree <span class="skolem">p</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> content_1_imp_nonconstant_prime_factors<span class="main"><span class="main">[</span></span><span class="operator">OF</span> Q<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> that<span class="main"><span class="main">]</span></span> 2<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">p</span><span class="main">∈#</span>prime_factorization <span class="main">(</span><span class="skolem">Q</span> <span class="skolem">X</span><span class="main">)</span><span class="main">.</span> <span class="main">∑</span><span class="bound">x</span><span class="main">∈#</span>poly_roots <span class="main">(</span>of_int_poly <span class="bound">p</span><span class="main">)</span><span class="main">.</span> exp <span class="bound">x</span><span class="main">)</span> <span class="main">=</span>
           <span class="main">(</span><span class="main">∑</span><span class="bound">p</span><span class="main">∈#</span>prime_factorization <span class="main">(</span><span class="skolem">Q</span> <span class="skolem">X</span><span class="main">)</span><span class="main">.</span> <span class="main">∑</span><span class="bound"><span class="bound">x</span></span> <span class="main">|</span> ipoly <span class="bound">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">.</span> exp <span class="main">(</span><span class="bound">x</span> <span class="main">::</span> complex<span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> sum_unfold_sum_mset
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> arg_cong<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">sum_mset</span></span></span><span class="main"><span class="main">]</span></span> image_mset_cong sum.cong refl<span class="main"><span class="keyword3">,</span></span>
          <span class="operator">subst</span> rsquarefree_poly_roots_eq<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">p</span><span class="main">.</span> count <span class="main">(</span>prime_factorization <span class="main">(</span><span class="skolem">Q</span> <span class="skolem">X</span><span class="main">)</span><span class="main">)</span> <span class="bound">p</span> <span class="main">*</span> <span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">x</span></span> <span class="main">|</span> ipoly <span class="bound">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">.</span> exp <span class="main">(</span><span class="bound">x</span> <span class="main">::</span> complex<span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum_mset_conv_Sum_any<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"of_int <span class="main">(</span><span class="main">∏</span><span class="bound">x</span><span class="main">∈#</span><span class="skolem">X</span><span class="main">.</span> <span class="skolem">β'</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="main">…</span> <span class="main">=</span>
               <span class="main">(</span><span class="main">∑</span><span class="bound">p</span><span class="main">.</span> of_int <span class="main">(</span>int <span class="main">(</span>count <span class="main">(</span>prime_factorization <span class="main">(</span><span class="skolem">Q</span> <span class="skolem">X</span><span class="main">)</span><span class="main">)</span> <span class="bound">p</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∏</span><span class="bound">x</span><span class="main">∈#</span><span class="skolem">X</span><span class="main">.</span> <span class="skolem">β'</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">x</span></span> <span class="main">|</span> ipoly <span class="bound">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">.</span> exp <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> Sum_any_right_distrib<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mult_ac<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">q</span><span class="main">.</span> of_int <span class="main">(</span><span class="skolem">β''</span> <span class="bound">q</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">x</span></span> <span class="main">|</span> ipoly <span class="bound">q</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">.</span> exp <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> β''_def of_int_sum
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> Sum_any_sum_swap <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sum_distrib_right<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">q</span></span> <span class="main">|</span> <span class="skolem">β''</span> <span class="bound">q</span> <span class="main">≠</span> <span class="main">0</span><span class="main">.</span> of_int <span class="main">(</span><span class="skolem">β''</span> <span class="bound">q</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">x</span></span> <span class="main">|</span> ipoly <span class="bound">q</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">.</span> exp <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> Sum_any.expand_superset finite_subset<span class="main"><span class="main">[</span></span><span class="operator">OF</span> supp_β''<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">q</span></span> <span class="main">|</span> <span class="skolem">β''</span> <span class="bound">q</span> <span class="main">≠</span> <span class="main">0</span><span class="main">.</span> of_int <span class="main">(</span><span class="skolem">β''</span> <span class="bound">q</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">x</span></span> <span class="main">|</span> ipoly <span class="bound">q</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">.</span> exp <span class="main">(</span><span class="bound">x</span> <span class="main">::</span> complex<span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
    We are now in the situation of our the specialised Hermite--Lindemann Theorem we proved
    earlier and can easily derive a contradiction.
  ›</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">q</span></span> <span class="main">|</span> <span class="skolem">β''</span> <span class="bound">q</span> <span class="main">≠</span> <span class="main">0</span><span class="main">.</span> of_int <span class="main">(</span><span class="skolem">β''</span> <span class="bound">q</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">x</span></span> <span class="main">|</span> ipoly <span class="bound">q</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">.</span> exp <span class="main">(</span><span class="bound">x</span> <span class="main">::</span> complex<span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Hermite_Lindemann_aux1<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound">q</span><span class="main">.</span> <span class="skolem">β''</span> <span class="bound">q</span> <span class="main">≠</span> <span class="main">0</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> finite_subset<span class="main"><span class="main">[</span></span><span class="operator">OF</span> supp_β''<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"pairwise Rings.coprime <span class="main">{</span><span class="bound">q</span><span class="main">.</span> <span class="skolem">β''</span> <span class="bound">q</span> <span class="main">≠</span> <span class="main">0</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> pairwiseI<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarify</span><span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span> <span class="skolem">q</span> <span class="keyword3"><span class="command">assume</span></span> pq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">≠</span> <span class="skolem">q</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">β''</span> <span class="skolem">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">β''</span> <span class="skolem">q</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"prime <span class="skolem">p</span>"</span></span> <span class="quoted"><span class="quoted">"prime <span class="skolem">q</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> supp_β'' Q<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> pq <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Rings.coprime <span class="skolem">p</span> <span class="skolem">q</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> primes_coprime<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">q</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"int poly"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">q</span><span class="main">.</span> <span class="skolem">β''</span> <span class="bound">q</span> <span class="main">≠</span> <span class="main">0</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">note</span></span> supp_β''
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">X</span></span> <span class="keyword2"><span class="keyword">where</span></span> X<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">∈</span> <span class="skolem">Roots_ms</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> prime_factors <span class="main">(</span><span class="skolem">Q</span> <span class="skolem">X</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"irreducible <span class="skolem">q</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> X <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> prime_elem_imp_irreducible prime_imp_prime_elem<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Polynomial.degree <span class="skolem">q</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> X
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> content_1_imp_nonconstant_prime_factors<span class="main"><span class="main">[</span></span><span class="operator">OF</span> Q<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">X</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> <span class="quoted"><span class="quoted">‹<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">β''</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span><span class="main">}</span> <span class="main">≠</span> <span class="main">{}</span>›</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>

  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">contradiction</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Removing the restriction to integer coefficients›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Next, we weaken the restriction that the $\beta_i$ must be integers to the restriction
  that they must be rationals. This is done simply by multiplying with the least common multiple
  of the demoninators.
›</span></span>
<span class="keyword1" id="Hermite_Lindemann-Hermite_Lindemann_aux3"><span class="command">lemma</span></span> Hermite_Lindemann_aux3<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">X</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"complex set"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">β</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"complex <span class="main">⇒</span> rat"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">X</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> nz<span class="main">:</span>   <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">⟹</span> <span class="free">β</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> alg<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">⟹</span> algebraic <span class="bound">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> sum0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="free">X</span><span class="main">.</span> of_rat <span class="main">(</span><span class="free">β</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> exp <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">l</span></span> <span class="main">::</span> <span class="quoted">int</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">=</span> Lcm <span class="main">(</span><span class="main">(</span>snd <span class="main">∘</span> quotient_of <span class="main">∘</span> <span class="free">β</span><span class="main">)</span> <span class="main">`</span> <span class="free">X</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"snd <span class="main">(</span>quotient_of <span class="skolem">r</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">r</span>
    <span class="keyword1"><span class="command">using</span></span> quotient_of_denom_pos'<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">r</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">X</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> l_def Lcm_0_iff<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"of_int <span class="skolem">l</span> <span class="main">*</span> <span class="free">β</span> <span class="skolem">x</span> <span class="main">∈</span> <span class="main">ℤ</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> fst <span class="main">(</span>quotient_of <span class="main">(</span><span class="free">β</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">=</span> snd <span class="main">(</span>quotient_of <span class="main">(</span><span class="free">β</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> quotient_of_denom_pos'<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">β</span> <span class="skolem">x</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> b_def<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">β</span> <span class="skolem">x</span> <span class="main">=</span> of_int <span class="skolem">a</span> <span class="main">/</span> of_int <span class="skolem">b</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> quotient_of_div<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> a_def b_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"of_int <span class="skolem">l</span> <span class="main">*</span> <span class="main">…</span> <span class="main">=</span> of_int <span class="main">(</span><span class="skolem">l</span> <span class="main">*</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">/</span> of_int <span class="skolem">b</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">∈</span> <span class="main">ℤ</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> that
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> of_int_divide_in_Ints<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> l_def b_def<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">X</span><span class="main">.</span> <span class="main">∃</span><span class="bound">n</span><span class="main">.</span> of_int <span class="bound">n</span> <span class="main">=</span> of_int <span class="skolem">l</span> <span class="main">*</span> <span class="free">β</span> <span class="bound">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Ints_cases <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">β'</span></span> <span class="keyword2"><span class="keyword">where</span></span> β'<span class="main">:</span> <span class="quoted"><span class="quoted">"of_int <span class="main">(</span><span class="skolem">β'</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> of_int <span class="skolem">l</span> <span class="main">*</span> <span class="free">β</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Hermite_Lindemann_aux2<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">=</span> of_int <span class="skolem">l</span> <span class="main">*</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="free">X</span><span class="main">.</span> of_rat <span class="main">(</span><span class="free">β</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> exp <span class="bound">x</span> <span class="main">::</span> complex<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum0<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="free">X</span><span class="main">.</span> of_int <span class="main">(</span><span class="skolem">β'</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> exp <span class="bound">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> sum_distrib_left
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sum.cong<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">x</span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"of_int <span class="skolem">l</span> <span class="main">*</span> of_rat <span class="main">(</span><span class="free">β</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> of_rat <span class="main">(</span>of_int <span class="skolem">l</span> <span class="main">*</span> <span class="free">β</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> of_rat_mult<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"of_int <span class="skolem">l</span> <span class="main">*</span> <span class="free">β</span> <span class="skolem">x</span> <span class="main">=</span> of_int <span class="main">(</span><span class="skolem">β'</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> 2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> β' <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_ac<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">X</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"of_int <span class="main">(</span><span class="skolem">β'</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span><span class="main">0</span> <span class="main">::</span> rat<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> nz
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> β'<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">β'</span> <span class="skolem">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> alg <span class="quoted"><span class="quoted">‹finite <span class="free">X</span>›</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Next, we weaken the restriction that the $\beta_i$ must be rational to them being algebraic.
  Similarly to before, this is done by multiplying over all possible permutations of the $\beta_i$
  (in some sense) to introduce more symmetry, from which it then follows by the fundamental theorem
  of symmetric polynomials that the resulting coefficients are rational.
›</span></span>
<span class="keyword1" id="Hermite_Lindemann-Hermite_Lindemann_aux4"><span class="command">lemma</span></span> Hermite_Lindemann_aux4<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">β</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"complex <span class="main">⇒</span> complex"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">X</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> alg1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">⟹</span> algebraic <span class="bound">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> alg2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">⟹</span> algebraic <span class="main">(</span><span class="free">β</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> nz<span class="main">:</span>   <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">⟹</span> <span class="free">β</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> sum0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="free">X</span><span class="main">.</span> <span class="free">β</span> <span class="bound">x</span> <span class="main">*</span> exp <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> X<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">note</span></span> <span class="main">[</span><span class="operator">intro</span><span class="main"><span class="main">!</span></span><span class="main">]</span> <span class="main">=</span> finite_PiE

  <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
    We now take more or less the same approach as before, except that now we find a polynomial
    that has all of the conjugates of the coefficients <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>β›</span></span></span></span> as roots. Note that this is a slight
    deviation from Baker's proof, who picks one polynomial for each <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>β›</span></span></span></span> independently. I did it
    this way because, as Bernard~\cite{bernard} observed, it makes the proof a bit easier.
  ›</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">P</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"int poly"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="main">=</span> <span class="main">∏</span><span class="main">(</span><span class="main">(</span>min_int_poly <span class="main">∘</span> <span class="free">β</span><span class="main">)</span> <span class="main">`</span> <span class="free">X</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">Roots</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"complex set"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Roots</span> <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> ipoly <span class="skolem">P</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∉</span> <span class="skolem">Roots</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">X</span>›</span></span> alg2 nz
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Roots_def P_def poly_prod<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">X</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> P_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="skolem">Roots</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> Roots_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> poly_roots_finite<span class="main">)</span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">β</span> <span class="main">`</span> <span class="free">X</span> <span class="main">⊆</span> <span class="skolem">Roots</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">X</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"ipoly <span class="main">(</span>min_int_poly <span class="main">(</span><span class="free">β</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">β</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> ipoly_min_int_poly alg2<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">β</span> <span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">Roots</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">X</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="free">X</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Roots_def P_def of_int_poly_hom.hom_prod poly_prod<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"squarefree <span class="main">(</span>of_int_poly <span class="skolem">P</span> <span class="main">::</span> complex poly<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> P_def of_int_poly_hom.hom_prod o_def
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> squarefree_prod_coprime<span class="main"><span class="keyword3">;</span></span> <span class="operator">safe</span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">X</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"squarefree <span class="main">(</span>of_int_poly <span class="main">(</span>min_int_poly <span class="main">(</span><span class="free">β</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">::</span> complex poly<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> squarefree_of_int_polyI<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="keyword3"><span class="command">assume</span></span> xy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">X</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="free">X</span>"</span></span> <span class="quoted"><span class="quoted">"min_int_poly <span class="main">(</span><span class="free">β</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">≠</span> min_int_poly <span class="main">(</span><span class="free">β</span> <span class="skolem">y</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"Rings.coprime <span class="main">(</span>of_int_poly <span class="main">(</span>min_int_poly <span class="main">(</span><span class="free">β</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
            <span class="main">(</span>of_int_poly <span class="main">(</span>min_int_poly <span class="main">(</span><span class="free">β</span> <span class="skolem">y</span><span class="main">)</span><span class="main">)</span> <span class="main">::</span> complex poly<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> coprime_of_int_polyI<span class="main"><span class="main">[</span></span><span class="operator">OF</span> primes_coprime<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> card <span class="skolem">Roots</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">=</span> card <span class="free">X</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Roots</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">β</span> <span class="main">`</span> <span class="free">X</span> <span class="main">⊆</span> <span class="skolem">Roots</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">X</span> <span class="main">≠</span> <span class="main">{}</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="skolem">Roots</span>›</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">X</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">X</span> <span class="main">≠</span> <span class="main">{}</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> n_def m_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> fin1 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="free">X</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="skolem">Roots</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="free">X</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="skolem">Roots</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">n</span> <span class="main">^</span> <span class="skolem">m</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> card_PiE<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> m_def n_def<span class="main">)</span>

  <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
    We again find a bijection between the roots and the natural numbers less than <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>n›</span></span></span></span>:
  ›</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Root</span></span> <span class="keyword2"><span class="keyword">where</span></span> Root<span class="main">:</span> <span class="quoted"><span class="quoted">"bij_betw <span class="skolem">Root</span> <span class="main">{..&lt;</span><span class="skolem">n</span><span class="main">}</span> <span class="skolem">Roots</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ex_bij_betw_nat_finite<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹finite <span class="skolem">Roots</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> n_def atLeast0LessThan <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">unRoot</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"complex <span class="main">⇒</span> nat"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">unRoot</span> <span class="main">=</span> inv_into <span class="main">{..&lt;</span><span class="skolem">n</span><span class="main">}</span> <span class="skolem">Root</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> unRoot<span class="main">:</span> <span class="quoted"><span class="quoted">"bij_betw <span class="skolem">unRoot</span> <span class="skolem">Roots</span> <span class="main">{..&lt;</span><span class="skolem">n</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> unRoot_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> bij_betw_inv_into Root<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> unRoot_Root <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">unRoot</span> <span class="main">(</span><span class="skolem">Root</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">i</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="skolem">n</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span>
    <span class="keyword1"><span class="command">unfolding</span></span> unRoot_def <span class="keyword1"><span class="command">using</span></span> Root that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> inv_into_f_f<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> bij_betw_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> Root_unRoot <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Root</span> <span class="main">(</span><span class="skolem">unRoot</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">Roots</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
    <span class="keyword1"><span class="command">unfolding</span></span> unRoot_def <span class="keyword1"><span class="command">using</span></span> Root that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> f_inv_into_f<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> bij_betw_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">,</span> <span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Root</span> <span class="skolem">i</span> <span class="main">∈</span> <span class="skolem">Roots</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="skolem">n</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span>
    <span class="keyword1"><span class="command">using</span></span> Root that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> bij_betw_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">,</span> <span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">unRoot</span> <span class="skolem">x</span> <span class="main">&lt;</span> <span class="skolem">n</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">Roots</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
    <span class="keyword1"><span class="command">using</span></span> unRoot that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> bij_betw_def<span class="main">)</span>

  <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
    And we again define the set of multisets and tuples that we will get in the expanded product.
  ›</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">Roots_ms</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"complex multiset set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="skolem">Roots_ms</span> <span class="main">=</span> <span class="main">{</span><span class="bound">Y</span><span class="main">.</span> set_mset <span class="bound">Y</span> <span class="main">⊆</span> <span class="free">X</span> <span class="main">∧</span> size <span class="bound">Y</span> <span class="main">=</span> <span class="skolem">n</span> <span class="main">^</span> <span class="skolem">m</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="skolem">Roots_ms</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> Roots_ms_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> finite_multisets_of_size<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">tuples</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"complex multiset <span class="main">⇒</span> <span class="main">(</span><span class="main">(</span>complex <span class="main">⇒</span> complex<span class="main">)</span> <span class="main">⇒</span> complex<span class="main">)</span> set"</span></span>
    <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">tuples</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">Y</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">f</span></span><span class="main">∈</span><span class="main">(</span><span class="free">X</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="skolem">Roots</span><span class="main">)</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">X</span><span class="main">.</span> image_mset <span class="bound">f</span> <span class="main">(</span>mset_set <span class="main">(</span><span class="free">X</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="skolem">Roots</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="bound">Y</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="skolem">tuples</span> <span class="skolem">Y</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">Y</span>
    <span class="keyword1"><span class="command">unfolding</span></span> tuples_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> finite_subset<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">(</span></span></span><span class="free"><span class="free"><span class="free">X</span></span></span> <span class="keyword1"><span class="keyword1"><span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span></span></span> <span class="skolem"><span class="skolem"><span class="skolem">Roots</span></span></span><span class="main"><span class="main"><span class="main">)</span></span></span> <span class="keyword1"><span class="keyword1"><span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span></span></span> <span class="free"><span class="free"><span class="free">X</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
    We will also need to convert permutations over the natural and over the roots again.
  ›</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">convert_perm</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>nat <span class="main">⇒</span> nat<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span>complex <span class="main">⇒</span> complex<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="skolem">convert_perm</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">σ</span> <span class="bound">x</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">x</span> <span class="main">∈</span> <span class="skolem">Roots</span> <span class="keyword1">then</span> <span class="skolem">Root</span> <span class="main">(</span><span class="bound">σ</span> <span class="main">(</span><span class="skolem">unRoot</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">else</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> bij_convert<span class="main">:</span> <span class="quoted"><span class="quoted">"bij_betw <span class="skolem">convert_perm</span> <span class="main">{</span><span class="bound">σ</span><span class="main">.</span> <span class="bound">σ</span> <span class="keyword1">permutes</span> <span class="main">{..&lt;</span><span class="skolem">n</span><span class="main">}</span><span class="main">}</span> <span class="main">{</span><span class="bound">σ</span><span class="main">.</span> <span class="bound">σ</span> <span class="keyword1">permutes</span> <span class="skolem">Roots</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> bij_betw_permutations<span class="main">[</span><span class="operator">OF</span> Root<span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> convert_perm_def unRoot_def <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">have</span></span> permutes_convert_perm <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">convert_perm</span> <span class="skolem">σ</span> <span class="keyword1">permutes</span> <span class="skolem">Roots</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">σ</span> <span class="keyword1">permutes</span> <span class="main">{..&lt;</span><span class="skolem">n</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">σ</span>
    <span class="keyword1"><span class="command">using</span></span> that bij_convert <span class="keyword1"><span class="command">unfolding</span></span> bij_betw_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
    We also need a small lemma showing that our tuples are stable under permutation of the roots.
  ›</span></span>
  <span class="keyword1"><span class="command">have</span></span> bij_betw_compose_perm<span class="main">:</span> 
    <span class="quoted"><span class="quoted">"bij_betw <span class="main">(</span><span class="main">λ</span><span class="bound">f</span><span class="main">.</span> restrict <span class="main">(</span><span class="main">λ</span><span class="bound">g</span><span class="main">.</span> <span class="bound">f</span> <span class="main">(</span>restrict <span class="main">(</span><span class="skolem">π</span> <span class="main">∘</span> <span class="bound">g</span><span class="main">)</span> <span class="free">X</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">X</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="skolem">Roots</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">tuples</span> <span class="skolem">Y</span><span class="main">)</span> <span class="main">(</span><span class="skolem">tuples</span> <span class="skolem">Y</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> π<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">π</span> <span class="keyword1">permutes</span> <span class="skolem">Roots</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Y</span> <span class="main">∈</span> <span class="skolem">Roots_ms</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">π</span> <span class="skolem">Y</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> bij_betwI<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">f</span><span class="main">.</span> restrict <span class="main">(</span><span class="main">λ</span><span class="bound">g</span><span class="main">.</span> <span class="bound">f</span> <span class="main">(</span>restrict <span class="main">(</span><span class="skolem">π</span> <span class="main">∘</span> <span class="bound">g</span><span class="main">)</span> <span class="free">X</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">X</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="skolem">Roots</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">tuples</span> <span class="skolem">Y</span> <span class="main">→</span> <span class="skolem">tuples</span> <span class="skolem">Y</span>"</span></span>
      <span class="keyword2"><span class="keyword">if</span></span> π<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">π</span> <span class="keyword1">permutes</span> <span class="skolem">Roots</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">π</span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span> <span class="keyword3"><span class="command">assume</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> <span class="skolem">tuples</span> <span class="skolem">Y</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> f'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> <span class="main">(</span><span class="free">X</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="skolem">Roots</span><span class="main">)</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">X</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> tuples_def<span class="main">)</span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">f'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f'</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">g</span><span class="main">.</span> <span class="skolem">f</span> <span class="main">(</span>restrict <span class="main">(</span><span class="skolem">π</span> <span class="main">∘</span> <span class="bound">g</span><span class="main">)</span> <span class="free">X</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f'</span> <span class="main">∈</span> <span class="main">(</span><span class="free">X</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="skolem">Roots</span><span class="main">)</span> <span class="main">→</span> <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> f'_def
        <span class="keyword1"><span class="command">using</span></span> f' bij_betw_apply<span class="main">[</span><span class="operator">OF</span> bij_betw_compose_left_perm_PiE<span class="main"><span class="main">[</span></span><span class="operator">OF</span> π<span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="quoted"><span class="free">X</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"restrict <span class="skolem">f'</span> <span class="main">(</span><span class="free">X</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="skolem">Roots</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span><span class="free">X</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="skolem">Roots</span><span class="main">)</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">X</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"image_mset <span class="main">(</span>restrict <span class="skolem">f'</span> <span class="main">(</span><span class="free">X</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="skolem">Roots</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>mset_set <span class="main">(</span><span class="free">X</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="skolem">Roots</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">Y</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"image_mset <span class="main">(</span>restrict <span class="skolem">f'</span> <span class="main">(</span><span class="free">X</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="skolem">Roots</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>mset_set <span class="main">(</span><span class="free">X</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="skolem">Roots</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
              image_mset <span class="skolem">f'</span> <span class="main">(</span>mset_set <span class="main">(</span><span class="free">X</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="skolem">Roots</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> image_mset_cong<span class="main">)</span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> image_mset <span class="skolem">f</span> <span class="main">(</span>image_mset <span class="main">(</span><span class="main">λ</span><span class="bound">g</span><span class="main">.</span> restrict <span class="main">(</span><span class="skolem">π</span> <span class="main">∘</span> <span class="bound">g</span><span class="main">)</span> <span class="free">X</span><span class="main">)</span> <span class="main">(</span>mset_set <span class="main">(</span><span class="free">X</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="skolem">Roots</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> f'_def o_def multiset.map_comp <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> o_def<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"image_mset <span class="main">(</span><span class="main">λ</span><span class="bound">g</span><span class="main">.</span> restrict <span class="main">(</span><span class="skolem">π</span> <span class="main">∘</span> <span class="bound">g</span><span class="main">)</span> <span class="free">X</span><span class="main">)</span> <span class="main">(</span>mset_set <span class="main">(</span><span class="free">X</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="skolem">Roots</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
                   mset_set <span class="main">(</span><span class="free">X</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="skolem">Roots</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> bij_betw_image_mset_set bij_betw_compose_left_perm_PiE π<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"image_mset <span class="skolem">f</span> <span class="main">…</span> <span class="main">=</span> <span class="skolem">Y</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> f <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tuples_def<span class="main">)</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"restrict <span class="skolem">f'</span> <span class="main">(</span><span class="free">X</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="skolem">Roots</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">tuples</span> <span class="skolem">Y</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> tuples_def<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">f</span><span class="main">.</span> restrict <span class="main">(</span><span class="main">λ</span><span class="bound">g</span><span class="main">.</span> <span class="bound">f</span> <span class="main">(</span>restrict <span class="main">(</span><span class="skolem">π</span> <span class="main">∘</span> <span class="bound">g</span><span class="main">)</span> <span class="free">X</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">X</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="skolem">Roots</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">tuples</span> <span class="skolem">Y</span> <span class="main">→</span> <span class="skolem">tuples</span> <span class="skolem">Y</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> * π<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">f</span><span class="main">.</span> restrict <span class="main">(</span><span class="main">λ</span><span class="bound">g</span><span class="main">.</span> <span class="bound">f</span> <span class="main">(</span>restrict <span class="main">(</span>inv_into UNIV <span class="skolem">π</span> <span class="main">∘</span> <span class="bound">g</span><span class="main">)</span> <span class="free">X</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">X</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="skolem">Roots</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">tuples</span> <span class="skolem">Y</span> <span class="main">→</span> <span class="skolem">tuples</span> <span class="skolem">Y</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> * permutes_inv π<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">g</span><span class="main">∈</span><span class="free">X</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="skolem">Roots</span><span class="main">.</span> <span class="main">(</span><span class="main">λ</span><span class="bound">g</span><span class="main">∈</span><span class="free">X</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="skolem">Roots</span><span class="main">.</span> <span class="skolem">f</span> <span class="main">(</span>restrict <span class="main">(</span><span class="skolem">π</span> <span class="main">∘</span> <span class="bound">g</span><span class="main">)</span> <span class="free">X</span><span class="main">)</span><span class="main">)</span>
                <span class="main">(</span>restrict <span class="main">(</span>inv_into UNIV <span class="skolem">π</span> <span class="main">∘</span> <span class="bound">g</span><span class="main">)</span> <span class="free">X</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">f</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span> <span class="main">=</span> <span class="main">_</span>"</span></span><span class="main">)</span>
      <span class="keyword2"><span class="keyword">if</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> <span class="skolem">tuples</span> <span class="skolem">Y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> π<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">π</span> <span class="keyword1">permutes</span> <span class="skolem">Roots</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">f</span> <span class="skolem">π</span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">g</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span> <span class="skolem">g</span> <span class="main">=</span> <span class="skolem">f</span> <span class="skolem">g</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> <span class="free">X</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="skolem">Roots</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"restrict <span class="main">(</span><span class="skolem">π</span> <span class="main">∘</span> restrict <span class="main">(</span>inv_into UNIV <span class="skolem">π</span> <span class="main">∘</span> <span class="skolem">g</span><span class="main">)</span> <span class="free">X</span><span class="main">)</span> <span class="free">X</span> <span class="main">=</span> <span class="skolem">g</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> True
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> ext<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> permutes_inverses<span class="main"><span class="main">[</span></span><span class="operator">OF</span> π<span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> True
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> permutes_in_image<span class="main"><span class="main">[</span></span><span class="operator">OF</span> permutes_inv<span class="main"><span class="main"><span class="main">[</span></span></span><span class="operator">OF</span> π<span class="main"><span class="main"><span class="main">]</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> f <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="quoted">‹<span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main">:</span> tuples_def›</span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">g</span><span class="main">∈</span><span class="free">X</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="skolem">Roots</span><span class="main">.</span> <span class="main">(</span><span class="main">λ</span><span class="bound">g</span><span class="main">∈</span><span class="free">X</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="skolem">Roots</span><span class="main">.</span> <span class="skolem">f</span> <span class="main">(</span>restrict <span class="main">(</span><span class="skolem">π</span> <span class="main">∘</span> <span class="bound">g</span><span class="main">)</span> <span class="free">X</span><span class="main">)</span><span class="main">)</span>
                <span class="main">(</span>restrict <span class="main">(</span>inv_into UNIV <span class="skolem">π</span> <span class="main">∘</span> <span class="bound">g</span><span class="main">)</span> <span class="free">X</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">f</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> <span class="skolem">tuples</span> <span class="skolem">Y</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">f</span>
      <span class="keyword1"><span class="command">using</span></span> *<span class="main">[</span><span class="operator">OF</span> that π<span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">g</span><span class="main">∈</span><span class="free">X</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="skolem">Roots</span><span class="main">.</span> <span class="main">(</span><span class="main">λ</span><span class="bound">g</span><span class="main">∈</span><span class="free">X</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="skolem">Roots</span><span class="main">.</span> <span class="skolem">f</span> <span class="main">(</span>restrict <span class="main">(</span>inv_into UNIV <span class="skolem">π</span> <span class="main">∘</span> <span class="bound">g</span><span class="main">)</span> <span class="free">X</span><span class="main">)</span><span class="main">)</span>
                <span class="main">(</span>restrict <span class="main">(</span><span class="skolem">π</span> <span class="main">∘</span> <span class="bound">g</span><span class="main">)</span> <span class="free">X</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">f</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> <span class="skolem">tuples</span> <span class="skolem">Y</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">f</span>
      <span class="keyword1"><span class="command">using</span></span> *<span class="main">[</span><span class="operator">OF</span> that permutes_inv<span class="main"><span class="main">[</span></span><span class="operator">OF</span> π<span class="main"><span class="main">]</span></span><span class="main">]</span> permutes_inv_inv<span class="main">[</span><span class="operator">OF</span> π<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
    We show that the coefficients in the expanded new sum are rational -- again using the 
    fundamental theorem of symmetric polynomials.
  ›</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">β'</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"complex multiset <span class="main">⇒</span> complex"</span></span>
    <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">β'</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">Y</span><span class="main">.</span> <span class="main">∑</span><span class="bound">f</span><span class="main">∈</span><span class="skolem">tuples</span> <span class="bound">Y</span><span class="main">.</span> <span class="main">∏</span><span class="bound">g</span><span class="main">∈</span><span class="free">X</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="skolem">Roots</span><span class="main">.</span> <span class="bound">g</span> <span class="main">(</span><span class="bound">f</span> <span class="bound">g</span><span class="main">)</span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">β'</span> <span class="skolem">Y</span> <span class="main">∈</span> <span class="main">ℚ</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> Y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Y</span> <span class="main">∈</span> <span class="skolem">Roots_ms</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">Y</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">Q</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"complex mpoly"</span></span>
      <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Q</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">f</span><span class="main">∈</span><span class="skolem">tuples</span> <span class="skolem">Y</span><span class="main">.</span> <span class="main">∏</span><span class="bound">g</span><span class="main">∈</span><span class="free">X</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="skolem">Roots</span><span class="main">.</span> Var <span class="main">(</span><span class="skolem">unRoot</span> <span class="main">(</span><span class="bound">g</span> <span class="main">(</span><span class="bound">f</span> <span class="bound">g</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"insertion <span class="skolem">Root</span> <span class="skolem">Q</span> <span class="main">∈</span> <span class="main">ℚ</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> symmetric_poly_of_roots_in_subring<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"ring_closed <span class="main">(</span><span class="main">ℚ</span> <span class="main">::</span> complex set<span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">standard</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">interpret</span></span> ring_closed <span class="quoted"><span class="quoted">"<span class="main">ℚ</span> <span class="main">::</span> complex set"</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">m</span><span class="main">.</span> coeff <span class="skolem">Q</span> <span class="bound">m</span> <span class="main">∈</span> <span class="main">ℚ</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Q_def coeff_Var when_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> sum_in_Rats coeff_prod_closed<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"symmetric_mpoly <span class="main">{..&lt;</span><span class="skolem">n</span><span class="main">}</span> <span class="skolem">Q</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> symmetric_mpoly_def
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">π</span> <span class="keyword3"><span class="command">assume</span></span> π<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">π</span> <span class="keyword1">permutes</span> <span class="main">{..&lt;</span><span class="skolem">n</span><span class="main">}</span>"</span></span>
        <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">π'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">π'</span> <span class="main">=</span> <span class="skolem">convert_perm</span> <span class="main">(</span>inv_into UNIV <span class="skolem">π</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> π'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">π'</span> <span class="keyword1">permutes</span> <span class="skolem">Roots</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> π'_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> permutes_convert_perm permutes_inv π<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"mpoly_map_vars <span class="skolem">π</span> <span class="skolem">Q</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">f</span><span class="main">∈</span><span class="skolem">tuples</span> <span class="skolem">Y</span><span class="main">.</span> <span class="main">∏</span><span class="bound">g</span><span class="main">∈</span><span class="free">X</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="skolem">Roots</span><span class="main">.</span> Var <span class="main">(</span><span class="skolem">π</span> <span class="main">(</span><span class="skolem">unRoot</span> <span class="main">(</span><span class="bound">g</span> <span class="main">(</span><span class="bound">f</span> <span class="bound">g</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> Q_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> permutes_bij<span class="main"><span class="main">[</span></span><span class="operator">OF</span> π<span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">f</span><span class="main">∈</span><span class="skolem">tuples</span> <span class="skolem">Y</span><span class="main">.</span> <span class="main">∏</span><span class="bound">g</span><span class="main">∈</span><span class="free">X</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="skolem">Roots</span><span class="main">.</span> Var <span class="main">(</span><span class="skolem">unRoot</span> <span class="main">(</span><span class="bound">g</span> <span class="main">(</span><span class="bound">f</span> <span class="main">(</span>restrict <span class="main">(</span><span class="skolem">π'</span> <span class="main">∘</span> <span class="bound">g</span><span class="main">)</span> <span class="free">X</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sum.cong<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">f</span><span class="main">)</span>
          <span class="keyword1"><span class="command">have</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> <span class="main">(</span><span class="free">X</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="skolem">Roots</span><span class="main">)</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">X</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> 2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> tuples_def<span class="main">)</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∏</span><span class="bound">g</span><span class="main">∈</span><span class="free">X</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="skolem">Roots</span><span class="main">.</span> Var <span class="main">(</span><span class="skolem">π</span> <span class="main">(</span><span class="skolem">unRoot</span> <span class="main">(</span><span class="bound">g</span> <span class="main">(</span><span class="skolem">f</span> <span class="bound">g</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
                <span class="main">(</span><span class="main">∏</span><span class="bound">g</span><span class="main">∈</span><span class="free">X</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="skolem">Roots</span><span class="main">.</span> Var <span class="main">(</span><span class="skolem">π</span> <span class="main">(</span><span class="skolem">unRoot</span> <span class="main">(</span>restrict <span class="main">(</span><span class="skolem">π'</span> <span class="main">∘</span> <span class="bound">g</span><span class="main">)</span> <span class="free">X</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">(</span>restrict <span class="main">(</span><span class="skolem">π'</span> <span class="main">∘</span> <span class="bound">g</span><span class="main">)</span> <span class="free">X</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> π' <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> prod.reindex_bij_betw <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> bij_betw_compose_left_perm_PiE<span class="main">)</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">g</span><span class="main">∈</span><span class="free">X</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="skolem">Roots</span><span class="main">.</span> Var <span class="main">(</span><span class="skolem">unRoot</span> <span class="main">(</span><span class="bound">g</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">(</span>restrict <span class="main">(</span><span class="skolem">π'</span> <span class="main">∘</span> <span class="bound">g</span><span class="main">)</span> <span class="free">X</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> prod.cong refl arg_cong<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">Var</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
            <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">g</span> <span class="keyword3"><span class="command">assume</span></span> g<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> <span class="free">X</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="skolem">Roots</span>"</span></span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"restrict <span class="main">(</span><span class="skolem">π'</span> <span class="main">∘</span> <span class="skolem">g</span><span class="main">)</span> <span class="free">X</span> <span class="main">∈</span> <span class="free">X</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="skolem">Roots</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> bij_betw_compose_left_perm_PiE<span class="main">[</span><span class="operator">OF</span> π'<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">X</span></span><span class="main">]</span> g <span class="keyword1"><span class="command">unfolding</span></span> bij_betw_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command">hence</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">(</span>restrict <span class="main">(</span><span class="skolem">π'</span> <span class="main">∘</span> <span class="skolem">g</span><span class="main">)</span> <span class="free">X</span><span class="main">)</span> <span class="main">∈</span> <span class="free">X</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> PiE_mem<span class="main"><span class="main">[</span></span><span class="operator">OF</span> f<span class="main"><span class="main">]</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command">hence</span></span> **<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">(</span>restrict <span class="main">(</span><span class="skolem">π'</span> <span class="main">∘</span> <span class="skolem">g</span><span class="main">)</span> <span class="free">X</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">Roots</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> PiE_mem<span class="main"><span class="main">[</span></span><span class="operator">OF</span> g<span class="main"><span class="main">]</span></span><span class="main">)</span>

            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">unRoot</span> <span class="main">(</span>restrict <span class="main">(</span><span class="skolem">π'</span> <span class="main">∘</span> <span class="skolem">g</span><span class="main">)</span> <span class="free">X</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">(</span>restrict <span class="main">(</span><span class="skolem">π'</span> <span class="main">∘</span> <span class="skolem">g</span><span class="main">)</span> <span class="free">X</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
                   <span class="skolem">unRoot</span> <span class="main">(</span><span class="skolem">Root</span> <span class="main">(</span>inv_into UNIV <span class="skolem">π</span> <span class="main">(</span><span class="skolem">unRoot</span> <span class="main">(</span><span class="skolem">g</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">(</span>restrict <span class="main">(</span><span class="skolem">π'</span> <span class="main">∘</span> <span class="skolem">g</span><span class="main">)</span> <span class="free">X</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> * ** <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> π'_def<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> convert_perm_def<span class="main">)</span>
            <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inv_into UNIV <span class="skolem">π</span> <span class="main">(</span><span class="skolem">unRoot</span> <span class="main">(</span><span class="skolem">g</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">(</span>restrict <span class="main">(</span><span class="skolem">π'</span> <span class="main">∘</span> <span class="skolem">g</span><span class="main">)</span> <span class="free">X</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="main">{..&lt;</span><span class="skolem">n</span><span class="main">}</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> ** <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> permutes_in_image<span class="main"><span class="main">[</span></span><span class="operator">OF</span> permutes_inv<span class="main"><span class="main">[</span></span><span class="operator">OF</span> π<span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">unRoot</span> <span class="main">(</span><span class="skolem">Root</span> <span class="main">(</span>inv_into UNIV <span class="skolem">π</span> <span class="main">(</span><span class="skolem">unRoot</span> <span class="main">(</span><span class="skolem">g</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">(</span>restrict <span class="main">(</span><span class="skolem">π'</span> <span class="main">∘</span> <span class="skolem">g</span><span class="main">)</span> <span class="free">X</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
                   inv_into UNIV <span class="skolem">π</span> <span class="main">(</span><span class="skolem">unRoot</span> <span class="main">(</span><span class="skolem">g</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">(</span>restrict <span class="main">(</span><span class="skolem">π'</span> <span class="main">∘</span> <span class="skolem">g</span><span class="main">)</span> <span class="free">X</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> unRoot_Root<span class="main">)</span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">π</span> <span class="main">…</span> <span class="main">=</span> <span class="skolem">unRoot</span> <span class="main">(</span><span class="skolem">g</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">(</span>restrict <span class="main">(</span><span class="skolem">π'</span> <span class="main">∘</span> <span class="skolem">g</span><span class="main">)</span> <span class="free">X</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> permutes_inverses<span class="main"><span class="main">[</span></span><span class="operator">OF</span> π<span class="main"><span class="main">]</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">π</span> <span class="main">(</span><span class="skolem">unRoot</span> <span class="main">(</span>restrict <span class="main">(</span><span class="skolem">π'</span> <span class="main">∘</span> <span class="skolem">g</span><span class="main">)</span> <span class="free">X</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">(</span>restrict <span class="main">(</span><span class="skolem">π'</span> <span class="main">∘</span> <span class="skolem">g</span><span class="main">)</span> <span class="free">X</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
                          <span class="skolem">unRoot</span> <span class="main">(</span><span class="skolem">g</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">(</span>restrict <span class="main">(</span><span class="skolem">π'</span> <span class="main">∘</span> <span class="skolem">g</span><span class="main">)</span> <span class="free">X</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">.</span></span>
        <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp_all</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="skolem">tuples</span> <span class="skolem">Y</span><span class="main">.</span> <span class="main">∏</span><span class="bound">g</span><span class="main">∈</span><span class="free">X</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="skolem">Roots</span><span class="main">.</span> Var <span class="main">(</span><span class="skolem">unRoot</span> <span class="main">(</span><span class="bound">g</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">g</span><span class="main">∈</span><span class="free">X</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="skolem">Roots</span><span class="main">.</span> <span class="bound">x</span> <span class="main">(</span>restrict <span class="main">(</span><span class="skolem">π'</span> <span class="main">∘</span> <span class="bound">g</span><span class="main">)</span> <span class="free">X</span><span class="main">)</span><span class="main">)</span> <span class="bound">g</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.cong prod.cong refl<span class="main">)</span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">Q</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> Q_def
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.reindex_bij_betw<span class="main"><span class="main">[</span></span><span class="operator">OF</span> bij_betw_compose_perm<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">use</span> π' Y <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">simp_all</span><span class="main">)</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"mpoly_map_vars <span class="skolem">π</span> <span class="skolem">Q</span> <span class="main">=</span> <span class="skolem">Q</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"vars <span class="skolem">Q</span> <span class="main">⊆</span> <span class="main">{..&lt;</span><span class="skolem">n</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> Q_def
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> order.trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> vars_sum<span class="main"><span class="main">]</span></span> UN_least order.trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> vars_prod<span class="main"><span class="main">]</span></span><span class="main">)</span>
           <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> vars_Var tuples_def<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">lc</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">lc</span> <span class="main">=</span> Polynomial.lead_coeff <span class="skolem">P</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">lc</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> lc_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"inverse <span class="main">(</span>of_int <span class="skolem">lc</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>of_int <span class="skolem">lc</span> <span class="main">::</span> complex<span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"inverse <span class="main">(</span>of_int <span class="skolem">lc</span><span class="main">)</span> <span class="main">∈</span> <span class="main">ℚ</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rsquarefree <span class="main">(</span>of_int_poly <span class="skolem">P</span> <span class="main">::</span> complex poly<span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹squarefree <span class="main">(</span>of_int_poly <span class="skolem">P</span> <span class="main">::</span> complex poly<span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> squarefree_imp_rsquarefree<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"of_int_poly <span class="skolem">P</span> <span class="main">=</span> Polynomial.smult <span class="main">(</span>of_int <span class="skolem">lc</span><span class="main">)</span> <span class="main">(</span><span class="main">∏</span><span class="bound">x</span><span class="main">∈</span><span class="skolem">Roots</span><span class="main">.</span> <span class="main">[:</span><span class="main">-</span><span class="bound">x</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> lc_def of_int_hom.hom_lead_coeff<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> Roots_def
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> complex_poly_decompose_rsquarefree <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∏</span><span class="bound">x</span><span class="main">∈</span><span class="skolem">Roots</span><span class="main">.</span> <span class="main">[:</span><span class="main">-</span><span class="bound">x</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">i</span><span class="main">&lt;</span><span class="skolem">n</span><span class="main">.</span> <span class="main">[:</span><span class="main">-</span><span class="skolem">Root</span> <span class="bound">i</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> prod.reindex_bij_betw<span class="main"><span class="main">[</span></span><span class="operator">OF</span> Root<span class="main"><span class="main">,</span></span> <span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"of_int_poly <span class="skolem">P</span> <span class="main">=</span> Polynomial.smult <span class="main">(</span>of_int <span class="skolem">lc</span><span class="main">)</span> <span class="main">(</span><span class="main">∏</span><span class="bound">i</span><span class="main">&lt;</span><span class="skolem">n</span><span class="main">.</span> <span class="main">[:</span><span class="main">-</span> <span class="skolem">Root</span> <span class="bound">i</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"insertion <span class="skolem">Root</span> <span class="skolem">Q</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">f</span><span class="main">∈</span><span class="skolem">tuples</span> <span class="skolem">Y</span><span class="main">.</span> <span class="main">∏</span><span class="bound">g</span><span class="main">∈</span><span class="free">X</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="skolem">Roots</span><span class="main">.</span> <span class="skolem">Root</span> <span class="main">(</span><span class="skolem">unRoot</span> <span class="main">(</span><span class="bound">g</span> <span class="main">(</span><span class="bound">f</span> <span class="bound">g</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Q_def insertion_sum insertion_prod<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">β'</span> <span class="skolem">Y</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> β'_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.cong prod.cong refl Root_unRoot<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> tuples_def<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">Y</span><span class="main">∈</span><span class="skolem">Roots_ms</span><span class="main">.</span> <span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">β'</span> <span class="bound">Y</span> <span class="main">=</span> of_rat <span class="bound">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> Rats_cases<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">β''</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"complex multiset <span class="main">⇒</span> rat"</span></span>
    <span class="keyword2"><span class="keyword">where</span></span> β''<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">Y</span><span class="main">.</span> <span class="bound">Y</span> <span class="main">∈</span> <span class="skolem">Roots_ms</span> <span class="main">⟹</span> <span class="skolem">β'</span> <span class="bound">Y</span> <span class="main">=</span> of_rat <span class="main">(</span><span class="skolem">β''</span> <span class="bound">Y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

  <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
    We again collect all the terms that happen to have equal exponents and call their
    coefficients <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>β''›</span></span></span></span>:
  ›</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">β'''</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"complex <span class="main">⇒</span> rat"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">β'''</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">α</span><span class="main">.</span> <span class="main">∑</span><span class="bound">Y</span><span class="main">∈</span><span class="skolem">Roots_ms</span><span class="main">.</span> <span class="main">(</span><span class="skolem">β''</span> <span class="bound">Y</span> <span class="keyword1">when</span> <span class="main">∑<span class="hidden">⇩</span><sub>#</sub></span><span class="bound">Y</span> <span class="main">=</span> <span class="bound">α</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> supp_β'''<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">β'''</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span><span class="main">}</span> <span class="main">⊆</span> sum_mset <span class="main">`</span> <span class="skolem">Roots_ms</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> β'''_def when_def <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> sum.not_neutral_contains_not_neutral <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>

  <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
    We again start with the sum that we now to be zero and multiply it with all the sums that can
    be obtained with different choices for the roots.
  ›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="free">X</span><span class="main">.</span> <span class="free">β</span> <span class="bound">x</span> <span class="main">*</span> exp <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> sum0 <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="free">X</span><span class="main">.</span> restrict <span class="free">β</span> <span class="free">X</span> <span class="bound">x</span> <span class="main">*</span> exp <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.cong<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="keyword1">dvd</span> <span class="main">(</span><span class="main">∏</span><span class="bound">f</span> <span class="main">∈</span> <span class="free">X</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="skolem">Roots</span><span class="main">.</span> <span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="free">X</span><span class="main">.</span> <span class="bound">f</span> <span class="bound">x</span> <span class="main">*</span> exp <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> dvd_prodI<span class="main">)</span> <span class="main">(</span><span class="operator">use</span> <span class="quoted"><span class="quoted">‹<span class="free">β</span> <span class="main">`</span> <span class="free">X</span> <span class="main">⊆</span> <span class="skolem">Roots</span>›</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="quoted">‹<span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main">:</span> id_def›</span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">f</span><span class="main">∈</span><span class="main">(</span><span class="free">X</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="skolem">Roots</span><span class="main">)</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">X</span><span class="main">.</span> <span class="main">∏</span><span class="bound">g</span><span class="main">∈</span><span class="free">X</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="skolem">Roots</span><span class="main">.</span> <span class="bound">g</span> <span class="main">(</span><span class="bound">f</span> <span class="bound">g</span><span class="main">)</span> <span class="main">*</span> exp <span class="main">(</span><span class="bound">f</span> <span class="bound">g</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> prod_sum_PiE<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">f</span><span class="main">∈</span><span class="main">(</span><span class="free">X</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="skolem">Roots</span><span class="main">)</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">X</span><span class="main">.</span> <span class="main">(</span><span class="main">∏</span><span class="bound">g</span><span class="main">∈</span><span class="free">X</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="skolem">Roots</span><span class="main">.</span> <span class="bound">g</span> <span class="main">(</span><span class="bound">f</span> <span class="bound">g</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> exp <span class="main">(</span><span class="main">∑</span><span class="bound">g</span><span class="main">∈</span><span class="free">X</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="skolem">Roots</span><span class="main">.</span> <span class="bound">f</span> <span class="bound">g</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prod.distrib exp_sum<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">Y</span><span class="main">,</span><span class="bound">f</span><span class="main">)</span><span class="main">∈</span>Sigma <span class="skolem">Roots_ms</span> <span class="skolem">tuples</span><span class="main">.</span>
                    <span class="main">(</span><span class="main">∏</span><span class="bound">g</span><span class="main">∈</span><span class="free">X</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="skolem">Roots</span><span class="main">.</span> <span class="bound">g</span> <span class="main">(</span><span class="bound">f</span> <span class="bound">g</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> exp <span class="main">(</span><span class="main">∑</span><span class="bound">g</span><span class="main">∈</span><span class="free">X</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="skolem">Roots</span><span class="main">.</span> <span class="bound">f</span> <span class="bound">g</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.reindex_bij_witness<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">snd</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">λ</span></span></span><span class="bound"><span class="bound"><span class="bound">f</span></span></span><span class="main"><span class="main"><span class="main">.</span></span></span> <span class="main"><span class="main"><span class="main">(</span></span></span>image_mset <span class="bound"><span class="bound"><span class="bound">f</span></span></span> <span class="main"><span class="main"><span class="main">(</span></span></span>mset_set <span class="main"><span class="main"><span class="main">(</span></span></span><span class="free"><span class="free"><span class="free">X</span></span></span> <span class="keyword1"><span class="keyword1"><span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span></span></span> <span class="skolem"><span class="skolem"><span class="skolem">Roots</span></span></span><span class="main"><span class="main"><span class="main">)</span></span></span><span class="main"><span class="main"><span class="main">)</span></span></span><span class="main"><span class="main"><span class="main">,</span></span></span> <span class="bound"><span class="bound"><span class="bound">f</span></span></span><span class="main"><span class="main"><span class="main">)</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
       <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Roots_ms_def tuples_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">Y</span><span class="main">,</span><span class="bound">f</span><span class="main">)</span><span class="main">∈</span>Sigma <span class="skolem">Roots_ms</span> <span class="skolem">tuples</span><span class="main">.</span> <span class="main">(</span><span class="main">∏</span><span class="bound">g</span><span class="main">∈</span><span class="free">X</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="skolem">Roots</span><span class="main">.</span> <span class="bound">g</span> <span class="main">(</span><span class="bound">f</span> <span class="bound">g</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> exp <span class="main">(</span><span class="main">∑<span class="hidden">⇩</span><sub>#</sub></span><span class="bound">Y</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.cong<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> tuples_def sum_unfold_sum_mset<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">Y</span><span class="main">∈</span><span class="skolem">Roots_ms</span><span class="main">.</span> <span class="skolem">β'</span> <span class="bound">Y</span> <span class="main">*</span> exp <span class="main">(</span><span class="main">∑<span class="hidden">⇩</span><sub>#</sub></span><span class="bound">Y</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> β'_def sum_distrib_right <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.Sigma <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">Y</span><span class="main">∈</span><span class="skolem">Roots_ms</span><span class="main">.</span> of_rat <span class="main">(</span><span class="skolem">β''</span> <span class="bound">Y</span><span class="main">)</span> <span class="main">*</span> exp <span class="main">(</span><span class="main">∑<span class="hidden">⇩</span><sub>#</sub></span><span class="bound">Y</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.cong<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> β''<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">Y</span><span class="main">∈</span><span class="skolem">Roots_ms</span><span class="main">.</span> Sum_any <span class="main">(</span><span class="main">λ</span><span class="bound">α</span><span class="main">.</span> of_rat <span class="main">(</span><span class="skolem">β''</span> <span class="bound">Y</span> <span class="keyword1">when</span> <span class="main">∑<span class="hidden">⇩</span><sub>#</sub></span> <span class="bound">Y</span> <span class="main">=</span> <span class="bound">α</span><span class="main">)</span> <span class="main">*</span> exp <span class="bound">α</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sum.cong<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">Y</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Sum_any <span class="main">(</span><span class="main">λ</span><span class="bound">α</span><span class="main">.</span> of_rat <span class="main">(</span><span class="skolem">β''</span> <span class="skolem">Y</span> <span class="keyword1">when</span> <span class="main">∑<span class="hidden">⇩</span><sub>#</sub></span> <span class="skolem">Y</span> <span class="main">=</span> <span class="bound">α</span><span class="main">)</span> <span class="main">*</span> exp <span class="bound">α</span><span class="main">)</span> <span class="main">=</span>
          <span class="main">(</span><span class="main">∑</span><span class="bound">α</span><span class="main">∈</span><span class="main">{</span><span class="main">∑<span class="hidden">⇩</span><sub>#</sub></span> <span class="skolem">Y</span><span class="main">}</span><span class="main">.</span> of_rat <span class="main">(</span><span class="skolem">β''</span> <span class="skolem">Y</span> <span class="keyword1">when</span> <span class="main">∑<span class="hidden">⇩</span><sub>#</sub></span> <span class="skolem">Y</span> <span class="main">=</span> <span class="bound">α</span><span class="main">)</span> <span class="main">*</span> exp <span class="bound">α</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> Sum_any.expand_superset<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> Sum_any <span class="main">(</span><span class="main">λ</span><span class="bound">α</span><span class="main">.</span> of_rat <span class="main">(</span><span class="skolem">β'''</span> <span class="bound">α</span><span class="main">)</span> <span class="main">*</span> exp <span class="bound">α</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> β'''_def of_rat_sum sum_distrib_right <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> Sum_any_sum_swap<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">α</span></span> <span class="main">|</span> <span class="skolem">β'''</span> <span class="bound">α</span> <span class="main">≠</span> <span class="main">0</span><span class="main">.</span> of_rat <span class="main">(</span><span class="skolem">β'''</span> <span class="bound">α</span><span class="main">)</span> <span class="main">*</span> exp <span class="bound">α</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> Sum_any.expand_superset finite_subset<span class="main"><span class="main">[</span></span><span class="operator">OF</span> supp_β'''<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">α</span></span> <span class="main">|</span> <span class="skolem">β'''</span> <span class="bound">α</span> <span class="main">≠</span> <span class="main">0</span><span class="main">.</span> of_rat <span class="main">(</span><span class="skolem">β'''</span> <span class="bound">α</span><span class="main">)</span> <span class="main">*</span> exp <span class="bound">α</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
    We are now in the situation of our previous version of the theorem and can apply it to find
    that all the coefficients are zero.
  ›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">α</span><span class="main">.</span> <span class="skolem">β'''</span> <span class="bound">α</span> <span class="main">≠</span> <span class="main">0</span><span class="main">}</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Hermite_Lindemann_aux3<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound">α</span><span class="main">.</span> <span class="skolem">β'''</span> <span class="bound">α</span> <span class="main">≠</span> <span class="main">0</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> finite_subset<span class="main"><span class="main">[</span></span><span class="operator">OF</span> supp_β'''<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">α</span></span> <span class="main">|</span> <span class="skolem">β'''</span> <span class="bound">α</span> <span class="main">≠</span> <span class="main">0</span><span class="main">.</span> of_rat <span class="main">(</span><span class="skolem">β'''</span> <span class="bound">α</span><span class="main">)</span> <span class="main">*</span> exp <span class="bound">α</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">α</span> <span class="keyword3"><span class="command">assume</span></span> α<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">α</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">α</span><span class="main">.</span> <span class="skolem">β'''</span> <span class="bound">α</span> <span class="main">≠</span> <span class="main">0</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Y</span></span> <span class="keyword2"><span class="keyword">where</span></span> Y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Y</span> <span class="main">∈</span> <span class="skolem">Roots_ms</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">α</span> <span class="main">=</span> sum_mset <span class="skolem">Y</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> supp_β''' <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"algebraic <span class="skolem">α</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> alg1
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Roots_ms_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
    However, similarly to before, we can show that the coefficient corresponding to the
    term with the lexicographically greatest exponent (which is obtained by picking the
    term with the lexicographically greatest term in each of the factors of our big product)
    is non-zero.
  ›</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">α</span><span class="main">.</span> <span class="skolem">β'''</span> <span class="bound">α</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">α_max</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">α_max</span> <span class="main">=</span> complex_lex.Max <span class="free">X</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">α_max</span> <span class="main">∈</span> <span class="free">X</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> α_max_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">X</span> <span class="main">≠</span> <span class="main">{}</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> complex_lex.Max_in<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">Y_max</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"complex multiset"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Y_max</span> <span class="main">=</span> replicate_mset <span class="main">(</span><span class="skolem">n</span> <span class="main">^</span> <span class="skolem">m</span><span class="main">)</span> <span class="skolem">α_max</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">f_max</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f_max</span> <span class="main">=</span> restrict <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="skolem">α_max</span><span class="main">)</span> <span class="main">(</span><span class="free">X</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="skolem">Roots</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Y_max</span> <span class="main">∈</span> <span class="skolem">Roots_ms</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Y_max_def Roots_ms_def<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">tuples</span> <span class="skolem">Y_max</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">f_max</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"image_mset <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">∈</span><span class="free">X</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="skolem">Roots</span><span class="main">.</span> <span class="skolem">α_max</span><span class="main">)</span> <span class="main">(</span>mset_set <span class="main">(</span><span class="free">X</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="skolem">Roots</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
            image_mset <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="skolem">α_max</span><span class="main">)</span> <span class="main">(</span>mset_set <span class="main">(</span><span class="free">X</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="skolem">Roots</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> image_mset_cong<span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f_max</span> <span class="main">∈</span> <span class="skolem">tuples</span> <span class="skolem">Y_max</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> f_max_def tuples_def Y_max_def image_mset_const_eq<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> <span class="skolem">tuples</span> <span class="skolem">Y_max</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> <span class="main">(</span><span class="free">X</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="skolem">Roots</span><span class="main">)</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">X</span>"</span></span> <span class="quoted"><span class="quoted">"image_mset <span class="skolem">f</span> <span class="main">(</span>mset_set <span class="main">(</span><span class="free">X</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="skolem">Roots</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">Y_max</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> tuples_def<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">g</span> <span class="main">∈#</span> mset_set <span class="main">(</span><span class="free">X</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="skolem">Roots</span><span class="main">)</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">g</span> <span class="main">=</span> <span class="skolem">α_max</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> image_mset_eq_replicate_msetD<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> n <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem"><span class="skolem">n</span></span></span> <span class="main"><span class="main"><span class="main">^</span></span></span> <span class="skolem"><span class="skolem"><span class="skolem">m</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Y_max_def<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">=</span> <span class="skolem">f_max</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> f <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Y_max_def fun_eq_iff f_max_def<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">β'''</span> <span class="main">(</span>of_nat <span class="main">(</span><span class="skolem">n</span> <span class="main">^</span> <span class="skolem">m</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">α_max</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">Y</span><span class="main">∈</span><span class="skolem">Roots_ms</span><span class="main">.</span> <span class="skolem">β''</span> <span class="bound">Y</span> <span class="keyword1">when</span> <span class="main">∑<span class="hidden">⇩</span><sub>#</sub></span> <span class="bound">Y</span> <span class="main">=</span> of_nat <span class="main">(</span><span class="skolem">n</span> <span class="main">^</span> <span class="skolem">m</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">α_max</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> β'''_def Roots_ms_def <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∑<span class="hidden">⇩</span><sub>#</sub></span> <span class="skolem">Y</span> <span class="main">≠</span> of_nat <span class="skolem">n</span> <span class="main">^</span> <span class="skolem">m</span> <span class="main">*</span> <span class="skolem">α_max</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Y</span> <span class="main">∈</span> <span class="skolem">Roots_ms</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Y</span> <span class="main">≠</span> <span class="skolem">Y_max</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">Y</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>set_mset <span class="skolem">Y</span> <span class="main">⊆</span> <span class="main">{</span><span class="skolem">α_max</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> set_mset_subset_singletonD<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">Y</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">α_max</span>"</span></span><span class="main">]</span> that
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Roots_ms_def Y_max_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈#</span> <span class="skolem">Y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">≠</span> <span class="skolem">α_max</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="free">X</span>"</span></span> <span class="quoted"><span class="quoted">"set_mset <span class="main">(</span><span class="skolem">Y</span> <span class="main">-</span> <span class="main">{#</span><span class="skolem">y</span><span class="main">#}</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">X</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> y that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Roots_ms_def <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> in_diffD<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">≤<span class="hidden">⇩</span><sub>ℂ</sub></span> <span class="skolem">α_max</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> y <span class="keyword1"><span class="command">unfolding</span></span> α_max_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> complex_lex.Max_ge<span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> y <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">&lt;<span class="hidden">⇩</span><sub>ℂ</sub></span> <span class="skolem">α_max</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Y</span> <span class="main">=</span> <span class="main">{#</span><span class="skolem">y</span><span class="main">#}</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">Y</span> <span class="main">-</span> <span class="main">{#</span><span class="skolem">y</span><span class="main">#}</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> y <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum_mset <span class="skolem">Y</span> <span class="main">=</span> <span class="skolem">y</span> <span class="main">+</span> sum_mset <span class="main">(</span><span class="skolem">Y</span> <span class="main">-</span> <span class="main">{#</span><span class="skolem">y</span><span class="main">#}</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> *<span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">&lt;<span class="hidden">⇩</span><sub>ℂ</sub></span> <span class="skolem">α_max</span> <span class="main">+</span> sum_mset <span class="main">(</span><span class="skolem">Y</span> <span class="main">-</span> <span class="main">{#</span><span class="skolem">y</span><span class="main">#}</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> complex_lex.add_strict_right_mono<span class="main">)</span> <span class="operator">fact</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤<span class="hidden">⇩</span><sub>ℂ</sub></span> <span class="skolem">α_max</span> <span class="main">+</span> sum_mset <span class="main">(</span>replicate_mset <span class="main">(</span><span class="skolem">n</span> <span class="main">^</span> <span class="skolem">m</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="skolem">α_max</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> α_max_def <span class="keyword1"><span class="command">using</span></span> that y <span class="quoted"><span class="quoted">‹set_mset <span class="main">(</span><span class="skolem">Y</span> <span class="main">-</span> <span class="main">{#</span><span class="skolem">y</span><span class="main">#}</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">X</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> complex_lex.add_left_mono sum_mset_mono_complex_lex
                  rel_mset_replicate_mset_right complex_lex.Max_ge<span class="main">)</span>
           <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Roots_ms_def size_Diff_singleton<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> of_nat <span class="main">(</span>Suc <span class="main">(</span><span class="skolem">n</span> <span class="main">^</span> <span class="skolem">m</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">α_max</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span><span class="skolem">n</span> <span class="main">^</span> <span class="skolem">m</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">n</span> <span class="main">^</span> <span class="skolem">m</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">Y</span><span class="main">∈</span><span class="skolem">Roots_ms</span><span class="main">.</span> <span class="skolem">β''</span> <span class="bound">Y</span> <span class="keyword1">when</span> <span class="main">∑<span class="hidden">⇩</span><sub>#</sub></span> <span class="bound">Y</span> <span class="main">=</span> of_nat <span class="main">(</span><span class="skolem">n</span> <span class="main">^</span> <span class="skolem">m</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">α_max</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">Y</span><span class="main">∈</span><span class="main">{</span><span class="skolem">Y_max</span><span class="main">}</span><span class="main">.</span> <span class="skolem">β''</span> <span class="bound">Y</span> <span class="keyword1">when</span> <span class="main">∑<span class="hidden">⇩</span><sub>#</sub></span> <span class="bound">Y</span> <span class="main">=</span> of_nat <span class="main">(</span><span class="skolem">n</span> <span class="main">^</span> <span class="skolem">m</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">α_max</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.mono_neutral_right ballI<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">β''</span> <span class="skolem">Y_max</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> when_def Y_max_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"of_rat <span class="main">…</span> <span class="main">=</span> <span class="skolem">β'</span> <span class="skolem">Y_max</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> β''<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">Y_max</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">g</span><span class="main">∈</span><span class="free">X</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="skolem">Roots</span><span class="main">.</span> <span class="bound">g</span> <span class="main">(</span><span class="skolem">f_max</span> <span class="bound">g</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> β'_def <span class="quoted"><span class="quoted">‹<span class="skolem">tuples</span> <span class="skolem">Y_max</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">f_max</span><span class="main">}</span>›</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">g</span><span class="main">∈</span><span class="free">X</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="skolem">Roots</span><span class="main">.</span> <span class="bound">g</span> <span class="skolem">α_max</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> prod.cong<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> f_max_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">∉</span> <span class="skolem">Roots</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">α_max</span> <span class="main">∈</span> <span class="free">X</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> prod_nonzeroI<span class="main">)</span> <span class="main">(</span><span class="operator">metis</span> PiE_mem<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹The final theorem›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  We now additionally allow some of the $\beta_i$ to be zero:
›</span></span>
<span class="keyword1" id="Hermite_Lindemann-Hermite_Lindemann'"><span class="command">lemma</span></span> Hermite_Lindemann'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">β</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"complex <span class="main">⇒</span> complex"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">X</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">⟹</span> algebraic <span class="bound">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">⟹</span> algebraic <span class="main">(</span><span class="free">β</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="free">X</span><span class="main">.</span> <span class="free">β</span> <span class="bound">x</span> <span class="main">*</span> exp <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">X</span><span class="main">.</span> <span class="free">β</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound"><span class="bound">x</span></span><span class="main">∈</span><span class="free">X</span><span class="main">.</span> <span class="free">β</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span><span class="main">}</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Hermite_Lindemann_aux4<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">x</span></span> <span class="main">|</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">∧</span> <span class="free">β</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span><span class="main">.</span> <span class="free">β</span> <span class="bound">x</span> <span class="main">*</span> exp <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="free">X</span><span class="main">.</span> <span class="free">β</span> <span class="bound">x</span> <span class="main">*</span> exp <span class="bound">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.mono_neutral_left assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">x</span></span> <span class="main">|</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">∧</span> <span class="free">β</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span><span class="main">.</span> <span class="free">β</span> <span class="bound">x</span> <span class="main">*</span> exp <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> assms <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Lastly, we switch to indexed summation in order to obtain a version of the theorem that
  is somewhat nicer to use:
›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> Hermite_Lindemann<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">α</span> <span class="free">β</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> complex"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">I</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">I</span> <span class="main">⟹</span> algebraic <span class="main">(</span><span class="free">α</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">I</span> <span class="main">⟹</span> algebraic <span class="main">(</span><span class="free">β</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="free">α</span> <span class="free">I</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="free">I</span><span class="main">.</span> <span class="free">β</span> <span class="bound">x</span> <span class="main">*</span> exp <span class="main">(</span><span class="free">α</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">I</span><span class="main">.</span> <span class="free">β</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">=</span> inv_into <span class="free">I</span> <span class="free">α</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">(</span><span class="free">α</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">I</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
    <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> f_def inv_into_f_f<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main"><span class="main">(</span></span></span>4<span class="main"><span class="main"><span class="main">)</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">α</span><span class="main">`</span><span class="free">I</span><span class="main">.</span> <span class="main">(</span><span class="free">β</span> <span class="main">∘</span> <span class="skolem">f</span><span class="main">)</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Hermite_Lindemann'<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="free">I</span><span class="main">.</span> <span class="free">β</span> <span class="bound">x</span> <span class="main">*</span> exp <span class="main">(</span><span class="free">α</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>5<span class="main">)</span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="free">I</span><span class="main">.</span> <span class="main">(</span><span class="free">β</span> <span class="main">∘</span> <span class="skolem">f</span><span class="main">)</span> <span class="main">(</span><span class="free">α</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> exp <span class="main">(</span><span class="free">α</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.cong<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="free">α</span><span class="main">`</span><span class="free">I</span><span class="main">.</span> <span class="main">(</span><span class="free">β</span> <span class="main">∘</span> <span class="skolem">f</span><span class="main">)</span> <span class="bound">x</span> <span class="main">*</span> exp <span class="bound">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> sum.reindex<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="free">α</span> <span class="main">`</span> <span class="free">I</span><span class="main">.</span> <span class="main">(</span><span class="free">β</span> <span class="main">∘</span> <span class="skolem">f</span><span class="main">)</span> <span class="bound">x</span> <span class="main">*</span> exp <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> assms <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The following version using lists instead of sequences is even more convenient to use
  in practice:
›</span></span>
<span class="keyword1"><span class="command">corollary</span></span> Hermite_Lindemann_list<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">xs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>complex <span class="main">×</span> complex<span class="main">)</span> list"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> alg<span class="main">:</span>      <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">∈</span>set <span class="free">xs</span><span class="main">.</span> algebraic <span class="bound">x</span> <span class="main">∧</span> algebraic <span class="bound">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> distinct<span class="main">:</span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>map snd <span class="free">xs</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> sum0<span class="main">:</span>     <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">c</span><span class="main">,</span><span class="bound">α</span><span class="main">)</span><span class="main">←</span><span class="free">xs</span><span class="main">.</span> <span class="bound">c</span> <span class="main">*</span> exp <span class="bound">α</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">c</span><span class="main">∈</span><span class="main">(</span>fst <span class="main">`</span> set <span class="free">xs</span><span class="main">)</span><span class="main">.</span> <span class="bound">c</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> length <span class="free">xs</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">∈</span><span class="main">{..&lt;</span><span class="skolem">n</span><span class="main">}</span><span class="main">.</span> fst <span class="main">(</span><span class="free">xs</span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Hermite_Lindemann<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> distinct <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> map snd <span class="free">xs</span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span> <span class="main">{..&lt;</span><span class="skolem">n</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> inj_on_nth<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> n_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?this</span> <span class="main">⟷</span> inj_on <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> snd <span class="main">(</span><span class="free">xs</span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">{..&lt;</span><span class="skolem">n</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> inj_on_cong<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> n_def<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> snd <span class="main">(</span><span class="free">xs</span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">{..&lt;</span><span class="skolem">n</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">c</span><span class="main">,</span><span class="bound">α</span><span class="main">)</span><span class="main">←</span><span class="free">xs</span><span class="main">.</span> <span class="bound">c</span> <span class="main">*</span> exp <span class="bound">α</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> sum0 <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="skolem">n</span><span class="main">.</span> fst <span class="main">(</span><span class="free">xs</span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span> <span class="main">*</span> exp <span class="main">(</span>snd <span class="main">(</span><span class="free">xs</span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> sum_list_sum_nth
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.cong<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> n_def case_prod_unfold<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="keyword3"><span class="command">assume</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="main">{..&lt;</span><span class="skolem">n</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>fst <span class="main">(</span><span class="free">xs</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span><span class="main">,</span> snd <span class="main">(</span><span class="free">xs</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">xs</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> n_def<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> alg <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"algebraic <span class="main">(</span>fst <span class="main">(</span><span class="free">xs</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"algebraic <span class="main">(</span>snd <span class="main">(</span><span class="free">xs</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> ballI<span class="main"><span class="keyword3">,</span></span> <span class="operator">elim</span> imageE<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c</span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> cx<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">=</span> fst <span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> set <span class="free">xs</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="main">{..&lt;</span><span class="skolem">n</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="free">xs</span> <span class="main">!</span> <span class="skolem">i</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> set_conv_nth n_def<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> * cx <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹The traditional formulation of the theorem›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  What we proved above was actually Baker's reformulation of the theorem. Thus, we now also derive
  the original one, which uses linear independence and algebraic independence.

  It states that if $\alpha_1, \ldots, \alpha_n$ are algebraic numbers that are linearly
  independent over <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>ℤ›</span></span></span></span>, then $e^{\alpha_1}, \ldots, e^{\alpha_n}$ are algebraically independent
  over <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>ℚ›</span></span></span></span>.
›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Linear independence over the integers is just independence of a set of complex numbers when
  viewing the complex numbers as a <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>ℤ›</span></span></span></span>-module.
›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">linearly_independent_over_int</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> field_char_0 set <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">linearly_independent_over_int</span> <span class="main">=</span> module.independent <span class="main">(</span><span class="main">λ</span><span class="bound">r</span> <span class="bound">x</span><span class="main">.</span> of_int <span class="bound">r</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Algebraic independence over the rationals means that the given set <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>X›</span></span></span></span> of numbers fulfils
  no non-trivial polynomial equation with rational coefficients, i.e. there is no non-zero
  multivariate polynomial with rational coefficients that, when inserting the numbers from <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>X›</span></span></span></span>,
  becomes zero.

  Note that we could easily replace `rational coefficients' with `algebraic coefficients' here
  and the proof would still go through without any modifications.
›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">algebraically_independent_over_rat</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="main">(</span>nat <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">::</span> field_char_0<span class="main">)</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">algebraically_independent_over_rat</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">⟷</span>
     <span class="main">(</span><span class="main">∀</span><span class="bound">p</span><span class="main">.</span> vars <span class="bound">p</span> <span class="main">⊆</span> <span class="main">{..&lt;</span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">}</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">m</span><span class="main">.</span> coeff <span class="bound">p</span> <span class="bound">m</span> <span class="main">∈</span> <span class="main">ℚ</span><span class="main">)</span> <span class="main">∧</span> insertion <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="bound">p</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟶</span> <span class="bound">p</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">corollary</span></span> Hermite_Lindemann_original<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">n</span> <span class="main">::</span> <span class="quoted">nat</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">α</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> complex"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="free">α</span> <span class="main">{..&lt;</span><span class="free">n</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">⟹</span> algebraic <span class="main">(</span><span class="free">α</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"linearly_independent_over_int <span class="main">(</span><span class="free">α</span> <span class="main">`</span> <span class="main">{..&lt;</span><span class="free">n</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"algebraically_independent_over_rat <span class="free">n</span> <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> exp <span class="main">(</span><span class="free">α</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> algebraically_independent_over_rat_def
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span> <span class="keyword3"><span class="command">assume</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"vars <span class="skolem">p</span> <span class="main">⊆</span> <span class="main">{..&lt;</span><span class="free">n</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">m</span><span class="main">.</span> coeff <span class="skolem">p</span> <span class="bound">m</span> <span class="main">∈</span> <span class="main">ℚ</span>"</span></span> <span class="quoted"><span class="quoted">"insertion <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> exp <span class="main">(</span><span class="free">α</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="skolem">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">α'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">α'</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">m</span><span class="main">.</span> <span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> of_nat <span class="main">(</span>lookup <span class="bound">m</span> <span class="bound">i</span><span class="main">)</span> <span class="main">*</span> <span class="free">α</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">I</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">I</span> <span class="main">=</span> <span class="main">{</span><span class="bound">m</span><span class="main">.</span> coeff <span class="skolem">p</span> <span class="bound">m</span> <span class="main">≠</span> <span class="main">0</span><span class="main">}</span>"</span></span>

  <span class="keyword1"><span class="command">have</span></span> lookup_eq_0<span class="main">:</span> <span class="quoted"><span class="quoted">"lookup <span class="skolem">m</span> <span class="skolem">i</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">∈</span> <span class="skolem">I</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∉</span> <span class="main">{..&lt;</span><span class="free">n</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span> <span class="skolem">m</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"keys <span class="skolem">m</span> <span class="main">⊆</span> vars <span class="skolem">p</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> that coeff_notin_vars<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">m</span></span> <span class="quoted"><span class="skolem">p</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> I_def<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"lookup <span class="skolem">m</span> <span class="skolem">i</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> in_keys_iff<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">i</span></span> <span class="quoted"><span class="skolem">m</span></span><span class="main">]</span> that p<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="skolem">I</span><span class="main">.</span> coeff <span class="skolem">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Hermite_Lindemann<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">I</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> I_def<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"algebraic <span class="main">(</span><span class="skolem">α'</span> <span class="skolem">m</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">∈</span> <span class="skolem">I</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">m</span>
      <span class="keyword1"><span class="command">unfolding</span></span> α'_def <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"algebraic <span class="main">(</span>coeff <span class="skolem">p</span> <span class="skolem">m</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">∈</span> <span class="skolem">I</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">m</span>
      <span class="keyword1"><span class="command">unfolding</span></span> α'_def <span class="keyword1"><span class="command">using</span></span> p<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="skolem">α'</span> <span class="skolem">I</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">m1</span> <span class="skolem">m2</span> <span class="keyword3"><span class="command">assume</span></span> m12<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">m1</span> <span class="main">∈</span> <span class="skolem">I</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m2</span> <span class="main">∈</span> <span class="skolem">I</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">α'</span> <span class="skolem">m1</span> <span class="main">=</span> <span class="skolem">α'</span> <span class="skolem">m2</span>"</span></span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">lu</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>nat <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> nat<span class="main">)</span> <span class="main">⇒</span> nat <span class="main">⇒</span> int"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">lu</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">m</span> <span class="bound">i</span><span class="main">.</span> int <span class="main">(</span>lookup <span class="bound">m</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">interpret</span></span> int<span class="main">:</span> Modules.module <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">r</span> <span class="bound">x</span><span class="main">.</span> of_int <span class="bound">r</span> <span class="main">*</span> <span class="main">(</span><span class="bound">x</span> <span class="main">::</span> complex<span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">standard</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span> of_rat_mult of_rat_add<span class="main">)</span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">idx</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">idx</span> <span class="main">=</span> inv_into <span class="main">{..&lt;</span><span class="free">n</span><span class="main">}</span> <span class="free">α</span>"</span></span>

      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">lu</span> <span class="skolem">m1</span> <span class="skolem">i</span> <span class="main">=</span> <span class="skolem">lu</span> <span class="skolem">m2</span> <span class="skolem">i</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">lu</span> <span class="skolem">m1</span> <span class="main">(</span><span class="skolem">idx</span> <span class="main">(</span><span class="free">α</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">lu</span> <span class="skolem">m2</span> <span class="main">(</span><span class="skolem">idx</span> <span class="main">(</span><span class="free">α</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> int.independentD<span class="main">)</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"int.independent <span class="main">(</span><span class="free">α</span> <span class="main">`</span> <span class="main">{..&lt;</span><span class="free">n</span><span class="main">}</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> linearly_independent_over_int_def<span class="main">)</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="free">α</span><span class="main">`</span><span class="main">{..&lt;</span><span class="free">n</span><span class="main">}</span><span class="main">.</span> of_int <span class="main">(</span><span class="skolem">lu</span> <span class="skolem">m1</span> <span class="main">(</span><span class="skolem">idx</span> <span class="bound">x</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">lu</span> <span class="skolem">m2</span> <span class="main">(</span><span class="skolem">idx</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span>
                <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> of_int <span class="main">(</span><span class="skolem">lu</span> <span class="skolem">m1</span> <span class="main">(</span><span class="skolem">idx</span> <span class="main">(</span><span class="free">α</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">lu</span> <span class="skolem">m2</span> <span class="main">(</span><span class="skolem">idx</span> <span class="main">(</span><span class="free">α</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="free">α</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> sum.reindex<span class="main">)</span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> of_int <span class="main">(</span><span class="skolem">lu</span> <span class="skolem">m1</span> <span class="bound">i</span> <span class="main">-</span> <span class="skolem">lu</span> <span class="skolem">m2</span> <span class="bound">i</span><span class="main">)</span> <span class="main">*</span> <span class="free">α</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.cong<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> idx_def inv_into_f_f<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main"><span class="main">(</span></span></span>1<span class="main"><span class="main"><span class="main">)</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> m12 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> α'_def ring_distribs of_rat_diff sum_subtractf lu_def<span class="main">)</span>
          <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="free">α</span><span class="main">`</span><span class="main">{..&lt;</span><span class="free">n</span><span class="main">}</span><span class="main">.</span> of_int <span class="main">(</span><span class="skolem">lu</span> <span class="skolem">m1</span> <span class="main">(</span><span class="skolem">idx</span> <span class="bound">x</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">lu</span> <span class="skolem">m2</span> <span class="main">(</span><span class="skolem">idx</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> α'_def ring_distribs of_rat_diff sum_subtractf lu_def<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> that <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> idx_def inv_into_f_f<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main"><span class="main">(</span></span></span>1<span class="main"><span class="main"><span class="main">)</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"lookup <span class="skolem">m1</span> <span class="skolem">i</span> <span class="main">=</span> lookup <span class="skolem">m2</span> <span class="skolem">i</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span>
        <span class="keyword1"><span class="command">using</span></span> m12 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> lu_def lookup_eq_0<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m1</span> <span class="main">=</span> <span class="skolem">m2</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> poly_mapping_eqI<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">=</span> insertion <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> exp <span class="main">(</span><span class="free">α</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="skolem">p</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> p<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">m</span><span class="main">∈</span><span class="skolem">I</span><span class="main">.</span> coeff <span class="skolem">p</span> <span class="bound">m</span> <span class="main">*</span> Prod_any <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> exp <span class="main">(</span><span class="free">α</span> <span class="bound">i</span><span class="main">)</span> <span class="main">^</span> lookup <span class="bound">m</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> insertion_altdef <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Sum_any.expand_superset<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> I_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">m</span><span class="main">∈</span><span class="skolem">I</span><span class="main">.</span> coeff <span class="skolem">p</span> <span class="bound">m</span> <span class="main">*</span> exp <span class="main">(</span><span class="skolem">α'</span> <span class="bound">m</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> sum.cong<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">m</span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Prod_any <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> exp <span class="main">(</span><span class="free">α</span> <span class="bound">i</span><span class="main">)</span> <span class="main">^</span> lookup <span class="skolem">m</span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">i</span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> exp <span class="main">(</span><span class="free">α</span> <span class="bound">i</span><span class="main">)</span> <span class="main">^</span> lookup <span class="skolem">m</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> 2 lookup_eq_0<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">m</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> Prod_any.expand_superset<span class="main"><span class="keyword3">;</span></span> <span class="operator">force</span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> exp <span class="main">(</span><span class="skolem">α'</span> <span class="skolem">m</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> exp_sum exp_of_nat_mult α'_def<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">m</span><span class="main">∈</span><span class="skolem">I</span><span class="main">.</span> coeff <span class="skolem">p</span> <span class="bound">m</span> <span class="main">*</span> exp <span class="main">(</span><span class="skolem">α'</span> <span class="bound">m</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mpoly_eqI<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> I_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Simple corollaries›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Now, we derive all the usual obvious corollaries of the theorem in the obvious way.

  First, the exponential of a non-zero algebraic number is transcendental.
›</span></span>
<span class="keyword1"><span class="command">corollary</span></span> algebraic_exp_complex_iff<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"algebraic <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"algebraic <span class="main">(</span>exp <span class="free">x</span> <span class="main">::</span> complex<span class="main">)</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Hermite_Lindemann_list<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="free">x</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">-</span>exp <span class="free">x</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">]</span>"</span></span><span class="main">]</span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  More generally, any sum of exponentials with algebraic coefficients and exponents is
  transcendental if the exponents are all distinct and non-zero and at least one coefficient
  is non-zero.
›</span></span>
<span class="keyword1"><span class="command">corollary</span></span> sum_of_exp_transcendentalI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">xs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>complex <span class="main">×</span> complex<span class="main">)</span> list"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">∈</span>set <span class="free">xs</span><span class="main">.</span> algebraic <span class="bound">x</span> <span class="main">∧</span> algebraic <span class="bound">y</span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span><span class="main">∈</span>fst<span class="main">`</span>set <span class="free">xs</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> distinct<span class="main">:</span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>map snd <span class="free">xs</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">¬</span>algebraic <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">c</span><span class="main">,</span><span class="bound">α</span><span class="main">)</span><span class="main">←</span><span class="free">xs</span><span class="main">.</span> <span class="bound">c</span> <span class="main">*</span> exp <span class="bound">α</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">S</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">c</span><span class="main">,</span><span class="bound">α</span><span class="main">)</span><span class="main">←</span><span class="free">xs</span><span class="main">.</span> <span class="bound">c</span> <span class="main">*</span> exp <span class="bound">α</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> S<span class="main">:</span> <span class="quoted"><span class="quoted">"algebraic <span class="skolem">S</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">c</span><span class="main">∈</span>fst<span class="main">`</span>set <span class="main">(</span><span class="main">(</span><span class="main">-</span><span class="skolem">S</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">#</span> <span class="free">xs</span><span class="main">)</span><span class="main">.</span> <span class="bound">c</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Hermite_Lindemann_list<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">c</span><span class="main">,</span> <span class="bound">α</span><span class="main">)</span><span class="main">←</span><span class="main">(</span><span class="main">-</span> <span class="skolem">S</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span> <span class="main">#</span> <span class="free">xs</span><span class="main">.</span> <span class="bound">c</span> <span class="main">*</span> exp <span class="bound">α</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> S_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> S assms <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Any complex logarithm of an algebraic number other than 1 is transcendental
  (no matter which branch cut).
›</span></span>
<span class="keyword1"><span class="command">corollary</span></span> transcendental_complex_logarithm<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"algebraic <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"exp <span class="free">y</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">::</span> complex<span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">¬</span>algebraic <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> algebraic_exp_complex_iff<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">y</span></span><span class="main">]</span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  In particular, this holds for the standard branch of the logarithm.
›</span></span>
<span class="keyword1"><span class="command">corollary</span></span> transcendental_Ln<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"algebraic <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">¬</span>algebraic <span class="main">(</span>Ln <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> transcendental_complex_logarithm<span class="main">)</span> <span class="main">(</span><span class="operator">use</span> assms <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The transcendence of <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>e›</span></span></span></span> and <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>π›</span></span></span></span>, which I have already formalised directly in other AFP
  entries, now follows as a simple corollary.
›</span></span>
<span class="keyword1"><span class="command">corollary</span></span> exp_1_complex_transcendental<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>algebraic <span class="main">(</span>exp <span class="main">1</span> <span class="main">::</span> complex<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> algebraic_exp_complex_iff<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">corollary</span></span> pi_transcendental<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>algebraic pi"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>algebraic <span class="main">(</span><span class="keyword1">𝗂</span> <span class="main">*</span> pi<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> transcendental_complex_logarithm<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">-</span></span></span><span class="main"><span class="main"><span class="main">1</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Transcendence of the trigonometric and hyperbolic functions›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  In a similar fashion, we can also prove the transcendence of all the trigonometric and
  hyperbolic functions such as $\sin$, $\tan$, $\sinh$, $\arcsin$, etc.
›</span></span>

<span class="keyword1" id="Hermite_Lindemann-transcendental_sinh"><span class="command">lemma</span></span> transcendental_sinh<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"algebraic <span class="free">z</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">¬</span>algebraic <span class="main">(</span>sinh <span class="free">z</span> <span class="main">::</span> complex<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>algebraic <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span><span class="main">←</span><span class="main">[</span><span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">,</span> <span class="free">z</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">,</span> <span class="main">-</span><span class="free">z</span><span class="main">)</span><span class="main">]</span><span class="main">.</span> <span class="bound">a</span> <span class="main">*</span> exp <span class="bound">b</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum_of_exp_transcendentalI<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span><span class="main">←</span><span class="main">[</span><span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">,</span> <span class="free">z</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">,</span> <span class="main">-</span><span class="free">z</span><span class="main">)</span><span class="main">]</span><span class="main">.</span> <span class="bound">a</span> <span class="main">*</span> exp <span class="bound">b</span><span class="main">)</span> <span class="main">=</span> sinh <span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sinh_def <span class="dynamic"><span class="dynamic">field_simps</span></span> scaleR_conv_of_real<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Hermite_Lindemann-transcendental_cosh"><span class="command">lemma</span></span> transcendental_cosh<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"algebraic <span class="free">z</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">¬</span>algebraic <span class="main">(</span>cosh <span class="free">z</span> <span class="main">::</span> complex<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>algebraic <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span><span class="main">←</span><span class="main">[</span><span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">,</span> <span class="free">z</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">,</span> <span class="main">-</span><span class="free">z</span><span class="main">)</span><span class="main">]</span><span class="main">.</span> <span class="bound">a</span> <span class="main">*</span> exp <span class="bound">b</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum_of_exp_transcendentalI<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span><span class="main">←</span><span class="main">[</span><span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">,</span> <span class="free">z</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">,</span> <span class="main">-</span><span class="free">z</span><span class="main">)</span><span class="main">]</span><span class="main">.</span> <span class="bound">a</span> <span class="main">*</span> exp <span class="bound">b</span><span class="main">)</span> <span class="main">=</span> cosh <span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cosh_def <span class="dynamic"><span class="dynamic">field_simps</span></span> scaleR_conv_of_real<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Hermite_Lindemann-transcendental_sin"><span class="command">lemma</span></span> transcendental_sin<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"algebraic <span class="free">z</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">¬</span>algebraic <span class="main">(</span>sin <span class="free">z</span> <span class="main">::</span> complex<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> sin_conv_sinh <span class="keyword1"><span class="command">using</span></span> transcendental_sinh<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="keyword1">𝗂</span> <span class="main">*</span> <span class="free">z</span>"</span></span><span class="main">]</span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Hermite_Lindemann-transcendental_cos"><span class="command">lemma</span></span> transcendental_cos<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"algebraic <span class="free">z</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">¬</span>algebraic <span class="main">(</span>cos <span class="free">z</span> <span class="main">::</span> complex<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> cos_conv_cosh <span class="keyword1"><span class="command">using</span></span> transcendental_cosh<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="keyword1">𝗂</span> <span class="main">*</span> <span class="free">z</span>"</span></span><span class="main">]</span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="comment1">(* TODO: Move? *)</span>
<span class="keyword1" id="Hermite_Lindemann-tan_square_neq_neg1"><span class="command">lemma</span></span> tan_square_neq_neg1<span class="main">:</span> <span class="quoted"><span class="quoted">"tan <span class="main">(</span><span class="free">z</span> <span class="main">::</span> complex<span class="main">)</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">≠</span> <span class="main">-</span><span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"tan <span class="free">z</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">=</span> <span class="main">-</span><span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"sin <span class="free">z</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">=</span> <span class="main">-</span><span class="main">(</span>cos <span class="free">z</span> <span class="main">^</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> tan_def <span class="dynamic"><span class="dynamic">divide_simps</span></span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cos <span class="free">z</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">=</span> <span class="main">1</span> <span class="main">-</span> sin <span class="free">z</span> <span class="main">^</span> <span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cos_squared_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Hermite_Lindemann-transcendental_tan"><span class="command">lemma</span></span> transcendental_tan<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"algebraic <span class="free">z</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">¬</span>algebraic <span class="main">(</span>tan <span class="free">z</span> <span class="main">::</span> complex<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"algebraic <span class="main">(</span>tan <span class="free">z</span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">have</span></span> nz1<span class="main">:</span> <span class="quoted"><span class="quoted">"real_of_int <span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"real_of_int <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> real_of_int <span class="numeral">2</span> <span class="main">∉</span> <span class="main">ℤ</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> fraction_not_in_ints<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"real_of_int <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> real_of_int <span class="numeral">2</span> <span class="main">=</span> real_of_int <span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">have</span></span> nz2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">+</span> tan <span class="free">z</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> tan_square_neq_neg1<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">z</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> add_eq_0_iff<span class="main">)</span> 

  <span class="keyword1"><span class="command">have</span></span> nz3<span class="main">:</span> <span class="quoted"><span class="quoted">"cos <span class="free">z</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"cos <span class="free">z</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">=</span> complex_of_real <span class="main">(</span>real_of_int <span class="skolem">n</span> <span class="main">*</span> pi<span class="main">)</span> <span class="main">+</span> complex_of_real pi <span class="main">/</span> <span class="numeral">2</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> cos_eq_0<span class="main">)</span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> complex_of_real <span class="main">(</span><span class="main">(</span>real_of_int <span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> pi<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ring_distribs<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"algebraic <span class="main">…</span> <span class="main">⟷</span> algebraic <span class="main">(</span><span class="main">(</span>real_of_int <span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> pi<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> algebraic_of_real_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>algebraic <span class="main">(</span><span class="main">(</span>real_of_int <span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> pi<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> nz1<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">n</span></span><span class="main">]</span> transcendental_pi <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">contradiction</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">from</span></span> nz3 <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"sin <span class="free">z</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">=</span> tan <span class="free">z</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">*</span> cos <span class="free">z</span> <span class="main">^</span> <span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tan_def <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cos <span class="free">z</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">=</span> <span class="main">1</span> <span class="main">-</span> sin <span class="free">z</span> <span class="main">^</span> <span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cos_squared_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sin <span class="free">z</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> tan <span class="free">z</span> <span class="main">^</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">=</span> tan <span class="free">z</span> <span class="main">^</span> <span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"sin <span class="free">z</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">=</span> tan <span class="free">z</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> tan <span class="free">z</span> <span class="main">^</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> nz2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"algebraic <span class="main">(</span>tan <span class="free">z</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> tan <span class="free">z</span> <span class="main">^</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹algebraic <span class="main">(</span>tan <span class="free">z</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"algebraic <span class="main">(</span>sin <span class="free">z</span> <span class="main">^</span> <span class="numeral">2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"algebraic <span class="main">(</span>sin <span class="free">z</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span>
    <span class="keyword1"><span class="command">using</span></span> transcendental_sin<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹algebraic <span class="free">z</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">z</span> <span class="main">≠</span> <span class="main">0</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">contradiction</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Hermite_Lindemann-transcendental_cot"><span class="command">lemma</span></span> transcendental_cot<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"algebraic <span class="free">z</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">¬</span>algebraic <span class="main">(</span>cot <span class="free">z</span> <span class="main">::</span> complex<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>algebraic <span class="main">(</span>tan <span class="free">z</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> transcendental_tan<span class="main">)</span> <span class="operator">fact</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"algebraic <span class="main">(</span>tan <span class="free">z</span><span class="main">)</span> <span class="main">⟷</span> algebraic <span class="main">(</span>inverse <span class="main">(</span>tan <span class="free">z</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inverse <span class="main">(</span>tan <span class="free">z</span><span class="main">)</span> <span class="main">=</span> cot <span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cot_def tan_def<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Hermite_Lindemann-transcendental_tanh"><span class="command">lemma</span></span> transcendental_tanh<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"algebraic <span class="free">z</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"cosh <span class="free">z</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">¬</span>algebraic <span class="main">(</span>tanh <span class="free">z</span> <span class="main">::</span> complex<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> transcendental_tan<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="keyword1">𝗂</span> <span class="main">*</span> <span class="free">z</span>"</span></span><span class="main">]</span> assms <span class="keyword1"><span class="command">unfolding</span></span> tanh_conv_tan <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Hermite_Lindemann-transcendental_Arcsin"><span class="command">lemma</span></span> transcendental_Arcsin<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"algebraic <span class="free">z</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">¬</span>algebraic <span class="main">(</span>Arcsin <span class="free">z</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">𝗂</span> <span class="main">*</span> <span class="free">z</span> <span class="main">+</span> csqrt <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">z</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Arcsin_body_lemma <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">𝗂</span> <span class="main">*</span> <span class="free">z</span> <span class="main">+</span> csqrt <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">z</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">≠</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">𝗂</span> <span class="main">*</span> <span class="free">z</span> <span class="main">+</span> csqrt <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">z</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Arcsin <span class="free">z</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Arcsin_def<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"sin <span class="main">(</span>Arcsin <span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> sin_zero<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sin <span class="main">(</span>Arcsin <span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="free">z</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">z</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> algebraic <span class="main">(</span>Ln <span class="main">(</span><span class="keyword1">𝗂</span> <span class="main">*</span> <span class="free">z</span> <span class="main">+</span> csqrt <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">z</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> transcendental_Ln<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Arcsin_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Hermite_Lindemann-transcendental_Arccos"><span class="command">lemma</span></span> transcendental_Arccos<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"algebraic <span class="free">z</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">≠</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">¬</span>algebraic <span class="main">(</span>Arccos <span class="free">z</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">+</span> <span class="keyword1">𝗂</span> <span class="main">*</span> csqrt <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">z</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Arccos_body_lemma <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">+</span> <span class="keyword1">𝗂</span> <span class="main">*</span> csqrt <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">z</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">≠</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">+</span> <span class="keyword1">𝗂</span> <span class="main">*</span> csqrt <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">z</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Arccos <span class="free">z</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Arccos_def<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"cos <span class="main">(</span>Arccos <span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> cos_zero<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cos <span class="main">(</span>Arccos <span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="free">z</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">z</span> <span class="main">≠</span> <span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> algebraic <span class="main">(</span>Ln <span class="main">(</span><span class="free">z</span> <span class="main">+</span> <span class="keyword1">𝗂</span> <span class="main">*</span> csqrt <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">z</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> transcendental_Ln<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Arccos_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Hermite_Lindemann-transcendental_Arctan"><span class="command">lemma</span></span> transcendental_Arctan<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"algebraic <span class="free">z</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">∉</span> <span class="main">{</span><span class="main">0</span><span class="main">,</span> <span class="keyword1">𝗂</span><span class="main">,</span> <span class="main">-</span><span class="keyword1">𝗂</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">¬</span>algebraic <span class="main">(</span>Arctan <span class="free">z</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">𝗂</span> <span class="main">*</span> <span class="free">z</span> <span class="main">≠</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">+</span> <span class="keyword1">𝗂</span> <span class="main">*</span> <span class="free">z</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> complex_eq_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> algebraic <span class="main">(</span>Ln <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="keyword1">𝗂</span> <span class="main">*</span> <span class="free">z</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="keyword1">𝗂</span> <span class="main">*</span> <span class="free">z</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> transcendental_Ln<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Arctan_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</div>