<div id="Surprise_Paradox">
<div class="head">
<h1>Theory Surprise_Paradox</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> Surprise_Paradox
<span class="keyword2"><span class="keyword">imports</span></span>
  <a href="../../incompleteness/theories/#Goedel_I">Incompleteness.Goedel_I</a>
  <a href="../../incompleteness/theories/#Pseudo_Coding">Incompleteness.Pseudo_Coding</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The Surprise Paradox comes in a few variations, one being the following:

\begin{quote}
A judge sentences a felon to death by hanging, to be executed at noon the next week, Monday to
Friday. As an extra punishment, the judge does not disclose the day of the hanging and promises the
felon that it will come at a surprise.

The felon, probably a logician, then concludes that he cannot be hanged on Friday, as by then it would
not longer be a surprise. Using this fact and similar reasoning, he cannot be hanged on Thursday, and so
on. He reaches the conclusion that he cannot be hanged at all, and contently returns to his cell.

Wednesday, at noon, the hangman comes to the very surprised felon, and executes him.
\end{quote}

Obviously, something is wrong here: Does the felon reason wrongly? It looks about right.
Or is the judge lying? But his prediction became true!

It is an interesting exercise to try to phrase the Surprise Paradox in a rigorous manner, and
see this might clarify things.

In 1964, Frederic Fitch suggested a formulation that refines the notion of ``surprise'' as
``cannot be proven from the given assumptions'' <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">cite</span></span> Fitch<span class="antiquote"><span class="antiquote">}</span></span></span></span>. To formulate that, we need propositions that
reference their own provability, so just as Fitch builds on Gödel's work, we build on Paulson's
formalisation of Gödel's incompleteness theorems in Isabelle <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">cite</span></span> Incompleteness<span class="antiquote"><span class="antiquote">}</span></span></span></span>.
›</span></span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Excluded or›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Although the proof goes through with regular disjunction, Fitch phrases the judge's
proposition using exclusive or, so we add syntax for that.›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">Xor</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"fm <span class="main">⇒</span> fm <span class="main">⇒</span> fm"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">XOR</span>"</span> 120<span class="main">)</span>
 <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">Xor</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="keyword1">OR</span> <span class="free"><span class="bound"><span class="entity">B</span></span></span><span class="main">)</span> <span class="keyword1">AND</span> <span class="main">(</span><span class="main">(</span>Neg <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span> <span class="keyword1">OR</span> <span class="main">(</span>Neg <span class="free"><span class="bound"><span class="entity">B</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Formulas with variables›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
In Paulson's formalisation of terms and formulas, only terms carry variables. This is sufficient for
his purposes, because the proposition that is being diagonalised needs itself as a parameter to
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term_type</span></span> <span class="quoted"><span class="quoted">PfP</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, which does take a term (which happens to be a quoted formula).

In order to stay close to Fitch, we need the diagonalised proposition to occur deeper in a quotation
of a few logical conjunctions. Therefore, we build a small theory of formulas with variables (``holed''
formulas). These support substituting a formula for a variable, this substitution commutes with
quotation, and closed holed formulas can be converted to regular formulas.

In our application, we do not need holes under an quantifier, which greatly simplifies things here.
In particular, we can use <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">command</span></span> datatype<span class="antiquote"><span class="antiquote">}</span></span></span></span> and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">command</span></span> fun<span class="antiquote"><span class="antiquote">}</span></span></span></span>.
›</span></span>

<span class="keyword1"><span class="command">datatype</span></span> hfm <span class="main">=</span>
   HVar <span class="quoted">name</span>
 <span class="main">|</span> HFm <span class="quoted">fm</span>
 <span class="main">|</span> HDisj <span class="quoted">hfm</span> <span class="quoted">hfm</span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">HOR</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>"</span> 130<span class="main">)</span>
 <span class="main">|</span> HNeg  <span class="quoted">hfm</span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">HImp</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"hfm <span class="main">⇒</span> hfm <span class="main">⇒</span> hfm"</span></span>  <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">HIMP</span>"</span> 125<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">HImp</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="main">≡</span> HDisj <span class="main">(</span>HNeg <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">B</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">HConj</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"hfm <span class="main">⇒</span> hfm <span class="main">⇒</span> hfm"</span></span>   <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">HAND</span>"</span> 135<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">HConj</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="main">≡</span> HNeg <span class="main">(</span>HDisj <span class="main">(</span>HNeg <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span> <span class="main">(</span>HNeg <span class="free"><span class="bound"><span class="entity">B</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">HXor</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"hfm <span class="main">⇒</span> hfm <span class="main">⇒</span> hfm"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">HXOR</span>"</span> 120<span class="main">)</span>
 <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">HXor</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="keyword1">HOR</span> <span class="free"><span class="bound"><span class="entity">B</span></span></span><span class="main">)</span> <span class="keyword1">HAND</span> <span class="main">(</span>HNeg <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="keyword1">HOR</span> HNeg <span class="free"><span class="bound"><span class="entity">B</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span>  <span class="entity">subst_hfm</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"hfm <span class="main">⇒</span> name <span class="main">⇒</span> fm <span class="main">⇒</span> hfm"</span></span> <span class="main">(</span><span class="quoted">"_<span class="keyword1">'(</span>_<span class="keyword1">:::=</span>_<span class="keyword1">')</span>"</span> <span class="main">[</span>1000<span class="main">,</span> 0<span class="main">,</span> 0<span class="main">]</span> 200<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span>HVar <span class="free"><span class="bound"><span class="entity">name</span></span></span><span class="main">)</span><span class="main"><span class="free">(</span></span><span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main"><span class="free">:::=</span></span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main"><span class="free">)</span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">name</span></span></span> <span class="keyword1">then</span> HFm <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="keyword1">else</span> HVar <span class="free"><span class="bound"><span class="entity">name</span></span></span><span class="main">)</span>"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>HDisj <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">B</span></span></span><span class="main">)</span><span class="main"><span class="free">(</span></span><span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main"><span class="free">:::=</span></span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main"><span class="free">)</span></span> <span class="main">=</span> HDisj <span class="main">(</span><span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main"><span class="free">(</span></span><span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main"><span class="free">:::=</span></span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main"><span class="free">)</span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">B</span></span></span><span class="main"><span class="free">(</span></span><span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main"><span class="free">:::=</span></span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main"><span class="free">)</span></span><span class="main">)</span>"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>HNeg <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span><span class="main"><span class="free">(</span></span><span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main"><span class="free">:::=</span></span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main"><span class="free">)</span></span> <span class="main">=</span> HNeg <span class="main">(</span><span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main"><span class="free">(</span></span><span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main"><span class="free">:::=</span></span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main"><span class="free">)</span></span><span class="main">)</span>"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>HFm <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span><span class="main"><span class="free">(</span></span><span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main"><span class="free">:::=</span></span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main"><span class="free">)</span></span> <span class="main">=</span> HFm <span class="free"><span class="bound"><span class="entity">A</span></span></span>"</span></span>

<span class="keyword1" id="Surprise_Paradox-subst_hfml_Conj"><span class="command">lemma</span></span> subst_hfml_Conj<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span>HConj <span class="free">A</span> <span class="free">B</span><span class="main">)</span><span class="main">(</span><span class="free">i</span><span class="main">:::=</span><span class="free">x</span><span class="main">)</span> <span class="main">=</span> HConj <span class="main">(</span><span class="free">A</span><span class="main">(</span><span class="free">i</span><span class="main">:::=</span><span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">B</span><span class="main">(</span><span class="free">i</span><span class="main">:::=</span><span class="free">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
 <span class="keyword1"><span class="command">unfolding</span></span> HConj_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">instantiation</span></span> hfm <span class="main">::</span> <span class="quoted">quot</span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity"><span class="class_parameter">quot_hfm</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"hfm <span class="main">⇒</span> tm"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
   <span class="quoted"><span class="quoted">"<span class="free">quot_hfm</span> <span class="main">(</span>HVar <span class="free"><span class="bound"><span class="entity">name</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Var <span class="free"><span class="bound"><span class="entity">name</span></span></span><span class="main">)</span>"</span></span>
 <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">quot_hfm</span> <span class="main">(</span>HFm <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">«</span><span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">»</span>"</span></span>
 <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">quot_hfm</span> <span class="main">(</span>HDisj <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">B</span></span></span><span class="main">)</span> <span class="main">=</span> HPair <span class="main">(</span>HTuple <span class="numeral">3</span><span class="main">)</span> <span class="main">(</span>HPair <span class="main">(</span><span class="free">quot_hfm</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free">quot_hfm</span> <span class="free"><span class="bound"><span class="entity">B</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
 <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">quot_hfm</span> <span class="main">(</span>HNeg <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span> <span class="main">=</span> HPair <span class="main">(</span>HTuple <span class="numeral">4</span><span class="main">)</span> <span class="main">(</span><span class="free">quot_hfm</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1" id="Surprise_Paradox-subst_quot_hfm"><span class="command">lemma</span></span> subst_quot_hfm<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"subst <span class="free">i</span> <span class="main">«</span><span class="free">P</span><span class="main">»</span> <span class="main">«</span><span class="free">A</span><span class="main">»</span> <span class="main">=</span> <span class="main">«</span><span class="free">A</span><span class="main">(</span><span class="free">i</span><span class="main">:::=</span><span class="free">P</span><span class="main">)</span><span class="main">»</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">A</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">hfm_to_fm</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"hfm <span class="main">⇒</span> fm"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
   <span class="quoted"><span class="quoted">"<span class="free">hfm_to_fm</span> <span class="main">(</span>HVar <span class="free"><span class="bound"><span class="entity">name</span></span></span><span class="main">)</span> <span class="main">=</span> undefined"</span></span>
 <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">hfm_to_fm</span> <span class="main">(</span>HFm <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span>"</span></span>
 <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">hfm_to_fm</span> <span class="main">(</span>HDisj <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">B</span></span></span><span class="main">)</span> <span class="main">=</span> Disj <span class="main">(</span><span class="free">hfm_to_fm</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free">hfm_to_fm</span> <span class="free"><span class="bound"><span class="entity">B</span></span></span><span class="main">)</span>"</span></span>
 <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">hfm_to_fm</span> <span class="main">(</span>HNeg <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span> <span class="main">=</span> Neg <span class="main">(</span><span class="free">hfm_to_fm</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Surprise_Paradox-hfm_to_fm_Conj"><span class="command">lemma</span></span> hfm_to_fm_Conj<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"hfm_to_fm <span class="main">(</span>HConj <span class="free">A</span> <span class="free">B</span><span class="main">)</span> <span class="main">=</span> Conj <span class="main">(</span>hfm_to_fm <span class="free">A</span><span class="main">)</span> <span class="main">(</span>hfm_to_fm <span class="free">B</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> HConj_def Conj_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">closed_hfm</span>  <span class="main">::</span> <span class="quoted"><span class="quoted">"hfm <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
   <span class="quoted"><span class="quoted">"<span class="free">closed_hfm</span> <span class="main">(</span>HVar <span class="free"><span class="bound"><span class="entity">name</span></span></span><span class="main">)</span> <span class="main">⟷</span> False"</span></span>
 <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">closed_hfm</span> <span class="main">(</span>HFm <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span> <span class="main">⟷</span> True"</span></span>
 <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">closed_hfm</span> <span class="main">(</span>HDisj <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">B</span></span></span><span class="main">)</span> <span class="main">⟷</span> <span class="free">closed_hfm</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">∧</span> <span class="free">closed_hfm</span> <span class="free"><span class="bound"><span class="entity">B</span></span></span>"</span></span>
 <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">closed_hfm</span> <span class="main">(</span>HNeg <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span> <span class="main">⟷</span> <span class="free">closed_hfm</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span>"</span></span>

<span class="keyword1" id="Surprise_Paradox-closed_hfm_Conj"><span class="command">lemma</span></span> closed_hfm_Conj<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"closed_hfm <span class="main">(</span>HConj <span class="free">A</span> <span class="free">B</span><span class="main">)</span> <span class="main">⟷</span> closed_hfm <span class="free">A</span> <span class="main">∧</span> closed_hfm <span class="free">B</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> HConj_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Surprise_Paradox-quot_closed_hfm"><span class="command">lemma</span></span> quot_closed_hfm<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"closed_hfm <span class="free">A</span> <span class="main">⟹</span> <span class="main">«</span><span class="free">A</span><span class="main">»</span> <span class="main">=</span> <span class="main">«</span>hfm_to_fm <span class="free">A</span><span class="main">»</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">A</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> quot_fm_def<span class="main">)</span>

<span class="keyword1"><span class="command">declare</span></span> quot_hfm.simps<span class="main">[</span><span class="operator">simp</span> <span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword">del</span></span></span></span><span class="main">]</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Fitch's proof›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
For simplicity, Fitch (and we) restrict the week to two days. Propositions <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>Q<span class="hidden">⇩</span><sub>1</sub>›</span></span></span></span> and <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>Q<span class="hidden">⇩</span><sub>2</sub>›</span></span></span></span>
represent the propositions that the hanging occurs on the first resp.\@ the second day, but
these can obviously be any propositions.
›</span></span>

<span class="keyword1"><span class="command">context</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">Q<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">::</span> <span class="quoted">fm</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Q<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">::</span> <span class="quoted">fm</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> Q_closed<span class="main">:</span> <span class="quoted"><span class="quoted">"supp <span class="free">Q<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="quoted"><span class="quoted">"supp <span class="free">Q<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

  <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  In order to define the judge's proposition, which is self-referential, we apply the usual trick
  of defining a proposition with a variable, and then using Gödel's diagonalisation lemma.
  ›</span></span>

  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">H</span> <span class="main">::</span> <span class="quoted">fm</span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">H</span> <span class="main">=</span> <span class="free">Q<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">AND</span> Neg <span class="main">(</span>PfP <span class="main">«</span>HVar X0 <span class="keyword1">HIMP</span> HFm <span class="free">Q<span class="hidden">⇩</span><sub>1</sub></span><span class="main">»</span><span class="main">)</span> <span class="keyword1">XOR</span> 
     <span class="free">Q<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword1">AND</span> Neg <span class="main">(</span>PfP <span class="main">«</span>HVar X0 <span class="keyword1">HAND</span> HNeg <span class="main">(</span>HFm <span class="free">Q<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="keyword1">HIMP</span> <span class="main">(</span>HFm <span class="free">Q<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span><span class="main">»</span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">P</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">P</span><span class="main">.</span> <span class="main">{}</span> <span class="main">⊢</span> <span class="bound">P</span> <span class="keyword1">IFF</span> H<span class="main">(</span>X0 <span class="main">::=</span> <span class="main">«</span><span class="bound">P</span><span class="main">»</span><span class="main">)</span><span class="main">)</span>"</span></span>

  <span class="keyword1" id="Surprise_Paradox-P'"><span class="command">lemma</span></span> P'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{}</span> <span class="main">⊢</span> P <span class="keyword1">IFF</span> H<span class="main">(</span>X0 <span class="main">::=</span> <span class="main">«</span>P<span class="main">»</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> diagonal<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> α <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"H"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> i <span class="main"><span class="main">=</span></span> <span class="quoted">X0</span><span class="main">]</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">δ</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">{}</span> <span class="main">⊢</span> <span class="skolem">δ</span> <span class="keyword1">IFF</span> H<span class="main">(</span>X0 <span class="main">::=</span> <span class="main">«</span><span class="skolem">δ</span><span class="main">»</span><span class="main">)</span>"</span></span><span class="keyword1"><span class="command">.</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>  <span class="keyword1"><span class="command">unfolding</span></span> P_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> someI<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  From now on, the lemmas are named after their number in Fitch's paper, and correspond to his
  statements pleasingly closely.
  ›</span></span>

  <span class="keyword1" id="Surprise_Paradox-7"><span class="command">lemma</span></span> 7<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{}</span> <span class="main">⊢</span> P <span class="keyword1">IFF</span>
     <span class="main">(</span><span class="free">Q<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">AND</span> Neg <span class="main">(</span>PfP <span class="main">«</span>P <span class="keyword1">IMP</span> <span class="free">Q<span class="hidden">⇩</span><sub>1</sub></span><span class="main">»</span><span class="main">)</span> <span class="keyword1">XOR</span>
      <span class="free">Q<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword1">AND</span> Neg <span class="main">(</span>PfP <span class="main">«</span>P <span class="keyword1">AND</span> Neg <span class="free">Q<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">IMP</span> <span class="free">Q<span class="hidden">⇩</span><sub>2</sub></span><span class="main">»</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> P' <span class="keyword1"><span class="command">unfolding</span></span> H_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Q_closed forget_subst_fm<span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> fresh_def<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">lemmas</span></span> <span class="quoted">"7_E"</span> <span class="main">=</span> 7<span class="main">[</span><span class="operator">THEN</span> thin0<span class="main">,</span> <span class="operator">THEN</span> Iff_MP_left'<span class="main">,</span> <span class="operator">OF</span> Conj_E<span class="main">,</span> <span class="operator">OF</span> thin2<span class="main">]</span>

  <span class="keyword1"><span class="command">lemmas</span></span> propositional_calculus <span class="main">=</span> 
    AssumeH Neg_I Imp_I Conj_E Disj_E ExFalso<span class="main">[</span><span class="operator">OF</span> Neg_E<span class="main">]</span>
    ExFalso<span class="main">[</span><span class="operator">OF</span> rotate2<span class="main">,</span> <span class="operator">OF</span> Neg_E<span class="main">]</span> ExFalso<span class="main">[</span><span class="operator">OF</span> rotate3<span class="main">,</span> <span class="operator">OF</span> Neg_E<span class="main">]</span>  
    
  <span class="keyword1" id="Surprise_Paradox-8"><span class="command">lemma</span></span> 8<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{}</span> <span class="main">⊢</span> <span class="main">(</span>P <span class="keyword1">AND</span> Neg <span class="free">Q<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="keyword1">IMP</span> <span class="free">Q<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> propositional_calculus <span class="quoted">"7_E"</span><span class="main">)</span>

  <span class="keyword1" id="Surprise_Paradox-10"><span class="command">lemma</span></span> 10<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{}</span> <span class="main">⊢</span> PfP <span class="main">«</span><span class="main">(</span>P <span class="keyword1">AND</span> Neg <span class="free">Q<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="keyword1">IMP</span> <span class="free">Q<span class="hidden">⇩</span><sub>2</sub></span><span class="main">»</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 8 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> proved_imp_proved_PfP<span class="main">)</span>
  <span class="keyword1"><span class="command">lemmas</span></span> <span class="quoted">"10_I"</span> <span class="main">=</span> 10<span class="main">[</span><span class="operator">THEN</span> thin0<span class="main">]</span>

  <span class="keyword1" id="Surprise_Paradox-11"><span class="command">lemma</span></span> 11<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{}</span> <span class="main">⊢</span> P <span class="keyword1">IMP</span> <span class="free">Q<span class="hidden">⇩</span><sub>1</sub></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> propositional_calculus <span class="quoted">"7_E"</span> <span class="quoted">"10_I"</span><span class="main">)</span>
    
  <span class="keyword1" id="Surprise_Paradox-12"><span class="command">lemma</span></span> 12<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{}</span> <span class="main">⊢</span> PfP <span class="main">«</span>P <span class="keyword1">IMP</span> <span class="free">Q<span class="hidden">⇩</span><sub>1</sub></span><span class="main">»</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 11 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> proved_imp_proved_PfP<span class="main">)</span>
  <span class="keyword1"><span class="command">lemmas</span></span> <span class="quoted">"12_I"</span> <span class="main">=</span> 12<span class="main">[</span><span class="operator">THEN</span> thin0<span class="main">]</span>

  <span class="keyword1" id="Surprise_Paradox-13"><span class="command">lemma</span></span> 13<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{}</span> <span class="main">⊢</span> Neg P"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> propositional_calculus <span class="quoted">"7_E"</span> <span class="quoted">"10_I"</span> <span class="quoted">"12_I"</span><span class="main">)</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Substitution, quoting and V-quoting›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹In the end, we did not need the lemma at the end of this section, but it may be useful to
others.›</span></span>

<span class="keyword1" id="Surprise_Paradox-trans_tm_forgets"><span class="command">lemma</span></span> trans_tm_forgets<span class="main">:</span> <span class="quoted"><span class="quoted">"atom <span class="main">`</span> set <span class="free">is</span> <span class="main">♯*</span> <span class="free">t</span> <span class="main">⟹</span> trans_tm <span class="free">is</span> <span class="free">t</span> <span class="main">=</span> trans_tm <span class="main">[]</span> <span class="free">t</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">t</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> tm.induct<span class="main">)</span>
     <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> lookup_notin fresh_star_def fresh_at_base<span class="main">)</span>

<span class="keyword1" id="Surprise_Paradox-vquot_dbtm_fresh"><span class="command">lemma</span></span> vquot_dbtm_fresh<span class="main">:</span> <span class="quoted"><span class="quoted">"atom <span class="main">`</span> <span class="free">V</span> <span class="main">♯*</span> <span class="free">t</span> <span class="main">⟹</span> vquot_dbtm <span class="free">V</span> <span class="free">t</span> <span class="main">=</span> quot_dbtm <span class="free">t</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">nominal_induct</span> <span class="quoted"><span class="free">t</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> dbtm.strong_induct<span class="main">)</span>
     <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fresh_star_def fresh_at_base<span class="main">)</span>

<span class="keyword1" id="Surprise_Paradox-subst_vquot_dbtm_trans_tm"><span class="command">lemma</span></span> subst_vquot_dbtm_trans_tm<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"atom <span class="free">i</span> <span class="main">♯</span> <span class="free">is</span> <span class="main">⟹</span> atom <span class="main">`</span> set <span class="free">is</span> <span class="main">♯*</span> <span class="free">t</span> <span class="main">⟹</span>
   subst <span class="free">i</span> <span class="main">«</span><span class="free">t</span><span class="main">»</span> <span class="main">(</span>vquot_dbtm <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="main">(</span>trans_tm <span class="free">is</span> <span class="free">t'</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
   quot_dbtm <span class="main">(</span>trans_tm <span class="free">is</span> <span class="main">(</span>subst <span class="free">i</span> <span class="free">t</span> <span class="free">t'</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">nominal_induct</span> <span class="quoted"><span class="free">t'</span></span> <span class="quasi_keyword">avoiding</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">"<span class="free">is</span>"</span></span> <span class="quoted"><span class="free">i</span></span> <span class="quoted"><span class="free">t</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> tm.strong_induct<span class="main">)</span>
     <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>  quot_tm_def lookup_notin fresh_imp_notin_env
                      vquot_dbtm_fresh lookup_fresh
           <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> trans_tm_forgets<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1" id="Surprise_Paradox-subst_vquot_dbtm_trans_fm"><span class="command">lemma</span></span> subst_vquot_dbtm_trans_fm<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"atom <span class="free">i</span> <span class="main">♯</span> <span class="free">is</span> <span class="main">⟹</span> atom <span class="main">`</span> set <span class="free">is</span> <span class="main">♯*</span> <span class="free">t</span> <span class="main">⟹</span>
   subst <span class="free">i</span> <span class="main">«</span><span class="free">t</span><span class="main">»</span> <span class="main">(</span>vquot_dbfm <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="main">(</span>trans_fm <span class="free">is</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
   quot_dbfm <span class="main">(</span>trans_fm <span class="free">is</span> <span class="main">(</span>subst_fm <span class="free">A</span> <span class="free">i</span> <span class="free">t</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">nominal_induct</span> <span class="quoted"><span class="free">A</span></span> <span class="quasi_keyword">avoiding</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">"<span class="free">is</span>"</span></span> <span class="quoted"><span class="free">i</span></span> <span class="quoted"><span class="free">t</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> fm.strong_induct<span class="main">)</span>
     <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> quot_fm_def fresh_Cons<span class="main">)</span>

<span class="keyword1" id="Surprise_Paradox-subst_vquot"><span class="command">lemma</span></span> subst_vquot<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"subst <span class="free">i</span> <span class="main">«</span><span class="free">t</span><span class="main">»</span> <span class="main">⌊</span><span class="free">A</span><span class="main">⌋</span><span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="main">=</span> <span class="main">«</span><span class="free">A</span><span class="main">(</span><span class="free">i</span> <span class="main">::=</span> <span class="free">t</span><span class="main">)</span><span class="main">»</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">nominal_induct</span> <span class="quoted"><span class="free">A</span></span> <span class="quasi_keyword">avoiding</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">i</span></span> <span class="quoted"><span class="free">t</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> fm.strong_induct<span class="main">)</span>
     <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vquot_fm_def quot_fm_def fresh_Cons<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div>